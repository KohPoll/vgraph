define("lib/pubsub",[],function(){var g={};g.version="1.0.1";var e={};var h=-1;var f=function(a,c,b){if(!e.hasOwnProperty(a)){return false}var d=function(){var s=e[a];var r=function(k){return function(){throw k}};for(var p=0,q=s.length;p<q;p++){try{s[p].func(a,c)}catch(j){setTimeout(r(j),0)}}};if(b===true){d()}else{setTimeout(d,0)}return true};g.publish=function(b,a){return f(b,a,false)};g.publishSync=function(b,a){return f(b,a,true)};g.subscribe=function(b,c){if(!e.hasOwnProperty(b)){e[b]=[]}var a=(++h).toString();e[b].push({token:a,func:c});return a};g.unsubscribe=function(c){for(var b in e){if(e.hasOwnProperty(b)){for(var d=0,a=e[b].length;d<a;d++){if(e[b][d].token===c){e[b].splice(d,1);return c}}}}return false};return g});define("lib/Three",[],function(){var d=window;var c=c||{};if(!d.Int32Array){d.Int32Array=Array,d.Float32Array=Array}c.Clock=function(a){this.autoStart=a!==void 0?a:!0;this.elapsedTime=this.oldTime=this.startTime=0;this.running=!1};c.Clock.prototype.start=function(){this.oldTime=this.startTime=Date.now();this.running=!0};c.Clock.prototype.stop=function(){this.getElapsedTime();this.running=!1};c.Clock.prototype.getElapsedTime=function(){this.elapsedTime+=this.getDelta();return this.elapsedTime};c.Clock.prototype.getDelta=function(){var b=0;this.autoStart&&!this.running&&this.start();if(this.running){var a=Date.now(),b=0.001*(a-this.oldTime);this.oldTime=a;this.elapsedTime+=b}return b};c.Color=function(a){a!==void 0&&this.setHex(a);return this};c.Color.prototype={constructor:c.Color,r:1,g:1,b:1,copy:function(a){this.r=a.r;this.g=a.g;this.b=a.b;return this},copyGammaToLinear:function(a){this.r=a.r*a.r;this.g=a.g*a.g;this.b=a.b*a.b;return this},copyLinearToGamma:function(a){this.r=Math.sqrt(a.r);this.g=Math.sqrt(a.g);this.b=Math.sqrt(a.b);return this},setRGB:function(f,b,a){this.r=f;this.g=b;this.b=a;return this},setHSV:function(k,g,a){var l,f,b;if(a===0){this.r=this.g=this.b=0}else{switch(l=Math.floor(k*6),f=k*6-l,k=a*(1-g),b=a*(1-g*f),g=a*(1-g*(1-f)),l){case 1:this.r=b;this.g=a;this.b=k;break;case 2:this.r=k;this.g=a;this.b=g;break;case 3:this.r=k;this.g=b;this.b=a;break;case 4:this.r=g;this.g=k;this.b=a;break;case 5:this.r=a;this.g=k;this.b=b;break;case 6:case 0:this.r=a,this.g=g,this.b=k}}return this},setHex:function(a){a=Math.floor(a);this.r=(a>>16&255)/255;this.g=(a>>8&255)/255;this.b=(a&255)/255;return this},getHex:function(){return ~~(this.r*255)<<16^~~(this.g*255)<<8^~~(this.b*255)},getContextStyle:function(){return"rgb("+Math.floor(this.r*255)+","+Math.floor(this.g*255)+","+Math.floor(this.b*255)+")"},clone:function(){return(new c.Color).setRGB(this.r,this.g,this.b)}};c.Vector2=function(b,a){this.x=b||0;this.y=a||0};c.Vector2.prototype={constructor:c.Vector2,set:function(b,a){this.x=b;this.y=a;return this},copy:function(a){this.x=a.x;this.y=a.y;return this},clone:function(){return new c.Vector2(this.x,this.y)},add:function(b,a){this.x=b.x+a.x;this.y=b.y+a.y;return this},addSelf:function(a){this.x+=a.x;this.y+=a.y;return this},sub:function(b,a){this.x=b.x-a.x;this.y=b.y-a.y;return this},subSelf:function(a){this.x-=a.x;this.y-=a.y;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;return this},divideScalar:function(a){a?(this.x/=a,this.y/=a):this.set(0,0);return this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(b){var a=this.x-b.x,b=this.y-b.y;return a*a+b*b},setLength:function(a){return this.normalize().multiplyScalar(a)},equals:function(a){return a.x===this.x&&a.y===this.y}};c.Vector3=function(f,b,a){this.x=f||0;this.y=b||0;this.z=a||0};c.Vector3.prototype={constructor:c.Vector3,set:function(f,b,a){this.x=f;this.y=b;this.z=a;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this},clone:function(){return new c.Vector3(this.x,this.y,this.z)},add:function(b,a){this.x=b.x+a.x;this.y=b.y+a.y;this.z=b.z+a.z;return this},addSelf:function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;return this},sub:function(b,a){this.x=b.x-a.x;this.y=b.y-a.y;this.z=b.z-a.z;return this},subSelf:function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;return this},multiply:function(b,a){this.x=b.x*a.x;this.y=b.y*a.y;this.z=b.z*a.z;return this},multiplySelf:function(a){this.x*=a.x;this.y*=a.y;this.z*=a.z;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;this.z*=a;return this},divideSelf:function(a){this.x/=a.x;this.y/=a.y;this.z/=a.z;return this},divideScalar:function(a){a?(this.x/=a,this.y/=a,this.z/=a):this.z=this.y=this.x=0;return this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.lengthSq())},lengthManhattan:function(){return this.x+this.y+this.z},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){return this.normalize().multiplyScalar(a)},cross:function(b,a){this.x=b.y*a.z-b.z*a.y;this.y=b.z*a.x-b.x*a.z;this.z=b.x*a.y-b.y*a.x;return this},crossSelf:function(a){var g=this.x,b=this.y,h=this.z;this.x=b*a.z-h*a.y;this.y=h*a.x-g*a.z;this.z=g*a.y-b*a.x;return this},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){return(new c.Vector3).sub(this,a).lengthSq()},setPositionFromMatrix:function(a){this.x=a.n14;this.y=a.n24;this.z=a.n34},setRotationFromMatrix:function(b){var a=Math.cos(this.y);this.y=Math.asin(b.n13);Math.abs(a)>0.00001?(this.x=Math.atan2(-b.n23/a,b.n33/a),this.z=Math.atan2(-b.n12/a,b.n11/a)):(this.x=0,this.z=Math.atan2(b.n21,b.n22))},isZero:function(){return this.lengthSq()<0.0001}};c.Vector4=function(a,g,b,h){this.x=a||0;this.y=g||0;this.z=b||0;this.w=h!==void 0?h:1};c.Vector4.prototype={constructor:c.Vector4,set:function(a,g,b,h){this.x=a;this.y=g;this.z=b;this.w=h;return this},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w!==void 0?a.w:1},clone:function(){return new c.Vector4(this.x,this.y,this.z,this.w)},add:function(b,a){this.x=b.x+a.x;this.y=b.y+a.y;this.z=b.z+a.z;this.w=b.w+a.w;return this},addSelf:function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;this.w+=a.w;return this},sub:function(b,a){this.x=b.x-a.x;this.y=b.y-a.y;this.z=b.z-a.z;this.w=b.w-a.w;return this},subSelf:function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;this.w-=a.w;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;this.z*=a;this.w*=a;return this},divideScalar:function(a){a?(this.x/=a,this.y/=a,this.z/=a,this.w/=a):(this.z=this.y=this.x=0,this.w=1);return this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w},lengthSq:function(){return this.dot(this)},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){return this.normalize().multiplyScalar(a)},lerpSelf:function(b,a){this.x+=(b.x-this.x)*a;this.y+=(b.y-this.y)*a;this.z+=(b.z-this.z)*a;this.w+=(b.w-this.w)*a;return this}};c.Ray=function(a,e){function b(j,v,s){y.sub(s,j);t=y.dot(v);if(t<=0){return null}r=B.add(j,q.copy(v).multiplyScalar(t));return x=s.distanceTo(r)}function f(z,j,v,s){y.sub(s,j);B.sub(v,j);q.sub(z,j);F=y.dot(y);W=y.dot(B);X=y.dot(q);A=B.dot(B);u=B.dot(q);p=1/(F*A-W*W);w=(A*X-W*u)*p;Y=(F*u-W*X)*p;return w>=0&&Y>=0&&w+Y<1}this.origin=a||new c.Vector3;this.direction=e||new c.Vector3;this.intersectScene=function(j){return this.intersectObjects(j.children)};this.intersectObjects=function(z){var j,v,s=[];j=0;for(v=z.length;j<v;j++){Array.prototype.push.apply(s,this.intersectObject(z[j]))}s.sort(function(C,D){return C.distance-D.distance});return s};var k=new c.Vector3,h=new c.Vector3,g=new c.Vector3,l=new c.Vector3,a=new c.Vector3,e=new c.Vector3,m=new c.Vector3,o=new c.Vector3,n=new c.Vector3;this.intersectObject=function(D){for(var G,H=[],j=0,C=D.children.length;j<C;j++){Array.prototype.push.apply(H,this.intersectObject(D.children[j]))}if(D instanceof c.Particle){j=b(this.origin,this.direction,D.matrixWorld.getPosition());if(j===null||j>D.scale.x){return[]}G={distance:j,point:D.position,face:null,object:D};H.push(G)}else{if(D instanceof c.Mesh){j=b(this.origin,this.direction,D.matrixWorld.getPosition());if(j===null||j>D.geometry.boundingSphere.radius*Math.max(D.scale.x,Math.max(D.scale.y,D.scale.z))){return H}var v,E=D.geometry,z=E.vertices,s;D.matrixRotationWorld.extractRotation(D.matrixWorld);j=0;for(C=E.faces.length;j<C;j++){if(G=E.faces[j],a.copy(this.origin),e.copy(this.direction),s=D.matrixWorld,m=s.multiplyVector3(m.copy(G.centroid)).subSelf(a),v=m.dot(e),!(v<=0)&&(k=s.multiplyVector3(k.copy(z[G.a].position)),h=s.multiplyVector3(h.copy(z[G.b].position)),g=s.multiplyVector3(g.copy(z[G.c].position)),G instanceof c.Face4&&(l=s.multiplyVector3(l.copy(z[G.d].position))),o=D.matrixRotationWorld.multiplyVector3(o.copy(G.normal)),v=e.dot(o),D.doubleSided||(D.flipSided?v>0:v<0))){if(v=o.dot(m.sub(k,a))/v,n.add(a,e.multiplyScalar(v)),G instanceof c.Face3){f(n,k,h,g)&&(G={distance:a.distanceTo(n),point:n.clone(),face:G,object:D},H.push(G))}else{if(G instanceof c.Face4&&(f(n,k,h,l)||f(n,h,g,l))){G={distance:a.distanceTo(n),point:n.clone(),face:G,object:D},H.push(G)}}}}}}return H};var y=new c.Vector3,B=new c.Vector3,q=new c.Vector3,t,r,x,F,W,X,A,u,p,w,Y};c.Rectangle=function(){function a(){h=b-g;f=p-e}var g,e,b,p,h,f,o=!0;this.getX=function(){return g};this.getY=function(){return e};this.getWidth=function(){return h};this.getHeight=function(){return f};this.getLeft=function(){return g};this.getTop=function(){return e};this.getRight=function(){return b};this.getBottom=function(){return p};this.set=function(l,k,m,j){o=!1;g=l;e=k;b=m;p=j;a()};this.addPoint=function(k,j){o?(o=!1,g=k,e=j,b=k,p=j):(g=g<k?g:k,e=e<j?e:j,b=b>k?b:k,p=p>j?p:j);a()};this.add3Points=function(k,l,n,j,q,m){o?(o=!1,g=k<n?k<q?k:q:n<q?n:q,e=l<j?l<m?l:m:j<m?j:m,b=k>n?k>q?k:q:n>q?n:q,p=l>j?l>m?l:m:j>m?j:m):(g=k<n?k<q?k<g?k:g:q<g?q:g:n<q?n<g?n:g:q<g?q:g,e=l<j?l<m?l<e?l:e:m<e?m:e:j<m?j<e?j:e:m<e?m:e,b=k>n?k>q?k>b?k:b:q>b?q:b:n>q?n>b?n:b:q>b?q:b,p=l>j?l>m?l>p?l:p:m>p?m:p:j>m?j>p?j:p:m>p?m:p);a()};this.addRectangle=function(j){o?(o=!1,g=j.getLeft(),e=j.getTop(),b=j.getRight(),p=j.getBottom()):(g=g<j.getLeft()?g:j.getLeft(),e=e<j.getTop()?e:j.getTop(),b=b>j.getRight()?b:j.getRight(),p=p>j.getBottom()?p:j.getBottom());a()};this.inflate=function(j){g-=j;e-=j;b+=j;p+=j;a()};this.minSelf=function(j){g=g>j.getLeft()?g:j.getLeft();e=e>j.getTop()?e:j.getTop();b=b<j.getRight()?b:j.getRight();p=p<j.getBottom()?p:j.getBottom();a()};this.intersects=function(j){return Math.min(b,j.getRight())-Math.max(g,j.getLeft())>=0&&Math.min(p,j.getBottom())-Math.max(e,j.getTop())>=0};this.empty=function(){o=!0;p=b=e=g=0;a()};this.isEmpty=function(){return o}};c.Math={clamp:function(f,b,a){return f<b?b:f>a?a:f},clampBottom:function(b,a){return b<a?a:b},mapLinear:function(b,g,j,k,a){return k+(b-g)*(a-k)/(j-g)},random16:function(){return(65280*Math.random()+255*Math.random())/65535}};c.Matrix3=function(){this.m=[]};c.Matrix3.prototype={constructor:c.Matrix3,transpose:function(){var b,a=this.m;b=a[1];a[1]=a[3];a[3]=b;b=a[2];a[2]=a[6];a[6]=b;b=a[5];a[5]=a[7];a[7]=b;return this},transposeIntoArray:function(b){var a=this.m;b[0]=a[0];b[1]=a[3];b[2]=a[6];b[3]=a[1];b[4]=a[4];b[5]=a[7];b[6]=a[2];b[7]=a[5];b[8]=a[8];return this}};c.Matrix4=function(l,f,e,m,r,o,n,E,F,b,G,a,g,h,p,k){this.set(l!==void 0?l:1,f||0,e||0,m||0,r||0,o!==void 0?o:1,n||0,E||0,F||0,b||0,G!==void 0?G:1,a||0,g||0,h||0,p||0,k!==void 0?k:1);this.flat=Array(16);this.m33=new c.Matrix3};c.Matrix4.prototype={constructor:c.Matrix4,set:function(l,f,e,m,r,o,n,E,F,b,G,a,g,h,p,k){this.n11=l;this.n12=f;this.n13=e;this.n14=m;this.n21=r;this.n22=o;this.n23=n;this.n24=E;this.n31=F;this.n32=b;this.n33=G;this.n34=a;this.n41=g;this.n42=h;this.n43=p;this.n44=k;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},copy:function(a){this.set(a.n11,a.n12,a.n13,a.n14,a.n21,a.n22,a.n23,a.n24,a.n31,a.n32,a.n33,a.n34,a.n41,a.n42,a.n43,a.n44);return this},lookAt:function(k,g,a){var l=c.Matrix4.__v1,f=c.Matrix4.__v2,b=c.Matrix4.__v3;b.sub(k,g).normalize();if(b.length()===0){b.z=1}l.cross(a,b).normalize();l.length()===0&&(b.x+=0.0001,l.cross(a,b).normalize());f.cross(b,l).normalize();this.n11=l.x;this.n12=f.x;this.n13=b.x;this.n21=l.y;this.n22=f.y;this.n23=b.y;this.n31=l.z;this.n32=f.z;this.n33=b.z;return this},multiply:function(m,q){var o=m.n11,r=m.n12,k=m.n13,e=m.n14,s=m.n21,n=m.n22,t=m.n23,p=m.n24,u=m.n31,ac=m.n32,w=m.n33,E=m.n34,A=m.n41,U=m.n42,v=m.n43,F=m.n44,R=q.n11,K=q.n12,x=q.n13,O=q.n14,y=q.n21,ad=q.n22,a=q.n23,P=q.n24,f=q.n31,B=q.n32,J=q.n33,ae=q.n34,b=q.n41,g=q.n42,l=q.n43,h=q.n44;this.n11=o*R+r*y+k*f+e*b;this.n12=o*K+r*ad+k*B+e*g;this.n13=o*x+r*a+k*J+e*l;this.n14=o*O+r*P+k*ae+e*h;this.n21=s*R+n*y+t*f+p*b;this.n22=s*K+n*ad+t*B+p*g;this.n23=s*x+n*a+t*J+p*l;this.n24=s*O+n*P+t*ae+p*h;this.n31=u*R+ac*y+w*f+E*b;this.n32=u*K+ac*ad+w*B+E*g;this.n33=u*x+ac*a+w*J+E*l;this.n34=u*O+ac*P+w*ae+E*h;this.n41=A*R+U*y+v*f+F*b;this.n42=A*K+U*ad+v*B+F*g;this.n43=A*x+U*a+v*J+F*l;this.n44=A*O+U*P+v*ae+F*h;return this},multiplySelf:function(a){return this.multiply(this,a)},multiplyToArray:function(f,b,a){this.multiply(f,b);a[0]=this.n11;a[1]=this.n21;a[2]=this.n31;a[3]=this.n41;a[4]=this.n12;a[5]=this.n22;a[6]=this.n32;a[7]=this.n42;a[8]=this.n13;a[9]=this.n23;a[10]=this.n33;a[11]=this.n43;a[12]=this.n14;a[13]=this.n24;a[14]=this.n34;a[15]=this.n44;return this},multiplyScalar:function(a){this.n11*=a;this.n12*=a;this.n13*=a;this.n14*=a;this.n21*=a;this.n22*=a;this.n23*=a;this.n24*=a;this.n31*=a;this.n32*=a;this.n33*=a;this.n34*=a;this.n41*=a;this.n42*=a;this.n43*=a;this.n44*=a;return this},multiplyVector3:function(b){var g=b.x,j=b.y,k=b.z,a=1/(this.n41*g+this.n42*j+this.n43*k+this.n44);b.x=(this.n11*g+this.n12*j+this.n13*k+this.n14)*a;b.y=(this.n21*g+this.n22*j+this.n23*k+this.n24)*a;b.z=(this.n31*g+this.n32*j+this.n33*k+this.n34)*a;return b},multiplyVector4:function(b){var g=b.x,j=b.y,k=b.z,a=b.w;b.x=this.n11*g+this.n12*j+this.n13*k+this.n14*a;b.y=this.n21*g+this.n22*j+this.n23*k+this.n24*a;b.z=this.n31*g+this.n32*j+this.n33*k+this.n34*a;b.w=this.n41*g+this.n42*j+this.n43*k+this.n44*a;return b},rotateAxis:function(a){var g=a.x,b=a.y,h=a.z;a.x=g*this.n11+b*this.n12+h*this.n13;a.y=g*this.n21+b*this.n22+h*this.n23;a.z=g*this.n31+b*this.n32+h*this.n33;a.normalize();return a},crossVector:function(b){var a=new c.Vector4;a.x=this.n11*b.x+this.n12*b.y+this.n13*b.z+this.n14*b.w;a.y=this.n21*b.x+this.n22*b.y+this.n23*b.z+this.n24*b.w;a.z=this.n31*b.x+this.n32*b.y+this.n33*b.z+this.n34*b.w;a.w=b.w?this.n41*b.x+this.n42*b.y+this.n43*b.z+this.n44*b.w:1;return a},determinant:function(){var l=this.n11,f=this.n12,e=this.n13,m=this.n14,r=this.n21,o=this.n22,n=this.n23,E=this.n24,F=this.n31,b=this.n32,G=this.n33,a=this.n34,g=this.n41,h=this.n42,p=this.n43,k=this.n44;return m*n*b*g-e*E*b*g-m*o*G*g+f*E*G*g+e*o*a*g-f*n*a*g-m*n*F*h+e*E*F*h+m*r*G*h-l*E*G*h-e*r*a*h+l*n*a*h+m*o*F*p-f*E*F*p-m*r*b*p+l*E*b*p+f*r*a*p-l*o*a*p-e*o*F*k+f*n*F*k+e*r*b*k-l*n*b*k-f*r*G*k+l*o*G*k},transpose:function(){var a;a=this.n21;this.n21=this.n12;this.n12=a;a=this.n31;this.n31=this.n13;this.n13=a;a=this.n32;this.n32=this.n23;this.n23=a;a=this.n41;this.n41=this.n14;this.n14=a;a=this.n42;this.n42=this.n24;this.n24=a;a=this.n43;this.n43=this.n34;this.n43=a;return this},clone:function(){var a=new c.Matrix4;a.n11=this.n11;a.n12=this.n12;a.n13=this.n13;a.n14=this.n14;a.n21=this.n21;a.n22=this.n22;a.n23=this.n23;a.n24=this.n24;a.n31=this.n31;a.n32=this.n32;a.n33=this.n33;a.n34=this.n34;a.n41=this.n41;a.n42=this.n42;a.n43=this.n43;a.n44=this.n44;return a},flatten:function(){this.flat[0]=this.n11;this.flat[1]=this.n21;this.flat[2]=this.n31;this.flat[3]=this.n41;this.flat[4]=this.n12;this.flat[5]=this.n22;this.flat[6]=this.n32;this.flat[7]=this.n42;this.flat[8]=this.n13;this.flat[9]=this.n23;this.flat[10]=this.n33;this.flat[11]=this.n43;this.flat[12]=this.n14;this.flat[13]=this.n24;this.flat[14]=this.n34;this.flat[15]=this.n44;return this.flat},flattenToArray:function(a){a[0]=this.n11;a[1]=this.n21;a[2]=this.n31;a[3]=this.n41;a[4]=this.n12;a[5]=this.n22;a[6]=this.n32;a[7]=this.n42;a[8]=this.n13;a[9]=this.n23;a[10]=this.n33;a[11]=this.n43;a[12]=this.n14;a[13]=this.n24;a[14]=this.n34;a[15]=this.n44;return a},flattenToArrayOffset:function(b,a){b[a]=this.n11;b[a+1]=this.n21;b[a+2]=this.n31;b[a+3]=this.n41;b[a+4]=this.n12;b[a+5]=this.n22;b[a+6]=this.n32;b[a+7]=this.n42;b[a+8]=this.n13;b[a+9]=this.n23;b[a+10]=this.n33;b[a+11]=this.n43;b[a+12]=this.n14;b[a+13]=this.n24;b[a+14]=this.n34;b[a+15]=this.n44;return b},setTranslation:function(f,b,a){this.set(1,0,0,f,0,1,0,b,0,0,1,a,0,0,0,1);return this},setScale:function(f,b,a){this.set(f,0,0,0,0,b,0,0,0,0,a,0,0,0,0,1);return this},setRotationX:function(b){var a=Math.cos(b),b=Math.sin(b);this.set(1,0,0,0,0,a,-b,0,0,b,a,0,0,0,0,1);return this},setRotationY:function(b){var a=Math.cos(b),b=Math.sin(b);this.set(a,0,b,0,0,1,0,0,-b,0,a,0,0,0,0,1);return this},setRotationZ:function(b){var a=Math.cos(b),b=Math.sin(b);this.set(a,-b,0,0,b,a,0,0,0,0,1,0,0,0,0,1);return this},setRotationAxis:function(a,e){var b=Math.cos(e),f=Math.sin(e),l=1-b,h=a.x,g=a.y,s=a.z,t=l*h,u=l*g;this.set(t*h+b,t*g-f*s,t*s+f*g,0,t*g+f*s,u*g+b,u*s-f*h,0,t*s-f*g,u*s+f*h,l*s*s+b,0,0,0,0,1);return this},setPosition:function(a){this.n14=a.x;this.n24=a.y;this.n34=a.z;return this},getPosition:function(){return c.Matrix4.__v1.set(this.n14,this.n24,this.n34)},getColumnX:function(){return c.Matrix4.__v1.set(this.n11,this.n21,this.n31)},getColumnY:function(){return c.Matrix4.__v1.set(this.n12,this.n22,this.n32)},getColumnZ:function(){return c.Matrix4.__v1.set(this.n13,this.n23,this.n33)},getInverse:function(G){var l=G.n11,g=G.n12,a=G.n13,e=G.n14,b=G.n21,I=G.n22,f=G.n23,m=G.n24,o=G.n31,n=G.n32,H=G.n33,h=G.n34,p=G.n41,k=G.n42,q=G.n43,r=G.n44;this.n11=f*h*k-m*H*k+m*n*q-I*h*q-f*n*r+I*H*r;this.n12=e*H*k-a*h*k-e*n*q+g*h*q+a*n*r-g*H*r;this.n13=a*m*k-e*f*k+e*I*q-g*m*q-a*I*r+g*f*r;this.n14=e*f*n-a*m*n-e*I*H+g*m*H+a*I*h-g*f*h;this.n21=m*H*p-f*h*p-m*o*q+b*h*q+f*o*r-b*H*r;this.n22=a*h*p-e*H*p+e*o*q-l*h*q-a*o*r+l*H*r;this.n23=e*f*p-a*m*p-e*b*q+l*m*q+a*b*r-l*f*r;this.n24=a*m*o-e*f*o+e*b*H-l*m*H-a*b*h+l*f*h;this.n31=I*h*p-m*n*p+m*o*k-b*h*k-I*o*r+b*n*r;this.n32=e*n*p-g*h*p-e*o*k+l*h*k+g*o*r-l*n*r;this.n33=a*m*p-e*I*p+e*b*k-l*m*k-g*b*r+l*I*r;this.n34=e*I*o-g*m*o-e*b*n+l*m*n+g*b*h-l*I*h;this.n41=f*n*p-I*H*p-f*o*k+b*H*k+I*o*q-b*n*q;this.n42=g*H*p-a*n*p+a*o*k-l*H*k-g*o*q+l*n*q;this.n43=a*I*p-g*f*p-a*b*k+l*f*k+g*b*q-l*I*q;this.n44=g*f*o-a*I*o+a*b*n-l*f*n-g*b*H+l*I*H;this.multiplyScalar(1/G.determinant());return this},setRotationFromEuler:function(g,k){var h=g.x,l=g.y,o=g.z,y=Math.cos(h),h=Math.sin(h),x=Math.cos(l),l=Math.sin(l),w=Math.cos(o),o=Math.sin(o);switch(k){case"YXZ":var a=x*w,e=x*o,b=l*w,f=l*o;this.n11=a+f*h;this.n12=b*h-e;this.n13=y*l;this.n21=y*o;this.n22=y*w;this.n23=-h;this.n31=e*h-b;this.n32=f+a*h;this.n33=y*x;break;case"ZXY":a=x*w;e=x*o;b=l*w;f=l*o;this.n11=a-f*h;this.n12=-y*o;this.n13=b+e*h;this.n21=e+b*h;this.n22=y*w;this.n23=f-a*h;this.n31=-y*l;this.n32=h;this.n33=y*x;break;case"ZYX":a=y*w;e=y*o;b=h*w;f=h*o;this.n11=x*w;this.n12=b*l-e;this.n13=a*l+f;this.n21=x*o;this.n22=f*l+a;this.n23=e*l-b;this.n31=-l;this.n32=h*x;this.n33=y*x;break;case"YZX":a=y*x;e=y*l;b=h*x;f=h*l;this.n11=x*w;this.n12=f-a*o;this.n13=b*o+e;this.n21=o;this.n22=y*w;this.n23=-h*w;this.n31=-l*w;this.n32=e*o+b;this.n33=a-f*o;break;case"XZY":a=y*x;e=y*l;b=h*x;f=h*l;this.n11=x*w;this.n12=-o;this.n13=l*w;this.n21=a*o+f;this.n22=y*w;this.n23=e*o-b;this.n31=b*o-e;this.n32=h*w;this.n33=f*o+a;break;default:a=y*w,e=y*o,b=h*w,f=h*o,this.n11=x*w,this.n12=-x*o,this.n13=l,this.n21=e+b*l,this.n22=a-f*l,this.n23=-h*x,this.n31=f-a*l,this.n32=b+e*l,this.n33=y*x}return this},setRotationFromQuaternion:function(a){var e=a.x,b=a.y,f=a.z,l=a.w,h=e+e,g=b+b,s=f+f,a=e*h,t=e*g;e*=s;var u=b*g;b*=s;f*=s;h*=l;g*=l;l*=s;this.n11=1-(u+f);this.n12=t-l;this.n13=e+g;this.n21=t+l;this.n22=1-(a+f);this.n23=b-h;this.n31=e-g;this.n32=b+h;this.n33=1-(a+u);return this},scale:function(f){var b=f.x,a=f.y,f=f.z;this.n11*=b;this.n12*=a;this.n13*=f;this.n21*=b;this.n22*=a;this.n23*=f;this.n31*=b;this.n32*=a;this.n33*=f;this.n41*=b;this.n42*=a;this.n43*=f;return this},compose:function(b,g,j){var k=c.Matrix4.__m1,a=c.Matrix4.__m2;k.identity();k.setRotationFromQuaternion(g);a.setScale(j.x,j.y,j.z);this.multiply(k,a);this.n14=b.x;this.n24=b.y;this.n34=b.z;return this},decompose:function(k,g,a){var l=c.Matrix4.__v1,f=c.Matrix4.__v2,b=c.Matrix4.__v3;l.set(this.n11,this.n21,this.n31);f.set(this.n12,this.n22,this.n32);b.set(this.n13,this.n23,this.n33);k=k instanceof c.Vector3?k:new c.Vector3;g=g instanceof c.Quaternion?g:new c.Quaternion;a=a instanceof c.Vector3?a:new c.Vector3;a.x=l.length();a.y=f.length();a.z=b.length();k.x=this.n14;k.y=this.n24;k.z=this.n34;l=c.Matrix4.__m1;l.copy(this);l.n11/=a.x;l.n21/=a.x;l.n31/=a.x;l.n12/=a.y;l.n22/=a.y;l.n32/=a.y;l.n13/=a.z;l.n23/=a.z;l.n33/=a.z;g.setFromRotationMatrix(l);return[k,g,a]},extractPosition:function(a){this.n14=a.n14;this.n24=a.n24;this.n34=a.n34;return this},extractRotation:function(a){var g=c.Matrix4.__v1,b=1/g.set(a.n11,a.n21,a.n31).length(),h=1/g.set(a.n12,a.n22,a.n32).length(),g=1/g.set(a.n13,a.n23,a.n33).length();this.n11=a.n11*b;this.n21=a.n21*b;this.n31=a.n31*b;this.n12=a.n12*h;this.n22=a.n22*h;this.n32=a.n32*h;this.n13=a.n13*g;this.n23=a.n23*g;this.n33=a.n33*g;return this}};c.Matrix4.makeInvert3x3=function(g){var k=g.m33,h=k.m,l=g.n33*g.n22-g.n32*g.n23,o=-g.n33*g.n21+g.n31*g.n23,y=g.n32*g.n21-g.n31*g.n22,x=-g.n33*g.n12+g.n32*g.n13,w=g.n33*g.n11-g.n31*g.n13,a=-g.n32*g.n11+g.n31*g.n12,e=g.n23*g.n12-g.n22*g.n13,b=-g.n23*g.n11+g.n21*g.n13,f=g.n22*g.n11-g.n21*g.n12,g=g.n11*l+g.n21*x+g.n31*e;g===0&&console.error("THREE.Matrix4.makeInvert3x3: Matrix not invertible.");g=1/g;h[0]=g*l;h[1]=g*o;h[2]=g*y;h[3]=g*x;h[4]=g*w;h[5]=g*a;h[6]=g*e;h[7]=g*b;h[8]=g*f;return k};c.Matrix4.makeFrustum=function(g,b,a,m,f,e){var n;n=new c.Matrix4;n.n11=2*f/(b-g);n.n12=0;n.n13=(b+g)/(b-g);n.n14=0;n.n21=0;n.n22=2*f/(m-a);n.n23=(m+a)/(m-a);n.n24=0;n.n31=0;n.n32=0;n.n33=-(e+f)/(e-f);n.n34=-2*e*f/(e-f);n.n41=0;n.n42=0;n.n43=-1;n.n44=0;return n};c.Matrix4.makePerspective=function(b,g,j,k){var a,b=j*Math.tan(b*Math.PI/360);a=-b;return c.Matrix4.makeFrustum(a*g,b*g,a,b,j,k)};c.Matrix4.makeOrtho=function(a,e,b,f,l,h){var g,s,t,u;g=new c.Matrix4;s=e-a;t=b-f;u=h-l;g.n11=2/s;g.n12=0;g.n13=0;g.n14=-((e+a)/s);g.n21=0;g.n22=2/t;g.n23=0;g.n24=-((b+f)/t);g.n31=0;g.n32=0;g.n33=-2/u;g.n34=-((h+l)/u);g.n41=0;g.n42=0;g.n43=0;g.n44=1;return g};c.Matrix4.__v1=new c.Vector3;c.Matrix4.__v2=new c.Vector3;c.Matrix4.__v3=new c.Vector3;c.Matrix4.__m1=new c.Matrix4;c.Matrix4.__m2=new c.Matrix4;c.Object3D=function(){this.name="";this.id=c.Object3DCount++;this.parent=void 0;this.children=[];this.up=new c.Vector3(0,1,0);this.position=new c.Vector3;this.rotation=new c.Vector3;this.eulerOrder="XYZ";this.scale=new c.Vector3(1,1,1);this.flipSided=this.doubleSided=this.dynamic=!1;this.renderDepth=null;this.rotationAutoUpdate=!0;this.matrix=new c.Matrix4;this.matrixWorld=new c.Matrix4;this.matrixRotationWorld=new c.Matrix4;this.matrixWorldNeedsUpdate=this.matrixAutoUpdate=!0;this.quaternion=new c.Quaternion;this.useQuaternion=!1;this.boundRadius=0;this.boundRadiusScale=1;this.visible=!0;this.receiveShadow=this.castShadow=!1;this.frustumCulled=!0;this._vector=new c.Vector3};c.Object3D.prototype={constructor:c.Object3D,translate:function(b,a){this.matrix.rotateAxis(a);this.position.addSelf(a.multiplyScalar(b))},translateX:function(a){this.translate(a,this._vector.set(1,0,0))},translateY:function(a){this.translate(a,this._vector.set(0,1,0))},translateZ:function(a){this.translate(a,this._vector.set(0,0,1))},lookAt:function(a){this.matrix.lookAt(a,this.position,this.up);this.rotationAutoUpdate&&this.rotation.setRotationFromMatrix(this.matrix)},add:function(b){if(this.children.indexOf(b)===-1){b.parent!==void 0&&b.parent.remove(b);b.parent=this;this.children.push(b);for(var a=this;a.parent!==void 0;){a=a.parent}a!==void 0&&a instanceof c.Scene&&a.addObject(b)}},remove:function(b){var a=this.children.indexOf(b);if(a!==-1){b.parent=void 0;this.children.splice(a,1);for(a=this;a.parent!==void 0;){a=a.parent}a!==void 0&&a instanceof c.Scene&&a.removeObject(b)}},getChildByName:function(b,g){var j,k,a;j=0;for(k=this.children.length;j<k;j++){a=this.children[j];if(a.name===b){return a}if(g&&(a=a.getChildByName(b,g),a!==void 0)){return a}}},updateMatrix:function(){this.matrix.setPosition(this.position);this.useQuaternion?this.matrix.setRotationFromQuaternion(this.quaternion):this.matrix.setRotationFromEuler(this.rotation,this.eulerOrder);if(this.scale.x!==1||this.scale.y!==1||this.scale.z!==1){this.matrix.scale(this.scale),this.boundRadiusScale=Math.max(this.scale.x,Math.max(this.scale.y,this.scale.z))}this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(f){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||f){this.parent?this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,f=!0}for(var b=0,a=this.children.length;b<a;b++){this.children[b].updateMatrixWorld(f)}}};c.Object3DCount=0;c.Projector=function(){function q(){var j=ad[ae]=ad[ae]||new c.RenderableObject;ae++;return j}function x(){var j=e[a]=e[a]||new c.RenderableVertex;a++;return j}function v(z,j){return j.z-z.z}function J(j,C){var D=0,G=1,H=j.z+j.w,K=C.z+C.w,I=-j.z+j.w,z=-C.z+C.w;return H>=0&&K>=0&&I>=0&&z>=0?!0:H<0&&K<0||I<0&&z<0?!1:(H<0?D=Math.max(D,H/(H-K)):K<0&&(G=Math.min(G,H/(H-K))),I<0?D=Math.max(D,I/(I-z)):z<0&&(G=Math.min(G,I/(I-z))),G<D?!1:(j.lerpSelf(C,D),C.lerpSelf(j,1-G),!0))}var E,ae,ad=[],F,a,e=[],b,h,k=[],f,o=[],g,m,s=[],B,y,n=[],A={objects:[],sprites:[],lights:[],elements:[]},l=new c.Vector3,ac=new c.Vector4,w=new c.Matrix4,u=new c.Matrix4,p=[new c.Vector4,new c.Vector4,new c.Vector4,new c.Vector4,new c.Vector4,new c.Vector4],r=new c.Vector4,t=new c.Vector4;this.computeFrustum=function(z){p[0].set(z.n41-z.n11,z.n42-z.n12,z.n43-z.n13,z.n44-z.n14);p[1].set(z.n41+z.n11,z.n42+z.n12,z.n43+z.n13,z.n44+z.n14);p[2].set(z.n41+z.n21,z.n42+z.n22,z.n43+z.n23,z.n44+z.n24);p[3].set(z.n41-z.n21,z.n42-z.n22,z.n43-z.n23,z.n44-z.n24);p[4].set(z.n41-z.n31,z.n42-z.n32,z.n43-z.n33,z.n44-z.n34);p[5].set(z.n41+z.n31,z.n42+z.n32,z.n43+z.n33,z.n44+z.n34);for(z=0;z<6;z++){var j=p[z];j.divideScalar(Math.sqrt(j.x*j.x+j.y*j.y+j.z*j.z))}};this.projectVector=function(z,j){j.matrixWorldInverse.getInverse(j.matrixWorld);w.multiply(j.projectionMatrix,j.matrixWorldInverse);w.multiplyVector3(z);return z};this.unprojectVector=function(z,j){j.projectionMatrixInverse.getInverse(j.projectionMatrix);w.multiply(j.matrixWorld,j.projectionMatrixInverse);w.multiplyVector3(z);return z};this.pickingRay=function(j,z){var C;j.z=-1;C=new c.Vector3(j.x,j.y,1);this.unprojectVector(j,z);this.unprojectVector(C,z);C.subSelf(j).normalize();return new c.Ray(j,C)};this.projectGraph=function(C,j){ae=0;A.objects.length=0;A.sprites.length=0;A.lights.length=0;var z=function(K){if(K.visible!==!1){var D;if(D=K instanceof c.Mesh||K instanceof c.Line){if(!(D=K.frustumCulled===!1)){q:{for(var G=K.matrixWorld,H=-K.geometry.boundingSphere.radius*Math.max(K.scale.x,Math.max(K.scale.y,K.scale.z)),I=0;I<6;I++){if(D=p[I].x*G.n14+p[I].y*G.n24+p[I].z*G.n34+p[I].w,D<=H){D=!1;break q}}D=!0}}}D?(w.multiplyVector3(l.copy(K.position)),E=q(),E.object=K,E.z=l.z,A.objects.push(E)):K instanceof c.Sprite||K instanceof c.Particle?(w.multiplyVector3(l.copy(K.position)),E=q(),E.object=K,E.z=l.z,A.sprites.push(E)):K instanceof c.Light&&A.lights.push(K);D=0;for(G=K.children.length;D<G;D++){z(K.children[D])}}};z(C);j&&A.objects.sort(v);return A};this.projectScene=function(M,z,j){var H=z.near,Q=z.far,K,O,N,P,R,T,S,W,G,X,V,L,D,U,C,I;y=m=f=h=0;A.elements.length=0;z.parent===void 0&&(console.warn("DEPRECATED: Camera hasn't been added to a Scene. Adding it..."),M.add(z));M.updateMatrixWorld();z.matrixWorldInverse.getInverse(z.matrixWorld);w.multiply(z.projectionMatrix,z.matrixWorldInverse);this.computeFrustum(w);A=this.projectGraph(M,!1);M=0;for(K=A.objects.length;M<K;M++){if(G=A.objects[M].object,X=G.matrixWorld,L=G.material,a=0,G instanceof c.Mesh){V=G.geometry;D=G.geometry.materials;P=V.vertices;U=V.faces;C=V.faceVertexUvs;V=G.matrixRotationWorld.extractRotation(X);O=0;for(N=P.length;O<N;O++){F=x(),F.positionWorld.copy(P[O].position),X.multiplyVector3(F.positionWorld),F.positionScreen.copy(F.positionWorld),w.multiplyVector4(F.positionScreen),F.positionScreen.x/=F.positionScreen.w,F.positionScreen.y/=F.positionScreen.w,F.visible=F.positionScreen.z>H&&F.positionScreen.z<Q}P=0;for(O=U.length;P<O;P++){N=U[P];if(N instanceof c.Face3){if(R=e[N.a],T=e[N.b],S=e[N.c],R.visible&&T.visible&&S.visible&&(G.doubleSided||G.flipSided!=(S.positionScreen.x-R.positionScreen.x)*(T.positionScreen.y-R.positionScreen.y)-(S.positionScreen.y-R.positionScreen.y)*(T.positionScreen.x-R.positionScreen.x)<0)){W=k[h]=k[h]||new c.RenderableFace3,h++,b=W,b.v1.copy(R),b.v2.copy(T),b.v3.copy(S)}else{continue}}else{if(N instanceof c.Face4){if(R=e[N.a],T=e[N.b],S=e[N.c],W=e[N.d],R.visible&&T.visible&&S.visible&&W.visible&&(G.doubleSided||G.flipSided!=((W.positionScreen.x-R.positionScreen.x)*(T.positionScreen.y-R.positionScreen.y)-(W.positionScreen.y-R.positionScreen.y)*(T.positionScreen.x-R.positionScreen.x)<0||(T.positionScreen.x-S.positionScreen.x)*(W.positionScreen.y-S.positionScreen.y)-(T.positionScreen.y-S.positionScreen.y)*(W.positionScreen.x-S.positionScreen.x)<0))){I=o[f]=o[f]||new c.RenderableFace4,f++,b=I,b.v1.copy(R),b.v2.copy(T),b.v3.copy(S),b.v4.copy(W)}else{continue}}}b.normalWorld.copy(N.normal);V.multiplyVector3(b.normalWorld);b.centroidWorld.copy(N.centroid);X.multiplyVector3(b.centroidWorld);b.centroidScreen.copy(b.centroidWorld);w.multiplyVector3(b.centroidScreen);S=N.vertexNormals;R=0;for(T=S.length;R<T;R++){W=b.vertexNormalsWorld[R],W.copy(S[R]),V.multiplyVector3(W)}R=0;for(T=C.length;R<T;R++){if(I=C[R][P]){S=0;for(W=I.length;S<W;S++){b.uvs[R][S]=I[S]}}}b.material=L;b.faceMaterial=N.materialIndex!==null?D[N.materialIndex]:null;b.z=b.centroidScreen.z;A.elements.push(b)}}else{if(G instanceof c.Line){u.multiply(w,X);P=G.geometry.vertices;R=x();R.positionScreen.copy(P[0].position);u.multiplyVector4(R.positionScreen);O=1;for(N=P.length;O<N;O++){if(R=x(),R.positionScreen.copy(P[O].position),u.multiplyVector4(R.positionScreen),T=e[a-2],r.copy(R.positionScreen),t.copy(T.positionScreen),J(r,t)){r.multiplyScalar(1/r.w),t.multiplyScalar(1/t.w),G=s[m]=s[m]||new c.RenderableLine,m++,g=G,g.v1.positionScreen.copy(r),g.v2.positionScreen.copy(t),g.z=Math.max(r.z,t.z),g.material=L,A.elements.push(g)}}}}}M=0;for(K=A.sprites.length;M<K;M++){if(G=A.sprites[M].object,X=G.matrixWorld,G instanceof c.Particle&&(ac.set(X.n14,X.n24,X.n34,1),w.multiplyVector4(ac),ac.z/=ac.w,ac.z>0&&ac.z<1)){H=n[y]=n[y]||new c.RenderableParticle,y++,B=H,B.x=ac.x/ac.w,B.y=ac.y/ac.w,B.z=ac.z,B.rotation=G.rotation.z,B.scale.x=G.scale.x*Math.abs(B.x-(ac.x+z.projectionMatrix.n11)/(ac.w+z.projectionMatrix.n14)),B.scale.y=G.scale.y*Math.abs(B.y-(ac.y+z.projectionMatrix.n22)/(ac.w+z.projectionMatrix.n24)),B.material=G.material,A.elements.push(B)}}j&&A.elements.sort(v);return A}};c.Quaternion=function(a,g,b,h){this.set(a||0,g||0,b||0,h!==void 0?h:1)};c.Quaternion.prototype={constructor:c.Quaternion,set:function(a,g,b,h){this.x=a;this.y=g;this.z=b;this.w=h;return this},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w;return this},setFromEuler:function(a){var g=Math.PI/360,e=a.x*g,b=a.y*g,p=a.z*g,a=Math.cos(b),b=Math.sin(b),g=Math.cos(-p),p=Math.sin(-p),h=Math.cos(e),e=Math.sin(e),f=a*g,o=b*p;this.w=f*h-o*e;this.x=f*e+o*h;this.y=b*g*h+a*p*e;this.z=a*p*h-b*g*e;return this},setFromAxisAngle:function(a,g){var b=g/2,h=Math.sin(b);this.x=a.x*h;this.y=a.y*h;this.z=a.z*h;this.w=Math.cos(b);return this},setFromRotationMatrix:function(b){var a=Math.pow(b.determinant(),1/3);this.w=Math.sqrt(Math.max(0,a+b.n11+b.n22+b.n33))/2;this.x=Math.sqrt(Math.max(0,a+b.n11-b.n22-b.n33))/2;this.y=Math.sqrt(Math.max(0,a-b.n11+b.n22-b.n33))/2;this.z=Math.sqrt(Math.max(0,a-b.n11-b.n22+b.n33))/2;this.x=b.n32-b.n23<0?-Math.abs(this.x):Math.abs(this.x);this.y=b.n13-b.n31<0?-Math.abs(this.y):Math.abs(this.y);this.z=b.n21-b.n12<0?-Math.abs(this.z):Math.abs(this.z);this.normalize();return this},calculateW:function(){this.w=-Math.sqrt(Math.abs(1-this.x*this.x-this.y*this.y-this.z*this.z));return this},inverse:function(){this.x*=-1;this.y*=-1;this.z*=-1;return this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var a=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);a===0?this.w=this.z=this.y=this.x=0:(a=1/a,this.x*=a,this.y*=a,this.z*=a,this.w*=a);return this},multiplySelf:function(a){var g=this.x,e=this.y,b=this.z,p=this.w,h=a.x,f=a.y,o=a.z,a=a.w;this.x=g*a+p*h+e*o-b*f;this.y=e*a+p*f+b*h-g*o;this.z=b*a+p*o+g*f-e*h;this.w=p*a-g*h-e*f-b*o;return this},multiply:function(b,a){this.x=b.x*a.w+b.y*a.z-b.z*a.y+b.w*a.x;this.y=-b.x*a.z+b.y*a.w+b.z*a.x+b.w*a.y;this.z=b.x*a.y-b.y*a.x+b.z*a.w+b.w*a.z;this.w=-b.x*a.x-b.y*a.y-b.z*a.z+b.w*a.w;return this},multiplyVector3:function(g,k){k||(k=g);var h=g.x,l=g.y,o=g.z,y=this.x,x=this.y,w=this.z,a=this.w,e=a*h+x*o-w*l,b=a*l+w*h-y*o,f=a*o+y*l-x*h,h=-y*h-x*l-w*o;k.x=e*a+h*-y+b*-w-f*-x;k.y=b*a+h*-x+f*-y-e*-w;k.z=f*a+h*-w+e*-x-b*-y;return k}};c.Quaternion.slerp=function(k,g,a,l){var f=k.w*g.w+k.x*g.x+k.y*g.y+k.z*g.z;f<0?(a.w=-g.w,a.x=-g.x,a.y=-g.y,a.z=-g.z,f=-f):a.copy(g);if(Math.abs(f)>=1){return a.w=k.w,a.x=k.x,a.y=k.y,a.z=k.z,a}var b=Math.acos(f),f=Math.sqrt(1-f*f);if(Math.abs(f)<0.001){return a.w=0.5*(k.w+g.w),a.x=0.5*(k.x+g.x),a.y=0.5*(k.y+g.y),a.z=0.5*(k.z+g.z),a}g=Math.sin((1-l)*b)/f;l=Math.sin(l*b)/f;a.w=k.w*g+a.w*l;a.x=k.x*g+a.x*l;a.y=k.y*g+a.y*l;a.z=k.z*g+a.z*l;return a};c.Vertex=function(a){this.position=a||new c.Vector3};c.Face3=function(k,g,a,l,f,b){this.a=k;this.b=g;this.c=a;this.normal=l instanceof c.Vector3?l:new c.Vector3;this.vertexNormals=l instanceof Array?l:[];this.color=f instanceof c.Color?f:new c.Color;this.vertexColors=f instanceof Array?f:[];this.vertexTangents=[];this.materialIndex=b;this.centroid=new c.Vector3};c.Face4=function(g,b,a,m,f,e,n){this.a=g;this.b=b;this.c=a;this.d=m;this.normal=f instanceof c.Vector3?f:new c.Vector3;this.vertexNormals=f instanceof Array?f:[];this.color=e instanceof c.Color?e:new c.Color;this.vertexColors=e instanceof Array?e:[];this.vertexTangents=[];this.materialIndex=n;this.centroid=new c.Vector3};c.UV=function(b,a){this.u=b||0;this.v=a||0};c.UV.prototype={constructor:c.UV,set:function(b,a){this.u=b;this.v=a;return this},copy:function(a){this.u=a.u;this.v=a.v;return this},clone:function(){return new c.UV(this.u,this.v)}};c.Geometry=function(){this.id=c.GeometryCount++;this.vertices=[];this.colors=[];this.materials=[];this.faces=[];this.faceUvs=[[]];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphColors=[];this.skinWeights=[];this.skinIndices=[];this.boundingSphere=this.boundingBox=null;this.dynamic=this.hasTangents=!1};c.Geometry.prototype={constructor:c.Geometry,applyMatrix:function(g){var b=new c.Matrix4;b.extractRotation(g,new c.Vector3(1,1,1));for(var a=0,m=this.vertices.length;a<m;a++){g.multiplyVector3(this.vertices[a].position)}a=0;for(m=this.faces.length;a<m;a++){var f=this.faces[a];b.multiplyVector3(f.normal);for(var e=0,n=f.vertexNormals.length;e<n;e++){b.multiplyVector3(f.vertexNormals[e])}g.multiplyVector3(f.centroid)}},computeCentroids:function(){var f,b,a;f=0;for(b=this.faces.length;f<b;f++){a=this.faces[f],a.centroid.set(0,0,0),a instanceof c.Face3?(a.centroid.addSelf(this.vertices[a.a].position),a.centroid.addSelf(this.vertices[a.b].position),a.centroid.addSelf(this.vertices[a.c].position),a.centroid.divideScalar(3)):a instanceof c.Face4&&(a.centroid.addSelf(this.vertices[a.a].position),a.centroid.addSelf(this.vertices[a.b].position),a.centroid.addSelf(this.vertices[a.c].position),a.centroid.addSelf(this.vertices[a.d].position),a.centroid.divideScalar(4))}},computeFaceNormals:function(){var a,g,e,b,p,h,f=new c.Vector3,o=new c.Vector3;a=0;for(g=this.faces.length;a<g;a++){e=this.faces[a],b=this.vertices[e.a],p=this.vertices[e.b],h=this.vertices[e.c],f.sub(h.position,p.position),o.sub(b.position,p.position),f.crossSelf(o),f.isZero()||f.normalize(),e.normal.copy(f)}},computeVertexNormals:function(){var a,g,b,h;if(this.__tmpVertices===void 0){h=this.__tmpVertices=Array(this.vertices.length);a=0;for(g=this.vertices.length;a<g;a++){h[a]=new c.Vector3}a=0;for(g=this.faces.length;a<g;a++){if(b=this.faces[a],b instanceof c.Face3){b.vertexNormals=[new c.Vector3,new c.Vector3,new c.Vector3]}else{if(b instanceof c.Face4){b.vertexNormals=[new c.Vector3,new c.Vector3,new c.Vector3,new c.Vector3]}}}}else{h=this.__tmpVertices;a=0;for(g=this.vertices.length;a<g;a++){h[a].set(0,0,0)}}a=0;for(g=this.faces.length;a<g;a++){b=this.faces[a],b instanceof c.Face3?(h[b.a].addSelf(b.normal),h[b.b].addSelf(b.normal),h[b.c].addSelf(b.normal)):b instanceof c.Face4&&(h[b.a].addSelf(b.normal),h[b.b].addSelf(b.normal),h[b.c].addSelf(b.normal),h[b.d].addSelf(b.normal))}a=0;for(g=this.vertices.length;a<g;a++){h[a].normalize()}a=0;for(g=this.faces.length;a<g;a++){b=this.faces[a],b instanceof c.Face3?(b.vertexNormals[0].copy(h[b.a]),b.vertexNormals[1].copy(h[b.b]),b.vertexNormals[2].copy(h[b.c])):b instanceof c.Face4&&(b.vertexNormals[0].copy(h[b.a]),b.vertexNormals[1].copy(h[b.b]),b.vertexNormals[2].copy(h[b.c]),b.vertexNormals[3].copy(h[b.d]))}},computeTangents:function(){function r(D,G,H,I,j,z,C){u=D.vertices[G].position;q=D.vertices[H].position;U=D.vertices[I].position;B=g[j];A=g[z];w=g[C];ac=q.x-u.x;J=U.x-u.x;x=q.y-u.y;E=U.y-u.y;P=q.z-u.z;b=U.z-u.z;ad=A.u-B.u;F=w.u-B.u;ae=A.v-B.v;y=w.v-B.v;h=1/(ad*y-F*ae);K.set((y*ac-ae*J)*h,(y*x-ae*E)*h,(y*P-ae*b)*h);R.set((ad*J-F*ac)*h,(ad*E-F*x)*h,(ad*b-F*P)*h);a[G].addSelf(K);a[H].addSelf(K);a[I].addSelf(K);l[G].addSelf(R);l[H].addSelf(R);l[I].addSelf(R)}var t,s,e,o,m,g,u,q,U,B,A,w,ac,J,x,E,P,b,ad,F,ae,y,h,k,a=[],l=[],K=new c.Vector3,R=new c.Vector3,f=new c.Vector3,v=new c.Vector3,n=new c.Vector3;t=0;for(s=this.vertices.length;t<s;t++){a[t]=new c.Vector3,l[t]=new c.Vector3}t=0;for(s=this.faces.length;t<s;t++){m=this.faces[t],g=this.faceVertexUvs[0][t],m instanceof c.Face3?r(this,m.a,m.b,m.c,0,1,2):m instanceof c.Face4&&(r(this,m.a,m.b,m.c,0,1,2),r(this,m.a,m.b,m.d,0,1,3))}var p=["a","b","c","d"];t=0;for(s=this.faces.length;t<s;t++){m=this.faces[t];for(e=0;e<m.vertexNormals.length;e++){n.copy(m.vertexNormals[e]),o=m[p[e]],k=a[o],f.copy(k),f.subSelf(n.multiplyScalar(n.dot(k))).normalize(),v.cross(m.vertexNormals[e],k),o=v.dot(l[o]),o=o<0?-1:1,m.vertexTangents[e]=new c.Vector4(f.x,f.y,f.z,o)}}this.hasTangents=!0},computeBoundingBox:function(){var f;if(this.vertices.length>0){this.boundingBox={x:[this.vertices[0].position.x,this.vertices[0].position.x],y:[this.vertices[0].position.y,this.vertices[0].position.y],z:[this.vertices[0].position.z,this.vertices[0].position.z]};for(var b=1,a=this.vertices.length;b<a;b++){f=this.vertices[b];if(f.position.x<this.boundingBox.x[0]){this.boundingBox.x[0]=f.position.x}else{if(f.position.x>this.boundingBox.x[1]){this.boundingBox.x[1]=f.position.x}}if(f.position.y<this.boundingBox.y[0]){this.boundingBox.y[0]=f.position.y}else{if(f.position.y>this.boundingBox.y[1]){this.boundingBox.y[1]=f.position.y}}if(f.position.z<this.boundingBox.z[0]){this.boundingBox.z[0]=f.position.z}else{if(f.position.z>this.boundingBox.z[1]){this.boundingBox.z[1]=f.position.z}}}}},computeBoundingSphere:function(){for(var f=0,b=0,a=this.vertices.length;b<a;b++){f=Math.max(f,this.vertices[b].position.length())}this.boundingSphere={radius:f}},mergeVertices:function(){var g={},b=[],a=[],m,f=Math.pow(10,4),e,n;e=0;for(n=this.vertices.length;e<n;e++){m=this.vertices[e].position,m=[Math.round(m.x*f),Math.round(m.y*f),Math.round(m.z*f)].join("_"),g[m]===void 0?(g[m]=e,b.push(this.vertices[e]),a[e]=b.length-1):a[e]=a[g[m]]}e=0;for(n=this.faces.length;e<n;e++){if(g=this.faces[e],g instanceof c.Face3){g.a=a[g.a],g.b=a[g.b],g.c=a[g.c]}else{if(g instanceof c.Face4){g.a=a[g.a],g.b=a[g.b],g.c=a[g.c],g.d=a[g.d]}}}this.vertices=b}};c.GeometryCount=0;c.Spline=function(A){function b(m,n,s,q,j,t,r){m=(s-m)*0.5;q=(q-n)*0.5;return(2*(n-s)+m+q)*r+(-3*(n-s)-2*m-q)*t+m*j+n}this.points=A;var a=[],e={x:0,y:0,z:0},f,h,g,k,l,p,o,y,z;this.initFromArray=function(j){this.points=[];for(var m=0;m<j.length;m++){this.points[m]={x:j[m][0],y:j[m][1],z:j[m][2]}}};this.getPoint=function(j){f=(this.points.length-1)*j;h=Math.floor(f);g=f-h;a[0]=h===0?h:h-1;a[1]=h;a[2]=h>this.points.length-2?h:h+1;a[3]=h>this.points.length-3?h:h+2;p=this.points[a[0]];o=this.points[a[1]];y=this.points[a[2]];z=this.points[a[3]];k=g*g;l=g*k;e.x=b(p.x,o.x,y.x,z.x,g,k,l);e.y=b(p.y,o.y,y.y,z.y,g,k,l);e.z=b(p.z,o.z,y.z,z.z,g,k,l);return e};this.getControlPointsArray=function(){var j,m,n=this.points.length,q=[];for(j=0;j<n;j++){m=this.points[j],q[j]=[m.x,m.y,m.z]}return q};this.getLength=function(q){var r,s,t,v=r=r=0,u=new c.Vector3,j=new c.Vector3,m=[],n=0;m[0]=0;q||(q=100);s=this.points.length*q;u.copy(this.points[0]);for(q=1;q<s;q++){r=q/s,t=this.getPoint(r),j.copy(t),n+=j.distanceTo(u),u.copy(t),r*=this.points.length-1,r=Math.floor(r),r!=v&&(m[r]=n,v=r)}m[m.length]=n;return{chunks:m,total:n}};this.reparametrizeByArcLength=function(m){var n,q,r,w,t,s,u=[],v=new c.Vector3,j=this.getLength();u.push(v.copy(this.points[0]).clone());for(n=1;n<this.points.length;n++){q=j.chunks[n]-j.chunks[n-1];s=Math.ceil(m*q/j.total);w=(n-1)/(this.points.length-1);t=n/(this.points.length-1);for(q=1;q<s-1;q++){r=w+q*(1/s)*(t-w),r=this.getPoint(r),u.push(v.copy(r).clone())}u.push(v.copy(this.points[n]).clone())}this.points=u}};c.Edge=function(a,g,b,h){this.vertices=[a,g];this.vertexIndices=[b,h];this.faces=[];this.faceIndices=[]};c.Camera=function(){if(arguments.length){return console.warn("DEPRECATED: Camera() is now PerspectiveCamera() or OrthographicCamera()."),new c.PerspectiveCamera(arguments[0],arguments[1],arguments[2],arguments[3])}c.Object3D.call(this);this.matrixWorldInverse=new c.Matrix4;this.projectionMatrix=new c.Matrix4;this.projectionMatrixInverse=new c.Matrix4};c.Camera.prototype=new c.Object3D;c.Camera.prototype.constructor=c.Camera;c.Camera.prototype.lookAt=function(a){this.matrix.lookAt(this.position,a,this.up);this.rotationAutoUpdate&&this.rotation.setRotationFromMatrix(this.matrix)};c.OrthographicCamera=function(k,g,a,l,f,b){c.Camera.call(this);this.left=k;this.right=g;this.top=a;this.bottom=l;this.near=f!==void 0?f:0.1;this.far=b!==void 0?b:2000;this.updateProjectionMatrix()};c.OrthographicCamera.prototype=new c.Camera;c.OrthographicCamera.prototype.constructor=c.OrthographicCamera;c.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix=c.Matrix4.makeOrtho(this.left,this.right,this.top,this.bottom,this.near,this.far)};c.PerspectiveCamera=function(a,g,b,h){c.Camera.call(this);this.fov=a!==void 0?a:50;this.aspect=g!==void 0?g:1;this.near=b!==void 0?b:0.1;this.far=h!==void 0?h:2000;this.updateProjectionMatrix()};c.PerspectiveCamera.prototype=new c.Camera;c.PerspectiveCamera.prototype.constructor=c.PerspectiveCamera;c.PerspectiveCamera.prototype.setLens=function(b,a){this.fov=2*Math.atan((a!==void 0?a:43.25)/(b*2));this.fov*=180/Math.PI;this.updateProjectionMatrix()};c.PerspectiveCamera.prototype.setViewOffset=function(k,g,a,l,f,b){this.fullWidth=k;this.fullHeight=g;this.x=a;this.y=l;this.width=f;this.height=b;this.updateProjectionMatrix()};c.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var a=this.fullWidth/this.fullHeight,g=Math.tan(this.fov*Math.PI/360)*this.near,b=-g,h=a*b,a=Math.abs(a*g-h),b=Math.abs(g-b);this.projectionMatrix=c.Matrix4.makeFrustum(h+this.x*a/this.fullWidth,h+(this.x+this.width)*a/this.fullWidth,g-(this.y+this.height)*b/this.fullHeight,g-this.y*b/this.fullHeight,this.near,this.far)}else{this.projectionMatrix=c.Matrix4.makePerspective(this.fov,this.aspect,this.near,this.far)}};c.Light=function(a){c.Object3D.call(this);this.color=new c.Color(a)};c.Light.prototype=new c.Object3D;c.Light.prototype.constructor=c.Light;c.Light.prototype.supr=c.Object3D.prototype;c.AmbientLight=function(a){c.Light.call(this,a)};c.AmbientLight.prototype=new c.Light;c.AmbientLight.prototype.constructor=c.AmbientLight;c.DirectionalLight=function(f,b,a){c.Light.call(this,f);this.position=new c.Vector3(0,1,0);this.intensity=b!==void 0?b:1;this.distance=a!==void 0?a:0};c.DirectionalLight.prototype=new c.Light;c.DirectionalLight.prototype.constructor=c.DirectionalLight;c.PointLight=function(f,b,a){c.Light.call(this,f);this.position=new c.Vector3(0,0,0);this.intensity=b!==void 0?b:1;this.distance=a!==void 0?a:0};c.PointLight.prototype=new c.Light;c.PointLight.prototype.constructor=c.PointLight;c.SpotLight=function(a,g,b,h){c.Light.call(this,a);this.position=new c.Vector3(0,1,0);this.target=new c.Object3D;this.intensity=g!==void 0?g:1;this.distance=b!==void 0?b:0;this.castShadow=h!==void 0?h:!1};c.SpotLight.prototype=new c.Light;c.SpotLight.prototype.constructor=c.SpotLight;c.Material=function(a){this.name="";this.id=c.MaterialCount++;a=a||{};this.opacity=a.opacity!==void 0?a.opacity:1;this.transparent=a.transparent!==void 0?a.transparent:!1;this.blending=a.blending!==void 0?a.blending:c.NormalBlending;this.depthTest=a.depthTest!==void 0?a.depthTest:!0;this.depthWrite=a.depthWrite!==void 0?a.depthWrite:!0;this.polygonOffset=a.polygonOffset!==void 0?a.polygonOffset:!1;this.polygonOffsetFactor=a.polygonOffsetFactor!==void 0?a.polygonOffsetFactor:0;this.polygonOffsetUnits=a.polygonOffsetUnits!==void 0?a.polygonOffsetUnits:0;this.alphaTest=a.alphaTest!==void 0?a.alphaTest:0;this.overdraw=a.overdraw!==void 0?a.overdraw:!1};c.MaterialCount=0;c.NoShading=0;c.FlatShading=1;c.SmoothShading=2;c.NoColors=0;c.FaceColors=1;c.VertexColors=2;c.NormalBlending=0;c.AdditiveBlending=1;c.SubtractiveBlending=2;c.MultiplyBlending=3;c.AdditiveAlphaBlending=4;c.LineBasicMaterial=function(a){c.Material.call(this,a);a=a||{};this.color=a.color!==void 0?new c.Color(a.color):new c.Color(16777215);this.linewidth=a.linewidth!==void 0?a.linewidth:1;this.linecap=a.linecap!==void 0?a.linecap:"round";this.linejoin=a.linejoin!==void 0?a.linejoin:"round";this.vertexColors=a.vertexColors?a.vertexColors:!1;this.fog=a.fog!==void 0?a.fog:!0};c.LineBasicMaterial.prototype=new c.Material;c.LineBasicMaterial.prototype.constructor=c.LineBasicMaterial;c.MeshBasicMaterial=function(a){c.Material.call(this,a);a=a||{};this.color=a.color!==void 0?new c.Color(a.color):new c.Color(16777215);this.map=a.map!==void 0?a.map:null;this.lightMap=a.lightMap!==void 0?a.lightMap:null;this.envMap=a.envMap!==void 0?a.envMap:null;this.combine=a.combine!==void 0?a.combine:c.MultiplyOperation;this.reflectivity=a.reflectivity!==void 0?a.reflectivity:1;this.refractionRatio=a.refractionRatio!==void 0?a.refractionRatio:0.98;this.fog=a.fog!==void 0?a.fog:!0;this.shading=a.shading!==void 0?a.shading:c.SmoothShading;this.wireframe=a.wireframe!==void 0?a.wireframe:!1;this.wireframeLinewidth=a.wireframeLinewidth!==void 0?a.wireframeLinewidth:1;this.wireframeLinecap=a.wireframeLinecap!==void 0?a.wireframeLinecap:"round";this.wireframeLinejoin=a.wireframeLinejoin!==void 0?a.wireframeLinejoin:"round";this.vertexColors=a.vertexColors!==void 0?a.vertexColors:!1;this.skinning=a.skinning!==void 0?a.skinning:!1;this.morphTargets=a.morphTargets!==void 0?a.morphTargets:!1};c.MeshBasicMaterial.prototype=new c.Material;c.MeshBasicMaterial.prototype.constructor=c.MeshBasicMaterial;c.MeshLambertMaterial=function(a){c.Material.call(this,a);a=a||{};this.color=a.color!==void 0?new c.Color(a.color):new c.Color(16777215);this.ambient=a.ambient!==void 0?new c.Color(a.ambient):new c.Color(328965);this.map=a.map!==void 0?a.map:null;this.lightMap=a.lightMap!==void 0?a.lightMap:null;this.envMap=a.envMap!==void 0?a.envMap:null;this.combine=a.combine!==void 0?a.combine:c.MultiplyOperation;this.reflectivity=a.reflectivity!==void 0?a.reflectivity:1;this.refractionRatio=a.refractionRatio!==void 0?a.refractionRatio:0.98;this.fog=a.fog!==void 0?a.fog:!0;this.shading=a.shading!==void 0?a.shading:c.SmoothShading;this.wireframe=a.wireframe!==void 0?a.wireframe:!1;this.wireframeLinewidth=a.wireframeLinewidth!==void 0?a.wireframeLinewidth:1;this.wireframeLinecap=a.wireframeLinecap!==void 0?a.wireframeLinecap:"round";this.wireframeLinejoin=a.wireframeLinejoin!==void 0?a.wireframeLinejoin:"round";this.vertexColors=a.vertexColors!==void 0?a.vertexColors:!1;this.skinning=a.skinning!==void 0?a.skinning:!1;this.morphTargets=a.morphTargets!==void 0?a.morphTargets:!1};c.MeshLambertMaterial.prototype=new c.Material;c.MeshLambertMaterial.prototype.constructor=c.MeshLambertMaterial;c.MeshPhongMaterial=function(a){c.Material.call(this,a);a=a||{};this.color=a.color!==void 0?new c.Color(a.color):new c.Color(16777215);this.ambient=a.ambient!==void 0?new c.Color(a.ambient):new c.Color(328965);this.specular=a.specular!==void 0?new c.Color(a.specular):new c.Color(1118481);this.shininess=a.shininess!==void 0?a.shininess:30;this.metal=a.metal!==void 0?a.metal:!1;this.perPixel=a.perPixel!==void 0?a.perPixel:!1;this.map=a.map!==void 0?a.map:null;this.lightMap=a.lightMap!==void 0?a.lightMap:null;this.envMap=a.envMap!==void 0?a.envMap:null;this.combine=a.combine!==void 0?a.combine:c.MultiplyOperation;this.reflectivity=a.reflectivity!==void 0?a.reflectivity:1;this.refractionRatio=a.refractionRatio!==void 0?a.refractionRatio:0.98;this.fog=a.fog!==void 0?a.fog:!0;this.shading=a.shading!==void 0?a.shading:c.SmoothShading;this.wireframe=a.wireframe!==void 0?a.wireframe:!1;this.wireframeLinewidth=a.wireframeLinewidth!==void 0?a.wireframeLinewidth:1;this.wireframeLinecap=a.wireframeLinecap!==void 0?a.wireframeLinecap:"round";this.wireframeLinejoin=a.wireframeLinejoin!==void 0?a.wireframeLinejoin:"round";this.vertexColors=a.vertexColors!==void 0?a.vertexColors:!1;this.skinning=a.skinning!==void 0?a.skinning:!1;this.morphTargets=a.morphTargets!==void 0?a.morphTargets:!1};c.MeshPhongMaterial.prototype=new c.Material;c.MeshPhongMaterial.prototype.constructor=c.MeshPhongMaterial;c.MeshDepthMaterial=function(a){c.Material.call(this,a);a=a||{};this.shading=a.shading!==void 0?a.shading:c.SmoothShading;this.wireframe=a.wireframe!==void 0?a.wireframe:!1;this.wireframeLinewidth=a.wireframeLinewidth!==void 0?a.wireframeLinewidth:1};c.MeshDepthMaterial.prototype=new c.Material;c.MeshDepthMaterial.prototype.constructor=c.MeshDepthMaterial;c.MeshNormalMaterial=function(a){c.Material.call(this,a);a=a||{};this.shading=a.shading?a.shading:c.FlatShading;this.wireframe=a.wireframe?a.wireframe:!1;this.wireframeLinewidth=a.wireframeLinewidth?a.wireframeLinewidth:1};c.MeshNormalMaterial.prototype=new c.Material;c.MeshNormalMaterial.prototype.constructor=c.MeshNormalMaterial;c.MeshFaceMaterial=function(){};c.MeshShaderMaterial=function(a){console.warn("DEPRECATED: MeshShaderMaterial() is now ShaderMaterial().");return new c.ShaderMaterial(a)};c.ParticleBasicMaterial=function(a){c.Material.call(this,a);a=a||{};this.color=a.color!==void 0?new c.Color(a.color):new c.Color(16777215);this.map=a.map!==void 0?a.map:null;this.size=a.size!==void 0?a.size:1;this.sizeAttenuation=a.sizeAttenuation!==void 0?a.sizeAttenuation:!0;this.vertexColors=a.vertexColors!==void 0?a.vertexColors:!1;this.fog=a.fog!==void 0?a.fog:!0};c.ParticleBasicMaterial.prototype=new c.Material;c.ParticleBasicMaterial.prototype.constructor=c.ParticleBasicMaterial;c.ParticleCanvasMaterial=function(a){c.Material.call(this,a);a=a||{};this.color=a.color!==void 0?new c.Color(a.color):new c.Color(16777215);this.program=a.program!==void 0?a.program:function(){}};c.ParticleCanvasMaterial.prototype=new c.Material;c.ParticleCanvasMaterial.prototype.constructor=c.ParticleCanvasMaterial;c.ParticleDOMMaterial=function(a){c.Material.call(this);this.domElement=a};c.ShaderMaterial=function(a){c.Material.call(this,a);a=a||{};this.fragmentShader=a.fragmentShader!==void 0?a.fragmentShader:"void main() {}";this.vertexShader=a.vertexShader!==void 0?a.vertexShader:"void main() {}";this.uniforms=a.uniforms!==void 0?a.uniforms:{};this.attributes=a.attributes;this.shading=a.shading!==void 0?a.shading:c.SmoothShading;this.wireframe=a.wireframe!==void 0?a.wireframe:!1;this.wireframeLinewidth=a.wireframeLinewidth!==void 0?a.wireframeLinewidth:1;this.fog=a.fog!==void 0?a.fog:!1;this.lights=a.lights!==void 0?a.lights:!1;this.vertexColors=a.vertexColors!==void 0?a.vertexColors:!1;this.skinning=a.skinning!==void 0?a.skinning:!1;this.morphTargets=a.morphTargets!==void 0?a.morphTargets:!1};c.ShaderMaterial.prototype=new c.Material;c.ShaderMaterial.prototype.constructor=c.ShaderMaterial;c.Texture=function(k,g,a,l,f,b){this.id=c.TextureCount++;this.image=k;this.mapping=g!==void 0?g:new c.UVMapping;this.wrapS=a!==void 0?a:c.ClampToEdgeWrapping;this.wrapT=l!==void 0?l:c.ClampToEdgeWrapping;this.magFilter=f!==void 0?f:c.LinearFilter;this.minFilter=b!==void 0?b:c.LinearMipMapLinearFilter;this.offset=new c.Vector2(0,0);this.repeat=new c.Vector2(1,1);this.needsUpdate=!1;this.onUpdate=null};c.Texture.prototype={constructor:c.Texture,clone:function(){var a=new c.Texture(this.image,this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter);a.offset.copy(this.offset);a.repeat.copy(this.repeat);return a}};c.TextureCount=0;c.MultiplyOperation=0;c.MixOperation=1;c.CubeReflectionMapping=function(){};c.CubeRefractionMapping=function(){};c.LatitudeReflectionMapping=function(){};c.LatitudeRefractionMapping=function(){};c.SphericalReflectionMapping=function(){};c.SphericalRefractionMapping=function(){};c.UVMapping=function(){};c.RepeatWrapping=0;c.ClampToEdgeWrapping=1;c.MirroredRepeatWrapping=2;c.NearestFilter=3;c.NearestMipMapNearestFilter=4;c.NearestMipMapLinearFilter=5;c.LinearFilter=6;c.LinearMipMapNearestFilter=7;c.LinearMipMapLinearFilter=8;c.ByteType=9;c.UnsignedByteType=10;c.ShortType=11;c.UnsignedShortType=12;c.IntType=13;c.UnsignedIntType=14;c.FloatType=15;c.AlphaFormat=16;c.RGBFormat=17;c.RGBAFormat=18;c.LuminanceFormat=19;c.LuminanceAlphaFormat=20;c.DataTexture=function(e,g,f,h,s,r,q,a,b){c.Texture.call(this,null,s,r,q,a,b);this.image={data:e,width:g,height:f};this.format=h!==void 0?h:c.RGBAFormat};c.DataTexture.prototype=new c.Texture;c.DataTexture.prototype.constructor=c.DataTexture;c.DataTexture.prototype.clone=function(){var a=new c.DataTexture(this.data.slice(0),this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter);a.offset.copy(this.offset);a.repeat.copy(this.repeat);return a};c.Particle=function(a){c.Object3D.call(this);this.material=a};c.Particle.prototype=new c.Object3D;c.Particle.prototype.constructor=c.Particle;c.ParticleSystem=function(b,a){c.Object3D.call(this);this.geometry=b;this.material=a;this.sortParticles=!1};c.ParticleSystem.prototype=new c.Object3D;c.ParticleSystem.prototype.constructor=c.ParticleSystem;c.Line=function(f,b,a){c.Object3D.call(this);this.geometry=f;this.material=b;this.type=a!==void 0?a:c.LineStrip;this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere())};c.LineStrip=0;c.LinePieces=1;c.Line.prototype=new c.Object3D;c.Line.prototype.constructor=c.Line;c.Mesh=function(f,b){c.Object3D.call(this);this.geometry=f;this.material=b;if(b instanceof Array){console.warn("DEPRECATED: Mesh material can no longer be an Array. Using material at index 0..."),this.material=b[0]}if(this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere(),this.boundRadius=f.boundingSphere.radius,this.geometry.morphTargets.length)){this.morphTargetBase=-1;this.morphTargetForcedOrder=[];this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var a=0;a<this.geometry.morphTargets.length;a++){this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[a].name]=a}}};c.Mesh.prototype=new c.Object3D;c.Mesh.prototype.constructor=c.Mesh;c.Mesh.prototype.supr=c.Object3D.prototype;c.Mesh.prototype.getMorphTargetIndexByName=function(a){if(this.morphTargetDictionary[a]!==void 0){return this.morphTargetDictionary[a]}console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+a+" does not exist. Returning 0.");return 0};c.Bone=function(a){c.Object3D.call(this);this.skin=a;this.skinMatrix=new c.Matrix4};c.Bone.prototype=new c.Object3D;c.Bone.prototype.constructor=c.Bone;c.Bone.prototype.supr=c.Object3D.prototype;c.Bone.prototype.update=function(a,g){this.matrixAutoUpdate&&(g|=this.updateMatrix());if(g||this.matrixWorldNeedsUpdate){a?this.skinMatrix.multiply(a,this.matrix):this.skinMatrix.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,g=!0}var b,h=this.children.length;for(b=0;b<h;b++){this.children[b].update(this.skinMatrix,g)}};c.SkinnedMesh=function(a,g){c.Mesh.call(this,a,g);this.identityMatrix=new c.Matrix4;this.bones=[];this.boneMatrices=[];var e,b,p,h,f,o;if(this.geometry.bones!==void 0){for(e=0;e<this.geometry.bones.length;e++){p=this.geometry.bones[e],h=p.pos,f=p.rotq,o=p.scl,b=this.addBone(),b.name=p.name,b.position.set(h[0],h[1],h[2]),b.quaternion.set(f[0],f[1],f[2],f[3]),b.useQuaternion=!0,o!==void 0?b.scale.set(o[0],o[1],o[2]):b.scale.set(1,1,1)}for(e=0;e<this.bones.length;e++){p=this.geometry.bones[e],b=this.bones[e],p.parent===-1?this.add(b):this.bones[p.parent].add(b)}this.boneMatrices=new Float32Array(16*this.bones.length);this.pose()}};c.SkinnedMesh.prototype=new c.Mesh;c.SkinnedMesh.prototype.constructor=c.SkinnedMesh;c.SkinnedMesh.prototype.addBone=function(a){a===void 0&&(a=new c.Bone(this));this.bones.push(a);return a};c.SkinnedMesh.prototype.updateMatrixWorld=function(a){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||a){this.parent?this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1}for(var a=0,g=this.children.length;a<g;a++){var b=this.children[a];b instanceof c.Bone?b.update(this.identityMatrix,!1):b.updateMatrixWorld(!0)}for(var g=this.bones.length,b=this.bones,h=this.boneMatrices,a=0;a<g;a++){b[a].skinMatrix.flattenToArrayOffset(h,a*16)}};c.SkinnedMesh.prototype.pose=function(){this.updateMatrixWorld(!0);for(var k,g=[],a=0;a<this.bones.length;a++){k=this.bones[a];var l=new c.Matrix4;l.getInverse(k.skinMatrix);g.push(l);k.skinMatrix.flattenToArrayOffset(this.boneMatrices,a*16)}if(this.geometry.skinVerticesA===void 0){this.geometry.skinVerticesA=[];this.geometry.skinVerticesB=[];for(k=0;k<this.geometry.skinIndices.length;k++){var a=this.geometry.vertices[k].position,f=this.geometry.skinIndices[k].x,b=this.geometry.skinIndices[k].y,l=new c.Vector3(a.x,a.y,a.z);this.geometry.skinVerticesA.push(g[f].multiplyVector3(l));l=new c.Vector3(a.x,a.y,a.z);this.geometry.skinVerticesB.push(g[b].multiplyVector3(l));this.geometry.skinWeights[k].x+this.geometry.skinWeights[k].y!==1&&(a=(1-(this.geometry.skinWeights[k].x+this.geometry.skinWeights[k].y))*0.5,this.geometry.skinWeights[k].x+=a,this.geometry.skinWeights[k].y+=a)}}};c.MorphAnimMesh=function(b,a){c.Mesh.call(this,b,a);this.duration=1000;this.mirroredLoop=!1;this.currentKeyframe=this.lastKeyframe=this.time=0;this.direction=1;this.directionBackwards=!1};c.MorphAnimMesh.prototype=new c.Mesh;c.MorphAnimMesh.prototype.constructor=c.MorphAnimMesh;c.MorphAnimMesh.prototype.updateAnimation=function(b){var a=this.duration/(this.geometry.morphTargets.length-1);this.time+=this.direction*b;if(this.mirroredLoop){if(this.time>this.duration||this.time<0){this.direction*=-1;if(this.time>this.duration){this.time=this.duration,this.directionBackwards=!0}if(this.time<0){this.time=0,this.directionBackwards=!1}}}else{this.time%=this.duration}b=c.Math.clamp(Math.floor(this.time/a),0,this.geometry.morphTargets.length-1);if(b!=this.currentKeyframe){this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[b]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=b}a=this.time%a/a;this.directionBackwards&&(a=1-a);this.morphTargetInfluences[this.currentKeyframe]=a;this.morphTargetInfluences[this.lastKeyframe]=1-a};c.Ribbon=function(b,a){c.Object3D.call(this);this.geometry=b;this.material=a};c.Ribbon.prototype=new c.Object3D;c.Ribbon.prototype.constructor=c.Ribbon;c.LOD=function(){c.Object3D.call(this);this.LODs=[]};c.LOD.prototype=new c.Object3D;c.LOD.prototype.constructor=c.LOD;c.LOD.prototype.supr=c.Object3D.prototype;c.LOD.prototype.addLevel=function(f,b){b===void 0&&(b=0);for(var b=Math.abs(b),a=0;a<this.LODs.length;a++){if(b<this.LODs[a].visibleAtDistance){break}}this.LODs.splice(a,0,{visibleAtDistance:b,object3D:f});this.add(f)};c.LOD.prototype.update=function(b){if(this.LODs.length>1){b.matrixWorldInverse.getInverse(b.matrixWorld);b=b.matrixWorldInverse;b=-(b.n31*this.position.x+b.n32*this.position.y+b.n33*this.position.z+b.n34);this.LODs[0].object3D.visible=!0;for(var a=1;a<this.LODs.length;a++){if(b>=this.LODs[a].visibleAtDistance){this.LODs[a-1].object3D.visible=!1,this.LODs[a].object3D.visible=!0}else{break}}for(;a<this.LODs.length;a++){this.LODs[a].object3D.visible=!1}}};c.Sprite=function(a){c.Object3D.call(this);this.color=a.color!==void 0?new c.Color(a.color):new c.Color(16777215);this.map=a.map instanceof c.Texture?a.map:c.ImageUtils.loadTexture(a.map);this.blending=a.blending!==void 0?a.blending:c.NormalBlending;this.useScreenCoordinates=a.useScreenCoordinates!==void 0?a.useScreenCoordinates:!0;this.mergeWith3D=a.mergeWith3D!==void 0?a.mergeWith3D:!this.useScreenCoordinates;this.affectedByDistance=a.affectedByDistance!==void 0?a.affectedByDistance:!this.useScreenCoordinates;this.scaleByViewport=a.scaleByViewport!==void 0?a.scaleByViewport:!this.affectedByDistance;this.alignment=a.alignment instanceof c.Vector2?a.alignment:c.SpriteAlignment.center;this.rotation3d=this.rotation;this.rotation=0;this.opacity=1;this.uvOffset=new c.Vector2(0,0);this.uvScale=new c.Vector2(1,1)};c.Sprite.prototype=new c.Object3D;c.Sprite.prototype.constructor=c.Sprite;c.Sprite.prototype.updateMatrix=function(){this.matrix.setPosition(this.position);this.rotation3d.set(0,0,this.rotation);this.matrix.setRotationFromEuler(this.rotation3d);if(this.scale.x!==1||this.scale.y!==1){this.matrix.scale(this.scale),this.boundRadiusScale=Math.max(this.scale.x,this.scale.y)}this.matrixWorldNeedsUpdate=!0};c.SpriteAlignment={};c.SpriteAlignment.topLeft=new c.Vector2(1,-1);c.SpriteAlignment.topCenter=new c.Vector2(0,-1);c.SpriteAlignment.topRight=new c.Vector2(-1,-1);c.SpriteAlignment.centerLeft=new c.Vector2(1,0);c.SpriteAlignment.center=new c.Vector2(0,0);c.SpriteAlignment.centerRight=new c.Vector2(-1,0);c.SpriteAlignment.bottomLeft=new c.Vector2(1,1);c.SpriteAlignment.bottomCenter=new c.Vector2(0,1);c.SpriteAlignment.bottomRight=new c.Vector2(-1,1);c.Scene=function(){c.Object3D.call(this);this.overrideMaterial=this.fog=null;this.matrixAutoUpdate=!1;this.objects=[];this.lights=[];this.__objectsAdded=[];this.__objectsRemoved=[]};c.Scene.prototype=new c.Object3D;c.Scene.prototype.constructor=c.Scene;c.Scene.prototype.addObject=function(b){if(b instanceof c.Light){this.lights.indexOf(b)===-1&&this.lights.push(b)}else{if(!(b instanceof c.Camera||b instanceof c.Bone)&&this.objects.indexOf(b)===-1){this.objects.push(b);this.__objectsAdded.push(b);var a=this.__objectsRemoved.indexOf(b);a!==-1&&this.__objectsRemoved.splice(a,1)}}for(a=0;a<b.children.length;a++){this.addObject(b.children[a])}};c.Scene.prototype.removeObject=function(b){if(b instanceof c.Light){var a=this.lights.indexOf(b);a!==-1&&this.lights.splice(a,1)}else{b instanceof c.Camera||(a=this.objects.indexOf(b),a!==-1&&(this.objects.splice(a,1),this.__objectsRemoved.push(b),a=this.__objectsAdded.indexOf(b),a!==-1&&this.__objectsAdded.splice(a,1)))}for(a=0;a<b.children.length;a++){this.removeObject(b.children[a])}};c.Fog=function(f,b,a){this.color=new c.Color(f);this.near=b!==void 0?b:1;this.far=a!==void 0?a:1000};c.FogExp2=function(b,a){this.color=new c.Color(b);this.density=a!==void 0?a:0.00025};c.DOMRenderer=function(){c.Renderer.call(this);var k=null,g=new c.Projector,a,l,f,b;this.domElement=document.createElement("div");this.setSize=function(h,e){a=h;l=e;f=a/2;b=l/2};this.render=function(e,h){var j,p,o,y,z,r,A,x;k=g.projectScene(e,h);j=0;for(p=k.length;j<p;j++){if(z=k[j],z instanceof c.RenderableParticle){A=z.x*f+f;x=z.y*b+b;o=0;for(y=z.material.length;o<y;o++){if(r=z.material[o],r instanceof c.ParticleDOMMaterial){r=r.domElement,r.style.left=A+"px",r.style.top=x+"px"}}}}}};c.CanvasRenderer=function(h){function m(z){if(av!=z){s.globalAlpha=av=z}}function k(z){if(J!=z){switch(z){case c.NormalBlending:s.globalCompositeOperation="source-over";break;case c.AdditiveBlending:s.globalCompositeOperation="lighter";break;case c.SubtractiveBlending:s.globalCompositeOperation="darker"}J=z}}function o(z){if(v!=z){s.strokeStyle=v=z}}function r(z){if(B!=z){s.fillStyle=B=z}}var q=this,p,ap,aq,L=new c.Projector,h=h||{},at=h.canvas!==void 0?h.canvas:document.createElement("canvas"),t,x,j,E,s=at.getContext("2d"),A=new c.Color(0),I=0,av=1,J=0,v=null,B=null,u=null,aw=null,ax=null,au,ab,G,y,O=new c.RenderableVertex,R=new c.RenderableVertex,aV,Z,X,al,H,F,M,V,P,Y,T,ar,U=new c.Color,S=new c.Color,aS=new c.Color,ak=new c.Color,ah=new c.Color,g=[],ad=[],K,w,n,az,ao,am,af,aj,a,f,aa=new c.Rectangle,b=new c.Rectangle,N=new c.Rectangle,W=!1,l=new c.Color,ae=new c.Color,ai=new c.Color,ag=new c.Vector3,e,ac,ay,an,Q,aT,h=16;e=document.createElement("canvas");e.width=e.height=2;ac=e.getContext("2d");ac.fillStyle="rgba(0,0,0,1)";ac.fillRect(0,0,2,2);ay=ac.getImageData(0,0,2,2);an=ay.data;Q=document.createElement("canvas");Q.width=Q.height=h;aT=Q.getContext("2d");aT.translate(-h/2,-h/2);aT.scale(h,h);h--;this.domElement=at;this.sortElements=this.sortObjects=this.autoClear=!0;this.info={render:{vertices:0,faces:0}};this.setSize=function(z,C){t=z;x=C;j=Math.floor(t/2);E=Math.floor(x/2);at.width=t;at.height=x;aa.set(-j,-E,j,E);b.set(-j,-E,j,E);av=1;J=0;ax=aw=u=B=v=null};this.setClearColor=function(z,C){A.copy(z);I=C;b.set(-j,-E,j,E)};this.setClearColorHex=function(z,C){A.setHex(z);I=C;b.set(-j,-E,j,E)};this.clear=function(){s.setTransform(1,0,0,-1,j,E);b.isEmpty()||(b.minSelf(aa),b.inflate(2),I<1&&s.clearRect(Math.floor(b.getX()),Math.floor(b.getY()),Math.floor(b.getWidth()),Math.floor(b.getHeight())),I>0&&(k(c.NormalBlending),m(1),r("rgba("+Math.floor(A.r*255)+","+Math.floor(A.g*255)+","+Math.floor(A.b*255)+","+I+")"),s.fillRect(Math.floor(b.getX()),Math.floor(b.getY()),Math.floor(b.getWidth()),Math.floor(b.getHeight()))),b.empty())};this.render=function(aK,aF){function aG(a0){var aW,aX,aY,aZ;l.setRGB(0,0,0);ae.setRGB(0,0,0);ai.setRGB(0,0,0);aW=0;for(aX=a0.length;aW<aX;aW++){aY=a0[aW],aZ=aY.color,aY instanceof c.AmbientLight?(l.r+=aZ.r,l.g+=aZ.g,l.b+=aZ.b):aY instanceof c.DirectionalLight?(ae.r+=aZ.r,ae.g+=aZ.g,ae.b+=aZ.b):aY instanceof c.PointLight&&(ai.r+=aZ.r,ai.g+=aZ.g,ai.b+=aZ.b)}}function D(a3,aW,a0,a4){var aY,aX,a5,a2,aZ,a1;aY=0;for(aX=a3.length;aY<aX;aY++){a5=a3[aY],a2=a5.color,a5 instanceof c.DirectionalLight?(aZ=a5.matrixWorld.getPosition(),a1=a0.dot(aZ),a1<=0||(a1*=a5.intensity,a4.r+=a2.r*a1,a4.g+=a2.g*a1,a4.b+=a2.b*a1)):a5 instanceof c.PointLight&&(aZ=a5.matrixWorld.getPosition(),a1=a0.dot(ag.sub(aZ,aW).normalize()),a1<=0||(a1*=a5.distance==0?1:1-Math.min(aW.distanceTo(aZ)/a5.distance,1),a1!=0&&(a1*=a5.intensity,a4.r+=a2.r*a1,a4.g+=a2.g*a1,a4.b+=a2.b*a1)))}}function aA(a1,aY,a4){m(a4.opacity);k(a4.blending);var aW,a2,a3,aX,aZ,a0;if(a4 instanceof c.ParticleBasicMaterial){if(a4.map){aX=a4.map.image,aZ=aX.width>>1,a0=aX.height>>1,a4=aY.scale.x*j,a3=aY.scale.y*E,aW=a4*aZ,a2=a3*a0,N.set(a1.x-aW,a1.y-a2,a1.x+aW,a1.y+a2),aa.intersects(N)&&(s.save(),s.translate(a1.x,a1.y),s.rotate(-aY.rotation),s.scale(a4,-a3),s.translate(-aZ,-a0),s.drawImage(aX,0,0),s.restore())}}else{a4 instanceof c.ParticleCanvasMaterial&&(aW=aY.scale.x*j,a2=aY.scale.y*E,N.set(a1.x-aW,a1.y-a2,a1.x+aW,a1.y+a2),aa.intersects(N)&&(o(a4.color.getContextStyle()),r(a4.color.getContextStyle()),s.save(),s.translate(a1.x,a1.y),s.rotate(-aY.rotation),s.scale(aW,a2),a4.program(s),s.restore()))}}function aH(aW,aZ,aY,aX){m(aX.opacity);k(aX.blending);s.beginPath();s.moveTo(aW.positionScreen.x,aW.positionScreen.y);s.lineTo(aZ.positionScreen.x,aZ.positionScreen.y);s.closePath();if(aX instanceof c.LineBasicMaterial){aW=aX.linewidth;if(u!=aW){s.lineWidth=u=aW}aW=aX.linecap;if(aw!=aW){s.lineCap=aw=aW}aW=aX.linejoin;if(ax!=aW){s.lineJoin=ax=aW}o(aX.color.getContextStyle());s.stroke();N.inflate(aX.linewidth*2)}}function aM(a2,aW,aZ,aY,a1,a0,aX,a3){q.info.render.vertices+=3;q.info.render.faces++;m(a3.opacity);k(a3.blending);aV=a2.positionScreen.x;Z=a2.positionScreen.y;X=aW.positionScreen.x;al=aW.positionScreen.y;H=aZ.positionScreen.x;F=aZ.positionScreen.y;aR(aV,Z,X,al,H,F);if(a3 instanceof c.MeshBasicMaterial){if(a3.map){a3.map.mapping instanceof c.UVMapping&&(az=aX.uvs[0],aL(aV,Z,X,al,H,F,az[aY].u,az[aY].v,az[a1].u,az[a1].v,az[a0].u,az[a0].v,a3.map))}else{if(a3.envMap){if(a3.envMap.mapping instanceof c.SphericalReflectionMapping){a2=aF.matrixWorldInverse,ag.copy(aX.vertexNormalsWorld[aY]),ao=(ag.x*a2.n11+ag.y*a2.n12+ag.z*a2.n13)*0.5+0.5,am=-(ag.x*a2.n21+ag.y*a2.n22+ag.z*a2.n23)*0.5+0.5,ag.copy(aX.vertexNormalsWorld[a1]),af=(ag.x*a2.n11+ag.y*a2.n12+ag.z*a2.n13)*0.5+0.5,aj=-(ag.x*a2.n21+ag.y*a2.n22+ag.z*a2.n23)*0.5+0.5,ag.copy(aX.vertexNormalsWorld[a0]),a=(ag.x*a2.n11+ag.y*a2.n12+ag.z*a2.n13)*0.5+0.5,f=-(ag.x*a2.n21+ag.y*a2.n22+ag.z*a2.n23)*0.5+0.5,aL(aV,Z,X,al,H,F,ao,am,af,aj,a,f,a3.envMap)}}else{a3.wireframe?aI(a3.color,a3.wireframeLinewidth,a3.wireframeLinecap,a3.wireframeLinejoin):aB(a3.color)}}}else{if(a3 instanceof c.MeshLambertMaterial){a3.map&&!a3.wireframe&&(a3.map.mapping instanceof c.UVMapping&&(az=aX.uvs[0],aL(aV,Z,X,al,H,F,az[aY].u,az[aY].v,az[a1].u,az[a1].v,az[a0].u,az[a0].v,a3.map)),k(c.SubtractiveBlending)),W?!a3.wireframe&&a3.shading==c.SmoothShading&&aX.vertexNormalsWorld.length==3?(S.r=aS.r=ak.r=l.r,S.g=aS.g=ak.g=l.g,S.b=aS.b=ak.b=l.b,D(aq,aX.v1.positionWorld,aX.vertexNormalsWorld[0],S),D(aq,aX.v2.positionWorld,aX.vertexNormalsWorld[1],aS),D(aq,aX.v3.positionWorld,aX.vertexNormalsWorld[2],ak),S.r=Math.max(0,Math.min(a3.color.r*S.r,1)),S.g=Math.max(0,Math.min(a3.color.g*S.g,1)),S.b=Math.max(0,Math.min(a3.color.b*S.b,1)),aS.r=Math.max(0,Math.min(a3.color.r*aS.r,1)),aS.g=Math.max(0,Math.min(a3.color.g*aS.g,1)),aS.b=Math.max(0,Math.min(a3.color.b*aS.b,1)),ak.r=Math.max(0,Math.min(a3.color.r*ak.r,1)),ak.g=Math.max(0,Math.min(a3.color.g*ak.g,1)),ak.b=Math.max(0,Math.min(a3.color.b*ak.b,1)),ah.r=(aS.r+ak.r)*0.5,ah.g=(aS.g+ak.g)*0.5,ah.b=(aS.b+ak.b)*0.5,n=aN(S,aS,ak,ah),C(aV,Z,X,al,H,F,0,0,1,0,0,1,n)):(U.r=l.r,U.g=l.g,U.b=l.b,D(aq,aX.centroidWorld,aX.normalWorld,U),U.r=Math.max(0,Math.min(a3.color.r*U.r,1)),U.g=Math.max(0,Math.min(a3.color.g*U.g,1)),U.b=Math.max(0,Math.min(a3.color.b*U.b,1)),a3.wireframe?aI(U,a3.wireframeLinewidth,a3.wireframeLinecap,a3.wireframeLinejoin):aB(U)):a3.wireframe?aI(a3.color,a3.wireframeLinewidth,a3.wireframeLinecap,a3.wireframeLinejoin):aB(a3.color)}else{if(a3 instanceof c.MeshDepthMaterial){K=aF.near,w=aF.far,S.r=S.g=S.b=1-aD(a2.positionScreen.z,K,w),aS.r=aS.g=aS.b=1-aD(aW.positionScreen.z,K,w),ak.r=ak.g=ak.b=1-aD(aZ.positionScreen.z,K,w),ah.r=(aS.r+ak.r)*0.5,ah.g=(aS.g+ak.g)*0.5,ah.b=(aS.b+ak.b)*0.5,n=aN(S,aS,ak,ah),C(aV,Z,X,al,H,F,0,0,1,0,0,1,n)}else{if(a3 instanceof c.MeshNormalMaterial){U.r=aJ(aX.normalWorld.x),U.g=aJ(aX.normalWorld.y),U.b=aJ(aX.normalWorld.z),a3.wireframe?aI(U,a3.wireframeLinewidth,a3.wireframeLinecap,a3.wireframeLinejoin):aB(U)}}}}}function aP(a1,a4,a2,aY,a3,aZ,aX,aW,a0){q.info.render.vertices+=4;q.info.render.faces++;m(aW.opacity);k(aW.blending);if(aW.map||aW.envMap){aM(a1,a4,aY,0,1,3,aX,aW,a0),aM(a3,a2,aZ,1,2,3,aX,aW,a0)}else{if(aV=a1.positionScreen.x,Z=a1.positionScreen.y,X=a4.positionScreen.x,al=a4.positionScreen.y,H=a2.positionScreen.x,F=a2.positionScreen.y,M=aY.positionScreen.x,V=aY.positionScreen.y,P=a3.positionScreen.x,Y=a3.positionScreen.y,T=aZ.positionScreen.x,ar=aZ.positionScreen.y,aW instanceof c.MeshBasicMaterial){z(aV,Z,X,al,H,F,M,V),aW.wireframe?aI(aW.color,aW.wireframeLinewidth,aW.wireframeLinecap,aW.wireframeLinejoin):aB(aW.color)}else{if(aW instanceof c.MeshLambertMaterial){W?!aW.wireframe&&aW.shading==c.SmoothShading&&aX.vertexNormalsWorld.length==4?(S.r=aS.r=ak.r=ah.r=l.r,S.g=aS.g=ak.g=ah.g=l.g,S.b=aS.b=ak.b=ah.b=l.b,D(aq,aX.v1.positionWorld,aX.vertexNormalsWorld[0],S),D(aq,aX.v2.positionWorld,aX.vertexNormalsWorld[1],aS),D(aq,aX.v4.positionWorld,aX.vertexNormalsWorld[3],ak),D(aq,aX.v3.positionWorld,aX.vertexNormalsWorld[2],ah),S.r=Math.max(0,Math.min(aW.color.r*S.r,1)),S.g=Math.max(0,Math.min(aW.color.g*S.g,1)),S.b=Math.max(0,Math.min(aW.color.b*S.b,1)),aS.r=Math.max(0,Math.min(aW.color.r*aS.r,1)),aS.g=Math.max(0,Math.min(aW.color.g*aS.g,1)),aS.b=Math.max(0,Math.min(aW.color.b*aS.b,1)),ak.r=Math.max(0,Math.min(aW.color.r*ak.r,1)),ak.g=Math.max(0,Math.min(aW.color.g*ak.g,1)),ak.b=Math.max(0,Math.min(aW.color.b*ak.b,1)),ah.r=Math.max(0,Math.min(aW.color.r*ah.r,1)),ah.g=Math.max(0,Math.min(aW.color.g*ah.g,1)),ah.b=Math.max(0,Math.min(aW.color.b*ah.b,1)),n=aN(S,aS,ak,ah),aR(aV,Z,X,al,M,V),C(aV,Z,X,al,M,V,0,0,1,0,0,1,n),aR(P,Y,H,F,T,ar),C(P,Y,H,F,T,ar,1,0,1,1,0,1,n)):(U.r=l.r,U.g=l.g,U.b=l.b,D(aq,aX.centroidWorld,aX.normalWorld,U),U.r=Math.max(0,Math.min(aW.color.r*U.r,1)),U.g=Math.max(0,Math.min(aW.color.g*U.g,1)),U.b=Math.max(0,Math.min(aW.color.b*U.b,1)),z(aV,Z,X,al,H,F,M,V),aW.wireframe?aI(U,aW.wireframeLinewidth,aW.wireframeLinecap,aW.wireframeLinejoin):aB(U)):(z(aV,Z,X,al,H,F,M,V),aW.wireframe?aI(aW.color,aW.wireframeLinewidth,aW.wireframeLinecap,aW.wireframeLinejoin):aB(aW.color))}else{if(aW instanceof c.MeshNormalMaterial){U.r=aJ(aX.normalWorld.x),U.g=aJ(aX.normalWorld.y),U.b=aJ(aX.normalWorld.z),z(aV,Z,X,al,H,F,M,V),aW.wireframe?aI(U,aW.wireframeLinewidth,aW.wireframeLinecap,aW.wireframeLinejoin):aB(U)}else{if(aW instanceof c.MeshDepthMaterial){K=aF.near,w=aF.far,S.r=S.g=S.b=1-aD(a1.positionScreen.z,K,w),aS.r=aS.g=aS.b=1-aD(a4.positionScreen.z,K,w),ak.r=ak.g=ak.b=1-aD(aY.positionScreen.z,K,w),ah.r=ah.g=ah.b=1-aD(a2.positionScreen.z,K,w),n=aN(S,aS,ak,ah),aR(aV,Z,X,al,M,V),C(aV,Z,X,al,M,V,0,0,1,0,0,1,n),aR(P,Y,H,F,T,ar),C(P,Y,H,F,T,ar,1,0,1,1,0,1,n)}}}}}}function aR(a1,aW,aX,aY,a0,aZ){s.beginPath();s.moveTo(a1,aW);s.lineTo(aX,aY);s.lineTo(a0,aZ);s.lineTo(a1,aW);s.closePath()}function z(a2,aX,a3,aW,a0,aY,aZ,a1){s.beginPath();s.moveTo(a2,aX);s.lineTo(a3,aW);s.lineTo(a0,aY);s.lineTo(aZ,a1);s.lineTo(a2,aX);s.closePath()}function aI(aZ,aW,aX,aY){if(u!=aW){s.lineWidth=u=aW}if(aw!=aX){s.lineCap=aw=aX}if(ax!=aY){s.lineJoin=ax=aY}o(aZ.getContextStyle());s.stroke();N.inflate(aW*2)}function aB(aW){r(aW.getContextStyle());s.fill()}function aL(a6,a7,a8,ba,bb,bc,aY,aW,aX,a4,aZ,a0,a5){if(a5.image.width!=0){if(a5.needsUpdate==!0||g[a5.id]==void 0){var a1=a5.wrapS==c.RepeatWrapping,a2=a5.wrapT==c.RepeatWrapping;g[a5.id]=s.createPattern(a5.image,a1&&a2?"repeat":a1&&!a2?"repeat-x":!a1&&a2?"repeat-y":"no-repeat");a5.needsUpdate=!1}r(g[a5.id]);var a1=a5.offset.x/a5.repeat.x,a2=a5.offset.y/a5.repeat.y,a9=a5.image.width*a5.repeat.x,a3=a5.image.height*a5.repeat.y,aY=(aY+a1)*a9,aW=(aW+a2)*a3,aX=(aX+a1)*a9,a4=(a4+a2)*a3,aZ=(aZ+a1)*a9,a0=(a0+a2)*a3;a8-=a6;ba-=a7;bb-=a6;bc-=a7;aX-=aY;a4-=aW;aZ-=aY;a0-=aW;a1=aX*a0-aZ*a4;if(a1==0){if(ad[a5.id]==void 0){a7=document.createElement("canvas"),a7.width=a5.image.width,a7.height=a5.image.height,a6=a7.getContext("2d"),a6.drawImage(a5.image,0,0),ad[a5.id]=a6.getImageData(0,0,a5.image.width,a5.image.height).data,delete a7}a7=ad[a5.id];aY=(Math.floor(aY)+Math.floor(aW)*a5.image.width)*4;U.setRGB(a7[aY]/255,a7[aY+1]/255,a7[aY+2]/255);aB(U)}else{a1=1/a1,a5=(a0*a8-a4*bb)*a1,a4=(a0*ba-a4*bc)*a1,a8=(aX*bb-aZ*a8)*a1,ba=(aX*bc-aZ*ba)*a1,a6=a6-a5*aY-a8*aW,aY=a7-a4*aY-ba*aW,s.save(),s.transform(a5,a4,a8,ba,a6,aY),s.fill(),s.restore()}}}function C(a6,a7,a8,a9,aX,ba,aW,a5,aY,a2,a1,aZ,a0){var a3,a4;a3=a0.width-1;a4=a0.height-1;aW*=a3;a5*=a4;aY*=a3;a2*=a4;a1*=a3;aZ*=a4;a8-=a6;a9-=a7;aX-=a6;ba-=a7;aY-=aW;a2-=a5;a1-=aW;aZ-=a5;a4=1/(aY*aZ-a1*a2);a3=(aZ*a8-a2*aX)*a4;a2=(aZ*a9-a2*ba)*a4;a8=(aY*aX-a1*a8)*a4;a9=(aY*ba-a1*a9)*a4;a6=a6-a3*aW-a8*a5;a7=a7-a2*aW-a9*a5;s.save();s.transform(a3,a2,a8,a9,a6,a7);s.clip();s.drawImage(a0,0,0);s.restore()}function aN(a4,a5,a6,a7){var aW=~~(a4.r*255),aZ=~~(a4.g*255),a4=~~(a4.b*255),a2=~~(a5.r*255),a0=~~(a5.g*255),a5=~~(a5.b*255),aX=~~(a6.r*255),aY=~~(a6.g*255),a6=~~(a6.b*255),a3=~~(a7.r*255),a1=~~(a7.g*255),a7=~~(a7.b*255);an[0]=aW<0?0:aW>255?255:aW;an[1]=aZ<0?0:aZ>255?255:aZ;an[2]=a4<0?0:a4>255?255:a4;an[4]=a2<0?0:a2>255?255:a2;an[5]=a0<0?0:a0>255?255:a0;an[6]=a5<0?0:a5>255?255:a5;an[8]=aX<0?0:aX>255?255:aX;an[9]=aY<0?0:aY>255?255:aY;an[10]=a6<0?0:a6>255?255:a6;an[12]=a3<0?0:a3>255?255:a3;an[13]=a1<0?0:a1>255?255:a1;an[14]=a7<0?0:a7>255?255:a7;ac.putImageData(ay,0,0);aT.drawImage(e,0,0);return Q}function aD(aY,aW,aX){aY=(aY-aW)/(aX-aW);return aY*aY*(3-2*aY)}function aJ(aW){aW=(aW+1)*0.5;return aW<0?0:aW>1?1:aW}function aO(a0,aW){var aX=aW.x-a0.x,aY=aW.y-a0.y,aZ=aX*aX+aY*aY;aZ!=0&&(aZ=1/Math.sqrt(aZ),aX*=aZ,aY*=aZ,aW.x+=aX,aW.y+=aY,a0.x-=aX,a0.y-=aY)}var aQ,aC,aU,aE;this.autoClear?this.clear():s.setTransform(1,0,0,-1,j,E);q.info.render.vertices=0;q.info.render.faces=0;p=L.projectScene(aK,aF,this.sortElements);ap=p.elements;aq=p.lights;(W=aq.length>0)&&aG(aq);aQ=0;for(aC=ap.length;aQ<aC;aQ++){if(aU=ap[aQ],aE=aU.material,aE=aE instanceof c.MeshFaceMaterial?aU.faceMaterial:aE,!(aE==null||aE.opacity==0)){N.empty();if(aU instanceof c.RenderableParticle){au=aU,au.x*=j,au.y*=E,aA(au,aU,aE,aK)}else{if(aU instanceof c.RenderableLine){au=aU.v1,ab=aU.v2,au.positionScreen.x*=j,au.positionScreen.y*=E,ab.positionScreen.x*=j,ab.positionScreen.y*=E,N.addPoint(au.positionScreen.x,au.positionScreen.y),N.addPoint(ab.positionScreen.x,ab.positionScreen.y),aa.intersects(N)&&aH(au,ab,aU,aE,aK)}else{if(aU instanceof c.RenderableFace3){au=aU.v1,ab=aU.v2,G=aU.v3,au.positionScreen.x*=j,au.positionScreen.y*=E,ab.positionScreen.x*=j,ab.positionScreen.y*=E,G.positionScreen.x*=j,G.positionScreen.y*=E,aE.overdraw&&(aO(au.positionScreen,ab.positionScreen),aO(ab.positionScreen,G.positionScreen),aO(G.positionScreen,au.positionScreen)),N.add3Points(au.positionScreen.x,au.positionScreen.y,ab.positionScreen.x,ab.positionScreen.y,G.positionScreen.x,G.positionScreen.y),aa.intersects(N)&&aM(au,ab,G,0,1,2,aU,aE,aK)}else{if(aU instanceof c.RenderableFace4){au=aU.v1,ab=aU.v2,G=aU.v3,y=aU.v4,au.positionScreen.x*=j,au.positionScreen.y*=E,ab.positionScreen.x*=j,ab.positionScreen.y*=E,G.positionScreen.x*=j,G.positionScreen.y*=E,y.positionScreen.x*=j,y.positionScreen.y*=E,O.positionScreen.copy(ab.positionScreen),R.positionScreen.copy(y.positionScreen),aE.overdraw&&(aO(au.positionScreen,ab.positionScreen),aO(ab.positionScreen,y.positionScreen),aO(y.positionScreen,au.positionScreen),aO(G.positionScreen,O.positionScreen),aO(G.positionScreen,R.positionScreen)),N.addPoint(au.positionScreen.x,au.positionScreen.y),N.addPoint(ab.positionScreen.x,ab.positionScreen.y),N.addPoint(G.positionScreen.x,G.positionScreen.y),N.addPoint(y.positionScreen.x,y.positionScreen.y),aa.intersects(N)&&aP(au,ab,G,y,O,R,aU,aE,aK)}}}}b.addRectangle(N)}}s.setTransform(1,0,0,1,0,0)}};c.SVGRenderer=function(){function u(D,H,I,L){var N,G,M,j,z,C;N=0;for(G=D.length;N<G;N++){M=D[N],j=M.color,M instanceof c.DirectionalLight?(z=M.matrixWorld.getPosition(),C=I.dot(z),C<=0||(C*=M.intensity,L.r+=j.r*C,L.g+=j.g*C,L.b+=j.b*C)):M instanceof c.PointLight&&(z=M.matrixWorld.getPosition(),C=I.dot(h.sub(z,H).normalize()),C<=0||(C*=M.distance==0?1:1-Math.min(H.distanceTo(z)/M.distance,1),C!=0&&(C*=M.intensity,L.r+=j.r*C,L.g+=j.g*C,L.b+=j.b*C)))}}function g(j){s[j]==null&&(s[j]=document.createElementNS("http://www.w3.org/2000/svg","path"),t==0&&s[j].setAttribute("shape-rendering","crispEdges"));return s[j]}function w(j){j=(j+1)*0.5;return j<0?0:j>1?1:j}var k=this,r,q,o,A=new c.Projector,U=document.createElementNS("http://www.w3.org/2000/svg","svg"),B,ac,y,F,E,ad,x,K,a=new c.Rectangle,m=new c.Rectangle,e=!1,R=new c.Color,f=new c.Color,J=new c.Color,n=new c.Color,p,h=new c.Vector3,s=[],ae=[],b,l,v,t=1;this.domElement=U;this.sortElements=this.sortObjects=this.autoClear=!0;this.info={render:{vertices:0,faces:0}};this.setQuality=function(j){switch(j){case"high":t=1;break;case"low":t=0}};this.setSize=function(z,j){B=z;ac=j;y=B/2;F=ac/2;U.setAttribute("viewBox",-y+" "+-F+" "+B+" "+ac);U.setAttribute("width",B);U.setAttribute("height",ac);a.set(-y,-F,y,F)};this.clear=function(){for(;U.childNodes.length>0;){U.removeChild(U.childNodes[0])}};this.render=function(D,H){var N,G,L,M;this.autoClear&&this.clear();k.info.render.vertices=0;k.info.render.faces=0;r=A.projectScene(D,H,this.sortElements);q=r.elements;o=r.lights;v=l=0;if(e=o.length>0){f.setRGB(0,0,0);J.setRGB(0,0,0);n.setRGB(0,0,0);N=0;for(G=o.length;N<G;N++){M=o[N],L=M.color,M instanceof c.AmbientLight?(f.r+=L.r,f.g+=L.g,f.b+=L.b):M instanceof c.DirectionalLight?(J.r+=L.r,J.g+=L.g,J.b+=L.b):M instanceof c.PointLight&&(n.r+=L.r,n.g+=L.g,n.b+=L.b)}}N=0;for(G=q.length;N<G;N++){if(L=q[N],M=L.material,M=M instanceof c.MeshFaceMaterial?L.faceMaterial:M,!(M==null||M.opacity==0)){if(m.empty(),L instanceof c.RenderableParticle){E=L,E.x*=y,E.y*=-F}else{if(L instanceof c.RenderableLine){if(E=L.v1,ad=L.v2,E.positionScreen.x*=y,E.positionScreen.y*=-F,ad.positionScreen.x*=y,ad.positionScreen.y*=-F,m.addPoint(E.positionScreen.x,E.positionScreen.y),m.addPoint(ad.positionScreen.x,ad.positionScreen.y),a.intersects(m)){L=E;var z=ad,C=v++;ae[C]==null&&(ae[C]=document.createElementNS("http://www.w3.org/2000/svg","line"),t==0&&ae[C].setAttribute("shape-rendering","crispEdges"));b=ae[C];b.setAttribute("x1",L.positionScreen.x);b.setAttribute("y1",L.positionScreen.y);b.setAttribute("x2",z.positionScreen.x);b.setAttribute("y2",z.positionScreen.y);M instanceof c.LineBasicMaterial&&(b.setAttribute("style","fill: none; stroke: "+M.color.getContextStyle()+"; stroke-width: "+M.linewidth+"; stroke-opacity: "+M.opacity+"; stroke-linecap: "+M.linecap+"; stroke-linejoin: "+M.linejoin),U.appendChild(b))}}else{if(L instanceof c.RenderableFace3){if(E=L.v1,ad=L.v2,x=L.v3,E.positionScreen.x*=y,E.positionScreen.y*=-F,ad.positionScreen.x*=y,ad.positionScreen.y*=-F,x.positionScreen.x*=y,x.positionScreen.y*=-F,m.addPoint(E.positionScreen.x,E.positionScreen.y),m.addPoint(ad.positionScreen.x,ad.positionScreen.y),m.addPoint(x.positionScreen.x,x.positionScreen.y),a.intersects(m)){var z=E,C=ad,j=x;k.info.render.vertices+=3;k.info.render.faces++;b=g(l++);b.setAttribute("d","M "+z.positionScreen.x+" "+z.positionScreen.y+" L "+C.positionScreen.x+" "+C.positionScreen.y+" L "+j.positionScreen.x+","+j.positionScreen.y+"z");M instanceof c.MeshBasicMaterial?R.copy(M.color):M instanceof c.MeshLambertMaterial?e?(R.r=f.r,R.g=f.g,R.b=f.b,u(o,L.centroidWorld,L.normalWorld,R),R.r=Math.max(0,Math.min(M.color.r*R.r,1)),R.g=Math.max(0,Math.min(M.color.g*R.g,1)),R.b=Math.max(0,Math.min(M.color.b*R.b,1))):R.copy(M.color):M instanceof c.MeshDepthMaterial?(p=1-M.__2near/(M.__farPlusNear-L.z*M.__farMinusNear),R.setRGB(p,p,p)):M instanceof c.MeshNormalMaterial&&R.setRGB(w(L.normalWorld.x),w(L.normalWorld.y),w(L.normalWorld.z));M.wireframe?b.setAttribute("style","fill: none; stroke: "+R.getContextStyle()+"; stroke-width: "+M.wireframeLinewidth+"; stroke-opacity: "+M.opacity+"; stroke-linecap: "+M.wireframeLinecap+"; stroke-linejoin: "+M.wireframeLinejoin):b.setAttribute("style","fill: "+R.getContextStyle()+"; fill-opacity: "+M.opacity);U.appendChild(b)}}else{if(L instanceof c.RenderableFace4&&(E=L.v1,ad=L.v2,x=L.v3,K=L.v4,E.positionScreen.x*=y,E.positionScreen.y*=-F,ad.positionScreen.x*=y,ad.positionScreen.y*=-F,x.positionScreen.x*=y,x.positionScreen.y*=-F,K.positionScreen.x*=y,K.positionScreen.y*=-F,m.addPoint(E.positionScreen.x,E.positionScreen.y),m.addPoint(ad.positionScreen.x,ad.positionScreen.y),m.addPoint(x.positionScreen.x,x.positionScreen.y),m.addPoint(K.positionScreen.x,K.positionScreen.y),a.intersects(m))){var z=E,C=ad,j=x,I=K;k.info.render.vertices+=4;k.info.render.faces++;b=g(l++);b.setAttribute("d","M "+z.positionScreen.x+" "+z.positionScreen.y+" L "+C.positionScreen.x+" "+C.positionScreen.y+" L "+j.positionScreen.x+","+j.positionScreen.y+" L "+I.positionScreen.x+","+I.positionScreen.y+"z");M instanceof c.MeshBasicMaterial?R.copy(M.color):M instanceof c.MeshLambertMaterial?e?(R.r=f.r,R.g=f.g,R.b=f.b,u(o,L.centroidWorld,L.normalWorld,R),R.r=Math.max(0,Math.min(M.color.r*R.r,1)),R.g=Math.max(0,Math.min(M.color.g*R.g,1)),R.b=Math.max(0,Math.min(M.color.b*R.b,1))):R.copy(M.color):M instanceof c.MeshDepthMaterial?(p=1-M.__2near/(M.__farPlusNear-L.z*M.__farMinusNear),R.setRGB(p,p,p)):M instanceof c.MeshNormalMaterial&&R.setRGB(w(L.normalWorld.x),w(L.normalWorld.y),w(L.normalWorld.z));M.wireframe?b.setAttribute("style","fill: none; stroke: "+R.getContextStyle()+"; stroke-width: "+M.wireframeLinewidth+"; stroke-opacity: "+M.opacity+"; stroke-linecap: "+M.wireframeLinecap+"; stroke-linejoin: "+M.wireframeLinejoin):b.setAttribute("style","fill: "+R.getContextStyle()+"; fill-opacity: "+M.opacity);U.appendChild(b)}}}}}}}};c.ShaderChunk={fog_pars_fragment:"#ifdef USE_FOG\nuniform vec3 fogColor;\n#ifdef FOG_EXP2\nuniform float fogDensity;\n#else\nuniform float fogNear;\nuniform float fogFar;\n#endif\n#endif",fog_fragment:"#ifdef USE_FOG\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n#ifdef FOG_EXP2\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n#else\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n#endif\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float reflectivity;\nuniform samplerCube envMap;\nuniform float flipEnvMap;\nuniform int combine;\n#endif",envmap_fragment:"#ifdef USE_ENVMAP\nvec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * vReflect.x, vReflect.yz ) );\n#ifdef GAMMA_INPUT\ncubeColor.xyz *= cubeColor.xyz;\n#endif\nif ( combine == 1 ) {\ngl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, reflectivity );\n} else {\ngl_FragColor.xyz = gl_FragColor.xyz * cubeColor.xyz;\n}\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float refractionRatio;\nuniform bool useRefract;\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = mat3( objectMatrix[ 0 ].xyz, objectMatrix[ 1 ].xyz, objectMatrix[ 2 ].xyz ) * normal;\nif ( useRefract ) {\nvReflect = refract( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ), refractionRatio );\n} else {\nvReflect = reflect( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ) );\n}\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\nuniform sampler2D map;\n#endif",map_particle_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, gl_PointCoord );\n#endif",map_pars_vertex:"#ifdef USE_MAP\nvarying vec2 vUv;\nuniform vec4 offsetRepeat;\n#endif",map_pars_fragment:"#ifdef USE_MAP\nvarying vec2 vUv;\nuniform sampler2D map;\n#endif",map_vertex:"#ifdef USE_MAP\nvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",map_fragment:"#ifdef USE_MAP\n#ifdef GAMMA_INPUT\nvec4 texelColor = texture2D( map, vUv );\ntexelColor.xyz *= texelColor.xyz;\ngl_FragColor = gl_FragColor * texelColor;\n#else\ngl_FragColor = gl_FragColor * texture2D( map, vUv );\n#endif\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\nuniform sampler2D lightMap;\n#endif",lightmap_pars_vertex:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\ngl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n#endif",lightmap_vertex:"#ifdef USE_LIGHTMAP\nvUv2 = uv2;\n#endif",lights_lambert_pars_vertex:"uniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif",lights_lambert_vertex:"vLightWeighting = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nfloat directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ i ] * directionalLightWeighting;\n}\n#endif\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat pointLightWeighting = max( dot( transformedNormal, lVector ), 0.0 );\nvLightWeighting += pointLightColor[ i ] * pointLightWeighting * lDistance;\n}\n#endif\nvLightWeighting = vLightWeighting * diffuse + ambient * ambientLightColor;",lights_phong_pars_vertex:"#if MAX_POINT_LIGHTS > 0\n#ifndef PHONG_PER_PIXEL\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#endif",lights_phong_vertex:"#if MAX_POINT_LIGHTS > 0\n#ifndef PHONG_PER_PIXEL\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nvPointLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#endif",lights_phong_pars_fragment:"uniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n#ifdef PHONG_PER_PIXEL\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#else\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#endif\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",lights_phong_fragment:"vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse  = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n#ifdef PHONG_PER_PIXEL\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz + vViewPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\n#else\nvec3 lVector = normalize( vPointLight[ i ].xyz );\nfloat lDistance = vPointLight[ i ].w;\n#endif\nvec3 pointHalfVector = normalize( lVector + viewPosition );\nfloat pointDistance = lDistance;\nfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\nfloat pointDiffuseWeight = max( dot( normal, lVector ), 0.0 );\nfloat pointSpecularWeight = pow( pointDotNormalHalf, shininess );\n#ifdef PHYSICALLY_BASED_SHADING\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( dot( lVector, pointHalfVector ), 5.0 );\npointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance;\n#else\npointSpecular += specular * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance;\n#endif\npointDiffuse  += diffuse * pointLightColor[ i ] * pointDiffuseWeight * pointDistance;\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse  = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nvec3 dirHalfVector = normalize( lDirection.xyz + viewPosition );\nfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\nfloat dirSpecularWeight = pow( dirDotNormalHalf, shininess );\n#ifdef PHYSICALLY_BASED_SHADING\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( dot( dirVector, dirHalfVector ), 5.0 );\ndirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;\n#else\ndirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;\n#endif\ndirDiffuse  += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;\n}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\n#ifdef METAL\ngl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient + totalSpecular );\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_fragment:"#ifdef USE_COLOR\ngl_FragColor = gl_FragColor * vec4( vColor, opacity );\n#endif",color_pars_vertex:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n#ifdef GAMMA_INPUT\nvColor = color * color;\n#else\nvColor = color;\n#endif\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\nuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n#endif",skinning_vertex:"#ifdef USE_SKINNING\ngl_Position  = ( boneGlobalMatrices[ int( skinIndex.x ) ] * skinVertexA ) * skinWeight.x;\ngl_Position += ( boneGlobalMatrices[ int( skinIndex.y ) ] * skinVertexB ) * skinWeight.y;\ngl_Position  = projectionMatrix * viewMatrix * objectMatrix * gl_Position;\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\nuniform float morphTargetInfluences[ 8 ];\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\nvec3 morphed = vec3( 0.0, 0.0, 0.0 );\nmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\nmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\nmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\nmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\nmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\nmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\nmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\nmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\nmorphed += position;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( morphed, 1.0 );\n#endif",default_vertex:"#ifndef USE_MORPHTARGETS\n#ifndef USE_SKINNING\ngl_Position = projectionMatrix * mvPosition;\n#endif\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\nuniform sampler2D shadowMap[ MAX_SHADOWS ];\nuniform float shadowDarkness;\nuniform float shadowBias;\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nfloat unpackDepth( const in vec4 rgba_depth ) {\nconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\nfloat depth = dot( rgba_depth, bit_shift );\nreturn depth;\n}\n#endif",shadowmap_fragment:"#ifdef USE_SHADOWMAP\n#ifdef SHADOWMAP_SOFT\nconst float xPixelOffset = 1.0 / SHADOWMAP_WIDTH;\nconst float yPixelOffset = 1.0 / SHADOWMAP_HEIGHT;\n#endif\nvec3 shadowColor = vec3( 1.0 );\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\nshadowCoord.z += shadowBias;\nif ( shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0 ) {\n#ifdef SHADOWMAP_SOFT\nfloat shadow = 0.0;\nfor ( float y = -1.25; y <= 1.25; y += 1.25 )\nfor ( float x = -1.25; x <= 1.25; x += 1.25 ) {\nvec4 rgbaDepth = texture2D( shadowMap[ i ], vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy );\nfloat fDepth = unpackDepth( rgbaDepth );\nif ( fDepth < shadowCoord.z )\nshadow += 1.0;\n}\nshadow /= 9.0;\nshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness * shadow ) );\n#else\nvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\nfloat fDepth = unpackDepth( rgbaDepth );\nif ( fDepth < shadowCoord.z )\nshadowColor = shadowColor * vec3( shadowDarkness );\n#endif\n}\n}\n#ifdef GAMMA_OUTPUT\nshadowColor *= shadowColor;\n#endif\ngl_FragColor.xyz = gl_FragColor.xyz * shadowColor;\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nuniform mat4 shadowMatrix[ MAX_SHADOWS ];\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvShadowCoord[ i ] = shadowMatrix[ i ] * objectMatrix * vec4( position, 1.0 );\n}\n#endif",alphatest_fragment:"#ifdef ALPHATEST\nif ( gl_FragColor.a < ALPHATEST ) discard;\n#endif",linear_to_gamma_fragment:"#ifdef GAMMA_OUTPUT\ngl_FragColor.xyz = sqrt( gl_FragColor.xyz );\n#endif"};c.UniformsUtils={merge:function(b){var g,j,k,a={};for(g=0;g<b.length;g++){for(j in k=this.clone(b[g]),k){a[j]=k[j]}}return a},clone:function(b){var g,j,k,a={};for(g in b){for(j in a[g]={},b[g]){k=b[g][j],a[g][j]=k instanceof c.Color||k instanceof c.Vector2||k instanceof c.Vector3||k instanceof c.Vector4||k instanceof c.Matrix4||k instanceof c.Texture?k.clone():k instanceof Array?k.slice():k}}return a}};c.UniformsLib={common:{diffuse:{type:"c",value:new c.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:0,texture:null},offsetRepeat:{type:"v4",value:new c.Vector4(0,0,1,1)},lightMap:{type:"t",value:2,texture:null},envMap:{type:"t",value:1,texture:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:0.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},fog:{fogDensity:{type:"f",value:0.00025},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2000},fogColor:{type:"c",value:new c.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new c.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:0,texture:null},fogDensity:{type:"f",value:0.00025},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2000},fogColor:{type:"c",value:new c.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:6,texture:[]},shadowMatrix:{type:"m4v",value:[]},shadowBias:{type:"f",value:0.0039},shadowDarkness:{type:"f",value:0.2}}};c.ShaderLib={sprite:{vertexShader:"uniform int useScreenCoordinates;\nuniform int affectedByDistance;\nuniform vec3 screenPosition;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 alignment;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position + alignment;\nvec2 rotatedPosition;\nrotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;\nrotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;\nvec4 finalPosition;\nif( useScreenCoordinates != 0 ) {\nfinalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );\n} else {\nfinalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition * ( affectedByDistance == 1 ? 1.0 : finalPosition.z );\n}\ngl_Position = finalPosition;\n}",fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nvarying vec2 vUV;\nvoid main() {\nvec4 texture = texture2D( map, vUV );\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\n}"},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2000},opacity:{type:"f",value:1}},vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float mNear;\nuniform float mFar;\nuniform float opacity;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat color = 1.0 - smoothstep( mNear, mFar, depth );\ngl_FragColor = vec4( vec3( color ), opacity );\n}"},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:"varying vec3 vNormal;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvNormal = normalize( normalMatrix * normal );\ngl_Position = projectionMatrix * mvPosition;\n}",fragmentShader:"uniform float opacity;\nvarying vec3 vNormal;\nvoid main() {\ngl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\n}"},basic:{uniforms:c.UniformsUtils.merge([c.UniformsLib.common,c.UniformsLib.fog,c.UniformsLib.shadowmap]),vertexShader:[c.ShaderChunk.map_pars_vertex,c.ShaderChunk.lightmap_pars_vertex,c.ShaderChunk.envmap_pars_vertex,c.ShaderChunk.color_pars_vertex,c.ShaderChunk.skinning_pars_vertex,c.ShaderChunk.morphtarget_pars_vertex,c.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",c.ShaderChunk.map_vertex,c.ShaderChunk.lightmap_vertex,c.ShaderChunk.envmap_vertex,c.ShaderChunk.color_vertex,c.ShaderChunk.skinning_vertex,c.ShaderChunk.morphtarget_vertex,c.ShaderChunk.default_vertex,c.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",c.ShaderChunk.color_pars_fragment,c.ShaderChunk.map_pars_fragment,c.ShaderChunk.lightmap_pars_fragment,c.ShaderChunk.envmap_pars_fragment,c.ShaderChunk.fog_pars_fragment,c.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );",c.ShaderChunk.map_fragment,c.ShaderChunk.alphatest_fragment,c.ShaderChunk.lightmap_fragment,c.ShaderChunk.color_fragment,c.ShaderChunk.envmap_fragment,c.ShaderChunk.shadowmap_fragment,c.ShaderChunk.linear_to_gamma_fragment,c.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:c.UniformsUtils.merge([c.UniformsLib.common,c.UniformsLib.fog,c.UniformsLib.lights,c.UniformsLib.shadowmap,{ambient:{type:"c",value:new c.Color(328965)}}]),vertexShader:["varying vec3 vLightWeighting;",c.ShaderChunk.map_pars_vertex,c.ShaderChunk.lightmap_pars_vertex,c.ShaderChunk.envmap_pars_vertex,c.ShaderChunk.lights_lambert_pars_vertex,c.ShaderChunk.color_pars_vertex,c.ShaderChunk.skinning_pars_vertex,c.ShaderChunk.morphtarget_pars_vertex,c.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",c.ShaderChunk.map_vertex,c.ShaderChunk.lightmap_vertex,c.ShaderChunk.envmap_vertex,c.ShaderChunk.color_vertex,"vec3 transformedNormal = normalize( normalMatrix * normal );",c.ShaderChunk.lights_lambert_vertex,c.ShaderChunk.skinning_vertex,c.ShaderChunk.morphtarget_vertex,c.ShaderChunk.default_vertex,c.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;\nvarying vec3 vLightWeighting;",c.ShaderChunk.color_pars_fragment,c.ShaderChunk.map_pars_fragment,c.ShaderChunk.lightmap_pars_fragment,c.ShaderChunk.envmap_pars_fragment,c.ShaderChunk.fog_pars_fragment,c.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );",c.ShaderChunk.map_fragment,c.ShaderChunk.alphatest_fragment,"gl_FragColor.xyz = gl_FragColor.xyz * vLightWeighting;",c.ShaderChunk.lightmap_fragment,c.ShaderChunk.color_fragment,c.ShaderChunk.envmap_fragment,c.ShaderChunk.shadowmap_fragment,c.ShaderChunk.linear_to_gamma_fragment,c.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:c.UniformsUtils.merge([c.UniformsLib.common,c.UniformsLib.fog,c.UniformsLib.lights,c.UniformsLib.shadowmap,{ambient:{type:"c",value:new c.Color(328965)},specular:{type:"c",value:new c.Color(1118481)},shininess:{type:"f",value:30}}]),vertexShader:["varying vec3 vViewPosition;\nvarying vec3 vNormal;",c.ShaderChunk.map_pars_vertex,c.ShaderChunk.lightmap_pars_vertex,c.ShaderChunk.envmap_pars_vertex,c.ShaderChunk.lights_phong_pars_vertex,c.ShaderChunk.color_pars_vertex,c.ShaderChunk.skinning_pars_vertex,c.ShaderChunk.morphtarget_pars_vertex,c.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",c.ShaderChunk.map_vertex,c.ShaderChunk.lightmap_vertex,c.ShaderChunk.envmap_vertex,c.ShaderChunk.color_vertex,"#ifndef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\n#endif\nvViewPosition = -mvPosition.xyz;\nvec3 transformedNormal = normalMatrix * normal;\nvNormal = transformedNormal;",c.ShaderChunk.lights_phong_vertex,c.ShaderChunk.skinning_vertex,c.ShaderChunk.morphtarget_vertex,c.ShaderChunk.default_vertex,c.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform vec3 ambient;\nuniform vec3 specular;\nuniform float shininess;",c.ShaderChunk.color_pars_fragment,c.ShaderChunk.map_pars_fragment,c.ShaderChunk.lightmap_pars_fragment,c.ShaderChunk.envmap_pars_fragment,c.ShaderChunk.fog_pars_fragment,c.ShaderChunk.lights_phong_pars_fragment,c.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );",c.ShaderChunk.map_fragment,c.ShaderChunk.alphatest_fragment,c.ShaderChunk.lights_phong_fragment,c.ShaderChunk.lightmap_fragment,c.ShaderChunk.color_fragment,c.ShaderChunk.envmap_fragment,c.ShaderChunk.shadowmap_fragment,c.ShaderChunk.linear_to_gamma_fragment,c.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:c.UniformsUtils.merge([c.UniformsLib.particle,c.UniformsLib.shadowmap]),vertexShader:["uniform float size;\nuniform float scale;",c.ShaderChunk.color_pars_vertex,c.ShaderChunk.shadowmap_pars_vertex,"void main() {",c.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n#ifdef USE_SIZEATTENUATION\ngl_PointSize = size * ( scale / length( mvPosition.xyz ) );\n#else\ngl_PointSize = size;\n#endif\ngl_Position = projectionMatrix * mvPosition;",c.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;\nuniform float opacity;",c.ShaderChunk.color_pars_fragment,c.ShaderChunk.map_particle_pars_fragment,c.ShaderChunk.fog_pars_fragment,c.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( psColor, opacity );",c.ShaderChunk.map_particle_fragment,c.ShaderChunk.alphatest_fragment,c.ShaderChunk.color_fragment,c.ShaderChunk.shadowmap_fragment,c.ShaderChunk.fog_fragment,"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[c.ShaderChunk.morphtarget_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",c.ShaderChunk.morphtarget_vertex,c.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:"vec4 pack_depth( const in float depth ) {\nconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\nconst vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\nvec4 res = fract( depth * bit_shift );\nres -= res.xxyz * bit_mask;\nreturn res;\n}\nvoid main() {\ngl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );\n}"}};c.WebGLRenderer=function(h){function m(aB,aC){var aD=aB.vertices.length,z=aC.material;if(z.attributes){if(aB.__webglCustomAttributesList===void 0){aB.__webglCustomAttributesList=[]}for(var aA in z.attributes){var D=z.attributes[aA];if(!D.__webglInitialized||D.createUniqueBuffers){D.__webglInitialized=!0;var C=1;D.type==="v2"?C=2:D.type==="v3"?C=3:D.type==="v4"?C=4:D.type==="c"&&(C=3);D.size=C;D.array=new Float32Array(aD*C);D.buffer=au.createBuffer();D.buffer.belongsToAttribute=aA;D.needsUpdate=!0}aB.__webglCustomAttributesList.push(D)}}}function k(z,C){if(z.material&&!(z.material instanceof c.MeshFaceMaterial)){return z.material}else{if(C.materialIndex>=0){return z.geometry.materials[C.materialIndex]}}}function o(z){if(z instanceof c.MeshBasicMaterial&&!z.envMap||z instanceof c.MeshDepthMaterial){return !1}return z&&z.shading!==void 0&&z.shading===c.SmoothShading?c.SmoothShading:c.FlatShading}function t(z){if(z.vertexColors){return z.vertexColors}return !1}function q(z){if(z.map||z.lightMap||z instanceof c.ShaderMaterial){return !0}return !1}function p(aF,aH,aL){var aJ,aC,aB,D,aD=aF.vertices;D=aD.length;var aE=aF.colors,z=aE.length,aG=aF.__vertexArray,C=aF.__colorArray,aK=aF.__sortArray,aI=aF.__dirtyVertices,aA=aF.__dirtyColors,aM=aF.__webglCustomAttributesList;if(aL.sortParticles){Y.multiplySelf(aL.matrixWorld);for(aJ=0;aJ<D;aJ++){aC=aD[aJ].position,ak.copy(aC),Y.multiplyVector3(ak),aK[aJ]=[ak.z,aJ]}aK.sort(function(aN,aO){return aO[0]-aN[0]});for(aJ=0;aJ<D;aJ++){aC=aD[aK[aJ][1]].position,aB=aJ*3,aG[aB]=aC.x,aG[aB+1]=aC.y,aG[aB+2]=aC.z}for(aJ=0;aJ<z;aJ++){aB=aJ*3,aC=aE[aK[aJ][1]],C[aB]=aC.r,C[aB+1]=aC.g,C[aB+2]=aC.b}if(aM){aE=0;for(z=aM.length;aE<z;aE++){if(aD=aM[aE],aD.boundTo===void 0||aD.boundTo==="vertices"){if(aB=0,aC=aD.value.length,aD.size===1){for(aJ=0;aJ<aC;aJ++){D=aK[aJ][1],aD.array[aJ]=aD.value[D]}}else{if(aD.size===2){for(aJ=0;aJ<aC;aJ++){D=aK[aJ][1],D=aD.value[D],aD.array[aB]=D.x,aD.array[aB+1]=D.y,aB+=2}}else{if(aD.size===3){if(aD.type==="c"){for(aJ=0;aJ<aC;aJ++){D=aK[aJ][1],D=aD.value[D],aD.array[aB]=D.r,aD.array[aB+1]=D.g,aD.array[aB+2]=D.b,aB+=3}}else{for(aJ=0;aJ<aC;aJ++){D=aK[aJ][1],D=aD.value[D],aD.array[aB]=D.x,aD.array[aB+1]=D.y,aD.array[aB+2]=D.z,aB+=3}}}else{if(aD.size===4){for(aJ=0;aJ<aC;aJ++){D=aK[aJ][1],D=aD.value[D],aD.array[aB]=D.x,aD.array[aB+1]=D.y,aD.array[aB+2]=D.z,aD.array[aB+3]=D.w,aB+=4}}}}}}}}}else{if(aI){for(aJ=0;aJ<D;aJ++){aC=aD[aJ].position,aB=aJ*3,aG[aB]=aC.x,aG[aB+1]=aC.y,aG[aB+2]=aC.z}}if(aA){for(aJ=0;aJ<z;aJ++){aC=aE[aJ],aB=aJ*3,C[aB]=aC.r,C[aB+1]=aC.g,C[aB+2]=aC.b}}if(aM){aE=0;for(z=aM.length;aE<z;aE++){if(aD=aM[aE],aD.needsUpdate&&(aD.boundTo===void 0||aD.boundTo==="vertices")){if(aC=aD.value.length,aB=0,aD.size===1){for(aJ=0;aJ<aC;aJ++){aD.array[aJ]=aD.value[aJ]}}else{if(aD.size===2){for(aJ=0;aJ<aC;aJ++){D=aD.value[aJ],aD.array[aB]=D.x,aD.array[aB+1]=D.y,aB+=2}}else{if(aD.size===3){if(aD.type==="c"){for(aJ=0;aJ<aC;aJ++){D=aD.value[aJ],aD.array[aB]=D.r,aD.array[aB+1]=D.g,aD.array[aB+2]=D.b,aB+=3}}else{for(aJ=0;aJ<aC;aJ++){D=aD.value[aJ],aD.array[aB]=D.x,aD.array[aB+1]=D.y,aD.array[aB+2]=D.z,aB+=3}}}else{if(aD.size===4){for(aJ=0;aJ<aC;aJ++){D=aD.value[aJ],aD.array[aB]=D.x,aD.array[aB+1]=D.y,aD.array[aB+2]=D.z,aD.array[aB+3]=D.w,aB+=4}}}}}}}}}if(aI||aL.sortParticles){au.bindBuffer(au.ARRAY_BUFFER,aF.__webglVertexBuffer),au.bufferData(au.ARRAY_BUFFER,aG,aH)}if(aA||aL.sortParticles){au.bindBuffer(au.ARRAY_BUFFER,aF.__webglColorBuffer),au.bufferData(au.ARRAY_BUFFER,C,aH)}if(aM){aE=0;for(z=aM.length;aE<z;aE++){if(aD=aM[aE],aD.needsUpdate||aL.sortParticles){au.bindBuffer(au.ARRAY_BUFFER,aD.buffer),au.bufferData(au.ARRAY_BUFFER,aD.array,aH)}}}}function ar(z,D,aA){if(!z.__webglVertexBuffer){z.__webglVertexBuffer=au.createBuffer()}if(!z.__webglNormalBuffer){z.__webglNormalBuffer=au.createBuffer()}z.hasPos&&(au.bindBuffer(au.ARRAY_BUFFER,z.__webglVertexBuffer),au.bufferData(au.ARRAY_BUFFER,z.positionArray,au.DYNAMIC_DRAW),au.enableVertexAttribArray(D.attributes.position),au.vertexAttribPointer(D.attributes.position,3,au.FLOAT,!1,0,0));if(z.hasNormal){au.bindBuffer(au.ARRAY_BUFFER,z.__webglNormalBuffer);if(aA===c.FlatShading){var aC,aF,aE,aD,aG,aH,aI,aJ,aK,C,aB=z.count*3;for(C=0;C<aB;C+=9){aA=z.normalArray,aC=aA[C],aF=aA[C+1],aE=aA[C+2],aD=aA[C+3],aH=aA[C+4],aJ=aA[C+5],aG=aA[C+6],aI=aA[C+7],aK=aA[C+8],aC=(aC+aD+aG)/3,aF=(aF+aH+aI)/3,aE=(aE+aJ+aK)/3,aA[C]=aC,aA[C+1]=aF,aA[C+2]=aE,aA[C+3]=aC,aA[C+4]=aF,aA[C+5]=aE,aA[C+6]=aC,aA[C+7]=aF,aA[C+8]=aE}}au.bufferData(au.ARRAY_BUFFER,z.normalArray,au.DYNAMIC_DRAW);au.enableVertexAttribArray(D.attributes.normal);au.vertexAttribPointer(D.attributes.normal,3,au.FLOAT,!1,0,0)}au.drawArrays(au.TRIANGLES,0,z.count);z.count=0}function at(D,aB,aC,aD,aG,aF){if(aD.opacity!==0){var aE,aI,aC=J(D,aB,aC,aD,aF),aB=aC.attributes,D=!1,aC=aG.id*16777215+aC.id*2+(aD.wireframe?1:0);aC!==aj&&(aj=aC,D=!0);if(!aD.morphTargets&&aB.position>=0){D&&(au.bindBuffer(au.ARRAY_BUFFER,aG.__webglVertexBuffer),au.vertexAttribPointer(aB.position,3,au.FLOAT,!1,0,0))}else{if(aF.morphTargetBase){aC=aD.program.attributes;aF.morphTargetBase!==-1?(au.bindBuffer(au.ARRAY_BUFFER,aG.__webglMorphTargetsBuffers[aF.morphTargetBase]),au.vertexAttribPointer(aC.position,3,au.FLOAT,!1,0,0)):aC.position>=0&&(au.bindBuffer(au.ARRAY_BUFFER,aG.__webglVertexBuffer),au.vertexAttribPointer(aC.position,3,au.FLOAT,!1,0,0));if(aF.morphTargetForcedOrder.length){aE=0;var z=aF.morphTargetForcedOrder;for(aI=aF.morphTargetInfluences;aE<aD.numSupportedMorphTargets&&aE<z.length;){au.bindBuffer(au.ARRAY_BUFFER,aG.__webglMorphTargetsBuffers[z[aE]]),au.vertexAttribPointer(aC["morphTarget"+aE],3,au.FLOAT,!1,0,0),aF.__webglMorphTargetInfluences[aE]=aI[z[aE]],aE++}}else{var z=[],C=-1,aJ=0;aI=aF.morphTargetInfluences;var aH,aA=aI.length;aE=0;for(aF.morphTargetBase!==-1&&(z[aF.morphTargetBase]=!0);aE<aD.numSupportedMorphTargets;){for(aH=0;aH<aA;aH++){!z[aH]&&aI[aH]>C&&(aJ=aH,C=aI[aJ])}au.bindBuffer(au.ARRAY_BUFFER,aG.__webglMorphTargetsBuffers[aJ]);au.vertexAttribPointer(aC["morphTarget"+aE],3,au.FLOAT,!1,0,0);aF.__webglMorphTargetInfluences[aE]=C;z[aJ]=1;C=-1;aE++}}aD.program.uniforms.morphTargetInfluences!==null&&au.uniform1fv(aD.program.uniforms.morphTargetInfluences,aF.__webglMorphTargetInfluences)}}if(D){if(aG.__webglCustomAttributesList){aE=0;for(aI=aG.__webglCustomAttributesList.length;aE<aI;aE++){aC=aG.__webglCustomAttributesList[aE],aB[aC.buffer.belongsToAttribute]>=0&&(au.bindBuffer(au.ARRAY_BUFFER,aC.buffer),au.vertexAttribPointer(aB[aC.buffer.belongsToAttribute],aC.size,au.FLOAT,!1,0,0))}}aB.color>=0&&(au.bindBuffer(au.ARRAY_BUFFER,aG.__webglColorBuffer),au.vertexAttribPointer(aB.color,3,au.FLOAT,!1,0,0));aB.normal>=0&&(au.bindBuffer(au.ARRAY_BUFFER,aG.__webglNormalBuffer),au.vertexAttribPointer(aB.normal,3,au.FLOAT,!1,0,0));aB.tangent>=0&&(au.bindBuffer(au.ARRAY_BUFFER,aG.__webglTangentBuffer),au.vertexAttribPointer(aB.tangent,4,au.FLOAT,!1,0,0));aB.uv>=0&&(aG.__webglUVBuffer?(au.bindBuffer(au.ARRAY_BUFFER,aG.__webglUVBuffer),au.vertexAttribPointer(aB.uv,2,au.FLOAT,!1,0,0),au.enableVertexAttribArray(aB.uv)):au.disableVertexAttribArray(aB.uv));aB.uv2>=0&&(aG.__webglUV2Buffer?(au.bindBuffer(au.ARRAY_BUFFER,aG.__webglUV2Buffer),au.vertexAttribPointer(aB.uv2,2,au.FLOAT,!1,0,0),au.enableVertexAttribArray(aB.uv2)):au.disableVertexAttribArray(aB.uv2));aD.skinning&&aB.skinVertexA>=0&&aB.skinVertexB>=0&&aB.skinIndex>=0&&aB.skinWeight>=0&&(au.bindBuffer(au.ARRAY_BUFFER,aG.__webglSkinVertexABuffer),au.vertexAttribPointer(aB.skinVertexA,4,au.FLOAT,!1,0,0),au.bindBuffer(au.ARRAY_BUFFER,aG.__webglSkinVertexBBuffer),au.vertexAttribPointer(aB.skinVertexB,4,au.FLOAT,!1,0,0),au.bindBuffer(au.ARRAY_BUFFER,aG.__webglSkinIndicesBuffer),au.vertexAttribPointer(aB.skinIndex,4,au.FLOAT,!1,0,0),au.bindBuffer(au.ARRAY_BUFFER,aG.__webglSkinWeightsBuffer),au.vertexAttribPointer(aB.skinWeight,4,au.FLOAT,!1,0,0))}aF instanceof c.Mesh?(aD.wireframe?(aD=aD.wireframeLinewidth,aD!==al&&(au.lineWidth(aD),al=aD),D&&au.bindBuffer(au.ELEMENT_ARRAY_BUFFER,aG.__webglLineBuffer),au.drawElements(au.LINES,aG.__webglLineCount,au.UNSIGNED_SHORT,0)):(D&&au.bindBuffer(au.ELEMENT_ARRAY_BUFFER,aG.__webglFaceBuffer),au.drawElements(au.TRIANGLES,aG.__webglFaceCount,au.UNSIGNED_SHORT,0)),V.info.render.calls++,V.info.render.vertices+=aG.__webglFaceCount,V.info.render.faces+=aG.__webglFaceCount/3):aF instanceof c.Line?(aF=aF.type===c.LineStrip?au.LINE_STRIP:au.LINES,aD=aD.linewidth,aD!==al&&(au.lineWidth(aD),al=aD),au.drawArrays(aF,0,aG.__webglLineCount),V.info.render.calls++):aF instanceof c.ParticleSystem?(au.drawArrays(au.POINTS,0,aG.__webglParticleCount),V.info.render.calls++):aF instanceof c.Ribbon&&(au.drawArrays(au.TRIANGLE_STRIP,0,aG.__webglVertexCount),V.info.render.calls++)}}function b(z){O[0].set(z.n41-z.n11,z.n42-z.n12,z.n43-z.n13,z.n44-z.n14);O[1].set(z.n41+z.n11,z.n42+z.n12,z.n43+z.n13,z.n44+z.n14);O[2].set(z.n41+z.n21,z.n42+z.n22,z.n43+z.n23,z.n44+z.n24);O[3].set(z.n41-z.n21,z.n42-z.n22,z.n43-z.n23,z.n44-z.n24);O[4].set(z.n41-z.n31,z.n42-z.n32,z.n43-z.n33,z.n44-z.n34);O[5].set(z.n41+z.n31,z.n42+z.n32,z.n43+z.n33,z.n44+z.n34);for(var C,z=0;z<6;z++){C=O[z],C.divideScalar(Math.sqrt(C.x*C.x+C.y*C.y+C.z*C.z))}}function K(D){for(var aA=D.matrixWorld,z=-D.geometry.boundingSphere.radius*Math.max(D.scale.x,Math.max(D.scale.y,D.scale.z)),C=0;C<6;C++){if(D=O[C].x*aA.n14+O[C].y*aA.n24+O[C].z*aA.n34+O[C].w,D<=z){return !1}}return !0}function w(z,C){return C.z-z.z}function y(aC){var aD,aE,aF,aH,aG,z,C,D,aA=0,aB=aC.lights;e||(e=new c.PerspectiveCamera(V.shadowCameraFov,V.shadowMapWidth/V.shadowMapHeight,V.shadowCameraNear,V.shadowCameraFar));aD=0;for(aE=aB.length;aD<aE;aD++){if(D=aB[aD],D.castShadow&&D instanceof c.SpotLight){am=-1;V.shadowMap[aA]||(V.shadowMap[aA]=new c.WebGLRenderTarget(V.shadowMapWidth,V.shadowMapHeight,{minFilter:c.LinearFilter,magFilter:c.LinearFilter,format:c.RGBAFormat}),ad[aA]=new c.Matrix4);aF=V.shadowMap[aA];aH=ad[aA];e.position.copy(D.position);e.lookAt(D.target.position);e.parent==null&&(console.warn("Camera is not on the Scene. Adding it..."),aC.add(e),this.autoUpdateScene&&aC.updateMatrixWorld());e.matrixWorldInverse.getInverse(e.matrixWorld);aH.set(0.5,0,0,0.5,0,0.5,0,0.5,0,0,0.5,0.5,0,0,0,1);aH.multiplySelf(e.projectionMatrix);aH.multiplySelf(e.matrixWorldInverse);e.matrixWorldInverse.flattenToArray(af);e.projectionMatrix.flattenToArray(r);Y.multiply(e.projectionMatrix,e.matrixWorldInverse);b(Y);T(aF);au.clearColor(1,1,1,1);V.clear();au.clearColor(X.r,X.g,X.b,R);aH=aC.__webglObjects.length;for(aF=0;aF<aH;aF++){if(z=aC.__webglObjects[aF],D=z.object,z.render=!1,D.visible&&D.castShadow&&(!(D instanceof c.Mesh)||!D.frustumCulled||K(D))){D.matrixWorld.flattenToArray(D._objectMatrixArray),v(D,e,!1),z.render=!0}}u(!0);av(c.NormalBlending);for(aF=0;aF<aH;aF++){if(z=aC.__webglObjects[aF],z.render){D=z.object,z=z.buffer,E(D),C=D.customDepthMaterial?D.customDepthMaterial:D.geometry.morphTargets.length?ap:az,at(e,aB,null,C,z,D)}}aH=aC.__webglObjectsImmediate.length;for(aF=0;aF<aH;aF++){z=aC.__webglObjectsImmediate[aF],D=z.object,D.visible&&D.castShadow&&(D.matrixAutoUpdate&&D.matrixWorld.flattenToArray(D._objectMatrixArray),aj=-1,v(D,e,!1),E(D),aG=J(e,aB,null,az,D),D.immediateRenderCallback?D.immediateRenderCallback(aG,au,O):D.render(function(aI){ar(aI,aG,az.shading)}))}aA++}}}function l(D,aB,aC,aD,aG,aF,aE,aI){var z,C,aA,aJ;aB?(C=D.length-1,aJ=aB=-1):(C=0,aB=D.length,aJ=1);for(var aH=C;aH!==aB;aH+=aJ){if(z=D[aH],z.render){C=z.object;aA=z.buffer;if(aI){z=aI}else{z=z[aC];if(!z){continue}aE&&av(z.blending);u(z.depthTest);ax(z.depthWrite);ay(z.polygonOffset,z.polygonOffsetFactor,z.polygonOffsetUnits)}E(C);at(aD,aG,aF,z,aA,C)}}}function F(C,aB,aC,aD,aG,aF,aE){for(var aI,aJ,D,aH,z=0,aA=C.length;z<aA;z++){if(aI=C[z],aJ=aI.object,aJ.visible){aj=-1;if(aE){D=aE}else{D=aI[aB];if(!D){continue}aF&&av(D.blending);u(D.depthTest);ax(D.depthWrite);ay(D.polygonOffset,D.polygonOffsetFactor,D.polygonOffsetUnits)}E(aJ);aH=J(aC,aD,aG,D,aJ);aJ.immediateRenderCallback?aJ.immediateRenderCallback(aH,au,O):aJ.render(function(aK){ar(aK,aH,D.shading)})}}}function s(z,D,C){z.push({buffer:D,object:C,opaque:null,transparent:null})}function B(z){for(var C in z.attributes){if(z.attributes[C].needsUpdate){return !0}}return !1}function I(z){for(var C in z.attributes){z.attributes[C].needsUpdate=!1}}function aw(z,D){for(var C=z.length-1;C>=0;C--){z[C].object===D&&z.splice(C,1)}}function J(aK,aJ,C,aB,z){aB.program||V.initMaterial(aB,aJ,C,z);if(aB.morphTargets&&!z.__webglMorphTargetInfluences){z.__webglMorphTargetInfluences=new Float32Array(V.maxMorphTargets);for(var aI=0,aD=V.maxMorphTargets;aI<aD;aI++){z.__webglMorphTargetInfluences[aI]=0}}var D=!1,aI=aB.program,aD=aI.uniforms,aA=aB.uniforms;aI!==U&&(au.useProgram(aI),U=aI,D=!0);if(aB.id!==am){am=aB.id,D=!0}if(D){au.uniformMatrix4fv(aD.projectionMatrix,!1,r);if(C&&aB.fog){if(aA.fogColor.value=C.color,C instanceof c.Fog){aA.fogNear.value=C.near,aA.fogFar.value=C.far}else{if(C instanceof c.FogExp2){aA.fogDensity.value=C.density}}}if(aB instanceof c.MeshPhongMaterial||aB instanceof c.MeshLambertMaterial||aB.lights){for(var aF,aG,aE=0,aC=0,aL=0,aN,aM,aP,aQ=ah,aR=aQ.directional.colors,aS=aQ.directional.positions,aZ=aQ.point.colors,aY=aQ.point.positions,aW=aQ.point.distances,aH=0,aO=0,C=aF=aP=0,D=aJ.length;C<D;C++){if(aF=aJ[C],aG=aF.color,aN=aF.position,aM=aF.intensity,aP=aF.distance,aF instanceof c.AmbientLight){V.gammaInput?(aE+=aG.r*aG.r,aC+=aG.g*aG.g,aL+=aG.b*aG.b):(aE+=aG.r,aC+=aG.g,aL+=aG.b)}else{if(aF instanceof c.DirectionalLight){aP=aH*3,V.gammaInput?(aR[aP]=aG.r*aG.r*aM*aM,aR[aP+1]=aG.g*aG.g*aM*aM,aR[aP+2]=aG.b*aG.b*aM*aM):(aR[aP]=aG.r*aM,aR[aP+1]=aG.g*aM,aR[aP+2]=aG.b*aM),aS[aP]=aN.x,aS[aP+1]=aN.y,aS[aP+2]=aN.z,aH+=1}else{if(aF instanceof c.SpotLight){aP=aH*3,V.gammaInput?(aR[aP]=aG.r*aG.r*aM*aM,aR[aP+1]=aG.g*aG.g*aM*aM,aR[aP+2]=aG.b*aG.b*aM*aM):(aR[aP]=aG.r*aM,aR[aP+1]=aG.g*aM,aR[aP+2]=aG.b*aM),aG=1/aN.length(),aS[aP]=aN.x*aG,aS[aP+1]=aN.y*aG,aS[aP+2]=aN.z*aG,aH+=1}else{if(aF instanceof c.PointLight){aF=aO*3,V.gammaInput?(aZ[aF]=aG.r*aG.r*aM*aM,aZ[aF+1]=aG.g*aG.g*aM*aM,aZ[aF+2]=aG.b*aG.b*aM*aM):(aZ[aF]=aG.r*aM,aZ[aF+1]=aG.g*aM,aZ[aF+2]=aG.b*aM),aY[aF]=aN.x,aY[aF+1]=aN.y,aY[aF+2]=aN.z,aW[aO]=aP,aO+=1}}}}}C=aH*3;for(D=aR.length;C<D;C++){aR[C]=0}C=aO*3;for(D=aZ.length;C<D;C++){aZ[C]=0}aQ.point.length=aO;aQ.directional.length=aH;aQ.ambient[0]=aE;aQ.ambient[1]=aC;aQ.ambient[2]=aL;aJ=ah;aA.ambientLightColor.value=aJ.ambient;aA.directionalLightColor.value=aJ.directional.colors;aA.directionalLightDirection.value=aJ.directional.positions;aA.pointLightColor.value=aJ.point.colors;aA.pointLightPosition.value=aJ.point.positions;aA.pointLightDistance.value=aJ.point.distances}if(aB instanceof c.MeshBasicMaterial||aB instanceof c.MeshLambertMaterial||aB instanceof c.MeshPhongMaterial){aA.opacity.value=aB.opacity,V.gammaInput?aA.diffuse.value.copyGammaToLinear(aB.color):aA.diffuse.value=aB.color,(aA.map.texture=aB.map)&&aA.offsetRepeat.value.set(aB.map.offset.x,aB.map.offset.y,aB.map.repeat.x,aB.map.repeat.y),aA.lightMap.texture=aB.lightMap,aA.envMap.texture=aB.envMap,aA.flipEnvMap.value=aB.envMap instanceof c.WebGLRenderTargetCube?1:-1,aA.reflectivity.value=aB.reflectivity,aA.refractionRatio.value=aB.refractionRatio,aA.combine.value=aB.combine,aA.useRefract.value=aB.envMap&&aB.envMap.mapping instanceof c.CubeRefractionMapping}if(aB instanceof c.LineBasicMaterial){aA.diffuse.value=aB.color,aA.opacity.value=aB.opacity}else{if(aB instanceof c.ParticleBasicMaterial){aA.psColor.value=aB.color,aA.opacity.value=aB.opacity,aA.size.value=aB.size,aA.scale.value=Z.height/2,aA.map.texture=aB.map}else{if(aB instanceof c.MeshPhongMaterial){aA.shininess.value=aB.shininess,V.gammaInput?(aA.ambient.value.copyGammaToLinear(aB.ambient),aA.specular.value.copyGammaToLinear(aB.specular)):(aA.ambient.value=aB.ambient,aA.specular.value=aB.specular)}else{if(aB instanceof c.MeshLambertMaterial){V.gammaInput?aA.ambient.value.copyGammaToLinear(aB.ambient):aA.ambient.value=aB.ambient}else{if(aB instanceof c.MeshDepthMaterial){aA.mNear.value=aK.near,aA.mFar.value=aK.far,aA.opacity.value=aB.opacity}else{if(aB instanceof c.MeshNormalMaterial){aA.opacity.value=aB.opacity}}}}}}if(z.receiveShadow&&!aB._shadowPass&&aA.shadowMatrix){for(aJ=0;aJ<ad.length;aJ++){aA.shadowMatrix.value[aJ]=ad[aJ],aA.shadowMap.texture[aJ]=V.shadowMap[aJ]}aA.shadowDarkness.value=V.shadowMapDarkness;aA.shadowBias.value=V.shadowMapBias}aJ=aB.uniformsList;aA=0;for(C=aJ.length;aA<C;aA++){if(aC=aI.uniforms[aJ[aA][1]]){if(aE=aJ[aA][0],aL=aE.type,D=aE.value,aL==="i"){au.uniform1i(aC,D)}else{if(aL==="f"){au.uniform1f(aC,D)}else{if(aL==="v2"){au.uniform2f(aC,D.x,D.y)}else{if(aL==="v3"){au.uniform3f(aC,D.x,D.y,D.z)}else{if(aL==="v4"){au.uniform4f(aC,D.x,D.y,D.z,D.w)}else{if(aL==="c"){au.uniform3f(aC,D.r,D.g,D.b)}else{if(aL==="fv1"){au.uniform1fv(aC,D)}else{if(aL==="fv"){au.uniform3fv(aC,D)}else{if(aL==="v3v"){if(!aE._array){aE._array=new Float32Array(3*D.length)}aL=0;for(aN=D.length;aL<aN;aL++){aQ=aL*3,aE._array[aQ]=D[aL].x,aE._array[aQ+1]=D[aL].y,aE._array[aQ+2]=D[aL].z}au.uniform3fv(aC,aE._array)}else{if(aL==="m4"){if(!aE._array){aE._array=new Float32Array(16)}D.flattenToArray(aE._array);au.uniformMatrix4fv(aC,!1,aE._array)}else{if(aL==="m4v"){if(!aE._array){aE._array=new Float32Array(16*D.length)}aL=0;for(aN=D.length;aL<aN;aL++){D[aL].flattenToArrayOffset(aE._array,aL*16)}au.uniformMatrix4fv(aC,!1,aE._array)}else{if(aL==="t"){if(au.uniform1i(aC,D),aC=aE.texture){if(aC.image instanceof Array&&aC.image.length===6){if(aE=aC,aE.image.length===6){if(aE.needsUpdate){if(!aE.image.__webglTextureCube){aE.image.__webglTextureCube=au.createTexture()}au.activeTexture(au.TEXTURE0+D);au.bindTexture(au.TEXTURE_CUBE_MAP,aE.image.__webglTextureCube);D=H(au.TEXTURE_CUBE_MAP,aE,aE.image[0]);for(aC=0;aC<6;aC++){au.texImage2D(au.TEXTURE_CUBE_MAP_POSITIVE_X+aC,0,au.RGBA,au.RGBA,au.UNSIGNED_BYTE,aE.image[aC])}D&&au.generateMipmap(au.TEXTURE_CUBE_MAP);aE.needsUpdate=!1}else{au.activeTexture(au.TEXTURE0+D),au.bindTexture(au.TEXTURE_CUBE_MAP,aE.image.__webglTextureCube)}}}else{aC instanceof c.WebGLRenderTargetCube?(aE=aC,au.activeTexture(au.TEXTURE0+D),au.bindTexture(au.TEXTURE_CUBE_MAP,aE.__webglTexture)):A(aC,D)}}}else{if(aL==="tv"){if(!aE._array){aE._array=[];aL=0;for(aN=aE.texture.length;aL<aN;aL++){aE._array[aL]=D+aL}}au.uniform1iv(aC,aE._array);aL=0;for(aN=aE.texture.length;aL<aN;aL++){(aC=aE.texture[aL])&&A(aC,aE._array[aL])}}}}}}}}}}}}}}}}(aB instanceof c.ShaderMaterial||aB instanceof c.MeshPhongMaterial||aB.envMap)&&aD.cameraPosition!==null&&au.uniform3f(aD.cameraPosition,aK.position.x,aK.position.y,aK.position.z);(aB instanceof c.MeshPhongMaterial||aB instanceof c.MeshLambertMaterial||aB instanceof c.ShaderMaterial||aB.skinning)&&aD.viewMatrix!==null&&au.uniformMatrix4fv(aD.viewMatrix,!1,af);aB.skinning&&(au.uniformMatrix4fv(aD.cameraInverseMatrix,!1,af),au.uniformMatrix4fv(aD.boneGlobalMatrices,!1,z.boneMatrices))}au.uniformMatrix4fv(aD.modelViewMatrix,!1,z._modelViewMatrixArray);aD.normalMatrix&&au.uniformMatrix3fv(aD.normalMatrix,!1,z._normalMatrixArray);(aB instanceof c.ShaderMaterial||aB.envMap||aB.skinning||z.receiveShadow)&&aD.objectMatrix!==null&&au.uniformMatrix4fv(aD.objectMatrix,!1,z._objectMatrixArray);return aI}function v(z,D,C){z._modelViewMatrix.multiplyToArray(D.matrixWorldInverse,z.matrixWorld,z._modelViewMatrixArray);C&&c.Matrix4.makeInvert3x3(z._modelViewMatrix).transposeIntoArray(z._normalMatrixArray)}function E(z){if(ae!==z.doubleSided){z.doubleSided?au.disable(au.CULL_FACE):au.enable(au.CULL_FACE),ae=z.doubleSided}if(L!==z.flipSided){z.flipSided?au.frontFace(au.CW):au.frontFace(au.CCW),L=z.flipSided}}function u(z){n!==z&&(z?au.enable(au.DEPTH_TEST):au.disable(au.DEPTH_TEST),n=z)}function ax(z){aT!==z&&(au.depthMask(z),aT=z)}function ay(z,D,C){aq!==z&&(z?au.enable(au.POLYGON_OFFSET_FILL):au.disable(au.POLYGON_OFFSET_FILL),aq=z);if(z&&(ao!==D||ag!==C)){au.polygonOffset(D,C),ao=D,ag=C}}function av(z){if(z!==x){switch(z){case c.AdditiveBlending:au.blendEquation(au.FUNC_ADD);au.blendFunc(au.SRC_ALPHA,au.ONE);break;case c.SubtractiveBlending:au.blendEquation(au.FUNC_ADD);au.blendFunc(au.ZERO,au.ONE_MINUS_SRC_COLOR);break;case c.MultiplyBlending:au.blendEquation(au.FUNC_ADD);au.blendFunc(au.ZERO,au.SRC_COLOR);break;default:au.blendEquationSeparate(au.FUNC_ADD,au.FUNC_ADD),au.blendFuncSeparate(au.SRC_ALPHA,au.ONE_MINUS_SRC_ALPHA,au.ONE,au.ONE_MINUS_SRC_ALPHA)}x=z}}function ac(z,D){var C;z==="fragment"?C=au.createShader(au.FRAGMENT_SHADER):z==="vertex"&&(C=au.createShader(au.VERTEX_SHADER));au.shaderSource(C,D);au.compileShader(C);if(!au.getShaderParameter(C,au.COMPILE_STATUS)){return console.error(au.getShaderInfoLog(C)),console.error(D),null}return C}function H(z,D,C){return(C.width&C.width-1)===0&&(C.height&C.height-1)===0?(au.texParameteri(z,au.TEXTURE_WRAP_S,ab(D.wrapS)),au.texParameteri(z,au.TEXTURE_WRAP_T,ab(D.wrapT)),au.texParameteri(z,au.TEXTURE_MAG_FILTER,ab(D.magFilter)),au.texParameteri(z,au.TEXTURE_MIN_FILTER,ab(D.minFilter)),!0):(au.texParameteri(z,au.TEXTURE_WRAP_S,au.CLAMP_TO_EDGE),au.texParameteri(z,au.TEXTURE_WRAP_T,au.CLAMP_TO_EDGE),au.texParameteri(z,au.TEXTURE_MAG_FILTER,aX(D.magFilter)),au.texParameteri(z,au.TEXTURE_MIN_FILTER,aX(D.minFilter)),!1)}function A(z,D){if(z.needsUpdate){if(!z.__webglInit){z.__webglInit=!0,z.__webglTexture=au.createTexture(),V.info.memory.textures++}au.activeTexture(au.TEXTURE0+D);au.bindTexture(au.TEXTURE_2D,z.__webglTexture);var C=H(au.TEXTURE_2D,z,z.image);z instanceof c.DataTexture?au.texImage2D(au.TEXTURE_2D,0,ab(z.format),z.image.width,z.image.height,0,ab(z.format),au.UNSIGNED_BYTE,z.image.data):au.texImage2D(au.TEXTURE_2D,0,au.RGBA,au.RGBA,au.UNSIGNED_BYTE,z.image);C&&au.generateMipmap(au.TEXTURE_2D);z.needsUpdate=!1;if(z.onUpdated){z.onUpdated()}}else{au.activeTexture(au.TEXTURE0+D),au.bindTexture(au.TEXTURE_2D,z.__webglTexture)}}function Q(z,C){au.bindRenderbuffer(au.RENDERBUFFER,z);C.depthBuffer&&!C.stencilBuffer?(au.renderbufferStorage(au.RENDERBUFFER,au.DEPTH_COMPONENT16,C.width,C.height),au.framebufferRenderbuffer(au.FRAMEBUFFER,au.DEPTH_ATTACHMENT,au.RENDERBUFFER,z)):C.depthBuffer&&C.stencilBuffer?(au.renderbufferStorage(au.RENDERBUFFER,au.DEPTH_STENCIL,C.width,C.height),au.framebufferRenderbuffer(au.FRAMEBUFFER,au.DEPTH_STENCIL_ATTACHMENT,au.RENDERBUFFER,z)):au.renderbufferStorage(au.RENDERBUFFER,au.RGBA4,C.width,C.height)}function T(aA){var aB=aA instanceof c.WebGLRenderTargetCube;if(aA&&!aA.__webglFramebuffer){if(aA.depthBuffer===void 0){aA.depthBuffer=!0}if(aA.stencilBuffer===void 0){aA.stencilBuffer=!0}aA.__webglTexture=au.createTexture();if(aB){aA.__webglFramebuffer=[];aA.__webglRenderbuffer=[];au.bindTexture(au.TEXTURE_CUBE_MAP,aA.__webglTexture);H(au.TEXTURE_CUBE_MAP,aA,aA);for(var z=0;z<6;z++){aA.__webglFramebuffer[z]=au.createFramebuffer();aA.__webglRenderbuffer[z]=au.createRenderbuffer();au.texImage2D(au.TEXTURE_CUBE_MAP_POSITIVE_X+z,0,ab(aA.format),aA.width,aA.height,0,ab(aA.format),ab(aA.type),null);var C=aA,D=au.TEXTURE_CUBE_MAP_POSITIVE_X+z;au.bindFramebuffer(au.FRAMEBUFFER,aA.__webglFramebuffer[z]);au.framebufferTexture2D(au.FRAMEBUFFER,au.COLOR_ATTACHMENT0,D,C.__webglTexture,0);Q(aA.__webglRenderbuffer[z],aA)}}else{aA.__webglFramebuffer=au.createFramebuffer(),aA.__webglRenderbuffer=au.createRenderbuffer(),au.bindTexture(au.TEXTURE_2D,aA.__webglTexture),H(au.TEXTURE_2D,aA,aA),au.texImage2D(au.TEXTURE_2D,0,ab(aA.format),aA.width,aA.height,0,ab(aA.format),ab(aA.type),null),z=au.TEXTURE_2D,au.bindFramebuffer(au.FRAMEBUFFER,aA.__webglFramebuffer),au.framebufferTexture2D(au.FRAMEBUFFER,au.COLOR_ATTACHMENT0,z,aA.__webglTexture,0),Q(aA.__webglRenderbuffer,aA)}aB?au.bindTexture(au.TEXTURE_CUBE_MAP,null):au.bindTexture(au.TEXTURE_2D,null);au.bindRenderbuffer(au.RENDERBUFFER,null);au.bindFramebuffer(au.FRAMEBUFFER,null)}aA?(aB=aB?aA.__webglFramebuffer[aA.activeCubeFace]:aA.__webglFramebuffer,z=aA.width,aA=aA.height,D=C=0):(aB=null,z=P,aA=j,C=a,D=f);aB!==aU&&(au.bindFramebuffer(au.FRAMEBUFFER,aB),au.viewport(C,D,z,aA),aU=aB)}function aX(z){switch(z){case c.NearestFilter:case c.NearestMipMapNearestFilter:case c.NearestMipMapLinearFilter:return au.NEAREST;default:return au.LINEAR}}function ab(z){switch(z){case c.RepeatWrapping:return au.REPEAT;case c.ClampToEdgeWrapping:return au.CLAMP_TO_EDGE;case c.MirroredRepeatWrapping:return au.MIRRORED_REPEAT;case c.NearestFilter:return au.NEAREST;case c.NearestMipMapNearestFilter:return au.NEAREST_MIPMAP_NEAREST;case c.NearestMipMapLinearFilter:return au.NEAREST_MIPMAP_LINEAR;case c.LinearFilter:return au.LINEAR;case c.LinearMipMapNearestFilter:return au.LINEAR_MIPMAP_NEAREST;case c.LinearMipMapLinearFilter:return au.LINEAR_MIPMAP_LINEAR;case c.ByteType:return au.BYTE;case c.UnsignedByteType:return au.UNSIGNED_BYTE;case c.ShortType:return au.SHORT;case c.UnsignedShortType:return au.UNSIGNED_SHORT;case c.IntType:return au.INT;case c.UnsignedShortType:return au.UNSIGNED_INT;case c.FloatType:return au.FLOAT;case c.AlphaFormat:return au.ALPHA;case c.RGBFormat:return au.RGB;case c.RGBAFormat:return au.RGBA;case c.LuminanceFormat:return au.LUMINANCE;case c.LuminanceAlphaFormat:return au.LUMINANCE_ALPHA}return 0}var h=h||{},Z=h.canvas!==void 0?h.canvas:document.createElement("canvas"),an=h.precision!==void 0?h.precision:"highp",M=h.antialias!==void 0?h.antialias:!1,G=h.stencil!==void 0?h.stencil:!0,N=h.preserveDrawingBuffer!==void 0?h.preserveDrawingBuffer:!1,X=h.clearColor!==void 0?new c.Color(h.clearColor):new c.Color(0),R=h.clearAlpha!==void 0?h.clearAlpha:0,aa=h.maxLights!==void 0?h.maxLights:4;this.domElement=Z;this.context=null;this.autoUpdateScene=this.autoUpdateObjects=this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0;this.physicallyBasedShading=this.gammaOutput=this.gammaInput=!1;this.shadowMapBias=0.0039;this.shadowMapDarkness=0.5;this.shadowMapHeight=this.shadowMapWidth=512;this.shadowCameraNear=1;this.shadowCameraFar=5000;this.shadowCameraFov=50;this.shadowMap=[];this.shadowMapEnabled=!1;this.shadowMapSoft=this.shadowMapAutoUpdate=!0;this.maxMorphTargets=8;this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0}};var V=this,au,W=[],U=null,aU=null,am=-1,aj=null,g=0,ae=null,L=null,x=null,n=null,aT=null,aq=null,ao=null,ag=null,al=null,a=0,f=0,P=0,j=0,O=[new c.Vector4,new c.Vector4,new c.Vector4,new c.Vector4,new c.Vector4,new c.Vector4],Y=new c.Matrix4,r=new Float32Array(16),af=new Float32Array(16),ak=new c.Vector4,ah={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]}},e,ad=[],az,ap,S={},aV=!1;au=function(){var z;try{if(!(z=Z.getContext("experimental-webgl",{antialias:M,stencil:G,preserveDrawingBuffer:N}))){throw"Error creating WebGL context."}console.log(navigator.userAgent+" | "+z.getParameter(z.VERSION)+" | "+z.getParameter(z.VENDOR)+" | "+z.getParameter(z.RENDERER)+" | "+z.getParameter(z.SHADING_LANGUAGE_VERSION))}catch(C){console.error(C)}return z}();au.clearColor(0,0,0,1);au.clearDepth(1);au.clearStencil(0);au.enable(au.DEPTH_TEST);au.depthFunc(au.LEQUAL);au.frontFace(au.CCW);au.cullFace(au.BACK);au.enable(au.CULL_FACE);au.enable(au.BLEND);au.blendEquation(au.FUNC_ADD);au.blendFunc(au.SRC_ALPHA,au.ONE_MINUS_SRC_ALPHA);au.clearColor(X.r,X.g,X.b,R);(function(){S.vertices=new Float32Array(16);S.faces=new Uint16Array(6);var z=0;S.vertices[z++]=-1;S.vertices[z++]=-1;S.vertices[z++]=0;S.vertices[z++]=1;S.vertices[z++]=1;S.vertices[z++]=-1;S.vertices[z++]=1;S.vertices[z++]=1;S.vertices[z++]=1;S.vertices[z++]=1;S.vertices[z++]=1;S.vertices[z++]=0;S.vertices[z++]=-1;S.vertices[z++]=1;S.vertices[z++]=0;z=S.vertices[z++]=0;S.faces[z++]=0;S.faces[z++]=1;S.faces[z++]=2;S.faces[z++]=0;S.faces[z++]=2;S.faces[z++]=3;S.vertexBuffer=au.createBuffer();S.elementBuffer=au.createBuffer();au.bindBuffer(au.ARRAY_BUFFER,S.vertexBuffer);au.bufferData(au.ARRAY_BUFFER,S.vertices,au.STATIC_DRAW);au.bindBuffer(au.ELEMENT_ARRAY_BUFFER,S.elementBuffer);au.bufferData(au.ELEMENT_ARRAY_BUFFER,S.faces,au.STATIC_DRAW);S.program=au.createProgram();au.attachShader(S.program,ac("fragment",c.ShaderLib.sprite.fragmentShader));au.attachShader(S.program,ac("vertex",c.ShaderLib.sprite.vertexShader));au.linkProgram(S.program);S.attributes={};S.uniforms={};S.attributes.position=au.getAttribLocation(S.program,"position");S.attributes.uv=au.getAttribLocation(S.program,"uv");S.uniforms.uvOffset=au.getUniformLocation(S.program,"uvOffset");S.uniforms.uvScale=au.getUniformLocation(S.program,"uvScale");S.uniforms.rotation=au.getUniformLocation(S.program,"rotation");S.uniforms.scale=au.getUniformLocation(S.program,"scale");S.uniforms.alignment=au.getUniformLocation(S.program,"alignment");S.uniforms.color=au.getUniformLocation(S.program,"color");S.uniforms.map=au.getUniformLocation(S.program,"map");S.uniforms.opacity=au.getUniformLocation(S.program,"opacity");S.uniforms.useScreenCoordinates=au.getUniformLocation(S.program,"useScreenCoordinates");S.uniforms.affectedByDistance=au.getUniformLocation(S.program,"affectedByDistance");S.uniforms.screenPosition=au.getUniformLocation(S.program,"screenPosition");S.uniforms.modelViewMatrix=au.getUniformLocation(S.program,"modelViewMatrix");S.uniforms.projectionMatrix=au.getUniformLocation(S.program,"projectionMatrix")})();(function(){var z=c.ShaderLib.depthRGBA,C=c.UniformsUtils.clone(z.uniforms);az=new c.ShaderMaterial({fragmentShader:z.fragmentShader,vertexShader:z.vertexShader,uniforms:C});ap=new c.ShaderMaterial({fragmentShader:z.fragmentShader,vertexShader:z.vertexShader,uniforms:C,morphTargets:!0});az._shadowPass=!0;ap._shadowPass=!0})();this.context=au;var ai=au.getParameter(au.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;this.getContext=function(){return au};this.supportsVertexTextures=function(){return ai};this.setSize=function(z,C){Z.width=z;Z.height=C;this.setViewport(0,0,Z.width,Z.height)};this.setViewport=function(D,aA,z,C){a=D;f=aA;P=z;j=C;au.viewport(a,f,P,j)};this.setScissor=function(D,aA,z,C){au.scissor(D,aA,z,C)};this.enableScissorTest=function(z){z?au.enable(au.SCISSOR_TEST):au.disable(au.SCISSOR_TEST)};this.setClearColorHex=function(z,C){X.setHex(z);R=C;au.clearColor(X.r,X.g,X.b,R)};this.setClearColor=function(z,C){X.copy(z);R=C;au.clearColor(X.r,X.g,X.b,R)};this.getClearColor=function(){return X};this.getClearAlpha=function(){return R};this.clear=function(D,aA,z){var C=0;if(D===void 0||D){C|=au.COLOR_BUFFER_BIT}if(aA===void 0||aA){C|=au.DEPTH_BUFFER_BIT}if(z===void 0||z){C|=au.STENCIL_BUFFER_BIT}au.clear(C)};this.clearTarget=function(D,aA,z,C){T(D);this.clear(aA,z,C)};this.deallocateObject=function(aA){if(aA.__webglInit){if(aA.__webglInit=!1,delete aA._modelViewMatrix,delete aA._normalMatrixArray,delete aA._modelViewMatrixArray,delete aA._objectMatrixArray,aA instanceof c.Mesh){for(var aB in aA.geometry.geometryGroups){var z=aA.geometry.geometryGroups[aB];au.deleteBuffer(z.__webglVertexBuffer);au.deleteBuffer(z.__webglNormalBuffer);au.deleteBuffer(z.__webglTangentBuffer);au.deleteBuffer(z.__webglColorBuffer);au.deleteBuffer(z.__webglUVBuffer);au.deleteBuffer(z.__webglUV2Buffer);au.deleteBuffer(z.__webglSkinVertexABuffer);au.deleteBuffer(z.__webglSkinVertexBBuffer);au.deleteBuffer(z.__webglSkinIndicesBuffer);au.deleteBuffer(z.__webglSkinWeightsBuffer);au.deleteBuffer(z.__webglFaceBuffer);au.deleteBuffer(z.__webglLineBuffer);if(z.numMorphTargets){for(var C=0,D=z.numMorphTargets;C<D;C++){au.deleteBuffer(z.__webglMorphTargetsBuffers[C])}}if(z.__webglCustomAttributesList){for(C in C=void 0,z.__webglCustomAttributesList){au.deleteBuffer(z.__webglCustomAttributesList[C].buffer)}}V.info.memory.geometries--}}else{if(aA instanceof c.Ribbon){aA=aA.geometry,au.deleteBuffer(aA.__webglVertexBuffer),au.deleteBuffer(aA.__webglColorBuffer),V.info.memory.geometries--}else{if(aA instanceof c.Line){aA=aA.geometry,au.deleteBuffer(aA.__webglVertexBuffer),au.deleteBuffer(aA.__webglColorBuffer),V.info.memory.geometries--}else{if(aA instanceof c.ParticleSystem){aA=aA.geometry,au.deleteBuffer(aA.__webglVertexBuffer),au.deleteBuffer(aA.__webglColorBuffer),V.info.memory.geometries--}}}}}};this.deallocateTexture=function(z){if(z.__webglInit){z.__webglInit=!1,au.deleteTexture(z.__webglTexture),V.info.memory.textures--}};this.updateShadowMap=function(z,C){y(z,C)};this.render=function(aE,aF,aG,aJ){var aH,C,z,D,aA=aE.lights,aB=aE.fog;am=-1;this.autoUpdateObjects&&this.initWebGLObjects(aE);aF.parent===void 0&&(console.warn("DEPRECATED: Camera hasn't been added to a Scene. Adding it..."),aE.add(aF));this.autoUpdateScene&&aE.updateMatrixWorld();this.shadowMapEnabled&&this.shadowMapAutoUpdate&&y(aE,aF);V.info.render.calls=0;V.info.render.vertices=0;V.info.render.faces=0;aF.matrixWorldInverse.getInverse(aF.matrixWorld);aF.matrixWorldInverse.flattenToArray(af);aF.projectionMatrix.flattenToArray(r);Y.multiply(aF.projectionMatrix,aF.matrixWorldInverse);b(Y);T(aG);(this.autoClear||aJ)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);D=aE.__webglObjects;aJ=0;for(aH=D.length;aJ<aH;aJ++){if(C=D[aJ],z=C.object,C.render=!1,z.visible&&(!(z instanceof c.Mesh)||!z.frustumCulled||K(z))){z.matrixWorld.flattenToArray(z._objectMatrixArray);v(z,aF,!0);var aI=C,aC=aI.object,aK=aI.buffer,aD=void 0,aD=aD=void 0,aD=aC.material;if(aD instanceof c.MeshFaceMaterial){if(aD=aK.materialIndex,aD>=0){aD=aC.geometry.materials[aD],aD.transparent?(aI.transparent=aD,aI.opaque=null):(aI.opaque=aD,aI.transparent=null)}}else{if(aD){aD.transparent?(aI.transparent=aD,aI.opaque=null):(aI.opaque=aD,aI.transparent=null)}}C.render=!0;if(this.sortObjects){z.renderDepth?C.z=z.renderDepth:(ak.copy(z.position),Y.multiplyVector3(ak),C.z=ak.z)}}}this.sortObjects&&D.sort(w);D=aE.__webglObjectsImmediate;aJ=0;for(aH=D.length;aJ<aH;aJ++){if(C=D[aJ],z=C.object,z.visible){z.matrixAutoUpdate&&z.matrixWorld.flattenToArray(z._objectMatrixArray),v(z,aF,!0),z=C.object.material,z.transparent?(C.transparent=z,C.opaque=null):(C.opaque=z,C.transparent=null)}}aE.overrideMaterial?(av(aE.overrideMaterial.blending),u(aE.overrideMaterial.depthTest),ax(aE.overrideMaterial.depthWrite),ay(aE.overrideMaterial.polygonOffset,aE.overrideMaterial.polygonOffsetFactor,aE.overrideMaterial.polygonOffsetUnits),l(aE.__webglObjects,!1,"",aF,aA,aB,!0,aE.overrideMaterial),F(aE.__webglObjectsImmediate,"",aF,aA,aB,!1,aE.overrideMaterial)):(av(c.NormalBlending),l(aE.__webglObjects,!0,"opaque",aF,aA,aB,!1),F(aE.__webglObjectsImmediate,"opaque",aF,aA,aB,!1),l(aE.__webglObjects,!1,"transparent",aF,aA,aB,!0),F(aE.__webglObjectsImmediate,"transparent",aF,aA,aB,!0));if(aE.__webglSprites.length){z=S.attributes;aA=S.uniforms;aB=j/P;aJ=[];aH=P*0.5;D=j*0.5;C=!0;au.useProgram(S.program);U=S.program;aj=n=x=-1;aV||(au.enableVertexAttribArray(S.attributes.position),au.enableVertexAttribArray(S.attributes.uv),aV=!0);au.disable(au.CULL_FACE);au.enable(au.BLEND);au.depthMask(!0);au.bindBuffer(au.ARRAY_BUFFER,S.vertexBuffer);au.vertexAttribPointer(z.position,2,au.FLOAT,!1,16,0);au.vertexAttribPointer(z.uv,2,au.FLOAT,!1,16,8);au.bindBuffer(au.ELEMENT_ARRAY_BUFFER,S.elementBuffer);au.uniformMatrix4fv(aA.projectionMatrix,!1,r);au.activeTexture(au.TEXTURE0);au.uniform1i(aA.map,0);z=0;for(aI=aE.__webglSprites.length;z<aI;z++){if(aC=aE.__webglSprites[z],aC.visible&&aC.opacity!==0){aC.useScreenCoordinates?aC.z=-aC.position.z:(aC._modelViewMatrix.multiplyToArray(aF.matrixWorldInverse,aC.matrixWorld,aC._modelViewMatrixArray),aC.z=-aC._modelViewMatrix.n34)}}aE.__webglSprites.sort(w);z=0;for(aI=aE.__webglSprites.length;z<aI;z++){aC=aE.__webglSprites[z],aC.visible&&aC.opacity!==0&&aC.map&&aC.map.image&&aC.map.image.width&&(aC.useScreenCoordinates?(au.uniform1i(aA.useScreenCoordinates,1),au.uniform3f(aA.screenPosition,(aC.position.x-aH)/aH,(D-aC.position.y)/D,Math.max(0,Math.min(1,aC.position.z)))):(au.uniform1i(aA.useScreenCoordinates,0),au.uniform1i(aA.affectedByDistance,aC.affectedByDistance?1:0),au.uniformMatrix4fv(aA.modelViewMatrix,!1,aC._modelViewMatrixArray)),aF=aC.map.image.width/(aC.scaleByViewport?j:1),aJ[0]=aF*aB*aC.scale.x,aJ[1]=aF*aC.scale.y,au.uniform2f(aA.uvScale,aC.uvScale.x,aC.uvScale.y),au.uniform2f(aA.uvOffset,aC.uvOffset.x,aC.uvOffset.y),au.uniform2f(aA.alignment,aC.alignment.x,aC.alignment.y),au.uniform1f(aA.opacity,aC.opacity),au.uniform3f(aA.color,aC.color.r,aC.color.g,aC.color.b),au.uniform1f(aA.rotation,aC.rotation),au.uniform2fv(aA.scale,aJ),aC.mergeWith3D&&!C?(au.enable(au.DEPTH_TEST),C=!0):!aC.mergeWith3D&&C&&(au.disable(au.DEPTH_TEST),C=!1),av(aC.blending),A(aC.map,0),au.drawElements(au.TRIANGLES,6,au.UNSIGNED_SHORT,0))}au.enable(au.CULL_FACE);au.enable(au.DEPTH_TEST);au.depthMask(aT)}aG&&aG.minFilter!==c.NearestFilter&&aG.minFilter!==c.LinearFilter&&(aG instanceof c.WebGLRenderTargetCube?(au.bindTexture(au.TEXTURE_CUBE_MAP,aG.__webglTexture),au.generateMipmap(au.TEXTURE_CUBE_MAP),au.bindTexture(au.TEXTURE_CUBE_MAP,null)):(au.bindTexture(au.TEXTURE_2D,aG.__webglTexture),au.generateMipmap(au.TEXTURE_2D),au.bindTexture(au.TEXTURE_2D,null)))};this.initWebGLObjects=function(aL){if(!aL.__webglObjects){aL.__webglObjects=[],aL.__webglObjectsImmediate=[],aL.__webglSprites=[]}for(;aL.__objectsAdded.length;){var aN=aL.__objectsAdded[0],bb=aL,bg=void 0,bf=void 0,bd=void 0;if(!aN.__webglInit){if(aN.__webglInit=!0,aN._modelViewMatrix=new c.Matrix4,aN._normalMatrixArray=new Float32Array(9),aN._modelViewMatrixArray=new Float32Array(16),aN._objectMatrixArray=new Float32Array(16),aN.matrixWorld.flattenToArray(aN._objectMatrixArray),aN instanceof c.Mesh){bf=aN.geometry;if(bf.geometryGroups===void 0){var bd=bf,z=void 0,C=void 0,a0=void 0,aA=void 0,aD=void 0,bj=void 0,aB=void 0,aC={},aQ=bd.morphTargets.length;bd.geometryGroups={};z=0;for(C=bd.faces.length;z<C;z++){a0=bd.faces[z],aA=a0.materialIndex,bj=aA!==void 0?aA:-1,aC[bj]===void 0&&(aC[bj]={hash:bj,counter:0}),aB=aC[bj].hash+"_"+aC[bj].counter,bd.geometryGroups[aB]===void 0&&(bd.geometryGroups[aB]={faces3:[],faces4:[],materialIndex:aA,vertices:0,numMorphTargets:aQ}),aD=a0 instanceof c.Face3?3:4,bd.geometryGroups[aB].vertices+aD>65535&&(aC[bj].counter+=1,aB=aC[bj].hash+"_"+aC[bj].counter,bd.geometryGroups[aB]===void 0&&(bd.geometryGroups[aB]={faces3:[],faces4:[],materialIndex:aA,vertices:0,numMorphTargets:aQ})),a0 instanceof c.Face3?bd.geometryGroups[aB].faces3.push(z):bd.geometryGroups[aB].faces4.push(z),bd.geometryGroups[aB].vertices+=aD}bd.geometryGroupsList=[];z=void 0;for(z in bd.geometryGroups){bd.geometryGroups[z].id=g++,bd.geometryGroupsList.push(bd.geometryGroups[z])}}for(bg in bf.geometryGroups){if(bd=bf.geometryGroups[bg],!bd.__webglVertexBuffer){z=bd;z.__webglVertexBuffer=au.createBuffer();z.__webglNormalBuffer=au.createBuffer();z.__webglTangentBuffer=au.createBuffer();z.__webglColorBuffer=au.createBuffer();z.__webglUVBuffer=au.createBuffer();z.__webglUV2Buffer=au.createBuffer();z.__webglSkinVertexABuffer=au.createBuffer();z.__webglSkinVertexBBuffer=au.createBuffer();z.__webglSkinIndicesBuffer=au.createBuffer();z.__webglSkinWeightsBuffer=au.createBuffer();z.__webglFaceBuffer=au.createBuffer();z.__webglLineBuffer=au.createBuffer();if(z.numMorphTargets){a0=C=void 0;z.__webglMorphTargetsBuffers=[];C=0;for(a0=z.numMorphTargets;C<a0;C++){z.__webglMorphTargetsBuffers.push(au.createBuffer())}}V.info.memory.geometries++;aA=aN;aD=aA.geometry;C=bd.faces3;bj=bd.faces4;z=C.length*3+bj.length*4;a0=C.length*1+bj.length*2;bj=C.length*3+bj.length*4;C=k(aA,bd);aB=q(C);aC=o(C);aQ=t(C);bd.__vertexArray=new Float32Array(z*3);if(aC){bd.__normalArray=new Float32Array(z*3)}if(aD.hasTangents){bd.__tangentArray=new Float32Array(z*4)}if(aQ){bd.__colorArray=new Float32Array(z*3)}if(aB){if(aD.faceUvs.length>0||aD.faceVertexUvs.length>0){bd.__uvArray=new Float32Array(z*2)}if(aD.faceUvs.length>1||aD.faceVertexUvs.length>1){bd.__uv2Array=new Float32Array(z*2)}}if(aA.geometry.skinWeights.length&&aA.geometry.skinIndices.length){bd.__skinVertexAArray=new Float32Array(z*4),bd.__skinVertexBArray=new Float32Array(z*4),bd.__skinIndexArray=new Float32Array(z*4),bd.__skinWeightArray=new Float32Array(z*4)}bd.__faceArray=new Uint16Array(a0*3);bd.__lineArray=new Uint16Array(bj*2);if(bd.numMorphTargets){bd.__morphTargetsArrays=[];aA=0;for(aD=bd.numMorphTargets;aA<aD;aA++){bd.__morphTargetsArrays.push(new Float32Array(z*3))}}bd.__webglFaceCount=a0*3;bd.__webglLineCount=bj*2;if(C.attributes){if(bd.__webglCustomAttributesList===void 0){bd.__webglCustomAttributesList=[]}a0=void 0;for(a0 in C.attributes){var aA=C.attributes[a0],aD={},bn;for(bn in aA){aD[bn]=aA[bn]}if(!aD.__webglInitialized||aD.createUniqueBuffers){aD.__webglInitialized=!0,bj=1,aD.type==="v2"?bj=2:aD.type==="v3"?bj=3:aD.type==="v4"?bj=4:aD.type==="c"&&(bj=3),aD.size=bj,aD.array=new Float32Array(z*bj),aD.buffer=au.createBuffer(),aD.buffer.belongsToAttribute=a0,aA.needsUpdate=!0,aD.__original=aA}bd.__webglCustomAttributesList.push(aD)}}bd.__inittedArrays=!0;bf.__dirtyVertices=!0;bf.__dirtyMorphTargets=!0;bf.__dirtyElements=!0;bf.__dirtyUvs=!0;bf.__dirtyNormals=!0;bf.__dirtyTangents=!0;bf.__dirtyColors=!0}}}else{if(aN instanceof c.Ribbon){if(bf=aN.geometry,!bf.__webglVertexBuffer){bd=bf,bd.__webglVertexBuffer=au.createBuffer(),bd.__webglColorBuffer=au.createBuffer(),V.info.memory.geometries++,bd=bf,z=bd.vertices.length,bd.__vertexArray=new Float32Array(z*3),bd.__colorArray=new Float32Array(z*3),bd.__webglVertexCount=z,bf.__dirtyVertices=!0,bf.__dirtyColors=!0}}else{if(aN instanceof c.Line){if(bf=aN.geometry,!bf.__webglVertexBuffer){bd=bf,bd.__webglVertexBuffer=au.createBuffer(),bd.__webglColorBuffer=au.createBuffer(),V.info.memory.geometries++,bd=bf,z=aN,C=bd.vertices.length,bd.__vertexArray=new Float32Array(C*3),bd.__colorArray=new Float32Array(C*3),bd.__webglLineCount=C,m(bd,z),bf.__dirtyVertices=!0,bf.__dirtyColors=!0}}else{if(aN instanceof c.ParticleSystem&&(bf=aN.geometry,!bf.__webglVertexBuffer)){bd=bf,bd.__webglVertexBuffer=au.createBuffer(),bd.__webglColorBuffer=au.createBuffer(),V.info.geometries++,bd=bf,z=aN,C=bd.vertices.length,bd.__vertexArray=new Float32Array(C*3),bd.__colorArray=new Float32Array(C*3),bd.__sortArray=[],bd.__webglParticleCount=C,m(bd,z),bf.__dirtyVertices=!0,bf.__dirtyColors=!0}}}}}if(!aN.__webglActive){if(aN instanceof c.Mesh){for(bg in bf=aN.geometry,bf.geometryGroups){bd=bf.geometryGroups[bg],s(bb.__webglObjects,bd,aN)}}else{aN instanceof c.Ribbon||aN instanceof c.Line||aN instanceof c.ParticleSystem?(bf=aN.geometry,s(bb.__webglObjects,bf,aN)):c.MarchingCubes!==void 0&&aN instanceof c.MarchingCubes||aN.immediateRenderCallback?bb.__webglObjectsImmediate.push({object:aN,opaque:null,transparent:null}):aN instanceof c.Sprite&&bb.__webglSprites.push(aN)}aN.__webglActive=!0}aL.__objectsAdded.splice(0,1)}for(;aL.__objectsRemoved.length;){aN=aL.__objectsRemoved[0];bb=aL;if(aN instanceof c.Mesh||aN instanceof c.ParticleSystem||aN instanceof c.Ribbon||aN instanceof c.Line){aw(bb.__webglObjects,aN)}else{if(aN instanceof c.Sprite){bb=bb.__webglSprites;bg=aN;for(bf=bb.length-1;bf>=0;bf--){bb[bf]===bg&&bb.splice(bf,1)}}else{(aN instanceof c.MarchingCubes||aN.immediateRenderCallback)&&aw(bb.__webglObjectsImmediate,aN)}}aN.__webglActive=!1;aL.__objectsRemoved.splice(0,1)}aN=0;for(bb=aL.__webglObjects.length;aN<bb;aN++){if(bn=aL.__webglObjects[aN].object,bg=bn.geometry,bf=a0=C=void 0,bn instanceof c.Mesh){bd=0;for(z=bg.geometryGroupsList.length;bd<z;bd++){if(C=bg.geometryGroupsList[bd],bf=k(bn,C),a0=bf.attributes&&B(bf),bg.__dirtyVertices||bg.__dirtyMorphTargets||bg.__dirtyElements||bg.__dirtyUvs||bg.__dirtyNormals||bg.__dirtyColors||bg.__dirtyTangents||a0){var bv=bn,a0=au.DYNAMIC_DRAW,aA=!bg.dynamic,aB=bf;if(C.__inittedArrays){var aD=o(aB),bj=t(aB),bs=q(aB),aR=aD===c.SmoothShading,a5=aC=aB=void 0,bu=void 0,bx=void 0,aP=void 0,bz=void 0,br=void 0,bl=void 0,bw=a5=void 0,aJ=void 0,aF=void 0,a7=void 0,ba=bu=void 0,bB=void 0,aZ=void 0,a1=bu=bl=void 0,aW=void 0,a6=a7=aF=aJ=bz=void 0,aY=bu=a7=aF=aJ=a6=a7=aF=aJ=a6=a7=aF=aJ=void 0,a9=void 0,aH=aP=void 0,by=void 0,bA=void 0,bo=void 0,bq=void 0,aI=bw=bA=a9=0,bp=0,bk=aY=a5=0,bc=bz=ba=0,bt=0,aS=void 0,bc=C.__vertexArray,by=C.__uvArray,bt=C.__uv2Array,aH=C.__normalArray,bx=C.__tangentArray,bB=C.__colorArray,a1=C.__skinVertexAArray,aW=C.__skinVertexBArray,br=C.__skinIndexArray,a3=C.__skinWeightArray,a6=C.__morphTargetsArrays,aQ=C.__webglCustomAttributesList,aM=void 0,aM=C.__faceArray,aS=C.__lineArray,aZ=bv.geometry,D=aZ.__dirtyElements,a4=aZ.__dirtyUvs,aP=aZ.__dirtyNormals,bl=aZ.__dirtyTangents,aG=aZ.__dirtyColors,bo=aZ.__dirtyMorphTargets,bq=aZ.vertices,bv=C.faces3,bm=C.faces4,bh=aZ.faces,a2=aZ.faceVertexUvs[0],bi=aZ.faceVertexUvs[1],be=aZ.skinVerticesA,aK=aZ.skinVerticesB,aE=aZ.skinIndices,aO=aZ.skinWeights,a8=aZ.morphTargets;if(aZ.__dirtyVertices){aB=0;for(aC=bv.length;aB<aC;aB++){bu=bh[bv[aB]],aJ=bq[bu.a].position,aF=bq[bu.b].position,a7=bq[bu.c].position,bc[bA]=aJ.x,bc[bA+1]=aJ.y,bc[bA+2]=aJ.z,bc[bA+3]=aF.x,bc[bA+4]=aF.y,bc[bA+5]=aF.z,bc[bA+6]=a7.x,bc[bA+7]=a7.y,bc[bA+8]=a7.z,bA+=9}aB=0;for(aC=bm.length;aB<aC;aB++){bu=bh[bm[aB]],aJ=bq[bu.a].position,aF=bq[bu.b].position,a7=bq[bu.c].position,bu=bq[bu.d].position,bc[bA]=aJ.x,bc[bA+1]=aJ.y,bc[bA+2]=aJ.z,bc[bA+3]=aF.x,bc[bA+4]=aF.y,bc[bA+5]=aF.z,bc[bA+6]=a7.x,bc[bA+7]=a7.y,bc[bA+8]=a7.z,bc[bA+9]=bu.x,bc[bA+10]=bu.y,bc[bA+11]=bu.z,bA+=12}au.bindBuffer(au.ARRAY_BUFFER,C.__webglVertexBuffer);au.bufferData(au.ARRAY_BUFFER,bc,a0)}if(bo){bA=0;for(bo=a8.length;bA<bo;bA++){aB=bc=0;for(aC=bv.length;aB<aC;aB++){bu=bh[bv[aB]],aJ=a8[bA].vertices[bu.a].position,aF=a8[bA].vertices[bu.b].position,a7=a8[bA].vertices[bu.c].position,bq=a6[bA],bq[bc]=aJ.x,bq[bc+1]=aJ.y,bq[bc+2]=aJ.z,bq[bc+3]=aF.x,bq[bc+4]=aF.y,bq[bc+5]=aF.z,bq[bc+6]=a7.x,bq[bc+7]=a7.y,bq[bc+8]=a7.z,bc+=9}aB=0;for(aC=bm.length;aB<aC;aB++){bu=bh[bm[aB]],aJ=a8[bA].vertices[bu.a].position,aF=a8[bA].vertices[bu.b].position,a7=a8[bA].vertices[bu.c].position,bu=a8[bA].vertices[bu.d].position,bq=a6[bA],bq[bc]=aJ.x,bq[bc+1]=aJ.y,bq[bc+2]=aJ.z,bq[bc+3]=aF.x,bq[bc+4]=aF.y,bq[bc+5]=aF.z,bq[bc+6]=a7.x,bq[bc+7]=a7.y,bq[bc+8]=a7.z,bq[bc+9]=bu.x,bq[bc+10]=bu.y,bq[bc+11]=bu.z,bc+=12}au.bindBuffer(au.ARRAY_BUFFER,C.__webglMorphTargetsBuffers[bA]);au.bufferData(au.ARRAY_BUFFER,a6[bA],a0)}}if(aO.length){aB=0;for(aC=bv.length;aB<aC;aB++){bu=bh[bv[aB]],aJ=aO[bu.a],aF=aO[bu.b],a7=aO[bu.c],a3[bz]=aJ.x,a3[bz+1]=aJ.y,a3[bz+2]=aJ.z,a3[bz+3]=aJ.w,a3[bz+4]=aF.x,a3[bz+5]=aF.y,a3[bz+6]=aF.z,a3[bz+7]=aF.w,a3[bz+8]=a7.x,a3[bz+9]=a7.y,a3[bz+10]=a7.z,a3[bz+11]=a7.w,aJ=aE[bu.a],aF=aE[bu.b],a7=aE[bu.c],br[bz]=aJ.x,br[bz+1]=aJ.y,br[bz+2]=aJ.z,br[bz+3]=aJ.w,br[bz+4]=aF.x,br[bz+5]=aF.y,br[bz+6]=aF.z,br[bz+7]=aF.w,br[bz+8]=a7.x,br[bz+9]=a7.y,br[bz+10]=a7.z,br[bz+11]=a7.w,aJ=be[bu.a],aF=be[bu.b],a7=be[bu.c],a1[bz]=aJ.x,a1[bz+1]=aJ.y,a1[bz+2]=aJ.z,a1[bz+3]=1,a1[bz+4]=aF.x,a1[bz+5]=aF.y,a1[bz+6]=aF.z,a1[bz+7]=1,a1[bz+8]=a7.x,a1[bz+9]=a7.y,a1[bz+10]=a7.z,a1[bz+11]=1,aJ=aK[bu.a],aF=aK[bu.b],a7=aK[bu.c],aW[bz]=aJ.x,aW[bz+1]=aJ.y,aW[bz+2]=aJ.z,aW[bz+3]=1,aW[bz+4]=aF.x,aW[bz+5]=aF.y,aW[bz+6]=aF.z,aW[bz+7]=1,aW[bz+8]=a7.x,aW[bz+9]=a7.y,aW[bz+10]=a7.z,aW[bz+11]=1,bz+=12}aB=0;for(aC=bm.length;aB<aC;aB++){bu=bh[bm[aB]],aJ=aO[bu.a],aF=aO[bu.b],a7=aO[bu.c],a6=aO[bu.d],a3[bz]=aJ.x,a3[bz+1]=aJ.y,a3[bz+2]=aJ.z,a3[bz+3]=aJ.w,a3[bz+4]=aF.x,a3[bz+5]=aF.y,a3[bz+6]=aF.z,a3[bz+7]=aF.w,a3[bz+8]=a7.x,a3[bz+9]=a7.y,a3[bz+10]=a7.z,a3[bz+11]=a7.w,a3[bz+12]=a6.x,a3[bz+13]=a6.y,a3[bz+14]=a6.z,a3[bz+15]=a6.w,aJ=aE[bu.a],aF=aE[bu.b],a7=aE[bu.c],a6=aE[bu.d],br[bz]=aJ.x,br[bz+1]=aJ.y,br[bz+2]=aJ.z,br[bz+3]=aJ.w,br[bz+4]=aF.x,br[bz+5]=aF.y,br[bz+6]=aF.z,br[bz+7]=aF.w,br[bz+8]=a7.x,br[bz+9]=a7.y,br[bz+10]=a7.z,br[bz+11]=a7.w,br[bz+12]=a6.x,br[bz+13]=a6.y,br[bz+14]=a6.z,br[bz+15]=a6.w,aJ=be[bu.a],aF=be[bu.b],a7=be[bu.c],a6=be[bu.d],a1[bz]=aJ.x,a1[bz+1]=aJ.y,a1[bz+2]=aJ.z,a1[bz+3]=1,a1[bz+4]=aF.x,a1[bz+5]=aF.y,a1[bz+6]=aF.z,a1[bz+7]=1,a1[bz+8]=a7.x,a1[bz+9]=a7.y,a1[bz+10]=a7.z,a1[bz+11]=1,a1[bz+12]=a6.x,a1[bz+13]=a6.y,a1[bz+14]=a6.z,a1[bz+15]=1,aJ=aK[bu.a],aF=aK[bu.b],a7=aK[bu.c],bu=aK[bu.d],aW[bz]=aJ.x,aW[bz+1]=aJ.y,aW[bz+2]=aJ.z,aW[bz+3]=1,aW[bz+4]=aF.x,aW[bz+5]=aF.y,aW[bz+6]=aF.z,aW[bz+7]=1,aW[bz+8]=a7.x,aW[bz+9]=a7.y,aW[bz+10]=a7.z,aW[bz+11]=1,aW[bz+12]=bu.x,aW[bz+13]=bu.y,aW[bz+14]=bu.z,aW[bz+15]=1,bz+=16}bz>0&&(au.bindBuffer(au.ARRAY_BUFFER,C.__webglSkinVertexABuffer),au.bufferData(au.ARRAY_BUFFER,a1,a0),au.bindBuffer(au.ARRAY_BUFFER,C.__webglSkinVertexBBuffer),au.bufferData(au.ARRAY_BUFFER,aW,a0),au.bindBuffer(au.ARRAY_BUFFER,C.__webglSkinIndicesBuffer),au.bufferData(au.ARRAY_BUFFER,br,a0),au.bindBuffer(au.ARRAY_BUFFER,C.__webglSkinWeightsBuffer),au.bufferData(au.ARRAY_BUFFER,a3,a0))}if(aG&&bj){aB=0;for(aC=bv.length;aB<aC;aB++){bu=bh[bv[aB]],bz=bu.vertexColors,br=bu.color,bz.length===3&&bj===c.VertexColors?(bu=bz[0],a1=bz[1],aW=bz[2]):aW=a1=bu=br,bB[ba]=bu.r,bB[ba+1]=bu.g,bB[ba+2]=bu.b,bB[ba+3]=a1.r,bB[ba+4]=a1.g,bB[ba+5]=a1.b,bB[ba+6]=aW.r,bB[ba+7]=aW.g,bB[ba+8]=aW.b,ba+=9}aB=0;for(aC=bm.length;aB<aC;aB++){bu=bh[bm[aB]],bz=bu.vertexColors,br=bu.color,bz.length===4&&bj===c.VertexColors?(bu=bz[0],a1=bz[1],aW=bz[2],bz=bz[3]):bz=aW=a1=bu=br,bB[ba]=bu.r,bB[ba+1]=bu.g,bB[ba+2]=bu.b,bB[ba+3]=a1.r,bB[ba+4]=a1.g,bB[ba+5]=a1.b,bB[ba+6]=aW.r,bB[ba+7]=aW.g,bB[ba+8]=aW.b,bB[ba+9]=bz.r,bB[ba+10]=bz.g,bB[ba+11]=bz.b,ba+=12}ba>0&&(au.bindBuffer(au.ARRAY_BUFFER,C.__webglColorBuffer),au.bufferData(au.ARRAY_BUFFER,bB,a0))}if(bl&&aZ.hasTangents){aB=0;for(aC=bv.length;aB<aC;aB++){bu=bh[bv[aB]],bl=bu.vertexTangents,ba=bl[0],bB=bl[1],aZ=bl[2],bx[aY]=ba.x,bx[aY+1]=ba.y,bx[aY+2]=ba.z,bx[aY+3]=ba.w,bx[aY+4]=bB.x,bx[aY+5]=bB.y,bx[aY+6]=bB.z,bx[aY+7]=bB.w,bx[aY+8]=aZ.x,bx[aY+9]=aZ.y,bx[aY+10]=aZ.z,bx[aY+11]=aZ.w,aY+=12}aB=0;for(aC=bm.length;aB<aC;aB++){bu=bh[bm[aB]],bl=bu.vertexTangents,ba=bl[0],bB=bl[1],aZ=bl[2],bl=bl[3],bx[aY]=ba.x,bx[aY+1]=ba.y,bx[aY+2]=ba.z,bx[aY+3]=ba.w,bx[aY+4]=bB.x,bx[aY+5]=bB.y,bx[aY+6]=bB.z,bx[aY+7]=bB.w,bx[aY+8]=aZ.x,bx[aY+9]=aZ.y,bx[aY+10]=aZ.z,bx[aY+11]=aZ.w,bx[aY+12]=bl.x,bx[aY+13]=bl.y,bx[aY+14]=bl.z,bx[aY+15]=bl.w,aY+=16}au.bindBuffer(au.ARRAY_BUFFER,C.__webglTangentBuffer);au.bufferData(au.ARRAY_BUFFER,bx,a0)}if(aP&&aD){aB=0;for(aC=bv.length;aB<aC;aB++){if(bu=bh[bv[aB]],bx=bu.vertexNormals,aP=bu.normal,bx.length===3&&aR){for(aY=0;aY<3;aY++){aP=bx[aY],aH[a5]=aP.x,aH[a5+1]=aP.y,aH[a5+2]=aP.z,a5+=3}}else{for(aY=0;aY<3;aY++){aH[a5]=aP.x,aH[a5+1]=aP.y,aH[a5+2]=aP.z,a5+=3}}}aB=0;for(aC=bm.length;aB<aC;aB++){if(bu=bh[bm[aB]],bx=bu.vertexNormals,aP=bu.normal,bx.length===4&&aR){for(aY=0;aY<4;aY++){aP=bx[aY],aH[a5]=aP.x,aH[a5+1]=aP.y,aH[a5+2]=aP.z,a5+=3}}else{for(aY=0;aY<4;aY++){aH[a5]=aP.x,aH[a5+1]=aP.y,aH[a5+2]=aP.z,a5+=3}}}au.bindBuffer(au.ARRAY_BUFFER,C.__webglNormalBuffer);au.bufferData(au.ARRAY_BUFFER,aH,a0)}if(a4&&a2&&bs){aB=0;for(aC=bv.length;aB<aC;aB++){if(a5=bv[aB],a5=a2[a5],a5!==void 0){for(aY=0;aY<3;aY++){aH=a5[aY],by[bw]=aH.u,by[bw+1]=aH.v,bw+=2}}}aB=0;for(aC=bm.length;aB<aC;aB++){if(a5=bm[aB],a5=a2[a5],a5!==void 0){for(aY=0;aY<4;aY++){aH=a5[aY],by[bw]=aH.u,by[bw+1]=aH.v,bw+=2}}}bw>0&&(au.bindBuffer(au.ARRAY_BUFFER,C.__webglUVBuffer),au.bufferData(au.ARRAY_BUFFER,by,a0))}if(a4&&bi&&bs){aB=0;for(aC=bv.length;aB<aC;aB++){if(a5=bv[aB],bw=bi[a5],bw!==void 0){for(aY=0;aY<3;aY++){by=bw[aY],bt[aI]=by.u,bt[aI+1]=by.v,aI+=2}}}aB=0;for(aC=bm.length;aB<aC;aB++){if(a5=bm[aB],bw=bi[a5],bw!==void 0){for(aY=0;aY<4;aY++){by=bw[aY],bt[aI]=by.u,bt[aI+1]=by.v,aI+=2}}}aI>0&&(au.bindBuffer(au.ARRAY_BUFFER,C.__webglUV2Buffer),au.bufferData(au.ARRAY_BUFFER,bt,a0))}if(D){aB=0;for(aC=bv.length;aB<aC;aB++){aM[bp]=a9,aM[bp+1]=a9+1,aM[bp+2]=a9+2,bp+=3,aS[bk]=a9,aS[bk+1]=a9+1,aS[bk+2]=a9,aS[bk+3]=a9+2,aS[bk+4]=a9+1,aS[bk+5]=a9+2,bk+=6,a9+=3}aB=0;for(aC=bm.length;aB<aC;aB++){aM[bp]=a9,aM[bp+1]=a9+1,aM[bp+2]=a9+3,aM[bp+3]=a9+1,aM[bp+4]=a9+2,aM[bp+5]=a9+3,bp+=6,aS[bk]=a9,aS[bk+1]=a9+1,aS[bk+2]=a9,aS[bk+3]=a9+3,aS[bk+4]=a9+1,aS[bk+5]=a9+2,aS[bk+6]=a9+2,aS[bk+7]=a9+3,bk+=8,a9+=4}au.bindBuffer(au.ELEMENT_ARRAY_BUFFER,C.__webglFaceBuffer);au.bufferData(au.ELEMENT_ARRAY_BUFFER,aM,a0);au.bindBuffer(au.ELEMENT_ARRAY_BUFFER,C.__webglLineBuffer);au.bufferData(au.ELEMENT_ARRAY_BUFFER,aS,a0)}if(aQ){aY=0;for(a9=aQ.length;aY<a9;aY++){if(aM=aQ[aY],aM.__original.needsUpdate){bt=0;if(aM.size===1){if(aM.boundTo===void 0||aM.boundTo==="vertices"){aB=0;for(aC=bv.length;aB<aC;aB++){bu=bh[bv[aB]],aM.array[bt]=aM.value[bu.a],aM.array[bt+1]=aM.value[bu.b],aM.array[bt+2]=aM.value[bu.c],bt+=3}aB=0;for(aC=bm.length;aB<aC;aB++){bu=bh[bm[aB]],aM.array[bt]=aM.value[bu.a],aM.array[bt+1]=aM.value[bu.b],aM.array[bt+2]=aM.value[bu.c],aM.array[bt+3]=aM.value[bu.d],bt+=4}}else{if(aM.boundTo==="faces"){aB=0;for(aC=bv.length;aB<aC;aB++){aS=aM.value[bv[aB]],aM.array[bt]=aS,aM.array[bt+1]=aS,aM.array[bt+2]=aS,bt+=3}aB=0;for(aC=bm.length;aB<aC;aB++){aS=aM.value[bm[aB]],aM.array[bt]=aS,aM.array[bt+1]=aS,aM.array[bt+2]=aS,aM.array[bt+3]=aS,bt+=4}}}}else{if(aM.size===2){if(aM.boundTo===void 0||aM.boundTo==="vertices"){aB=0;for(aC=bv.length;aB<aC;aB++){bu=bh[bv[aB]],aJ=aM.value[bu.a],aF=aM.value[bu.b],a7=aM.value[bu.c],aM.array[bt]=aJ.x,aM.array[bt+1]=aJ.y,aM.array[bt+2]=aF.x,aM.array[bt+3]=aF.y,aM.array[bt+4]=a7.x,aM.array[bt+5]=a7.y,bt+=6}aB=0;for(aC=bm.length;aB<aC;aB++){bu=bh[bm[aB]],aJ=aM.value[bu.a],aF=aM.value[bu.b],a7=aM.value[bu.c],bu=aM.value[bu.d],aM.array[bt]=aJ.x,aM.array[bt+1]=aJ.y,aM.array[bt+2]=aF.x,aM.array[bt+3]=aF.y,aM.array[bt+4]=a7.x,aM.array[bt+5]=a7.y,aM.array[bt+6]=bu.x,aM.array[bt+7]=bu.y,bt+=8}}else{if(aM.boundTo==="faces"){aB=0;for(aC=bv.length;aB<aC;aB++){a7=aF=aJ=aS=aM.value[bv[aB]],aM.array[bt]=aJ.x,aM.array[bt+1]=aJ.y,aM.array[bt+2]=aF.x,aM.array[bt+3]=aF.y,aM.array[bt+4]=a7.x,aM.array[bt+5]=a7.y,bt+=6}aB=0;for(aC=bm.length;aB<aC;aB++){bu=a7=aF=aJ=aS=aM.value[bm[aB]],aM.array[bt]=aJ.x,aM.array[bt+1]=aJ.y,aM.array[bt+2]=aF.x,aM.array[bt+3]=aF.y,aM.array[bt+4]=a7.x,aM.array[bt+5]=a7.y,aM.array[bt+6]=bu.x,aM.array[bt+7]=bu.y,bt+=8}}}}else{if(aM.size===3){if(aD=aM.type==="c"?["r","g","b"]:["x","y","z"],aM.boundTo===void 0||aM.boundTo==="vertices"){aB=0;for(aC=bv.length;aB<aC;aB++){bu=bh[bv[aB]],aJ=aM.value[bu.a],aF=aM.value[bu.b],a7=aM.value[bu.c],aM.array[bt]=aJ[aD[0]],aM.array[bt+1]=aJ[aD[1]],aM.array[bt+2]=aJ[aD[2]],aM.array[bt+3]=aF[aD[0]],aM.array[bt+4]=aF[aD[1]],aM.array[bt+5]=aF[aD[2]],aM.array[bt+6]=a7[aD[0]],aM.array[bt+7]=a7[aD[1]],aM.array[bt+8]=a7[aD[2]],bt+=9}aB=0;for(aC=bm.length;aB<aC;aB++){bu=bh[bm[aB]],aJ=aM.value[bu.a],aF=aM.value[bu.b],a7=aM.value[bu.c],bu=aM.value[bu.d],aM.array[bt]=aJ[aD[0]],aM.array[bt+1]=aJ[aD[1]],aM.array[bt+2]=aJ[aD[2]],aM.array[bt+3]=aF[aD[0]],aM.array[bt+4]=aF[aD[1]],aM.array[bt+5]=aF[aD[2]],aM.array[bt+6]=a7[aD[0]],aM.array[bt+7]=a7[aD[1]],aM.array[bt+8]=a7[aD[2]],aM.array[bt+9]=bu[aD[0]],aM.array[bt+10]=bu[aD[1]],aM.array[bt+11]=bu[aD[2]],bt+=12}}else{if(aM.boundTo==="faces"){aB=0;for(aC=bv.length;aB<aC;aB++){a7=aF=aJ=aS=aM.value[bv[aB]],aM.array[bt]=aJ[aD[0]],aM.array[bt+1]=aJ[aD[1]],aM.array[bt+2]=aJ[aD[2]],aM.array[bt+3]=aF[aD[0]],aM.array[bt+4]=aF[aD[1]],aM.array[bt+5]=aF[aD[2]],aM.array[bt+6]=a7[aD[0]],aM.array[bt+7]=a7[aD[1]],aM.array[bt+8]=a7[aD[2]],bt+=9}aB=0;for(aC=bm.length;aB<aC;aB++){bu=a7=aF=aJ=aS=aM.value[bm[aB]],aM.array[bt]=aJ[aD[0]],aM.array[bt+1]=aJ[aD[1]],aM.array[bt+2]=aJ[aD[2]],aM.array[bt+3]=aF[aD[0]],aM.array[bt+4]=aF[aD[1]],aM.array[bt+5]=aF[aD[2]],aM.array[bt+6]=a7[aD[0]],aM.array[bt+7]=a7[aD[1]],aM.array[bt+8]=a7[aD[2]],aM.array[bt+9]=bu[aD[0]],aM.array[bt+10]=bu[aD[1]],aM.array[bt+11]=bu[aD[2]],bt+=12}}}}else{if(aM.size===4){if(aM.boundTo===void 0||aM.boundTo==="vertices"){aB=0;for(aC=bv.length;aB<aC;aB++){bu=bh[bv[aB]],aJ=aM.value[bu.a],aF=aM.value[bu.b],a7=aM.value[bu.c],aM.array[bt]=aJ.x,aM.array[bt+1]=aJ.y,aM.array[bt+2]=aJ.z,aM.array[bt+3]=aJ.w,aM.array[bt+4]=aF.x,aM.array[bt+5]=aF.y,aM.array[bt+6]=aF.z,aM.array[bt+7]=aF.w,aM.array[bt+8]=a7.x,aM.array[bt+9]=a7.y,aM.array[bt+10]=a7.z,aM.array[bt+11]=a7.w,bt+=12}aB=0;for(aC=bm.length;aB<aC;aB++){bu=bh[bm[aB]],aJ=aM.value[bu.a],aF=aM.value[bu.b],a7=aM.value[bu.c],bu=aM.value[bu.d],aM.array[bt]=aJ.x,aM.array[bt+1]=aJ.y,aM.array[bt+2]=aJ.z,aM.array[bt+3]=aJ.w,aM.array[bt+4]=aF.x,aM.array[bt+5]=aF.y,aM.array[bt+6]=aF.z,aM.array[bt+7]=aF.w,aM.array[bt+8]=a7.x,aM.array[bt+9]=a7.y,aM.array[bt+10]=a7.z,aM.array[bt+11]=a7.w,aM.array[bt+12]=bu.x,aM.array[bt+13]=bu.y,aM.array[bt+14]=bu.z,aM.array[bt+15]=bu.w,bt+=16}}else{if(aM.boundTo==="faces"){aB=0;for(aC=bv.length;aB<aC;aB++){a7=aF=aJ=aS=aM.value[bv[aB]],aM.array[bt]=aJ.x,aM.array[bt+1]=aJ.y,aM.array[bt+2]=aJ.z,aM.array[bt+3]=aJ.w,aM.array[bt+4]=aF.x,aM.array[bt+5]=aF.y,aM.array[bt+6]=aF.z,aM.array[bt+7]=aF.w,aM.array[bt+8]=a7.x,aM.array[bt+9]=a7.y,aM.array[bt+10]=a7.z,aM.array[bt+11]=a7.w,bt+=12}aB=0;for(aC=bm.length;aB<aC;aB++){bu=a7=aF=aJ=aS=aM.value[bm[aB]],aM.array[bt]=aJ.x,aM.array[bt+1]=aJ.y,aM.array[bt+2]=aJ.z,aM.array[bt+3]=aJ.w,aM.array[bt+4]=aF.x,aM.array[bt+5]=aF.y,aM.array[bt+6]=aF.z,aM.array[bt+7]=aF.w,aM.array[bt+8]=a7.x,aM.array[bt+9]=a7.y,aM.array[bt+10]=a7.z,aM.array[bt+11]=a7.w,aM.array[bt+12]=bu.x,aM.array[bt+13]=bu.y,aM.array[bt+14]=bu.z,aM.array[bt+15]=bu.w,bt+=16}}}}}}}au.bindBuffer(au.ARRAY_BUFFER,aM.buffer);au.bufferData(au.ARRAY_BUFFER,aM.array,a0)}}}aA&&(delete C.__inittedArrays,delete C.__colorArray,delete C.__normalArray,delete C.__tangentArray,delete C.__uvArray,delete C.__uv2Array,delete C.__faceArray,delete C.__vertexArray,delete C.__lineArray,delete C.__skinVertexAArray,delete C.__skinVertexBArray,delete C.__skinIndexArray,delete C.__skinWeightArray)}}}bg.__dirtyVertices=!1;bg.__dirtyMorphTargets=!1;bg.__dirtyElements=!1;bg.__dirtyUvs=!1;bg.__dirtyNormals=!1;bg.__dirtyColors=!1;bg.__dirtyTangents=!1;bf.attributes&&I(bf)}else{if(bn instanceof c.Ribbon){if(bg.__dirtyVertices||bg.__dirtyColors){bf=bg;bn=au.DYNAMIC_DRAW;aD=bd=aD=aA=aA=void 0;bj=bf.vertices;z=bf.colors;aB=bj.length;C=z.length;aC=bf.__vertexArray;a0=bf.__colorArray;aQ=bf.__dirtyColors;if(bf.__dirtyVertices){for(aA=0;aA<aB;aA++){aD=bj[aA].position,bd=aA*3,aC[bd]=aD.x,aC[bd+1]=aD.y,aC[bd+2]=aD.z}au.bindBuffer(au.ARRAY_BUFFER,bf.__webglVertexBuffer);au.bufferData(au.ARRAY_BUFFER,aC,bn)}if(aQ){for(aA=0;aA<C;aA++){aD=z[aA],bd=aA*3,a0[bd]=aD.r,a0[bd+1]=aD.g,a0[bd+2]=aD.b}au.bindBuffer(au.ARRAY_BUFFER,bf.__webglColorBuffer);au.bufferData(au.ARRAY_BUFFER,a0,bn)}}bg.__dirtyVertices=!1;bg.__dirtyColors=!1}else{if(bn instanceof c.Line){bf=k(bn,C);a0=bf.attributes&&B(bf);if(bg.__dirtyVertices||bg.__dirtyColors||a0){bn=bg;bd=au.DYNAMIC_DRAW;aB=z=aR=bj=bs=void 0;bj=bn.vertices;C=bn.colors;aB=bj.length;a0=C.length;aC=bn.__vertexArray;aA=bn.__colorArray;aQ=bn.__dirtyColors;aD=bn.__webglCustomAttributesList;a9=bh=bm=bv=aR=bs=void 0;if(bn.__dirtyVertices){for(bs=0;bs<aB;bs++){aR=bj[bs].position,z=bs*3,aC[z]=aR.x,aC[z+1]=aR.y,aC[z+2]=aR.z}au.bindBuffer(au.ARRAY_BUFFER,bn.__webglVertexBuffer);au.bufferData(au.ARRAY_BUFFER,aC,bd)}if(aQ){for(bj=0;bj<a0;bj++){aB=C[bj],z=bj*3,aA[z]=aB.r,aA[z+1]=aB.g,aA[z+2]=aB.b}au.bindBuffer(au.ARRAY_BUFFER,bn.__webglColorBuffer);au.bufferData(au.ARRAY_BUFFER,aA,bd)}if(aD){bs=0;for(aR=aD.length;bs<aR;bs++){if(a9=aD[bs],a9.needsUpdate&&(a9.boundTo===void 0||a9.boundTo==="vertices")){z=0;bm=a9.value.length;if(a9.size===1){for(bv=0;bv<bm;bv++){a9.array[bv]=a9.value[bv]}}else{if(a9.size===2){for(bv=0;bv<bm;bv++){bh=a9.value[bv],a9.array[z]=bh.x,a9.array[z+1]=bh.y,z+=2}}else{if(a9.size===3){if(a9.type==="c"){for(bv=0;bv<bm;bv++){bh=a9.value[bv],a9.array[z]=bh.r,a9.array[z+1]=bh.g,a9.array[z+2]=bh.b,z+=3}}else{for(bv=0;bv<bm;bv++){bh=a9.value[bv],a9.array[z]=bh.x,a9.array[z+1]=bh.y,a9.array[z+2]=bh.z,z+=3}}}else{if(a9.size===4){for(bv=0;bv<bm;bv++){bh=a9.value[bv],a9.array[z]=bh.x,a9.array[z+1]=bh.y,a9.array[z+2]=bh.z,a9.array[z+3]=bh.w,z+=4}}}}}au.bindBuffer(au.ARRAY_BUFFER,a9.buffer);au.bufferData(au.ARRAY_BUFFER,a9.array,bd)}}}}bg.__dirtyVertices=!1;bg.__dirtyColors=!1;bf.attributes&&I(bf)}else{if(bn instanceof c.ParticleSystem){bf=k(bn,C),a0=bf.attributes&&B(bf),(bg.__dirtyVertices||bg.__dirtyColors||bn.sortParticles||a0)&&p(bg,au.DYNAMIC_DRAW,bn),bg.__dirtyVertices=!1,bg.__dirtyColors=!1,bf.attributes&&I(bf)}}}}}};this.initMaterial=function(aF,aH,aL,aJ){var aC,D,aB,aD;aF instanceof c.MeshDepthMaterial?aD="depth":aF instanceof c.MeshNormalMaterial?aD="normal":aF instanceof c.MeshBasicMaterial?aD="basic":aF instanceof c.MeshLambertMaterial?aD="lambert":aF instanceof c.MeshPhongMaterial?aD="phong":aF instanceof c.LineBasicMaterial?aD="basic":aF instanceof c.ParticleBasicMaterial&&(aD="particle_basic");if(aD){var aE=c.ShaderLib[aD];aF.uniforms=c.UniformsUtils.clone(aE.uniforms);aF.vertexShader=aE.vertexShader;aF.fragmentShader=aE.fragmentShader}var aG,aK,z;aG=z=aE=0;for(aK=aH.length;aG<aK;aG++){aB=aH[aG],aB instanceof c.SpotLight&&z++,aB instanceof c.DirectionalLight&&z++,aB instanceof c.PointLight&&aE++}aE+z<=aa?aG=z:(aG=Math.ceil(aa*z/(aE+z)),aE=aa-aG);aB={directional:aG,point:aE};aE=z=0;for(aG=aH.length;aE<aG;aE++){aK=aH[aE],aK instanceof c.SpotLight&&aK.castShadow&&z++}var C=50;if(aJ!==void 0&&aJ instanceof c.SkinnedMesh){C=aJ.bones.length}var aI;aF:{aG=aF.fragmentShader;aK=aF.vertexShader;var aE=aF.uniforms,aH=aF.attributes,aL={map:!!aF.map,envMap:!!aF.envMap,lightMap:!!aF.lightMap,vertexColors:aF.vertexColors,fog:aL,useFog:aF.fog,sizeAttenuation:aF.sizeAttenuation,skinning:aF.skinning,morphTargets:aF.morphTargets,maxMorphTargets:this.maxMorphTargets,maxDirLights:aB.directional,maxPointLights:aB.point,maxBones:C,shadowMapEnabled:this.shadowMapEnabled&&aJ.receiveShadow,shadowMapSoft:this.shadowMapSoft,shadowMapWidth:this.shadowMapWidth,shadowMapHeight:this.shadowMapHeight,maxShadows:z,alphaTest:aF.alphaTest,metal:aF.metal,perPixel:aF.perPixel},aA,aJ=[];aD?aJ.push(aD):(aJ.push(aG),aJ.push(aK));for(aA in aL){aJ.push(aA),aJ.push(aL[aA])}aD=aJ.join();aA=0;for(aJ=W.length;aA<aJ;aA++){if(W[aA].code===aD){aI=W[aA].program;break aF}}aA=au.createProgram();aJ=[ai?"#define VERTEX_TEXTURES":"",V.gammaInput?"#define GAMMA_INPUT":"",V.gammaOutput?"#define GAMMA_OUTPUT":"",V.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"","#define MAX_DIR_LIGHTS "+aL.maxDirLights,"#define MAX_POINT_LIGHTS "+aL.maxPointLights,"#define MAX_SHADOWS "+aL.maxShadows,"#define MAX_BONES "+aL.maxBones,aL.map?"#define USE_MAP":"",aL.envMap?"#define USE_ENVMAP":"",aL.lightMap?"#define USE_LIGHTMAP":"",aL.vertexColors?"#define USE_COLOR":"",aL.skinning?"#define USE_SKINNING":"",aL.morphTargets?"#define USE_MORPHTARGETS":"",aL.perPixel?"#define PHONG_PER_PIXEL":"",aL.shadowMapEnabled?"#define USE_SHADOWMAP":"",aL.shadowMapSoft?"#define SHADOWMAP_SOFT":"",aL.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 objectMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nuniform mat4 cameraInverseMatrix;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n#ifdef USE_COLOR\nattribute vec3 color;\n#endif\n#ifdef USE_MORPHTARGETS\nattribute vec3 morphTarget0;\nattribute vec3 morphTarget1;\nattribute vec3 morphTarget2;\nattribute vec3 morphTarget3;\nattribute vec3 morphTarget4;\nattribute vec3 morphTarget5;\nattribute vec3 morphTarget6;\nattribute vec3 morphTarget7;\n#endif\n#ifdef USE_SKINNING\nattribute vec4 skinVertexA;\nattribute vec4 skinVertexB;\nattribute vec4 skinIndex;\nattribute vec4 skinWeight;\n#endif\n"].join("\n");aB=["#ifdef GL_ES","precision "+an+" float;","#endif","#define MAX_DIR_LIGHTS "+aL.maxDirLights,"#define MAX_POINT_LIGHTS "+aL.maxPointLights,"#define MAX_SHADOWS "+aL.maxShadows,aL.alphaTest?"#define ALPHATEST "+aL.alphaTest:"",V.gammaInput?"#define GAMMA_INPUT":"",V.gammaOutput?"#define GAMMA_OUTPUT":"",V.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"",aL.useFog&&aL.fog?"#define USE_FOG":"",aL.useFog&&aL.fog instanceof c.FogExp2?"#define FOG_EXP2":"",aL.map?"#define USE_MAP":"",aL.envMap?"#define USE_ENVMAP":"",aL.lightMap?"#define USE_LIGHTMAP":"",aL.vertexColors?"#define USE_COLOR":"",aL.metal?"#define METAL":"",aL.perPixel?"#define PHONG_PER_PIXEL":"",aL.shadowMapEnabled?"#define USE_SHADOWMAP":"",aL.shadowMapSoft?"#define SHADOWMAP_SOFT":"",aL.shadowMapSoft?"#define SHADOWMAP_WIDTH "+aL.shadowMapWidth.toFixed(1):"",aL.shadowMapSoft?"#define SHADOWMAP_HEIGHT "+aL.shadowMapHeight.toFixed(1):"","uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n");au.attachShader(aA,ac("fragment",aB+aG));au.attachShader(aA,ac("vertex",aJ+aK));au.linkProgram(aA);au.getProgramParameter(aA,au.LINK_STATUS)||console.error("Could not initialise shader\nVALIDATE_STATUS: "+au.getProgramParameter(aA,au.VALIDATE_STATUS)+", gl error ["+au.getError()+"]");aA.uniforms={};aA.attributes={};var aM,aJ=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","objectMatrix","cameraPosition","cameraInverseMatrix","boneGlobalMatrices","morphTargetInfluences"];for(aM in aE){aJ.push(aM)}aM=aJ;aJ=0;for(aE=aM.length;aJ<aE;aJ++){aG=aM[aJ],aA.uniforms[aG]=au.getUniformLocation(aA,aG)}aJ=["position","normal","uv","uv2","tangent","color","skinVertexA","skinVertexB","skinIndex","skinWeight"];for(aM=0;aM<aL.maxMorphTargets;aM++){aJ.push("morphTarget"+aM)}for(aI in aH){aJ.push(aI)}aI=aJ;aM=0;for(aH=aI.length;aM<aH;aM++){aL=aI[aM],aA.attributes[aL]=au.getAttribLocation(aA,aL)}aA.id=W.length;W.push({program:aA,code:aD});V.info.memory.programs=W.length;aI=aA}aF.program=aI;aI=aF.program.attributes;aI.position>=0&&au.enableVertexAttribArray(aI.position);aI.color>=0&&au.enableVertexAttribArray(aI.color);aI.normal>=0&&au.enableVertexAttribArray(aI.normal);aI.tangent>=0&&au.enableVertexAttribArray(aI.tangent);aF.skinning&&aI.skinVertexA>=0&&aI.skinVertexB>=0&&aI.skinIndex>=0&&aI.skinWeight>=0&&(au.enableVertexAttribArray(aI.skinVertexA),au.enableVertexAttribArray(aI.skinVertexB),au.enableVertexAttribArray(aI.skinIndex),au.enableVertexAttribArray(aI.skinWeight));if(aF.attributes){for(D in aF.attributes){aI[D]!==void 0&&aI[D]>=0&&au.enableVertexAttribArray(aI[D])}}if(aF.morphTargets){for(D=aF.numSupportedMorphTargets=0;D<this.maxMorphTargets;D++){aM="morphTarget"+D,aI[aM]>=0&&(au.enableVertexAttribArray(aI[aM]),aF.numSupportedMorphTargets++)}}aF.uniformsList=[];for(aC in aF.uniforms){aF.uniformsList.push([aF.uniforms[aC],aC])}};this.setFaceCulling=function(z,C){z?(!C||C==="ccw"?au.frontFace(au.CCW):au.frontFace(au.CW),z==="back"?au.cullFace(au.BACK):z==="front"?au.cullFace(au.FRONT):au.cullFace(au.FRONT_AND_BACK),au.enable(au.CULL_FACE)):au.disable(au.CULL_FACE)}};c.WebGLRenderTarget=function(f,b,a){this.width=f;this.height=b;a=a||{};this.wrapS=a.wrapS!==void 0?a.wrapS:c.ClampToEdgeWrapping;this.wrapT=a.wrapT!==void 0?a.wrapT:c.ClampToEdgeWrapping;this.magFilter=a.magFilter!==void 0?a.magFilter:c.LinearFilter;this.minFilter=a.minFilter!==void 0?a.minFilter:c.LinearMipMapLinearFilter;this.offset=new c.Vector2(0,0);this.repeat=new c.Vector2(1,1);this.format=a.format!==void 0?a.format:c.RGBAFormat;this.type=a.type!==void 0?a.type:c.UnsignedByteType;this.depthBuffer=a.depthBuffer!==void 0?a.depthBuffer:!0;this.stencilBuffer=a.stencilBuffer!==void 0?a.stencilBuffer:!0};c.WebGLRenderTarget.prototype.clone=function(){var a=new c.WebGLRenderTarget(this.width,this.height);a.wrapS=this.wrapS;a.wrapT=this.wrapT;a.magFilter=this.magFilter;a.minFilter=this.minFilter;a.offset.copy(this.offset);a.repeat.copy(this.repeat);a.format=this.format;a.type=this.type;a.depthBuffer=this.depthBuffer;a.stencilBuffer=this.stencilBuffer;return a};c.WebGLRenderTargetCube=function(f,b,a){c.WebGLRenderTarget.call(this,f,b,a);this.activeCubeFace=0};c.WebGLRenderTargetCube.prototype=new c.WebGLRenderTarget;c.WebGLRenderTargetCube.prototype.constructor=c.WebGLRenderTargetCube;c.RenderableVertex=function(){this.positionWorld=new c.Vector3;this.positionScreen=new c.Vector4;this.visible=!0};c.RenderableVertex.prototype.copy=function(a){this.positionWorld.copy(a.positionWorld);this.positionScreen.copy(a.positionScreen)};c.RenderableFace3=function(){this.v1=new c.RenderableVertex;this.v2=new c.RenderableVertex;this.v3=new c.RenderableVertex;this.centroidWorld=new c.Vector3;this.centroidScreen=new c.Vector3;this.normalWorld=new c.Vector3;this.vertexNormalsWorld=[new c.Vector3,new c.Vector3,new c.Vector3];this.faceMaterial=this.material=null;this.uvs=[[]];this.z=null};c.RenderableFace4=function(){this.v1=new c.RenderableVertex;this.v2=new c.RenderableVertex;this.v3=new c.RenderableVertex;this.v4=new c.RenderableVertex;this.centroidWorld=new c.Vector3;this.centroidScreen=new c.Vector3;this.normalWorld=new c.Vector3;this.vertexNormalsWorld=[new c.Vector3,new c.Vector3,new c.Vector3,new c.Vector3];this.faceMaterial=this.material=null;this.uvs=[[]];this.z=null};c.RenderableObject=function(){this.z=this.object=null};c.RenderableParticle=function(){this.rotation=this.z=this.y=this.x=null;this.scale=new c.Vector2;this.material=null};c.RenderableLine=function(){this.z=null;this.v1=new c.RenderableVertex;this.v2=new c.RenderableVertex;this.material=null};c.ColorUtils={adjustHSV:function(b,g,j,k){var a=c.ColorUtils.__hsv;c.ColorUtils.rgbToHsv(b,a);a.h=c.Math.clamp(a.h+g,0,1);a.s=c.Math.clamp(a.s+j,0,1);a.v=c.Math.clamp(a.v+k,0,1);b.setHSV(a.h,a.s,a.v)},rgbToHsv:function(a,g){var e=a.r,b=a.g,p=a.b,h=Math.max(Math.max(e,b),p),f=Math.min(Math.min(e,b),p);if(f===h){f=e=0}else{var o=h-f,f=o/h,e=e===h?(b-p)/o:b===h?2+(p-e)/o:4+(e-b)/o;e/=6;e<0&&(e+=1);e>1&&(e-=1)}g===void 0&&(g={h:0,s:0,v:0});g.h=e;g.s=f;g.v=h;return g}};c.ColorUtils.__hsv={h:0,s:0,v:0};c.GeometryUtils={merge:function(a,f){for(var b,k,t=a.vertices.length,p=f instanceof c.Mesh?f.geometry:f,m=a.vertices,w=p.vertices,e=a.faces,n=p.faces,g=a.faceVertexUvs[0],N=p.faceVertexUvs[0],l={},q=0;q<a.materials.length;q++){l[a.materials[q].id]=q}if(f instanceof c.Mesh){f.matrixAutoUpdate&&f.updateMatrix(),b=f.matrix,k=new c.Matrix4,k.extractRotation(b,f.scale)}for(var q=0,r=w.length;q<r;q++){var M=new c.Vertex(w[q].position.clone());b&&b.multiplyVector3(M.position);m.push(M)}q=0;for(r=n.length;q<r;q++){var m=n[q],o,u,O=m.vertexNormals,h=m.vertexColors;m instanceof c.Face3?o=new c.Face3(m.a+t,m.b+t,m.c+t):m instanceof c.Face4&&(o=new c.Face4(m.a+t,m.b+t,m.c+t,m.d+t));o.normal.copy(m.normal);k&&k.multiplyVector3(o.normal);w=0;for(M=O.length;w<M;w++){u=O[w].clone(),k&&k.multiplyVector3(u),o.vertexNormals.push(u)}o.color.copy(m.color);w=0;for(M=h.length;w<M;w++){u=h[w],o.vertexColors.push(u.clone())}if(m.materialIndex!==void 0){w=p.materials[m.materialIndex];M=l[w.id];if(M===void 0){M=a.materials.length,a.materials.push(w)}o.materialIndex=M}o.centroid.copy(m.centroid);b&&b.multiplyVector3(o.centroid);e.push(o)}q=0;for(r=N.length;q<r;q++){b=N[q];k=[];w=0;for(M=b.length;w<M;w++){k.push(new c.UV(b[w].u,b[w].v))}g.push(k)}},clone:function(g){var k=new c.Geometry,h,l=g.vertices,o=g.faces,y=g.faceVertexUvs[0];if(g.materials){k.materials=g.materials.slice()}g=0;for(h=l.length;g<h;g++){var x=new c.Vertex(l[g].position.clone());k.vertices.push(x)}g=0;for(h=o.length;g<h;g++){var w=o[g],a,e,b=w.vertexNormals,f=w.vertexColors;w instanceof c.Face3?a=new c.Face3(w.a,w.b,w.c):w instanceof c.Face4&&(a=new c.Face4(w.a,w.b,w.c,w.d));a.normal.copy(w.normal);l=0;for(x=b.length;l<x;l++){e=b[l],a.vertexNormals.push(e.clone())}a.color.copy(w.color);l=0;for(x=f.length;l<x;l++){e=f[l],a.vertexColors.push(e.clone())}a.materialIndex=w.materialIndex;a.centroid.copy(w.centroid);k.faces.push(a)}g=0;for(h=y.length;g<h;g++){o=y[g];a=[];l=0;for(x=o.length;l<x;l++){a.push(new c.UV(o[l].u,o[l].v))}k.faceVertexUvs[0].push(a)}return k},randomPointInTriangle:function(a,g,e){var b,p,h,f=new c.Vector3,o=c.GeometryUtils.__v1;b=c.GeometryUtils.random();p=c.GeometryUtils.random();b+p>1&&(b=1-b,p=1-p);h=1-b-p;f.copy(a);f.multiplyScalar(b);o.copy(g);o.multiplyScalar(p);f.addSelf(o);o.copy(e);o.multiplyScalar(h);f.addSelf(o);return f},randomPointInFace:function(g,b,a){var m,f,e;if(g instanceof c.Face3){return m=b.vertices[g.a].position,f=b.vertices[g.b].position,e=b.vertices[g.c].position,c.GeometryUtils.randomPointInTriangle(m,f,e)}else{if(g instanceof c.Face4){m=b.vertices[g.a].position;f=b.vertices[g.b].position;e=b.vertices[g.c].position;var b=b.vertices[g.d].position,n;a?g._area1&&g._area2?(a=g._area1,n=g._area2):(a=c.GeometryUtils.triangleArea(m,f,b),n=c.GeometryUtils.triangleArea(f,e,b),g._area1=a,g._area2=n):(a=c.GeometryUtils.triangleArea(m,f,b),n=c.GeometryUtils.triangleArea(f,e,b));return c.GeometryUtils.random()*(a+n)<a?c.GeometryUtils.randomPointInTriangle(m,f,b):c.GeometryUtils.randomPointInTriangle(f,e,b)}}},randomPointsInGeometry:function(m,B){function o(n){function j(q,r){if(r<q){return q}var s=q+Math.floor((r-q)/2);return k[s]>n?j(q,s-1):k[s]<n?j(s+1,r):s}return j(0,k.length-1)}var C,e,b=m.faces,a=m.vertices,f=b.length,g=0,k=[],h,p,A,l;for(e=0;e<f;e++){C=b[e];if(C instanceof c.Face3){h=a[C.a].position,p=a[C.b].position,A=a[C.c].position,C._area=c.GeometryUtils.triangleArea(h,p,A)}else{if(C instanceof c.Face4){h=a[C.a].position,p=a[C.b].position,A=a[C.c].position,l=a[C.d].position,C._area1=c.GeometryUtils.triangleArea(h,p,l),C._area2=c.GeometryUtils.triangleArea(p,A,l),C._area=C._area1+C._area2}}g+=C._area;k[e]=g}C=[];a={};for(e=0;e<B;e++){f=c.GeometryUtils.random()*g,f=o(f),C[e]=c.GeometryUtils.randomPointInFace(b[f],m,!0),a[f]?a[f]+=1:a[f]=1}return C},triangleArea:function(b,g,j){var k,a=c.GeometryUtils.__v1;a.sub(b,g);k=a.length();a.sub(b,j);b=a.length();a.sub(g,j);j=a.length();g=0.5*(k+b+j);return Math.sqrt(g*(g-k)*(g-b)*(g-j))},center:function(b){b.computeBoundingBox();var a=new c.Matrix4;a.setTranslation(-0.5*(b.boundingBox.x[1]+b.boundingBox.x[0]),-0.5*(b.boundingBox.y[1]+b.boundingBox.y[0]),-0.5*(b.boundingBox.z[1]+b.boundingBox.z[0]));b.applyMatrix(a);b.computeBoundingBox()}};c.GeometryUtils.random=c.Math.random16;c.GeometryUtils.__v1=new c.Vector3;c.ImageUtils={loadTexture:function(b,g,j){var k=new Image,a=new c.Texture(k,g);k.onload=function(){a.needsUpdate=!0;j&&j(this)};k.crossOrigin="";k.src=b;return a},loadTextureCube:function(k,g,a){var l,f=[],b=new c.Texture(f,g),g=f.loadCount=0;for(l=k.length;g<l;++g){f[g]=new Image,f[g].onload=function(){f.loadCount+=1;if(f.loadCount===6){b.needsUpdate=!0}a&&a(this)},f[g].crossOrigin="",f[g].src=k[g]}return b},getNormalMap:function(b,l){var f=function(s){var j=Math.sqrt(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]);return[s[0]/j,s[1]/j,s[2]/j]};l|=1;var o=b.width,a=b.height,t=document.createElement("canvas");t.width=o;t.height=a;var r=t.getContext("2d");r.drawImage(b,0,0);for(var g=r.getImageData(0,0,o,a).data,n=r.createImageData(o,a),K=n.data,p=0;p<o;p++){for(var m=1;m<a;m++){var q=m-1<0?a-1:m-1,L=(m+1)%a,e=p-1<0?o-1:p-1,h=(p+1)%o,w=[],k=[0,0,g[(m*o+p)*4]/255*l];w.push([-1,0,g[(m*o+e)*4]/255*l]);w.push([-1,-1,g[(q*o+e)*4]/255*l]);w.push([0,-1,g[(q*o+p)*4]/255*l]);w.push([1,-1,g[(q*o+h)*4]/255*l]);w.push([1,0,g[(m*o+h)*4]/255*l]);w.push([1,1,g[(L*o+h)*4]/255*l]);w.push([0,1,g[(L*o+p)*4]/255*l]);w.push([-1,1,g[(L*o+e)*4]/255*l]);q=[];e=w.length;for(L=0;L<e;L++){var h=w[L],M=w[(L+1)%e],h=[h[0]-k[0],h[1]-k[1],h[2]-k[2]],M=[M[0]-k[0],M[1]-k[1],M[2]-k[2]];q.push(f([h[1]*M[2]-h[2]*M[1],h[2]*M[0]-h[0]*M[2],h[0]*M[1]-h[1]*M[0]]))}w=[0,0,0];for(L=0;L<q.length;L++){w[0]+=q[L][0],w[1]+=q[L][1],w[2]+=q[L][2]}w[0]/=q.length;w[1]/=q.length;w[2]/=q.length;k=(m*o+p)*4;K[k]=(w[0]+1)/2*255|0;K[k+1]=(w[1]+0.5)*255|0;K[k+2]=w[2]*255|0;K[k+3]=255}}r.putImageData(n,0,0);return t}};c.SceneUtils={showHierarchy:function(b,a){c.SceneUtils.traverseHierarchy(b,function(e){e.visible=a})},traverseHierarchy:function(b,g){var j,k,a=b.children.length;for(k=0;k<a;k++){j=b.children[k],g(j),c.SceneUtils.traverseHierarchy(j,g)}},createMultiMaterialObject:function(k,g){var a,l=g.length,f=new c.Object3D;for(a=0;a<l;a++){var b=new c.Mesh(k,g[a]);f.add(b)}return f},cloneObject:function(a){var g;a instanceof c.MorphAnimMesh?(g=new c.MorphAnimMesh(a.geometry,a.material),g.duration=a.duration,g.mirroredLoop=a.mirroredLoop,g.time=a.time,g.lastKeyframe=a.lastKeyframe,g.currentKeyframe=a.currentKeyframe,g.direction=a.direction,g.directionBackwards=a.directionBackwards):a instanceof c.SkinnedMesh?g=new c.SkinnedMesh(a.geometry,a.material):a instanceof c.Mesh?g=new c.Mesh(a.geometry,a.material):a instanceof c.Line?g=new c.Line(a.geometry,a.material,a.type):a instanceof c.Ribbon?g=new c.Ribbon(a.geometry,a.material):a instanceof c.ParticleSystem?(g=new c.ParticleSystem(a.geometry,a.material),g.sortParticles=a.sortParticles):a instanceof c.Particle?g=new c.Particle(a.material):a instanceof c.Sprite?(g=new c.Sprite({}),g.color.copy(a.color),g.map=a.map,g.blending=a.blending,g.useScreenCoordinates=a.useScreenCoordinates,g.mergeWith3D=a.mergeWith3D,g.affectedByDistance=a.affectedByDistance,g.scaleByViewport=a.scaleByViewport,g.alignment=a.alignment,g.rotation3d.copy(a.rotation3d),g.rotation=a.rotation,g.opacity=a.opacity,g.uvOffset.copy(a.uvOffset),g.uvScale.copy(a.uvScale)):a instanceof c.LOD?g=new c.LOD:a instanceof c.MarchingCubes?(g=new c.MarchingCubes(a.resolution,a.material),g.field.set(a.field),g.isolation=a.isolation):a instanceof c.Object3D&&(g=new c.Object3D);g.parent=a.parent;g.up.copy(a.up);g.position.copy(a.position);g.rotation instanceof c.Vector3&&g.rotation.copy(a.rotation);g.eulerOrder=a.eulerOrder;g.scale.copy(a.scale);g.dynamic=a.dynamic;g.doubleSided=a.doubleSided;g.flipSided=a.flipSided;g.renderDepth=a.renderDepth;g.rotationAutoUpdate=a.rotationAutoUpdate;g.matrix.copy(a.matrix);g.matrixWorld.copy(a.matrixWorld);g.matrixRotationWorld.copy(a.matrixRotationWorld);g.matrixAutoUpdate=a.matrixAutoUpdate;g.matrixWorldNeedsUpdate=a.matrixWorldNeedsUpdate;g.quaternion.copy(a.quaternion);g.useQuaternion=a.useQuaternion;g.boundRadius=a.boundRadius;g.boundRadiusScale=a.boundRadiusScale;g.visible=a.visible;g.castShadow=a.castShadow;g.receiveShadow=a.receiveShadow;g.frustumCulled=a.frustumCulled;for(var b=0;b<a.children.length;b++){var h=c.SceneUtils.cloneObject(a.children[b]);g.children[b]=h;h.parent=g}if(a instanceof c.LOD){for(b=0;b<a.LODs.length;b++){g.LODs[b]={visibleAtDistance:a.LODs[b].visibleAtDistance,object3D:g.children[b]}}}return g}};if(c.WebGLRenderer){c.ShaderUtils={lib:{fresnel:{uniforms:{mRefractionRatio:{type:"f",value:1.02},mFresnelBias:{type:"f",value:0.1},mFresnelPower:{type:"f",value:2},mFresnelScale:{type:"f",value:1},tCube:{type:"t",value:1,texture:null}},fragmentShader:"uniform samplerCube tCube;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\nvec4 refractedColor = vec4( 1.0, 1.0, 1.0, 1.0 );\nrefractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;\nrefractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;\nrefractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;\nrefractedColor.a = 1.0;\ngl_FragColor = mix( refractedColor, reflectedColor, clamp( vReflectionFactor, 0.0, 1.0 ) );\n}",vertexShader:"uniform float mRefractionRatio;\nuniform float mFresnelBias;\nuniform float mFresnelScale;\nuniform float mFresnelPower;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = normalize ( mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal );\nvec3 I = mPosition.xyz - cameraPosition;\nvReflect = reflect( I, nWorld );\nvRefract[0] = refract( normalize( I ), nWorld, mRefractionRatio );\nvRefract[1] = refract( normalize( I ), nWorld, mRefractionRatio * 0.99 );\nvRefract[2] = refract( normalize( I ), nWorld, mRefractionRatio * 0.98 );\nvReflectionFactor = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( I ), nWorld ), mFresnelPower );\ngl_Position = projectionMatrix * mvPosition;\n}"},normal:{uniforms:c.UniformsUtils.merge([c.UniformsLib.fog,c.UniformsLib.lights,c.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},tDiffuse:{type:"t",value:0,texture:null},tCube:{type:"t",value:1,texture:null},tNormal:{type:"t",value:2,texture:null},tSpecular:{type:"t",value:3,texture:null},tAO:{type:"t",value:4,texture:null},tDisplacement:{type:"t",value:5,texture:null},uNormalScale:{type:"f",value:1},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new c.Color(15658734)},uSpecularColor:{type:"c",value:new c.Color(1118481)},uAmbientColor:{type:"c",value:new c.Color(328965)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1},uReflectivity:{type:"f",value:0.5},uOffset:{type:"v2",value:new c.Vector2(0,0)},uRepeat:{type:"v2",value:new c.Vector2(1,1)}}]),fragmentShader:["uniform vec3 uAmbientColor;\nuniform vec3 uDiffuseColor;\nuniform vec3 uSpecularColor;\nuniform float uShininess;\nuniform float uOpacity;\nuniform bool enableDiffuse;\nuniform bool enableSpecular;\nuniform bool enableAO;\nuniform bool enableReflection;\nuniform sampler2D tDiffuse;\nuniform sampler2D tNormal;\nuniform sampler2D tSpecular;\nuniform sampler2D tAO;\nuniform samplerCube tCube;\nuniform float uNormalScale;\nuniform float uReflectivity;\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\nvarying vec3 vViewPosition;",c.ShaderChunk.shadowmap_pars_fragment,c.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3( 1.0 ), uOpacity );\nvec3 specularTex = vec3( 1.0 );\nvec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;\nnormalTex.xy *= uNormalScale;\nnormalTex = normalize( normalTex );\nif( enableDiffuse )\ngl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );\nif( enableAO )\ngl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;\nif( enableSpecular )\nspecularTex = texture2D( tSpecular, vUv ).xyz;\nmat3 tsb = mat3( vTangent, vBinormal, vNormal );\nvec3 finalNormal = tsb * normalTex;\nvec3 normal = normalize( finalNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec3 pointVector = normalize( vPointLight[ i ].xyz );\nvec3 pointHalfVector = normalize( vPointLight[ i ].xyz + viewPosition );\nfloat pointDistance = vPointLight[ i ].w;\nfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\nfloat pointSpecularWeight = specularTex.r * pow( pointDotNormalHalf, uShininess );\npointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;\npointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nvec3 dirHalfVector = normalize( lDirection.xyz + viewPosition );\nfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\nfloat dirSpecularWeight = specularTex.r * pow( dirDotNormalHalf, uShininess );\ndirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;\ndirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;\n}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\ngl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor) + totalSpecular;\nif ( enableReflection ) {\nvec3 wPos = cameraPosition - vViewPosition;\nvec3 vReflect = reflect( normalize( wPos ), normal );\nvec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\ngl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, uReflectivity );\n}",c.ShaderChunk.shadowmap_fragment,c.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;\nuniform vec2 uOffset;\nuniform vec2 uRepeat;\n#ifdef VERTEX_TEXTURES\nuniform sampler2D tDisplacement;\nuniform float uDisplacementScale;\nuniform float uDisplacementBias;\n#endif\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\nvarying vec3 vViewPosition;",c.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvViewPosition = -mvPosition.xyz;\nvNormal = normalize( normalMatrix * normal );\nvTangent = normalize( normalMatrix * tangent.xyz );\nvBinormal = cross( vNormal, vTangent ) * tangent.w;\nvBinormal = normalize( vBinormal );\nvUv = uv * uRepeat + uOffset;\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nvPointLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#ifdef VERTEX_TEXTURES\nvec3 dv = texture2D( tDisplacement, uv ).xyz;\nfloat df = uDisplacementScale * dv.x + uDisplacementBias;\nvec4 displacedPosition = vec4( vNormal.xyz * df, 0.0 ) + mvPosition;\ngl_Position = projectionMatrix * displacedPosition;\n#else\ngl_Position = projectionMatrix * mvPosition;\n#endif",c.ShaderChunk.shadowmap_vertex,"}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:1,texture:null},tFlip:{type:"f",value:-1}},vertexShader:"varying vec3 vViewPosition;\nvoid main() {\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvViewPosition = cameraPosition - mPosition.xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform samplerCube tCube;\nuniform float tFlip;\nvarying vec3 vViewPosition;\nvoid main() {\nvec3 wPos = cameraPosition - vViewPosition;\ngl_FragColor = textureCube( tCube, vec3( tFlip * wPos.x, wPos.yz ) );\n}"}}}}c.Curve=function(){};c.Curve.prototype.getPoint=function(){console.log("Warning, getPoint() not implemented!");return null};c.Curve.prototype.getPointAt=function(a){return this.getPoint(this.getUtoTmapping(a))};c.Curve.prototype.getPoints=function(f){f||(f=5);var b,a=[];for(b=0;b<=f;b++){a.push(this.getPoint(b/f))}return a};c.Curve.prototype.getSpacedPoints=function(f){f||(f=5);var b,a=[];for(b=0;b<=f;b++){a.push(this.getPointAt(b/f))}return a};c.Curve.prototype.getLength=function(){var a=this.getLengths();return a[a.length-1]};c.Curve.prototype.getLengths=function(k){k||(k=200);if(this.cacheArcLengths&&this.cacheArcLengths.length==k+1){return this.cacheArcLengths}var g=[],a,l=this.getPoint(0),f,b=0;g.push(0);for(f=1;f<=k;f++){a=this.getPoint(f/k),b+=a.distanceTo(l),g.push(b),l=a}return this.cacheArcLengths=g};c.Curve.prototype.getUtoTmapping=function(e,g){var f=this.getLengths(),h=0,s=f.length,r;r=g?g:e*f[s-1];for(var q=0,a=s-1,b;q<=a;){if(h=Math.floor(q+(a-q)/2),b=f[h]-r,b<0){q=h+1}else{if(b>0){a=h-1}else{a=h;break}}}h=a;if(f[h]==r){return h/(s-1)}q=f[h];return f=(h+(r-q)/(f[h+1]-q))/(s-1)};c.Curve.prototype.getNormalVector=function(a){a=this.getTangent(a);return new c.Vector2(-a.y,a.x)};c.Curve.prototype.getTangent=function(b){var a=b-0.0001;b+=0.0001;a<0&&(a=0);b>1&&(b=1);a=this.getPoint(a);b=this.getPoint(b);return a.clone().subSelf(b).normalize()};c.Curve.prototype.getTangentAt=function(a){return this.getTangent(this.getUtoTmapping(a))};c.LineCurve=function(b,a){b instanceof c.Vector2?(this.v1=b,this.v2=a):c.LineCurve.oldConstructor.apply(this,arguments)};c.LineCurve.oldConstructor=function(a,g,b,h){this.constructor(new c.Vector2(a,g),new c.Vector2(b,h))};c.LineCurve.prototype=new c.Curve;c.LineCurve.prototype.constructor=c.LineCurve;c.LineCurve.prototype.getPoint=function(b){var a=new c.Vector2;a.sub(this.v2,this.v1);a.multiplyScalar(b).addSelf(this.v1);return a};c.LineCurve.prototype.getPointAt=function(a){return this.getPoint(a)};c.LineCurve.prototype.getTangent=function(){var a=new c.Vector2;a.sub(this.v2,this.v1);a.normalize();return a};c.QuadraticBezierCurve=function(a,g,b){if(!(g instanceof c.Vector2)){var h=Array.prototype.slice.call(arguments),a=new c.Vector2(h[0],h[1]),g=new c.Vector2(h[2],h[3]),b=new c.Vector2(h[4],h[5])}this.v0=a;this.v1=g;this.v2=b};c.QuadraticBezierCurve.prototype=new c.Curve;c.QuadraticBezierCurve.prototype.constructor=c.QuadraticBezierCurve;c.QuadraticBezierCurve.prototype.getPoint=function(b){var a;a=c.Shape.Utils.b2(b,this.v0.x,this.v1.x,this.v2.x);b=c.Shape.Utils.b2(b,this.v0.y,this.v1.y,this.v2.y);return new c.Vector2(a,b)};c.QuadraticBezierCurve.prototype.getTangent=function(b){var a;a=c.Curve.Utils.tangentQuadraticBezier(b,this.v0.x,this.v1.x,this.v2.x);b=c.Curve.Utils.tangentQuadraticBezier(b,this.v0.y,this.v1.y,this.v2.y);a=new c.Vector2(a,b);a.normalize();return a};c.CubicBezierCurve=function(b,g,j,k){if(!(g instanceof c.Vector2)){var a=Array.prototype.slice.call(arguments),b=new c.Vector2(a[0],a[1]),g=new c.Vector2(a[2],a[3]),j=new c.Vector2(a[4],a[5]),k=new c.Vector2(a[6],a[7])}this.v0=b;this.v1=g;this.v2=j;this.v3=k};c.CubicBezierCurve.prototype=new c.Curve;c.CubicBezierCurve.prototype.constructor=c.CubicBezierCurve;c.CubicBezierCurve.prototype.getPoint=function(b){var a;a=c.Shape.Utils.b3(b,this.v0.x,this.v1.x,this.v2.x,this.v3.x);b=c.Shape.Utils.b3(b,this.v0.y,this.v1.y,this.v2.y,this.v3.y);return new c.Vector2(a,b)};c.CubicBezierCurve.prototype.getTangent=function(b){var a;a=c.Curve.Utils.tangentCubicBezier(b,this.v0.x,this.v1.x,this.v2.x,this.v3.x);b=c.Curve.Utils.tangentCubicBezier(b,this.v0.y,this.v1.y,this.v2.y,this.v3.y);a=new c.Vector2(a,b);a.normalize();return a};c.SplineCurve=function(a){this.points=a==void 0?[]:a};c.SplineCurve.prototype=new c.Curve;c.SplineCurve.prototype.constructor=c.SplineCurve;c.SplineCurve.prototype.getPoint=function(b){var g=new c.Vector2,j=[],k=this.points,a;a=(k.length-1)*b;b=Math.floor(a);a-=b;j[0]=b==0?b:b-1;j[1]=b;j[2]=b>k.length-2?b:b+1;j[3]=b>k.length-3?b:b+2;g.x=c.Curve.Utils.interpolate(k[j[0]].x,k[j[1]].x,k[j[2]].x,k[j[3]].x,a);g.y=c.Curve.Utils.interpolate(k[j[0]].y,k[j[1]].y,k[j[2]].y,k[j[3]].y,a);return g};c.ArcCurve=function(k,g,a,l,f,b){this.aX=k;this.aY=g;this.aRadius=a;this.aStartAngle=l;this.aEndAngle=f;this.aClockwise=b};c.ArcCurve.prototype=new c.Curve;c.ArcCurve.prototype.constructor=c.ArcCurve;c.ArcCurve.prototype.getPoint=function(b){var a=this.aEndAngle-this.aStartAngle;this.aClockwise||(b=1-b);b=this.aStartAngle+b*a;return new c.Vector2(this.aX+this.aRadius*Math.cos(b),this.aY+this.aRadius*Math.sin(b))};c.Curve.Utils={tangentQuadraticBezier:function(a,g,b,h){return 2*(1-a)*(b-g)+2*a*(h-b)},tangentCubicBezier:function(b,g,j,k,a){return -3*g*(1-b)*(1-b)+3*j*(1-b)*(1-b)-6*b*j*(1-b)+6*b*k*(1-b)-3*b*b*k+3*b*b*a},tangentSpline:function(a){return 6*a*a-6*a+(3*a*a-4*a+1)+(-6*a*a+6*a)+(3*a*a-2*a)},interpolate:function(k,g,a,l,f){var k=(a-k)*0.5,l=(l-g)*0.5,b=f*f;return(2*g-2*a+k+l)*f*b+(-3*g+3*a-2*k-l)*b+k*f+g}};c.Curve.create=function(b,a){b.prototype=new c.Curve;b.prototype.constructor=b;b.prototype.getPoint=a;return b};c.LineCurve3=c.Curve.create(function(b,a){this.v1=b;this.v2=a},function(b){var a=new c.Vector3;a.sub(this.v2,this.v1);a.multiplyScalar(b);a.addSelf(this.v1);return a});c.QuadraticBezierCurve3=c.Curve.create(function(f,b,a){this.v0=f;this.v1=b;this.v2=a},function(f){var b,a;b=c.Shape.Utils.b2(f,this.v0.x,this.v1.x,this.v2.x);a=c.Shape.Utils.b2(f,this.v0.y,this.v1.y,this.v2.y);f=c.Shape.Utils.b2(f,this.v0.z,this.v1.z,this.v2.z);return new c.Vector3(b,a,f)});c.CubicBezierCurve3=c.Curve.create(function(a,g,b,h){this.v0=a;this.v1=g;this.v2=b;this.v3=h},function(f){var b,a;b=c.Shape.Utils.b3(f,this.v0.x,this.v1.x,this.v2.x,this.v3.x);a=c.Shape.Utils.b3(f,this.v0.y,this.v1.y,this.v2.y,this.v3.y);f=c.Shape.Utils.b3(f,this.v0.z,this.v1.z,this.v2.z,this.v3.z);return new c.Vector3(b,a,f)});c.SplineCurve3=c.Curve.create(function(a){this.points=a==void 0?[]:a},function(b){var g=new c.Vector3,j=[],k=this.points,a;a=(k.length-1)*b;b=Math.floor(a);a-=b;j[0]=b==0?b:b-1;j[1]=b;j[2]=b>k.length-2?b:b+1;j[3]=b>k.length-3?b:b+2;g.x=c.Curve.Utils.interpolate(k[j[0]].x,k[j[1]].x,k[j[2]].x,k[j[3]].x,a);g.y=c.Curve.Utils.interpolate(k[j[0]].y,k[j[1]].y,k[j[2]].y,k[j[3]].y,a);g.z=c.Curve.Utils.interpolate(k[j[0]].z,k[j[1]].z,k[j[2]].z,k[j[3]].z,a);return g});c.CurvePath=function(){this.curves=[];this.bends=[]};c.CurvePath.prototype=new c.Curve;c.CurvePath.prototype.constructor=c.CurvePath;c.CurvePath.prototype.add=function(a){this.curves.push(a)};c.CurvePath.prototype.checkConnection=function(){};c.CurvePath.prototype.closePath=function(){};c.CurvePath.prototype.getPoint=function(f){for(var b=f*this.getLength(),a=this.getCurveLengths(),f=0;f<a.length;){if(a[f]>=b){return b=a[f]-b,f=this.curves[f],b=1-b/f.getLength(),f.getPointAt(b)}f++}return null};c.CurvePath.prototype.getLength=function(){var a=this.getCurveLengths();return a[a.length-1]};c.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length){return this.cacheLengths}var a=[],g=0,b,h=this.curves.length;for(b=0;b<h;b++){g+=this.curves[b].getLength(),a.push(g)}return this.cacheLengths=a};c.CurvePath.prototype.getBoundingBox=function(){var e=this.getPoints(),g,f,h,s;g=f=Number.NEGATIVE_INFINITY;h=s=Number.POSITIVE_INFINITY;var r,q,a,b;b=new c.Vector2;q=0;for(a=e.length;q<a;q++){r=e[q];if(r.x>g){g=r.x}else{if(r.x<h){h=r.x}}if(r.y>f){f=r.y}else{if(r.y<f){s=r.y}}b.addSelf(r.x,r.y)}return{minX:h,minY:s,maxX:g,maxY:f,centroid:b.divideScalar(a)}};c.CurvePath.prototype.createPointsGeometry=function(a){return this.createGeometry(this.getPoints(a,!0))};c.CurvePath.prototype.createSpacedPointsGeometry=function(a){return this.createGeometry(this.getSpacedPoints(a,!0))};c.CurvePath.prototype.createGeometry=function(f){for(var b=new c.Geometry,a=0;a<f.length;a++){b.vertices.push(new c.Vertex(new c.Vector3(f[a].x,f[a].y,0)))}return b};c.CurvePath.prototype.addWrapPath=function(a){this.bends.push(a)};c.CurvePath.prototype.getTransformedPoints=function(b,g){var j=this.getPoints(b),k,a;if(!g){g=this.bends}k=0;for(a=g.length;k<a;k++){j=this.getWrapPoints(j,g[k])}return j};c.CurvePath.prototype.getTransformedSpacedPoints=function(b,g){var j=this.getSpacedPoints(b),k,a;if(!g){g=this.bends}k=0;for(a=g.length;k<a;k++){j=this.getWrapPoints(j,g[k])}return j};c.CurvePath.prototype.getWrapPoints=function(e,g){var f=this.getBoundingBox(),h,s,r,q,a,b;h=0;for(s=e.length;h<s;h++){r=e[h],q=r.x,a=r.y,b=q/f.maxX,b=g.getUtoTmapping(b,q),q=g.getPoint(b),a=g.getNormalVector(b).multiplyScalar(a),r.x=q.x+a.x,r.y=q.y+a.y}return e};c.Path=function(a){c.CurvePath.call(this);this.actions=[];a&&this.fromPoints(a)};c.Path.prototype=new c.CurvePath;c.Path.prototype.constructor=c.Path;c.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc"};c.Path.prototype.fromPoints=function(f){this.moveTo(f[0].x,f[0].y);var b,a=f.length;for(b=1;b<a;b++){this.lineTo(f[b].x,f[b].y)}};c.Path.prototype.moveTo=function(){var a=Array.prototype.slice.call(arguments);this.actions.push({action:c.PathActions.MOVE_TO,args:a})};c.Path.prototype.lineTo=function(a,g){var b=Array.prototype.slice.call(arguments),h=this.actions[this.actions.length-1].args;this.curves.push(new c.LineCurve(new c.Vector2(h[h.length-2],h[h.length-1]),new c.Vector2(a,g)));this.actions.push({action:c.PathActions.LINE_TO,args:b})};c.Path.prototype.quadraticCurveTo=function(k,g,a,l){var f=Array.prototype.slice.call(arguments),b=this.actions[this.actions.length-1].args;this.curves.push(new c.QuadraticBezierCurve(new c.Vector2(b[b.length-2],b[b.length-1]),new c.Vector2(k,g),new c.Vector2(a,l)));this.actions.push({action:c.PathActions.QUADRATIC_CURVE_TO,args:f})};c.Path.prototype.bezierCurveTo=function(a,g,e,b,p,h){var f=Array.prototype.slice.call(arguments),o=this.actions[this.actions.length-1].args;this.curves.push(new c.CubicBezierCurve(new c.Vector2(o[o.length-2],o[o.length-1]),new c.Vector2(a,g),new c.Vector2(e,b),new c.Vector2(p,h)));this.actions.push({action:c.PathActions.BEZIER_CURVE_TO,args:f})};c.Path.prototype.splineThru=function(f){var b=Array.prototype.slice.call(arguments),a=this.actions[this.actions.length-1].args,a=[new c.Vector2(a[a.length-2],a[a.length-1])];Array.prototype.push.apply(a,f);this.curves.push(new c.SplineCurve(a));this.actions.push({action:c.PathActions.CSPLINE_THRU,args:b})};c.Path.prototype.arc=function(g,b,a,m,f,e){var n=Array.prototype.slice.call(arguments);this.curves.push(new c.ArcCurve(g,b,a,m,f,e));this.actions.push({action:c.PathActions.ARC,args:n})};c.Path.prototype.getSpacedPoints=function(f){f||(f=40);for(var b=[],a=0;a<f;a++){b.push(this.getPoint(a/f))}return b};c.Path.prototype.getPoints=function(G,l){var G=G||12,g=[],a,e,b,I,f,m,o,n,H,h,p,k,q;a=0;for(e=this.actions.length;a<e;a++){switch(b=this.actions[a],I=b.action,b=b.args,I){case c.PathActions.LINE_TO:g.push(new c.Vector2(b[0],b[1]));break;case c.PathActions.QUADRATIC_CURVE_TO:f=b[2];m=b[3];H=b[0];h=b[1];g.length>0?(I=g[g.length-1],p=I.x,k=I.y):(I=this.actions[a-1].args,p=I[I.length-2],k=I[I.length-1]);for(I=1;I<=G;I++){q=I/G,b=c.Shape.Utils.b2(q,p,H,f),q=c.Shape.Utils.b2(q,k,h,m),g.push(new c.Vector2(b,q))}break;case c.PathActions.BEZIER_CURVE_TO:f=b[4];m=b[5];H=b[0];h=b[1];o=b[2];n=b[3];g.length>0?(I=g[g.length-1],p=I.x,k=I.y):(I=this.actions[a-1].args,p=I[I.length-2],k=I[I.length-1]);for(I=1;I<=G;I++){q=I/G,b=c.Shape.Utils.b3(q,p,H,o,f),q=c.Shape.Utils.b3(q,k,h,n,m),g.push(new c.Vector2(b,q))}break;case c.PathActions.CSPLINE_THRU:I=this.actions[a-1].args;I=[new c.Vector2(I[I.length-2],I[I.length-1])];q=G*b[0].length;I=I.concat(b[0]);b=new c.SplineCurve(I);for(I=1;I<=q;I++){g.push(b.getPointAt(I/q))}break;case c.PathActions.ARC:I=this.actions[a-1].args;f=b[0];m=b[1];o=b[2];H=b[3];q=b[4];h=!!b[5];n=I[I.length-2];p=I[I.length-1];I.length==0&&(n=p=0);k=q-H;var r=G*2;for(I=1;I<=r;I++){q=I/r,h||(q=1-q),q=H+q*k,b=n+f+o*Math.cos(q),q=p+m+o*Math.sin(q),g.push(new c.Vector2(b,q))}}}l&&g.push(g[0]);return g};c.Path.prototype.transform=function(b,a){this.getBoundingBox();return this.getWrapPoints(this.getPoints(a),b)};c.Path.prototype.nltransform=function(g,k,h,l,o,y){var x=this.getPoints(),w,a,e,b,f;w=0;for(a=x.length;w<a;w++){e=x[w],b=e.x,f=e.y,e.x=g*b+k*f+h,e.y=l*f+o*b+y}return x};c.Path.prototype.debug=function(b){var g=this.getBoundingBox();b||(b=document.createElement("canvas"),b.setAttribute("width",g.maxX+100),b.setAttribute("height",g.maxY+100),document.body.appendChild(b));g=b.getContext("2d");g.fillStyle="white";g.fillRect(0,0,b.width,b.height);g.strokeStyle="black";g.beginPath();var j,k,a,b=0;for(j=this.actions.length;b<j;b++){k=this.actions[b],a=k.args,k=k.action,k!=c.PathActions.CSPLINE_THRU&&g[k].apply(g,a)}g.stroke();g.closePath();g.strokeStyle="red";k=this.getPoints();b=0;for(j=k.length;b<j;b++){a=k[b],g.beginPath(),g.arc(a.x,a.y,1.5,0,Math.PI*2,!1),g.stroke(),g.closePath()}};c.Path.prototype.toShapes=function(){var g,b,a,m,f=[],e=new c.Path;g=0;for(b=this.actions.length;g<b;g++){a=this.actions[g],m=a.args,a=a.action,a==c.PathActions.MOVE_TO&&e.actions.length!=0&&(f.push(e),e=new c.Path),e[a].apply(e,m)}e.actions.length!=0&&f.push(e);if(f.length==0){return[]}var n,e=[];if(c.Shape.Utils.isClockWise(f[0].getPoints())){g=0;for(b=f.length;g<b;g++){m=f[g],c.Shape.Utils.isClockWise(m.getPoints())?(n&&e.push(n),n=new c.Shape,n.actions=m.actions,n.curves=m.curves):n.holes.push(m)}e.push(n)}else{n=new c.Shape;g=0;for(b=f.length;g<b;g++){m=f[g],c.Shape.Utils.isClockWise(m.getPoints())?(n.actions=m.actions,n.curves=m.curves,e.push(n),n=new c.Shape):n.holes.push(m)}}return e};c.Shape=function(){c.Path.apply(this,arguments);this.holes=[]};c.Shape.prototype=new c.Path;c.Shape.prototype.constructor=c.Path;c.Shape.prototype.extrude=function(a){return new c.ExtrudeGeometry(this,a)};c.Shape.prototype.getPointsHoles=function(a){var g,b=this.holes.length,h=[];for(g=0;g<b;g++){h[g]=this.holes[g].getTransformedPoints(a,this.bends)}return h};c.Shape.prototype.getSpacedPointsHoles=function(a){var g,b=this.holes.length,h=[];for(g=0;g<b;g++){h[g]=this.holes[g].getTransformedSpacedPoints(a,this.bends)}return h};c.Shape.prototype.extractAllPoints=function(a){return{shape:this.getTransformedPoints(a),holes:this.getPointsHoles(a)}};c.Shape.prototype.extractAllSpacedPoints=function(a){return{shape:this.getTransformedSpacedPoints(a),holes:this.getSpacedPointsHoles(a)}};c.Shape.Utils={removeHoles:function(G,l){var g=G.concat(),a=g.concat(),e,b,I,f,m,o,n,H,h,p,k=[];for(m=0;m<l.length;m++){o=l[m];Array.prototype.push.apply(a,o);b=Number.POSITIVE_INFINITY;for(e=0;e<o.length;e++){h=o[e];p=[];for(H=0;H<g.length;H++){n=g[H],n=h.distanceToSquared(n),p.push(n),n<b&&(b=n,I=e,f=H)}}e=f-1>=0?f-1:g.length-1;b=I-1>=0?I-1:o.length-1;var q=[o[I],g[f],g[e]];H=c.FontUtils.Triangulate.area(q);var r=[o[I],o[b],g[f]];h=c.FontUtils.Triangulate.area(r);p=f;n=I;f+=1;I+=-1;f<0&&(f+=g.length);f%=g.length;I<0&&(I+=o.length);I%=o.length;e=f-1>=0?f-1:g.length-1;b=I-1>=0?I-1:o.length-1;q=[o[I],g[f],g[e]];q=c.FontUtils.Triangulate.area(q);r=[o[I],o[b],g[f]];r=c.FontUtils.Triangulate.area(r);H+h>q+r&&(f=p,I=n,f<0&&(f+=g.length),f%=g.length,I<0&&(I+=o.length),I%=o.length,e=f-1>=0?f-1:g.length-1,b=I-1>=0?I-1:o.length-1);H=g.slice(0,f);h=g.slice(f);p=o.slice(I);n=o.slice(0,I);b=[o[I],o[b],g[f]];k.push([o[I],g[f],g[e]]);k.push(b);g=H.concat(p).concat(n).concat(h)}return{shape:g,isolatedPts:k,allpoints:a}},triangulateShape:function(a,e){var b=c.Shape.Utils.removeHoles(a,e),f=b.allpoints,l=b.isolatedPts,b=c.FontUtils.Triangulate(b.shape,!1),h,g,s,t,u={};h=0;for(g=f.length;h<g;h++){t=f[h].x+":"+f[h].y,u[t]!==void 0&&console.log("Duplicate point",t),u[t]=h}h=0;for(g=b.length;h<g;h++){s=b[h];for(f=0;f<3;f++){t=s[f].x+":"+s[f].y,t=u[t],t!==void 0&&(s[f]=t)}}h=0;for(g=l.length;h<g;h++){s=l[h];for(f=0;f<3;f++){t=s[f].x+":"+s[f].y,t=u[t],t!==void 0&&(s[f]=t)}}return b.concat(l)},isClockWise:function(a){return c.FontUtils.Triangulate.area(a)<0},b2p0:function(f,b){var a=1-f;return a*a*b},b2p1:function(b,a){return 2*(1-b)*b*a},b2p2:function(b,a){return b*b*a},b2:function(a,g,b,h){return this.b2p0(a,g)+this.b2p1(a,b)+this.b2p2(a,h)},b3p0:function(f,b){var a=1-f;return a*a*a*b},b3p1:function(f,b){var a=1-f;return 3*a*a*f*b},b3p2:function(b,a){return 3*(1-b)*b*b*a},b3p3:function(b,a){return b*b*b*a},b3:function(b,g,j,k,a){return this.b3p0(b,g)+this.b3p1(b,j)+this.b3p2(b,k)+this.b3p3(b,a)}};c.TextPath=function(b,a){c.Path.call(this);this.parameters=a||{};this.set(b)};c.TextPath.prototype.set=function(k,g){this.text=k;var g=g||this.parameters,a=g.curveSegments!==void 0?g.curveSegments:4,l=g.font!==void 0?g.font:"helvetiker",f=g.weight!==void 0?g.weight:"normal",b=g.style!==void 0?g.style:"normal";c.FontUtils.size=g.size!==void 0?g.size:100;c.FontUtils.divisions=a;c.FontUtils.face=l;c.FontUtils.weight=f;c.FontUtils.style=b};c.TextPath.prototype.toShapes=function(){for(var a=c.FontUtils.drawText(this.text).paths,g=[],b=0,h=a.length;b<h;b++){Array.prototype.push.apply(g,a[b].toShapes())}return g};c.AnimationHandler=function(){var a=[],g={},b={update:function(f){for(var e=0;e<a.length;e++){a[e].update(f)}},addToUpdate:function(e){a.indexOf(e)===-1&&a.push(e)},removeFromUpdate:function(e){e=a.indexOf(e);e!==-1&&a.splice(e,1)},add:function(l){g[l.name]!==void 0&&console.log("THREE.AnimationHandler.add: Warning! "+l.name+" already exists in library. Overwriting.");g[l.name]=l;if(l.initialized!==!0){for(var s=0;s<l.hierarchy.length;s++){for(var t=0;t<l.hierarchy[s].keys.length;t++){if(l.hierarchy[s].keys[t].time<0){l.hierarchy[s].keys[t].time=0}if(l.hierarchy[s].keys[t].rot!==void 0&&!(l.hierarchy[s].keys[t].rot instanceof c.Quaternion)){var e=l.hierarchy[s].keys[t].rot;l.hierarchy[s].keys[t].rot=new c.Quaternion(e[0],e[1],e[2],e[3])}}if(l.hierarchy[s].keys[0].morphTargets!==void 0){e={};for(t=0;t<l.hierarchy[s].keys.length;t++){for(var f=0;f<l.hierarchy[s].keys[t].morphTargets.length;f++){var r=l.hierarchy[s].keys[t].morphTargets[f];e[r]=-1}}l.hierarchy[s].usedMorphTargets=e;for(t=0;t<l.hierarchy[s].keys.length;t++){var k={};for(r in e){for(f=0;f<l.hierarchy[s].keys[t].morphTargets.length;f++){if(l.hierarchy[s].keys[t].morphTargets[f]===r){k[r]=l.hierarchy[s].keys[t].morphTargetsInfluences[f];break}}f===l.hierarchy[s].keys[t].morphTargets.length&&(k[r]=0)}l.hierarchy[s].keys[t].morphTargetsInfluences=k}}for(t=1;t<l.hierarchy[s].keys.length;t++){l.hierarchy[s].keys[t].time===l.hierarchy[s].keys[t-1].time&&(l.hierarchy[s].keys.splice(t,1),t--)}for(t=1;t<l.hierarchy[s].keys.length;t++){l.hierarchy[s].keys[t].index=t}}t=parseInt(l.length*l.fps,10);l.JIT={};l.JIT.hierarchy=[];for(s=0;s<l.hierarchy.length;s++){l.JIT.hierarchy.push(Array(t))}l.initialized=!0}},get:function(e){if(typeof e==="string"){return g[e]?g[e]:(console.log("THREE.AnimationHandler.get: Couldn't find animation "+e),null)}},parse:function(f){var k=[];if(f instanceof c.SkinnedMesh){for(var e=0;e<f.bones.length;e++){k.push(f.bones[e])}}else{h(f,k)}return k}},h=function(f,k){k.push(f);for(var e=0;e<f.children.length;e++){h(f.children[e],k)}};b.LINEAR=0;b.CATMULLROM=1;b.CATMULLROM_FORWARD=2;return b}();c.Animation=function(a,g,b,h){this.root=a;this.data=c.AnimationHandler.get(g);this.hierarchy=c.AnimationHandler.parse(a);this.currentTime=0;this.timeScale=1;this.isPlaying=!1;this.loop=this.isPaused=!0;this.interpolationType=b!==void 0?b:c.AnimationHandler.LINEAR;this.JITCompile=h!==void 0?h:!0;this.points=[];this.target=new c.Vector3};c.Animation.prototype.play=function(k,g){if(!this.isPlaying){this.isPlaying=!0;this.loop=k!==void 0?k:!0;this.currentTime=g!==void 0?g:0;var a,l=this.hierarchy.length,f;for(a=0;a<l;a++){f=this.hierarchy[a];if(this.interpolationType!==c.AnimationHandler.CATMULLROM_FORWARD){f.useQuaternion=!0}f.matrixAutoUpdate=!0;if(f.animationCache===void 0){f.animationCache={},f.animationCache.prevKey={pos:0,rot:0,scl:0},f.animationCache.nextKey={pos:0,rot:0,scl:0},f.animationCache.originalMatrix=f instanceof c.Bone?f.skinMatrix:f.matrix}var b=f.animationCache.prevKey;f=f.animationCache.nextKey;b.pos=this.data.hierarchy[a].keys[0];b.rot=this.data.hierarchy[a].keys[0];b.scl=this.data.hierarchy[a].keys[0];f.pos=this.getNextKeyWith("pos",a,1);f.rot=this.getNextKeyWith("rot",a,1);f.scl=this.getNextKeyWith("scl",a,1)}this.update(0)}this.isPaused=!1;c.AnimationHandler.addToUpdate(this)};c.Animation.prototype.pause=function(){this.isPaused?c.AnimationHandler.addToUpdate(this):c.AnimationHandler.removeFromUpdate(this);this.isPaused=!this.isPaused};c.Animation.prototype.stop=function(){this.isPaused=this.isPlaying=!1;c.AnimationHandler.removeFromUpdate(this);for(var a=0;a<this.hierarchy.length;a++){if(this.hierarchy[a].animationCache!==void 0){this.hierarchy[a] instanceof c.Bone?this.hierarchy[a].skinMatrix=this.hierarchy[a].animationCache.originalMatrix:this.hierarchy[a].matrix=this.hierarchy[a].animationCache.originalMatrix,delete this.hierarchy[a].animationCache}}};c.Animation.prototype.update=function(l){if(this.isPlaying){var f=["pos","rot","scl"],e,m,r,o,n,E,F,b,G=this.data.JIT.hierarchy,a,g;this.currentTime+=l*this.timeScale;g=this.currentTime;a=this.currentTime%=this.data.length;b=parseInt(Math.min(a*this.data.fps,this.data.length*this.data.fps),10);for(var h=0,p=this.hierarchy.length;h<p;h++){if(l=this.hierarchy[h],F=l.animationCache,this.JITCompile&&G[h][b]!==void 0){l instanceof c.Bone?(l.skinMatrix=G[h][b],l.matrixAutoUpdate=!1,l.matrixWorldNeedsUpdate=!1):(l.matrix=G[h][b],l.matrixAutoUpdate=!1,l.matrixWorldNeedsUpdate=!0)}else{if(this.JITCompile){l instanceof c.Bone?l.skinMatrix=l.animationCache.originalMatrix:l.matrix=l.animationCache.originalMatrix}for(var k=0;k<3;k++){e=f[k];n=F.prevKey[e];E=F.nextKey[e];if(E.time<=g){if(a<g){if(this.loop){n=this.data.hierarchy[h].keys[0];for(E=this.getNextKeyWith(e,h,1);E.time<a;){n=E,E=this.getNextKeyWith(e,h,E.index+1)}}else{this.stop();return}}else{do{n=E,E=this.getNextKeyWith(e,h,E.index+1)}while(E.time<a)}F.prevKey[e]=n;F.nextKey[e]=E}l.matrixAutoUpdate=!0;l.matrixWorldNeedsUpdate=!0;m=(a-n.time)/(E.time-n.time);r=n[e];o=E[e];if(m<0||m>1){console.log("THREE.Animation.update: Warning! Scale out of bounds:"+m+" on bone "+h),m=m<0?0:1}if(e==="pos"){if(e=l.position,this.interpolationType===c.AnimationHandler.LINEAR){e.x=r[0]+(o[0]-r[0])*m,e.y=r[1]+(o[1]-r[1])*m,e.z=r[2]+(o[2]-r[2])*m}else{if(this.interpolationType===c.AnimationHandler.CATMULLROM||this.interpolationType===c.AnimationHandler.CATMULLROM_FORWARD){if(this.points[0]=this.getPrevKeyWith("pos",h,n.index-1).pos,this.points[1]=r,this.points[2]=o,this.points[3]=this.getNextKeyWith("pos",h,E.index+1).pos,m=m*0.33+0.33,r=this.interpolateCatmullRom(this.points,m),e.x=r[0],e.y=r[1],e.z=r[2],this.interpolationType===c.AnimationHandler.CATMULLROM_FORWARD){m=this.interpolateCatmullRom(this.points,m*1.01),this.target.set(m[0],m[1],m[2]),this.target.subSelf(e),this.target.y=0,this.target.normalize(),m=Math.atan2(this.target.x,this.target.z),l.rotation.set(0,m,0)}}}}else{if(e==="rot"){c.Quaternion.slerp(r,o,l.quaternion,m)}else{if(e==="scl"){e=l.scale,e.x=r[0]+(o[0]-r[0])*m,e.y=r[1]+(o[1]-r[1])*m,e.z=r[2]+(o[2]-r[2])*m}}}}}}if(this.JITCompile&&G[0][b]===void 0){this.hierarchy[0].update(null,!0);for(h=0;h<this.hierarchy.length;h++){G[h][b]=this.hierarchy[h] instanceof c.Bone?this.hierarchy[h].skinMatrix.clone():this.hierarchy[h].matrix.clone()}}}};c.Animation.prototype.interpolateCatmullRom=function(a,e){var b=[],f=[],l,h,g,s,t,u;l=(a.length-1)*e;h=Math.floor(l);l-=h;b[0]=h===0?h:h-1;b[1]=h;b[2]=h>a.length-2?h:h+1;b[3]=h>a.length-3?h:h+2;h=a[b[0]];s=a[b[1]];t=a[b[2]];u=a[b[3]];b=l*l;g=l*b;f[0]=this.interpolate(h[0],s[0],t[0],u[0],l,b,g);f[1]=this.interpolate(h[1],s[1],t[1],u[1],l,b,g);f[2]=this.interpolate(h[2],s[2],t[2],u[2],l,b,g);return f};c.Animation.prototype.interpolate=function(g,b,a,m,f,e,n){g=(a-g)*0.5;m=(m-b)*0.5;return(2*(b-a)+g+m)*n+(-3*(b-a)-2*g-m)*e+g*f+b};c.Animation.prototype.getNextKeyWith=function(a,g,b){var h=this.data.hierarchy[g].keys;for(this.interpolationType===c.AnimationHandler.CATMULLROM||this.interpolationType===c.AnimationHandler.CATMULLROM_FORWARD?b=b<h.length-1?b:h.length-1:b%=h.length;b<h.length;b++){if(h[b][a]!==void 0){return h[b]}}return this.data.hierarchy[g].keys[0]};c.Animation.prototype.getPrevKeyWith=function(a,g,b){for(var h=this.data.hierarchy[g].keys,b=this.interpolationType===c.AnimationHandler.CATMULLROM||this.interpolationType===c.AnimationHandler.CATMULLROM_FORWARD?b>0?b:0:b>=0?b:b+h.length;b>=0;b--){if(h[b][a]!==void 0){return h[b]}}return this.data.hierarchy[g].keys[h.length-1]};c.CubeCamera=function(a,g,b,h){this.heightOffset=b;this.position=new c.Vector3(0,b,0);this.cameraPX=new c.PerspectiveCamera(90,1,a,g);this.cameraNX=new c.PerspectiveCamera(90,1,a,g);this.cameraPY=new c.PerspectiveCamera(90,1,a,g);this.cameraNY=new c.PerspectiveCamera(90,1,a,g);this.cameraPZ=new c.PerspectiveCamera(90,1,a,g);this.cameraNZ=new c.PerspectiveCamera(90,1,a,g);this.cameraPX.position=this.position;this.cameraNX.position=this.position;this.cameraPY.position=this.position;this.cameraNY.position=this.position;this.cameraPZ.position=this.position;this.cameraNZ.position=this.position;this.cameraPX.up.set(0,-1,0);this.cameraNX.up.set(0,-1,0);this.cameraPY.up.set(0,0,1);this.cameraNY.up.set(0,0,-1);this.cameraPZ.up.set(0,-1,0);this.cameraNZ.up.set(0,-1,0);this.targetPX=new c.Vector3(0,0,0);this.targetNX=new c.Vector3(0,0,0);this.targetPY=new c.Vector3(0,0,0);this.targetNY=new c.Vector3(0,0,0);this.targetPZ=new c.Vector3(0,0,0);this.targetNZ=new c.Vector3(0,0,0);this.renderTarget=new c.WebGLRenderTargetCube(h,h,{format:c.RGBFormat,magFilter:c.LinearFilter,minFilter:c.LinearFilter});this.updatePosition=function(e){this.position.copy(e);this.position.y+=this.heightOffset;this.targetPX.copy(this.position);this.targetNX.copy(this.position);this.targetPY.copy(this.position);this.targetNY.copy(this.position);this.targetPZ.copy(this.position);this.targetNZ.copy(this.position);this.targetPX.x+=1;this.targetNX.x-=1;this.targetPY.y+=1;this.targetNY.y-=1;this.targetPZ.z+=1;this.targetNZ.z-=1;this.cameraPX.lookAt(this.targetPX);this.cameraNX.lookAt(this.targetNX);this.cameraPY.lookAt(this.targetPY);this.cameraNY.lookAt(this.targetNY);this.cameraPZ.lookAt(this.targetPZ);this.cameraNZ.lookAt(this.targetNZ)};this.updateCubeMap=function(f,k){var e=this.renderTarget;e.activeCubeFace=0;f.render(k,this.cameraPX,e);e.activeCubeFace=1;f.render(k,this.cameraNX,e);e.activeCubeFace=2;f.render(k,this.cameraPY,e);e.activeCubeFace=3;f.render(k,this.cameraNY,e);e.activeCubeFace=4;f.render(k,this.cameraPZ,e);e.activeCubeFace=5;f.render(k,this.cameraNZ,e)}};c.FirstPersonCamera=function(){console.warn("DEPRECATED: FirstPersonCamera() is FirstPersonControls().")};c.PathCamera=function(){console.warn("DEPRECATED: PathCamera() is PathControls().")};c.FlyCamera=function(){console.warn("DEPRECATED: FlyCamera() is FlyControls().")};c.RollCamera=function(){console.warn("DEPRECATED: RollCamera() is RollControls().")};c.TrackballCamera=function(){console.warn("DEPRECATED: TrackballCamera() is TrackballControls().")};c.CombinedCamera=function(g,b,a,m,f,e,n){c.Camera.call(this);this.fov=a;this.left=-g/2;this.right=g/2;this.top=b/2;this.bottom=-b/2;this.cameraO=new c.OrthographicCamera(g/-2,g/2,b/2,b/-2,e,n);this.cameraP=new c.PerspectiveCamera(a,g/b,m,f);this.zoom=1;this.toPerspective()};c.CombinedCamera.prototype=new c.Camera;c.CombinedCamera.prototype.constructor=c.CoolCamera;c.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near;this.far=this.cameraP.far;this.cameraP.fov=this.fov/this.zoom;this.cameraP.updateProjectionMatrix();this.projectionMatrix=this.cameraP.projectionMatrix;this.inPersepectiveMode=!0;this.inOrthographicMode=!1};c.CombinedCamera.prototype.toOrthographic=function(){var b=Math.tan(this.fov/2)*((this.cameraP.near+this.cameraP.far)/2),a=2*b*this.cameraP.aspect/2;b/=this.zoom;a/=this.zoom;this.cameraO.left=-a;this.cameraO.right=a;this.cameraO.top=b;this.cameraO.bottom=-b;this.cameraO.updateProjectionMatrix();this.near=this.cameraO.near;this.far=this.cameraO.far;this.projectionMatrix=this.cameraO.projectionMatrix;this.inPersepectiveMode=!1;this.inOrthographicMode=!0};c.CombinedCamera.prototype.setFov=function(a){this.fov=a;this.inPersepectiveMode?this.toPerspective():this.toOrthographic()};c.CombinedCamera.prototype.setLens=function(f,b){b||(b=43.25);var a=2*Math.atan(b/(f*2));a*=180/Math.PI;this.setFov(a);return a};c.CombinedCamera.prototype.setZoom=function(a){this.zoom=a;this.inPersepectiveMode?this.toPerspective():this.toOrthographic()};c.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=!1};c.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0;this.rotation.y=Math.PI;this.rotation.z=0;this.rotationAutoUpdate=!1};c.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0;this.rotation.y=-Math.PI/2;this.rotation.z=0;this.rotationAutoUpdate=!1};c.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0;this.rotation.y=Math.PI/2;this.rotation.z=0;this.rotationAutoUpdate=!1};c.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=!1};c.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=!1};c.FirstPersonControls=function(f,b){function a(e,j){return function(){j.apply(e,arguments)}}this.object=f;this.target=new c.Vector3(0,0,0);this.domElement=b!==void 0?b:document;this.movementSpeed=1;this.lookSpeed=0.005;this.noFly=!1;this.lookVertical=!0;this.autoForward=!1;this.activeLook=!0;this.heightSpeed=!1;this.heightCoef=1;this.heightMin=0;this.constrainVertical=!1;this.verticalMin=0;this.verticalMax=Math.PI;this.theta=this.phi=this.lon=this.lat=this.mouseY=this.mouseX=this.autoSpeedFactor=0;this.mouseDragOn=this.freeze=this.moveRight=this.moveLeft=this.moveBackward=this.moveForward=!1;this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2,this.domElement.setAttribute("tabindex",-1));this.onMouseDown=function(e){this.domElement!==document&&this.domElement.focus();e.preventDefault();e.stopPropagation();if(this.activeLook){switch(e.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}}this.mouseDragOn=!0};this.onMouseUp=function(e){e.preventDefault();e.stopPropagation();if(this.activeLook){switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}}this.mouseDragOn=!1};this.onMouseMove=function(e){this.domElement===document?(this.mouseX=e.pageX-this.viewHalfX,this.mouseY=e.pageY-this.viewHalfY):(this.mouseX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=e.pageY-this.domElement.offsetTop-this.viewHalfY)};this.onKeyDown=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 82:this.moveUp=!0;break;case 70:this.moveDown=!0;break;case 81:this.freeze=!this.freeze}};this.onKeyUp=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1;break;case 82:this.moveUp=!1;break;case 70:this.moveDown=!1}};this.update=function(j){var k=0;if(!this.freeze){if(this.heightSpeed){var e=c.Math.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=j*e*this.heightCoef}else{this.autoSpeedFactor=0}k=j*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(k+this.autoSpeedFactor));this.moveBackward&&this.object.translateZ(k);this.moveLeft&&this.object.translateX(-k);this.moveRight&&this.object.translateX(k);this.moveUp&&this.object.translateY(k);this.moveDown&&this.object.translateY(-k);e=j*this.lookSpeed;this.activeLook||(e=0);this.lon+=this.mouseX*e;this.lookVertical&&(this.lat-=this.mouseY*e);this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=(90-this.lat)*Math.PI/180;this.theta=this.lon*Math.PI/180;j=this.target;k=this.object.position;j.x=k.x+100*Math.sin(this.phi)*Math.cos(this.theta);j.y=k.y+100*Math.cos(this.phi);j.z=k.z+100*Math.sin(this.phi)*Math.sin(this.theta)}j=1;this.constrainVertical&&(j=Math.PI/(this.verticalMax-this.verticalMin));this.lon+=this.mouseX*e;this.lookVertical&&(this.lat-=this.mouseY*e*j);this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=(90-this.lat)*Math.PI/180;this.theta=this.lon*Math.PI/180;if(this.constrainVertical){this.phi=c.Math.mapLinear(this.phi,0,Math.PI,this.verticalMin,this.verticalMax)}j=this.target;k=this.object.position;j.x=k.x+100*Math.sin(this.phi)*Math.cos(this.theta);j.y=k.y+100*Math.cos(this.phi);j.z=k.z+100*Math.sin(this.phi)*Math.sin(this.theta);this.object.lookAt(j)};this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1);this.domElement.addEventListener("mousemove",a(this,this.onMouseMove),!1);this.domElement.addEventListener("mousedown",a(this,this.onMouseDown),!1);this.domElement.addEventListener("mouseup",a(this,this.onMouseUp),!1);this.domElement.addEventListener("keydown",a(this,this.onKeyDown),!1);this.domElement.addEventListener("keyup",a(this,this.onKeyUp),!1)};c.PathControls=function(a,g){function e(j){if((j*=2)<1){return 0.5*j*j}return -0.5*(--j*(j-2)-1)}function b(j,k){return function(){k.apply(j,arguments)}}function p(A,j,k,l){var m={name:k,fps:0.6,length:l,hierarchy:[]},n,x=j.getControlPointsArray(),t=j.getLength(),y=x.length,z=0;n=y-1;j={parent:-1,keys:[]};j.keys[0]={time:0,pos:x[0],rot:[0,0,0,1],scl:[1,1,1]};j.keys[n]={time:l,pos:x[n],rot:[0,0,0,1],scl:[1,1,1]};for(n=1;n<y-1;n++){z=l*t.chunks[n]/t.total,j.keys[n]={time:z,pos:x[n]}}m.hierarchy[0]=j;c.AnimationHandler.add(m);return new c.Animation(A,k,c.AnimationHandler.CATMULLROM_FORWARD,!1)}function h(k,m){var j,l,n=new c.Geometry;for(j=0;j<k.points.length*m;j++){l=j/(k.points.length*m),l=k.getPoint(l),n.vertices[j]=new c.Vertex(new c.Vector3(l.x,l.y,l.z))}return n}this.object=a;this.domElement=g!==void 0?g:document;this.id="PathControls"+c.PathControlsIdCounter++;this.duration=10000;this.waypoints=[];this.useConstantSpeed=!0;this.resamplingCoef=50;this.debugPath=new c.Object3D;this.debugDummy=new c.Object3D;this.animationParent=new c.Object3D;this.lookSpeed=0.005;this.lookHorizontal=this.lookVertical=!0;this.verticalAngleMap={srcRange:[0,2*Math.PI],dstRange:[0,2*Math.PI]};this.horizontalAngleMap={srcRange:[0,2*Math.PI],dstRange:[0,2*Math.PI]};this.target=new c.Object3D;this.theta=this.phi=this.lon=this.lat=this.mouseY=this.mouseX=0;this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2,this.domElement.setAttribute("tabindex",-1));var f=Math.PI*2,o=Math.PI/180;this.update=function(l){var j;this.lookHorizontal&&(this.lon+=this.mouseX*this.lookSpeed*l);this.lookVertical&&(this.lat-=this.mouseY*this.lookSpeed*l);this.lon=Math.max(0,Math.min(360,this.lon));this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=(90-this.lat)*o;this.theta=this.lon*o;l=this.phi%f;this.phi=l>=0?l:l+f;j=this.verticalAngleMap.srcRange;l=this.verticalAngleMap.dstRange;j=c.Math.mapLinear(this.phi,j[0],j[1],l[0],l[1]);var k=l[1]-l[0];this.phi=e((j-l[0])/k)*k+l[0];j=this.horizontalAngleMap.srcRange;l=this.horizontalAngleMap.dstRange;j=c.Math.mapLinear(this.theta,j[0],j[1],l[0],l[1]);k=l[1]-l[0];this.theta=e((j-l[0])/k)*k+l[0];l=this.target.position;l.x=100*Math.sin(this.phi)*Math.cos(this.theta);l.y=100*Math.cos(this.phi);l.z=100*Math.sin(this.phi)*Math.sin(this.theta);this.object.lookAt(this.target.position)};this.onMouseMove=function(j){this.domElement===document?(this.mouseX=j.pageX-this.viewHalfX,this.mouseY=j.pageY-this.viewHalfY):(this.mouseX=j.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=j.pageY-this.domElement.offsetTop-this.viewHalfY)};this.init=function(){this.spline=new c.Spline;this.spline.initFromArray(this.waypoints);this.useConstantSpeed&&this.spline.reparametrizeByArcLength(this.resamplingCoef);if(this.createDebugDummy){var k=new c.MeshLambertMaterial({color:30719}),n=new c.MeshLambertMaterial({color:65280}),q=new c.CubeGeometry(10,10,20),j=new c.CubeGeometry(2,2,10);this.animationParent=new c.Mesh(q,k);k=new c.Mesh(j,n);k.position.set(0,10,0);this.animation=p(this.animationParent,this.spline,this.id,this.duration);this.animationParent.add(this.object);this.animationParent.add(this.target);this.animationParent.add(k)}else{this.animation=p(this.animationParent,this.spline,this.id,this.duration),this.animationParent.add(this.target),this.animationParent.add(this.object)}if(this.createDebugPath){var k=this.debugPath,n=this.spline,j=h(n,10),q=h(n,10),l=new c.LineBasicMaterial({color:16711680,linewidth:3}),j=new c.Line(j,l),q=new c.ParticleSystem(q,new c.ParticleBasicMaterial({color:16755200,size:3}));j.scale.set(1,1,1);k.add(j);q.scale.set(1,1,1);k.add(q);for(var j=new c.SphereGeometry(1,16,8),l=new c.MeshBasicMaterial({color:65280}),m=0;m<n.points.length;m++){q=new c.Mesh(j,l),q.position.copy(n.points[m]),k.add(q)}}this.domElement.addEventListener("mousemove",b(this,this.onMouseMove),!1)}};c.PathControlsIdCounter=0;c.FlyControls=function(f,b){function a(e,j){return function(){j.apply(e,arguments)}}this.object=f;this.domElement=b!==void 0?b:document;b&&this.domElement.setAttribute("tabindex",-1);this.movementSpeed=1;this.rollSpeed=0.005;this.autoForward=this.dragToLook=!1;this.object.useQuaternion=!0;this.tmpQuaternion=new c.Quaternion;this.mouseStatus=0;this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0};this.moveVector=new c.Vector3(0,0,0);this.rotationVector=new c.Vector3(0,0,0);this.handleEvent=function(e){if(typeof this[e.type]=="function"){this[e.type](e)}};this.keydown=function(e){if(!e.altKey){switch(e.keyCode){case 16:this.movementSpeedMultiplier=0.1;break;case 87:this.moveState.forward=1;break;case 83:this.moveState.back=1;break;case 65:this.moveState.left=1;break;case 68:this.moveState.right=1;break;case 82:this.moveState.up=1;break;case 70:this.moveState.down=1;break;case 38:this.moveState.pitchUp=1;break;case 40:this.moveState.pitchDown=1;break;case 37:this.moveState.yawLeft=1;break;case 39:this.moveState.yawRight=1;break;case 81:this.moveState.rollLeft=1;break;case 69:this.moveState.rollRight=1}this.updateMovementVector();this.updateRotationVector()}};this.keyup=function(e){switch(e.keyCode){case 16:this.movementSpeedMultiplier=1;break;case 87:this.moveState.forward=0;break;case 83:this.moveState.back=0;break;case 65:this.moveState.left=0;break;case 68:this.moveState.right=0;break;case 82:this.moveState.up=0;break;case 70:this.moveState.down=0;break;case 38:this.moveState.pitchUp=0;break;case 40:this.moveState.pitchDown=0;break;case 37:this.moveState.yawLeft=0;break;case 39:this.moveState.yawRight=0;break;case 81:this.moveState.rollLeft=0;break;case 69:this.moveState.rollRight=0}this.updateMovementVector();this.updateRotationVector()};this.mousedown=function(e){this.domElement!==document&&this.domElement.focus();e.preventDefault();e.stopPropagation();if(this.dragToLook){this.mouseStatus++}else{switch(e.button){case 0:this.object.moveForward=!0;break;case 2:this.object.moveBackward=!0}}};this.mousemove=function(l){if(!this.dragToLook||this.mouseStatus>0){var m=this.getContainerDimensions(),e=m.size[0]/2,k=m.size[1]/2;this.moveState.yawLeft=-(l.pageX-m.offset[0]-e)/e;this.moveState.pitchDown=(l.pageY-m.offset[1]-k)/k;this.updateRotationVector()}};this.mouseup=function(e){e.preventDefault();e.stopPropagation();if(this.dragToLook){this.mouseStatus--,this.moveState.yawLeft=this.moveState.pitchDown=0}else{switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}}this.updateRotationVector()};this.update=function(e){var j=e*this.movementSpeed;e*=this.rollSpeed;this.object.translateX(this.moveVector.x*j);this.object.translateY(this.moveVector.y*j);this.object.translateZ(this.moveVector.z*j);this.tmpQuaternion.set(this.rotationVector.x*e,this.rotationVector.y*e,this.rotationVector.z*e,1).normalize();this.object.quaternion.multiplySelf(this.tmpQuaternion);this.object.matrix.setPosition(this.object.position);this.object.matrix.setRotationFromQuaternion(this.object.quaternion);this.object.matrixWorldNeedsUpdate=!0};this.updateMovementVector=function(){var e=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right;this.moveVector.y=-this.moveState.down+this.moveState.up;this.moveVector.z=-e+this.moveState.back};this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp;this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft;this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft};this.getContainerDimensions=function(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}};this.domElement.addEventListener("mousemove",a(this,this.mousemove),!1);this.domElement.addEventListener("mousedown",a(this,this.mousedown),!1);this.domElement.addEventListener("mouseup",a(this,this.mouseup),!1);this.domElement.addEventListener("keydown",a(this,this.keydown),!1);this.domElement.addEventListener("keyup",a(this,this.keyup),!1);this.updateMovementVector();this.updateRotationVector()};c.RollControls=function(l,p){this.object=l;this.domElement=p!==void 0?p:document;this.mouseLook=!0;this.autoForward=!1;this.rollSpeed=this.movementSpeed=this.lookSpeed=1;this.constrainVertical=[-0.9,0.9];this.object.matrixAutoUpdate=!1;this.forward=new c.Vector3(0,0,1);this.roll=0;var o=new c.Vector3,r=new c.Vector3,f=new c.Vector3,a=new c.Matrix4,E=!1,g=1,h=0,b=0,k=0,m=0,C=0,e=window.innerWidth/2,D=window.innerHeight/2;this.update=function(j){if(this.mouseLook){var n=j*this.lookSpeed;this.rotateHorizontally(n*m);this.rotateVertically(n*C)}n=j*this.movementSpeed;this.object.translateZ(-n*(h>0||this.autoForward&&!(h<0)?1:h));this.object.translateX(n*b);this.object.translateY(n*k);E&&(this.roll+=this.rollSpeed*j*g);if(this.forward.y>this.constrainVertical[1]){this.forward.y=this.constrainVertical[1],this.forward.normalize()}else{if(this.forward.y<this.constrainVertical[0]){this.forward.y=this.constrainVertical[0],this.forward.normalize()}}f.copy(this.forward);r.set(0,1,0);o.cross(r,f).normalize();r.cross(f,o).normalize();this.object.matrix.n11=o.x;this.object.matrix.n12=r.x;this.object.matrix.n13=f.x;this.object.matrix.n21=o.y;this.object.matrix.n22=r.y;this.object.matrix.n23=f.y;this.object.matrix.n31=o.z;this.object.matrix.n32=r.z;this.object.matrix.n33=f.z;a.identity();a.n11=Math.cos(this.roll);a.n12=-Math.sin(this.roll);a.n21=Math.sin(this.roll);a.n22=Math.cos(this.roll);this.object.matrix.multiplySelf(a);this.object.matrixWorldNeedsUpdate=!0;this.object.matrix.n14=this.object.position.x;this.object.matrix.n24=this.object.position.y;this.object.matrix.n34=this.object.position.z};this.translateX=function(j){this.object.position.x+=this.object.matrix.n11*j;this.object.position.y+=this.object.matrix.n21*j;this.object.position.z+=this.object.matrix.n31*j};this.translateY=function(j){this.object.position.x+=this.object.matrix.n12*j;this.object.position.y+=this.object.matrix.n22*j;this.object.position.z+=this.object.matrix.n32*j};this.translateZ=function(j){this.object.position.x-=this.object.matrix.n13*j;this.object.position.y-=this.object.matrix.n23*j;this.object.position.z-=this.object.matrix.n33*j};this.rotateHorizontally=function(j){o.set(this.object.matrix.n11,this.object.matrix.n21,this.object.matrix.n31);o.multiplyScalar(j);this.forward.subSelf(o);this.forward.normalize()};this.rotateVertically=function(j){r.set(this.object.matrix.n12,this.object.matrix.n22,this.object.matrix.n32);r.multiplyScalar(j);this.forward.addSelf(r);this.forward.normalize()};this.domElement.addEventListener("contextmenu",function(j){j.preventDefault()},!1);this.domElement.addEventListener("mousemove",function(j){m=(j.clientX-e)/window.innerWidth;C=(j.clientY-D)/window.innerHeight},!1);this.domElement.addEventListener("mousedown",function(j){j.preventDefault();j.stopPropagation();switch(j.button){case 0:h=1;break;case 2:h=-1}},!1);this.domElement.addEventListener("mouseup",function(j){j.preventDefault();j.stopPropagation();switch(j.button){case 0:h=0;break;case 2:h=0}},!1);this.domElement.addEventListener("keydown",function(j){switch(j.keyCode){case 38:case 87:h=1;break;case 37:case 65:b=-1;break;case 40:case 83:h=-1;break;case 39:case 68:b=1;break;case 81:E=!0;g=1;break;case 69:E=!0;g=-1;break;case 82:k=1;break;case 70:k=-1}},!1);this.domElement.addEventListener("keyup",function(j){switch(j.keyCode){case 38:case 87:h=0;break;case 37:case 65:b=0;break;case 40:case 83:h=0;break;case 39:case 68:b=0;break;case 81:E=!1;break;case 69:E=!1;break;case 82:k=0;break;case 70:k=0}},!1)};c.TrackballControls=function(A,b){var a=this,e={NONE:-1,ROTATE:0,ZOOM:1,PAN:2};this.object=A;this.domElement=b!==void 0?b:document;this.enabled=!0;this.screen={width:window.innerWidth,height:window.innerHeight,offsetLeft:0,offsetTop:0};this.radius=(this.screen.width+this.screen.height)/4;this.rotateSpeed=1;this.zoomSpeed=1.2;this.panSpeed=0.3;this.staticMoving=this.noPan=this.noZoom=this.noRotate=!1;this.dynamicDampingFactor=0.2;this.minDistance=0;this.maxDistance=Infinity;this.keys=[65,83,68];this.target=new c.Vector3(0,0,0);var f=!1,h=e.NONE,g=new c.Vector3,k=new c.Vector3,l=new c.Vector3,p=new c.Vector2,o=new c.Vector2,y=new c.Vector2,z=new c.Vector2;this.handleEvent=function(j){if(typeof this[j.type]=="function"){this[j.type](j)}};this.getMouseOnScreen=function(m,j){return new c.Vector2((m-a.screen.offsetLeft)/a.radius*0.5,(j-a.screen.offsetTop)/a.radius*0.5)};this.getMouseProjectionOnBall=function(m,n){var q=new c.Vector3((m-a.screen.width*0.5-a.screen.offsetLeft)/a.radius,(a.screen.height*0.5+a.screen.offsetTop-n)/a.radius,0),j=q.length();j>1?q.normalize():q.z=Math.sqrt(1-j*j);g.copy(a.object.position).subSelf(a.target);j=a.object.up.clone().setLength(q.y);j.addSelf(a.object.up.clone().crossSelf(g).setLength(q.x));j.addSelf(g.setLength(q.z));return j};this.rotateCamera=function(){var j=Math.acos(k.dot(l)/k.length()/l.length());if(j){var m=(new c.Vector3).cross(k,l).normalize(),n=new c.Quaternion;j*=a.rotateSpeed;n.setFromAxisAngle(m,-j);n.multiplyVector3(g);n.multiplyVector3(a.object.up);n.multiplyVector3(l);a.staticMoving?k=l:(n.setFromAxisAngle(m,j*(a.dynamicDampingFactor-1)),n.multiplyVector3(k))}};this.zoomCamera=function(){var j=1+(o.y-p.y)*a.zoomSpeed;j!==1&&j>0&&(g.multiplyScalar(j),a.staticMoving?p=o:p.y+=(o.y-p.y)*this.dynamicDampingFactor)};this.panCamera=function(){var m=z.clone().subSelf(y);if(m.lengthSq()){m.multiplyScalar(g.length()*a.panSpeed);var j=g.clone().crossSelf(a.object.up).setLength(m.x);j.addSelf(a.object.up.clone().setLength(m.y));a.object.position.addSelf(j);a.target.addSelf(j);a.staticMoving?y=z:y.addSelf(m.sub(z,y).multiplyScalar(a.dynamicDampingFactor))}};this.checkDistances=function(){if(!a.noZoom||!a.noPan){a.object.position.lengthSq()>a.maxDistance*a.maxDistance&&a.object.position.setLength(a.maxDistance),g.lengthSq()<a.minDistance*a.minDistance&&a.object.position.add(a.target,g.setLength(a.minDistance))}};this.update=function(){g.copy(a.object.position).subSelf(this.target);a.noRotate||a.rotateCamera();a.noZoom||a.zoomCamera();a.noPan||a.panCamera();a.object.position.add(a.target,g);a.checkDistances();a.object.lookAt(a.target)};this.domElement.addEventListener("contextmenu",function(j){j.preventDefault()},!1);this.domElement.addEventListener("mousemove",function(j){a.enabled&&(f&&(k=l=a.getMouseProjectionOnBall(j.clientX,j.clientY),p=o=a.getMouseOnScreen(j.clientX,j.clientY),y=z=a.getMouseOnScreen(j.clientX,j.clientY),f=!1),h!==e.NONE&&(h===e.ROTATE&&!a.noRotate?l=a.getMouseProjectionOnBall(j.clientX,j.clientY):h===e.ZOOM&&!a.noZoom?o=a.getMouseOnScreen(j.clientX,j.clientY):h===e.PAN&&!a.noPan&&(z=a.getMouseOnScreen(j.clientX,j.clientY))))},!1);this.domElement.addEventListener("mousedown",function(j){if(a.enabled&&(j.preventDefault(),j.stopPropagation(),h===e.NONE)){h=j.button,h===e.ROTATE&&!a.noRotate?k=l=a.getMouseProjectionOnBall(j.clientX,j.clientY):h===e.ZOOM&&!a.noZoom?p=o=a.getMouseOnScreen(j.clientX,j.clientY):this.noPan||(y=z=a.getMouseOnScreen(j.clientX,j.clientY))}},!1);this.domElement.addEventListener("mouseup",function(j){if(a.enabled){j.preventDefault(),j.stopPropagation(),h=e.NONE}},!1);window.addEventListener("keydown",function(j){if(a.enabled&&h===e.NONE){if(j.keyCode===a.keys[e.ROTATE]&&!a.noRotate){h=e.ROTATE}else{if(j.keyCode===a.keys[e.ZOOM]&&!a.noZoom){h=e.ZOOM}else{if(j.keyCode===a.keys[e.PAN]&&!a.noPan){h=e.PAN}}}h!==e.NONE&&(f=!0)}},!1);window.addEventListener("keyup",function(){if(a.enabled&&h!==e.NONE){h=e.NONE}},!1)};c.CubeGeometry=function(a,f,b,k,t,p,m,w){function e(I,K,L,S,T,j,z,C){var F,H=k||1,J=t||1,s=T/2,v=j/2,x=n.vertices.length;if(I==="x"&&K==="y"||I==="y"&&K==="x"){F="z"}else{if(I==="x"&&K==="z"||I==="z"&&K==="x"){F="y",J=p||1}else{if(I==="z"&&K==="y"||I==="y"&&K==="z"){F="x",H=p||1}}}var y=H+1,B=J+1,A=T/H,D=j/J,E=new c.Vector3;E[F]=z>0?1:-1;for(T=0;T<B;T++){for(j=0;j<y;j++){var G=new c.Vector3;G[I]=(j*A-s)*L;G[K]=(T*D-v)*S;G[F]=z;n.vertices.push(new c.Vertex(G))}}for(T=0;T<J;T++){for(j=0;j<H;j++){I=new c.Face4(j+y*T+x,j+y*(T+1)+x,j+1+y*(T+1)+x,j+1+y*T+x),I.normal.copy(E),I.vertexNormals.push(E.clone(),E.clone(),E.clone(),E.clone()),I.materialIndex=C,n.faces.push(I),n.faceVertexUvs[0].push([new c.UV(j/H,T/J),new c.UV(j/H,(T+1)/J),new c.UV((j+1)/H,(T+1)/J),new c.UV((j+1)/H,T/J)])}}}c.Geometry.call(this);var n=this,g=a/2,N=f/2,l=b/2,q,r,M,o,u,O;if(m!==void 0){if(m instanceof Array){this.materials=m}else{this.materials=[];for(q=0;q<6;q++){this.materials.push(m)}}q=0;o=1;r=2;u=3;M=4;O=5}else{this.materials=[]}this.sides={px:!0,nx:!0,py:!0,ny:!0,pz:!0,nz:!0};if(w!=void 0){for(var h in w){this.sides[h]!=void 0&&(this.sides[h]=w[h])}}this.sides.px&&e("z","y",-1,-1,b,f,g,q);this.sides.nx&&e("z","y",1,-1,b,f,-g,o);this.sides.py&&e("x","z",1,1,a,b,N,r);this.sides.ny&&e("x","z",1,-1,a,b,-N,u);this.sides.pz&&e("x","y",1,-1,a,f,l,M);this.sides.nz&&e("x","y",-1,-1,a,f,-l,O);this.computeCentroids();this.mergeVertices()};c.CubeGeometry.prototype=new c.Geometry;c.CubeGeometry.prototype.constructor=c.CubeGeometry;c.CylinderGeometry=function(a,e,b,f,m,h){c.Geometry.call(this);var a=a!=null?a:20,e=e!=null?e:20,b=b||100,g=b/2,f=f||8,m=m||1,p,q,F=[],B=[];for(q=0;q<=m;q++){var k=[],w=[],o=q/m,t=o*(e-a)+a;for(p=0;p<=f;p++){var r=p/f;this.vertices.push(new c.Vertex(new c.Vector3(t*Math.sin(r*Math.PI*2),-o*b+g,t*Math.cos(r*Math.PI*2))));k.push(this.vertices.length-1);w.push(new c.UV(r,o))}F.push(k);B.push(w)}for(q=0;q<m;q++){for(p=0;p<f;p++){var b=F[q][p],k=F[q+1][p],w=F[q+1][p+1],o=F[q][p+1],t=this.vertices[b].position.clone().setY(0).normalize(),r=this.vertices[k].position.clone().setY(0).normalize(),R=this.vertices[w].position.clone().setY(0).normalize(),u=this.vertices[o].position.clone().setY(0).normalize(),S=B[q][p].clone(),l=B[q+1][p].clone(),n=B[q+1][p+1].clone(),Q=B[q][p+1].clone();this.faces.push(new c.Face4(b,k,w,o,[t,r,R,u]));this.faceVertexUvs[0].push([S,l,n,Q])}}if(!h&&a>0){this.vertices.push(new c.Vertex(new c.Vector3(0,g,0)));for(p=0;p<f;p++){b=F[0][p],k=F[0][p+1],w=this.vertices.length-1,t=new c.Vector3(0,1,0),r=new c.Vector3(0,1,0),R=new c.Vector3(0,1,0),S=B[0][p].clone(),l=B[0][p+1].clone(),n=new c.UV(l.u,0),this.faces.push(new c.Face3(b,k,w,[t,r,R])),this.faceVertexUvs[0].push([S,l,n])}}if(!h&&e>0){this.vertices.push(new c.Vertex(new c.Vector3(0,-g,0)));for(p=0;p<f;p++){b=F[q][p+1],k=F[q][p],w=this.vertices.length-1,t=new c.Vector3(0,-1,0),r=new c.Vector3(0,-1,0),R=new c.Vector3(0,-1,0),S=B[q][p+1].clone(),l=B[q][p].clone(),n=new c.UV(l.u,1),this.faces.push(new c.Face3(b,k,w,[t,r,R])),this.faceVertexUvs[0].push([S,l,n])}}this.computeCentroids();this.computeFaceNormals()};c.CylinderGeometry.prototype=new c.Geometry;c.CylinderGeometry.prototype.constructor=c.CylinderGeometry;c.ExtrudeGeometry=function(b,g){if(typeof b!=="undefined"){c.Geometry.call(this);var b=b instanceof Array?b:[b],j,k=b.length,a;this.shapebb=b[k-1].getBoundingBox();for(j=0;j<k;j++){a=b[j],this.addShape(a,g)}this.computeCentroids();this.computeFaceNormals()}};c.ExtrudeGeometry.prototype=new c.Geometry;c.ExtrudeGeometry.prototype.constructor=c.ExtrudeGeometry;c.ExtrudeGeometry.prototype.addShape=function(ac,ae){function ad(j,z,C){z||console.log("die");return z.clone().multiplyScalar(C).addSelf(j)}function E(Q,L,z){var T=c.ExtrudeGeometry.__v1,V=c.ExtrudeGeometry.__v2,j=c.ExtrudeGeometry.__v3,C=c.ExtrudeGeometry.__v4,D=c.ExtrudeGeometry.__v5,N=c.ExtrudeGeometry.__v6;T.set(Q.x-L.x,Q.y-L.y);V.set(Q.x-z.x,Q.y-z.y);T=T.normalize();V=V.normalize();j.set(-T.y,T.x);C.set(V.y,-V.x);D.copy(Q).addSelf(j);N.copy(Q).addSelf(C);if(D.equals(N)){return C.clone()}D.copy(L).addSelf(j);N.copy(z).addSelf(C);j=T.dot(C);C=N.subSelf(D).dot(C);j===0&&(console.log("Either infinite or no solutions!"),C===0?console.log("Its finite solutions."):console.log("Too bad, no solutions."));C/=j;if(C<0){return L=Math.atan2(L.y-Q.y,L.x-Q.x),Q=Math.atan2(z.y-Q.y,z.x-Q.x),L>Q&&(Q+=Math.PI*2),Q=(L+Q)/2,new c.Vector2(-Math.cos(Q),-Math.sin(Q))}return T.multiplyScalar(C).addSelf(D).subSelf(Q).clone()}function U(Q){for(x=Q.length;--x>=0;){u=x;ab=x-1;ab<0&&(ab=Q.length-1);for(var L=0,z=m+f*2,L=0;L<z;L++){var T=v*L,V=v*(L+1),j=J+u+T,C=J+u+V,D=j,T=J+ab+T,V=J+ab+V,N=C;D+=b;T+=b;V+=b;N+=b;H.faces.push(new c.Face4(D,T,V,N,null,null,y));y&&(D=L/z,T=(L+1)/z,V=W+aa*2,j=(H.vertices[j].position.z+aa)/V,C=(H.vertices[C].position.z+aa)/V,H.faceVertexUvs[0].push([new c.UV(j,D),new c.UV(C,D),new c.UV(C,T),new c.UV(j,T)]))}}}function R(j,z,C){H.vertices.push(new c.Vertex(new c.Vector3(j,z,C)))}function G(D,Q,j){D+=b;Q+=b;j+=b;H.faces.push(new c.Face3(D,Q,j,null,null,F));if(F){var L=M.maxY,N=M.maxX,z=H.vertices[Q].position.x,Q=H.vertices[Q].position.y,C=H.vertices[j].position.x,j=H.vertices[j].position.y;H.faceVertexUvs[0].push([new c.UV(H.vertices[D].position.x/N,H.vertices[D].position.y/L),new c.UV(z/N,Q/L),new c.UV(C/N,j/L)])}}var W=ae.amount!==void 0?ae.amount:100,aa=ae.bevelThickness!==void 0?ae.bevelThickness:6,h=ae.bevelSize!==void 0?ae.bevelSize:aa-2,f=ae.bevelSegments!==void 0?ae.bevelSegments:3,q=ae.bevelEnabled!==void 0?ae.bevelEnabled:!0,s=ae.curveSegments!==void 0?ae.curveSegments:12,m=ae.steps!==void 0?ae.steps:1,w=ae.bendPath,p=ae.extrudePath,t,B=!1,a=ae.useSpacedPoints!==void 0?ae.useSpacedPoints:!1,F=ae.material,y=ae.extrudeMaterial,M=this.shapebb;if(p){t=p.getPoints(s),m=t.length,B=!0,q=!1}q||(h=aa=f=0);var o,e,g,H=this,b=this.vertices.length;w&&ac.addWrapPath(w);s=a?ac.extractAllSpacedPoints(s):ac.extractAllPoints(s);w=s.shape;s=s.holes;if(p=!c.Shape.Utils.isClockWise(w)){w=w.reverse();e=0;for(g=s.length;e<g;e++){o=s[e],c.Shape.Utils.isClockWise(o)&&(s[e]=o.reverse())}p=!1}p=c.Shape.Utils.triangulateShape(w,s);a=w;e=0;for(g=s.length;e<g;e++){o=s[e],w=w.concat(o)}var x,K,r,I,k,A,v=w.length,l=p.length,P=[];x=0;K=a.length;u=K-1;for(ab=x+1;x<K;x++,u++,ab++){u===K&&(u=0),ab===K&&(ab=0),P[x]=E(a[x],a[u],a[ab])}var O=[],S,n=P.concat();e=0;for(g=s.length;e<g;e++){o=s[e];S=[];x=0;K=o.length;u=K-1;for(ab=x+1;x<K;x++,u++,ab++){u===K&&(u=0),ab===K&&(ab=0),S[x]=E(o[x],o[u],o[ab])}O.push(S);n=n.concat(S)}for(r=0;r<f;r++){I=r/f;k=aa*(1-I);I=h*Math.sin(I*Math.PI/2);x=0;for(K=a.length;x<K;x++){A=ad(a[x],P[x],I),R(A.x,A.y,-k)}e=0;for(g=s.length;e<g;e++){o=s[e];S=O[e];x=0;for(K=o.length;x<K;x++){A=ad(o[x],S[x],I),R(A.x,A.y,-k)}}}I=h;for(x=0;x<v;x++){A=q?ad(w[x],n[x],I):w[x],B?R(A.x,A.y+t[0].y,t[0].x):R(A.x,A.y,0)}for(r=1;r<=m;r++){for(x=0;x<v;x++){A=q?ad(w[x],n[x],I):w[x],B?R(A.x,A.y+t[r-1].y,t[r-1].x):R(A.x,A.y,W/m*r)}}for(r=f-1;r>=0;r--){I=r/f;k=aa*(1-I);I=h*Math.sin(I*Math.PI/2);x=0;for(K=a.length;x<K;x++){A=ad(a[x],P[x],I),R(A.x,A.y,W+k)}e=0;for(g=s.length;e<g;e++){o=s[e];S=O[e];x=0;for(K=o.length;x<K;x++){A=ad(o[x],S[x],I),B?R(A.x,A.y+t[m-1].y,t[m-1].x+k):R(A.x,A.y,W+k)}}}if(q){q=v*0;for(x=0;x<l;x++){h=p[x],G(h[2]+q,h[1]+q,h[0]+q)}q=v*(m+f*2);for(x=0;x<l;x++){h=p[x],G(h[0]+q,h[1]+q,h[2]+q)}}else{for(x=0;x<l;x++){h=p[x],G(h[2],h[1],h[0])}for(x=0;x<l;x++){h=p[x],G(h[0]+v*m,h[1]+v*m,h[2]+v*m)}}var u,ab,J=0;U(a);J+=a.length;e=0;for(g=s.length;e<g;e++){o=s[e],U(o),J+=o.length}};c.ExtrudeGeometry.__v1=new c.Vector2;c.ExtrudeGeometry.__v2=new c.Vector2;c.ExtrudeGeometry.__v3=new c.Vector2;c.ExtrudeGeometry.__v4=new c.Vector2;c.ExtrudeGeometry.__v5=new c.Vector2;c.ExtrudeGeometry.__v6=new c.Vector2;c.IcosahedronGeometry=function(l){function v(j,m,n){var o=Math.sqrt(j*j+m*m+n*n);return e.vertices.push(new c.Vertex(new c.Vector3(j/o,m/o,n/o)))-1}function u(n,o,p,q){var j=e.vertices[n].position,r=e.vertices[o].position,m=e.vertices[p].position,n=new c.Face3(n,o,p);n.vertexNormals.push(j.clone().normalize(),r.clone().normalize(),m.clone().normalize());q.faces.push(n);q.faceVertexUvs[0].push([new c.UV(1-(Math.atan2(j.z,j.x)+Math.PI)%Math.PI/Math.PI*0.5,0.5-j.y/2),new c.UV(1-(Math.atan2(r.z,r.x)+Math.PI)%Math.PI/Math.PI*0.5,0.5-r.y/2),new c.UV(1-(Math.atan2(m.z,m.x)+Math.PI)%Math.PI/Math.PI*0.5,0.5-m.y/2)])}function w(j,m){var n=e.vertices[j].position,o=e.vertices[m].position;return v((n.x+o.x)/2,(n.y+o.y)/2,(n.z+o.z)/2)}var e=this,b=new c.Geometry;this.subdivisions=l||0;c.Geometry.call(this);l=(1+Math.sqrt(5))/2;v(-1,l,0);v(1,l,0);v(-1,-l,0);v(1,-l,0);v(0,-1,l);v(0,1,l);v(0,-1,-l);v(0,1,-l);v(l,0,-1);v(l,0,1);v(-l,0,-1);v(-l,0,1);u(0,11,5,b);u(0,5,1,b);u(0,1,7,b);u(0,7,10,b);u(0,10,11,b);u(1,5,9,b);u(5,11,4,b);u(11,10,2,b);u(10,7,6,b);u(7,1,8,b);u(3,9,4,b);u(3,4,2,b);u(3,2,6,b);u(3,6,8,b);u(3,8,9,b);u(4,9,5,b);u(2,4,11,b);u(6,2,10,b);u(8,6,7,b);u(9,8,1,b);for(var a=0;a<this.subdivisions;a++){var l=new c.Geometry,f;for(f in b.faces){var g=w(b.faces[f].a,b.faces[f].b),k=w(b.faces[f].b,b.faces[f].c),h=w(b.faces[f].c,b.faces[f].a);u(b.faces[f].a,g,h,l);u(b.faces[f].b,k,g,l);u(b.faces[f].c,h,k,l);u(g,k,h,l)}b.faces=l.faces;b.faceVertexUvs[0]=l.faceVertexUvs[0]}e.faces=b.faces;e.faceVertexUvs[0]=b.faceVertexUvs[0];this.computeCentroids();this.computeFaceNormals()};c.IcosahedronGeometry.prototype=new c.Geometry;c.IcosahedronGeometry.prototype.constructor=c.IcosahedronGeometry;c.LatheGeometry=function(e,g,f){c.Geometry.call(this);this.steps=g||12;this.angle=f||2*Math.PI;for(var g=this.angle/this.steps,f=[],h=[],s=[],r=[],q=(new c.Matrix4).setRotationZ(g),a=0;a<e.length;a++){this.vertices.push(new c.Vertex(e[a])),f[a]=e[a].clone(),h[a]=this.vertices.length-1}for(var b=0;b<=this.angle+0.001;b+=g){for(a=0;a<f.length;a++){b<this.angle?(f[a]=q.multiplyVector3(f[a].clone()),this.vertices.push(new c.Vertex(f[a])),s[a]=this.vertices.length-1):s=r}b==0&&(r=h);for(a=0;a<h.length-1;a++){this.faces.push(new c.Face4(s[a],s[a+1],h[a+1],h[a])),this.faceVertexUvs[0].push([new c.UV(1-b/this.angle,a/e.length),new c.UV(1-b/this.angle,(a+1)/e.length),new c.UV(1-(b-g)/this.angle,(a+1)/e.length),new c.UV(1-(b-g)/this.angle,a/e.length)])}h=s;s=[]}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};c.LatheGeometry.prototype=new c.Geometry;c.LatheGeometry.prototype.constructor=c.LatheGeometry;c.OctahedronGeometry=function(e,g){function f(k){var j=k.clone().normalize(),j=new c.Vertex(j.clone().multiplyScalar(e));j.index=q.vertices.push(j)-1;j.uv=new c.UV(Math.atan2(k.z,-k.x)/2/Math.PI+0.5,Math.atan2(-k.y,Math.sqrt(k.x*k.x+k.z*k.z))/Math.PI+0.5);return j}function h(l,m,j,k){k<1?(k=new c.Face3(l.index,m.index,j.index,[l.position,m.position,j.position]),k.centroid.addSelf(l.position).addSelf(m.position).addSelf(j.position).divideScalar(3),k.normal=k.centroid.clone().normalize(),q.faces.push(k),k=Math.atan2(k.centroid.z,-k.centroid.x),q.faceVertexUvs[0].push([r(l.uv,l.position,k),r(m.uv,m.position,k),r(j.uv,j.position,k)])):(k-=1,h(l,s(l,m),s(l,j),k),h(s(l,m),m,s(m,j),k),h(s(l,j),s(m,j),j,k),h(s(l,m),s(m,j),s(l,j),k))}function s(l,j){a[l.index]||(a[l.index]=[]);a[j.index]||(a[j.index]=[]);var k=a[l.index][j.index];k===void 0&&(a[l.index][j.index]=a[j.index][l.index]=k=f((new c.Vector3).add(l.position,j.position).divideScalar(2)));return k}function r(k,l,j){j<0&&k.u===1&&(k=new c.UV(k.u-1,k.v));l.x===0&&l.z===0&&(k=new c.UV(j/2/Math.PI+0.5,k.v));return k}c.Geometry.call(this);var g=g||0,q=this;f(new c.Vector3(1,0,0));f(new c.Vector3(-1,0,0));f(new c.Vector3(0,1,0));f(new c.Vector3(0,-1,0));f(new c.Vector3(0,0,1));f(new c.Vector3(0,0,-1));var a=[],b=this.vertices;h(b[0],b[2],b[4],g);h(b[0],b[4],b[3],g);h(b[0],b[3],b[5],g);h(b[0],b[5],b[2],g);h(b[1],b[2],b[5],g);h(b[1],b[5],b[3],g);h(b[1],b[3],b[4],g);h(b[1],b[4],b[2],g);this.boundingSphere={radius:e}};c.OctahedronGeometry.prototype=new c.Geometry;c.OctahedronGeometry.prototype.constructor=c.OctahedronGeometry;c.PlaneGeometry=function(l,v,u,w){c.Geometry.call(this);for(var e=l/2,b=v/2,u=u||1,w=w||1,a=u+1,f=w+1,g=l/u,k=v/w,h=new c.Vector3(0,0,1),l=0;l<f;l++){for(v=0;v<a;v++){this.vertices.push(new c.Vertex(new c.Vector3(v*g-e,-(l*k-b),0)))}}for(l=0;l<w;l++){for(v=0;v<u;v++){e=new c.Face4(v+a*l,v+a*(l+1),v+1+a*(l+1),v+1+a*l),e.normal.copy(h),e.vertexNormals.push(h.clone(),h.clone(),h.clone(),h.clone()),this.faces.push(e),this.faceVertexUvs[0].push([new c.UV(v/u,l/w),new c.UV(v/u,(l+1)/w),new c.UV((v+1)/u,(l+1)/w),new c.UV((v+1)/u,l/w)])}}this.computeCentroids()};c.PlaneGeometry.prototype=new c.Geometry;c.PlaneGeometry.prototype.constructor=c.PlaneGeometry;c.SphereGeometry=function(b,l,f,o,a,t,r){c.Geometry.call(this);var b=b||50,l=Math.max(3,Math.floor(l)||8),f=Math.max(2,Math.floor(f)||6),o=o!=void 0?o:0,a=a!=void 0?a:Math.PI*2,t=t!=void 0?t:0,r=r!=void 0?r:Math.PI,g,n,K=[],p=[];for(n=0;n<=f;n++){var m=[],q=[];for(g=0;g<=l;g++){var L=g/l,e=n/f;this.vertices.push(new c.Vertex(new c.Vector3(-b*Math.cos(o+L*a)*Math.sin(t+e*r),b*Math.cos(t+e*r),b*Math.sin(o+L*a)*Math.sin(t+e*r))));m.push(this.vertices.length-1);q.push(new c.UV(L,e))}K.push(m);p.push(q)}for(n=0;n<f;n++){for(g=0;g<l;g++){var o=K[n][g+1],a=K[n][g],t=K[n+1][g],r=K[n+1][g+1],m=this.vertices[o].position.clone().normalize(),q=this.vertices[a].position.clone().normalize(),L=this.vertices[t].position.clone().normalize(),e=this.vertices[r].position.clone().normalize(),h=p[n][g+1].clone(),w=p[n][g].clone(),k=p[n+1][g].clone(),M=p[n+1][g+1].clone();Math.abs(this.vertices[o].position.y)==b?(this.faces.push(new c.Face3(o,t,r,[m,L,e])),this.faceVertexUvs[0].push([h,k,M])):Math.abs(this.vertices[t].position.y)==b?(this.faces.push(new c.Face3(o,a,t,[m,q,L])),this.faceVertexUvs[0].push([h,w,k])):(this.faces.push(new c.Face4(o,a,t,r,[m,q,L,e])),this.faceVertexUvs[0].push([h,w,k,M]))}}this.computeCentroids();this.computeFaceNormals();this.boundingSphere={radius:b}};c.SphereGeometry.prototype=new c.Geometry;c.SphereGeometry.prototype.constructor=c.SphereGeometry;c.TextGeometry=function(a,g){var b=(new c.TextPath(a,g)).toShapes();g.amount=g.height!==void 0?g.height:50;if(g.bevelThickness===void 0){g.bevelThickness=10}if(g.bevelSize===void 0){g.bevelSize=8}if(g.bevelEnabled===void 0){g.bevelEnabled=!1}if(g.bend){var h=b[b.length-1].getBoundingBox().maxX;g.bendPath=new c.QuadraticBezierCurve(new c.Vector2(0,0),new c.Vector2(h/2,120),new c.Vector2(h,0))}c.ExtrudeGeometry.call(this,b,g)};c.TextGeometry.prototype=new c.ExtrudeGeometry;c.TextGeometry.prototype.constructor=c.TextGeometry;c.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(b){var a=b.familyName.toLowerCase();this.faces[a]=this.faces[a]||{};this.faces[a][b.cssFontWeight]=this.faces[a][b.cssFontWeight]||{};this.faces[a][b.cssFontWeight][b.cssFontStyle]=b;return this.faces[a][b.cssFontWeight][b.cssFontStyle]=b},drawText:function(a){for(var g=this.getFace(),e=this.size/g.resolution,b=0,p=String(a).split(""),h=p.length,f=[],a=0;a<h;a++){var o=new c.Path,o=this.extractGlyphPoints(p[a],g,e,b,o);b+=o.offset;f.push(o.path)}return{paths:f,offset:b/2}},extractGlyphPoints:function(a,f,b,k,t){var p=[],m,w,e,n,g,N,l,q,r,M,o,u=f.glyphs[a]||f.glyphs["?"];if(u){if(u.o){f=u._cachedOutline||(u._cachedOutline=u.o.split(" "));n=f.length;for(a=0;a<n;){switch(e=f[a++],e){case"m":e=f[a++]*b+k;g=f[a++]*b;p.push(new c.Vector2(e,g));t.moveTo(e,g);break;case"l":e=f[a++]*b+k;g=f[a++]*b;p.push(new c.Vector2(e,g));t.lineTo(e,g);break;case"q":e=f[a++]*b+k;g=f[a++]*b;q=f[a++]*b+k;r=f[a++]*b;t.quadraticCurveTo(q,r,e,g);if(m=p[p.length-1]){N=m.x;l=m.y;m=1;for(w=this.divisions;m<=w;m++){var O=m/w,h=c.Shape.Utils.b2(O,N,q,e),O=c.Shape.Utils.b2(O,l,r,g);p.push(new c.Vector2(h,O))}}break;case"b":if(e=f[a++]*b+k,g=f[a++]*b,q=f[a++]*b+k,r=f[a++]*-b,M=f[a++]*b+k,o=f[a++]*-b,t.bezierCurveTo(e,g,q,r,M,o),m=p[p.length-1]){N=m.x;l=m.y;m=1;for(w=this.divisions;m<=w;m++){O=m/w,h=c.Shape.Utils.b3(O,N,q,M,e),O=c.Shape.Utils.b3(O,l,r,o,g),p.push(new c.Vector2(h,O))}}}}}return{offset:u.ha*b,points:p,path:t}}}};(function(b){var a=function(e){for(var f=e.length,n=0,m=f-1,g=0;g<f;m=g++){n+=e[m].x*e[g].y-e[g].x*e[m].y}return n*0.5};b.Triangulate=function(p,s){var E=p.length;if(E<3){return null}var x=[],v=[],G=[],H,K,I;if(a(p)>0){for(K=0;K<E;K++){v[K]=K}}else{for(K=0;K<E;K++){v[K]=E-1-K}}var e=2*E;for(K=E-1;E>2;){if(e--<=0){console.log("Warning, unable to triangulate polygon!");if(s){return G}return x}H=K;E<=H&&(H=0);K=H+1;E<=K&&(K=0);I=K+1;E<=I&&(I=0);var k;p:{k=p;var M=H,o=K,U=I,m=E,t=v,aa=void 0,A=void 0,l=void 0,q=void 0,h=void 0,ad=void 0,ae=void 0,F=void 0,J=void 0,A=k[t[M]].x,l=k[t[M]].y,q=k[t[o]].x,h=k[t[o]].y,ad=k[t[U]].x,ae=k[t[U]].y;if(1e-10>(q-A)*(ae-l)-(h-l)*(ad-A)){k=!1}else{for(aa=0;aa<m;aa++){if(!(aa==M||aa==o||aa==U)){var F=k[t[aa]].x,J=k[t[aa]].y,r=void 0,n=void 0,ab=void 0,g=void 0,O=void 0,P=void 0,R=void 0,f=void 0,y=void 0,w=void 0,B=void 0,u=void 0,r=ab=O=void 0,r=ad-q,n=ae-h,ab=A-ad,g=l-ae,O=q-A,P=h-l,R=F-A,f=J-l,y=F-q,w=J-h,B=F-ad,u=J-ae,r=r*w-n*y,O=O*f-P*R,ab=ab*u-g*B;if(r>=0&&ab>=0&&O>=0){k=!1;break p}}}k=!0}}if(k){x.push([p[v[H]],p[v[K]],p[v[I]]]);G.push([v[H],v[K],v[I]]);H=K;for(I=K+1;I<E;H++,I++){v[H]=v[I]}E--;e=2*E}}if(s){return G}return x};b.Triangulate.area=a;return b})(c.FontUtils);d._typeface_js={faces:c.FontUtils.faces,loadFace:c.FontUtils.loadFace};c.TorusGeometry=function(e,g,f,h,s){c.Geometry.call(this);this.radius=e||100;this.tube=g||40;this.segmentsR=f||8;this.segmentsT=h||6;this.arc=s||Math.PI*2;s=new c.Vector3;e=[];g=[];for(f=0;f<=this.segmentsR;f++){for(h=0;h<=this.segmentsT;h++){var r=h/this.segmentsT*this.arc,q=f/this.segmentsR*Math.PI*2;s.x=this.radius*Math.cos(r);s.y=this.radius*Math.sin(r);var a=new c.Vector3;a.x=(this.radius+this.tube*Math.cos(q))*Math.cos(r);a.y=(this.radius+this.tube*Math.cos(q))*Math.sin(r);a.z=this.tube*Math.sin(q);this.vertices.push(new c.Vertex(a));e.push(new c.UV(h/this.segmentsT,1-f/this.segmentsR));g.push(a.clone().subSelf(s).normalize())}}for(f=1;f<=this.segmentsR;f++){for(h=1;h<=this.segmentsT;h++){var s=(this.segmentsT+1)*f+h-1,r=(this.segmentsT+1)*(f-1)+h-1,q=(this.segmentsT+1)*(f-1)+h,a=(this.segmentsT+1)*f+h,b=new c.Face4(s,r,q,a,[g[s],g[r],g[q],g[a]]);b.normal.addSelf(g[s]);b.normal.addSelf(g[r]);b.normal.addSelf(g[q]);b.normal.addSelf(g[a]);b.normal.normalize();this.faces.push(b);this.faceVertexUvs[0].push([e[s].clone(),e[r].clone(),e[q].clone(),e[a].clone()])}}this.computeCentroids()};c.TorusGeometry.prototype=new c.Geometry;c.TorusGeometry.prototype.constructor=c.TorusGeometry;c.TorusKnotGeometry=function(l,v,u,w,e,b,a){function f(n,o,q,p,j,m){o=q/p*n;q=Math.cos(o);return new c.Vector3(j*(2+q)*0.5*Math.cos(n),j*(2+q)*Math.sin(n)*0.5,m*j*Math.sin(o)*0.5)}c.Geometry.call(this);this.radius=l||200;this.tube=v||40;this.segmentsR=u||64;this.segmentsT=w||8;this.p=e||2;this.q=b||3;this.heightScale=a||1;this.grid=Array(this.segmentsR);u=new c.Vector3;w=new c.Vector3;b=new c.Vector3;for(l=0;l<this.segmentsR;++l){this.grid[l]=Array(this.segmentsT);for(v=0;v<this.segmentsT;++v){var g=l/this.segmentsR*2*this.p*Math.PI,a=v/this.segmentsT*2*Math.PI,e=f(g,a,this.q,this.p,this.radius,this.heightScale),g=f(g+0.01,a,this.q,this.p,this.radius,this.heightScale);u.x=g.x-e.x;u.y=g.y-e.y;u.z=g.z-e.z;w.x=g.x+e.x;w.y=g.y+e.y;w.z=g.z+e.z;b.cross(u,w);w.cross(b,u);b.normalize();w.normalize();g=-this.tube*Math.cos(a);a=this.tube*Math.sin(a);e.x+=g*w.x+a*b.x;e.y+=g*w.y+a*b.y;e.z+=g*w.z+a*b.z;this.grid[l][v]=this.vertices.push(new c.Vertex(new c.Vector3(e.x,e.y,e.z)))-1}}for(l=0;l<this.segmentsR;++l){for(v=0;v<this.segmentsT;++v){var w=(l+1)%this.segmentsR,b=(v+1)%this.segmentsT,e=this.grid[l][v],u=this.grid[w][v],w=this.grid[w][b],b=this.grid[l][b],a=new c.UV(l/this.segmentsR,v/this.segmentsT),g=new c.UV((l+1)/this.segmentsR,v/this.segmentsT),k=new c.UV((l+1)/this.segmentsR,(v+1)/this.segmentsT),h=new c.UV(l/this.segmentsR,(v+1)/this.segmentsT);this.faces.push(new c.Face4(e,u,w,b));this.faceVertexUvs[0].push([a,g,k,h])}}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};c.TorusKnotGeometry.prototype=new c.Geometry;c.TorusKnotGeometry.prototype.constructor=c.TorusKnotGeometry;c.SubdivisionModifier=function(a){this.subdivisions=a===void 0?1:a;this.useOldVertexColors=!1;this.supportUVs=!0};c.SubdivisionModifier.prototype.constructor=c.SubdivisionModifier;c.SubdivisionModifier.prototype.modify=function(b){for(var a=this.subdivisions;a-->0;){this.smooth(b)}};c.SubdivisionModifier.prototype.smooth=function(u){function g(C,D,H,I,L,M){var G=new c.Face4(C,D,H,I,null,L.color,L.material);if(o.useOldVertexColors){G.vertexColors=[];for(var O,P,j,N=0;N<4;N++){j=M[N];O=new c.Color;O.setRGB(0,0,0);for(var z=0;z<j.length;z++){P=L.vertexColors[j[z]-1],O.r+=P.r,O.g+=P.g,O.b+=P.b}O.r/=j.length;O.g/=j.length;O.b/=j.length;G.vertexColors[N]=O}}r.push(G);(!o.supportUVs||F.length!=0)&&q.push([F[C],F[D],F[H],F[I]])}function w(z,j){return Math.min(z,j)+"_"+Math.max(z,j)}var k=[],r=[],q=[],o=this,A=u.vertices,k=u.faces,U=A.concat(),B=[],ac={},y={},F=[],E,ad,x,K,a,m=u.faceVertexUvs[0];E=0;for(ad=m.length;E<ad;E++){x=0;for(K=m[E].length;x<K;x++){a=k[E]["abcd".charAt(x)],F[a]||(F[a]=m[E][x])}}var e;E=0;for(ad=k.length;E<ad;E++){if(a=k[E],B.push(a.centroid),U.push(new c.Vertex(a.centroid)),o.supportUVs&&F.length!=0){e=new c.UV;if(a instanceof c.Face3){e.u=F[a.a].u+F[a.b].u+F[a.c].u,e.v=F[a.a].v+F[a.b].v+F[a.c].v,e.u/=3,e.v/=3}else{if(a instanceof c.Face4){e.u=F[a.a].u+F[a.b].u+F[a.c].u+F[a.d].u,e.v=F[a.a].v+F[a.b].v+F[a.c].v+F[a.d].v,e.u/=4,e.v/=4}}F.push(e)}}ad=function(C){function D(M,N,L){M[N]===void 0&&(M[N]=[]);M[N].push(L)}var G,H,I,j,z={};G=0;for(H=C.faces.length;G<H;G++){I=C.faces[G],I instanceof c.Face3?(j=w(I.a,I.b),D(z,j,G),j=w(I.b,I.c),D(z,j,G),j=w(I.c,I.a),D(z,j,G)):I instanceof c.Face4&&(j=w(I.a,I.b),D(z,j,G),j=w(I.b,I.c),D(z,j,G),j=w(I.c,I.d),D(z,j,G),j=w(I.d,I.a),D(z,j,G))}return z}(u);var R=0,m=A.length,f,J,n={},p={},h=function(z,j){n[z]===void 0&&(n[z]=[]);n[z].push(j)},s=function(z,j){p[z]===void 0&&(p[z]={});p[z][j]=null};for(E in ad){e=ad[E];f=E.split("_");J=f[0];f=f[1];h(J,[J,f]);h(f,[J,f]);x=0;for(K=e.length;x<K;x++){a=e[x],s(J,a,E),s(f,a,E)}e.length<2&&(y[E]=!0)}for(E in ad){if(e=ad[E],a=e[0],e=e[1],f=E.split("_"),J=f[0],f=f[1],K=new c.Vector3,y[E]?(K.addSelf(A[J].position),K.addSelf(A[f].position),K.multiplyScalar(0.5)):(K.addSelf(B[a]),K.addSelf(B[e]),K.addSelf(A[J].position),K.addSelf(A[f].position),K.multiplyScalar(0.25)),ac[E]=m+k.length+R,U.push(new c.Vertex(K)),R++,o.supportUVs&&F.length!=0){e=new c.UV,e.u=F[J].u+F[f].u,e.v=F[J].v+F[f].v,e.u/=2,e.v/=2,F.push(e)}}var ae,b;f=["123","12","2","23"];K=["123","23","3","31"];var h=["123","31","1","12"],s=["1234","12","2","23"],l=["1234","23","3","34"],v=["1234","34","4","41"],t=["1234","41","1","12"];E=0;for(ad=B.length;E<ad;E++){a=k[E],e=m+E,a instanceof c.Face3?(R=w(a.a,a.b),J=w(a.b,a.c),ae=w(a.c,a.a),g(e,ac[R],a.b,ac[J],a,f),g(e,ac[J],a.c,ac[ae],a,K),g(e,ac[ae],a.a,ac[R],a,h)):a instanceof c.Face4?(R=w(a.a,a.b),J=w(a.b,a.c),ae=w(a.c,a.d),b=w(a.d,a.a),g(e,ac[R],a.b,ac[J],a,s),g(e,ac[J],a.c,ac[ae],a,l),g(e,ac[ae],a.d,ac[b],a,v),g(e,ac[b],a.a,ac[R],a,t)):console.log("face should be a face!",a)}k=U;U=new c.Vector3;ac=new c.Vector3;E=0;for(ad=A.length;E<ad;E++){if(n[E]!==void 0){U.set(0,0,0);ac.set(0,0,0);a=new c.Vector3(0,0,0);e=0;for(x in p[E]){U.addSelf(B[x]),e++}R=0;m=n[E].length;for(x=0;x<m;x++){y[w(n[E][x][0],n[E][x][1])]&&R++}if(R!=2){U.divideScalar(e);for(x=0;x<m;x++){e=n[E][x],e=A[e[0]].position.clone().addSelf(A[e[1]].position).divideScalar(2),ac.addSelf(e)}ac.divideScalar(m);a.addSelf(A[E].position);a.multiplyScalar(m-3);a.addSelf(U);a.addSelf(ac.multiplyScalar(2));a.divideScalar(m);k[E].position=a}}}u.vertices=k;u.faces=r;u.faceVertexUvs[0]=q;delete u.__tmpVertices;u.computeCentroids();u.computeFaceNormals();u.computeVertexNormals()};c.Loader=function(a){this.statusDomElement=(this.showStatus=a)?c.Loader.prototype.addStatusElement():null;this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}};c.Loader.prototype={constructor:c.Loader,addStatusElement:function(){var a=document.createElement("div");a.style.position="absolute";a.style.right="0px";a.style.top="0px";a.style.fontSize="0.8em";a.style.textAlign="left";a.style.background="rgba(0,0,0,0.25)";a.style.color="#fff";a.style.width="120px";a.style.padding="0.5em 0.5em 0.5em 0.5em";a.style.zIndex=1000;a.innerHTML="Loading ...";return a},updateProgress:function(b){var a="Loaded ";a+=b.total?(100*b.loaded/b.total).toFixed(0)+"%":(b.loaded/1000).toFixed(2)+" KB";this.statusDomElement.innerHTML=a},extractUrlbase:function(a){a=a.split("/");a.pop();return a.length<1?"":a.join("/")+"/"},initMaterials:function(a,g,b){a.materials=[];for(var h=0;h<g.length;++h){a.materials[h]=c.Loader.prototype.createMaterial(g[h],b)}},hasNormals:function(a){var g,b,h=a.materials.length;for(b=0;b<h;b++){if(g=a.materials[b],g instanceof c.ShaderMaterial){return !0}}return !1},createMaterial:function(A,b){function a(j){j=Math.log(j)/Math.LN2;return Math.floor(j)==j}function e(j,m){var n=new Image;n.onload=function(){if(!a(this.width)||!a(this.height)){var q=Math.pow(2,Math.round(Math.log(this.width)/Math.LN2)),r=Math.pow(2,Math.round(Math.log(this.height)/Math.LN2));j.image.width=q;j.image.height=r;j.image.getContext("2d").drawImage(this,0,0,q,r)}else{j.image=this}j.needsUpdate=!0};n.src=m}function f(q,r,s,m,n,t){var j=document.createElement("canvas");q[r]=new c.Texture(j);q[r].sourceFile=s;if(m){q[r].repeat.set(m[0],m[1]);if(m[0]!=1){q[r].wrapS=c.RepeatWrapping}if(m[1]!=1){q[r].wrapT=c.RepeatWrapping}}n&&q[r].offset.set(n[0],n[1]);if(t){m={repeat:c.RepeatWrapping,mirror:c.MirroredRepeatWrapping};if(m[t[0]]!==void 0){q[r].wrapS=m[t[0]]}if(m[t[1]]!==void 0){q[r].wrapT=m[t[1]]}}e(q[r],b+"/"+s)}function h(j){return(j[0]*255<<16)+(j[1]*255<<8)+j[2]*255}var g,k,l;k="MeshLambertMaterial";g={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,wireframe:A.wireframe};A.shading&&(A.shading=="Phong"?k="MeshPhongMaterial":A.shading=="Basic"&&(k="MeshBasicMaterial"));if(A.blending){if(A.blending=="Additive"){g.blending=c.AdditiveBlending}else{if(A.blending=="Subtractive"){g.blending=c.SubtractiveBlending}else{if(A.blending=="Multiply"){g.blending=c.MultiplyBlending}}}}if(A.transparent!==void 0||A.opacity<1){g.transparent=A.transparent}if(A.depthTest!==void 0){g.depthTest=A.depthTest}if(A.vertexColors!==void 0){if(A.vertexColors=="face"){g.vertexColors=c.FaceColors}else{if(A.vertexColors){g.vertexColors=c.VertexColors}}}if(A.colorDiffuse){g.color=h(A.colorDiffuse)}else{if(A.DbgColor){g.color=A.DbgColor}}if(A.colorSpecular){g.specular=h(A.colorSpecular)}if(A.colorAmbient){g.ambient=h(A.colorAmbient)}if(A.transparency){g.opacity=A.transparency}if(A.specularCoef){g.shininess=A.specularCoef}A.mapDiffuse&&b&&f(g,"map",A.mapDiffuse,A.mapDiffuseRepeat,A.mapDiffuseOffset,A.mapDiffuseWrap);A.mapLight&&b&&f(g,"lightMap",A.mapLight,A.mapLightRepeat,A.mapLightOffset,A.mapLightWrap);A.mapNormal&&b&&f(g,"normalMap",A.mapNormal,A.mapNormalRepeat,A.mapNormalOffset,A.mapNormalWrap);A.mapSpecular&&b&&f(g,"specularMap",A.mapSpecular,A.mapSpecularRepeat,A.mapSpecularOffset,A.mapSpecularWrap);if(A.mapNormal){var p=c.ShaderUtils.lib.normal,o=c.UniformsUtils.clone(p.uniforms),y=g.color;k=g.specular;l=g.ambient;var z=g.shininess;o.tNormal.texture=g.normalMap;if(A.mapNormalFactor){o.uNormalScale.value=A.mapNormalFactor}if(g.map){o.tDiffuse.texture=g.map,o.enableDiffuse.value=!0}if(g.specularMap){o.tSpecular.texture=g.specularMap,o.enableSpecular.value=!0}if(g.lightMap){o.tAO.texture=g.lightMap,o.enableAO.value=!0}o.uDiffuseColor.value.setHex(y);o.uSpecularColor.value.setHex(k);o.uAmbientColor.value.setHex(l);o.uShininess.value=z;if(g.opacity){o.uOpacity.value=g.opacity}g=new c.ShaderMaterial({fragmentShader:p.fragmentShader,vertexShader:p.vertexShader,uniforms:o,lights:!0,fog:!0})}else{g=new c[k](g)}return g}};c.BinaryLoader=function(a){c.Loader.call(this,a)};c.BinaryLoader.prototype=new c.Loader;c.BinaryLoader.prototype.constructor=c.BinaryLoader;c.BinaryLoader.prototype.supr=c.Loader.prototype;c.BinaryLoader.prototype.load=function(b,g,j,k){if(b instanceof Object){console.warn("DEPRECATED: BinaryLoader( parameters ) is now BinaryLoader( url, callback, texturePath, binaryPath )."),k=b,b=k.model,g=k.callback,j=k.texture_path,k=k.bin_path}var j=j?j:this.extractUrlbase(b),k=k?k:this.extractUrlbase(b),a=this.showProgress?c.Loader.prototype.updateProgress:null;this.onLoadStart();this.loadAjaxJSON(this,b,g,j,k,a)};c.BinaryLoader.prototype.loadAjaxJSON=function(g,b,a,m,f,e){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(n.readyState==4){if(n.status==200||n.status==0){try{var h=JSON.parse(n.responseText);h.metadata===void 0||h.metadata.formatVersion===void 0||h.metadata.formatVersion!==3?console.error("Deprecated file format."):g.loadAjaxBuffers(h,a,f,m,e)}catch(j){console.error(j),console.warn("DEPRECATED: ["+b+"] seems to be using old model format")}}else{console.error("Couldn't load ["+b+"] ["+n.status+"]")}}};n.open("GET",b,!0);n.overrideMimeType("text/plain; charset=x-user-defined");n.setRequestHeader("Content-Type","text/plain");n.send(null)};c.BinaryLoader.prototype.loadAjaxBuffers=function(a,g,e,b,p){var h=new XMLHttpRequest,f=e+"/"+a.buffers,o=0;h.onreadystatechange=function(){h.readyState==4?h.status==200||h.status==0?c.BinaryLoader.prototype.createBinModel(h.response,g,b,a.materials):console.error("Couldn't load ["+f+"] ["+h.status+"]"):h.readyState==3?p&&(o==0&&(o=h.getResponseHeader("Content-Length")),p({total:o,loaded:h.responseText.length})):h.readyState==2&&(o=h.getResponseHeader("Content-Length"))};h.open("GET",f,!0);h.responseType="arraybuffer";h.send(null)};c.BinaryLoader.prototype.createBinModel=function(b,g,j,k){var a=function(e){function f(l){return l%4?4-l%4:0}function h(s,l){return(new Uint8Array(s,l,1))[0]}function m(s,l){return(new Uint32Array(s,l,1))[0]}function o(H,I){var L,l,s,z,C,E,J,D,G=new Uint32Array(b,I,3*H);for(L=0;L<H;L++){l=G[L*3];s=G[L*3+1];z=G[L*3+2];C=U[l*2];l=U[l*2+1];E=U[s*2];J=U[s*2+1];s=U[z*2];D=U[z*2+1];z=q.faceVertexUvs[0];var K=[];K.push(new c.UV(C,l));K.push(new c.UV(E,J));K.push(new c.UV(s,D));z.push(K)}}function n(G,K){var L,E,s,H,M,N,l,z,C,D,I=new Uint32Array(b,K,4*G);for(L=0;L<G;L++){E=I[L*4];s=I[L*4+1];H=I[L*4+2];M=I[L*4+3];N=U[E*2];E=U[E*2+1];l=U[s*2];C=U[s*2+1];z=U[H*2];D=U[H*2+1];H=U[M*2];s=U[M*2+1];M=q.faceVertexUvs[0];var J=[];J.push(new c.UV(N,E));J.push(new c.UV(l,C));J.push(new c.UV(z,D));J.push(new c.UV(H,s));M.push(J)}}function r(C,E,G){for(var H,s,z,l,E=new Uint32Array(b,E,3*C),D=new Uint16Array(b,G,C),G=0;G<C;G++){H=E[G*3],s=E[G*3+1],z=E[G*3+2],l=D[G],q.faces.push(new c.Face3(H,s,z,null,null,l))}}function v(C,D,I){for(var E,G,H,l,s,D=new Uint32Array(b,D,4*C),z=new Uint16Array(b,I,C),I=0;I<C;I++){E=D[I*4],G=D[I*4+1],H=D[I*4+2],l=D[I*4+3],s=z[I],q.faces.push(new c.Face4(E,G,H,l,null,null,s))}}function p(C,P,J,K){for(var M,N,G,I,E,O,l,P=new Uint32Array(b,P,3*C),J=new Uint32Array(b,J,3*C),s=new Uint16Array(b,K,C),K=0;K<C;K++){M=P[K*3];N=P[K*3+1];G=P[K*3+2];E=J[K*3];O=J[K*3+1];l=J[K*3+2];I=s[K];var z=y[O*3],D=y[O*3+1];O=y[O*3+2];var L=y[l*3],H=y[l*3+1];l=y[l*3+2];q.faces.push(new c.Face3(M,N,G,[new c.Vector3(y[E*3],y[E*3+1],y[E*3+2]),new c.Vector3(z,D,O),new c.Vector3(L,H,l)],null,I))}}function A(J,K,M,O){for(var P,Q,R,S,z,E,l,s,I,K=new Uint32Array(b,K,4*J),M=new Uint32Array(b,M,4*J),C=new Uint16Array(b,O,J),O=0;O<J;O++){P=K[O*4];Q=K[O*4+1];R=K[O*4+2];S=K[O*4+3];E=M[O*4];l=M[O*4+1];s=M[O*4+2];I=M[O*4+3];z=C[O];var D=y[l*3],G=y[l*3+1];l=y[l*3+2];var Y=y[s*3],L=y[s*3+1];s=y[s*3+2];var N=y[I*3],H=y[I*3+1];I=y[I*3+2];q.faces.push(new c.Face4(P,Q,R,S,[new c.Vector3(y[E*3],y[E*3+1],y[E*3+2]),new c.Vector3(D,G,l),new c.Vector3(Y,L,s),new c.Vector3(N,H,I)],null,z))}}var q=this,B=0,T,y=[],U=[],t,w,x,u,V,F;c.Geometry.call(this);c.Loader.prototype.initMaterials(q,k,e);T={signature:function(C,l,s){for(var C=new Uint8Array(C,l,s),z="",D=0;D<s;D++){z+=String.fromCharCode(C[l+D])}return z}(b,B,12),header_bytes:h(b,B+12),vertex_coordinate_bytes:h(b,B+13),normal_coordinate_bytes:h(b,B+14),uv_coordinate_bytes:h(b,B+15),vertex_index_bytes:h(b,B+16),normal_index_bytes:h(b,B+17),uv_index_bytes:h(b,B+18),material_index_bytes:h(b,B+19),nvertices:m(b,B+20),nnormals:m(b,B+20+4),nuvs:m(b,B+20+8),ntri_flat:m(b,B+20+12),ntri_smooth:m(b,B+20+16),ntri_flat_uv:m(b,B+20+20),ntri_smooth_uv:m(b,B+20+24),nquad_flat:m(b,B+20+28),nquad_smooth:m(b,B+20+32),nquad_flat_uv:m(b,B+20+36),nquad_smooth_uv:m(b,B+20+40)};T.signature!=="Three.js 003"&&console.warn("DEPRECATED: binary model seems to be using old format");B+=T.header_bytes;e=T.vertex_index_bytes*3+T.material_index_bytes;F=T.vertex_index_bytes*4+T.material_index_bytes;t=T.ntri_flat*e;w=T.ntri_smooth*(e+T.normal_index_bytes*3);x=T.ntri_flat_uv*(e+T.uv_index_bytes*3);u=T.ntri_smooth_uv*(e+T.normal_index_bytes*3+T.uv_index_bytes*3);V=T.nquad_flat*F;e=T.nquad_smooth*(F+T.normal_index_bytes*4);F=T.nquad_flat_uv*(F+T.uv_index_bytes*4);B+=function(C){var E=T.nvertices,C=new Float32Array(b,C,E*3),l,s,z,D;for(l=0;l<E;l++){s=C[l*3],z=C[l*3+1],D=C[l*3+2],q.vertices.push(new c.Vertex(new c.Vector3(s,z,D)))}return E*3*Float32Array.BYTES_PER_ELEMENT}(B);B+=function(C){var E=T.nnormals;if(E){var C=new Int8Array(b,C,E*3),l,s,z,D;for(l=0;l<E;l++){s=C[l*3],z=C[l*3+1],D=C[l*3+2],y.push(s/127,z/127,D/127)}}return E*3*Int8Array.BYTES_PER_ELEMENT}(B);B+=f(T.nnormals*3);B+=function(l){var s=T.nuvs;if(s){var l=new Float32Array(b,l,s*2),z,C,D;for(z=0;z<s;z++){C=l[z*2],D=l[z*2+1],U.push(C,D)}}return s*2*Float32Array.BYTES_PER_ELEMENT}(B);t=B+t+f(T.ntri_flat*2);w=t+w+f(T.ntri_smooth*2);x=w+x+f(T.ntri_flat_uv*2);u=x+u+f(T.ntri_smooth_uv*2);V=u+V+f(T.nquad_flat*2);e=V+e+f(T.nquad_smooth*2);F=e+F+f(T.nquad_flat_uv*2);(function(l){var s=T.ntri_flat_uv;if(s){var z=l+s*Uint32Array.BYTES_PER_ELEMENT*3;r(s,l,z+s*Uint32Array.BYTES_PER_ELEMENT*3);o(s,z)}})(w);(function(C){var s=T.ntri_smooth_uv;if(s){var z=C+s*Uint32Array.BYTES_PER_ELEMENT*3,l=z+s*Uint32Array.BYTES_PER_ELEMENT*3;p(s,C,z,l+s*Uint32Array.BYTES_PER_ELEMENT*3);o(s,l)}})(x);(function(l){var s=T.nquad_flat_uv;if(s){var z=l+s*Uint32Array.BYTES_PER_ELEMENT*4;v(s,l,z+s*Uint32Array.BYTES_PER_ELEMENT*4);n(s,z)}})(e);(function(C){var s=T.nquad_smooth_uv;if(s){var z=C+s*Uint32Array.BYTES_PER_ELEMENT*4,l=z+s*Uint32Array.BYTES_PER_ELEMENT*4;A(s,C,z,l+s*Uint32Array.BYTES_PER_ELEMENT*4);n(s,l)}})(F);(function(s){var l=T.ntri_flat;l&&r(l,s,s+l*Uint32Array.BYTES_PER_ELEMENT*3)})(B);(function(l){var s=T.ntri_smooth;if(s){var z=l+s*Uint32Array.BYTES_PER_ELEMENT*3;p(s,l,z,z+s*Uint32Array.BYTES_PER_ELEMENT*3)}})(t);(function(s){var l=T.nquad_flat;l&&v(l,s,s+l*Uint32Array.BYTES_PER_ELEMENT*4)})(u);(function(l){var s=T.nquad_smooth;if(s){var z=l+s*Uint32Array.BYTES_PER_ELEMENT*4;A(s,l,z,z+s*Uint32Array.BYTES_PER_ELEMENT*4)}})(V);this.computeCentroids();this.computeFaceNormals();c.Loader.prototype.hasNormals(this)&&this.computeTangents()};a.prototype=new c.Geometry;a.prototype.constructor=a;g(new a(j))};c.ColladaLoader=function(){function e(L,z,C){R=L;z=z||E;C!==void 0&&(L=C.split("/"),L.pop(),p=L.length<1?"":L.join("/")+"/");ap=t("//dae:library_images/dae:image",v,"image");f=t("//dae:library_materials/dae:material",ao,"material");ak=t("//dae:library_effects/dae:effect",ai,"effect");B=t("//dae:library_geometries/dae:geometry",b,"geometry");a=t("//dae:library_controllers/dae:controller",ar,"controller");k=t("//dae:library_animations/dae:animation",ad,"animation");y=t(".//dae:library_visual_scenes/dae:visual_scene",S,"visual_scene");n=[];ah=[];(L=R.evaluate(".//dae:scene/dae:instance_visual_scene",R,P,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null).iterateNext())?(L=L.getAttribute("url").replace(/^#/,""),G=y[L]):G=null;r=new c.Object3D;for(L=0;L<G.nodes.length;L++){r.add(af(G.nodes[L]))}o();for(var D in k){}D={scene:r,morphs:n,skins:ah,dae:{images:ap,materials:f,effects:ak,geometries:B,controllers:a,animations:k,visualScenes:y,scene:G}};z&&z(D);return D}function t(z,N,C){for(var z=R.evaluate(z,R,P,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null),D={},L=z.iterateNext(),Q=0;L;){L=(new N).parse(L);if(L.id.length==0){L.id=C+Q++}D[L.id]=L;L=z.iterateNext()}return D}function o(){var z=1000000,N=-z,Q=0,C;for(C in k){for(var D=k[C],L=0;L<D.sampler.length;L++){var T=D.sampler[L];T.create();z=Math.min(z,T.startTime);N=Math.max(N,T.endTime);Q=Math.max(Q,T.input.length)}}return{start:z,end:N,frames:Q}}function u(N,z,C,D){N.world=N.world||new c.Matrix4;N.world.copy(N.matrix);if(N.channels&&N.channels.length){var L=N.channels[0].sampler.output[C];L instanceof c.Matrix4&&N.world.copy(L)}D&&N.world.multiply(D,N.world);z.push(N);for(D=0;D<N.nodes.length;D++){u(N.nodes[D],z,C,N.world)}}function aq(D,Y,N){var T=a[Y.url];if(!T||!T.skin){console.log("ColladaLoader: Could not find skin controller.")}else{if(!Y.skeleton||!Y.skeleton.length){console.log("ColladaLoader: Could not find the skeleton for the skin. ")}else{var at=o(),Y=G.getChildById(Y.skeleton[0],!0)||G.getChildBySid(Y.skeleton[0],!0),ay,az,au,z,C=new c.Vector3,L;for(ay=0;ay<D.vertices.length;ay++){T.skin.bindShapeMatrix.multiplyVector3(D.vertices[ay].position)}for(N=0;N<at.frames;N++){var av=[],Q=[];for(ay=0;ay<D.vertices.length;ay++){Q.push(new c.Vertex(new c.Vector3))}u(Y,av,N);ay=av;az=T.skin;for(z=0;z<ay.length;z++){if(au=ay[z],L=-1,au.type=="JOINT"){for(var Z=0;Z<az.joints.length;Z++){if(au.sid==az.joints[Z]){L=Z;break}}if(L>=0){Z=az.invBindMatrices[L];au.invBindMatrix=Z;au.skinningMatrix=new c.Matrix4;au.skinningMatrix.multiply(au.world,Z);au.weights=[];for(Z=0;Z<az.weights.length;Z++){for(var aw=0;aw<az.weights[Z].length;aw++){var ax=az.weights[Z][aw];ax.joint==L&&au.weights.push(ax)}}}else{throw"ColladaLoader: Could not find joint '"+au.sid+"'."}}}for(ay=0;ay<av.length;ay++){if(av[ay].type=="JOINT"){for(az=0;az<av[ay].weights.length;az++){au=av[ay].weights[az],z=au.index,au=au.weight,L=D.vertices[z],z=Q[z],C.x=L.position.x,C.y=L.position.y,C.z=L.position.z,av[ay].skinningMatrix.multiplyVector3(C),z.position.x+=C.x*au,z.position.y+=C.y*au,z.position.z+=C.z*au}}}D.morphTargets.push({name:"target_"+N,vertices:Q})}}}}function af(N){var Z=new c.Object3D,at,Q,T,Y;for(T=0;T<N.controllers.length;T++){var z=a[N.controllers[T].url];switch(z.type){case"skin":if(B[z.skin.source]){var au=new aa;au.url=z.skin.source;au.instance_material=N.controllers[T].instance_material;N.geometries.push(au);at=N.controllers[T]}else{if(a[z.skin.source]&&(Q=z=a[z.skin.source],z.morph&&B[z.morph.source])){au=new aa,au.url=z.morph.source,au.instance_material=N.controllers[T].instance_material,N.geometries.push(au)}}break;case"morph":if(B[z.morph.source]){au=new aa,au.url=z.morph.source,au.instance_material=N.controllers[T].instance_material,N.geometries.push(au),Q=N.controllers[T]}console.log("ColladaLoader: Morph-controller partially supported.")}}for(T=0;T<N.geometries.length;T++){var z=N.geometries[T],au=z.instance_material,z=B[z.url],av={},C=0,D;if(z&&z.mesh&&z.mesh.primitives){if(Z.name.length==0){Z.name=z.id}if(au){for(Y=0;Y<au.length;Y++){D=au[Y];var L=ak[f[D.target].instance_effect.url].shader;L.material.opacity=!L.material.opacity?1:L.material.opacity;D=av[D.symbol]=L.material;C++}}au=D||new c.MeshLambertMaterial({color:14540253,shading:c.FlatShading});z=z.mesh.geometry3js;if(C>1){au=new c.MeshFaceMaterial;for(Y=0;Y<z.faces.length;Y++){C=z.faces[Y],C.materials=[av[C.daeMaterial]]}}if(at!==void 0){aq(z,at),au.morphTargets=!0,au=new c.SkinnedMesh(z,au),au.skeleton=at.skeleton,au.skinController=a[at.url],au.skinInstanceController=at,au.name="skin_"+ah.length,ah.push(au)}else{if(Q!==void 0){Y=z;av=Q instanceof W?a[Q.url]:Q;if(!av||!av.morph){console.log("could not find morph controller!")}else{av=av.morph;for(C=0;C<av.targets.length;C++){if(L=B[av.targets[C]],L.mesh&&L.mesh.primitives&&L.mesh.primitives.length){L=L.mesh.primitives[0].geometry,L.vertices.length===Y.vertices.length&&Y.morphTargets.push({name:"target_1",vertices:L.vertices})}}Y.morphTargets.push({name:"target_Z",vertices:Y.vertices})}au.morphTargets=!0;au=new c.Mesh(z,au);au.name="morph_"+n.length;n.push(au)}else{au=new c.Mesh(z,au)}}N.geometries.length>1?Z.add(au):Z=au}}Z.name=N.id||"";N.matrix.decompose(Z.position,Z.rotation,Z.scale);for(T=0;T<N.nodes.length;T++){Z.add(af(N.nodes[T],N))}return Z}function v(){this.init_from=this.id=""}function ar(){this.type=this.name=this.id="";this.morph=this.skin=null}function O(){this.weights=this.targets=this.source=this.method=null}function V(){this.source="";this.bindShapeMatrix=null;this.invBindMatrices=[];this.joints=[];this.weights=[]}function S(){this.name=this.id="";this.nodes=[];this.scene=new c.Object3D}function ab(){this.sid=this.name=this.id="";this.nodes=[];this.controllers=[];this.transforms=[];this.geometries=[];this.channels=[];this.matrix=new c.Matrix4}function ae(){this.type=this.sid="";this.data=[];this.matrix=new c.Matrix4}function W(){this.url="";this.skeleton=[];this.instance_material=[]}function g(){this.target=this.symbol=""}function aa(){this.url="";this.instance_material=[]}function b(){this.id="";this.mesh=null}function q(z){this.geometry=z.id;this.primitives=[];this.geometry3js=this.vertices=null}function al(){}function l(){this.material="";this.count=0;this.inputs=[];this.vcount=null;this.p=[];this.geometry=new c.Geometry}function I(){this.source="";this.stride=this.count=0;this.params=[]}function K(){this.input={}}function H(){this.semantic="";this.offset=0;this.source="";this.set=0}function am(z){this.id=z;this.type=null}function ao(){this.name=this.id="";this.instance_effect=null}function aj(){this.color=new c.Color(0);this.color.setRGB(Math.random(),Math.random(),Math.random());this.color.a=1;this.texcoord=this.texture=null}function X(z,C){this.type=z;this.effect=C;this.material=null}function m(z){this.effect=z;this.format=this.init_from=null}function J(z){this.effect=z;this.mipfilter=this.magfilter=this.minfilter=this.wrap_t=this.wrap_s=this.source=null}function ai(){this.name=this.id="";this.sampler=this.surface=this.shader=null}function x(){this.url=""}function ad(){this.name=this.id="";this.source={};this.sampler=[];this.channel=[]}function ag(z){this.animation=z;this.target=this.source="";this.member=this.arrIndices=this.arrSyntax=this.dotSyntax=this.sid=null}function j(z){this.id="";this.animation=z;this.inputs=[];this.endTime=this.startTime=this.interpolation=this.output=this.input=null;this.duration=0}function F(z){var C=z.getAttribute("id");if(A[C]!=void 0){return A[C]}A[C]=(new am(C)).parse(z);return A[C]}function P(z){if(z=="dae"){return"http://www.collada.org/2005/11/COLLADASchema"}return null}function M(z){for(var z=h(z),D=[],C=0;C<z.length;C++){D.push(parseFloat(z[C]))}return D}function U(z){for(var z=h(z),D=[],C=0;C<z.length;C++){D.push(parseInt(z[C],10))}return D}function h(z){return z.replace(/^\s+/,"").replace(/\s+$/,"").split(/\s+/)}function an(z,D,C){return z.hasAttribute(D)?parseInt(z.getAttribute(D),10):C}function s(z,D){if(z===void 0){for(var C="0.";C.length<D+2;){C+="0"}return C}D=D||2;C=z.toString().split(".");for(C[1]=C.length>1?C[1].substr(0,D):"0";C[1].length<D;){C[1]+="0"}return C.join(".")}function ac(z,D){var C="";C+=s(z.x,D)+",";C+=s(z.y,D)+",";C+=s(z.z,D);return C}var R=null,r=null,G,E=null,A={},ap={},k={},a={},B={},f={},ak={},y,p,n,ah,w=c.SmoothShading;v.prototype.parse=function(z){this.id=z.getAttribute("id");for(var D=0;D<z.childNodes.length;D++){var C=z.childNodes[D];if(C.nodeName=="init_from"){this.init_from=C.textContent}}return this};ar.prototype.parse=function(z){this.id=z.getAttribute("id");this.name=z.getAttribute("name");this.type="none";for(var D=0;D<z.childNodes.length;D++){var C=z.childNodes[D];switch(C.nodeName){case"skin":this.skin=(new V).parse(C);this.type=C.nodeName;break;case"morph":this.morph=(new O).parse(C),this.type=C.nodeName}}return this};O.prototype.parse=function(N){var z={},C=[],D;this.method=N.getAttribute("method");this.source=N.getAttribute("source").replace(/^#/,"");for(D=0;D<N.childNodes.length;D++){var L=N.childNodes[D];if(L.nodeType==1){switch(L.nodeName){case"source":L=(new am).parse(L);z[L.id]=L;break;case"targets":C=this.parseInputs(L);break;default:console.log(L.nodeName)}}}for(D=0;D<C.length;D++){switch(N=C[D],L=z[N.source],N.semantic){case"MORPH_TARGET":this.targets=L.read();break;case"MORPH_WEIGHT":this.weights=L.read()}}return this};O.prototype.parseInputs=function(D){for(var L=[],z=0;z<D.childNodes.length;z++){var C=D.childNodes[z];if(C.nodeType==1){switch(C.nodeName){case"input":L.push((new H).parse(C))}}}return L};V.prototype.parse=function(z){var N={},C,D;this.source=z.getAttribute("source").replace(/^#/,"");this.invBindMatrices=[];this.joints=[];this.weights=[];for(var L=0;L<z.childNodes.length;L++){var Q=z.childNodes[L];if(Q.nodeType==1){switch(Q.nodeName){case"bind_shape_matrix":Q=M(Q.textContent);this.bindShapeMatrix=new c.Matrix4;this.bindShapeMatrix.set(Q[0],Q[1],Q[2],Q[3],Q[4],Q[5],Q[6],Q[7],Q[8],Q[9],Q[10],Q[11],Q[12],Q[13],Q[14],Q[15]);break;case"source":Q=(new am).parse(Q);N[Q.id]=Q;break;case"joints":C=Q;break;case"vertex_weights":D=Q;break;default:console.log(Q.nodeName)}}}this.parseJoints(C,N);this.parseWeights(D,N);return this};V.prototype.parseJoints=function(N,z){for(var C=0;C<N.childNodes.length;C++){var D=N.childNodes[C];if(D.nodeType==1){switch(D.nodeName){case"input":var D=(new H).parse(D),L=z[D.source];if(D.semantic=="JOINT"){this.joints=L.read()}else{if(D.semantic=="INV_BIND_MATRIX"){this.invBindMatrices=L.read()}}}}}};V.prototype.parseWeights=function(av,z){for(var L,N,Z=[],au=0;au<av.childNodes.length;au++){var Q=av.childNodes[au];if(Q.nodeType==1){switch(Q.nodeName){case"input":Z.push((new H).parse(Q));break;case"v":L=U(Q.textContent);break;case"vcount":N=U(Q.textContent)}}}for(au=Q=0;au<N.length;au++){for(var T=N[au],Y=[],at=0;at<T;at++){for(var C={},aw=0;aw<Z.length;aw++){var ax=Z[aw],D=L[Q+ax.offset];switch(ax.semantic){case"JOINT":C.joint=D;break;case"WEIGHT":C.weight=z[ax.source].data[D]}}Y.push(C);Q+=Z.length}for(at=0;at<Y.length;at++){Y[at].index=au}this.weights.push(Y)}};S.prototype.getChildById=function(D,L){for(var z=0;z<this.nodes.length;z++){var C=this.nodes[z].getChildById(D,L);if(C){return C}}return null};S.prototype.getChildBySid=function(D,L){for(var z=0;z<this.nodes.length;z++){var C=this.nodes[z].getChildBySid(D,L);if(C){return C}}return null};S.prototype.parse=function(z){this.id=z.getAttribute("id");this.name=z.getAttribute("name");this.nodes=[];for(var D=0;D<z.childNodes.length;D++){var C=z.childNodes[D];if(C.nodeType==1){switch(C.nodeName){case"node":this.nodes.push((new ab).parse(C))}}}return this};ab.prototype.getChannelForTransform=function(Y){for(var z=0;z<this.channels.length;z++){var Q=this.channels[z],T=Q.target.split("/");T.shift();var C=T.shift(),D=C.indexOf(".")>=0,L=C.indexOf("(")>=0,N;if(D){T=C.split("."),C=T.shift(),T.shift()}else{if(L){N=C.split("(");C=N.shift();for(T=0;T<N.length;T++){N[T]=parseInt(N[T].replace(/\)/,""))}}}if(C==Y){return Q.info={sid:C,dotSyntax:D,arrSyntax:L,arrIndices:N},Q}}return null};ab.prototype.getChildById=function(D,L){if(this.id==D){return this}if(L){for(var z=0;z<this.nodes.length;z++){var C=this.nodes[z].getChildById(D,L);if(C){return C}}}return null};ab.prototype.getChildBySid=function(D,L){if(this.sid==D){return this}if(L){for(var z=0;z<this.nodes.length;z++){var C=this.nodes[z].getChildBySid(D,L);if(C){return C}}}return null};ab.prototype.getTransformBySid=function(z){for(var C=0;C<this.transforms.length;C++){if(this.transforms[C].sid==z){return this.transforms[C]}}return null};ab.prototype.parse=function(Y){var Z;this.id=Y.getAttribute("id");this.sid=Y.getAttribute("sid");this.name=Y.getAttribute("name");this.type=Y.getAttribute("type");this.type=this.type=="JOINT"?this.type:"NODE";this.nodes=[];this.transforms=[];this.geometries=[];this.controllers=[];this.matrix=new c.Matrix4;for(var Q=0;Q<Y.childNodes.length;Q++){if(Z=Y.childNodes[Q],Z.nodeType==1){switch(Z.nodeName){case"node":this.nodes.push((new ab).parse(Z));break;case"instance_camera":break;case"instance_controller":this.controllers.push((new W).parse(Z));break;case"instance_geometry":this.geometries.push((new aa).parse(Z));break;case"instance_light":break;case"instance_node":Z=Z.getAttribute("url").replace(/^#/,"");(Z=R.evaluate(".//dae:library_nodes//dae:node[@id='"+Z+"']",R,P,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null).iterateNext())&&this.nodes.push((new ab).parse(Z));break;case"rotate":case"translate":case"scale":case"matrix":case"lookat":case"skew":this.transforms.push((new ae).parse(Z));break;case"extra":break;default:console.log(Z.nodeName)}}}Y=[];Q=1000000;Z=-1000000;for(var T in k){for(var C=k[T],at=0;at<C.channel.length;at++){var au=C.channel[at],z=C.sampler[at];T=au.target.split("/")[0];if(T==this.id){z.create(),au.sampler=z,Q=Math.min(Q,z.startTime),Z=Math.max(Z,z.endTime),Y.push(au)}}}if(Y.length){this.startTime=Q,this.endTime=Z}if((this.channels=Y)&&this.channels.length){T=10000000;for(Y=0;Y<this.channels.length;Y++){Q=this.channels[Y].sampler;for(Z=0;Z<Q.input.length-1;Z++){T=Math.min(T,Q.input[Z+1]-Q.input[Z])}}Q=[];for(Y=this.startTime;Y<this.endTime;Y+=T){Z=Y;for(var C={},D=at=void 0,at=0;at<this.channels.length;at++){D=this.channels[at],C[D.sid]=D}au=new c.Matrix4;for(at=0;at<this.transforms.length;at++){if(z=this.transforms[at],D=C[z.sid],D!==void 0){for(var L=D.sampler,N,D=0;D<L.input.length-1;D++){if(L.input[D+1]>Z){N=L.output[D];break}}au=N!==void 0?N instanceof c.Matrix4?au.multiply(au,N):au.multiply(au,z.matrix):au.multiply(au,z.matrix)}else{au=au.multiply(au,z.matrix)}}Z=au;Q.push({time:Y,pos:[Z.n14,Z.n24,Z.n34],rotq:[0,0,0,1],scl:[1,1,1]})}this.keys=Q}this.updateMatrix();return this};ab.prototype.updateMatrix=function(){this.matrix.identity();for(var z=0;z<this.transforms.length;z++){this.matrix.multiply(this.matrix,this.transforms[z].matrix)}};ae.prototype.parse=function(z){this.sid=z.getAttribute("sid");this.type=z.nodeName;this.data=M(z.textContent);this.updateMatrix();return this};ae.prototype.updateMatrix=function(){var z=0;this.matrix.identity();switch(this.type){case"matrix":this.matrix.set(this.data[0],this.data[1],this.data[2],this.data[3],this.data[4],this.data[5],this.data[6],this.data[7],this.data[8],this.data[9],this.data[10],this.data[11],this.data[12],this.data[13],this.data[14],this.data[15]);break;case"translate":this.matrix.setTranslation(this.data[0],this.data[1],this.data[2]);break;case"rotate":z=this.data[3]*(Math.PI/180);this.matrix.setRotationAxis(new c.Vector3(this.data[0],this.data[1],this.data[2]),z);break;case"scale":this.matrix.setScale(this.data[0],this.data[1],this.data[2])}return this.matrix};W.prototype.parse=function(D){this.url=D.getAttribute("url").replace(/^#/,"");this.skeleton=[];this.instance_material=[];for(var L=0;L<D.childNodes.length;L++){var z=D.childNodes[L];if(z.nodeType==1){switch(z.nodeName){case"skeleton":this.skeleton.push(z.textContent.replace(/^#/,""));break;case"bind_material":if(z=R.evaluate(".//dae:instance_material",z,P,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null)){for(var C=z.iterateNext();C;){this.instance_material.push((new g).parse(C)),C=z.iterateNext()}}}}}return this};g.prototype.parse=function(z){this.symbol=z.getAttribute("symbol");this.target=z.getAttribute("target").replace(/^#/,"");return this};aa.prototype.parse=function(z){this.url=z.getAttribute("url").replace(/^#/,"");this.instance_material=[];for(var D=0;D<z.childNodes.length;D++){var C=z.childNodes[D];if(C.nodeType==1&&C.nodeName=="bind_material"){if(z=R.evaluate(".//dae:instance_material",C,P,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null)){for(D=z.iterateNext();D;){this.instance_material.push((new g).parse(D)),D=z.iterateNext()}}break}}return this};b.prototype.parse=function(z){this.id=z.getAttribute("id");for(var D=0;D<z.childNodes.length;D++){var C=z.childNodes[D];switch(C.nodeName){case"mesh":this.mesh=(new q(this)).parse(C)}}return this};q.prototype.parse=function(z){function N(Y,Z){var T=ac(Y.position);L[T]===void 0&&(L[T]={v:Y,index:Z});return L[T]}this.primitives=[];var C;for(C=0;C<z.childNodes.length;C++){var D=z.childNodes[C];switch(D.nodeName){case"source":F(D);break;case"vertices":this.vertices=(new K).parse(D);break;case"triangles":this.primitives.push((new l).parse(D));break;case"polygons":console.warn("polygon holes not yet supported!");case"polylist":this.primitives.push((new al).parse(D))}}var L={};this.geometry3js=new c.Geometry;D=A[this.vertices.input.POSITION.source].data;for(z=C=0;C<D.length;C+=3,z++){var Q=new c.Vertex(new c.Vector3(D[C],D[C+1],D[C+2]));N(Q,z);this.geometry3js.vertices.push(Q)}for(C=0;C<this.primitives.length;C++){z=this.primitives[C],z.setVertices(this.vertices),this.handlePrimitive(z,this.geometry3js,L)}this.geometry3js.computeCentroids();this.geometry3js.computeFaceNormals();this.geometry3js.computeVertexNormals();this.geometry3js.computeBoundingBox();return this};q.prototype.handlePrimitive=function(ax,N,Q){var ay=0,az,aA,aB=ax.p,aC=ax.inputs,D,Z,au,aw,z=0,C=3,L=[];for(az=0;az<aC.length;az++){switch(D=aC[az],D.semantic){case"TEXCOORD":L.push(D.set)}}for(;ay<aB.length;){var aD=[],T=[],Y={},av=[];ax.vcount&&(C=ax.vcount[z++]);for(az=0;az<C;az++){for(aA=0;aA<aC.length;aA++){switch(D=aC[aA],aw=A[D.source],Z=aB[ay+az*aC.length+D.offset],au=aw.accessor.params.length,au*=Z,D.semantic){case"VERTEX":D=ac(N.vertices[Z].position);aD.push(Q[D].index);break;case"NORMAL":T.push(new c.Vector3(aw.data[au],aw.data[au+1],aw.data[au+2]));break;case"TEXCOORD":Y[D.set]===void 0&&(Y[D.set]=[]);Y[D.set].push(new c.UV(aw.data[au],aw.data[au+1]));break;case"COLOR":av.push((new c.Color).setRGB(aw.data[au],aw.data[au+1],aw.data[au+2]))}}}var at;C==3?at=new c.Face3(aD[0],aD[1],aD[2],[T[0],T[1],T[2]],av.length?av:new c.Color):C==4&&(at=new c.Face4(aD[0],aD[1],aD[2],aD[3],[T[0],T[1],T[2],T[3]],av.length?av:new c.Color));at.daeMaterial=ax.material;N.faces.push(at);for(aA=0;aA<L.length;aA++){az=Y[L[aA]],N.faceVertexUvs[aA].push([az[0],az[1],az[2]])}ay+=aC.length*C}};al.prototype=new l;al.prototype.constructor=al;l.prototype.setVertices=function(z){for(var C=0;C<this.inputs.length;C++){if(this.inputs[C].source==z.id){this.inputs[C].source=z.input.POSITION.source}}};l.prototype.parse=function(z){this.inputs=[];this.material=z.getAttribute("material");this.count=an(z,"count",0);for(var D=0;D<z.childNodes.length;D++){var C=z.childNodes[D];switch(C.nodeName){case"input":this.inputs.push((new H).parse(z.childNodes[D]));break;case"vcount":this.vcount=U(C.textContent);break;case"p":this.p=U(C.textContent)}}return this};I.prototype.parse=function(D){this.params=[];this.source=D.getAttribute("source");this.count=an(D,"count",0);this.stride=an(D,"stride",0);for(var L=0;L<D.childNodes.length;L++){var z=D.childNodes[L];if(z.nodeName=="param"){var C={};C.name=z.getAttribute("name");C.type=z.getAttribute("type");this.params.push(C)}}return this};K.prototype.parse=function(z){this.id=z.getAttribute("id");for(var D=0;D<z.childNodes.length;D++){if(z.childNodes[D].nodeName=="input"){var C=(new H).parse(z.childNodes[D]);this.input[C.semantic]=C}}return this};H.prototype.parse=function(z){this.semantic=z.getAttribute("semantic");this.source=z.getAttribute("source").replace(/^#/,"");this.set=an(z,"set",-1);this.offset=an(z,"offset",0);if(this.semantic=="TEXCOORD"&&this.set<0){this.set=0}return this};am.prototype.parse=function(z){this.id=z.getAttribute("id");for(var N=0;N<z.childNodes.length;N++){var C=z.childNodes[N];switch(C.nodeName){case"bool_array":for(var D=h(C.textContent),L=[],Q=0;Q<D.length;Q++){L.push(D[Q]=="true"||D[Q]=="1"?!0:!1)}this.data=L;this.type=C.nodeName;break;case"float_array":this.data=M(C.textContent);this.type=C.nodeName;break;case"int_array":this.data=U(C.textContent);this.type=C.nodeName;break;case"IDREF_array":case"Name_array":this.data=h(C.textContent);this.type=C.nodeName;break;case"technique_common":for(D=0;D<C.childNodes.length;D++){if(C.childNodes[D].nodeName=="accessor"){this.accessor=(new I).parse(C.childNodes[D]);break}}}}return this};am.prototype.read=function(){var D=[],L=this.accessor.params[0];switch(L.type){case"IDREF":case"Name":case"name":case"float":return this.data;case"float4x4":for(L=0;L<this.data.length;L+=16){var z=this.data.slice(L,L+16),C=new c.Matrix4;C.set(z[0],z[1],z[2],z[3],z[4],z[5],z[6],z[7],z[8],z[9],z[10],z[11],z[12],z[13],z[14],z[15]);D.push(C)}break;default:console.log("ColladaLoader: Source: Read dont know how to read "+L.type+".")}return D};ao.prototype.parse=function(z){this.id=z.getAttribute("id");this.name=z.getAttribute("name");for(var C=0;C<z.childNodes.length;C++){if(z.childNodes[C].nodeName=="instance_effect"){this.instance_effect=(new x).parse(z.childNodes[C]);break}}return this};aj.prototype.isColor=function(){return this.texture==null};aj.prototype.isTexture=function(){return this.texture!=null};aj.prototype.parse=function(z){for(var D=0;D<z.childNodes.length;D++){var C=z.childNodes[D];if(C.nodeType==1){switch(C.nodeName){case"color":C=M(C.textContent);this.color=new c.Color(0);this.color.setRGB(C[0],C[1],C[2]);this.color.a=C[3];break;case"texture":this.texture=C.getAttribute("texture"),this.texcoord=C.getAttribute("texcoord")}}}return this};X.prototype.parse=function(z){for(var N=0;N<z.childNodes.length;N++){var C=z.childNodes[N];if(C.nodeType==1){switch(C.nodeName){case"ambient":case"emission":case"diffuse":case"specular":case"transparent":this[C.nodeName]=(new aj).parse(C);break;case"shininess":case"reflectivity":case"transparency":var D;D=R.evaluate(".//dae:float",C,P,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);for(var L=D.iterateNext(),Q=[];L;){Q.push(L),L=D.iterateNext()}D=Q;D.length>0&&(this[C.nodeName]=parseFloat(D[0].textContent))}}}this.create();return this};X.prototype.create=function(){var D={},L=this.transparency!==void 0&&this.transparency<1,z;for(z in this){switch(z){case"ambient":case"emission":case"diffuse":case"specular":var C=this[z];if(C instanceof aj){if(C.isTexture()){if(this.effect.sampler&&this.effect.surface&&this.effect.sampler.source==this.effect.surface.sid&&(C=ap[this.effect.surface.init_from])){D.map=c.ImageUtils.loadTexture(p+C.init_from),D.map.wrapS=c.RepeatWrapping,D.map.wrapT=c.RepeatWrapping,D.map.repeat.x=1,D.map.repeat.y=-1}}else{z=="diffuse"?D.color=C.color.getHex():L||(D[z]=C.color.getHex())}}break;case"shininess":case"reflectivity":D[z]=this[z];break;case"transparency":if(L){D.transparent=!0,D.opacity=this[z],L=!0}}}D.shading=w;return this.material=new c.MeshLambertMaterial(D)};m.prototype.parse=function(z){for(var D=0;D<z.childNodes.length;D++){var C=z.childNodes[D];if(C.nodeType==1){switch(C.nodeName){case"init_from":this.init_from=C.textContent;break;case"format":this.format=C.textContent;break;default:console.log("unhandled Surface prop: "+C.nodeName)}}}return this};J.prototype.parse=function(z){for(var D=0;D<z.childNodes.length;D++){var C=z.childNodes[D];if(C.nodeType==1){switch(C.nodeName){case"source":this.source=C.textContent;break;case"minfilter":this.minfilter=C.textContent;break;case"magfilter":this.magfilter=C.textContent;break;case"mipfilter":this.mipfilter=C.textContent;break;case"wrap_s":this.wrap_s=C.textContent;break;case"wrap_t":this.wrap_t=C.textContent;break;default:console.log("unhandled Sampler2D prop: "+C.nodeName)}}}return this};ai.prototype.create=function(){if(this.shader==null){return null}};ai.prototype.parse=function(z){this.id=z.getAttribute("id");this.name=z.getAttribute("name");this.shader=null;for(var D=0;D<z.childNodes.length;D++){var C=z.childNodes[D];if(C.nodeType==1){switch(C.nodeName){case"profile_COMMON":this.parseTechnique(this.parseProfileCOMMON(C))}}}return this};ai.prototype.parseNewparam=function(D){for(var L=D.getAttribute("sid"),z=0;z<D.childNodes.length;z++){var C=D.childNodes[z];if(C.nodeType==1){switch(C.nodeName){case"surface":this.surface=(new m(this)).parse(C);this.surface.sid=L;break;case"sampler2D":this.sampler=(new J(this)).parse(C);this.sampler.sid=L;break;case"extra":break;default:console.log(C.nodeName)}}}};ai.prototype.parseProfileCOMMON=function(D){for(var L,z=0;z<D.childNodes.length;z++){var C=D.childNodes[z];if(C.nodeType==1){switch(C.nodeName){case"profile_COMMON":this.parseProfileCOMMON(C);break;case"technique":L=C;break;case"newparam":this.parseNewparam(C);break;case"extra":break;default:console.log(C.nodeName)}}}return L};ai.prototype.parseTechnique=function(z){for(var D=0;D<z.childNodes.length;D++){var C=z.childNodes[D];if(C.nodeType==1){switch(C.nodeName){case"lambert":case"blinn":case"phong":this.shader=(new X(C.nodeName,this)).parse(C)}}}};x.prototype.parse=function(z){this.url=z.getAttribute("url").replace(/^#/,"");return this};ad.prototype.parse=function(z){this.id=z.getAttribute("id");this.name=z.getAttribute("name");this.source={};for(var D=0;D<z.childNodes.length;D++){var C=z.childNodes[D];if(C.nodeType==1){switch(C.nodeName){case"source":C=(new am).parse(C);this.source[C.id]=C;break;case"sampler":this.sampler.push((new j(this)).parse(C));break;case"channel":this.channel.push((new ag(this)).parse(C))}}}return this};ag.prototype.parse=function(z){this.source=z.getAttribute("source").replace(/^#/,"");this.target=z.getAttribute("target");var N=this.target.split("/");N.shift();var z=N.shift(),C=z.indexOf(".")>=0,D=z.indexOf("(")>=0,L,Q;if(C){N=z.split("."),z=N.shift(),Q=N.shift()}else{if(D){L=z.split("(");z=L.shift();for(N=0;N<L.length;N++){L[N]=parseInt(L[N].replace(/\)/,""))}}}this.sid=z;this.dotSyntax=C;this.arrSyntax=D;this.arrIndices=L;this.member=Q;return this};j.prototype.parse=function(z){this.id=z.getAttribute("id");this.inputs=[];for(var D=0;D<z.childNodes.length;D++){var C=z.childNodes[D];if(C.nodeType==1){switch(C.nodeName){case"input":this.inputs.push((new H).parse(C))}}}return this};j.prototype.create=function(){for(var z=0;z<this.inputs.length;z++){var D=this.inputs[z],C=this.animation.source[D.source];switch(D.semantic){case"INPUT":this.input=C.read();break;case"OUTPUT":this.output=C.read();break;case"INTERPOLATION":this.interpolation=C.read();break;case"IN_TANGENT":break;case"OUT_TANGENT":break;default:console.log(D.semantic)}}this.duration=this.endTime=this.startTime=0;if(this.input.length){this.startTime=100000000;this.endTime=-100000000;for(z=0;z<this.input.length;z++){this.startTime=Math.min(this.startTime,this.input[z]),this.endTime=Math.max(this.endTime,this.input[z])}this.duration=this.endTime-this.startTime}};return{load:function(D,z){if(document.implementation&&document.implementation.createDocument){document.implementation.createDocument("http://www.collada.org/2005/11/COLLADASchema","COLLADA",null);D+="?rnd="+Math.random();var C=new XMLHttpRequest;C.overrideMimeType&&C.overrideMimeType("text/xml");C.onreadystatechange=function(){if(C.readyState==4&&(C.status==0||C.status==200)){E=z,e(C.responseXML,void 0,D)}};C.open("GET",D,!0);C.send(null)}else{alert("Don't know how to parse XML!")}},parse:e,setPreferredShading:function(z){w=z},applySkin:aq,geometries:B}};c.JSONLoader=function(a){c.Loader.call(this,a)};c.JSONLoader.prototype=new c.Loader;c.JSONLoader.prototype.constructor=c.JSONLoader;c.JSONLoader.prototype.supr=c.Loader.prototype;c.JSONLoader.prototype.load=function(f,b,a){if(f instanceof Object){console.warn("DEPRECATED: JSONLoader( parameters ) is now JSONLoader( url, callback, texturePath )."),a=f,f=a.model,b=a.callback,a=a.texture_path}a=a?a:this.extractUrlbase(f);this.onLoadStart();this.loadAjaxJSON(this,f,b,a)};c.JSONLoader.prototype.loadAjaxJSON=function(g,b,a,m,f){var e=new XMLHttpRequest,n=0;e.onreadystatechange=function(){if(e.readyState==4){if(e.status==200||e.status==0){try{var h=JSON.parse(e.responseText);g.createModel(h,a,m);g.onLoadComplete()}catch(j){console.error(j),console.warn("DEPRECATED: ["+b+"] seems to be using old model format")}}else{console.error("Couldn't load ["+b+"] ["+e.status+"]")}}else{e.readyState==3?f&&(n==0&&(n=e.getResponseHeader("Content-Length")),f({total:n,loaded:e.responseText.length})):e.readyState==2&&(n=e.getResponseHeader("Content-Length"))}};e.open("GET",b,!0);e.overrideMimeType("text/plain; charset=x-user-defined");e.setRequestHeader("Content-Type","text/plain");e.send(null)};c.JSONLoader.prototype.createModel=function(b,g,j){var k=new c.Geometry,a=b.scale!==void 0?1/b.scale:1;this.initMaterials(k,b.materials,j);(function(e){if(b.metadata===void 0||b.metadata.formatVersion===void 0||b.metadata.formatVersion!==3){console.error("Deprecated file format.")}else{var f,h,m,p,n,o,q,r,w,u,Q,t,x,B,F=b.faces;o=b.vertices;var P=b.normals,A=b.colors,R=0;for(f=0;f<b.uvs.length;f++){b.uvs[f].length&&R++}for(f=0;f<R;f++){k.faceUvs[f]=[],k.faceVertexUvs[f]=[]}p=0;for(n=o.length;p<n;){q=new c.Vertex,q.position.x=o[p++]*e,q.position.y=o[p++]*e,q.position.z=o[p++]*e,k.vertices.push(q)}p=0;for(n=F.length;p<n;){e=F[p++];o=e&1;m=e&2;f=e&4;h=e&8;r=e&16;q=e&32;u=e&64;e&=128;o?(Q=new c.Face4,Q.a=F[p++],Q.b=F[p++],Q.c=F[p++],Q.d=F[p++],o=4):(Q=new c.Face3,Q.a=F[p++],Q.b=F[p++],Q.c=F[p++],o=3);if(m){m=F[p++],Q.materialIndex=m}m=k.faces.length;if(f){for(f=0;f<R;f++){t=b.uvs[f],w=F[p++],B=t[w*2],w=t[w*2+1],k.faceUvs[f][m]=new c.UV(B,w)}}if(h){for(f=0;f<R;f++){t=b.uvs[f];x=[];for(h=0;h<o;h++){w=F[p++],B=t[w*2],w=t[w*2+1],x[h]=new c.UV(B,w)}k.faceVertexUvs[f][m]=x}}if(r){r=F[p++]*3,h=new c.Vector3,h.x=P[r++],h.y=P[r++],h.z=P[r],Q.normal=h}if(q){for(f=0;f<o;f++){r=F[p++]*3,h=new c.Vector3,h.x=P[r++],h.y=P[r++],h.z=P[r],Q.vertexNormals.push(h)}}if(u){q=F[p++],q=new c.Color(A[q]),Q.color=q}if(e){for(f=0;f<o;f++){q=F[p++],q=new c.Color(A[q]),Q.vertexColors.push(q)}}k.faces.push(Q)}}})(a);(function(){var m,e,f,h;if(b.skinWeights){m=0;for(e=b.skinWeights.length;m<e;m+=2){f=b.skinWeights[m],h=b.skinWeights[m+1],k.skinWeights.push(new c.Vector4(f,h,0,0))}}if(b.skinIndices){m=0;for(e=b.skinIndices.length;m<e;m+=2){f=b.skinIndices[m],h=b.skinIndices[m+1],k.skinIndices.push(new c.Vector4(f,h,0,0))}}k.bones=b.bones;k.animation=b.animation})();(function(z){if(b.morphTargets!==void 0){var e,f,h,o,m,r,x,p,y;e=0;for(f=b.morphTargets.length;e<f;e++){k.morphTargets[e]={};k.morphTargets[e].name=b.morphTargets[e].name;k.morphTargets[e].vertices=[];p=k.morphTargets[e].vertices;y=b.morphTargets[e].vertices;h=0;for(o=y.length;h<o;h+=3){m=y[h]*z,r=y[h+1]*z,x=y[h+2]*z,p.push(new c.Vertex(new c.Vector3(m,r,x)))}}}if(b.morphColors!==void 0){e=0;for(f=b.morphColors.length;e<f;e++){k.morphColors[e]={};k.morphColors[e].name=b.morphColors[e].name;k.morphColors[e].colors=[];o=k.morphColors[e].colors;m=b.morphColors[e].colors;z=0;for(h=m.length;z<h;z+=3){r=new c.Color(16755200),r.setRGB(m[z],m[z+1],m[z+2]),o.push(r)}}}})(a);k.computeCentroids();k.computeFaceNormals();this.hasNormals(k)&&k.computeTangents();g(k)};c.SceneLoader=function(){this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){};this.callbackSync=function(){};this.callbackProgress=function(){}};c.SceneLoader.prototype.constructor=c.SceneLoader;c.SceneLoader.prototype.load=function(a,g){var b=this,h=new XMLHttpRequest;h.onreadystatechange=function(){if(h.readyState==4){if(h.status==200||h.status==0){try{var f=JSON.parse(h.responseText);f.metadata===void 0||f.metadata.formatVersion===void 0||f.metadata.formatVersion!==3?console.error("Deprecated file format."):b.createScene(f,g,a)}catch(e){console.error(e),console.warn("DEPRECATED: ["+a+"] seems to be using old model format")}}else{console.error("Couldn't load ["+a+"] ["+h.status+"]")}}};h.open("GET",a,!0);h.overrideMimeType("text/plain; charset=x-user-defined");h.setRequestHeader("Content-Type","text/plain");h.send(null)};c.SceneLoader.prototype.createScene=function(o,u,r){function w(z,j){return j=="relativeToHTML"?z:U+"/"+z}function G(){var z;for(p in g.objects){if(!E.objects[p]){if(J=g.objects[p],J.geometry!==void 0){if(ac=E.geometries[J.geometry]){z=!1;for(I=0;I<J.materials.length;I++){s=E.materials[J.materials[I]],z=s instanceof c.ShaderMaterial}z&&ac.computeTangents();q=J.position;y=J.rotation;m=J.quaternion;e=J.scale;m=0;s.length==0&&(s=new c.MeshFaceMaterial);s.length>1&&(s=new c.MeshFaceMaterial);z=new c.Mesh(ac,s);z.name=p;z.position.set(q[0],q[1],q[2]);m?(z.quaternion.set(m[0],m[1],m[2],m[3]),z.useQuaternion=!0):z.rotation.set(y[0],y[1],y[2]);z.scale.set(e[0],e[1],e[2]);z.visible=J.visible;E.scene.add(z);E.objects[p]=z;if(J.meshCollider){var j=c.CollisionUtils.MeshColliderWBox(z);E.scene.collisions.colliders.push(j)}if(J.castsShadow){j=new c.ShadowVolume(ac),E.scene.add(j),j.position=z.position,j.rotation=z.rotation,j.scale=z.scale}J.trigger&&J.trigger.toLowerCase()!="none"&&(j={type:J.trigger,object:J},E.triggers[z.name]=j)}}else{q=J.position,y=J.rotation,m=J.quaternion,e=J.scale,m=0,z=new c.Object3D,z.name=p,z.position.set(q[0],q[1],q[2]),m?(z.quaternion.set(m[0],m[1],m[2],m[3]),z.useQuaternion=!0):z.rotation.set(y[0],y[1],y[2]),z.scale.set(e[0],e[1],e[2]),z.visible=J.visible!==void 0?J.visible:!1,E.scene.add(z),E.objects[p]=z,E.empties[p]=z,J.trigger&&J.trigger.toLowerCase()!="none"&&(j={type:J.trigger,object:J},E.triggers[z.name]=j)}}}}function F(j){return function(z){E.geometries[j]=z;G();a-=1;K.onLoadComplete();H()}}function B(j){return function(z){E.geometries[j]=z}}function H(){K.callbackProgress({totalModels:O,totalTextures:k,loadedModels:O-a,loadedTextures:k-ab},E);K.onLoadProgress();a==0&&ab==0&&u(E)}var K=this,U=c.Loader.prototype.extractUrlbase(r),P,n,p,b,v,f,t,J,ad,aa,q,y,m,e,h,ac,R,x,s,g,l,a,ab,O,k,E;g=o;r=new c.BinaryLoader;l=new c.JSONLoader;ab=a=0;E={scene:new c.Scene,geometries:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},triggers:{},empties:{}};o=!1;for(p in g.objects){if(J=g.objects[p],J.meshCollider){o=!0;break}}if(o){E.scene.collisions=new c.CollisionSystem}if(g.transform){o=g.transform.position;ad=g.transform.rotation;var A=g.transform.scale;o&&E.scene.position.set(o[0],o[1],o[2]);ad&&E.scene.rotation.set(ad[0],ad[1],ad[2]);A&&E.scene.scale.set(A[0],A[1],A[2]);(o||ad||A)&&E.scene.updateMatrix()}o=function(){ab-=1;H();K.onLoadComplete()};for(v in g.cameras){ad=g.cameras[v],ad.type=="perspective"?R=new c.PerspectiveCamera(ad.fov,ad.aspect,ad.near,ad.far):ad.type=="ortho"&&(R=new c.OrthographicCamera(ad.left,ad.right,ad.top,ad.bottom,ad.near,ad.far)),q=ad.position,ad=ad.target,R.position.set(q[0],q[1],q[2]),R.target=new c.Vector3(ad[0],ad[1],ad[2]),E.cameras[v]=R}for(b in g.lights){ad=g.lights[b],v=ad.color!==void 0?ad.color:16777215,R=ad.intensity!==void 0?ad.intensity:1,ad.type=="directional"?(q=ad.direction,aa=new c.DirectionalLight(v,R),aa.position.set(q[0],q[1],q[2]),aa.position.normalize()):ad.type=="point"?(q=ad.position,aa=ad.distance,aa=new c.PointLight(v,R,aa),aa.position.set(q[0],q[1],q[2])):ad.type=="ambient"&&(aa=new c.AmbientLight(v)),E.scene.add(aa),E.lights[b]=aa}for(f in g.fogs){b=g.fogs[f],b.type=="linear"?x=new c.Fog(0,b.near,b.far):b.type=="exp2"&&(x=new c.FogExp2(0,b.density)),ad=b.color,x.color.setRGB(ad[0],ad[1],ad[2]),E.fogs[f]=x}if(E.cameras&&g.defaults.camera){E.currentCamera=E.cameras[g.defaults.camera]}if(E.fogs&&g.defaults.fog){E.scene.fog=E.fogs[g.defaults.fog]}ad=g.defaults.bgcolor;E.bgColor=new c.Color;E.bgColor.setRGB(ad[0],ad[1],ad[2]);E.bgColorAlpha=g.defaults.bgalpha;for(P in g.geometries){if(f=g.geometries[P],f.type=="bin_mesh"||f.type=="ascii_mesh"){a+=1,K.onLoadStart()}}O=a;for(P in g.geometries){f=g.geometries[P],f.type=="cube"?(ac=new c.CubeGeometry(f.width,f.height,f.depth,f.segmentsWidth,f.segmentsHeight,f.segmentsDepth,null,f.flipped,f.sides),E.geometries[P]=ac):f.type=="plane"?(ac=new c.PlaneGeometry(f.width,f.height,f.segmentsWidth,f.segmentsHeight),E.geometries[P]=ac):f.type=="sphere"?(ac=new c.SphereGeometry(f.radius,f.segmentsWidth,f.segmentsHeight),E.geometries[P]=ac):f.type=="cylinder"?(ac=new c.CylinderGeometry(f.topRad,f.botRad,f.height,f.radSegs,f.heightSegs),E.geometries[P]=ac):f.type=="torus"?(ac=new c.TorusGeometry(f.radius,f.tube,f.segmentsR,f.segmentsT),E.geometries[P]=ac):f.type=="icosahedron"?(ac=new c.IcosahedronGeometry(f.subdivisions),E.geometries[P]=ac):f.type=="bin_mesh"?r.load(w(f.url,g.urlBaseType),F(P)):f.type=="ascii_mesh"?l.load(w(f.url,g.urlBaseType),F(P)):f.type=="embedded_mesh"&&(f=g.embeds[f.id])&&l.createModel(f,B(P),"")}for(t in g.textures){if(P=g.textures[t],P.url instanceof Array){ab+=P.url.length;for(f=0;f<P.url.length;f++){K.onLoadStart()}}else{ab+=1,K.onLoadStart()}}k=ab;for(t in g.textures){P=g.textures[t];if(P.mapping!=void 0&&c[P.mapping]!=void 0){P.mapping=new c[P.mapping]}if(P.url instanceof Array){f=[];for(var I=0;I<P.url.length;I++){f[I]=w(P.url[I],g.urlBaseType)}f=c.ImageUtils.loadTextureCube(f,P.mapping,o)}else{f=c.ImageUtils.loadTexture(w(P.url,g.urlBaseType),P.mapping,o);if(c[P.minFilter]!=void 0){f.minFilter=c[P.minFilter]}if(c[P.magFilter]!=void 0){f.magFilter=c[P.magFilter]}if(P.repeat){f.repeat.set(P.repeat[0],P.repeat[1]);if(P.repeat[0]!=1){f.wrapS=c.RepeatWrapping}if(P.repeat[1]!=1){f.wrapT=c.RepeatWrapping}}P.offset&&f.offset.set(P.offset[0],P.offset[1]);if(P.wrap){x={repeat:c.RepeatWrapping,mirror:c.MirroredRepeatWrapping};if(x[P.wrap[0]]!==void 0){f.wrapS=x[P.wrap[0]]}if(x[P.wrap[1]]!==void 0){f.wrapT=x[P.wrap[1]]}}}E.textures[t]=f}for(n in g.materials){t=g.materials[n];for(h in t.parameters){if(h=="envMap"||h=="map"||h=="lightMap"){t.parameters[h]=E.textures[t.parameters[h]]}else{if(h=="shading"){t.parameters[h]=t.parameters[h]=="flat"?c.FlatShading:c.SmoothShading}else{if(h=="blending"){t.parameters[h]=c[t.parameters[h]]?c[t.parameters[h]]:c.NormalBlending}else{if(h=="combine"){t.parameters[h]=t.parameters[h]=="MixOperation"?c.MixOperation:c.MultiplyOperation}else{if(h=="vertexColors"){if(t.parameters[h]=="face"){t.parameters[h]=c.FaceColors}else{if(t.parameters[h]){t.parameters[h]=c.VertexColors}}}}}}}}if(t.parameters.opacity!==void 0&&t.parameters.opacity<1){t.parameters.transparent=!0}if(t.parameters.normalMap){P=c.ShaderUtils.lib.normal;o=c.UniformsUtils.clone(P.uniforms);f=t.parameters.color;x=t.parameters.specular;r=t.parameters.ambient;l=t.parameters.shininess;o.tNormal.texture=E.textures[t.parameters.normalMap];if(t.parameters.normalMapFactor){o.uNormalScale.value=t.parameters.normalMapFactor}if(t.parameters.map){o.tDiffuse.texture=t.parameters.map,o.enableDiffuse.value=!0}if(t.parameters.lightMap){o.tAO.texture=t.parameters.lightMap,o.enableAO.value=!0}if(t.parameters.specularMap){o.tSpecular.texture=E.textures[t.parameters.specularMap],o.enableSpecular.value=!0}o.uDiffuseColor.value.setHex(f);o.uSpecularColor.value.setHex(x);o.uAmbientColor.value.setHex(r);o.uShininess.value=l;if(t.parameters.opacity){o.uOpacity.value=t.parameters.opacity}t=new c.ShaderMaterial({fragmentShader:P.fragmentShader,vertexShader:P.vertexShader,uniforms:o,lights:!0,fog:!0})}else{t=new c[t.type](t.parameters)}E.materials[n]=t}G();K.callbackSync(E);H()};c.UTF8Loader=function(){};c.UTF8Loader.prototype=new c.UTF8Loader;c.UTF8Loader.prototype.constructor=c.UTF8Loader;c.UTF8Loader.prototype.load=function(a,g,e){if(a instanceof Object){console.warn("DEPRECATED: UTF8Loader( parameters ) is now UTF8Loader( url, callback, metaData )."),e=a,a=e.model,g=e.callback,e={scale:e.scale,offsetX:e.offsetX,offsetY:e.offsetY,offsetZ:e.offsetZ}}var b=new XMLHttpRequest,p=e.scale!==void 0?e.scale:1,h=e.offsetX!==void 0?e.offsetX:0,f=e.offsetY!==void 0?e.offsetY:0,o=e.offsetZ!==void 0?e.offsetZ:0;b.onreadystatechange=function(){b.readyState==4?b.status==200||b.status==0?c.UTF8Loader.prototype.createModel(b.responseText,g,p,h,f,o):alert("Couldn't load ["+a+"] ["+b.status+"]"):b.readyState!=3&&b.readyState==2&&b.getResponseHeader("Content-Length")};b.open("GET",a,!0);b.send(null)};c.UTF8Loader.prototype.decompressMesh=function(a){var g=a.charCodeAt(0);g>=57344&&(g-=2048);g++;for(var e=new Float32Array(8*g),b=1,p=0;p<8;p++){for(var h=0,f=0;f<g;++f){var o=a.charCodeAt(f+b);h+=o>>1^-(o&1);e[8*f+p]=h}b+=g}g=a.length-b;h=new Uint16Array(g);for(p=f=0;p<g;p++){o=a.charCodeAt(p+b),h[p]=f-o,o==0&&f++}return[e,h]};c.UTF8Loader.prototype.createModel=function(g,b,a,m,f,e){var n=function(){var l=this;l.materials=[];c.Geometry.call(this);var h=c.UTF8Loader.prototype.decompressMesh(g),k=[],j=[];(function(A,z,q){for(var y,t,B,x=A.length;q<x;q+=z){y=A[q],t=A[q+1],B=A[q+2],y=y/16383*a,t=t/16383*a,B=B/16383*a,y+=m,t+=f,B+=e,l.vertices.push(new c.Vertex(new c.Vector3(y,t,B)))}})(h[0],8,0);(function(w,y,x){for(var z,u,v=w.length;x<v;x+=y){z=w[x],u=w[x+1],z/=1023,u/=1023,j.push(z,1-u)}})(h[0],8,3);(function(v,x,y){for(var A,w,z,B=v.length;y<B;y+=x){A=v[y],w=v[y+1],z=v[y+2],A=(A-512)/511,w=(w-512)/511,z=(z-512)/511,k.push(A,w,z)}})(h[0],8,5);(function(s){var u,v,y,E,J,S,U,R,w,T=s.length;for(u=0;u<T;u+=3){v=s[u];y=s[u+1];E=s[u+2];J=l;R=v;w=y;S=E;U=v;var B=y,V=E,W=J.materials[0],A=k[B*3],X=k[B*3+1],B=k[B*3+2],x=k[V*3],F=k[V*3+1],V=k[V*3+2];U=new c.Vector3(k[U*3],k[U*3+1],k[U*3+2]);B=new c.Vector3(A,X,B);V=new c.Vector3(x,F,V);J.faces.push(new c.Face3(R,w,S,[U,B,V],null,W));J=j[v*2];v=j[v*2+1];S=j[y*2];U=j[y*2+1];R=j[E*2];w=j[E*2+1];E=l.faceVertexUvs[0];y=S;S=U;U=[];U.push(new c.UV(J,v));U.push(new c.UV(y,S));U.push(new c.UV(R,w));E.push(U)}})(h[1]);this.computeCentroids();this.computeFaceNormals()};n.prototype=new c.Geometry;n.prototype.constructor=n;b(new n)};c.Axes=function(){c.Object3D.call(this);var f=new c.Geometry;f.vertices.push(new c.Vertex);f.vertices.push(new c.Vertex(new c.Vector3(0,100,0)));var b=new c.CylinderGeometry(0,5,25,5,1),a=new c.Line(f,new c.LineBasicMaterial({color:16711680}));a.rotation.z=-Math.PI/2;this.add(a);a=new c.Mesh(b,new c.MeshBasicMaterial({color:16711680}));a.position.x=100;a.rotation.z=-Math.PI/2;this.add(a);a=new c.Line(f,new c.LineBasicMaterial({color:65280}));this.add(a);a=new c.Mesh(b,new c.MeshBasicMaterial({color:65280}));a.position.y=100;this.add(a);a=new c.Line(f,new c.LineBasicMaterial({color:255}));a.rotation.x=Math.PI/2;this.add(a);a=new c.Mesh(b,new c.MeshBasicMaterial({color:255}));a.position.z=100;a.rotation.x=Math.PI/2;this.add(a)};c.Axes.prototype=new c.Object3D;c.Axes.prototype.constructor=c.Axes;c.MarchingCubes=function(b,a){c.Object3D.call(this);this.material=a;this.init=function(e){this.resolution=e;this.isolation=80;this.size=e;this.size2=this.size*this.size;this.size3=this.size2*this.size;this.halfsize=this.size/2;this.delta=2/this.size;this.yd=this.size;this.zd=this.size2;this.field=new Float32Array(this.size3);this.normal_cache=new Float32Array(this.size3*3);this.vlist=new Float32Array(36);this.nlist=new Float32Array(36);this.firstDraw=!0;this.maxCount=4096;this.count=0;this.hasNormal=this.hasPos=!1;this.positionArray=new Float32Array(this.maxCount*3);this.normalArray=new Float32Array(this.maxCount*3)};this.lerp=function(j,e,g){return j+(e-j)*g};this.VIntX=function(k,l,x,w,o,y,e,g,f,h){o=(o-f)/(h-f);f=this.normal_cache;l[w]=y+o*this.delta;l[w+1]=e;l[w+2]=g;x[w]=this.lerp(f[k],f[k+3],o);x[w+1]=this.lerp(f[k+1],f[k+4],o);x[w+2]=this.lerp(f[k+2],f[k+5],o)};this.VIntY=function(k,l,x,w,o,y,e,g,f,h){o=(o-f)/(h-f);f=this.normal_cache;l[w]=y;l[w+1]=e+o*this.delta;l[w+2]=g;l=k+this.yd*3;x[w]=this.lerp(f[k],f[l],o);x[w+1]=this.lerp(f[k+1],f[l+1],o);x[w+2]=this.lerp(f[k+2],f[l+2],o)};this.VIntZ=function(k,l,x,w,o,y,e,g,f,h){o=(o-f)/(h-f);f=this.normal_cache;l[w]=y;l[w+1]=e;l[w+2]=g+o*this.delta;l=k+this.zd*3;x[w]=this.lerp(f[k],f[l],o);x[w+1]=this.lerp(f[k+1],f[l+1],o);x[w+2]=this.lerp(f[k+2],f[l+2],o)};this.compNorm=function(h){var e=h*3;this.normal_cache[e]===0&&(this.normal_cache[e]=this.field[h-1]-this.field[h+1],this.normal_cache[e+1]=this.field[h-this.yd]-this.field[h+this.yd],this.normal_cache[e+2]=this.field[h-this.zd]-this.field[h+this.zd])};this.polygonize=function(ad,ae,g,f,e,h){var k=f+1,m=f+this.yd,l=f+this.zd,p=k+this.yd,q=k+this.zd,n=f+this.yd+this.zd,x=k+this.yd+this.zd,o=0,u=this.field[f],F=this.field[k],s=this.field[m],J=this.field[p],w=this.field[l],v=this.field[q],t=this.field[n],y=this.field[x];u<e&&(o|=1);F<e&&(o|=2);s<e&&(o|=8);J<e&&(o|=4);w<e&&(o|=16);v<e&&(o|=32);t<e&&(o|=128);y<e&&(o|=64);var B=c.edgeTable[o];if(B===0){return 0}var r=this.delta,ac=ad+r,A=ae+r,r=g+r;B&1&&(this.compNorm(f),this.compNorm(k),this.VIntX(f*3,this.vlist,this.nlist,0,e,ad,ae,g,u,F));B&2&&(this.compNorm(k),this.compNorm(p),this.VIntY(k*3,this.vlist,this.nlist,3,e,ac,ae,g,F,J));B&4&&(this.compNorm(m),this.compNorm(p),this.VIntX(m*3,this.vlist,this.nlist,6,e,ad,A,g,s,J));B&8&&(this.compNorm(f),this.compNorm(m),this.VIntY(f*3,this.vlist,this.nlist,9,e,ad,ae,g,u,s));B&16&&(this.compNorm(l),this.compNorm(q),this.VIntX(l*3,this.vlist,this.nlist,12,e,ad,ae,r,w,v));B&32&&(this.compNorm(q),this.compNorm(x),this.VIntY(q*3,this.vlist,this.nlist,15,e,ac,ae,r,v,y));B&64&&(this.compNorm(n),this.compNorm(x),this.VIntX(n*3,this.vlist,this.nlist,18,e,ad,A,r,t,y));B&128&&(this.compNorm(l),this.compNorm(n),this.VIntY(l*3,this.vlist,this.nlist,21,e,ad,ae,r,w,t));B&256&&(this.compNorm(f),this.compNorm(l),this.VIntZ(f*3,this.vlist,this.nlist,24,e,ad,ae,g,u,w));B&512&&(this.compNorm(k),this.compNorm(q),this.VIntZ(k*3,this.vlist,this.nlist,27,e,ac,ae,g,F,v));B&1024&&(this.compNorm(p),this.compNorm(x),this.VIntZ(p*3,this.vlist,this.nlist,30,e,ac,A,g,J,y));B&2048&&(this.compNorm(m),this.compNorm(n),this.VIntZ(m*3,this.vlist,this.nlist,33,e,ad,A,g,s,t));o<<=4;for(e=f=0;c.triTable[o+e]!=-1;){ad=o+e,ae=ad+1,g=ad+2,this.posnormtriv(this.vlist,this.nlist,3*c.triTable[ad],3*c.triTable[ae],3*c.triTable[g],h),e+=3,f++}return f};this.posnormtriv=function(g,h,q,e,r,s){var f=this.count*3;this.positionArray[f]=g[q];this.positionArray[f+1]=g[q+1];this.positionArray[f+2]=g[q+2];this.positionArray[f+3]=g[e];this.positionArray[f+4]=g[e+1];this.positionArray[f+5]=g[e+2];this.positionArray[f+6]=g[r];this.positionArray[f+7]=g[r+1];this.positionArray[f+8]=g[r+2];this.normalArray[f]=h[q];this.normalArray[f+1]=h[q+1];this.normalArray[f+2]=h[q+2];this.normalArray[f+3]=h[e];this.normalArray[f+4]=h[e+1];this.normalArray[f+5]=h[e+2];this.normalArray[f+6]=h[r];this.normalArray[f+7]=h[r+1];this.normalArray[f+8]=h[r+2];this.hasNormal=this.hasPos=!0;this.count+=3;this.count>=this.maxCount-3&&s(this)};this.begin=function(){this.count=0;this.hasNormal=this.hasPos=!1};this.end=function(h){if(this.count!==0){for(var e=this.count*3;e<this.positionArray.length;e++){this.positionArray[e]=0}h(this)}};this.addBall=function(e,g,r,o,l){var u=this.size*Math.sqrt(o/l),M=r*this.size,k=g*this.size,N=e*this.size,t=Math.floor(M-u);t<1&&(t=1);M=Math.floor(M+u);M>this.size-1&&(M=this.size-1);var h=Math.floor(k-u);h<1&&(h=1);k=Math.floor(k+u);k>this.size-1&&(k=this.size-1);var m=Math.floor(N-u);m<1&&(m=1);u=Math.floor(N+u);u>this.size-1&&(u=this.size-1);for(var q,p,n,w,O,f;t<M;t++){N=this.size2*t;p=t/this.size-r;O=p*p;for(p=h;p<k;p++){n=N+this.size*p;q=p/this.size-g;f=q*q;for(q=m;q<u;q++){w=q/this.size-e,w=o/(0.000001+w*w+f+O)-l,w>0&&(this.field[n+q]+=w)}}}};this.addPlaneX=function(p,A){var f,C,B,g,e,k=this.size,h=this.yd,m=this.zd,o=this.field,l=k*Math.sqrt(p/A);l>k&&(l=k);for(f=0;f<l;f++){if(C=f/k,C*=C,g=p/(0.0001+C)-A,g>0){for(C=0;C<k;C++){e=f+C*h;for(B=0;B<k;B++){o[m*B+e]+=g}}}}};this.addPlaneY=function(g,l){var C,r,p,D,E,e,h=this.size,f=this.yd,m=this.zd,k=this.field,o=h*Math.sqrt(g/l);o>h&&(o=h);for(r=0;r<o;r++){if(C=r/h,C*=C,D=g/(0.0001+C)-l,D>0){E=r*f;for(C=0;C<h;C++){e=E+C;for(p=0;p<h;p++){k[m*p+e]+=D}}}}};this.addPlaneZ=function(g,l){var C,r,p,D,E,e,h=this.size,f=this.yd,m=this.zd,k=this.field,o=h*Math.sqrt(g/l);o>h&&(o=h);for(p=0;p<o;p++){if(C=p/h,C*=C,D=g/(0.0001+C)-l,D>0){E=m*p;for(r=0;r<h;r++){e=E+r*f;for(C=0;C<h;C++){k[e+C]+=D}}}}};this.reset=function(){var e;for(e=0;e<this.size3;e++){this.normal_cache[e*3]=0,this.field[e]=0}};this.render=function(f){this.begin();var g,l,k,h,o,p,z,y,A,e=this.size-2;for(h=1;h<e;h++){A=this.size2*h;z=(h-this.halfsize)/this.halfsize;for(k=1;k<e;k++){y=A+this.size*k;p=(k-this.halfsize)/this.halfsize;for(l=1;l<e;l++){o=(l-this.halfsize)/this.halfsize,g=y+l,this.polygonize(o,p,z,g,this.isolation,f)}}}this.end(f)};this.generateGeometry=function(){var j=0,e=new c.Geometry,g=[];this.render(function(o){var m,p,v,f,w,k,l,h;for(m=0;m<o.count;m++){l=m*3,w=l+1,h=l+2,p=o.positionArray[l],v=o.positionArray[w],f=o.positionArray[h],k=new c.Vector3(p,v,f),p=o.normalArray[l],v=o.normalArray[w],f=o.normalArray[h],l=new c.Vector3(p,v,f),l.normalize(),w=new c.Vertex(k),e.vertices.push(w),g.push(l)}k=o.count/3;for(m=0;m<k;m++){l=(j+m)*3,w=l+1,h=l+2,p=g[l],v=g[w],f=g[h],l=new c.Face3(l,w,h,[p,v,f]),e.faces.push(l)}j+=k;o.count=0});return e};this.init(b)};c.MarchingCubes.prototype=new c.Object3D;c.MarchingCubes.prototype.constructor=c.MarchingCubes;c.edgeTable=new Int32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]);c.triTable=new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]);if(c.WebGLRenderer){c.AnaglyphWebGLRenderer=function(l){c.WebGLRenderer.call(this,l);this.autoUpdateScene=!1;var f=this,e=this.setSize,m=this.render,r=new c.PerspectiveCamera,o=new c.PerspectiveCamera,n=new c.Matrix4,E=new c.Matrix4,F,b,G,a;r.matrixAutoUpdate=o.matrixAutoUpdate=!1;var l={minFilter:c.LinearFilter,magFilter:c.NearestFilter,format:c.RGBAFormat},g=new c.WebGLRenderTarget(512,512,l),h=new c.WebGLRenderTarget(512,512,l),p=new c.PerspectiveCamera(53,1,1,10000);p.position.z=2;var l=new c.ShaderMaterial({uniforms:{mapLeft:{type:"t",value:0,texture:g},mapRight:{type:"t",value:1,texture:h}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D mapLeft;\nuniform sampler2D mapRight;\nvarying vec2 vUv;\nvoid main() {\nvec4 colorL, colorR;\nvec2 uv = vUv;\ncolorL = texture2D( mapLeft, uv );\ncolorR = texture2D( mapRight, uv );\ngl_FragColor = vec4( colorL.g * 0.7 + colorL.b * 0.3, colorR.g, colorR.b, colorL.a + colorR.a ) * 1.1;\n}"}),k=new c.Scene;k.add(new c.Mesh(new c.PlaneGeometry(2,2),l));k.add(p);this.setSize=function(j,q){e.call(f,j,q);g.width=j;g.height=q;h.width=j;h.height=q};this.render=function(s,v){s.updateMatrixWorld();if(F!==v.aspect||b!==v.near||G!==v.far||a!==v.fov){F=v.aspect;b=v.near;G=v.far;a=v.fov;var t=v.projectionMatrix.clone(),q=125/30*0.5,u=q*b/125,j=b*Math.tan(a*Math.PI/360),w;n.n14=q;E.n14=-q;q=-j*F+u;w=j*F+u;t.n11=2*b/(w-q);t.n13=(w+q)/(w-q);r.projectionMatrix.copy(t);q=-j*F-u;w=j*F-u;t.n11=2*b/(w-q);t.n13=(w+q)/(w-q);o.projectionMatrix.copy(t)}r.matrixWorld.copy(v.matrixWorld).multiplySelf(E);r.position.copy(v.position);r.near=v.near;r.far=v.far;m.call(f,s,r,g,!0);o.matrixWorld.copy(v.matrixWorld).multiplySelf(n);o.position.copy(v.position);o.near=v.near;o.far=v.far;m.call(f,s,o,h,!0);k.updateMatrixWorld();m.call(f,k,p)}}}if(c.WebGLRenderer){c.CrosseyedWebGLRenderer=function(a){c.WebGLRenderer.call(this,a);this.autoClear=!1;var g=this,e=this.setSize,b=this.render,p,h,f=new c.PerspectiveCamera;f.target=new c.Vector3(0,0,0);var o=new c.PerspectiveCamera;o.target=new c.Vector3(0,0,0);g.separation=10;if(a&&a.separation!==void 0){g.separation=a.separation}this.setSize=function(k,j){e.call(g,k,j);p=k/2;h=j};this.render=function(j,k){this.clear();f.fov=k.fov;f.aspect=0.5*k.aspect;f.near=k.near;f.far=k.far;f.updateProjectionMatrix();f.position.copy(k.position);f.target.copy(k.target);f.translateX(g.separation);f.lookAt(f.target);o.projectionMatrix=f.projectionMatrix;o.position.copy(k.position);o.target.copy(k.target);o.translateX(-g.separation);o.lookAt(o.target);this.setViewport(0,0,p,h);b.call(g,j,f);this.setViewport(p,0,p,h);b.call(g,j,o,!1)}}}return c});define("lib/requestAnimationFrame",[],function(){var f=null;var e=["ms","moz","webkit","o"];for(var h=0;h<e.length&&!f;++h){f=window[e[h]+"RequestAnimationFrame"]}var g=0;if(!f){f=function(d,b){var c=new Date().getTime(),a=Math.max(0,16-(c-g)),j=window.setTimeout(function(){d(c+a)},a);g=c+a;return j}}return f});define("lib/cancelAnimationFrame",[],function(){var f=null;var e=["ms","moz","webkit","o"];for(var h=0;h<e.length&&!f;++h){f=window[e[h]+"CancelAnimationFrame"]||window[e[h]+"CancelRequestAnimationFrame"]}var g=0;if(!f){f=function(a){clearTimeout(a)}}return f});define("animator",["jquery","lib/Three","lib/requestAnimationFrame","lib/cancelAnimationFrame"],function(l,h,g,k){var j=function(a){this.opts=l.extend(true,{},j.opts,a);this._isRunning=false;this._actors=[];this._setupScene()};j.opts={mediator:null,container:"body",width:window.innerWidth,height:window.innerHeight,camera:{fov:75,aspect:window.innerWidth/window.innerHeight,near:1,far:10000,pos:[0,0,0]}};var m=j.prototype;m.start=function(){this._isRunning=true;this._render()};m.stop=function(){this._isRunning=false;k(this._timer)};m.isAnimated=function(){return this._isRunning==true};m.addActors=function(b){for(var c=0,a=b.length;c<a;++c){this._actors.push(b[c])}};m.getIntersects=function(d){var a=(d.clientX/this.opts.width)*2-1,c=-(d.clientY/this.opts.height)*2+1,e=new h.Vector3(a,c,0.5),b,n,f=null;this.projector.unprojectVector(e,this.camera);b=new h.Ray(this.camera.position,e.subSelf(this.camera.position).normalize());n=b.intersectObjects(this.scene.objects);return n};m._update=function(){var e=Object.prototype.hasOwnProperty,b=this.opts,a=b.mediator,c=this._actors;for(var d in c){if(e.call(c,d)){c[d]&&c[d].update&&c[d].update()}}a&&a.publish&&a.publish("actorsUpdated",this._timer)};m._render=function(){if(this._isRunning){var a=this;this._timer=g(function(b){a._render()});this._update();this.renderer.render(this.scene,this.camera)}};m._setupScene=function(){var a=this.opts;this.scene=new h.Scene();this.camera=new h.PerspectiveCamera(a.camera.fov,a.camera.aspect,a.camera.near,a.camera.far);this.camera.position=new h.Vector3(a.camera.pos[0],a.camera.pos[1],a.camera.pos[2]);this.scene.add(this.camera);this.renderer=new h.CanvasRenderer();this.renderer.setSize(a.width,a.height);l(this.opts.container).append(this.renderer.domElement);this.projector=new h.Projector()};return j});define("cube",["lib/Three"],function(d){function c(a){a=a||{};this._init(a);this.speedX=0;this.speedY=0;this.speedZ=0;this.rotX=a.rotSpeed[0]||0;this.rotY=a.rotSpeed[1]||0;this.rotZ=a.rotSpeed[2]||0;this.farestDist=0;this.nearestDist=0;this.arrviedEnd="none";this._isAnimated=true}c.prototype.start=function(){this._isAnimated=true};c.prototype.stop=function(){this._isAnimated=false};c.prototype.move=function(a){var b=a.speed;this.speedX=b[0];this.speedY=b[1];this.speedZ=b[2];this.nearestDist=a.near;this.farestDist=a.far};c.prototype.update=function(){if(this._isAnimated){var a=this.mesh;a.rotation.y+=this.rotY;a.rotation.x+=this.rotX;a.rotation.z+=this.rotZ;if(a.position.z<this.nearestDist||a.position.z>this.farestDist){a.position.z+=this.speedZ;a.position.x+=this.speedX;a.position.y+=this.speedY}else{if(a.position.z>=this.nearestDist){this.arrivedEnd="near"}if(a.position.z<=this.farestDist){this.arrviedEnd="far"}}}};c.prototype._init=function(p){var r=[],t,u=p.pos||[],q=p.size||200,a=p.scene,s=p.textures||[];for(var b=0;b<6;b++){var o,v=s[b],w;if(v){w=new d.MeshBasicMaterial({map:d.ImageUtils.loadTexture(v)})}else{w=new d.MeshBasicMaterial({color:Math.random()*16777215})}r.push(w)}t=new d.CubeGeometry(q,q,q,1,1,1,r);this.mesh=new d.Mesh(t,new d.MeshFaceMaterial());this.mesh.position.x=u[0]||0;this.mesh.position.y=u[1]||0;this.mesh.position.z=u[2]||0;this.mesh.overdraw=true;a&&a.add&&a.add(this.mesh)};return c});define("textParticle",["lib/Three"],function(d){var f=function(){var t=new d.Vector3(),q,r=600,p=700,n=200,o,s=160,b=4,a=0.01,c=false;this.position=new d.Vector3();this.velocity=new d.Vector3();q=new d.Vector3();this.setGoal=function(g){o=g};this.setAvoidWalls=function(g){c=g};this.setWorldSize=function(h,j,g){r=h;p=j;t;n=g};this.run=function(g){if(c){t.set(-r,this.position.y,this.position.z);t=this.avoid(t);t.multiplyScalar(5);q.addSelf(t);t.set(r,this.position.y,this.position.z);t=this.avoid(t);t.multiplyScalar(5);q.addSelf(t);t.set(this.position.x,-p,this.position.z);t=this.avoid(t);t.multiplyScalar(5);q.addSelf(t);t.set(this.position.x,p,this.position.z);t=this.avoid(t);t.multiplyScalar(5);q.addSelf(t);t.set(this.position.x,this.position.y,-n);t=this.avoid(t);t.multiplyScalar(5);q.addSelf(t);t.set(this.position.x,this.position.y,n);t=this.avoid(t);t.multiplyScalar(5);q.addSelf(t)}if(Math.random()>0.5){this.flock(g)}this.move()};this.flock=function(g){if(o){q.addSelf(this.reach(o,0.005))}q.addSelf(this.alignment(g));q.addSelf(this.cohesion(g));q.addSelf(this.separation(g))};this.move=function(){this.velocity.addSelf(q);var g=this.velocity.length();if(g>b){this.velocity.divideScalar(g/b)}this.position.addSelf(this.velocity);q.set(0,0,0)};this.checkBounds=function(){if(this.position.x>r){this.position.x=-r}if(this.position.x<-r){this.position.x=r}if(this.position.y>p){this.position.y=-p}if(this.position.y<-p){this.position.y=p}if(this.position.z>n){this.position.z=-n}if(this.position.z<-n){this.position.z=n}};this.avoid=function(g){var h=new d.Vector3();h.copy(this.position);h.subSelf(g);h.multiplyScalar(1/this.position.distanceToSquared(g));return h};this.repulse=function(h){var g=this.position.distanceTo(h);if(g<250){var j=new d.Vector3();j.sub(this.position,h);j.multiplyScalar(0.5/g);q.addSelf(j)}};this.reach=function(g,h){var j=new d.Vector3();j.sub(g,this.position);j.multiplyScalar(h);return j};this.alignment=function(h){var g,l=new d.Vector3(),j=0;for(var k=0,m=h.length;k<m;k++){if(Math.random()>0.6){continue}g=h[k];distance=g.position.distanceTo(this.position);if(distance>0&&distance<=s){l.addSelf(g.velocity);j++}}if(j>0){l.divideScalar(j);var u=l.length();if(u>a){l.divideScalar(u/a)}}return l};this.cohesion=function(x){var l,j,g=new d.Vector3(),m=new d.Vector3(),w=0;for(var y=0,k=x.length;y<k;y++){if(Math.random()>0.6){continue}l=x[y];j=l.position.distanceTo(this.position);if(j>0&&j<=s){g.addSelf(l.position);w++}}if(w>0){g.divideScalar(w)}m.sub(g,this.position);var h=m.length();if(h>a){m.divideScalar(h/a)}return m};this.separation=function(k){var h,g,m=new d.Vector3(),j=new d.Vector3();for(var l=0,u=k.length;l<u;l++){if(Math.random()>0.6){continue}h=k[l];g=h.position.distanceTo(this.position);if(g>0&&g<=s){j.sub(this.position,h.position);j.normalize();j.divideScalar(g);m.addSelf(j)}}return m}};function e(a){a=a||{};this._init(a)}e.prototype.update=function(){var a=Math.random(),c=0,k,m;if(a>=0.55){c=0.002}for(var b=0,l=this.particles.length;b<l;b++){k=this.boids[b];k.run(this.boids);m=this.particles[b];c&&(m.material.opacity-=c);if(m.material.opacity<0){m.material.opacity=1}k&&k.repulse(new d.Vector3(-20,-20,0))}};e.prototype._init=function(s){var p=s.amount||26,a=s.textures||[],c=s.opacitys||[],q=s.scene,b;this.particles=[];this.boids=[];for(var r=0;r<p;r++){b=this.boids[r]=new f();b.position.x=Math.random()*300-200;b.position.y=Math.random()*400-200;b.position.z=Math.random()*400-200;b.velocity.x=Math.random()*2-1.5;b.velocity.y=Math.random()*2-1.5;b.velocity.z=Math.random()*2-1.5;b.setAvoidWalls(true);b.setWorldSize(800,400,900);var o=c[r]||(0.1+Math.random()*0.9),n=a[r]||"textures/h.jpg";this.particles[r]=new d.Particle(new d.ParticleBasicMaterial({map:d.ImageUtils.loadTexture(n),opacity:o}));this.particles[r].position=this.boids[r].position;this.particles[r].doubleSided=true;q&&q.add&&q.add(this.particles[r])}};return e});define("widget",["jquery"],function(k){var g=function(a){this.opts=k.extend({},g.opts,a);this.widget=k("<div>").addClass(this.opts.cls)};g.prototype.update=function(a){a.header&&this.hd.html(a.header);a.body&&this.bd.html(a.body)};g.prototype.render=function(b){b=b||{};var c=b.header||this.opts.header||k("<div/>"),a=b.body||this.opts.body||k("<div/>");this.hd=c.addClass(this.opts.cls+"-hd");this.bd=a.addClass(this.opts.cls+"-bd");this.widget.html("");this.widget.append(this.hd).append(this.bd).appendTo(this.opts.container);return this.widget};g.opts={cls:"",header:null,body:null,container:"body"};var j=function(a){this.opts=k.extend({},j.opts,a)};j.prototype.render=function(d){var b=d.style||{},a=d.data||{},c=d.to||this.opts.container;this.tip&&this.tip.remove();this.tip=k("<div>").addClass(this.opts.cls);this.tip.html(k.tmpl.object(this.opts.tmpl,a)).css(b).hide().appendTo(c).fadeIn(200);return this.tip};j.prototype.unrender=function(){this.tip&&this.tip.remove()};j.opts={cls:"",tmpl:"",container:"body"};var h=function(a){this.opts=k.extend({},h.opts,a)};h.prototype.render=function(b){b=b||{};var a='<li data-index="{index}">'+this.opts.tmpl+"</li>",c=k("<ul/>").attr("id",this.opts._id).addClass(this.opts.cls);c.html("").html(k.tmpl["for"](a,b));return k("<div/>").append(c)};h.prototype.slideTo=function(s,c){var q={},r=k("#"+this.opts._id),d=r.children(),t=d.length,e,v,u=15,b,a;k.each(c,function(l,m){q[l]=""});e=k(d[s-1]);d.css(q);b=r.height();a=r[0].scrollHeight;v=a/t*(s-1)-b/2-u;r.animate({scrollTop:v},10,function(){e.css(c)})};h.opts={cls:"",tmpl:"",_id:"J-WList"};var f={};f.Base=g;f.Tip=j;f.List=h;return f});(function(b){if(typeof b.tmpl==="undefined"){b.tmpl={};b.tmpl.object=function(f,h){var g="",a=/\{(\w+)\}/g;g=f.replace(a,function(d,c){return h[c]});return g};b.tmpl["for"]=function(h,k){var j=[];for(var m=0,a=k.length;m<a;++m){var l=k[m];l.index||(l.index=m);j.push(b.tmpl.object(h,l))}return j.join("")}}})(jQuery);define("lib/jquery.template",function(){});(function(){var p=typeof document!=="undefined"&&typeof window!=="undefined"&&document.createElement("script"),n=p&&(p.async||((window.opera&&Object.prototype.toString.call(window.opera)==="[object Opera]")||("MozAppearance" in document.documentElement.style))),o=p&&p.readyState==="uninitialized",r=/^(complete|loaded)$/,q=[],s={},t={},k=[];p=null;function m(d){var a=d.currentTarget||d.srcElement,b,c,e;if(d.type==="load"||r.test(a.readyState)){c=a.getAttribute("data-requiremodule");s[c]=true;for(b=0;(e=q[b]);b++){if(s[e.name]){e.req([e.name],e.onLoad)}else{break}}if(b>0){q.splice(0,b)}setTimeout(function(){a.parentNode.removeChild(a)},15)}}function l(a){var b,c,d;a.setAttribute("data-orderloaded","loaded");for(b=0;(d=k[b]);b++){c=t[d];if(c&&c.getAttribute("data-orderloaded")==="loaded"){delete t[d];require.addScriptToDom(c)}else{break}}if(b>0){k.splice(0,b)}}define("order",{version:"1.0.5",load:function(b,f,h,c){var e=!!f.nameToUrl,d,g,a;if(!e){f([b],h);return}d=f.nameToUrl(b,null);require.s.skipAsync[d]=true;if(n||c.isBuild){f([b],h)}else{if(o){a=require.s.contexts._;if(!a.urlFetched[d]&&!a.loaded[b]){a.urlFetched[d]=true;require.resourcesReady(false);a.scriptCount+=1;g=require.attach(d,a,b,null,null,l);t[b]=g;k.push(b)}f([b],h)}else{if(f.specified(b)){f([b],h)}else{q.push({name:b,req:f,onLoad:h});require.attach(d,null,b,m,"script/cache")}}}}})}());(function(c){c.color={};c.color.make=function(b,a,j,k){var h={};h.r=b||0;h.g=a||0;h.b=j||0;h.a=k!=null?k:1;h.add=function(g,f){for(var e=0;e<g.length;++e){h[g.charAt(e)]+=f}return h.normalize()};h.scale=function(g,f){for(var e=0;e<g.length;++e){h[g.charAt(e)]*=f}return h.normalize()};h.toString=function(){if(h.a>=1){return"rgb("+[h.r,h.g,h.b].join(",")+")"}else{return"rgba("+[h.r,h.g,h.b,h.a].join(",")+")"}};h.normalize=function(){function e(g,m,f){return m<g?g:(m>f?f:m)}h.r=e(0,parseInt(h.r),255);h.g=e(0,parseInt(h.g),255);h.b=e(0,parseInt(h.b),255);h.a=e(0,h.a,1);return h};h.clone=function(){return c.color.make(h.r,h.b,h.g,h.a)};return h.normalize()};c.color.extract=function(f,b){var a;do{a=f.css(b).toLowerCase();if(a!=""&&a!="transparent"){break}f=f.parent()}while(!c.nodeName(f.get(0),"body"));if(a=="rgba(0, 0, 0, 0)"){a="transparent"}return c.color.parse(a)};c.color.parse=function(b){var a,g=c.color.make;if(a=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(b)){return g(parseInt(a[1],10),parseInt(a[2],10),parseInt(a[3],10))}if(a=/rgba\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]+(?:\.[0-9]+)?)\s*\)/.exec(b)){return g(parseInt(a[1],10),parseInt(a[2],10),parseInt(a[3],10),parseFloat(a[4]))}if(a=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(b)){return g(parseFloat(a[1])*2.55,parseFloat(a[2])*2.55,parseFloat(a[3])*2.55)}if(a=/rgba\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\s*\)/.exec(b)){return g(parseFloat(a[1])*2.55,parseFloat(a[2])*2.55,parseFloat(a[3])*2.55,parseFloat(a[4]))}if(a=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(b)){return g(parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16))}if(a=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(b)){return g(parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16),parseInt(a[3]+a[3],16))}var h=c.trim(b).toLowerCase();if(h=="transparent"){return g(255,255,255,0)}else{a=d[h]||[0,0,0];return g(a[0],a[1],a[2])}};var d={aqua:[0,255,255],azure:[240,255,255],beige:[245,245,220],black:[0,0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgrey:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkviolet:[148,0,211],fuchsia:[255,0,255],gold:[255,215,0],green:[0,128,0],indigo:[75,0,130],khaki:[240,230,140],lightblue:[173,216,230],lightcyan:[224,255,255],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightyellow:[255,255,224],lime:[0,255,0],magenta:[255,0,255],maroon:[128,0,0],navy:[0,0,128],olive:[128,128,0],orange:[255,165,0],pink:[255,192,203],purple:[128,0,128],violet:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0]}})(jQuery);(function(e){function f(b,a1,bk,a4){var bf=[],bj={colors:["#edc240","#afd8f8","#cb4b4b","#4da74d","#9440ed"],legend:{show:true,noColumns:1,labelFormatter:null,labelBoxBorderColor:"#ccc",container:null,position:"ne",margin:5,backgroundColor:null,backgroundOpacity:0.85},xaxis:{show:null,position:"bottom",mode:null,font:null,color:null,tickColor:null,transform:null,inverseTransform:null,min:null,max:null,autoscaleMargin:null,ticks:null,tickFormatter:null,labelWidth:null,labelHeight:null,reserveSpace:null,tickLength:null,alignTicksWithAxis:null,tickDecimals:null,tickSize:null,minTickSize:null,monthNames:null,timeformat:null,twelveHourClock:false},yaxis:{autoscaleMargin:0.02,position:"left"},xaxes:[],yaxes:[],series:{points:{show:false,radius:3,lineWidth:2,fill:true,fillColor:"#ffffff",symbol:"circle"},lines:{lineWidth:2,fill:false,fillColor:null,steps:false},bars:{show:false,lineWidth:2,barWidth:1,fill:true,fillColor:null,align:"left",horizontal:false},shadowSize:3},grid:{show:true,aboveData:false,color:"#545454",backgroundColor:null,borderColor:null,tickColor:null,labelMargin:5,axisMargin:8,borderWidth:2,minBorderMargin:null,markings:null,markingsColor:"#f4f4f4",markingsLineWidth:2,clickable:false,hoverable:false,autoHighlight:true,mouseActiveRadius:10},interaction:{redrawOverlayInterval:1000/60},hooks:{}},bc=null,a6=null,aO=null,bq=null,aK=null,bA=[],br=[],bz={left:0,right:0,top:0,bottom:0},a=0,bm=0,bG=0,bt=0,aS={processOptions:[],processRawData:[],processDatapoints:[],drawSeries:[],draw:[],bindEvents:[],drawOverlay:[],shutdown:[]},aJ=this;aJ.setData=aT;aJ.setupGrid=bw;aJ.draw=aY;aJ.getPlaceholder=function(){return b};aJ.getCanvas=function(){return bc};aJ.getPlotOffset=function(){return bz};aJ.width=function(){return bG};aJ.height=function(){return bt};aJ.offset=function(){var g=aO.offset();g.left+=bz.left;g.top+=bz.top;return g};aJ.getData=function(){return bf};aJ.getAxes=function(){var g={},h;e.each(bA.concat(br),function(k,j){if(j){g[j.direction+(j.n!=1?j.n:"")+"axis"]=j}});return g};aJ.getXAxes=function(){return bA};aJ.getYAxes=function(){return br};aJ.c2p=aH;aJ.p2c=aG;aJ.getOptions=function(){return bj};aJ.highlight=bs;aJ.unhighlight=aU;aJ.triggerRedrawOverlay=bI;aJ.pointOffset=function(g){return{left:parseInt(bA[bb(g,"x")-1].p2c(+g.x)+bz.left),top:parseInt(br[bb(g,"y")-1].p2c(+g.y)+bz.top)}};aJ.shutdown=a3;aJ.resize=function(){aI();bH(bc);bH(a6)};aJ.hooks=aS;c(aJ);ba(bk);aX();aT(a1);bw();aY();a2();function aP(g,j){j=[aJ].concat(j);for(var h=0;h<g.length;++h){g[h].apply(this,j)}}function c(){for(var h=0;h<a4.length;++h){var g=a4[h];g.init(aJ);if(g.options){e.extend(true,bj,g.options)}}}function ba(h){var j;e.extend(true,bj,h);if(bj.xaxis.color==null){bj.xaxis.color=bj.grid.color}if(bj.yaxis.color==null){bj.yaxis.color=bj.grid.color}if(bj.xaxis.tickColor==null){bj.xaxis.tickColor=bj.grid.tickColor}if(bj.yaxis.tickColor==null){bj.yaxis.tickColor=bj.grid.tickColor}if(bj.grid.borderColor==null){bj.grid.borderColor=bj.grid.color}if(bj.grid.tickColor==null){bj.grid.tickColor=e.color.parse(bj.grid.color).scale("a",0.22).toString()}for(j=0;j<Math.max(1,bj.xaxes.length);++j){bj.xaxes[j]=e.extend(true,{},bj.xaxis,bj.xaxes[j])}for(j=0;j<Math.max(1,bj.yaxes.length);++j){bj.yaxes[j]=e.extend(true,{},bj.yaxis,bj.yaxes[j])}if(bj.xaxis.noTicks&&bj.xaxis.ticks==null){bj.xaxis.ticks=bj.xaxis.noTicks}if(bj.yaxis.noTicks&&bj.yaxis.ticks==null){bj.yaxis.ticks=bj.yaxis.noTicks}if(bj.x2axis){bj.xaxes[1]=e.extend(true,{},bj.xaxis,bj.x2axis);bj.xaxes[1].position="top"}if(bj.y2axis){bj.yaxes[1]=e.extend(true,{},bj.yaxis,bj.y2axis);bj.yaxes[1].position="right"}if(bj.grid.coloredAreas){bj.grid.markings=bj.grid.coloredAreas}if(bj.grid.coloredAreasColor){bj.grid.markingsColor=bj.grid.coloredAreasColor}if(bj.lines){e.extend(true,bj.series.lines,bj.lines)}if(bj.points){e.extend(true,bj.series.points,bj.points)}if(bj.bars){e.extend(true,bj.series.bars,bj.bars)}if(bj.shadowSize!=null){bj.series.shadowSize=bj.shadowSize}for(j=0;j<bj.xaxes.length;++j){aZ(bA,j+1).options=bj.xaxes[j]}for(j=0;j<bj.yaxes.length;++j){aZ(br,j+1).options=bj.yaxes[j]}for(var g in aS){if(bj.hooks[g]&&bj.hooks[g].length){aS[g]=aS[g].concat(bj.hooks[g])}}aP(aS.processOptions,[bj])}function aT(g){bf=aW(g);bo();aM()}function aW(g){var j=[];for(var k=0;k<g.length;++k){var h=e.extend(true,{},bj.series);if(g[k].data!=null){h.data=g[k].data;delete g[k].data;e.extend(true,h,g[k]);g[k].data=h.data}else{h.data=g[k]}j.push(h)}return j}function bb(h,g){var j=h[g+"axis"];if(typeof j=="object"){j=j.n}if(typeof j!="number"){j=1}return j}function bD(){return e.grep(bA.concat(br),function(g){return g})}function aH(g){var j={},k,h;for(k=0;k<bA.length;++k){h=bA[k];if(h&&h.used){j["x"+h.n]=h.c2p(g.left)}}for(k=0;k<br.length;++k){h=br[k];if(h&&h.used){j["y"+h.n]=h.c2p(g.top)}}if(j.x1!==undefined){j.x=j.x1}if(j.y1!==undefined){j.y=j.y1}return j}function aG(g){var j={},k,h,l;for(k=0;k<bA.length;++k){h=bA[k];if(h&&h.used){l="x"+h.n;if(g[l]==null&&h.n==1){l="x"}if(g[l]!=null){j.left=h.p2c(g[l]);break}}}for(k=0;k<br.length;++k){h=br[k];if(h&&h.used){l="y"+h.n;if(g[l]==null&&h.n==1){l="y"}if(g[l]!=null){j.top=h.p2c(g[l]);break}}}return j}function aZ(g,h){if(!g[h-1]){g[h-1]={n:h,direction:g==bA?"x":"y",options:e.extend(true,{},g==bA?bj.xaxis:bj.yaxis)}}return g[h-1]}function bo(){var t;var n=bf.length,l=[],h=[];for(t=0;t<bf.length;++t){var q=bf[t].color;if(q!=null){--n;if(typeof q=="number"){h.push(q)}else{l.push(e.color.parse(bf[t].color))}}}for(t=0;t<h.length;++t){n=Math.max(n,h[t]+1)}var k=[],g=0;t=0;while(k.length<n){var r;if(bj.colors.length==t){r=e.color.make(100,100,100)}else{r=e.color.parse(bj.colors[t])}var j=g%2==1?-1:1;r.scale("rgb",1+j*Math.ceil(g/2)*0.2);k.push(r);++t;if(t>=bj.colors.length){t=0;++g}}var s=0,m;for(t=0;t<bf.length;++t){m=bf[t];if(m.color==null){m.color=k[s].toString();++s}else{if(typeof m.color=="number"){m.color=k[m.color].toString()}}if(m.lines.show==null){var o,p=true;for(o in m){if(m[o]&&m[o].show){p=false;break}}if(p){m.lines.show=true}}m.xaxis=aZ(bA,bb(m,"x"));m.yaxis=aZ(br,bb(m,"y"))}}function aM(){var r=Number.POSITIVE_INFINITY,C=Number.NEGATIVE_INFINITY,v=Number.MAX_VALUE,j,l,m,u,s,B,k,p,D,E,t,y,G,x;function n(J,H,I){if(H<J.datamin&&H!=-v){J.datamin=H}if(I>J.datamax&&I!=v){J.datamax=I}}e.each(bD(),function(I,H){H.datamin=r;H.datamax=C;H.used=false});for(j=0;j<bf.length;++j){B=bf[j];B.datapoints={points:[]};aP(aS.processRawData,[B,B.data,B.datapoints])}for(j=0;j<bf.length;++j){B=bf[j];var z=B.data,g=B.datapoints.format;if(!g){g=[];g.push({x:true,number:true,required:true});g.push({y:true,number:true,required:true});if(B.bars.show||(B.lines.show&&B.lines.fill)){g.push({y:true,number:true,required:false,defaultValue:0});if(B.bars.horizontal){delete g[g.length-1].y;g[g.length-1].x=true}}B.datapoints.format=g}if(B.datapoints.pointsize!=null){continue}B.datapoints.pointsize=g.length;p=B.datapoints.pointsize;k=B.datapoints.points;insertSteps=B.lines.show&&B.lines.steps;B.xaxis.used=B.yaxis.used=true;for(l=m=0;l<z.length;++l,m+=p){x=z[l];var q=x==null;if(!q){for(u=0;u<p;++u){y=x[u];G=g[u];if(G){if(G.number&&y!=null){y=+y;if(isNaN(y)){y=null}else{if(y==Infinity){y=v}else{if(y==-Infinity){y=-v}}}}if(y==null){if(G.required){q=true}if(G.defaultValue!=null){y=G.defaultValue}}}k[m+u]=y}}if(q){for(u=0;u<p;++u){y=k[m+u];if(y!=null){G=g[u];if(G.x){n(B.xaxis,y,y)}if(G.y){n(B.yaxis,y,y)}}k[m+u]=null}}else{if(insertSteps&&m>0&&k[m-p]!=null&&k[m-p]!=k[m]&&k[m-p+1]!=k[m+1]){for(u=0;u<p;++u){k[m+p+u]=k[m+u]}k[m+1]=k[m-p+1];m+=p}}}}for(j=0;j<bf.length;++j){B=bf[j];aP(aS.processDatapoints,[B,B.datapoints])}for(j=0;j<bf.length;++j){B=bf[j];k=B.datapoints.points,p=B.datapoints.pointsize;g=B.datapoints.format;var A=r,o=r,w=C,h=C;for(l=0;l<k.length;l+=p){if(k[l]==null){continue}for(u=0;u<p;++u){y=k[l+u];G=g[u];if(!G||y==v||y==-v){continue}if(G.x){if(y<A){A=y}if(y>w){w=y}}if(G.y){if(y<o){o=y}if(y>h){h=y}}}}if(B.bars.show){var F=B.bars.align=="left"?0:-B.bars.barWidth/2;if(B.bars.horizontal){o+=F;h+=F+B.bars.barWidth}else{A+=F;w+=F+B.bars.barWidth}}n(B.xaxis,A,w);n(B.yaxis,o,h)}e.each(bD(),function(I,H){if(H.datamin==r){H.datamin=null}if(H.datamax==C){H.datamax=null}})}function bF(j,h){var g=document.createElement("canvas");g.className=h;g.width=a;g.height=bm;if(!j){e(g).css({position:"absolute",left:0,top:0})}e(g).appendTo(b);if(!g.getContext){g=window.G_vmlCanvasManager.initElement(g)}g.getContext("2d").save();return g}function aI(){a=b.width();bm=b.height();if(a<=0||bm<=0){throw"Invalid dimensions for plot, width = "+a+", height = "+bm}}function bH(g){if(g.width!=a){g.width=a}if(g.height!=bm){g.height=bm}var h=g.getContext("2d");h.restore();h.save()}function aX(){var h,j=b.children("canvas.flot-base"),g=b.children("canvas.flot-overlay");if(j.length==0||g==0){b.html("");b.css({padding:0});if(b.css("position")=="static"){b.css("position","relative")}aI();bc=bF(true,"flot-base");a6=bF(false,"flot-overlay");h=false}else{bc=j.get(0);a6=g.get(0);h=true}bq=bc.getContext("2d");aK=a6.getContext("2d");aO=e(a6);if(h){b.data("plot").shutdown();aJ.resize();aK.clearRect(0,0,a,bm);aO.unbind();b.children().not([bc,a6]).remove()}b.data("plot",aJ)}function a2(){if(bj.grid.hoverable){aO.mousemove(a9);aO.mouseleave(bE)}if(bj.grid.clickable){aO.click(bd)}aP(aS.bindEvents,[aO])}function a3(){if(bp){clearTimeout(bp)}aO.unbind("mousemove",a9);aO.unbind("mouseleave",bE);aO.unbind("click",bd);aP(aS.shutdown,[aO])}function by(g){function l(n){return n}var h,m,k=g.options.transform||l,j=g.options.inverseTransform;if(g.direction=="x"){h=g.scale=bG/Math.abs(k(g.max)-k(g.min));m=Math.min(k(g.max),k(g.min))}else{h=g.scale=bt/Math.abs(k(g.max)-k(g.min));h=-h;m=Math.max(k(g.max),k(g.min))}if(k==l){g.p2c=function(n){return(n-m)*h}}else{g.p2c=function(n){return(k(n)-m)*h}}if(!j){g.c2p=function(n){return m+n/h}}else{g.c2p=function(n){return j(m+n/h)}}}function be(j){var l=j.options,q=j.ticks||[],p=l.labelWidth||0,r=l.labelHeight||0,s=j.font;bq.save();bq.font=s.style+" "+s.variant+" "+s.weight+" "+s.size+"px '"+s.family+"'";for(var g=0;g<q.length;++g){var o=q[g];o.lines=[];o.width=o.height=0;if(!o.label){continue}var m=o.label.replace(/<br ?\/?>|\r\n|\r/g,"\n").split("\n");for(var h=0;h<m.length;++h){var n={text:m[h]},k=bq.measureText(n.text);n.width=k.width;n.height=k.height!=null?k.height:s.size;n.height+=Math.round(s.size*0.15);o.width=Math.max(n.width,o.width);o.height+=n.height;o.lines.push(n)}if(l.labelWidth==null){p=Math.max(p,o.width)}if(l.labelHeight==null){r=Math.max(r,o.height)}}bq.restore();j.labelWidth=Math.ceil(p);j.labelHeight=Math.ceil(r)}function aC(j){var k=j.labelWidth,n=j.labelHeight,r=j.options.position,g=j.options.tickLength,s=bj.grid.axisMargin,p=bj.grid.labelMargin,o=j.direction=="x"?bA:br,h;var l=e.grep(o,function(t){return t&&t.options.position==r&&t.reserveSpace});if(e.inArray(j,l)==l.length-1){s=0}if(g==null){var q=e.grep(o,function(t){return t&&t.reserveSpace});var m=e.inArray(j,q)==0;if(m){g="full"}else{g=5}}if(!isNaN(+g)){p+=+g}if(j.direction=="x"){n+=p;if(r=="bottom"){bz.bottom+=n+s;j.box={top:bm-bz.bottom,height:n}}else{j.box={top:bz.top+s,height:n};bz.top+=n+s}}else{k+=p;if(r=="left"){j.box={left:bz.left+s,width:k};bz.left+=k+s}else{bz.right+=k+s;j.box={left:a-bz.right,width:k}}}j.position=r;j.tickLength=g;j.box.padding=p;j.innermost=m}function a0(g){if(g.direction=="x"){g.box.left=bz.left-g.labelWidth/2;g.box.width=a-bz.left-bz.right+g.labelWidth}else{g.box.top=bz.top-g.labelHeight/2;g.box.height=bm-bz.bottom-bz.top+g.labelHeight}}function bn(){var h=bj.grid.minBorderMargin,g={x:0,y:0},k,j;if(h==null){h=0;for(k=0;k<bf.length;++k){h=Math.max(h,2*(bf[k].points.radius+bf[k].points.lineWidth/2))}}g.x=g.y=Math.ceil(h);e.each(bD(),function(l,n){var m=n.direction;if(n.reserveSpace){g[m]=Math.ceil(Math.max(g[m],(m=="x"?n.labelWidth:n.labelHeight)/2))}});bz.left=Math.max(g.x,bz.left);bz.right=Math.max(g.x,bz.right);bz.top=Math.max(g.y,bz.top);bz.bottom=Math.max(g.y,bz.bottom)}function bw(){var k,h=bD(),g=bj.grid.show;for(var l in bz){bz[l]=g?bj.grid.borderWidth:0}e.each(h,function(o,n){n.show=n.options.show;if(n.show==null){n.show=n.used}n.reserveSpace=n.show||n.options.reserveSpace;bC(n)});if(g){var j={style:b.css("font-style"),size:Math.round(0.8*(+b.css("font-size").replace("px","")||13)),variant:b.css("font-variant"),weight:b.css("font-weight"),family:b.css("font-family")};var m=e.grep(h,function(n){return n.reserveSpace});e.each(m,function(o,n){bL(n);bh(n);aL(n,n.ticks);n.font=e.extend({},j,n.options.font);be(n)});for(k=m.length-1;k>=0;--k){aC(m[k])}bn();e.each(m,function(o,n){a0(n)})}bG=a-bz.left-bz.right;bt=bm-bz.bottom-bz.top;e.each(h,function(o,n){by(n)});bB()}function bC(j){var h=j.options,k=+(h.min!=null?h.min:j.datamin),m=+(h.max!=null?h.max:j.datamax),n=m-k;if(n==0){var l=m==0?1:0.01;if(h.min==null){k-=l}if(h.max==null||h.min!=null){m+=l}}else{var g=h.autoscaleMargin;if(g!=null){if(h.min==null){k-=n*g;if(k<0&&j.datamin!=null&&j.datamin>=0){k=0}}if(h.max==null){m+=n*g;if(m>0&&j.datamax!=null&&j.datamax<=0){m=0}}}}j.min=k;j.max=m}function bL(w){var p=w.options;var v;if(typeof p.ticks=="number"&&p.ticks>0){v=p.ticks}else{v=0.3*Math.sqrt(w.direction=="x"?a:bm)}var h=(w.max-w.min)/v,n,q,o,k,j,l,u;if(p.mode=="time"){var t={second:1000,minute:60*1000,hour:60*60*1000,day:24*60*60*1000,month:30*24*60*60*1000,year:365.2425*24*60*60*1000};var s=[[1,"second"],[2,"second"],[5,"second"],[10,"second"],[30,"second"],[1,"minute"],[2,"minute"],[5,"minute"],[10,"minute"],[30,"minute"],[1,"hour"],[2,"hour"],[4,"hour"],[8,"hour"],[12,"hour"],[1,"day"],[2,"day"],[3,"day"],[0.25,"month"],[0.5,"month"],[1,"month"],[2,"month"],[3,"month"],[6,"month"],[1,"year"]];var A=0;if(p.minTickSize!=null){if(typeof p.tickSize=="number"){A=p.tickSize}else{A=p.minTickSize[0]*t[p.minTickSize[1]]}}for(var j=0;j<s.length-1;++j){if(h<(s[j][0]*t[s[j][1]]+s[j+1][0]*t[s[j+1][1]])/2&&s[j][0]*t[s[j][1]]>=A){break}}n=s[j][0];o=s[j][1];if(o=="year"){l=Math.pow(10,Math.floor(Math.log(h/t.year)/Math.LN10));u=(h/t.year)/l;if(u<1.5){n=1}else{if(u<3){n=2}else{if(u<7.5){n=5}else{n=10}}}n*=l}w.tickSize=p.tickSize||[n,o];q=function(L){var G=[],I=L.tickSize[0],F=L.tickSize[1],H=new Date(L.min);var B=I*t[F];if(F=="second"){H.setUTCSeconds(d(H.getUTCSeconds(),I))}if(F=="minute"){H.setUTCMinutes(d(H.getUTCMinutes(),I))}if(F=="hour"){H.setUTCHours(d(H.getUTCHours(),I))}if(F=="month"){H.setUTCMonth(d(H.getUTCMonth(),I))}if(F=="year"){H.setUTCFullYear(d(H.getUTCFullYear(),I))}H.setUTCMilliseconds(0);if(B>=t.minute){H.setUTCSeconds(0)}if(B>=t.hour){H.setUTCMinutes(0)}if(B>=t.day){H.setUTCHours(0)}if(B>=t.day*4){H.setUTCDate(1)}if(B>=t.year){H.setUTCMonth(0)}var D=0,E=Number.NaN,K;do{K=E;E=H.getTime();G.push(E);if(F=="month"){if(I<1){H.setUTCDate(1);var C=H.getTime();H.setUTCMonth(H.getUTCMonth()+1);var J=H.getTime();H.setTime(E+D*t.hour+(J-C)*I);D=H.getUTCHours();H.setUTCHours(0)}else{H.setUTCMonth(H.getUTCMonth()+I)}}else{if(F=="year"){H.setUTCFullYear(H.getUTCFullYear()+I)}else{H.setTime(E+B)}}}while(E<L.max&&E!=K);return G};k=function(G,D){var B=new Date(G);if(p.timeformat!=null){return e.plot.formatDate(B,p.timeformat,p.monthNames)}var F=D.tickSize[0]*t[D.tickSize[1]];var E=D.max-D.min;var C=(p.twelveHourClock)?" %p":"";if(F<t.minute){fmt="%h:%M:%S"+C}else{if(F<t.day){if(E<2*t.day){fmt="%h:%M"+C}else{fmt="%b %d %h:%M"+C}}else{if(F<t.month){fmt="%b %d"}else{if(F<t.year){if(E<t.year){fmt="%b"}else{fmt="%b %y"}}else{fmt="%y"}}}}return e.plot.formatDate(B,fmt,p.monthNames)}}else{var g=p.tickDecimals;var m=-Math.floor(Math.log(h)/Math.LN10);if(g!=null&&m>g){m=g}l=Math.pow(10,-m);u=h/l;if(u<1.5){n=1}else{if(u<3){n=2;if(u>2.25&&(g==null||m+1<=g)){n=2.5;++m}}else{if(u<7.5){n=5}else{n=10}}}n*=l;if(p.minTickSize!=null&&n<p.minTickSize){n=p.minTickSize}w.tickDecimals=Math.max(0,g!=null?g:m);w.tickSize=p.tickSize||n;q=function(E){var C=[];var B=d(E.min,E.tickSize),F=0,G=Number.NaN,D;do{D=G;G=B+F*E.tickSize;C.push(G);++F}while(G<E.max&&G!=D);return C};k=function(C,B){return C.toFixed(B.tickDecimals)}}if(p.alignTicksWithAxis!=null){var x=(w.direction=="x"?bA:br)[p.alignTicksWithAxis-1];if(x&&x.used&&x!=w){var r=q(w);if(r.length>0){if(p.min==null){w.min=Math.min(w.min,r[0])}if(p.max==null&&r.length>1){w.max=Math.max(w.max,r[r.length-1])}}q=function(C){var B=[],E,D;for(D=0;D<x.ticks.length;++D){E=(x.ticks[D].v-x.min)/(x.max-x.min);E=C.min+E*(C.max-C.min);B.push(E)}return B};if(!w.mode&&p.tickDecimals==null){var y=Math.max(0,-Math.floor(Math.log(h)/Math.LN10)+1),z=q(w);if(!(z.length>1&&/\..*0$/.test((z[1]-z[0]).toFixed(y)))){w.tickDecimals=y}}}}w.tickGenerator=q;if(e.isFunction(p.tickFormatter)){w.tickFormatter=function(C,B){return""+p.tickFormatter(C,B)}}else{w.tickFormatter=k}}function bh(h){var n=h.options.ticks,g=[];if(n==null||(typeof n=="number"&&n>0)){g=h.tickGenerator(h)}else{if(n){if(e.isFunction(n)){g=n(h)}else{g=n}}}var j,m;h.ticks=[];for(j=0;j<g.length;++j){var l=null;var k=g[j];if(typeof k=="object"){m=+k[0];if(k.length>1){l=k[1]}}else{m=+k}if(l==null){l=h.tickFormatter(m,h)}if(!isNaN(m)){h.ticks.push({v:m,label:l})}}}function aL(h,g){if(h.options.autoscaleMargin&&g.length>0){if(h.options.min==null){h.min=Math.min(h.min,g[0].v)}if(h.options.max==null&&g.length>1){h.max=Math.max(h.max,g[g.length-1].v)}}}function aY(){bq.clearRect(0,0,a,bm);var g=bj.grid;if(g.show&&g.backgroundColor){bl()}if(g.show&&!g.aboveData){a7();bK()}for(var h=0;h<bf.length;++h){aP(aS.drawSeries,[bq,bf[h]]);aV(bf[h])}aP(aS.draw,[bq]);if(g.show&&g.aboveData){a7();bK()}}function aF(m,n){var j,o,g,k,h=bD();for(i=0;i<h.length;++i){j=h[i];if(j.direction==n){k=n+j.n+"axis";if(!m[k]&&j.n==1){k=n+"axis"}if(m[k]){o=m[k].from;g=m[k].to;break}}}if(!m[k]){j=n=="x"?bA[0]:br[0];o=m[n+"1"];g=m[n+"2"]}if(o!=null&&g!=null&&o>g){var l=o;o=g;g=l}return{from:o,to:g,axis:j}}function bl(){bq.save();bq.translate(bz.left,bz.top);bq.fillStyle=aQ(bj.grid.backgroundColor,bt,0,"rgba(255, 255, 255, 0)");bq.fillRect(0,0,bG,bt);bq.restore()}function a7(){var g;bq.save();bq.translate(bz.left,bz.top);var v=bj.grid.markings;if(v){if(e.isFunction(v)){var s=aJ.getAxes();s.xmin=s.xaxis.min;s.xmax=s.xaxis.max;s.ymin=s.yaxis.min;s.ymax=s.yaxis.max;v=v(s)}for(g=0;g<v.length;++g){var j=v[g],k=aF(j,"x"),u=aF(j,"y");if(k.from==null){k.from=k.axis.min}if(k.to==null){k.to=k.axis.max}if(u.from==null){u.from=u.axis.min}if(u.to==null){u.to=u.axis.max}if(k.to<k.axis.min||k.from>k.axis.max||u.to<u.axis.min||u.from>u.axis.max){continue}k.from=Math.max(k.from,k.axis.min);k.to=Math.min(k.to,k.axis.max);u.from=Math.max(u.from,u.axis.min);u.to=Math.min(u.to,u.axis.max);if(k.from==k.to&&u.from==u.to){continue}k.from=k.axis.p2c(k.from);k.to=k.axis.p2c(k.to);u.from=u.axis.p2c(u.from);u.to=u.axis.p2c(u.to);if(k.from==k.to||u.from==u.to){bq.beginPath();bq.strokeStyle=j.color||bj.grid.markingsColor;bq.lineWidth=j.lineWidth||bj.grid.markingsLineWidth;bq.moveTo(k.from,u.from);bq.lineTo(k.to,u.to);bq.stroke()}else{bq.fillStyle=j.color||bj.grid.markingsColor;bq.fillRect(k.from,u.to,k.to-k.from,u.from-u.to)}}}var s=bD(),q=bj.grid.borderWidth;for(var h=0;h<s.length;++h){var l=s[h],w=l.box,m=l.tickLength,p,r,n,t;if(!l.show||l.ticks.length==0){continue}bq.strokeStyle=l.options.tickColor||e.color.parse(l.options.color).scale("a",0.22).toString();bq.lineWidth=1;if(l.direction=="x"){p=0;if(m=="full"){r=(l.position=="top"?0:bt)}else{r=w.top-bz.top+(l.position=="top"?w.height:0)}}else{r=0;if(m=="full"){p=(l.position=="left"?0:bG)}else{p=w.left-bz.left+(l.position=="left"?w.width:0)}}if(!l.innermost){bq.beginPath();n=t=0;if(l.direction=="x"){n=bG}else{t=bt}if(bq.lineWidth==1){p=Math.floor(p)+0.5;r=Math.floor(r)+0.5}bq.moveTo(p,r);bq.lineTo(p+n,r+t);bq.stroke()}bq.beginPath();for(g=0;g<l.ticks.length;++g){var o=l.ticks[g].v;n=t=0;if(o<l.min||o>l.max||(m=="full"&&q>0&&(o==l.min||o==l.max))){continue}if(l.direction=="x"){p=l.p2c(o);t=m=="full"?-bt:m;if(l.position=="top"){t=-t}}else{r=l.p2c(o);n=m=="full"?-bG:m;if(l.position=="left"){n=-n}}if(bq.lineWidth==1){if(l.direction=="x"){p=Math.floor(p)+0.5}else{r=Math.floor(r)+0.5}}bq.moveTo(p,r);bq.lineTo(p+n,r+t)}bq.stroke()}if(q){bq.lineWidth=q;bq.strokeStyle=bj.grid.borderColor;bq.strokeRect(-q/2,-q/2,bG+q,bt+q)}bq.restore()}function bK(){bq.save();e.each(bD(),function(n,l){if(!l.show||l.ticks.length==0){return}var g=l.box,q=l.font;bq.fillStyle=l.options.color;bq.font=q.style+" "+q.variant+" "+q.weight+" "+q.size+"px "+q.family;bq.textAlign="start";bq.textBaseline="middle";for(var h=0;h<l.ticks.length;++h){var r=l.ticks[h];if(!r.label||r.v<l.min||r.v>l.max){continue}var o,p,j=0,m;for(var k=0;k<r.lines.length;++k){m=r.lines[k];if(l.direction=="x"){o=bz.left+l.p2c(r.v)-m.width/2;if(l.position=="bottom"){p=g.top+g.padding}else{p=g.top+g.height-g.padding-r.height}}else{p=bz.top+l.p2c(r.v)-r.height/2;if(l.position=="left"){o=g.left+g.width-g.padding-m.width}else{o=g.left+g.padding}}p+=m.height/2+j;j+=m.height;if(e.browser.opera){o=Math.floor(o);p=Math.ceil(p-2)}bq.fillText(m.text,o,p)}}});bq.restore()}function aV(g){if(g.lines.show){aE(g)}if(g.bars.show){bJ(g)}if(g.points.show){aN(g)}}function aE(j){function k(s,r,x,B,o){var z=s.points,A=s.pointsize,u=null,v=null;bq.beginPath();for(var t=A;t<z.length;t+=A){var w=z[t-A],p=z[t-A+1],y=z[t],q=z[t+1];if(w==null||y==null){continue}if(p<=q&&p<o.min){if(q<o.min){continue}w=(o.min-p)/(q-p)*(y-w)+w;p=o.min}else{if(q<=p&&q<o.min){if(p<o.min){continue}y=(o.min-p)/(q-p)*(y-w)+w;q=o.min}}if(p>=q&&p>o.max){if(q>o.max){continue}w=(o.max-p)/(q-p)*(y-w)+w;p=o.max}else{if(q>=p&&q>o.max){if(p>o.max){continue}y=(o.max-p)/(q-p)*(y-w)+w;q=o.max}}if(w<=y&&w<B.min){if(y<B.min){continue}p=(B.min-w)/(y-w)*(q-p)+p;w=B.min}else{if(y<=w&&y<B.min){if(w<B.min){continue}q=(B.min-w)/(y-w)*(q-p)+p;y=B.min}}if(w>=y&&w>B.max){if(y>B.max){continue}p=(B.max-w)/(y-w)*(q-p)+p;w=B.max}else{if(y>=w&&y>B.max){if(w>B.max){continue}q=(B.max-w)/(y-w)*(q-p)+p;y=B.max}}if(w!=u||p!=v){bq.moveTo(B.p2c(w)+r,o.p2c(p)+x)}u=y;v=q;bq.lineTo(B.p2c(y)+r,o.p2c(q)+x)}bq.stroke()}function h(x,B,C){var q=x.points,s=x.pointsize,E=Math.min(Math.max(0,C.min),C.max),o=0,v,w=false,p=1,r=0,A=0;while(true){if(s>0&&o>q.length+s){break}o+=s;var y=q[o-s],t=q[o-s+p],F=q[o],u=q[o+p];if(w){if(s>0&&y!=null&&F==null){A=o;s=-s;p=2;continue}if(s<0&&o==r+s){bq.fill();w=false;s=-s;p=1;o=r=A+s;continue}}if(y==null||F==null){continue}if(y<=F&&y<B.min){if(F<B.min){continue}t=(B.min-y)/(F-y)*(u-t)+t;y=B.min}else{if(F<=y&&F<B.min){if(y<B.min){continue}u=(B.min-y)/(F-y)*(u-t)+t;F=B.min}}if(y>=F&&y>B.max){if(F>B.max){continue}t=(B.max-y)/(F-y)*(u-t)+t;y=B.max}else{if(F>=y&&F>B.max){if(y>B.max){continue}u=(B.max-y)/(F-y)*(u-t)+t;F=B.max}}if(!w){bq.beginPath();bq.moveTo(B.p2c(y),C.p2c(E));w=true}if(t>=C.max&&u>=C.max){bq.lineTo(B.p2c(y),C.p2c(C.max));bq.lineTo(B.p2c(F),C.p2c(C.max));continue}else{if(t<=C.min&&u<=C.min){bq.lineTo(B.p2c(y),C.p2c(C.min));bq.lineTo(B.p2c(F),C.p2c(C.min));continue}}var D=y,z=F;if(t<=u&&t<C.min&&u>=C.min){y=(C.min-t)/(u-t)*(F-y)+y;t=C.min}else{if(u<=t&&u<C.min&&t>=C.min){F=(C.min-t)/(u-t)*(F-y)+y;u=C.min}}if(t>=u&&t>C.max&&u<=C.max){y=(C.max-t)/(u-t)*(F-y)+y;t=C.max}else{if(u>=t&&u>C.max&&t<=C.max){F=(C.max-t)/(u-t)*(F-y)+y;u=C.max}}if(y!=D){bq.lineTo(B.p2c(D),C.p2c(t))}bq.lineTo(B.p2c(y),C.p2c(t));bq.lineTo(B.p2c(F),C.p2c(u));if(F!=z){bq.lineTo(B.p2c(F),C.p2c(u));bq.lineTo(B.p2c(z),C.p2c(u))}}}bq.save();bq.translate(bz.left,bz.top);bq.lineJoin="round";var g=j.lines.lineWidth,m=j.shadowSize;if(g>0&&m>0){bq.lineWidth=m;bq.strokeStyle="rgba(0,0,0,0.1)";var n=Math.PI/18;k(j.datapoints,Math.sin(n)*(g/2+m/2),Math.cos(n)*(g/2+m/2),j.xaxis,j.yaxis);bq.lineWidth=m/2;k(j.datapoints,Math.sin(n)*(g/2+m/4),Math.cos(n)*(g/2+m/4),j.xaxis,j.yaxis)}bq.lineWidth=g;bq.strokeStyle=j.color;var l=a5(j.lines,j.color,0,bt);if(l){bq.fillStyle=l;h(j.datapoints,j.xaxis,j.yaxis)}if(g>0){k(j.datapoints,0,0,j.xaxis,j.yaxis)}bq.restore()}function aN(j){function n(t,u,z,w,o,A,q,x){var p=t.points,y=t.pointsize;for(var v=0;v<p.length;v+=y){var r=p[v],s=p[v+1];if(r==null||r<A.min||r>A.max||s<q.min||s>q.max){continue}bq.beginPath();r=A.p2c(r);s=q.p2c(s)+w;if(x=="circle"){bq.arc(r,s,u,0,o?Math.PI:Math.PI*2,false)}else{x(bq,r,s,u,o)}bq.closePath();if(z){bq.fillStyle=z;bq.fill()}bq.stroke()}}bq.save();bq.translate(bz.left,bz.top);var g=j.points.lineWidth,l=j.shadowSize,m=j.points.radius,h=j.points.symbol;if(g>0&&l>0){var k=l/2;bq.lineWidth=k;bq.strokeStyle="rgba(0,0,0,0.1)";n(j.datapoints,m,null,k+k/2,true,j.xaxis,j.yaxis,h);bq.strokeStyle="rgba(0,0,0,0.2)";n(j.datapoints,m,null,k/2,true,j.xaxis,j.yaxis,h)}bq.lineWidth=g;bq.strokeStyle=j.color;n(j.datapoints,m,a5(j.points,j.color),0,false,j.xaxis,j.yaxis,h);bq.restore()}function aD(p,r,g,w,m,z,B,t,u,h,l,q){var A,j,v,n,y,s,o,x,k;if(l){x=s=o=true;y=false;A=g;j=p;n=r+w;v=r+m;if(j<A){k=j;j=A;A=k;y=true;s=false}}else{y=s=o=true;x=false;A=p+w;j=p+m;v=g;n=r;if(n<v){k=n;n=v;v=k;x=true;o=false}}if(j<t.min||A>t.max||n<u.min||v>u.max){return}if(A<t.min){A=t.min;y=false}if(j>t.max){j=t.max;s=false}if(v<u.min){v=u.min;x=false}if(n>u.max){n=u.max;o=false}A=t.p2c(A);v=u.p2c(v);j=t.p2c(j);n=u.p2c(n);if(B){h.beginPath();h.moveTo(A,v);h.lineTo(A,n);h.lineTo(j,n);h.lineTo(j,v);h.fillStyle=B(v,n);h.fill()}if(q>0&&(y||s||o||x)){h.beginPath();h.moveTo(A,v+z);if(y){h.lineTo(A,n+z)}else{h.moveTo(A,n+z)}if(o){h.lineTo(j,n+z)}else{h.moveTo(j,n+z)}if(s){h.lineTo(j,v+z)}else{h.moveTo(j,v+z)}if(x){h.lineTo(A,v+z)}else{h.moveTo(A,v+z)}h.stroke()}}function bJ(h){function j(r,s,p,u,q,n,o){var m=r.points,l=r.pointsize;for(var t=0;t<m.length;t+=l){if(m[t]==null){continue}aD(m[t],m[t+1],m[t+2],s,p,u,q,n,o,bq,h.bars.horizontal,h.bars.lineWidth)}}bq.save();bq.translate(bz.left,bz.top);bq.lineWidth=h.bars.lineWidth;bq.strokeStyle=h.color;var k=h.bars.align=="left"?0:-h.bars.barWidth/2;var g=h.bars.fill?function(m,l){return a5(h.bars,h.color,m,l)}:null;j(h.datapoints,k,k+h.bars.barWidth,0,g,h.xaxis,h.yaxis);bq.restore()}function a5(k,m,l,h){var j=k.fill;if(!j){return null}if(k.fillColor){return aQ(k.fillColor,l,h,m)}var g=e.color.parse(m);g.a=typeof j=="number"?j:0.4;g.normalize();return g.toString()}function bB(){b.find(".legend").remove();if(!bj.legend.show){return}var s=[],g=false,m=bj.legend.labelFormatter,n,q;for(var h=0;h<bf.length;++h){n=bf[h];q=n.label;if(!q){continue}if(h%bj.legend.noColumns==0){if(g){s.push("</tr>")}s.push("<tr>");g=true}if(m){q=m(q,n)}s.push('<td class="legendColorBox"><div style="border:1px solid '+bj.legend.labelBoxBorderColor+';padding:1px"><div style="width:4px;height:0;border:5px solid '+n.color+';overflow:hidden"></div></div></td><td class="legendLabel">'+q+"</td>")}if(g){s.push("</tr>")}if(s.length==0){return}var o='<table style="font-size:smaller;color:'+bj.grid.color+'">'+s.join("")+"</table>";if(bj.legend.container!=null){e(bj.legend.container).html(o)}else{var r="",k=bj.legend.position,j=bj.legend.margin;if(j[0]==null){j=[j,j]}if(k.charAt(0)=="n"){r+="top:"+(j[1]+bz.top)+"px;"}else{if(k.charAt(0)=="s"){r+="bottom:"+(j[1]+bz.bottom)+"px;"}}if(k.charAt(1)=="e"){r+="right:"+(j[0]+bz.right)+"px;"}else{if(k.charAt(1)=="w"){r+="left:"+(j[0]+bz.left)+"px;"}}var p=e('<div class="legend">'+o.replace('style="','style="position:absolute;'+r+";")+"</div>").appendTo(b);if(bj.legend.backgroundOpacity!=0){var t=bj.legend.backgroundColor;if(t==null){t=bj.grid.backgroundColor;if(t&&typeof t=="string"){t=e.color.parse(t)}else{t=e.color.extract(p,"background-color")}t.a=1;t=t.toString()}var l=p.children();e('<div style="position:absolute;width:'+l.width()+"px;height:"+l.height()+"px;"+r+"background-color:"+t+';"> </div>').prependTo(p).css("opacity",bj.legend.backgroundOpacity)}}}var a8=[],bp=null;function bg(C,E,s){var r=bj.grid.mouseActiveRadius,x=r*r+1,F=null,m=false,g,j;for(g=bf.length-1;g>=0;--g){if(!s(bf[g])){continue}var p=bf[g],D=p.xaxis,o=p.yaxis,h=p.datapoints.points,k=p.datapoints.pointsize,n=D.c2p(C),u=o.c2p(E),t=r/D.scale,v=r/o.scale;if(D.options.inverseTransform){t=Number.MAX_VALUE}if(o.options.inverseTransform){v=Number.MAX_VALUE}if(p.lines.show||p.points.show){for(j=0;j<h.length;j+=k){var z=h[j],B=h[j+1];if(z==null){continue}if(z-n>t||z-n<-t||B-u>v||B-u<-v){continue}var w=Math.abs(D.p2c(z)-C),y=Math.abs(o.p2c(B)-E),l=w*w+y*y;if(l<x){x=l;F=[g,j/k]}}}if(p.bars.show&&!F){var q=p.bars.align=="left"?0:-p.bars.barWidth/2,G=q+p.bars.barWidth;for(j=0;j<h.length;j+=k){var z=h[j],B=h[j+1],A=h[j+2];if(z==null){continue}if(bf[g].bars.horizontal?(n<=Math.max(A,z)&&n>=Math.min(A,z)&&u>=B+q&&u<=B+G):(n>=z+q&&n<=z+G&&u>=Math.min(A,B)&&u<=Math.max(A,B))){F=[g,j/k]}}}}if(F){g=F[0];j=F[1];k=bf[g].datapoints.pointsize;return{datapoint:bf[g].datapoints.points.slice(j*k,(j+1)*k),dataIndex:j,series:bf[g],seriesIndex:g}}return null}function a9(g){if(bj.grid.hoverable){bv("plothover",g,function(h){return h.hoverable!=false})}}function bE(g){if(bj.grid.hoverable){bv("plothover",g,function(h){return false})}}function bd(g){bv("plotclick",g,function(h){return h.clickable!=false})}function bv(l,m,k){var j=aO.offset(),q=m.pageX-j.left-bz.left,h=m.pageY-j.top-bz.top,o=aH({left:q,top:h});o.pageX=m.pageX;o.pageY=m.pageY;var n=bg(q,h,k);if(n){n.pageX=parseInt(n.series.xaxis.p2c(n.datapoint[0])+j.left+bz.left);n.pageY=parseInt(n.series.yaxis.p2c(n.datapoint[1])+j.top+bz.top)}if(bj.grid.autoHighlight){for(var g=0;g<a8.length;++g){var p=a8[g];if(p.auto==l&&!(n&&p.series==n.series&&p.point[0]==n.datapoint[0]&&p.point[1]==n.datapoint[1])){aU(p.series,p.point)}}if(n){bs(n.series,n.datapoint,l)}}b.trigger(l,[o,n])}function bI(){var g=bj.interaction.redrawOverlayInterval;if(g==-1){bx();return}if(!bp){bp=setTimeout(bx,g)}}function bx(){bp=null;aK.save();aK.clearRect(0,0,a,bm);aK.translate(bz.left,bz.top);var g,h;for(g=0;g<a8.length;++g){h=a8[g];if(h.series.bars.show){bu(h.series,h.point)}else{bi(h.series,h.point)}}aK.restore();aP(aS.drawOverlay,[aK])}function bs(j,l,g){if(typeof j=="number"){j=bf[j]}if(typeof l=="number"){var h=j.datapoints.pointsize;l=j.datapoints.points.slice(h*l,h*(l+1))}var k=aR(j,l);if(k==-1){a8.push({series:j,point:l,auto:g});bI()}else{if(!g){a8[k].auto=false}}}function aU(g,j){if(g==null&&j==null){a8=[];bI()}if(typeof g=="number"){g=bf[g]}if(typeof j=="number"){j=g.data[j]}var h=aR(g,j);if(h!=-1){a8.splice(h,1);bI()}}function aR(h,g){for(var k=0;k<a8.length;++k){var j=a8[k];if(j.series==h&&j.point[0]==g[0]&&j.point[1]==g[1]){return k}}return -1}function bi(j,k){var l=k[0],n=k[1],o=j.xaxis,g=j.yaxis;if(l<o.min||l>o.max||n<g.min||n>g.max){return}var h=j.points.radius+j.points.lineWidth/2;aK.lineWidth=h;aK.strokeStyle=e.color.parse(j.color).scale("a",0.5).toString();var m=1.5*h,l=o.p2c(l),n=g.p2c(n);aK.beginPath();if(j.points.symbol=="circle"){aK.arc(l,n,m,0,2*Math.PI,false)}else{j.points.symbol(aK,l,n,m,false)}aK.closePath();aK.stroke()}function bu(g,k){aK.lineWidth=g.bars.lineWidth;aK.strokeStyle=e.color.parse(g.color).scale("a",0.5).toString();var h=e.color.parse(g.color).scale("a",0.5).toString();var j=g.bars.align=="left"?0:-g.bars.barWidth/2;aD(k[0],k[1],k[2]||0,j,j+g.bars.barWidth,0,function(){return h},g.xaxis,g.yaxis,aK,g.bars.horizontal,g.bars.lineWidth)}function aQ(o,n,g,m){if(typeof o=="string"){return o}else{var p=bq.createLinearGradient(0,g,0,n);for(var k=0,l=o.colors.length;k<l;++k){var j=o.colors[k];if(typeof j!="string"){var h=e.color.parse(m);if(j.brightness!=null){h=h.scale("rgb",j.brightness)}if(j.opacity!=null){h.a*=j.opacity}j=h.toString()}p.addColorStop(k/(l-1),j)}return p}}}e.plot=function(c,a,b){var h=new f(e(c),a,b,e.plot.plugins);return h};e.plot.version="0.7";e.plot.plugins=[];e.plot.formatDate=function(w,q,c){var t=function(g){g=""+g;return g.length==1?"0"+g:g};var r=[];var s=false,b=false;var u=w.getUTCHours();var a=u<12;if(c==null){c=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}if(q.search(/%p|%P/)!=-1){if(u>12){u=u-12}else{if(u==0){u=12}}}for(var p=0;p<q.length;++p){var v=q.charAt(p);if(s){switch(v){case"h":v=""+u;break;case"H":v=t(u);break;case"M":v=t(w.getUTCMinutes());break;case"S":v=t(w.getUTCSeconds());break;case"d":v=""+w.getUTCDate();break;case"m":v=""+(w.getUTCMonth()+1);break;case"y":v=""+w.getUTCFullYear();break;case"b":v=""+c[w.getUTCMonth()];break;case"p":v=(a)?("am"):("pm");break;case"P":v=(a)?("AM"):("PM");break;case"0":v="";b=true;break}if(v&&b){v=t(v);b=false}r.push(v);if(!b){s=false}}else{if(v=="%"){s=true}else{r.push(v)}}}return r.join("")};function d(a,b){return b*Math.floor(a/b)}})(jQuery);define("lib/flot/jquery.flot",function(){});(function(d){function c(x){var a={first:{x:-1,y:-1},second:{x:-1,y:-1},show:false,active:false};var v={};var y=null;function F(e){if(a.active){w(e);x.getPlaceholder().trigger("plotselecting",[D()])}}function u(e){if(e.which!=1){return}document.body.focus();if(document.onselectstart!==undefined&&v.onselectstart==null){v.onselectstart=document.onselectstart;document.onselectstart=function(){return false}}if(document.ondrag!==undefined&&v.ondrag==null){v.ondrag=document.ondrag;document.ondrag=function(){return false}}b(a.first,e);a.active=true;y=function(f){z(f)};d(document).one("mouseup",y)}function z(e){y=null;if(document.onselectstart!==undefined){document.onselectstart=v.onselectstart}if(document.ondrag!==undefined){document.ondrag=v.ondrag}a.active=false;w(e);if(E()){B()}else{x.getPlaceholder().trigger("plotunselected",[]);x.getPlaceholder().trigger("plotselecting",[null])}return false}function D(){if(!E()){return null}var e={},f=a.first,g=a.second;d.each(x.getAxes(),function(j,h){if(h.used){var k=h.c2p(f[h.direction]),l=h.c2p(g[h.direction]);e[j]={from:Math.min(k,l),to:Math.max(k,l)}}});return e}function B(){var e=D();x.getPlaceholder().trigger("plotselected",[e]);if(e.xaxis&&e.yaxis){x.getPlaceholder().trigger("selected",[{x1:e.xaxis.from,y1:e.yaxis.from,x2:e.xaxis.to,y2:e.yaxis.to}])}}function C(f,e,g){return e<f?f:(e>g?g:e)}function b(e,h){var f=x.getOptions();var g=x.getPlaceholder().offset();var j=x.getPlotOffset();e.x=C(0,h.pageX-g.left-j.left,x.width());e.y=C(0,h.pageY-g.top-j.top,x.height());if(f.selection.mode=="y"){e.x=e==a.first?0:x.width()}if(f.selection.mode=="x"){e.y=e==a.first?0:x.height()}}function w(e){if(e.pageX==null){return}b(a.second,e);if(E()){a.show=true;x.triggerRedrawOverlay()}else{A(true)}}function A(e){if(a.show){a.show=false;x.triggerRedrawOverlay();if(!e){x.getPlaceholder().trigger("plotunselected",[])}}}function s(n,j){var m,g,f,e,h=x.getAxes();for(var l in h){m=h[l];if(m.direction==j){e=j+m.n+"axis";if(!n[e]&&m.n==1){e=j+"axis"}if(n[e]){g=n[e].from;f=n[e].to;break}}}if(!n[e]){m=j=="x"?x.getXAxes()[0]:x.getYAxes()[0];g=n[j+"1"];f=n[j+"2"]}if(g!=null&&f!=null&&g>f){var k=g;g=f;f=k}return{from:g,to:f,axis:m}}function t(h,j){var f,g,e=x.getOptions();if(e.selection.mode=="y"){a.first.x=0;a.second.x=x.width()}else{g=s(h,"x");a.first.x=g.axis.p2c(g.from);a.second.x=g.axis.p2c(g.to)}if(e.selection.mode=="x"){a.first.y=0;a.second.y=x.height()}else{g=s(h,"y");a.first.y=g.axis.p2c(g.from);a.second.y=g.axis.p2c(g.to)}a.show=true;x.triggerRedrawOverlay();if(!j&&E()){B()}}function E(){var e=5;return Math.abs(a.second.x-a.first.x)>=e&&Math.abs(a.second.y-a.first.y)>=e}x.clearSelection=A;x.setSelection=t;x.getSelection=D;x.hooks.bindEvents.push(function(f,g){var e=f.getOptions();if(e.selection.mode!=null){g.mousemove(F);g.mousedown(u)}});x.hooks.drawOverlay.push(function(k,e){if(a.show&&E()){var m=k.getPlotOffset();var n=k.getOptions();e.save();e.translate(m.left,m.top);var j=d.color.parse(n.selection.color);e.strokeStyle=j.scale("a",0.8).toString();e.lineWidth=1;e.lineJoin="round";e.fillStyle=j.scale("a",0.4).toString();var g=Math.min(a.first.x,a.second.x),h=Math.min(a.first.y,a.second.y),f=Math.abs(a.second.x-a.first.x),l=Math.abs(a.second.y-a.first.y);e.fillRect(g,h,f,l);e.strokeRect(g,h,f,l);e.restore()}});x.hooks.shutdown.push(function(e,f){f.unbind("mousemove",F);f.unbind("mousedown",u);if(y){d(document).unbind("mouseup",y)}})}d.plot.plugins.push({init:c,options:{selection:{mode:null,color:"#e8cfac"}},name:"selection",version:"1.1"})})(jQuery);define("lib/flot/jquery.flot.selection",function(){});define("graph",["jquery","lib/jquery.template","order!lib/flot/jquery.flot","order!lib/flot/jquery.flot.selection"],function(e){var f=function(){};var h=function(a){var b=[];a.renderTo&&(b=e("#"+a.renderTo));if(!b.length){throw new Error("no render container")}this.renderdata=[];this.config=e.extend(true,{},h.__config,a.config);this.events=e.extend(true,{},h.__events,a.events);this.plot=e.plot(b[0],this.renderdata,this.config.base);this.placeholder=this.plot.getPlaceholder();this._renderUI();this._bindEvents()};var g=h.prototype;g.render=function(a){a=this.events.datapreprocess(a);this.renderdata=this.events._datapreprocess(a);this.resetHist(this.renderdata);this.redraw(this.renderdata)};g.redraw=function(a){this.plot.setData(a);this.plot.setupGrid();this.plot.draw();this.plot.clearSelection()};g.resetHist=function(a){this.renderhist=[];this.renderhist[0]=a};g.getRenderData=function(q,n){var a,b,p=this.renderdata,c=[];if(typeof q=="undefined"&&typeof n=="undefined"){return p}for(var o=0,d=p.length;o<d;++o){a=e.extend(true,{},p[o]);b=e.grep(a.data,function(j,k){return j[0]>=q&&j[0]<=n});if(b.length!==0){a.data=b;c.push(a)}}return c};g._transToPointData=function(c){var j=[],o,p;for(var q=0,a=c.length;q<a;++q){o=c[q];p=o.data;for(var d=0,b=p.length;d<b;++d){if(p[d][2]){j.push({x:p[d][0],y:p[d][1],color:o.color,label:o.label,data:p[d][2]})}}}return j};g._renderUI=function(){var m=this.config.ui,o=this.placeholder,n=o.width(),c=o.height(),a,p,d,b;p=e("<div>").html(m.coord.x.content).addClass(m.coord.x.cls).css({position:"absolute",bottom:-15,left:n-50});d=e("<div>").html(m.coord.y.content).addClass(m.coord.y.cls).css({position:"absolute",top:5,left:-20});a=e("<div>").html(m.tip.content).addClass(m.tip.cls).css({position:"absolute",top:25,left:120});b=e("<div>").html(m.back.content).attr("title",m.back.content).addClass(m.back.cls).bind("click",(function(j){return function(k){j._goBack()}})(this));o.append(a).append(p).append(d).append(b)};g._goBack=function(){var a=this.renderhist.length;if(a===1){return}this.renderhist.pop();a=this.renderhist.length;this.redraw(this.renderhist[a-1])};g._bindEvents=function(){var a=this;b();c();function c(){var d=a.events.datarangeselect;a.placeholder.unbind("plotselected").bind("plotselected",function(p,q){var n=Math.ceil(q.xaxis.from),r=Math.floor(q.xaxis.to);if(n>r){a.plot.clearSelection();return}var o=a.getRenderData(n,r);a.redraw(o);a.renderhist.push(o);d.call(a,a._transToPointData(o))})}function b(){var l=null,d=null,n=a.events.datapointhover.hoverin,m=a.events.datapointhover.hoverout;a.placeholder.unbind("plothover").bind("plothover",function(j,k,o){if(o){if(d!==o.dataIndex){d=o.dataIndex;clearTimeout(l);l=setTimeout(function(){var s=(e.grep(o.series.data,function(p,q){return p[0]===o.datapoint[0]&&p[1]===o.datapoint[1]}))[0];var t={x:s[0],y:s[1],color:o.series.color,label:o.series.label,data:s[2]};var r={top:o.pageY,left:o.pageX};n.call(a,r,t)},150)}}else{clearTimeout(l);m.call(a);d=null}})}};h.__config={base:{series:{lines:{show:true},points:{show:true}},grid:{hoverable:true,clickable:true},selection:{mode:"x"}},ui:{back:{content:"",cls:""},tip:{content:"(,)",cls:""},coord:{x:{content:"x",cls:""},y:{content:"y",cls:""}}}};h.__events={_datapreprocess:function(c){c=c||[];for(var d=0,b=c.length;d<b;++d){var a=c[d];if(a.label){a.label=e.tmpl.object(a.label,{count:a.data.length})}}return c},datapreprocess:function(a){return a},datarangeselect:f,datapointhover:{hoverin:f,hoverout:f}};return h});define("cmt",["jquery","lib/pubsub","animator","cube","textParticle","widget","graph"],function(l,p,n,j,k,m,o){var q={};q.init=function(){this.Scene.init();this.NetData.init();this.ViewGraph.init()};q.Scene={init:function(){this.painter=l("#painter");this.content=l("#content");this.initActor();this.initMessageResponse();this.bindEvent();this.animator.start()},initActor:function(){this.animator=new n({container:this.painter,camera:{pos:[0,0,550]},mediator:p});this.cube=new j({scene:this.animator.scene,size:200,pos:[-10,-20,-10000],rotSpeed:[1.8*0.005,2.4*0.005,0],textures:q.util.generateTextures("cube",6,".jpg")});this.textParticle=new k({scene:this.animator.scene,amount:31,textures:q.util.generateTextures("text",31,".png")});this.animator.addActors([this.cube,this.textParticle])},initMessageResponse:function(){var b=false,a=this.cube,e=this.animator,f=this.painter,c=this.content,d,g=l("#regionInfo");p.subscribe("actorsUpdated",function(r,h){if(a.arrviedEnd=="far"){e.stop();f.fadeOut("fast",function(){a.arrviedEnd="none";if(!e.isAnimated()){p.publish("animatorStopped",d);c.fadeIn("fast")}})}});p.subscribe("dataReceived",function(r,h){a.move({speed:[0,0,100],near:0})});p.subscribe("mouseOverCube",function(r,h){f[0].style.cursor="pointer";if(!b){a.stop();b=false}});p.subscribe("mouseOutCube",function(r,h){f[0].style.cursor="auto";a.start()});p.subscribe("mouseClickCube",function(r,h){a.move({speed:[140,75,-100],far:-2000});a.start();b=true;d=q.util.materialIndexToRegion[parseInt(h,10)];g.html(d.content)});p.subscribe("mouseClickBack",function(r,h){c.fadeOut("fast",function(){f.fadeIn("fast",function(){a.move({speed:[-140,-75,100],near:0});e.start();b=false})})})},bindEvent:function(){var f=this.animator,h=this.cube,g=this.painter,e=l("#cubeBack"),a=[];var c=function(r){a=f.getIntersects(r);if(a.length!=0){if(a[0].object.id==h.mesh.id){p.publish("mouseOverCube")}}else{p.publish("mouseOutCube")}},d=function(r){a=f.getIntersects(r);if(a.length!=0){if(a[0].object.id==h.mesh.id){p.publish("mouseClickCube",a[0].face.materialIndex)}}},b=function(r){p.publish("mouseClickBack")};g.on("click",d);g.on("mousemove",c);e.on("click",b)}};q.NetData={init:function(){this.fetch()},fetch:function(){var a=this;l.getJSON(q.config.fetchUrl,function(b){a.receivedData=b;p.publish("dataReceived")})},getData:function(c,e){var d=this.receivedData[c][e],b=[];for(var f=0,a=d.length;f<a;++f){b.push(l.extend({},d[f]))}return b},getLevelData:function(c,d){var f,b=this.getData(c,d),e=b.length,h,g,a,r=[-1];for(f=0;f<e;++f){g=b[f].data;a=g.length;r.push([g[0][0],g[a-1][0]])}r[0]=[r[1][0],r[r.length-1][1]];return r},getListData:function(b,d){var g,a=this.getData(b,d),e=a.length,t,h,v,c,f=[];for(g=0;g<e;++g){c=a[g].label.slice(0,2);h=a[g].data;v=h.length;for(t=0;t<v;++t){var u=h[t];f.push({l:c,f:u[1],d:u[2]})}}return f}};q.ViewGraph={init:function(){this.initWidget();this.initGraph();this.initMessageResponse();this.bindEvent();this.dataContainer.render()},initWidget:function(){this.tip=new m.Tip({cls:"data-info",tmpl:"<ul><li><em>: </em>{d}</li><li><em>: </em>{f}</li><li><em>: </em>{l}</li></ul>"});this.list=new m.List({cls:"data-list",tmpl:'<span class="f">{f}</span><span class="d">{d}</span><span class="l">{l}</span>'});this.dataContainer=new m.Base({cls:"data-container",header:l("<div/>").html('<span class="f"></span><span class="d"></span><span class="l"></span>'),container:l("#dataWin")})},initGraph:function(){var a=this.tip,b=this.list;this.graph=new o({renderTo:"placeHolder",config:{base:{xaxis:{tickDecimals:0,color:"#fff"},yaxis:{tickDecimals:0,color:"#fff"},grid:{backgroundColor:{colors:["#ffd986","#f9b447"]}}},ui:{back:{cls:"go-back"},tip:{cls:"usage-tip"},coord:{x:{content:"",cls:"coord-tip"},y:{content:"<br/>",cls:"coord-tip"}}}},events:{datapreprocess:function(d){var g=q.config.colors;for(var e=0,c=d.length;e<c;++e){var f=d[e];f.label&&(f.label=f.label+"<{count}>");f.color=g[e]}return d},datarangeselect:function(c){},datapointhover:{hoverin:function(c,d){a.render({data:{d:d.data,f:d.y,l:d.label.slice(0,2)},style:{top:c.top,left:c.left,backgroundColor:d.color}});b.slideTo(d.x,{backgroundColor:d.color,"border-radius":3})},hoverout:function(){a.unrender()}}}})},initMessageResponse:function(){var c=this.graph,d=this.list,a=this.dataContainer,b,e="char",f=l("#typeMenu").find("button"),g=l("#levelMenu").find("button"),h=this;p.subscribe("animatorStopped",function(s,t){f.removeClass("checked");g.removeClass("checked");l(f[0]).addClass("checked");l(g[0]).addClass("checked");b=t.region;h._render(b,"char")});p.subscribe("mouseClickTypeButton",function(t,s){e=s;h._render(b,e)});p.subscribe("mouseClickLevelButton",function(A,B){var y=q.NetData.getLevelData(b,e),z=parseInt(B,10),w=y[z],x=c.getRenderData(w[0],w[1]);c.redraw(x);c.resetHist(x)});p.subscribe("mouseClickSearchButton",function(C,z){var D=q.NetData.getListData(b,e),A=q.config.colors;for(var x=0,B=D.length;x<B;++x){if(D[x].d==z){var y=parseInt(D[x].l,10);d.slideTo(x+1,{backgroundColor:A[y-1],"border-radius":3});break}}if(x>=B){alert(":"+z)}})},bindEvent:function(){var b=l("#levelMenu").find("button"),d=l("#typeMenu").find("button"),c=l("#searchKey"),a=l("#searchForm");d.on("click",function(f){var g=l(this),e=g.val();if(g.hasClass("checked")){return}d.removeClass("checked");g.addClass("checked");b.removeClass("checked");l(b[0]).addClass("checked");p.publish("mouseClickTypeButton",e)});b.on("click",function(f){var g=l(this),e=g.val();if(g.hasClass("checked")){return}b.removeClass("checked");g.addClass("checked");p.publish("mouseClickLevelButton",e)});c.on("focusin",function(e){if(l.trim(c.val())=="..."){c.removeClass("search-key").val("")}});c.on("focusout",function(e){if(l.trim(c.val())==""){c.addClass("search-key").val("...")}});a.on("submit",function(f){f.preventDefault();var e=l.trim(c.val());p.publish("mouseClickSearchButton",e)})},_render:function(c,a){var d=this.graph,e=this.list,b=this.dataContainer,f=q.NetData.getData(c,a),g=q.NetData.getListData(c,a);setTimeout(function(){console.time("render graph");d.render(f);console.timeEnd("render graph")},0);setTimeout(function(){console.time("render data list");var h=e.render(g).html();console.timeEnd("render data list");console.time("render data container");b.update({body:h});console.timeEnd("render data container")},0)}};q.config={fetchUrl:"data/fetchdata.php",textureUrl:"image/textures/",colors:["#e44323","#3686cc","#6caf24","#806061"]};q.util={generateTextures:function(b,d,c){var f=q.config.textureUrl,a=[];for(var e=1;e<=d;++e){a.push(f+b+"/"+e+c)}return a},materialIndexToRegion:[{region:"all",content:""},{region:"all",content:""},{region:"ml",content:""},{region:"hmt",content:""},{region:"jk",content:""},{region:"other",content:""}]};return q});require(["jquery","cmt"],function(a,b){b.init()});define("main",function(){});