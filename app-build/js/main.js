define("lib/pubsub",[],function(){var e={};e.version="1.0.1";var g={};var f=-1;var h=function(c,a,d){if(!g.hasOwnProperty(c)){return false}var b=function(){var r=g[c];var q=function(k){return function(){throw k}};for(var j=0,p=r.length;j<p;j++){try{r[j].func(c,a)}catch(s){setTimeout(q(s),0)}}};if(d===true){b()}else{setTimeout(b,0)}return true};e.publish=function(b,a){return h(b,a,false)};e.publishSync=function(b,a){return h(b,a,true)};e.subscribe=function(a,b){if(!g.hasOwnProperty(a)){g[a]=[]}var c=(++f).toString();g[a].push({token:c,func:b});return c};e.unsubscribe=function(a){for(var d in g){if(g.hasOwnProperty(d)){for(var b=0,c=g[d].length;b<c;b++){if(g[d][b].token===a){g[d].splice(b,1);return a}}}}return false};return e});define("lib/Three",[],function(){var d=window;var c=c||{};if(!d.Int32Array){d.Int32Array=Array,d.Float32Array=Array}c.Clock=function(a){this.autoStart=a!==void 0?a:!0;this.elapsedTime=this.oldTime=this.startTime=0;this.running=!1};c.Clock.prototype.start=function(){this.oldTime=this.startTime=Date.now();this.running=!0};c.Clock.prototype.stop=function(){this.getElapsedTime();this.running=!1};c.Clock.prototype.getElapsedTime=function(){this.elapsedTime+=this.getDelta();return this.elapsedTime};c.Clock.prototype.getDelta=function(){var b=0;this.autoStart&&!this.running&&this.start();if(this.running){var a=Date.now(),b=0.001*(a-this.oldTime);this.oldTime=a;this.elapsedTime+=b}return b};c.Color=function(a){a!==void 0&&this.setHex(a);return this};c.Color.prototype={constructor:c.Color,r:1,g:1,b:1,copy:function(a){this.r=a.r;this.g=a.g;this.b=a.b;return this},copyGammaToLinear:function(a){this.r=a.r*a.r;this.g=a.g*a.g;this.b=a.b*a.b;return this},copyLinearToGamma:function(a){this.r=Math.sqrt(a.r);this.g=Math.sqrt(a.g);this.b=Math.sqrt(a.b);return this},setRGB:function(b,a,g){this.r=b;this.g=a;this.b=g;return this},setHSV:function(m,a,n){var b,g,f;if(n===0){this.r=this.g=this.b=0}else{switch(b=Math.floor(m*6),g=m*6-b,m=n*(1-a),f=n*(1-a*g),a=n*(1-a*(1-g)),b){case 1:this.r=f;this.g=n;this.b=m;break;case 2:this.r=m;this.g=n;this.b=a;break;case 3:this.r=m;this.g=f;this.b=n;break;case 4:this.r=a;this.g=m;this.b=n;break;case 5:this.r=n;this.g=m;this.b=f;break;case 6:case 0:this.r=n,this.g=a,this.b=m}}return this},setHex:function(a){a=Math.floor(a);this.r=(a>>16&255)/255;this.g=(a>>8&255)/255;this.b=(a&255)/255;return this},getHex:function(){return ~~(this.r*255)<<16^~~(this.g*255)<<8^~~(this.b*255)},getContextStyle:function(){return"rgb("+Math.floor(this.r*255)+","+Math.floor(this.g*255)+","+Math.floor(this.b*255)+")"},clone:function(){return(new c.Color).setRGB(this.r,this.g,this.b)}};c.Vector2=function(b,a){this.x=b||0;this.y=a||0};c.Vector2.prototype={constructor:c.Vector2,set:function(b,a){this.x=b;this.y=a;return this},copy:function(a){this.x=a.x;this.y=a.y;return this},clone:function(){return new c.Vector2(this.x,this.y)},add:function(b,a){this.x=b.x+a.x;this.y=b.y+a.y;return this},addSelf:function(a){this.x+=a.x;this.y+=a.y;return this},sub:function(b,a){this.x=b.x-a.x;this.y=b.y-a.y;return this},subSelf:function(a){this.x-=a.x;this.y-=a.y;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;return this},divideScalar:function(a){a?(this.x/=a,this.y/=a):this.set(0,0);return this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(b){var a=this.x-b.x,b=this.y-b.y;return a*a+b*b},setLength:function(a){return this.normalize().multiplyScalar(a)},equals:function(a){return a.x===this.x&&a.y===this.y}};c.Vector3=function(b,a,g){this.x=b||0;this.y=a||0;this.z=g||0};c.Vector3.prototype={constructor:c.Vector3,set:function(b,a,g){this.x=b;this.y=a;this.z=g;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this},clone:function(){return new c.Vector3(this.x,this.y,this.z)},add:function(b,a){this.x=b.x+a.x;this.y=b.y+a.y;this.z=b.z+a.z;return this},addSelf:function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;return this},sub:function(b,a){this.x=b.x-a.x;this.y=b.y-a.y;this.z=b.z-a.z;return this},subSelf:function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;return this},multiply:function(b,a){this.x=b.x*a.x;this.y=b.y*a.y;this.z=b.z*a.z;return this},multiplySelf:function(a){this.x*=a.x;this.y*=a.y;this.z*=a.z;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;this.z*=a;return this},divideSelf:function(a){this.x/=a.x;this.y/=a.y;this.z/=a.z;return this},divideScalar:function(a){a?(this.x/=a,this.y/=a,this.z/=a):this.z=this.y=this.x=0;return this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.lengthSq())},lengthManhattan:function(){return this.x+this.y+this.z},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){return this.normalize().multiplyScalar(a)},cross:function(b,a){this.x=b.y*a.z-b.z*a.y;this.y=b.z*a.x-b.x*a.z;this.z=b.x*a.y-b.y*a.x;return this},crossSelf:function(j){var a=this.x,k=this.y,b=this.z;this.x=k*j.z-b*j.y;this.y=b*j.x-a*j.z;this.z=a*j.y-k*j.x;return this},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){return(new c.Vector3).sub(this,a).lengthSq()},setPositionFromMatrix:function(a){this.x=a.n14;this.y=a.n24;this.z=a.n34},setRotationFromMatrix:function(b){var a=Math.cos(this.y);this.y=Math.asin(b.n13);Math.abs(a)>0.00001?(this.x=Math.atan2(-b.n23/a,b.n33/a),this.z=Math.atan2(-b.n12/a,b.n11/a)):(this.x=0,this.z=Math.atan2(b.n21,b.n22))},isZero:function(){return this.lengthSq()<0.0001}};c.Vector4=function(j,a,k,b){this.x=j||0;this.y=a||0;this.z=k||0;this.w=b!==void 0?b:1};c.Vector4.prototype={constructor:c.Vector4,set:function(j,a,k,b){this.x=j;this.y=a;this.z=k;this.w=b;return this},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w!==void 0?a.w:1},clone:function(){return new c.Vector4(this.x,this.y,this.z,this.w)},add:function(b,a){this.x=b.x+a.x;this.y=b.y+a.y;this.z=b.z+a.z;this.w=b.w+a.w;return this},addSelf:function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;this.w+=a.w;return this},sub:function(b,a){this.x=b.x-a.x;this.y=b.y-a.y;this.z=b.z-a.z;this.w=b.w-a.w;return this},subSelf:function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;this.w-=a.w;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;this.z*=a;this.w*=a;return this},divideScalar:function(a){a?(this.x/=a,this.y/=a,this.z/=a,this.w/=a):(this.z=this.y=this.x=0,this.w=1);return this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w},lengthSq:function(){return this.dot(this)},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){return this.normalize().multiplyScalar(a)},lerpSelf:function(b,a){this.x+=(b.x-this.x)*a;this.y+=(b.y-this.y)*a;this.z+=(b.z-this.z)*a;this.w+=(b.w-this.w)*a;return this}};c.Ray=function(a,e){function b(s,v,j){t.sub(j,s);B=t.dot(v);if(B<=0){return null}q=u.add(s,p.copy(v).multiplyScalar(B));return x=j.distanceTo(q)}function f(v,z,j,s){t.sub(s,z);u.sub(j,z);p.sub(v,z);Y=t.dot(t);A=t.dot(u);Z=t.dot(p);y=u.dot(u);r=u.dot(p);w=1/(Y*y-A*A);F=(y*Z-A*r)*w;aa=(Y*r-A*Z)*w;return F>=0&&aa>=0&&F+aa<1}this.origin=a||new c.Vector3;this.direction=e||new c.Vector3;this.intersectScene=function(j){return this.intersectObjects(j.children)};this.intersectObjects=function(v){var z,j,s=[];z=0;for(j=v.length;z<j;z++){Array.prototype.push.apply(s,this.intersectObject(v[z]))}s.sort(function(C,D){return C.distance-D.distance});return s};var k=new c.Vector3,h=new c.Vector3,g=new c.Vector3,l=new c.Vector3,a=new c.Vector3,e=new c.Vector3,m=new c.Vector3,o=new c.Vector3,n=new c.Vector3;this.intersectObject=function(z){for(var C,D=[],E=0,H=z.children.length;E<H;E++){Array.prototype.push.apply(D,this.intersectObject(z.children[E]))}if(z instanceof c.Particle){E=b(this.origin,this.direction,z.matrixWorld.getPosition());if(E===null||E>z.scale.x){return[]}C={distance:E,point:z.position,face:null,object:z};D.push(C)}else{if(z instanceof c.Mesh){E=b(this.origin,this.direction,z.matrixWorld.getPosition());if(E===null||E>z.geometry.boundingSphere.radius*Math.max(z.scale.x,Math.max(z.scale.y,z.scale.z))){return D}var G,j=z.geometry,v=j.vertices,s;z.matrixRotationWorld.extractRotation(z.matrixWorld);E=0;for(H=j.faces.length;E<H;E++){if(C=j.faces[E],a.copy(this.origin),e.copy(this.direction),s=z.matrixWorld,m=s.multiplyVector3(m.copy(C.centroid)).subSelf(a),G=m.dot(e),!(G<=0)&&(k=s.multiplyVector3(k.copy(v[C.a].position)),h=s.multiplyVector3(h.copy(v[C.b].position)),g=s.multiplyVector3(g.copy(v[C.c].position)),C instanceof c.Face4&&(l=s.multiplyVector3(l.copy(v[C.d].position))),o=z.matrixRotationWorld.multiplyVector3(o.copy(C.normal)),G=e.dot(o),z.doubleSided||(z.flipSided?G>0:G<0))){if(G=o.dot(m.sub(k,a))/G,n.add(a,e.multiplyScalar(G)),C instanceof c.Face3){f(n,k,h,g)&&(C={distance:a.distanceTo(n),point:n.clone(),face:C,object:z},D.push(C))}else{if(C instanceof c.Face4&&(f(n,k,h,l)||f(n,h,g,l))){C={distance:a.distanceTo(n),point:n.clone(),face:C,object:z},D.push(C)}}}}}}return D};var t=new c.Vector3,u=new c.Vector3,p=new c.Vector3,B,q,x,Y,A,Z,y,r,w,F,aa};c.Rectangle=function(){function f(){a=q-h;r=b-g}var h,g,q,b,a,r,e=!0;this.getX=function(){return h};this.getY=function(){return g};this.getWidth=function(){return a};this.getHeight=function(){return r};this.getLeft=function(){return h};this.getTop=function(){return g};this.getRight=function(){return q};this.getBottom=function(){return b};this.set=function(l,k,m,j){e=!1;h=l;g=k;q=m;b=j;f()};this.addPoint=function(k,j){e?(e=!1,h=k,g=j,q=k,b=j):(h=h<k?h:k,g=g<j?g:j,q=q>k?q:k,b=b>j?b:j);f()};this.add3Points=function(l,m,n,k,j,o){e?(e=!1,h=l<n?l<j?l:j:n<j?n:j,g=m<k?m<o?m:o:k<o?k:o,q=l>n?l>j?l:j:n>j?n:j,b=m>k?m>o?m:o:k>o?k:o):(h=l<n?l<j?l<h?l:h:j<h?j:h:n<j?n<h?n:h:j<h?j:h,g=m<k?m<o?m<g?m:g:o<g?o:g:k<o?k<g?k:g:o<g?o:g,q=l>n?l>j?l>q?l:q:j>q?j:q:n>j?n>q?n:q:j>q?j:q,b=m>k?m>o?m>b?m:b:o>b?o:b:k>o?k>b?k:b:o>b?o:b);f()};this.addRectangle=function(j){e?(e=!1,h=j.getLeft(),g=j.getTop(),q=j.getRight(),b=j.getBottom()):(h=h<j.getLeft()?h:j.getLeft(),g=g<j.getTop()?g:j.getTop(),q=q>j.getRight()?q:j.getRight(),b=b>j.getBottom()?b:j.getBottom());f()};this.inflate=function(j){h-=j;g-=j;q+=j;b+=j;f()};this.minSelf=function(j){h=h>j.getLeft()?h:j.getLeft();g=g>j.getTop()?g:j.getTop();q=q<j.getRight()?q:j.getRight();b=b<j.getBottom()?b:j.getBottom();f()};this.intersects=function(j){return Math.min(q,j.getRight())-Math.max(h,j.getLeft())>=0&&Math.min(b,j.getBottom())-Math.max(g,j.getTop())>=0};this.empty=function(){e=!0;b=q=g=h=0;f()};this.isEmpty=function(){return e}};c.Math={clamp:function(b,a,g){return b<a?a:b>g?g:b},clampBottom:function(b,a){return b<a?a:b},mapLinear:function(k,a,l,b,g){return b+(k-a)*(g-b)/(l-a)},random16:function(){return(65280*Math.random()+255*Math.random())/65535}};c.Matrix3=function(){this.m=[]};c.Matrix3.prototype={constructor:c.Matrix3,transpose:function(){var b,a=this.m;b=a[1];a[1]=a[3];a[3]=b;b=a[2];a[2]=a[6];a[6]=b;b=a[5];a[5]=a[7];a[7]=b;return this},transposeIntoArray:function(b){var a=this.m;b[0]=a[0];b[1]=a[3];b[2]=a[6];b[3]=a[1];b[4]=a[4];b[5]=a[7];b[6]=a[2];b[7]=a[5];b[8]=a[8];return this}};c.Matrix4=function(G,a,I,e,k,g,f,l,m,o,n,H,b,p,h,r){this.set(G!==void 0?G:1,a||0,I||0,e||0,k||0,g!==void 0?g:1,f||0,l||0,m||0,o||0,n!==void 0?n:1,H||0,b||0,p||0,h||0,r!==void 0?r:1);this.flat=Array(16);this.m33=new c.Matrix3};c.Matrix4.prototype={constructor:c.Matrix4,set:function(G,a,I,e,k,g,f,l,m,o,n,H,b,p,h,r){this.n11=G;this.n12=a;this.n13=I;this.n14=e;this.n21=k;this.n22=g;this.n23=f;this.n24=l;this.n31=m;this.n32=o;this.n33=n;this.n34=H;this.n41=b;this.n42=p;this.n43=h;this.n44=r;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},copy:function(a){this.set(a.n11,a.n12,a.n13,a.n14,a.n21,a.n22,a.n23,a.n24,a.n31,a.n32,a.n33,a.n34,a.n41,a.n42,a.n43,a.n44);return this},lookAt:function(m,a,n){var b=c.Matrix4.__v1,g=c.Matrix4.__v2,f=c.Matrix4.__v3;f.sub(m,a).normalize();if(f.length()===0){f.z=1}b.cross(n,f).normalize();b.length()===0&&(f.x+=0.0001,b.cross(n,f).normalize());g.cross(f,b).normalize();this.n11=b.x;this.n12=g.x;this.n13=f.x;this.n21=b.y;this.n22=g.y;this.n23=f.y;this.n31=b.z;this.n32=g.z;this.n33=f.z;return this},multiply:function(v,x){var w=v.n11,y=v.n12,F=v.n13,E=v.n14,A=v.n21,J=v.n22,K=v.n23,P=v.n24,O=v.n31,ad=v.n32,ae=v.n33,R=v.n34,e=v.n41,U=v.n42,a=v.n43,g=v.n44,n=x.n11,k=x.n12,b=x.n13,l=x.n14,af=x.n21,o=x.n22,q=x.n23,m=x.n24,r=x.n31,f=x.n32,h=x.n33,p=x.n34,B=x.n41,s=x.n42,u=x.n43,t=x.n44;this.n11=w*n+y*af+F*r+E*B;this.n12=w*k+y*o+F*f+E*s;this.n13=w*b+y*q+F*h+E*u;this.n14=w*l+y*m+F*p+E*t;this.n21=A*n+J*af+K*r+P*B;this.n22=A*k+J*o+K*f+P*s;this.n23=A*b+J*q+K*h+P*u;this.n24=A*l+J*m+K*p+P*t;this.n31=O*n+ad*af+ae*r+R*B;this.n32=O*k+ad*o+ae*f+R*s;this.n33=O*b+ad*q+ae*h+R*u;this.n34=O*l+ad*m+ae*p+R*t;this.n41=e*n+U*af+a*r+g*B;this.n42=e*k+U*o+a*f+g*s;this.n43=e*b+U*q+a*h+g*u;this.n44=e*l+U*m+a*p+g*t;return this},multiplySelf:function(a){return this.multiply(this,a)},multiplyToArray:function(b,a,g){this.multiply(b,a);g[0]=this.n11;g[1]=this.n21;g[2]=this.n31;g[3]=this.n41;g[4]=this.n12;g[5]=this.n22;g[6]=this.n32;g[7]=this.n42;g[8]=this.n13;g[9]=this.n23;g[10]=this.n33;g[11]=this.n43;g[12]=this.n14;g[13]=this.n24;g[14]=this.n34;g[15]=this.n44;return this},multiplyScalar:function(a){this.n11*=a;this.n12*=a;this.n13*=a;this.n14*=a;this.n21*=a;this.n22*=a;this.n23*=a;this.n24*=a;this.n31*=a;this.n32*=a;this.n33*=a;this.n34*=a;this.n41*=a;this.n42*=a;this.n43*=a;this.n44*=a;return this},multiplyVector3:function(k){var a=k.x,l=k.y,b=k.z,g=1/(this.n41*a+this.n42*l+this.n43*b+this.n44);k.x=(this.n11*a+this.n12*l+this.n13*b+this.n14)*g;k.y=(this.n21*a+this.n22*l+this.n23*b+this.n24)*g;k.z=(this.n31*a+this.n32*l+this.n33*b+this.n34)*g;return k},multiplyVector4:function(k){var a=k.x,l=k.y,b=k.z,g=k.w;k.x=this.n11*a+this.n12*l+this.n13*b+this.n14*g;k.y=this.n21*a+this.n22*l+this.n23*b+this.n24*g;k.z=this.n31*a+this.n32*l+this.n33*b+this.n34*g;k.w=this.n41*a+this.n42*l+this.n43*b+this.n44*g;return k},rotateAxis:function(j){var a=j.x,k=j.y,b=j.z;j.x=a*this.n11+k*this.n12+b*this.n13;j.y=a*this.n21+k*this.n22+b*this.n23;j.z=a*this.n31+k*this.n32+b*this.n33;j.normalize();return j},crossVector:function(b){var a=new c.Vector4;a.x=this.n11*b.x+this.n12*b.y+this.n13*b.z+this.n14*b.w;a.y=this.n21*b.x+this.n22*b.y+this.n23*b.z+this.n24*b.w;a.z=this.n31*b.x+this.n32*b.y+this.n33*b.z+this.n34*b.w;a.w=b.w?this.n41*b.x+this.n42*b.y+this.n43*b.z+this.n44*b.w:1;return a},determinant:function(){var G=this.n11,a=this.n12,I=this.n13,e=this.n14,k=this.n21,g=this.n22,f=this.n23,l=this.n24,m=this.n31,o=this.n32,n=this.n33,H=this.n34,b=this.n41,p=this.n42,h=this.n43,r=this.n44;return e*f*o*b-I*l*o*b-e*g*n*b+a*l*n*b+I*g*H*b-a*f*H*b-e*f*m*p+I*l*m*p+e*k*n*p-G*l*n*p-I*k*H*p+G*f*H*p+e*g*m*h-a*l*m*h-e*k*o*h+G*l*o*h+a*k*H*h-G*g*H*h-I*g*m*r+a*f*m*r+I*k*o*r-G*f*o*r-a*k*n*r+G*g*n*r},transpose:function(){var a;a=this.n21;this.n21=this.n12;this.n12=a;a=this.n31;this.n31=this.n13;this.n13=a;a=this.n32;this.n32=this.n23;this.n23=a;a=this.n41;this.n41=this.n14;this.n14=a;a=this.n42;this.n42=this.n24;this.n24=a;a=this.n43;this.n43=this.n34;this.n43=a;return this},clone:function(){var a=new c.Matrix4;a.n11=this.n11;a.n12=this.n12;a.n13=this.n13;a.n14=this.n14;a.n21=this.n21;a.n22=this.n22;a.n23=this.n23;a.n24=this.n24;a.n31=this.n31;a.n32=this.n32;a.n33=this.n33;a.n34=this.n34;a.n41=this.n41;a.n42=this.n42;a.n43=this.n43;a.n44=this.n44;return a},flatten:function(){this.flat[0]=this.n11;this.flat[1]=this.n21;this.flat[2]=this.n31;this.flat[3]=this.n41;this.flat[4]=this.n12;this.flat[5]=this.n22;this.flat[6]=this.n32;this.flat[7]=this.n42;this.flat[8]=this.n13;this.flat[9]=this.n23;this.flat[10]=this.n33;this.flat[11]=this.n43;this.flat[12]=this.n14;this.flat[13]=this.n24;this.flat[14]=this.n34;this.flat[15]=this.n44;return this.flat},flattenToArray:function(a){a[0]=this.n11;a[1]=this.n21;a[2]=this.n31;a[3]=this.n41;a[4]=this.n12;a[5]=this.n22;a[6]=this.n32;a[7]=this.n42;a[8]=this.n13;a[9]=this.n23;a[10]=this.n33;a[11]=this.n43;a[12]=this.n14;a[13]=this.n24;a[14]=this.n34;a[15]=this.n44;return a},flattenToArrayOffset:function(b,a){b[a]=this.n11;b[a+1]=this.n21;b[a+2]=this.n31;b[a+3]=this.n41;b[a+4]=this.n12;b[a+5]=this.n22;b[a+6]=this.n32;b[a+7]=this.n42;b[a+8]=this.n13;b[a+9]=this.n23;b[a+10]=this.n33;b[a+11]=this.n43;b[a+12]=this.n14;b[a+13]=this.n24;b[a+14]=this.n34;b[a+15]=this.n44;return b},setTranslation:function(b,a,g){this.set(1,0,0,b,0,1,0,a,0,0,1,g,0,0,0,1);return this},setScale:function(b,a,g){this.set(b,0,0,0,0,a,0,0,0,0,g,0,0,0,0,1);return this},setRotationX:function(b){var a=Math.cos(b),b=Math.sin(b);this.set(1,0,0,0,0,a,-b,0,0,b,a,0,0,0,0,1);return this},setRotationY:function(b){var a=Math.cos(b),b=Math.sin(b);this.set(a,0,b,0,0,1,0,0,-b,0,a,0,0,0,0,1);return this},setRotationZ:function(b){var a=Math.cos(b),b=Math.sin(b);this.set(a,-b,0,0,b,a,0,0,0,0,1,0,0,0,0,1);return this},setRotationAxis:function(v,a){var w=Math.cos(a),b=Math.sin(a),g=1-w,f=v.x,e=v.y,h=v.z,l=g*f,u=g*e;this.set(l*f+w,l*e-b*h,l*h+b*e,0,l*e+b*h,u*e+w,u*h-b*f,0,l*h-b*e,u*h+b*f,g*h*h+w,0,0,0,0,1);return this},setPosition:function(a){this.n14=a.x;this.n24=a.y;this.n34=a.z;return this},getPosition:function(){return c.Matrix4.__v1.set(this.n14,this.n24,this.n34)},getColumnX:function(){return c.Matrix4.__v1.set(this.n11,this.n21,this.n31)},getColumnY:function(){return c.Matrix4.__v1.set(this.n12,this.n22,this.n32)},getColumnZ:function(){return c.Matrix4.__v1.set(this.n13,this.n23,this.n33)},getInverse:function(o){var I=o.n11,q=o.n12,K=o.n13,e=o.n14,b=o.n21,a=o.n22,f=o.n23,h=o.n24,l=o.n31,k=o.n32,p=o.n33,r=o.n34,m=o.n41,g=o.n42,n=o.n43,J=o.n44;this.n11=f*r*g-h*p*g+h*k*n-a*r*n-f*k*J+a*p*J;this.n12=e*p*g-K*r*g-e*k*n+q*r*n+K*k*J-q*p*J;this.n13=K*h*g-e*f*g+e*a*n-q*h*n-K*a*J+q*f*J;this.n14=e*f*k-K*h*k-e*a*p+q*h*p+K*a*r-q*f*r;this.n21=h*p*m-f*r*m-h*l*n+b*r*n+f*l*J-b*p*J;this.n22=K*r*m-e*p*m+e*l*n-I*r*n-K*l*J+I*p*J;this.n23=e*f*m-K*h*m-e*b*n+I*h*n+K*b*J-I*f*J;this.n24=K*h*l-e*f*l+e*b*p-I*h*p-K*b*r+I*f*r;this.n31=a*r*m-h*k*m+h*l*g-b*r*g-a*l*J+b*k*J;this.n32=e*k*m-q*r*m-e*l*g+I*r*g+q*l*J-I*k*J;this.n33=K*h*m-e*a*m+e*b*g-I*h*g-q*b*J+I*a*J;this.n34=e*a*l-q*h*l-e*b*k+I*h*k+q*b*r-I*a*r;this.n41=f*k*m-a*p*m-f*l*g+b*p*g+a*l*n-b*k*n;this.n42=q*p*m-K*k*m+K*l*g-I*p*g-q*l*n+I*k*n;this.n43=K*a*m-q*f*m-K*b*g+I*f*g+q*b*n-I*a*n;this.n44=q*f*l-K*a*l+K*b*k-I*f*k-q*b*p+I*a*p;this.multiplyScalar(1/o.determinant());return this},setRotationFromEuler:function(k,o){var l=k.x,y=k.y,a=k.z,A=Math.cos(l),l=Math.sin(l),z=Math.cos(y),y=Math.sin(y),b=Math.cos(a),a=Math.sin(a);switch(o){case"YXZ":var e=z*b,g=z*a,f=y*b,h=y*a;this.n11=e+h*l;this.n12=f*l-g;this.n13=A*y;this.n21=A*a;this.n22=A*b;this.n23=-l;this.n31=g*l-f;this.n32=h+e*l;this.n33=A*z;break;case"ZXY":e=z*b;g=z*a;f=y*b;h=y*a;this.n11=e-h*l;this.n12=-A*a;this.n13=f+g*l;this.n21=g+f*l;this.n22=A*b;this.n23=h-e*l;this.n31=-A*y;this.n32=l;this.n33=A*z;break;case"ZYX":e=A*b;g=A*a;f=l*b;h=l*a;this.n11=z*b;this.n12=f*y-g;this.n13=e*y+h;this.n21=z*a;this.n22=h*y+e;this.n23=g*y-f;this.n31=-y;this.n32=l*z;this.n33=A*z;break;case"YZX":e=A*z;g=A*y;f=l*z;h=l*y;this.n11=z*b;this.n12=h-e*a;this.n13=f*a+g;this.n21=a;this.n22=A*b;this.n23=-l*b;this.n31=-y*b;this.n32=g*a+f;this.n33=e-h*a;break;case"XZY":e=A*z;g=A*y;f=l*z;h=l*y;this.n11=z*b;this.n12=-a;this.n13=y*b;this.n21=e*a+h;this.n22=A*b;this.n23=g*a-f;this.n31=f*a-g;this.n32=l*b;this.n33=h*a+e;break;default:e=A*b,g=A*a,f=l*b,h=l*a,this.n11=z*b,this.n12=-z*a,this.n13=y,this.n21=g+f*y,this.n22=e-h*y,this.n23=-l*z,this.n31=h-e*y,this.n32=f+g*y,this.n33=A*z}return this},setRotationFromQuaternion:function(v){var a=v.x,w=v.y,b=v.z,g=v.w,f=a+a,e=w+w,h=b+b,v=a*f,l=a*e;a*=h;var u=w*e;w*=h;b*=h;f*=g;e*=g;g*=h;this.n11=1-(u+b);this.n12=l-g;this.n13=a+e;this.n21=l+g;this.n22=1-(v+b);this.n23=w-f;this.n31=a-e;this.n32=w+f;this.n33=1-(v+u);return this},scale:function(b){var a=b.x,g=b.y,b=b.z;this.n11*=a;this.n12*=g;this.n13*=b;this.n21*=a;this.n22*=g;this.n23*=b;this.n31*=a;this.n32*=g;this.n33*=b;this.n41*=a;this.n42*=g;this.n43*=b;return this},compose:function(k,a,l){var b=c.Matrix4.__m1,g=c.Matrix4.__m2;b.identity();b.setRotationFromQuaternion(a);g.setScale(l.x,l.y,l.z);this.multiply(b,g);this.n14=k.x;this.n24=k.y;this.n34=k.z;return this},decompose:function(m,a,n){var b=c.Matrix4.__v1,g=c.Matrix4.__v2,f=c.Matrix4.__v3;b.set(this.n11,this.n21,this.n31);g.set(this.n12,this.n22,this.n32);f.set(this.n13,this.n23,this.n33);m=m instanceof c.Vector3?m:new c.Vector3;a=a instanceof c.Quaternion?a:new c.Quaternion;n=n instanceof c.Vector3?n:new c.Vector3;n.x=b.length();n.y=g.length();n.z=f.length();m.x=this.n14;m.y=this.n24;m.z=this.n34;b=c.Matrix4.__m1;b.copy(this);b.n11/=n.x;b.n21/=n.x;b.n31/=n.x;b.n12/=n.y;b.n22/=n.y;b.n32/=n.y;b.n13/=n.z;b.n23/=n.z;b.n33/=n.z;a.setFromRotationMatrix(b);return[m,a,n]},extractPosition:function(a){this.n14=a.n14;this.n24=a.n24;this.n34=a.n34;return this},extractRotation:function(j){var a=c.Matrix4.__v1,k=1/a.set(j.n11,j.n21,j.n31).length(),b=1/a.set(j.n12,j.n22,j.n32).length(),a=1/a.set(j.n13,j.n23,j.n33).length();this.n11=j.n11*k;this.n21=j.n21*k;this.n31=j.n31*k;this.n12=j.n12*b;this.n22=j.n22*b;this.n32=j.n32*b;this.n13=j.n13*a;this.n23=j.n23*a;this.n33=j.n33*a;return this}};c.Matrix4.makeInvert3x3=function(k){var o=k.m33,l=o.m,y=k.n33*k.n22-k.n32*k.n23,a=-k.n33*k.n21+k.n31*k.n23,A=k.n32*k.n21-k.n31*k.n22,z=-k.n33*k.n12+k.n32*k.n13,b=k.n33*k.n11-k.n31*k.n13,e=-k.n32*k.n11+k.n31*k.n12,g=k.n23*k.n12-k.n22*k.n13,f=-k.n23*k.n11+k.n21*k.n13,h=k.n22*k.n11-k.n21*k.n12,k=k.n11*y+k.n21*z+k.n31*g;k===0&&console.error("THREE.Matrix4.makeInvert3x3: Matrix not invertible.");k=1/k;l[0]=k*y;l[1]=k*a;l[2]=k*A;l[3]=k*z;l[4]=k*b;l[5]=k*e;l[6]=k*g;l[7]=k*f;l[8]=k*h;return o};c.Matrix4.makeFrustum=function(g,p,o,a,f,e){var b;b=new c.Matrix4;b.n11=2*f/(p-g);b.n12=0;b.n13=(p+g)/(p-g);b.n14=0;b.n21=0;b.n22=2*f/(a-o);b.n23=(a+o)/(a-o);b.n24=0;b.n31=0;b.n32=0;b.n33=-(e+f)/(e-f);b.n34=-2*e*f/(e-f);b.n41=0;b.n42=0;b.n43=-1;b.n44=0;return b};c.Matrix4.makePerspective=function(k,a,l,b){var g,k=l*Math.tan(k*Math.PI/360);g=-k;return c.Matrix4.makeFrustum(g*a,k*a,g,k,l,b)};c.Matrix4.makeOrtho=function(v,a,w,b,g,f){var e,h,l,u;e=new c.Matrix4;h=a-v;l=w-b;u=f-g;e.n11=2/h;e.n12=0;e.n13=0;e.n14=-((a+v)/h);e.n21=0;e.n22=2/l;e.n23=0;e.n24=-((w+b)/l);e.n31=0;e.n32=0;e.n33=-2/u;e.n34=-((f+g)/u);e.n41=0;e.n42=0;e.n43=0;e.n44=1;return e};c.Matrix4.__v1=new c.Vector3;c.Matrix4.__v2=new c.Vector3;c.Matrix4.__v3=new c.Vector3;c.Matrix4.__m1=new c.Matrix4;c.Matrix4.__m2=new c.Matrix4;c.Object3D=function(){this.name="";this.id=c.Object3DCount++;this.parent=void 0;this.children=[];this.up=new c.Vector3(0,1,0);this.position=new c.Vector3;this.rotation=new c.Vector3;this.eulerOrder="XYZ";this.scale=new c.Vector3(1,1,1);this.flipSided=this.doubleSided=this.dynamic=!1;this.renderDepth=null;this.rotationAutoUpdate=!0;this.matrix=new c.Matrix4;this.matrixWorld=new c.Matrix4;this.matrixRotationWorld=new c.Matrix4;this.matrixWorldNeedsUpdate=this.matrixAutoUpdate=!0;this.quaternion=new c.Quaternion;this.useQuaternion=!1;this.boundRadius=0;this.boundRadiusScale=1;this.visible=!0;this.receiveShadow=this.castShadow=!1;this.frustumCulled=!0;this._vector=new c.Vector3};c.Object3D.prototype={constructor:c.Object3D,translate:function(b,a){this.matrix.rotateAxis(a);this.position.addSelf(a.multiplyScalar(b))},translateX:function(a){this.translate(a,this._vector.set(1,0,0))},translateY:function(a){this.translate(a,this._vector.set(0,1,0))},translateZ:function(a){this.translate(a,this._vector.set(0,0,1))},lookAt:function(a){this.matrix.lookAt(a,this.position,this.up);this.rotationAutoUpdate&&this.rotation.setRotationFromMatrix(this.matrix)},add:function(b){if(this.children.indexOf(b)===-1){b.parent!==void 0&&b.parent.remove(b);b.parent=this;this.children.push(b);for(var a=this;a.parent!==void 0;){a=a.parent}a!==void 0&&a instanceof c.Scene&&a.addObject(b)}},remove:function(b){var a=this.children.indexOf(b);if(a!==-1){b.parent=void 0;this.children.splice(a,1);for(a=this;a.parent!==void 0;){a=a.parent}a!==void 0&&a instanceof c.Scene&&a.removeObject(b)}},getChildByName:function(k,a){var l,b,g;l=0;for(b=this.children.length;l<b;l++){g=this.children[l];if(g.name===k){return g}if(a&&(g=g.getChildByName(k,a),g!==void 0)){return g}}},updateMatrix:function(){this.matrix.setPosition(this.position);this.useQuaternion?this.matrix.setRotationFromQuaternion(this.quaternion):this.matrix.setRotationFromEuler(this.rotation,this.eulerOrder);if(this.scale.x!==1||this.scale.y!==1||this.scale.z!==1){this.matrix.scale(this.scale),this.boundRadiusScale=Math.max(this.scale.x,Math.max(this.scale.y,this.scale.z))}this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(b){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||b){this.parent?this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,b=!0}for(var a=0,g=this.children.length;a<g;a++){this.children[a].updateMatrixWorld(b)}}};c.Object3DCount=0;c.Projector=function(){function E(){var j=ae[af]=ae[af]||new c.RenderableObject;af++;return j}function J(){var j=g[e]=g[e]||new c.RenderableVertex;e++;return j}function F(j,z){return z.z-j.z}function ad(C,D){var G=0,H=1,j=C.z+C.w,K=D.z+D.w,I=-C.z+C.w,z=-D.z+D.w;return j>=0&&K>=0&&I>=0&&z>=0?!0:j<0&&K<0||I<0&&z<0?!1:(j<0?G=Math.max(G,j/(j-K)):K<0&&(H=Math.min(H,j/(j-K))),I<0?G=Math.max(G,I/(I-z)):z<0&&(H=Math.min(H,I/(I-z))),H<G?!1:(C.lerpSelf(D,G),D.lerpSelf(C,1-H),!0))}var a,af,ae=[],b,e,g=[],f,l,m=[],h,q=[],k,o,s=[],y,v,p=[],w={objects:[],sprites:[],lights:[],elements:[]},n=new c.Vector3,A=new c.Vector4,u=new c.Matrix4,x=new c.Matrix4,B=[new c.Vector4,new c.Vector4,new c.Vector4,new c.Vector4,new c.Vector4,new c.Vector4],r=new c.Vector4,t=new c.Vector4;this.computeFrustum=function(j){B[0].set(j.n41-j.n11,j.n42-j.n12,j.n43-j.n13,j.n44-j.n14);B[1].set(j.n41+j.n11,j.n42+j.n12,j.n43+j.n13,j.n44+j.n14);B[2].set(j.n41+j.n21,j.n42+j.n22,j.n43+j.n23,j.n44+j.n24);B[3].set(j.n41-j.n21,j.n42-j.n22,j.n43-j.n23,j.n44-j.n24);B[4].set(j.n41-j.n31,j.n42-j.n32,j.n43-j.n33,j.n44-j.n34);B[5].set(j.n41+j.n31,j.n42+j.n32,j.n43+j.n33,j.n44+j.n34);for(j=0;j<6;j++){var z=B[j];z.divideScalar(Math.sqrt(z.x*z.x+z.y*z.y+z.z*z.z))}};this.projectVector=function(j,z){z.matrixWorldInverse.getInverse(z.matrixWorld);u.multiply(z.projectionMatrix,z.matrixWorldInverse);u.multiplyVector3(j);return j};this.unprojectVector=function(j,z){z.projectionMatrixInverse.getInverse(z.projectionMatrix);u.multiply(z.matrixWorld,z.projectionMatrixInverse);u.multiplyVector3(j);return j};this.pickingRay=function(z,C){var j;z.z=-1;j=new c.Vector3(z.x,z.y,1);this.unprojectVector(z,C);this.unprojectVector(j,C);j.subSelf(z).normalize();return new c.Ray(z,j)};this.projectGraph=function(j,z){af=0;w.objects.length=0;w.sprites.length=0;w.lights.length=0;var C=function(K){if(K.visible!==!1){var D;if(D=K instanceof c.Mesh||K instanceof c.Line){if(!(D=K.frustumCulled===!1)){E:{for(var G=K.matrixWorld,H=-K.geometry.boundingSphere.radius*Math.max(K.scale.x,Math.max(K.scale.y,K.scale.z)),I=0;I<6;I++){if(D=B[I].x*G.n14+B[I].y*G.n24+B[I].z*G.n34+B[I].w,D<=H){D=!1;break E}}D=!0}}}D?(u.multiplyVector3(n.copy(K.position)),a=E(),a.object=K,a.z=n.z,w.objects.push(a)):K instanceof c.Sprite||K instanceof c.Particle?(u.multiplyVector3(n.copy(K.position)),a=E(),a.object=K,a.z=n.z,w.sprites.push(a)):K instanceof c.Light&&w.lights.push(K);D=0;for(G=K.children.length;D<G;D++){C(K.children[D])}}};C(j);z&&w.objects.sort(F);return w};this.projectScene=function(j,D,C){var z=D.near,Q=D.far,L,O,N,P,R,T,S,W,I,X,V,M,H,U,G,K;v=o=h=l=0;w.elements.length=0;D.parent===void 0&&(console.warn("DEPRECATED: Camera hasn't been added to a Scene. Adding it..."),j.add(D));j.updateMatrixWorld();D.matrixWorldInverse.getInverse(D.matrixWorld);u.multiply(D.projectionMatrix,D.matrixWorldInverse);this.computeFrustum(u);w=this.projectGraph(j,!1);j=0;for(L=w.objects.length;j<L;j++){if(I=w.objects[j].object,X=I.matrixWorld,M=I.material,e=0,I instanceof c.Mesh){V=I.geometry;H=I.geometry.materials;P=V.vertices;U=V.faces;G=V.faceVertexUvs;V=I.matrixRotationWorld.extractRotation(X);O=0;for(N=P.length;O<N;O++){b=J(),b.positionWorld.copy(P[O].position),X.multiplyVector3(b.positionWorld),b.positionScreen.copy(b.positionWorld),u.multiplyVector4(b.positionScreen),b.positionScreen.x/=b.positionScreen.w,b.positionScreen.y/=b.positionScreen.w,b.visible=b.positionScreen.z>z&&b.positionScreen.z<Q}P=0;for(O=U.length;P<O;P++){N=U[P];if(N instanceof c.Face3){if(R=g[N.a],T=g[N.b],S=g[N.c],R.visible&&T.visible&&S.visible&&(I.doubleSided||I.flipSided!=(S.positionScreen.x-R.positionScreen.x)*(T.positionScreen.y-R.positionScreen.y)-(S.positionScreen.y-R.positionScreen.y)*(T.positionScreen.x-R.positionScreen.x)<0)){W=m[l]=m[l]||new c.RenderableFace3,l++,f=W,f.v1.copy(R),f.v2.copy(T),f.v3.copy(S)}else{continue}}else{if(N instanceof c.Face4){if(R=g[N.a],T=g[N.b],S=g[N.c],W=g[N.d],R.visible&&T.visible&&S.visible&&W.visible&&(I.doubleSided||I.flipSided!=((W.positionScreen.x-R.positionScreen.x)*(T.positionScreen.y-R.positionScreen.y)-(W.positionScreen.y-R.positionScreen.y)*(T.positionScreen.x-R.positionScreen.x)<0||(T.positionScreen.x-S.positionScreen.x)*(W.positionScreen.y-S.positionScreen.y)-(T.positionScreen.y-S.positionScreen.y)*(W.positionScreen.x-S.positionScreen.x)<0))){K=q[h]=q[h]||new c.RenderableFace4,h++,f=K,f.v1.copy(R),f.v2.copy(T),f.v3.copy(S),f.v4.copy(W)}else{continue}}}f.normalWorld.copy(N.normal);V.multiplyVector3(f.normalWorld);f.centroidWorld.copy(N.centroid);X.multiplyVector3(f.centroidWorld);f.centroidScreen.copy(f.centroidWorld);u.multiplyVector3(f.centroidScreen);S=N.vertexNormals;R=0;for(T=S.length;R<T;R++){W=f.vertexNormalsWorld[R],W.copy(S[R]),V.multiplyVector3(W)}R=0;for(T=G.length;R<T;R++){if(K=G[R][P]){S=0;for(W=K.length;S<W;S++){f.uvs[R][S]=K[S]}}}f.material=M;f.faceMaterial=N.materialIndex!==null?H[N.materialIndex]:null;f.z=f.centroidScreen.z;w.elements.push(f)}}else{if(I instanceof c.Line){x.multiply(u,X);P=I.geometry.vertices;R=J();R.positionScreen.copy(P[0].position);x.multiplyVector4(R.positionScreen);O=1;for(N=P.length;O<N;O++){if(R=J(),R.positionScreen.copy(P[O].position),x.multiplyVector4(R.positionScreen),T=g[e-2],r.copy(R.positionScreen),t.copy(T.positionScreen),ad(r,t)){r.multiplyScalar(1/r.w),t.multiplyScalar(1/t.w),I=s[o]=s[o]||new c.RenderableLine,o++,k=I,k.v1.positionScreen.copy(r),k.v2.positionScreen.copy(t),k.z=Math.max(r.z,t.z),k.material=M,w.elements.push(k)}}}}}j=0;for(L=w.sprites.length;j<L;j++){if(I=w.sprites[j].object,X=I.matrixWorld,I instanceof c.Particle&&(A.set(X.n14,X.n24,X.n34,1),u.multiplyVector4(A),A.z/=A.w,A.z>0&&A.z<1)){z=p[v]=p[v]||new c.RenderableParticle,v++,y=z,y.x=A.x/A.w,y.y=A.y/A.w,y.z=A.z,y.rotation=I.rotation.z,y.scale.x=I.scale.x*Math.abs(y.x-(A.x+D.projectionMatrix.n11)/(A.w+D.projectionMatrix.n14)),y.scale.y=I.scale.y*Math.abs(y.y-(A.y+D.projectionMatrix.n22)/(A.w+D.projectionMatrix.n24)),y.material=I.material,w.elements.push(y)}}C&&w.elements.sort(F);return w}};c.Quaternion=function(j,a,k,b){this.set(j||0,a||0,k||0,b!==void 0?b:1)};c.Quaternion.prototype={constructor:c.Quaternion,set:function(j,a,k,b){this.x=j;this.y=a;this.z=k;this.w=b;return this},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w;return this},setFromEuler:function(f){var h=Math.PI/360,g=f.x*h,q=f.y*h,b=f.z*h,f=Math.cos(q),q=Math.sin(q),h=Math.cos(-b),b=Math.sin(-b),a=Math.cos(g),g=Math.sin(g),r=f*h,e=q*b;this.w=r*a-e*g;this.x=r*g+e*a;this.y=q*h*a+f*b*g;this.z=f*b*a-q*h*g;return this},setFromAxisAngle:function(j,a){var k=a/2,b=Math.sin(k);this.x=j.x*b;this.y=j.y*b;this.z=j.z*b;this.w=Math.cos(k);return this},setFromRotationMatrix:function(b){var a=Math.pow(b.determinant(),1/3);this.w=Math.sqrt(Math.max(0,a+b.n11+b.n22+b.n33))/2;this.x=Math.sqrt(Math.max(0,a+b.n11-b.n22-b.n33))/2;this.y=Math.sqrt(Math.max(0,a-b.n11+b.n22-b.n33))/2;this.z=Math.sqrt(Math.max(0,a-b.n11-b.n22+b.n33))/2;this.x=b.n32-b.n23<0?-Math.abs(this.x):Math.abs(this.x);this.y=b.n13-b.n31<0?-Math.abs(this.y):Math.abs(this.y);this.z=b.n21-b.n12<0?-Math.abs(this.z):Math.abs(this.z);this.normalize();return this},calculateW:function(){this.w=-Math.sqrt(Math.abs(1-this.x*this.x-this.y*this.y-this.z*this.z));return this},inverse:function(){this.x*=-1;this.y*=-1;this.z*=-1;return this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var a=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);a===0?this.w=this.z=this.y=this.x=0:(a=1/a,this.x*=a,this.y*=a,this.z*=a,this.w*=a);return this},multiplySelf:function(f){var h=this.x,g=this.y,q=this.z,b=this.w,a=f.x,r=f.y,e=f.z,f=f.w;this.x=h*f+b*a+g*e-q*r;this.y=g*f+b*r+q*a-h*e;this.z=q*f+b*e+h*r-g*a;this.w=b*f-h*a-g*r-q*e;return this},multiply:function(b,a){this.x=b.x*a.w+b.y*a.z-b.z*a.y+b.w*a.x;this.y=-b.x*a.z+b.y*a.w+b.z*a.x+b.w*a.y;this.z=b.x*a.y-b.y*a.x+b.z*a.w+b.w*a.z;this.w=-b.x*a.x-b.y*a.y-b.z*a.z+b.w*a.w;return this},multiplyVector3:function(k,o){o||(o=k);var l=k.x,y=k.y,a=k.z,A=this.x,z=this.y,b=this.z,e=this.w,g=e*l+z*a-b*y,f=e*y+b*l-A*a,h=e*a+A*y-z*l,l=-A*l-z*y-b*a;o.x=g*e+l*-A+f*-b-h*-z;o.y=f*e+l*-z+h*-A-g*-b;o.z=h*e+l*-b+g*-z-f*-A;return o}};c.Quaternion.slerp=function(m,a,n,b){var g=m.w*a.w+m.x*a.x+m.y*a.y+m.z*a.z;g<0?(n.w=-a.w,n.x=-a.x,n.y=-a.y,n.z=-a.z,g=-g):n.copy(a);if(Math.abs(g)>=1){return n.w=m.w,n.x=m.x,n.y=m.y,n.z=m.z,n}var f=Math.acos(g),g=Math.sqrt(1-g*g);if(Math.abs(g)<0.001){return n.w=0.5*(m.w+a.w),n.x=0.5*(m.x+a.x),n.y=0.5*(m.y+a.y),n.z=0.5*(m.z+a.z),n}a=Math.sin((1-b)*f)/g;b=Math.sin(b*f)/g;n.w=m.w*a+n.w*b;n.x=m.x*a+n.x*b;n.y=m.y*a+n.y*b;n.z=m.z*a+n.z*b;return n};c.Vertex=function(a){this.position=a||new c.Vector3};c.Face3=function(m,a,n,b,g,f){this.a=m;this.b=a;this.c=n;this.normal=b instanceof c.Vector3?b:new c.Vector3;this.vertexNormals=b instanceof Array?b:[];this.color=g instanceof c.Color?g:new c.Color;this.vertexColors=g instanceof Array?g:[];this.vertexTangents=[];this.materialIndex=f;this.centroid=new c.Vector3};c.Face4=function(g,p,o,a,f,e,b){this.a=g;this.b=p;this.c=o;this.d=a;this.normal=f instanceof c.Vector3?f:new c.Vector3;this.vertexNormals=f instanceof Array?f:[];this.color=e instanceof c.Color?e:new c.Color;this.vertexColors=e instanceof Array?e:[];this.vertexTangents=[];this.materialIndex=b;this.centroid=new c.Vector3};c.UV=function(b,a){this.u=b||0;this.v=a||0};c.UV.prototype={constructor:c.UV,set:function(b,a){this.u=b;this.v=a;return this},copy:function(a){this.u=a.u;this.v=a.v;return this},clone:function(){return new c.UV(this.u,this.v)}};c.Geometry=function(){this.id=c.GeometryCount++;this.vertices=[];this.colors=[];this.materials=[];this.faces=[];this.faceUvs=[[]];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphColors=[];this.skinWeights=[];this.skinIndices=[];this.boundingSphere=this.boundingBox=null;this.dynamic=this.hasTangents=!1};c.Geometry.prototype={constructor:c.Geometry,applyMatrix:function(g){var p=new c.Matrix4;p.extractRotation(g,new c.Vector3(1,1,1));for(var o=0,a=this.vertices.length;o<a;o++){g.multiplyVector3(this.vertices[o].position)}o=0;for(a=this.faces.length;o<a;o++){var f=this.faces[o];p.multiplyVector3(f.normal);for(var e=0,b=f.vertexNormals.length;e<b;e++){p.multiplyVector3(f.vertexNormals[e])}g.multiplyVector3(f.centroid)}},computeCentroids:function(){var b,a,g;b=0;for(a=this.faces.length;b<a;b++){g=this.faces[b],g.centroid.set(0,0,0),g instanceof c.Face3?(g.centroid.addSelf(this.vertices[g.a].position),g.centroid.addSelf(this.vertices[g.b].position),g.centroid.addSelf(this.vertices[g.c].position),g.centroid.divideScalar(3)):g instanceof c.Face4&&(g.centroid.addSelf(this.vertices[g.a].position),g.centroid.addSelf(this.vertices[g.b].position),g.centroid.addSelf(this.vertices[g.c].position),g.centroid.addSelf(this.vertices[g.d].position),g.centroid.divideScalar(4))}},computeFaceNormals:function(){var f,h,g,q,b,a,r=new c.Vector3,e=new c.Vector3;f=0;for(h=this.faces.length;f<h;f++){g=this.faces[f],q=this.vertices[g.a],b=this.vertices[g.b],a=this.vertices[g.c],r.sub(a.position,b.position),e.sub(q.position,b.position),r.crossSelf(e),r.isZero()||r.normalize(),g.normal.copy(r)}},computeVertexNormals:function(){var j,a,k,b;if(this.__tmpVertices===void 0){b=this.__tmpVertices=Array(this.vertices.length);j=0;for(a=this.vertices.length;j<a;j++){b[j]=new c.Vector3}j=0;for(a=this.faces.length;j<a;j++){if(k=this.faces[j],k instanceof c.Face3){k.vertexNormals=[new c.Vector3,new c.Vector3,new c.Vector3]}else{if(k instanceof c.Face4){k.vertexNormals=[new c.Vector3,new c.Vector3,new c.Vector3,new c.Vector3]}}}}else{b=this.__tmpVertices;j=0;for(a=this.vertices.length;j<a;j++){b[j].set(0,0,0)}}j=0;for(a=this.faces.length;j<a;j++){k=this.faces[j],k instanceof c.Face3?(b[k.a].addSelf(k.normal),b[k.b].addSelf(k.normal),b[k.c].addSelf(k.normal)):k instanceof c.Face4&&(b[k.a].addSelf(k.normal),b[k.b].addSelf(k.normal),b[k.c].addSelf(k.normal),b[k.d].addSelf(k.normal))}j=0;for(a=this.vertices.length;j<a;j++){b[j].normalize()}j=0;for(a=this.faces.length;j<a;j++){k=this.faces[j],k instanceof c.Face3?(k.vertexNormals[0].copy(b[k.a]),k.vertexNormals[1].copy(b[k.b]),k.vertexNormals[2].copy(b[k.c])):k instanceof c.Face4&&(k.vertexNormals[0].copy(b[k.a]),k.vertexNormals[1].copy(b[k.b]),k.vertexNormals[2].copy(b[k.c]),k.vertexNormals[3].copy(b[k.d]))}},computeTangents:function(){function w(G,H,I,j,C,z,D){K=G.vertices[H].position;P=G.vertices[I].position;U=G.vertices[j].position;R=E[C];af=E[z];a=E[D];ad=P.x-K.x;g=U.x-K.x;ae=P.y-K.y;e=U.y-K.y;k=P.z-K.z;p=U.z-K.z;m=af.u-R.u;f=a.u-R.u;n=af.v-R.v;b=a.v-R.v;r=1/(m*b-f*n);h.set((b*ad-n*g)*r,(b*ae-n*e)*r,(b*k-n*p)*r);l.set((m*g-f*ad)*r,(m*e-f*ae)*r,(m*p-f*k)*r);o[H].addSelf(h);o[I].addSelf(h);o[j].addSelf(h);t[H].addSelf(l);t[I].addSelf(l);t[j].addSelf(l)}var y,x,B,J,F,E,K,P,U,R,af,a,ad,g,ae,e,k,p,m,f,n,b,r,s,o=[],t=[],h=new c.Vector3,l=new c.Vector3,q=new c.Vector3,A=new c.Vector3,u=new c.Vector3;y=0;for(x=this.vertices.length;y<x;y++){o[y]=new c.Vector3,t[y]=new c.Vector3}y=0;for(x=this.faces.length;y<x;y++){F=this.faces[y],E=this.faceVertexUvs[0][y],F instanceof c.Face3?w(this,F.a,F.b,F.c,0,1,2):F instanceof c.Face4&&(w(this,F.a,F.b,F.c,0,1,2),w(this,F.a,F.b,F.d,0,1,3))}var v=["a","b","c","d"];y=0;for(x=this.faces.length;y<x;y++){F=this.faces[y];for(B=0;B<F.vertexNormals.length;B++){u.copy(F.vertexNormals[B]),J=F[v[B]],s=o[J],q.copy(s),q.subSelf(u.multiplyScalar(u.dot(s))).normalize(),A.cross(F.vertexNormals[B],s),J=A.dot(t[J]),J=J<0?-1:1,F.vertexTangents[B]=new c.Vector4(q.x,q.y,q.z,J)}}this.hasTangents=!0},computeBoundingBox:function(){var b;if(this.vertices.length>0){this.boundingBox={x:[this.vertices[0].position.x,this.vertices[0].position.x],y:[this.vertices[0].position.y,this.vertices[0].position.y],z:[this.vertices[0].position.z,this.vertices[0].position.z]};for(var a=1,g=this.vertices.length;a<g;a++){b=this.vertices[a];if(b.position.x<this.boundingBox.x[0]){this.boundingBox.x[0]=b.position.x}else{if(b.position.x>this.boundingBox.x[1]){this.boundingBox.x[1]=b.position.x}}if(b.position.y<this.boundingBox.y[0]){this.boundingBox.y[0]=b.position.y}else{if(b.position.y>this.boundingBox.y[1]){this.boundingBox.y[1]=b.position.y}}if(b.position.z<this.boundingBox.z[0]){this.boundingBox.z[0]=b.position.z}else{if(b.position.z>this.boundingBox.z[1]){this.boundingBox.z[1]=b.position.z}}}}},computeBoundingSphere:function(){for(var b=0,a=0,g=this.vertices.length;a<g;a++){b=Math.max(b,this.vertices[a].position.length())}this.boundingSphere={radius:b}},mergeVertices:function(){var g={},p=[],o=[],a,f=Math.pow(10,4),e,b;e=0;for(b=this.vertices.length;e<b;e++){a=this.vertices[e].position,a=[Math.round(a.x*f),Math.round(a.y*f),Math.round(a.z*f)].join("_"),g[a]===void 0?(g[a]=e,p.push(this.vertices[e]),o[e]=p.length-1):o[e]=o[g[a]]}e=0;for(b=this.faces.length;e<b;e++){if(g=this.faces[e],g instanceof c.Face3){g.a=o[g.a],g.b=o[g.b],g.c=o[g.c]}else{if(g instanceof c.Face4){g.a=o[g.a],g.b=o[g.b],g.c=o[g.c],g.d=o[g.d]}}}this.vertices=p}};c.GeometryCount=0;c.Spline=function(h){function l(q,r,j,s,n,m,t){q=(j-q)*0.5;s=(s-r)*0.5;return(2*(r-j)+q+s)*t+(-3*(r-j)-2*q-s)*m+q*n+r}this.points=h;var k=[],o={x:0,y:0,z:0},B,A,p,C,a,e,b,f,g;this.initFromArray=function(j){this.points=[];for(var m=0;m<j.length;m++){this.points[m]={x:j[m][0],y:j[m][1],z:j[m][2]}}};this.getPoint=function(j){B=(this.points.length-1)*j;A=Math.floor(B);p=B-A;k[0]=A===0?A:A-1;k[1]=A;k[2]=A>this.points.length-2?A:A+1;k[3]=A>this.points.length-3?A:A+2;e=this.points[k[0]];b=this.points[k[1]];f=this.points[k[2]];g=this.points[k[3]];C=p*p;a=p*C;o.x=l(e.x,b.x,f.x,g.x,p,C,a);o.y=l(e.y,b.y,f.y,g.y,p,C,a);o.z=l(e.z,b.z,f.z,g.z,p,C,a);return o};this.getControlPointsArray=function(){var n,q,j=this.points.length,m=[];for(n=0;n<j;n++){q=this.points[n],m[n]=[q.x,q.y,q.z]}return m};this.getLength=function(v){var j,m,n,r=j=j=0,q=new c.Vector3,s=new c.Vector3,t=[],u=0;t[0]=0;v||(v=100);m=this.points.length*v;q.copy(this.points[0]);for(v=1;v<m;v++){j=v/m,n=this.getPoint(j),s.copy(n),u+=s.distanceTo(q),q.copy(n),j*=this.points.length-1,j=Math.floor(j),j!=r&&(t[j]=u,r=j)}t[t.length]=u;return{chunks:t,total:u}};this.reparametrizeByArcLength=function(u){var v,w,j,s,n,m,q=[],r=new c.Vector3,t=this.getLength();q.push(r.copy(this.points[0]).clone());for(v=1;v<this.points.length;v++){w=t.chunks[v]-t.chunks[v-1];m=Math.ceil(u*w/t.total);s=(v-1)/(this.points.length-1);n=v/(this.points.length-1);for(w=1;w<m-1;w++){j=s+w*(1/m)*(n-s),j=this.getPoint(j),q.push(r.copy(j).clone())}q.push(r.copy(this.points[v]).clone())}this.points=q}};c.Edge=function(j,a,k,b){this.vertices=[j,a];this.vertexIndices=[k,b];this.faces=[];this.faceIndices=[]};c.Camera=function(){if(arguments.length){return console.warn("DEPRECATED: Camera() is now PerspectiveCamera() or OrthographicCamera()."),new c.PerspectiveCamera(arguments[0],arguments[1],arguments[2],arguments[3])}c.Object3D.call(this);this.matrixWorldInverse=new c.Matrix4;this.projectionMatrix=new c.Matrix4;this.projectionMatrixInverse=new c.Matrix4};c.Camera.prototype=new c.Object3D;c.Camera.prototype.constructor=c.Camera;c.Camera.prototype.lookAt=function(a){this.matrix.lookAt(this.position,a,this.up);this.rotationAutoUpdate&&this.rotation.setRotationFromMatrix(this.matrix)};c.OrthographicCamera=function(m,a,n,b,g,f){c.Camera.call(this);this.left=m;this.right=a;this.top=n;this.bottom=b;this.near=g!==void 0?g:0.1;this.far=f!==void 0?f:2000;this.updateProjectionMatrix()};c.OrthographicCamera.prototype=new c.Camera;c.OrthographicCamera.prototype.constructor=c.OrthographicCamera;c.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix=c.Matrix4.makeOrtho(this.left,this.right,this.top,this.bottom,this.near,this.far)};c.PerspectiveCamera=function(j,a,k,b){c.Camera.call(this);this.fov=j!==void 0?j:50;this.aspect=a!==void 0?a:1;this.near=k!==void 0?k:0.1;this.far=b!==void 0?b:2000;this.updateProjectionMatrix()};c.PerspectiveCamera.prototype=new c.Camera;c.PerspectiveCamera.prototype.constructor=c.PerspectiveCamera;c.PerspectiveCamera.prototype.setLens=function(b,a){this.fov=2*Math.atan((a!==void 0?a:43.25)/(b*2));this.fov*=180/Math.PI;this.updateProjectionMatrix()};c.PerspectiveCamera.prototype.setViewOffset=function(m,a,n,b,g,f){this.fullWidth=m;this.fullHeight=a;this.x=n;this.y=b;this.width=g;this.height=f;this.updateProjectionMatrix()};c.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var j=this.fullWidth/this.fullHeight,a=Math.tan(this.fov*Math.PI/360)*this.near,k=-a,b=j*k,j=Math.abs(j*a-b),k=Math.abs(a-k);this.projectionMatrix=c.Matrix4.makeFrustum(b+this.x*j/this.fullWidth,b+(this.x+this.width)*j/this.fullWidth,a-(this.y+this.height)*k/this.fullHeight,a-this.y*k/this.fullHeight,this.near,this.far)}else{this.projectionMatrix=c.Matrix4.makePerspective(this.fov,this.aspect,this.near,this.far)}};c.Light=function(a){c.Object3D.call(this);this.color=new c.Color(a)};c.Light.prototype=new c.Object3D;c.Light.prototype.constructor=c.Light;c.Light.prototype.supr=c.Object3D.prototype;c.AmbientLight=function(a){c.Light.call(this,a)};c.AmbientLight.prototype=new c.Light;c.AmbientLight.prototype.constructor=c.AmbientLight;c.DirectionalLight=function(b,a,g){c.Light.call(this,b);this.position=new c.Vector3(0,1,0);this.intensity=a!==void 0?a:1;this.distance=g!==void 0?g:0};c.DirectionalLight.prototype=new c.Light;c.DirectionalLight.prototype.constructor=c.DirectionalLight;c.PointLight=function(b,a,g){c.Light.call(this,b);this.position=new c.Vector3(0,0,0);this.intensity=a!==void 0?a:1;this.distance=g!==void 0?g:0};c.PointLight.prototype=new c.Light;c.PointLight.prototype.constructor=c.PointLight;c.SpotLight=function(j,a,k,b){c.Light.call(this,j);this.position=new c.Vector3(0,1,0);this.target=new c.Object3D;this.intensity=a!==void 0?a:1;this.distance=k!==void 0?k:0;this.castShadow=b!==void 0?b:!1};c.SpotLight.prototype=new c.Light;c.SpotLight.prototype.constructor=c.SpotLight;c.Material=function(a){this.name="";this.id=c.MaterialCount++;a=a||{};this.opacity=a.opacity!==void 0?a.opacity:1;this.transparent=a.transparent!==void 0?a.transparent:!1;this.blending=a.blending!==void 0?a.blending:c.NormalBlending;this.depthTest=a.depthTest!==void 0?a.depthTest:!0;this.depthWrite=a.depthWrite!==void 0?a.depthWrite:!0;this.polygonOffset=a.polygonOffset!==void 0?a.polygonOffset:!1;this.polygonOffsetFactor=a.polygonOffsetFactor!==void 0?a.polygonOffsetFactor:0;this.polygonOffsetUnits=a.polygonOffsetUnits!==void 0?a.polygonOffsetUnits:0;this.alphaTest=a.alphaTest!==void 0?a.alphaTest:0;this.overdraw=a.overdraw!==void 0?a.overdraw:!1};c.MaterialCount=0;c.NoShading=0;c.FlatShading=1;c.SmoothShading=2;c.NoColors=0;c.FaceColors=1;c.VertexColors=2;c.NormalBlending=0;c.AdditiveBlending=1;c.SubtractiveBlending=2;c.MultiplyBlending=3;c.AdditiveAlphaBlending=4;c.LineBasicMaterial=function(a){c.Material.call(this,a);a=a||{};this.color=a.color!==void 0?new c.Color(a.color):new c.Color(16777215);this.linewidth=a.linewidth!==void 0?a.linewidth:1;this.linecap=a.linecap!==void 0?a.linecap:"round";this.linejoin=a.linejoin!==void 0?a.linejoin:"round";this.vertexColors=a.vertexColors?a.vertexColors:!1;this.fog=a.fog!==void 0?a.fog:!0};c.LineBasicMaterial.prototype=new c.Material;c.LineBasicMaterial.prototype.constructor=c.LineBasicMaterial;c.MeshBasicMaterial=function(a){c.Material.call(this,a);a=a||{};this.color=a.color!==void 0?new c.Color(a.color):new c.Color(16777215);this.map=a.map!==void 0?a.map:null;this.lightMap=a.lightMap!==void 0?a.lightMap:null;this.envMap=a.envMap!==void 0?a.envMap:null;this.combine=a.combine!==void 0?a.combine:c.MultiplyOperation;this.reflectivity=a.reflectivity!==void 0?a.reflectivity:1;this.refractionRatio=a.refractionRatio!==void 0?a.refractionRatio:0.98;this.fog=a.fog!==void 0?a.fog:!0;this.shading=a.shading!==void 0?a.shading:c.SmoothShading;this.wireframe=a.wireframe!==void 0?a.wireframe:!1;this.wireframeLinewidth=a.wireframeLinewidth!==void 0?a.wireframeLinewidth:1;this.wireframeLinecap=a.wireframeLinecap!==void 0?a.wireframeLinecap:"round";this.wireframeLinejoin=a.wireframeLinejoin!==void 0?a.wireframeLinejoin:"round";this.vertexColors=a.vertexColors!==void 0?a.vertexColors:!1;this.skinning=a.skinning!==void 0?a.skinning:!1;this.morphTargets=a.morphTargets!==void 0?a.morphTargets:!1};c.MeshBasicMaterial.prototype=new c.Material;c.MeshBasicMaterial.prototype.constructor=c.MeshBasicMaterial;c.MeshLambertMaterial=function(a){c.Material.call(this,a);a=a||{};this.color=a.color!==void 0?new c.Color(a.color):new c.Color(16777215);this.ambient=a.ambient!==void 0?new c.Color(a.ambient):new c.Color(328965);this.map=a.map!==void 0?a.map:null;this.lightMap=a.lightMap!==void 0?a.lightMap:null;this.envMap=a.envMap!==void 0?a.envMap:null;this.combine=a.combine!==void 0?a.combine:c.MultiplyOperation;this.reflectivity=a.reflectivity!==void 0?a.reflectivity:1;this.refractionRatio=a.refractionRatio!==void 0?a.refractionRatio:0.98;this.fog=a.fog!==void 0?a.fog:!0;this.shading=a.shading!==void 0?a.shading:c.SmoothShading;this.wireframe=a.wireframe!==void 0?a.wireframe:!1;this.wireframeLinewidth=a.wireframeLinewidth!==void 0?a.wireframeLinewidth:1;this.wireframeLinecap=a.wireframeLinecap!==void 0?a.wireframeLinecap:"round";this.wireframeLinejoin=a.wireframeLinejoin!==void 0?a.wireframeLinejoin:"round";this.vertexColors=a.vertexColors!==void 0?a.vertexColors:!1;this.skinning=a.skinning!==void 0?a.skinning:!1;this.morphTargets=a.morphTargets!==void 0?a.morphTargets:!1};c.MeshLambertMaterial.prototype=new c.Material;c.MeshLambertMaterial.prototype.constructor=c.MeshLambertMaterial;c.MeshPhongMaterial=function(a){c.Material.call(this,a);a=a||{};this.color=a.color!==void 0?new c.Color(a.color):new c.Color(16777215);this.ambient=a.ambient!==void 0?new c.Color(a.ambient):new c.Color(328965);this.specular=a.specular!==void 0?new c.Color(a.specular):new c.Color(1118481);this.shininess=a.shininess!==void 0?a.shininess:30;this.metal=a.metal!==void 0?a.metal:!1;this.perPixel=a.perPixel!==void 0?a.perPixel:!1;this.map=a.map!==void 0?a.map:null;this.lightMap=a.lightMap!==void 0?a.lightMap:null;this.envMap=a.envMap!==void 0?a.envMap:null;this.combine=a.combine!==void 0?a.combine:c.MultiplyOperation;this.reflectivity=a.reflectivity!==void 0?a.reflectivity:1;this.refractionRatio=a.refractionRatio!==void 0?a.refractionRatio:0.98;this.fog=a.fog!==void 0?a.fog:!0;this.shading=a.shading!==void 0?a.shading:c.SmoothShading;this.wireframe=a.wireframe!==void 0?a.wireframe:!1;this.wireframeLinewidth=a.wireframeLinewidth!==void 0?a.wireframeLinewidth:1;this.wireframeLinecap=a.wireframeLinecap!==void 0?a.wireframeLinecap:"round";this.wireframeLinejoin=a.wireframeLinejoin!==void 0?a.wireframeLinejoin:"round";this.vertexColors=a.vertexColors!==void 0?a.vertexColors:!1;this.skinning=a.skinning!==void 0?a.skinning:!1;this.morphTargets=a.morphTargets!==void 0?a.morphTargets:!1};c.MeshPhongMaterial.prototype=new c.Material;c.MeshPhongMaterial.prototype.constructor=c.MeshPhongMaterial;c.MeshDepthMaterial=function(a){c.Material.call(this,a);a=a||{};this.shading=a.shading!==void 0?a.shading:c.SmoothShading;this.wireframe=a.wireframe!==void 0?a.wireframe:!1;this.wireframeLinewidth=a.wireframeLinewidth!==void 0?a.wireframeLinewidth:1};c.MeshDepthMaterial.prototype=new c.Material;c.MeshDepthMaterial.prototype.constructor=c.MeshDepthMaterial;c.MeshNormalMaterial=function(a){c.Material.call(this,a);a=a||{};this.shading=a.shading?a.shading:c.FlatShading;this.wireframe=a.wireframe?a.wireframe:!1;this.wireframeLinewidth=a.wireframeLinewidth?a.wireframeLinewidth:1};c.MeshNormalMaterial.prototype=new c.Material;c.MeshNormalMaterial.prototype.constructor=c.MeshNormalMaterial;c.MeshFaceMaterial=function(){};c.MeshShaderMaterial=function(a){console.warn("DEPRECATED: MeshShaderMaterial() is now ShaderMaterial().");return new c.ShaderMaterial(a)};c.ParticleBasicMaterial=function(a){c.Material.call(this,a);a=a||{};this.color=a.color!==void 0?new c.Color(a.color):new c.Color(16777215);this.map=a.map!==void 0?a.map:null;this.size=a.size!==void 0?a.size:1;this.sizeAttenuation=a.sizeAttenuation!==void 0?a.sizeAttenuation:!0;this.vertexColors=a.vertexColors!==void 0?a.vertexColors:!1;this.fog=a.fog!==void 0?a.fog:!0};c.ParticleBasicMaterial.prototype=new c.Material;c.ParticleBasicMaterial.prototype.constructor=c.ParticleBasicMaterial;c.ParticleCanvasMaterial=function(a){c.Material.call(this,a);a=a||{};this.color=a.color!==void 0?new c.Color(a.color):new c.Color(16777215);this.program=a.program!==void 0?a.program:function(){}};c.ParticleCanvasMaterial.prototype=new c.Material;c.ParticleCanvasMaterial.prototype.constructor=c.ParticleCanvasMaterial;c.ParticleDOMMaterial=function(a){c.Material.call(this);this.domElement=a};c.ShaderMaterial=function(a){c.Material.call(this,a);a=a||{};this.fragmentShader=a.fragmentShader!==void 0?a.fragmentShader:"void main() {}";this.vertexShader=a.vertexShader!==void 0?a.vertexShader:"void main() {}";this.uniforms=a.uniforms!==void 0?a.uniforms:{};this.attributes=a.attributes;this.shading=a.shading!==void 0?a.shading:c.SmoothShading;this.wireframe=a.wireframe!==void 0?a.wireframe:!1;this.wireframeLinewidth=a.wireframeLinewidth!==void 0?a.wireframeLinewidth:1;this.fog=a.fog!==void 0?a.fog:!1;this.lights=a.lights!==void 0?a.lights:!1;this.vertexColors=a.vertexColors!==void 0?a.vertexColors:!1;this.skinning=a.skinning!==void 0?a.skinning:!1;this.morphTargets=a.morphTargets!==void 0?a.morphTargets:!1};c.ShaderMaterial.prototype=new c.Material;c.ShaderMaterial.prototype.constructor=c.ShaderMaterial;c.Texture=function(m,a,n,b,g,f){this.id=c.TextureCount++;this.image=m;this.mapping=a!==void 0?a:new c.UVMapping;this.wrapS=n!==void 0?n:c.ClampToEdgeWrapping;this.wrapT=b!==void 0?b:c.ClampToEdgeWrapping;this.magFilter=g!==void 0?g:c.LinearFilter;this.minFilter=f!==void 0?f:c.LinearMipMapLinearFilter;this.offset=new c.Vector2(0,0);this.repeat=new c.Vector2(1,1);this.needsUpdate=!1;this.onUpdate=null};c.Texture.prototype={constructor:c.Texture,clone:function(){var a=new c.Texture(this.image,this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter);a.offset.copy(this.offset);a.repeat.copy(this.repeat);return a}};c.TextureCount=0;c.MultiplyOperation=0;c.MixOperation=1;c.CubeReflectionMapping=function(){};c.CubeRefractionMapping=function(){};c.LatitudeReflectionMapping=function(){};c.LatitudeRefractionMapping=function(){};c.SphericalReflectionMapping=function(){};c.SphericalRefractionMapping=function(){};c.UVMapping=function(){};c.RepeatWrapping=0;c.ClampToEdgeWrapping=1;c.MirroredRepeatWrapping=2;c.NearestFilter=3;c.NearestMipMapNearestFilter=4;c.NearestMipMapLinearFilter=5;c.LinearFilter=6;c.LinearMipMapNearestFilter=7;c.LinearMipMapLinearFilter=8;c.ByteType=9;c.UnsignedByteType=10;c.ShortType=11;c.UnsignedShortType=12;c.IntType=13;c.UnsignedIntType=14;c.FloatType=15;c.AlphaFormat=16;c.RGBFormat=17;c.RGBAFormat=18;c.LuminanceFormat=19;c.LuminanceAlphaFormat=20;c.DataTexture=function(a,e,b,f,s,h,g,t,u){c.Texture.call(this,null,s,h,g,t,u);this.image={data:a,width:e,height:b};this.format=f!==void 0?f:c.RGBAFormat};c.DataTexture.prototype=new c.Texture;c.DataTexture.prototype.constructor=c.DataTexture;c.DataTexture.prototype.clone=function(){var a=new c.DataTexture(this.data.slice(0),this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter);a.offset.copy(this.offset);a.repeat.copy(this.repeat);return a};c.Particle=function(a){c.Object3D.call(this);this.material=a};c.Particle.prototype=new c.Object3D;c.Particle.prototype.constructor=c.Particle;c.ParticleSystem=function(b,a){c.Object3D.call(this);this.geometry=b;this.material=a;this.sortParticles=!1};c.ParticleSystem.prototype=new c.Object3D;c.ParticleSystem.prototype.constructor=c.ParticleSystem;c.Line=function(b,a,g){c.Object3D.call(this);this.geometry=b;this.material=a;this.type=g!==void 0?g:c.LineStrip;this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere())};c.LineStrip=0;c.LinePieces=1;c.Line.prototype=new c.Object3D;c.Line.prototype.constructor=c.Line;c.Mesh=function(b,a){c.Object3D.call(this);this.geometry=b;this.material=a;if(a instanceof Array){console.warn("DEPRECATED: Mesh material can no longer be an Array. Using material at index 0..."),this.material=a[0]}if(this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere(),this.boundRadius=b.boundingSphere.radius,this.geometry.morphTargets.length)){this.morphTargetBase=-1;this.morphTargetForcedOrder=[];this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var g=0;g<this.geometry.morphTargets.length;g++){this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[g].name]=g}}};c.Mesh.prototype=new c.Object3D;c.Mesh.prototype.constructor=c.Mesh;c.Mesh.prototype.supr=c.Object3D.prototype;c.Mesh.prototype.getMorphTargetIndexByName=function(a){if(this.morphTargetDictionary[a]!==void 0){return this.morphTargetDictionary[a]}console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+a+" does not exist. Returning 0.");return 0};c.Bone=function(a){c.Object3D.call(this);this.skin=a;this.skinMatrix=new c.Matrix4};c.Bone.prototype=new c.Object3D;c.Bone.prototype.constructor=c.Bone;c.Bone.prototype.supr=c.Object3D.prototype;c.Bone.prototype.update=function(j,a){this.matrixAutoUpdate&&(a|=this.updateMatrix());if(a||this.matrixWorldNeedsUpdate){j?this.skinMatrix.multiply(j,this.matrix):this.skinMatrix.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,a=!0}var k,b=this.children.length;for(k=0;k<b;k++){this.children[k].update(this.skinMatrix,a)}};c.SkinnedMesh=function(f,h){c.Mesh.call(this,f,h);this.identityMatrix=new c.Matrix4;this.bones=[];this.boneMatrices=[];var g,q,b,a,r,e;if(this.geometry.bones!==void 0){for(g=0;g<this.geometry.bones.length;g++){b=this.geometry.bones[g],a=b.pos,r=b.rotq,e=b.scl,q=this.addBone(),q.name=b.name,q.position.set(a[0],a[1],a[2]),q.quaternion.set(r[0],r[1],r[2],r[3]),q.useQuaternion=!0,e!==void 0?q.scale.set(e[0],e[1],e[2]):q.scale.set(1,1,1)}for(g=0;g<this.bones.length;g++){b=this.geometry.bones[g],q=this.bones[g],b.parent===-1?this.add(q):this.bones[b.parent].add(q)}this.boneMatrices=new Float32Array(16*this.bones.length);this.pose()}};c.SkinnedMesh.prototype=new c.Mesh;c.SkinnedMesh.prototype.constructor=c.SkinnedMesh;c.SkinnedMesh.prototype.addBone=function(a){a===void 0&&(a=new c.Bone(this));this.bones.push(a);return a};c.SkinnedMesh.prototype.updateMatrixWorld=function(j){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||j){this.parent?this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1}for(var j=0,a=this.children.length;j<a;j++){var k=this.children[j];k instanceof c.Bone?k.update(this.identityMatrix,!1):k.updateMatrixWorld(!0)}for(var a=this.bones.length,k=this.bones,b=this.boneMatrices,j=0;j<a;j++){k[j].skinMatrix.flattenToArrayOffset(b,j*16)}};c.SkinnedMesh.prototype.pose=function(){this.updateMatrixWorld(!0);for(var m,a=[],n=0;n<this.bones.length;n++){m=this.bones[n];var b=new c.Matrix4;b.getInverse(m.skinMatrix);a.push(b);m.skinMatrix.flattenToArrayOffset(this.boneMatrices,n*16)}if(this.geometry.skinVerticesA===void 0){this.geometry.skinVerticesA=[];this.geometry.skinVerticesB=[];for(m=0;m<this.geometry.skinIndices.length;m++){var n=this.geometry.vertices[m].position,g=this.geometry.skinIndices[m].x,f=this.geometry.skinIndices[m].y,b=new c.Vector3(n.x,n.y,n.z);this.geometry.skinVerticesA.push(a[g].multiplyVector3(b));b=new c.Vector3(n.x,n.y,n.z);this.geometry.skinVerticesB.push(a[f].multiplyVector3(b));this.geometry.skinWeights[m].x+this.geometry.skinWeights[m].y!==1&&(n=(1-(this.geometry.skinWeights[m].x+this.geometry.skinWeights[m].y))*0.5,this.geometry.skinWeights[m].x+=n,this.geometry.skinWeights[m].y+=n)}}};c.MorphAnimMesh=function(b,a){c.Mesh.call(this,b,a);this.duration=1000;this.mirroredLoop=!1;this.currentKeyframe=this.lastKeyframe=this.time=0;this.direction=1;this.directionBackwards=!1};c.MorphAnimMesh.prototype=new c.Mesh;c.MorphAnimMesh.prototype.constructor=c.MorphAnimMesh;c.MorphAnimMesh.prototype.updateAnimation=function(b){var a=this.duration/(this.geometry.morphTargets.length-1);this.time+=this.direction*b;if(this.mirroredLoop){if(this.time>this.duration||this.time<0){this.direction*=-1;if(this.time>this.duration){this.time=this.duration,this.directionBackwards=!0}if(this.time<0){this.time=0,this.directionBackwards=!1}}}else{this.time%=this.duration}b=c.Math.clamp(Math.floor(this.time/a),0,this.geometry.morphTargets.length-1);if(b!=this.currentKeyframe){this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[b]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=b}a=this.time%a/a;this.directionBackwards&&(a=1-a);this.morphTargetInfluences[this.currentKeyframe]=a;this.morphTargetInfluences[this.lastKeyframe]=1-a};c.Ribbon=function(b,a){c.Object3D.call(this);this.geometry=b;this.material=a};c.Ribbon.prototype=new c.Object3D;c.Ribbon.prototype.constructor=c.Ribbon;c.LOD=function(){c.Object3D.call(this);this.LODs=[]};c.LOD.prototype=new c.Object3D;c.LOD.prototype.constructor=c.LOD;c.LOD.prototype.supr=c.Object3D.prototype;c.LOD.prototype.addLevel=function(b,a){a===void 0&&(a=0);for(var a=Math.abs(a),g=0;g<this.LODs.length;g++){if(a<this.LODs[g].visibleAtDistance){break}}this.LODs.splice(g,0,{visibleAtDistance:a,object3D:b});this.add(b)};c.LOD.prototype.update=function(b){if(this.LODs.length>1){b.matrixWorldInverse.getInverse(b.matrixWorld);b=b.matrixWorldInverse;b=-(b.n31*this.position.x+b.n32*this.position.y+b.n33*this.position.z+b.n34);this.LODs[0].object3D.visible=!0;for(var a=1;a<this.LODs.length;a++){if(b>=this.LODs[a].visibleAtDistance){this.LODs[a-1].object3D.visible=!1,this.LODs[a].object3D.visible=!0}else{break}}for(;a<this.LODs.length;a++){this.LODs[a].object3D.visible=!1}}};c.Sprite=function(a){c.Object3D.call(this);this.color=a.color!==void 0?new c.Color(a.color):new c.Color(16777215);this.map=a.map instanceof c.Texture?a.map:c.ImageUtils.loadTexture(a.map);this.blending=a.blending!==void 0?a.blending:c.NormalBlending;this.useScreenCoordinates=a.useScreenCoordinates!==void 0?a.useScreenCoordinates:!0;this.mergeWith3D=a.mergeWith3D!==void 0?a.mergeWith3D:!this.useScreenCoordinates;this.affectedByDistance=a.affectedByDistance!==void 0?a.affectedByDistance:!this.useScreenCoordinates;this.scaleByViewport=a.scaleByViewport!==void 0?a.scaleByViewport:!this.affectedByDistance;this.alignment=a.alignment instanceof c.Vector2?a.alignment:c.SpriteAlignment.center;this.rotation3d=this.rotation;this.rotation=0;this.opacity=1;this.uvOffset=new c.Vector2(0,0);this.uvScale=new c.Vector2(1,1)};c.Sprite.prototype=new c.Object3D;c.Sprite.prototype.constructor=c.Sprite;c.Sprite.prototype.updateMatrix=function(){this.matrix.setPosition(this.position);this.rotation3d.set(0,0,this.rotation);this.matrix.setRotationFromEuler(this.rotation3d);if(this.scale.x!==1||this.scale.y!==1){this.matrix.scale(this.scale),this.boundRadiusScale=Math.max(this.scale.x,this.scale.y)}this.matrixWorldNeedsUpdate=!0};c.SpriteAlignment={};c.SpriteAlignment.topLeft=new c.Vector2(1,-1);c.SpriteAlignment.topCenter=new c.Vector2(0,-1);c.SpriteAlignment.topRight=new c.Vector2(-1,-1);c.SpriteAlignment.centerLeft=new c.Vector2(1,0);c.SpriteAlignment.center=new c.Vector2(0,0);c.SpriteAlignment.centerRight=new c.Vector2(-1,0);c.SpriteAlignment.bottomLeft=new c.Vector2(1,1);c.SpriteAlignment.bottomCenter=new c.Vector2(0,1);c.SpriteAlignment.bottomRight=new c.Vector2(-1,1);c.Scene=function(){c.Object3D.call(this);this.overrideMaterial=this.fog=null;this.matrixAutoUpdate=!1;this.objects=[];this.lights=[];this.__objectsAdded=[];this.__objectsRemoved=[]};c.Scene.prototype=new c.Object3D;c.Scene.prototype.constructor=c.Scene;c.Scene.prototype.addObject=function(b){if(b instanceof c.Light){this.lights.indexOf(b)===-1&&this.lights.push(b)}else{if(!(b instanceof c.Camera||b instanceof c.Bone)&&this.objects.indexOf(b)===-1){this.objects.push(b);this.__objectsAdded.push(b);var a=this.__objectsRemoved.indexOf(b);a!==-1&&this.__objectsRemoved.splice(a,1)}}for(a=0;a<b.children.length;a++){this.addObject(b.children[a])}};c.Scene.prototype.removeObject=function(b){if(b instanceof c.Light){var a=this.lights.indexOf(b);a!==-1&&this.lights.splice(a,1)}else{b instanceof c.Camera||(a=this.objects.indexOf(b),a!==-1&&(this.objects.splice(a,1),this.__objectsRemoved.push(b),a=this.__objectsAdded.indexOf(b),a!==-1&&this.__objectsAdded.splice(a,1)))}for(a=0;a<b.children.length;a++){this.removeObject(b.children[a])}};c.Fog=function(b,a,g){this.color=new c.Color(b);this.near=a!==void 0?a:1;this.far=g!==void 0?g:1000};c.FogExp2=function(b,a){this.color=new c.Color(b);this.density=a!==void 0?a:0.00025};c.DOMRenderer=function(){c.Renderer.call(this);var m=null,a=new c.Projector,n,b,g,f;this.domElement=document.createElement("div");this.setSize=function(h,e){n=h;b=e;g=n/2;f=b/2};this.render=function(l,o){var p,y,r,h,j,z,k,e;m=a.projectScene(l,o);p=0;for(y=m.length;p<y;p++){if(j=m[p],j instanceof c.RenderableParticle){k=j.x*g+g;e=j.y*f+f;r=0;for(h=j.material.length;r<h;r++){if(z=j.material[r],z instanceof c.ParticleDOMMaterial){z=z.domElement,z.style.left=k+"px",z.style.top=e+"px"}}}}}};c.CanvasRenderer=function(al){function an(z){if(M!=z){B.globalAlpha=M=z}}function am(z){if(K!=z){switch(z){case c.NormalBlending:B.globalCompositeOperation="source-over";break;case c.AdditiveBlending:B.globalCompositeOperation="lighter";break;case c.SubtractiveBlending:B.globalCompositeOperation="darker"}K=z}}function ap(z){if(av!=z){B.strokeStyle=av=z}}function at(z){if(ay!=z){B.fillStyle=ay=z}}var ar=this,aq,r,s,w=new c.Projector,al=al||{},u=al.canvas!==void 0?al.canvas:document.createElement("canvas"),E,F,y,H,B=u.getContext("2d"),G=new c.Color(0),J=0,M=1,K=0,av=null,ay=null,au=null,N=null,O=null,L,a,I,ax,ab=new c.RenderableVertex,ae=new c.RenderableVertex,T,Z,X,n,aT,az,aU,V,ac,Y,ag,t,ah=new c.Color,af=new c.Color,R=new c.Color,m=new c.Color,j=new c.Color,ak=[],e=[],v,aw,ao,Q,q,o,g,l,U,aj,aa=new c.Rectangle,x=new c.Rectangle,aV=new c.Rectangle,W=!1,A=new c.Color,f=new c.Color,k=new c.Color,h=new c.Vector3,ai,b,P,p,ad,S,al=16;ai=document.createElement("canvas");ai.width=ai.height=2;b=ai.getContext("2d");b.fillStyle="rgba(0,0,0,1)";b.fillRect(0,0,2,2);P=b.getImageData(0,0,2,2);p=P.data;ad=document.createElement("canvas");ad.width=ad.height=al;S=ad.getContext("2d");S.translate(-al/2,-al/2);S.scale(al,al);al--;this.domElement=u;this.sortElements=this.sortObjects=this.autoClear=!0;this.info={render:{vertices:0,faces:0}};this.setSize=function(z,C){E=z;F=C;y=Math.floor(E/2);H=Math.floor(F/2);u.width=E;u.height=F;aa.set(-y,-H,y,H);x.set(-y,-H,y,H);M=1;K=0;O=N=au=ay=av=null};this.setClearColor=function(z,C){G.copy(z);J=C;x.set(-y,-H,y,H)};this.setClearColorHex=function(z,C){G.setHex(z);J=C;x.set(-y,-H,y,H)};this.clear=function(){B.setTransform(1,0,0,-1,y,H);x.isEmpty()||(x.minSelf(aa),x.inflate(2),J<1&&B.clearRect(Math.floor(x.getX()),Math.floor(x.getY()),Math.floor(x.getWidth()),Math.floor(x.getHeight())),J>0&&(am(c.NormalBlending),an(1),at("rgba("+Math.floor(G.r*255)+","+Math.floor(G.g*255)+","+Math.floor(G.b*255)+","+J+")"),B.fillRect(Math.floor(x.getX()),Math.floor(x.getY()),Math.floor(x.getWidth()),Math.floor(x.getHeight()))),x.empty())};this.render=function(z,aH){function aA(a0){var aW,aX,aY,aZ;A.setRGB(0,0,0);f.setRGB(0,0,0);k.setRGB(0,0,0);aW=0;for(aX=a0.length;aW<aX;aW++){aY=a0[aW],aZ=aY.color,aY instanceof c.AmbientLight?(A.r+=aZ.r,A.g+=aZ.g,A.b+=aZ.b):aY instanceof c.DirectionalLight?(f.r+=aZ.r,f.g+=aZ.g,f.b+=aZ.b):aY instanceof c.PointLight&&(k.r+=aZ.r,k.g+=aZ.g,k.b+=aZ.b)}}function C(a1,a4,aY,a2){var aW,a5,a3,a0,aX,aZ;aW=0;for(a5=a1.length;aW<a5;aW++){a3=a1[aW],a0=a3.color,a3 instanceof c.DirectionalLight?(aX=a3.matrixWorld.getPosition(),aZ=aY.dot(aX),aZ<=0||(aZ*=a3.intensity,a2.r+=a0.r*aZ,a2.g+=a0.g*aZ,a2.b+=a0.b*aZ)):a3 instanceof c.PointLight&&(aX=a3.matrixWorld.getPosition(),aZ=aY.dot(h.sub(aX,a4).normalize()),aZ<=0||(aZ*=a3.distance==0?1:1-Math.min(a4.distanceTo(aX)/a3.distance,1),aZ!=0&&(aZ*=a3.intensity,a2.r+=a0.r*aZ,a2.g+=a0.g*aZ,a2.b+=a0.b*aZ)))}}function aD(a0,aX,a3){an(a3.opacity);am(a3.blending);var a4,a1,a2,aW,aY,aZ;if(a3 instanceof c.ParticleBasicMaterial){if(a3.map){aW=a3.map.image,aY=aW.width>>1,aZ=aW.height>>1,a3=aX.scale.x*y,a2=aX.scale.y*H,a4=a3*aY,a1=a2*aZ,aV.set(a0.x-a4,a0.y-a1,a0.x+a4,a0.y+a1),aa.intersects(aV)&&(B.save(),B.translate(a0.x,a0.y),B.rotate(-aX.rotation),B.scale(a3,-a2),B.translate(-aY,-aZ),B.drawImage(aW,0,0),B.restore())}}else{a3 instanceof c.ParticleCanvasMaterial&&(a4=aX.scale.x*y,a1=aX.scale.y*H,aV.set(a0.x-a4,a0.y-a1,a0.x+a4,a0.y+a1),aa.intersects(aV)&&(ap(a3.color.getContextStyle()),at(a3.color.getContextStyle()),B.save(),B.translate(a0.x,a0.y),B.rotate(-aX.rotation),B.scale(a4,a1),a3.program(B),B.restore()))}}function aI(aW,aZ,aY,aX){an(aX.opacity);am(aX.blending);B.beginPath();B.moveTo(aW.positionScreen.x,aW.positionScreen.y);B.lineTo(aZ.positionScreen.x,aZ.positionScreen.y);B.closePath();if(aX instanceof c.LineBasicMaterial){aW=aX.linewidth;if(au!=aW){B.lineWidth=au=aW}aW=aX.linecap;if(N!=aW){B.lineCap=N=aW}aW=aX.linejoin;if(O!=aW){B.lineJoin=O=aW}ap(aX.color.getContextStyle());B.stroke();aV.inflate(aX.linewidth*2)}}function aM(a2,aW,aZ,aY,a1,a0,aX,a3){ar.info.render.vertices+=3;ar.info.render.faces++;an(a3.opacity);am(a3.blending);T=a2.positionScreen.x;Z=a2.positionScreen.y;X=aW.positionScreen.x;n=aW.positionScreen.y;aT=aZ.positionScreen.x;az=aZ.positionScreen.y;aR(T,Z,X,n,aT,az);if(a3 instanceof c.MeshBasicMaterial){if(a3.map){a3.map.mapping instanceof c.UVMapping&&(Q=aX.uvs[0],aL(T,Z,X,n,aT,az,Q[aY].u,Q[aY].v,Q[a1].u,Q[a1].v,Q[a0].u,Q[a0].v,a3.map))}else{if(a3.envMap){if(a3.envMap.mapping instanceof c.SphericalReflectionMapping){a2=aH.matrixWorldInverse,h.copy(aX.vertexNormalsWorld[aY]),q=(h.x*a2.n11+h.y*a2.n12+h.z*a2.n13)*0.5+0.5,o=-(h.x*a2.n21+h.y*a2.n22+h.z*a2.n23)*0.5+0.5,h.copy(aX.vertexNormalsWorld[a1]),g=(h.x*a2.n11+h.y*a2.n12+h.z*a2.n13)*0.5+0.5,l=-(h.x*a2.n21+h.y*a2.n22+h.z*a2.n23)*0.5+0.5,h.copy(aX.vertexNormalsWorld[a0]),U=(h.x*a2.n11+h.y*a2.n12+h.z*a2.n13)*0.5+0.5,aj=-(h.x*a2.n21+h.y*a2.n22+h.z*a2.n23)*0.5+0.5,aL(T,Z,X,n,aT,az,q,o,g,l,U,aj,a3.envMap)}}else{a3.wireframe?aJ(a3.color,a3.wireframeLinewidth,a3.wireframeLinecap,a3.wireframeLinejoin):aE(a3.color)}}}else{if(a3 instanceof c.MeshLambertMaterial){a3.map&&!a3.wireframe&&(a3.map.mapping instanceof c.UVMapping&&(Q=aX.uvs[0],aL(T,Z,X,n,aT,az,Q[aY].u,Q[aY].v,Q[a1].u,Q[a1].v,Q[a0].u,Q[a0].v,a3.map)),am(c.SubtractiveBlending)),W?!a3.wireframe&&a3.shading==c.SmoothShading&&aX.vertexNormalsWorld.length==3?(af.r=R.r=m.r=A.r,af.g=R.g=m.g=A.g,af.b=R.b=m.b=A.b,C(s,aX.v1.positionWorld,aX.vertexNormalsWorld[0],af),C(s,aX.v2.positionWorld,aX.vertexNormalsWorld[1],R),C(s,aX.v3.positionWorld,aX.vertexNormalsWorld[2],m),af.r=Math.max(0,Math.min(a3.color.r*af.r,1)),af.g=Math.max(0,Math.min(a3.color.g*af.g,1)),af.b=Math.max(0,Math.min(a3.color.b*af.b,1)),R.r=Math.max(0,Math.min(a3.color.r*R.r,1)),R.g=Math.max(0,Math.min(a3.color.g*R.g,1)),R.b=Math.max(0,Math.min(a3.color.b*R.b,1)),m.r=Math.max(0,Math.min(a3.color.r*m.r,1)),m.g=Math.max(0,Math.min(a3.color.g*m.g,1)),m.b=Math.max(0,Math.min(a3.color.b*m.b,1)),j.r=(R.r+m.r)*0.5,j.g=(R.g+m.g)*0.5,j.b=(R.b+m.b)*0.5,ao=aN(af,R,m,j),aC(T,Z,X,n,aT,az,0,0,1,0,0,1,ao)):(ah.r=A.r,ah.g=A.g,ah.b=A.b,C(s,aX.centroidWorld,aX.normalWorld,ah),ah.r=Math.max(0,Math.min(a3.color.r*ah.r,1)),ah.g=Math.max(0,Math.min(a3.color.g*ah.g,1)),ah.b=Math.max(0,Math.min(a3.color.b*ah.b,1)),a3.wireframe?aJ(ah,a3.wireframeLinewidth,a3.wireframeLinecap,a3.wireframeLinejoin):aE(ah)):a3.wireframe?aJ(a3.color,a3.wireframeLinewidth,a3.wireframeLinecap,a3.wireframeLinejoin):aE(a3.color)}else{if(a3 instanceof c.MeshDepthMaterial){v=aH.near,aw=aH.far,af.r=af.g=af.b=1-aF(a2.positionScreen.z,v,aw),R.r=R.g=R.b=1-aF(aW.positionScreen.z,v,aw),m.r=m.g=m.b=1-aF(aZ.positionScreen.z,v,aw),j.r=(R.r+m.r)*0.5,j.g=(R.g+m.g)*0.5,j.b=(R.b+m.b)*0.5,ao=aN(af,R,m,j),aC(T,Z,X,n,aT,az,0,0,1,0,0,1,ao)}else{if(a3 instanceof c.MeshNormalMaterial){ah.r=aK(aX.normalWorld.x),ah.g=aK(aX.normalWorld.y),ah.b=aK(aX.normalWorld.z),a3.wireframe?aJ(ah,a3.wireframeLinewidth,a3.wireframeLinecap,a3.wireframeLinejoin):aE(ah)}}}}}function aP(a0,a3,a1,aX,a2,aY,aW,a4,aZ){ar.info.render.vertices+=4;ar.info.render.faces++;an(a4.opacity);am(a4.blending);if(a4.map||a4.envMap){aM(a0,a3,aX,0,1,3,aW,a4,aZ),aM(a2,a1,aY,1,2,3,aW,a4,aZ)}else{if(T=a0.positionScreen.x,Z=a0.positionScreen.y,X=a3.positionScreen.x,n=a3.positionScreen.y,aT=a1.positionScreen.x,az=a1.positionScreen.y,aU=aX.positionScreen.x,V=aX.positionScreen.y,ac=a2.positionScreen.x,Y=a2.positionScreen.y,ag=aY.positionScreen.x,t=aY.positionScreen.y,a4 instanceof c.MeshBasicMaterial){aB(T,Z,X,n,aT,az,aU,V),a4.wireframe?aJ(a4.color,a4.wireframeLinewidth,a4.wireframeLinecap,a4.wireframeLinejoin):aE(a4.color)}else{if(a4 instanceof c.MeshLambertMaterial){W?!a4.wireframe&&a4.shading==c.SmoothShading&&aW.vertexNormalsWorld.length==4?(af.r=R.r=m.r=j.r=A.r,af.g=R.g=m.g=j.g=A.g,af.b=R.b=m.b=j.b=A.b,C(s,aW.v1.positionWorld,aW.vertexNormalsWorld[0],af),C(s,aW.v2.positionWorld,aW.vertexNormalsWorld[1],R),C(s,aW.v4.positionWorld,aW.vertexNormalsWorld[3],m),C(s,aW.v3.positionWorld,aW.vertexNormalsWorld[2],j),af.r=Math.max(0,Math.min(a4.color.r*af.r,1)),af.g=Math.max(0,Math.min(a4.color.g*af.g,1)),af.b=Math.max(0,Math.min(a4.color.b*af.b,1)),R.r=Math.max(0,Math.min(a4.color.r*R.r,1)),R.g=Math.max(0,Math.min(a4.color.g*R.g,1)),R.b=Math.max(0,Math.min(a4.color.b*R.b,1)),m.r=Math.max(0,Math.min(a4.color.r*m.r,1)),m.g=Math.max(0,Math.min(a4.color.g*m.g,1)),m.b=Math.max(0,Math.min(a4.color.b*m.b,1)),j.r=Math.max(0,Math.min(a4.color.r*j.r,1)),j.g=Math.max(0,Math.min(a4.color.g*j.g,1)),j.b=Math.max(0,Math.min(a4.color.b*j.b,1)),ao=aN(af,R,m,j),aR(T,Z,X,n,aU,V),aC(T,Z,X,n,aU,V,0,0,1,0,0,1,ao),aR(ac,Y,aT,az,ag,t),aC(ac,Y,aT,az,ag,t,1,0,1,1,0,1,ao)):(ah.r=A.r,ah.g=A.g,ah.b=A.b,C(s,aW.centroidWorld,aW.normalWorld,ah),ah.r=Math.max(0,Math.min(a4.color.r*ah.r,1)),ah.g=Math.max(0,Math.min(a4.color.g*ah.g,1)),ah.b=Math.max(0,Math.min(a4.color.b*ah.b,1)),aB(T,Z,X,n,aT,az,aU,V),a4.wireframe?aJ(ah,a4.wireframeLinewidth,a4.wireframeLinecap,a4.wireframeLinejoin):aE(ah)):(aB(T,Z,X,n,aT,az,aU,V),a4.wireframe?aJ(a4.color,a4.wireframeLinewidth,a4.wireframeLinecap,a4.wireframeLinejoin):aE(a4.color))}else{if(a4 instanceof c.MeshNormalMaterial){ah.r=aK(aW.normalWorld.x),ah.g=aK(aW.normalWorld.y),ah.b=aK(aW.normalWorld.z),aB(T,Z,X,n,aT,az,aU,V),a4.wireframe?aJ(ah,a4.wireframeLinewidth,a4.wireframeLinecap,a4.wireframeLinejoin):aE(ah)}else{if(a4 instanceof c.MeshDepthMaterial){v=aH.near,aw=aH.far,af.r=af.g=af.b=1-aF(a0.positionScreen.z,v,aw),R.r=R.g=R.b=1-aF(a3.positionScreen.z,v,aw),m.r=m.g=m.b=1-aF(aX.positionScreen.z,v,aw),j.r=j.g=j.b=1-aF(a1.positionScreen.z,v,aw),ao=aN(af,R,m,j),aR(T,Z,X,n,aU,V),aC(T,Z,X,n,aU,V,0,0,1,0,0,1,ao),aR(ac,Y,aT,az,ag,t),aC(ac,Y,aT,az,ag,t,1,0,1,1,0,1,ao)}}}}}}function aR(a1,aW,aX,aY,a0,aZ){B.beginPath();B.moveTo(a1,aW);B.lineTo(aX,aY);B.lineTo(a0,aZ);B.lineTo(a1,aW);B.closePath()}function aB(a2,aX,a3,aW,a0,aY,aZ,a1){B.beginPath();B.moveTo(a2,aX);B.lineTo(a3,aW);B.lineTo(a0,aY);B.lineTo(aZ,a1);B.lineTo(a2,aX);B.closePath()}function aJ(aZ,aW,aX,aY){if(au!=aW){B.lineWidth=au=aW}if(N!=aX){B.lineCap=N=aX}if(O!=aY){B.lineJoin=O=aY}ap(aZ.getContextStyle());B.stroke();aV.inflate(aW*2)}function aE(aW){at(aW.getContextStyle());B.fill()}function aL(aX,aY,aZ,a1,a2,a3,a6,a4,a5,bc,a7,a8,aW){if(aW.image.width!=0){if(aW.needsUpdate==!0||ak[aW.id]==void 0){var a9=aW.wrapS==c.RepeatWrapping,ba=aW.wrapT==c.RepeatWrapping;ak[aW.id]=B.createPattern(aW.image,a9&&ba?"repeat":a9&&!ba?"repeat-x":!a9&&ba?"repeat-y":"no-repeat");aW.needsUpdate=!1}at(ak[aW.id]);var a9=aW.offset.x/aW.repeat.x,ba=aW.offset.y/aW.repeat.y,a0=aW.image.width*aW.repeat.x,bb=aW.image.height*aW.repeat.y,a6=(a6+a9)*a0,a4=(a4+ba)*bb,a5=(a5+a9)*a0,bc=(bc+ba)*bb,a7=(a7+a9)*a0,a8=(a8+ba)*bb;aZ-=aX;a1-=aY;a2-=aX;a3-=aY;a5-=a6;bc-=a4;a7-=a6;a8-=a4;a9=a5*a8-a7*bc;if(a9==0){if(e[aW.id]==void 0){aY=document.createElement("canvas"),aY.width=aW.image.width,aY.height=aW.image.height,aX=aY.getContext("2d"),aX.drawImage(aW.image,0,0),e[aW.id]=aX.getImageData(0,0,aW.image.width,aW.image.height).data,delete aY}aY=e[aW.id];a6=(Math.floor(a6)+Math.floor(a4)*aW.image.width)*4;ah.setRGB(aY[a6]/255,aY[a6+1]/255,aY[a6+2]/255);aE(ah)}else{a9=1/a9,aW=(a8*aZ-bc*a2)*a9,bc=(a8*a1-bc*a3)*a9,aZ=(a5*a2-a7*aZ)*a9,a1=(a5*a3-a7*a1)*a9,aX=aX-aW*a6-aZ*a4,a6=aY-bc*a6-a1*a4,B.save(),B.transform(aW,bc,aZ,a1,aX,a6),B.fill(),B.restore()}}}function aC(aZ,a0,a1,a2,a5,a3,a4,aY,a6,ba,a9,a7,a8){var aW,aX;aW=a8.width-1;aX=a8.height-1;a4*=aW;aY*=aX;a6*=aW;ba*=aX;a9*=aW;a7*=aX;a1-=aZ;a2-=a0;a5-=aZ;a3-=a0;a6-=a4;ba-=aY;a9-=a4;a7-=aY;aX=1/(a6*a7-a9*ba);aW=(a7*a1-ba*a5)*aX;ba=(a7*a2-ba*a3)*aX;a1=(a6*a5-a9*a1)*aX;a2=(a6*a3-a9*a2)*aX;aZ=aZ-aW*a4-a1*aY;a0=a0-ba*a4-a2*aY;B.save();B.transform(aW,ba,a1,a2,aZ,a0);B.clip();B.drawImage(a8,0,0);B.restore()}function aN(a0,a1,a2,a3){var a4=~~(a0.r*255),a7=~~(a0.g*255),a0=~~(a0.b*255),aY=~~(a1.r*255),aW=~~(a1.g*255),a1=~~(a1.b*255),a5=~~(a2.r*255),a6=~~(a2.g*255),a2=~~(a2.b*255),aZ=~~(a3.r*255),aX=~~(a3.g*255),a3=~~(a3.b*255);p[0]=a4<0?0:a4>255?255:a4;p[1]=a7<0?0:a7>255?255:a7;p[2]=a0<0?0:a0>255?255:a0;p[4]=aY<0?0:aY>255?255:aY;p[5]=aW<0?0:aW>255?255:aW;p[6]=a1<0?0:a1>255?255:a1;p[8]=a5<0?0:a5>255?255:a5;p[9]=a6<0?0:a6>255?255:a6;p[10]=a2<0?0:a2>255?255:a2;p[12]=aZ<0?0:aZ>255?255:aZ;p[13]=aX<0?0:aX>255?255:aX;p[14]=a3<0?0:a3>255?255:a3;b.putImageData(P,0,0);S.drawImage(ai,0,0);return ad}function aF(aY,aW,aX){aY=(aY-aW)/(aX-aW);return aY*aY*(3-2*aY)}function aK(aW){aW=(aW+1)*0.5;return aW<0?0:aW>1?1:aW}function aO(a0,aW){var aX=aW.x-a0.x,aY=aW.y-a0.y,aZ=aX*aX+aY*aY;aZ!=0&&(aZ=1/Math.sqrt(aZ),aX*=aZ,aY*=aZ,aW.x+=aX,aW.y+=aY,a0.x-=aX,a0.y-=aY)}var aQ,D,aS,aG;this.autoClear?this.clear():B.setTransform(1,0,0,-1,y,H);ar.info.render.vertices=0;ar.info.render.faces=0;aq=w.projectScene(z,aH,this.sortElements);r=aq.elements;s=aq.lights;(W=s.length>0)&&aA(s);aQ=0;for(D=r.length;aQ<D;aQ++){if(aS=r[aQ],aG=aS.material,aG=aG instanceof c.MeshFaceMaterial?aS.faceMaterial:aG,!(aG==null||aG.opacity==0)){aV.empty();if(aS instanceof c.RenderableParticle){L=aS,L.x*=y,L.y*=H,aD(L,aS,aG,z)}else{if(aS instanceof c.RenderableLine){L=aS.v1,a=aS.v2,L.positionScreen.x*=y,L.positionScreen.y*=H,a.positionScreen.x*=y,a.positionScreen.y*=H,aV.addPoint(L.positionScreen.x,L.positionScreen.y),aV.addPoint(a.positionScreen.x,a.positionScreen.y),aa.intersects(aV)&&aI(L,a,aS,aG,z)}else{if(aS instanceof c.RenderableFace3){L=aS.v1,a=aS.v2,I=aS.v3,L.positionScreen.x*=y,L.positionScreen.y*=H,a.positionScreen.x*=y,a.positionScreen.y*=H,I.positionScreen.x*=y,I.positionScreen.y*=H,aG.overdraw&&(aO(L.positionScreen,a.positionScreen),aO(a.positionScreen,I.positionScreen),aO(I.positionScreen,L.positionScreen)),aV.add3Points(L.positionScreen.x,L.positionScreen.y,a.positionScreen.x,a.positionScreen.y,I.positionScreen.x,I.positionScreen.y),aa.intersects(aV)&&aM(L,a,I,0,1,2,aS,aG,z)}else{if(aS instanceof c.RenderableFace4){L=aS.v1,a=aS.v2,I=aS.v3,ax=aS.v4,L.positionScreen.x*=y,L.positionScreen.y*=H,a.positionScreen.x*=y,a.positionScreen.y*=H,I.positionScreen.x*=y,I.positionScreen.y*=H,ax.positionScreen.x*=y,ax.positionScreen.y*=H,ab.positionScreen.copy(a.positionScreen),ae.positionScreen.copy(ax.positionScreen),aG.overdraw&&(aO(L.positionScreen,a.positionScreen),aO(a.positionScreen,ax.positionScreen),aO(ax.positionScreen,L.positionScreen),aO(I.positionScreen,ab.positionScreen),aO(I.positionScreen,ae.positionScreen)),aV.addPoint(L.positionScreen.x,L.positionScreen.y),aV.addPoint(a.positionScreen.x,a.positionScreen.y),aV.addPoint(I.positionScreen.x,I.positionScreen.y),aV.addPoint(ax.positionScreen.x,ax.positionScreen.y),aa.intersects(aV)&&aP(L,a,I,ax,ab,ae,aS,aG,z)}}}}x.addRectangle(aV)}}B.setTransform(1,0,0,1,0,0)}};c.SVGRenderer=function(){function x(L,M,N,j){var D,z,C,G,H,I;D=0;for(z=L.length;D<z;D++){C=L[D],G=C.color,C instanceof c.DirectionalLight?(H=C.matrixWorld.getPosition(),I=N.dot(H),I<=0||(I*=C.intensity,j.r+=G.r*I,j.g+=G.g*I,j.b+=G.b*I)):C instanceof c.PointLight&&(H=C.matrixWorld.getPosition(),I=N.dot(q.sub(H,M).normalize()),I<=0||(I*=C.distance==0?1:1-Math.min(M.distanceTo(H)/C.distance,1),I!=0&&(I*=C.intensity,j.r+=G.r*I,j.g+=G.g*I,j.b+=G.b*I)))}}function B(j){v[j]==null&&(v[j]=document.createElementNS("http://www.w3.org/2000/svg","path"),w==0&&v[j].setAttribute("shape-rendering","crispEdges"));return v[j]}function A(j){j=(j+1)*0.5;return j<0?0:j>1?1:j}var E=this,K,J,F,R=new c.Projector,U=document.createElementNS("http://www.w3.org/2000/svg","svg"),ae,ad,b,e,af,k,a,g,m=new c.Rectangle,s=new c.Rectangle,o=!1,h=new c.Color,p=new c.Color,f=new c.Color,t=new c.Color,u,q=new c.Vector3,v=[],l=[],n,r,y,w=1;this.domElement=U;this.sortElements=this.sortObjects=this.autoClear=!0;this.info={render:{vertices:0,faces:0}};this.setQuality=function(j){switch(j){case"high":w=1;break;case"low":w=0}};this.setSize=function(j,z){ae=j;ad=z;b=ae/2;e=ad/2;U.setAttribute("viewBox",-b+" "+-e+" "+ae+" "+ad);U.setAttribute("width",ae);U.setAttribute("height",ad);m.set(-b,-e,b,e)};this.clear=function(){for(;U.childNodes.length>0;){U.removeChild(U.childNodes[0])}};this.render=function(L,M){var D,z,j,C;this.autoClear&&this.clear();E.info.render.vertices=0;E.info.render.faces=0;K=R.projectScene(L,M,this.sortElements);J=K.elements;F=K.lights;y=r=0;if(o=F.length>0){p.setRGB(0,0,0);f.setRGB(0,0,0);t.setRGB(0,0,0);D=0;for(z=F.length;D<z;D++){C=F[D],j=C.color,C instanceof c.AmbientLight?(p.r+=j.r,p.g+=j.g,p.b+=j.b):C instanceof c.DirectionalLight?(f.r+=j.r,f.g+=j.g,f.b+=j.b):C instanceof c.PointLight&&(t.r+=j.r,t.g+=j.g,t.b+=j.b)}}D=0;for(z=J.length;D<z;D++){if(j=J[D],C=j.material,C=C instanceof c.MeshFaceMaterial?j.faceMaterial:C,!(C==null||C.opacity==0)){if(s.empty(),j instanceof c.RenderableParticle){af=j,af.x*=b,af.y*=-e}else{if(j instanceof c.RenderableLine){if(af=j.v1,k=j.v2,af.positionScreen.x*=b,af.positionScreen.y*=-e,k.positionScreen.x*=b,k.positionScreen.y*=-e,s.addPoint(af.positionScreen.x,af.positionScreen.y),s.addPoint(k.positionScreen.x,k.positionScreen.y),m.intersects(s)){j=af;var H=k,I=y++;l[I]==null&&(l[I]=document.createElementNS("http://www.w3.org/2000/svg","line"),w==0&&l[I].setAttribute("shape-rendering","crispEdges"));n=l[I];n.setAttribute("x1",j.positionScreen.x);n.setAttribute("y1",j.positionScreen.y);n.setAttribute("x2",H.positionScreen.x);n.setAttribute("y2",H.positionScreen.y);C instanceof c.LineBasicMaterial&&(n.setAttribute("style","fill: none; stroke: "+C.color.getContextStyle()+"; stroke-width: "+C.linewidth+"; stroke-opacity: "+C.opacity+"; stroke-linecap: "+C.linecap+"; stroke-linejoin: "+C.linejoin),U.appendChild(n))}}else{if(j instanceof c.RenderableFace3){if(af=j.v1,k=j.v2,a=j.v3,af.positionScreen.x*=b,af.positionScreen.y*=-e,k.positionScreen.x*=b,k.positionScreen.y*=-e,a.positionScreen.x*=b,a.positionScreen.y*=-e,s.addPoint(af.positionScreen.x,af.positionScreen.y),s.addPoint(k.positionScreen.x,k.positionScreen.y),s.addPoint(a.positionScreen.x,a.positionScreen.y),m.intersects(s)){var H=af,I=k,G=a;E.info.render.vertices+=3;E.info.render.faces++;n=B(r++);n.setAttribute("d","M "+H.positionScreen.x+" "+H.positionScreen.y+" L "+I.positionScreen.x+" "+I.positionScreen.y+" L "+G.positionScreen.x+","+G.positionScreen.y+"z");C instanceof c.MeshBasicMaterial?h.copy(C.color):C instanceof c.MeshLambertMaterial?o?(h.r=p.r,h.g=p.g,h.b=p.b,x(F,j.centroidWorld,j.normalWorld,h),h.r=Math.max(0,Math.min(C.color.r*h.r,1)),h.g=Math.max(0,Math.min(C.color.g*h.g,1)),h.b=Math.max(0,Math.min(C.color.b*h.b,1))):h.copy(C.color):C instanceof c.MeshDepthMaterial?(u=1-C.__2near/(C.__farPlusNear-j.z*C.__farMinusNear),h.setRGB(u,u,u)):C instanceof c.MeshNormalMaterial&&h.setRGB(A(j.normalWorld.x),A(j.normalWorld.y),A(j.normalWorld.z));C.wireframe?n.setAttribute("style","fill: none; stroke: "+h.getContextStyle()+"; stroke-width: "+C.wireframeLinewidth+"; stroke-opacity: "+C.opacity+"; stroke-linecap: "+C.wireframeLinecap+"; stroke-linejoin: "+C.wireframeLinejoin):n.setAttribute("style","fill: "+h.getContextStyle()+"; fill-opacity: "+C.opacity);U.appendChild(n)}}else{if(j instanceof c.RenderableFace4&&(af=j.v1,k=j.v2,a=j.v3,g=j.v4,af.positionScreen.x*=b,af.positionScreen.y*=-e,k.positionScreen.x*=b,k.positionScreen.y*=-e,a.positionScreen.x*=b,a.positionScreen.y*=-e,g.positionScreen.x*=b,g.positionScreen.y*=-e,s.addPoint(af.positionScreen.x,af.positionScreen.y),s.addPoint(k.positionScreen.x,k.positionScreen.y),s.addPoint(a.positionScreen.x,a.positionScreen.y),s.addPoint(g.positionScreen.x,g.positionScreen.y),m.intersects(s))){var H=af,I=k,G=a,N=g;E.info.render.vertices+=4;E.info.render.faces++;n=B(r++);n.setAttribute("d","M "+H.positionScreen.x+" "+H.positionScreen.y+" L "+I.positionScreen.x+" "+I.positionScreen.y+" L "+G.positionScreen.x+","+G.positionScreen.y+" L "+N.positionScreen.x+","+N.positionScreen.y+"z");C instanceof c.MeshBasicMaterial?h.copy(C.color):C instanceof c.MeshLambertMaterial?o?(h.r=p.r,h.g=p.g,h.b=p.b,x(F,j.centroidWorld,j.normalWorld,h),h.r=Math.max(0,Math.min(C.color.r*h.r,1)),h.g=Math.max(0,Math.min(C.color.g*h.g,1)),h.b=Math.max(0,Math.min(C.color.b*h.b,1))):h.copy(C.color):C instanceof c.MeshDepthMaterial?(u=1-C.__2near/(C.__farPlusNear-j.z*C.__farMinusNear),h.setRGB(u,u,u)):C instanceof c.MeshNormalMaterial&&h.setRGB(A(j.normalWorld.x),A(j.normalWorld.y),A(j.normalWorld.z));C.wireframe?n.setAttribute("style","fill: none; stroke: "+h.getContextStyle()+"; stroke-width: "+C.wireframeLinewidth+"; stroke-opacity: "+C.opacity+"; stroke-linecap: "+C.wireframeLinecap+"; stroke-linejoin: "+C.wireframeLinejoin):n.setAttribute("style","fill: "+h.getContextStyle()+"; fill-opacity: "+C.opacity);U.appendChild(n)}}}}}}}};c.ShaderChunk={fog_pars_fragment:"#ifdef USE_FOG\nuniform vec3 fogColor;\n#ifdef FOG_EXP2\nuniform float fogDensity;\n#else\nuniform float fogNear;\nuniform float fogFar;\n#endif\n#endif",fog_fragment:"#ifdef USE_FOG\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n#ifdef FOG_EXP2\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n#else\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n#endif\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float reflectivity;\nuniform samplerCube envMap;\nuniform float flipEnvMap;\nuniform int combine;\n#endif",envmap_fragment:"#ifdef USE_ENVMAP\nvec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * vReflect.x, vReflect.yz ) );\n#ifdef GAMMA_INPUT\ncubeColor.xyz *= cubeColor.xyz;\n#endif\nif ( combine == 1 ) {\ngl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, reflectivity );\n} else {\ngl_FragColor.xyz = gl_FragColor.xyz * cubeColor.xyz;\n}\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float refractionRatio;\nuniform bool useRefract;\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = mat3( objectMatrix[ 0 ].xyz, objectMatrix[ 1 ].xyz, objectMatrix[ 2 ].xyz ) * normal;\nif ( useRefract ) {\nvReflect = refract( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ), refractionRatio );\n} else {\nvReflect = reflect( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ) );\n}\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\nuniform sampler2D map;\n#endif",map_particle_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, gl_PointCoord );\n#endif",map_pars_vertex:"#ifdef USE_MAP\nvarying vec2 vUv;\nuniform vec4 offsetRepeat;\n#endif",map_pars_fragment:"#ifdef USE_MAP\nvarying vec2 vUv;\nuniform sampler2D map;\n#endif",map_vertex:"#ifdef USE_MAP\nvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",map_fragment:"#ifdef USE_MAP\n#ifdef GAMMA_INPUT\nvec4 texelColor = texture2D( map, vUv );\ntexelColor.xyz *= texelColor.xyz;\ngl_FragColor = gl_FragColor * texelColor;\n#else\ngl_FragColor = gl_FragColor * texture2D( map, vUv );\n#endif\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\nuniform sampler2D lightMap;\n#endif",lightmap_pars_vertex:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\ngl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n#endif",lightmap_vertex:"#ifdef USE_LIGHTMAP\nvUv2 = uv2;\n#endif",lights_lambert_pars_vertex:"uniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif",lights_lambert_vertex:"vLightWeighting = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nfloat directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ i ] * directionalLightWeighting;\n}\n#endif\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat pointLightWeighting = max( dot( transformedNormal, lVector ), 0.0 );\nvLightWeighting += pointLightColor[ i ] * pointLightWeighting * lDistance;\n}\n#endif\nvLightWeighting = vLightWeighting * diffuse + ambient * ambientLightColor;",lights_phong_pars_vertex:"#if MAX_POINT_LIGHTS > 0\n#ifndef PHONG_PER_PIXEL\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#endif",lights_phong_vertex:"#if MAX_POINT_LIGHTS > 0\n#ifndef PHONG_PER_PIXEL\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nvPointLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#endif",lights_phong_pars_fragment:"uniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n#ifdef PHONG_PER_PIXEL\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#else\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#endif\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",lights_phong_fragment:"vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse  = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n#ifdef PHONG_PER_PIXEL\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz + vViewPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\n#else\nvec3 lVector = normalize( vPointLight[ i ].xyz );\nfloat lDistance = vPointLight[ i ].w;\n#endif\nvec3 pointHalfVector = normalize( lVector + viewPosition );\nfloat pointDistance = lDistance;\nfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\nfloat pointDiffuseWeight = max( dot( normal, lVector ), 0.0 );\nfloat pointSpecularWeight = pow( pointDotNormalHalf, shininess );\n#ifdef PHYSICALLY_BASED_SHADING\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( dot( lVector, pointHalfVector ), 5.0 );\npointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance;\n#else\npointSpecular += specular * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance;\n#endif\npointDiffuse  += diffuse * pointLightColor[ i ] * pointDiffuseWeight * pointDistance;\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse  = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nvec3 dirHalfVector = normalize( lDirection.xyz + viewPosition );\nfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\nfloat dirSpecularWeight = pow( dirDotNormalHalf, shininess );\n#ifdef PHYSICALLY_BASED_SHADING\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( dot( dirVector, dirHalfVector ), 5.0 );\ndirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;\n#else\ndirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;\n#endif\ndirDiffuse  += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;\n}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\n#ifdef METAL\ngl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient + totalSpecular );\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_fragment:"#ifdef USE_COLOR\ngl_FragColor = gl_FragColor * vec4( vColor, opacity );\n#endif",color_pars_vertex:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n#ifdef GAMMA_INPUT\nvColor = color * color;\n#else\nvColor = color;\n#endif\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\nuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n#endif",skinning_vertex:"#ifdef USE_SKINNING\ngl_Position  = ( boneGlobalMatrices[ int( skinIndex.x ) ] * skinVertexA ) * skinWeight.x;\ngl_Position += ( boneGlobalMatrices[ int( skinIndex.y ) ] * skinVertexB ) * skinWeight.y;\ngl_Position  = projectionMatrix * viewMatrix * objectMatrix * gl_Position;\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\nuniform float morphTargetInfluences[ 8 ];\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\nvec3 morphed = vec3( 0.0, 0.0, 0.0 );\nmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\nmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\nmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\nmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\nmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\nmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\nmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\nmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\nmorphed += position;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( morphed, 1.0 );\n#endif",default_vertex:"#ifndef USE_MORPHTARGETS\n#ifndef USE_SKINNING\ngl_Position = projectionMatrix * mvPosition;\n#endif\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\nuniform sampler2D shadowMap[ MAX_SHADOWS ];\nuniform float shadowDarkness;\nuniform float shadowBias;\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nfloat unpackDepth( const in vec4 rgba_depth ) {\nconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\nfloat depth = dot( rgba_depth, bit_shift );\nreturn depth;\n}\n#endif",shadowmap_fragment:"#ifdef USE_SHADOWMAP\n#ifdef SHADOWMAP_SOFT\nconst float xPixelOffset = 1.0 / SHADOWMAP_WIDTH;\nconst float yPixelOffset = 1.0 / SHADOWMAP_HEIGHT;\n#endif\nvec3 shadowColor = vec3( 1.0 );\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\nshadowCoord.z += shadowBias;\nif ( shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0 ) {\n#ifdef SHADOWMAP_SOFT\nfloat shadow = 0.0;\nfor ( float y = -1.25; y <= 1.25; y += 1.25 )\nfor ( float x = -1.25; x <= 1.25; x += 1.25 ) {\nvec4 rgbaDepth = texture2D( shadowMap[ i ], vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy );\nfloat fDepth = unpackDepth( rgbaDepth );\nif ( fDepth < shadowCoord.z )\nshadow += 1.0;\n}\nshadow /= 9.0;\nshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness * shadow ) );\n#else\nvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\nfloat fDepth = unpackDepth( rgbaDepth );\nif ( fDepth < shadowCoord.z )\nshadowColor = shadowColor * vec3( shadowDarkness );\n#endif\n}\n}\n#ifdef GAMMA_OUTPUT\nshadowColor *= shadowColor;\n#endif\ngl_FragColor.xyz = gl_FragColor.xyz * shadowColor;\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nuniform mat4 shadowMatrix[ MAX_SHADOWS ];\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvShadowCoord[ i ] = shadowMatrix[ i ] * objectMatrix * vec4( position, 1.0 );\n}\n#endif",alphatest_fragment:"#ifdef ALPHATEST\nif ( gl_FragColor.a < ALPHATEST ) discard;\n#endif",linear_to_gamma_fragment:"#ifdef GAMMA_OUTPUT\ngl_FragColor.xyz = sqrt( gl_FragColor.xyz );\n#endif"};c.UniformsUtils={merge:function(k){var a,l,b,g={};for(a=0;a<k.length;a++){for(l in b=this.clone(k[a]),b){g[l]=b[l]}}return g},clone:function(k){var a,l,b,g={};for(a in k){for(l in g[a]={},k[a]){b=k[a][l],g[a][l]=b instanceof c.Color||b instanceof c.Vector2||b instanceof c.Vector3||b instanceof c.Vector4||b instanceof c.Matrix4||b instanceof c.Texture?b.clone():b instanceof Array?b.slice():b}}return g}};c.UniformsLib={common:{diffuse:{type:"c",value:new c.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:0,texture:null},offsetRepeat:{type:"v4",value:new c.Vector4(0,0,1,1)},lightMap:{type:"t",value:2,texture:null},envMap:{type:"t",value:1,texture:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:0.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},fog:{fogDensity:{type:"f",value:0.00025},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2000},fogColor:{type:"c",value:new c.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new c.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:0,texture:null},fogDensity:{type:"f",value:0.00025},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2000},fogColor:{type:"c",value:new c.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:6,texture:[]},shadowMatrix:{type:"m4v",value:[]},shadowBias:{type:"f",value:0.0039},shadowDarkness:{type:"f",value:0.2}}};c.ShaderLib={sprite:{vertexShader:"uniform int useScreenCoordinates;\nuniform int affectedByDistance;\nuniform vec3 screenPosition;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 alignment;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position + alignment;\nvec2 rotatedPosition;\nrotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;\nrotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;\nvec4 finalPosition;\nif( useScreenCoordinates != 0 ) {\nfinalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );\n} else {\nfinalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition * ( affectedByDistance == 1 ? 1.0 : finalPosition.z );\n}\ngl_Position = finalPosition;\n}",fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nvarying vec2 vUV;\nvoid main() {\nvec4 texture = texture2D( map, vUV );\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\n}"},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2000},opacity:{type:"f",value:1}},vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float mNear;\nuniform float mFar;\nuniform float opacity;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat color = 1.0 - smoothstep( mNear, mFar, depth );\ngl_FragColor = vec4( vec3( color ), opacity );\n}"},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:"varying vec3 vNormal;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvNormal = normalize( normalMatrix * normal );\ngl_Position = projectionMatrix * mvPosition;\n}",fragmentShader:"uniform float opacity;\nvarying vec3 vNormal;\nvoid main() {\ngl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\n}"},basic:{uniforms:c.UniformsUtils.merge([c.UniformsLib.common,c.UniformsLib.fog,c.UniformsLib.shadowmap]),vertexShader:[c.ShaderChunk.map_pars_vertex,c.ShaderChunk.lightmap_pars_vertex,c.ShaderChunk.envmap_pars_vertex,c.ShaderChunk.color_pars_vertex,c.ShaderChunk.skinning_pars_vertex,c.ShaderChunk.morphtarget_pars_vertex,c.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",c.ShaderChunk.map_vertex,c.ShaderChunk.lightmap_vertex,c.ShaderChunk.envmap_vertex,c.ShaderChunk.color_vertex,c.ShaderChunk.skinning_vertex,c.ShaderChunk.morphtarget_vertex,c.ShaderChunk.default_vertex,c.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",c.ShaderChunk.color_pars_fragment,c.ShaderChunk.map_pars_fragment,c.ShaderChunk.lightmap_pars_fragment,c.ShaderChunk.envmap_pars_fragment,c.ShaderChunk.fog_pars_fragment,c.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );",c.ShaderChunk.map_fragment,c.ShaderChunk.alphatest_fragment,c.ShaderChunk.lightmap_fragment,c.ShaderChunk.color_fragment,c.ShaderChunk.envmap_fragment,c.ShaderChunk.shadowmap_fragment,c.ShaderChunk.linear_to_gamma_fragment,c.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:c.UniformsUtils.merge([c.UniformsLib.common,c.UniformsLib.fog,c.UniformsLib.lights,c.UniformsLib.shadowmap,{ambient:{type:"c",value:new c.Color(328965)}}]),vertexShader:["varying vec3 vLightWeighting;",c.ShaderChunk.map_pars_vertex,c.ShaderChunk.lightmap_pars_vertex,c.ShaderChunk.envmap_pars_vertex,c.ShaderChunk.lights_lambert_pars_vertex,c.ShaderChunk.color_pars_vertex,c.ShaderChunk.skinning_pars_vertex,c.ShaderChunk.morphtarget_pars_vertex,c.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",c.ShaderChunk.map_vertex,c.ShaderChunk.lightmap_vertex,c.ShaderChunk.envmap_vertex,c.ShaderChunk.color_vertex,"vec3 transformedNormal = normalize( normalMatrix * normal );",c.ShaderChunk.lights_lambert_vertex,c.ShaderChunk.skinning_vertex,c.ShaderChunk.morphtarget_vertex,c.ShaderChunk.default_vertex,c.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;\nvarying vec3 vLightWeighting;",c.ShaderChunk.color_pars_fragment,c.ShaderChunk.map_pars_fragment,c.ShaderChunk.lightmap_pars_fragment,c.ShaderChunk.envmap_pars_fragment,c.ShaderChunk.fog_pars_fragment,c.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );",c.ShaderChunk.map_fragment,c.ShaderChunk.alphatest_fragment,"gl_FragColor.xyz = gl_FragColor.xyz * vLightWeighting;",c.ShaderChunk.lightmap_fragment,c.ShaderChunk.color_fragment,c.ShaderChunk.envmap_fragment,c.ShaderChunk.shadowmap_fragment,c.ShaderChunk.linear_to_gamma_fragment,c.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:c.UniformsUtils.merge([c.UniformsLib.common,c.UniformsLib.fog,c.UniformsLib.lights,c.UniformsLib.shadowmap,{ambient:{type:"c",value:new c.Color(328965)},specular:{type:"c",value:new c.Color(1118481)},shininess:{type:"f",value:30}}]),vertexShader:["varying vec3 vViewPosition;\nvarying vec3 vNormal;",c.ShaderChunk.map_pars_vertex,c.ShaderChunk.lightmap_pars_vertex,c.ShaderChunk.envmap_pars_vertex,c.ShaderChunk.lights_phong_pars_vertex,c.ShaderChunk.color_pars_vertex,c.ShaderChunk.skinning_pars_vertex,c.ShaderChunk.morphtarget_pars_vertex,c.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",c.ShaderChunk.map_vertex,c.ShaderChunk.lightmap_vertex,c.ShaderChunk.envmap_vertex,c.ShaderChunk.color_vertex,"#ifndef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\n#endif\nvViewPosition = -mvPosition.xyz;\nvec3 transformedNormal = normalMatrix * normal;\nvNormal = transformedNormal;",c.ShaderChunk.lights_phong_vertex,c.ShaderChunk.skinning_vertex,c.ShaderChunk.morphtarget_vertex,c.ShaderChunk.default_vertex,c.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform vec3 ambient;\nuniform vec3 specular;\nuniform float shininess;",c.ShaderChunk.color_pars_fragment,c.ShaderChunk.map_pars_fragment,c.ShaderChunk.lightmap_pars_fragment,c.ShaderChunk.envmap_pars_fragment,c.ShaderChunk.fog_pars_fragment,c.ShaderChunk.lights_phong_pars_fragment,c.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );",c.ShaderChunk.map_fragment,c.ShaderChunk.alphatest_fragment,c.ShaderChunk.lights_phong_fragment,c.ShaderChunk.lightmap_fragment,c.ShaderChunk.color_fragment,c.ShaderChunk.envmap_fragment,c.ShaderChunk.shadowmap_fragment,c.ShaderChunk.linear_to_gamma_fragment,c.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:c.UniformsUtils.merge([c.UniformsLib.particle,c.UniformsLib.shadowmap]),vertexShader:["uniform float size;\nuniform float scale;",c.ShaderChunk.color_pars_vertex,c.ShaderChunk.shadowmap_pars_vertex,"void main() {",c.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n#ifdef USE_SIZEATTENUATION\ngl_PointSize = size * ( scale / length( mvPosition.xyz ) );\n#else\ngl_PointSize = size;\n#endif\ngl_Position = projectionMatrix * mvPosition;",c.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;\nuniform float opacity;",c.ShaderChunk.color_pars_fragment,c.ShaderChunk.map_particle_pars_fragment,c.ShaderChunk.fog_pars_fragment,c.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( psColor, opacity );",c.ShaderChunk.map_particle_fragment,c.ShaderChunk.alphatest_fragment,c.ShaderChunk.color_fragment,c.ShaderChunk.shadowmap_fragment,c.ShaderChunk.fog_fragment,"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[c.ShaderChunk.morphtarget_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",c.ShaderChunk.morphtarget_vertex,c.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:"vec4 pack_depth( const in float depth ) {\nconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\nconst vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\nvec4 res = fract( depth * bit_shift );\nres -= res.xxyz * bit_mask;\nreturn res;\n}\nvoid main() {\ngl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );\n}"}};c.WebGLRenderer=function(am){function ao(aB,aC){var aD=aB.vertices.length,z=aC.material;if(z.attributes){if(aB.__webglCustomAttributesList===void 0){aB.__webglCustomAttributesList=[]}for(var aA in z.attributes){var D=z.attributes[aA];if(!D.__webglInitialized||D.createUniqueBuffers){D.__webglInitialized=!0;var C=1;D.type==="v2"?C=2:D.type==="v3"?C=3:D.type==="v4"?C=4:D.type==="c"&&(C=3);D.size=C;D.array=new Float32Array(aD*C);D.buffer=u.createBuffer();D.buffer.belongsToAttribute=aA;D.needsUpdate=!0}aB.__webglCustomAttributesList.push(D)}}}function an(z,C){if(z.material&&!(z.material instanceof c.MeshFaceMaterial)){return z.material}else{if(C.materialIndex>=0){return z.geometry.materials[C.materialIndex]}}}function aq(z){if(z instanceof c.MeshBasicMaterial&&!z.envMap||z instanceof c.MeshDepthMaterial){return !1}return z&&z.shading!==void 0&&z.shading===c.SmoothShading?c.SmoothShading:c.FlatShading}function au(z){if(z.vertexColors){return z.vertexColors}return !1}function at(z){if(z.map||z.lightMap||z instanceof c.ShaderMaterial){return !0}return !1}function ar(aG,aI,aK){var D,aD,aC,aA,aE=aG.vertices;aA=aE.length;var aF=aG.colors,aM=aF.length,aH=aG.__vertexArray,z=aG.__colorArray,aJ=aG.__sortArray,C=aG.__dirtyVertices,aB=aG.__dirtyColors,aL=aG.__webglCustomAttributesList;if(aK.sortParticles){X.multiplySelf(aK.matrixWorld);for(D=0;D<aA;D++){aD=aE[D].position,l.copy(aD),X.multiplyVector3(l),aJ[D]=[l.z,D]}aJ.sort(function(aN,aO){return aO[0]-aN[0]});for(D=0;D<aA;D++){aD=aE[aJ[D][1]].position,aC=D*3,aH[aC]=aD.x,aH[aC+1]=aD.y,aH[aC+2]=aD.z}for(D=0;D<aM;D++){aC=D*3,aD=aF[aJ[D][1]],z[aC]=aD.r,z[aC+1]=aD.g,z[aC+2]=aD.b}if(aL){aF=0;for(aM=aL.length;aF<aM;aF++){if(aE=aL[aF],aE.boundTo===void 0||aE.boundTo==="vertices"){if(aC=0,aD=aE.value.length,aE.size===1){for(D=0;D<aD;D++){aA=aJ[D][1],aE.array[D]=aE.value[aA]}}else{if(aE.size===2){for(D=0;D<aD;D++){aA=aJ[D][1],aA=aE.value[aA],aE.array[aC]=aA.x,aE.array[aC+1]=aA.y,aC+=2}}else{if(aE.size===3){if(aE.type==="c"){for(D=0;D<aD;D++){aA=aJ[D][1],aA=aE.value[aA],aE.array[aC]=aA.r,aE.array[aC+1]=aA.g,aE.array[aC+2]=aA.b,aC+=3}}else{for(D=0;D<aD;D++){aA=aJ[D][1],aA=aE.value[aA],aE.array[aC]=aA.x,aE.array[aC+1]=aA.y,aE.array[aC+2]=aA.z,aC+=3}}}else{if(aE.size===4){for(D=0;D<aD;D++){aA=aJ[D][1],aA=aE.value[aA],aE.array[aC]=aA.x,aE.array[aC+1]=aA.y,aE.array[aC+2]=aA.z,aE.array[aC+3]=aA.w,aC+=4}}}}}}}}}else{if(C){for(D=0;D<aA;D++){aD=aE[D].position,aC=D*3,aH[aC]=aD.x,aH[aC+1]=aD.y,aH[aC+2]=aD.z}}if(aB){for(D=0;D<aM;D++){aD=aF[D],aC=D*3,z[aC]=aD.r,z[aC+1]=aD.g,z[aC+2]=aD.b}}if(aL){aF=0;for(aM=aL.length;aF<aM;aF++){if(aE=aL[aF],aE.needsUpdate&&(aE.boundTo===void 0||aE.boundTo==="vertices")){if(aD=aE.value.length,aC=0,aE.size===1){for(D=0;D<aD;D++){aE.array[D]=aE.value[D]}}else{if(aE.size===2){for(D=0;D<aD;D++){aA=aE.value[D],aE.array[aC]=aA.x,aE.array[aC+1]=aA.y,aC+=2}}else{if(aE.size===3){if(aE.type==="c"){for(D=0;D<aD;D++){aA=aE.value[D],aE.array[aC]=aA.r,aE.array[aC+1]=aA.g,aE.array[aC+2]=aA.b,aC+=3}}else{for(D=0;D<aD;D++){aA=aE.value[D],aE.array[aC]=aA.x,aE.array[aC+1]=aA.y,aE.array[aC+2]=aA.z,aC+=3}}}else{if(aE.size===4){for(D=0;D<aD;D++){aA=aE.value[D],aE.array[aC]=aA.x,aE.array[aC+1]=aA.y,aE.array[aC+2]=aA.z,aE.array[aC+3]=aA.w,aC+=4}}}}}}}}}if(C||aK.sortParticles){u.bindBuffer(u.ARRAY_BUFFER,aG.__webglVertexBuffer),u.bufferData(u.ARRAY_BUFFER,aH,aI)}if(aB||aK.sortParticles){u.bindBuffer(u.ARRAY_BUFFER,aG.__webglColorBuffer),u.bufferData(u.ARRAY_BUFFER,z,aI)}if(aL){aF=0;for(aM=aL.length;aF<aM;aF++){if(aE=aL[aF],aE.needsUpdate||aK.sortParticles){u.bindBuffer(u.ARRAY_BUFFER,aE.buffer),u.bufferData(u.ARRAY_BUFFER,aE.array,aI)}}}}function s(aK,aA,aB){if(!aK.__webglVertexBuffer){aK.__webglVertexBuffer=u.createBuffer()}if(!aK.__webglNormalBuffer){aK.__webglNormalBuffer=u.createBuffer()}aK.hasPos&&(u.bindBuffer(u.ARRAY_BUFFER,aK.__webglVertexBuffer),u.bufferData(u.ARRAY_BUFFER,aK.positionArray,u.DYNAMIC_DRAW),u.enableVertexAttribArray(aA.attributes.position),u.vertexAttribPointer(aA.attributes.position,3,u.FLOAT,!1,0,0));if(aK.hasNormal){u.bindBuffer(u.ARRAY_BUFFER,aK.__webglNormalBuffer);if(aB===c.FlatShading){var aD,aG,aF,aE,aH,aI,C,aJ,D,z,aC=aK.count*3;for(z=0;z<aC;z+=9){aB=aK.normalArray,aD=aB[z],aG=aB[z+1],aF=aB[z+2],aE=aB[z+3],aI=aB[z+4],aJ=aB[z+5],aH=aB[z+6],C=aB[z+7],D=aB[z+8],aD=(aD+aE+aH)/3,aG=(aG+aI+C)/3,aF=(aF+aJ+D)/3,aB[z]=aD,aB[z+1]=aG,aB[z+2]=aF,aB[z+3]=aD,aB[z+4]=aG,aB[z+5]=aF,aB[z+6]=aD,aB[z+7]=aG,aB[z+8]=aF}}u.bufferData(u.ARRAY_BUFFER,aK.normalArray,u.DYNAMIC_DRAW);u.enableVertexAttribArray(aA.attributes.normal);u.vertexAttribPointer(aA.attributes.normal,3,u.FLOAT,!1,0,0)}u.drawArrays(u.TRIANGLES,0,aK.count);aK.count=0}function t(aB,aD,aE,aF,aI,aH){if(aF.opacity!==0){var aG,aJ,aE=L(aB,aD,aE,aF,aH),aD=aE.attributes,aB=!1,aE=aI.id*16777215+aE.id*2+(aF.wireframe?1:0);aE!==k&&(k=aE,aB=!0);if(!aF.morphTargets&&aD.position>=0){aB&&(u.bindBuffer(u.ARRAY_BUFFER,aI.__webglVertexBuffer),u.vertexAttribPointer(aD.position,3,u.FLOAT,!1,0,0))}else{if(aH.morphTargetBase){aE=aF.program.attributes;aH.morphTargetBase!==-1?(u.bindBuffer(u.ARRAY_BUFFER,aI.__webglMorphTargetsBuffers[aH.morphTargetBase]),u.vertexAttribPointer(aE.position,3,u.FLOAT,!1,0,0)):aE.position>=0&&(u.bindBuffer(u.ARRAY_BUFFER,aI.__webglVertexBuffer),u.vertexAttribPointer(aE.position,3,u.FLOAT,!1,0,0));if(aH.morphTargetForcedOrder.length){aG=0;var z=aH.morphTargetForcedOrder;for(aJ=aH.morphTargetInfluences;aG<aF.numSupportedMorphTargets&&aG<z.length;){u.bindBuffer(u.ARRAY_BUFFER,aI.__webglMorphTargetsBuffers[z[aG]]),u.vertexAttribPointer(aE["morphTarget"+aG],3,u.FLOAT,!1,0,0),aH.__webglMorphTargetInfluences[aG]=aJ[z[aG]],aG++}}else{var z=[],aA=-1,D=0;aJ=aH.morphTargetInfluences;var C,aC=aJ.length;aG=0;for(aH.morphTargetBase!==-1&&(z[aH.morphTargetBase]=!0);aG<aF.numSupportedMorphTargets;){for(C=0;C<aC;C++){!z[C]&&aJ[C]>aA&&(D=C,aA=aJ[D])}u.bindBuffer(u.ARRAY_BUFFER,aI.__webglMorphTargetsBuffers[D]);u.vertexAttribPointer(aE["morphTarget"+aG],3,u.FLOAT,!1,0,0);aH.__webglMorphTargetInfluences[aG]=aA;z[D]=1;aA=-1;aG++}}aF.program.uniforms.morphTargetInfluences!==null&&u.uniform1fv(aF.program.uniforms.morphTargetInfluences,aH.__webglMorphTargetInfluences)}}if(aB){if(aI.__webglCustomAttributesList){aG=0;for(aJ=aI.__webglCustomAttributesList.length;aG<aJ;aG++){aE=aI.__webglCustomAttributesList[aG],aD[aE.buffer.belongsToAttribute]>=0&&(u.bindBuffer(u.ARRAY_BUFFER,aE.buffer),u.vertexAttribPointer(aD[aE.buffer.belongsToAttribute],aE.size,u.FLOAT,!1,0,0))}}aD.color>=0&&(u.bindBuffer(u.ARRAY_BUFFER,aI.__webglColorBuffer),u.vertexAttribPointer(aD.color,3,u.FLOAT,!1,0,0));aD.normal>=0&&(u.bindBuffer(u.ARRAY_BUFFER,aI.__webglNormalBuffer),u.vertexAttribPointer(aD.normal,3,u.FLOAT,!1,0,0));aD.tangent>=0&&(u.bindBuffer(u.ARRAY_BUFFER,aI.__webglTangentBuffer),u.vertexAttribPointer(aD.tangent,4,u.FLOAT,!1,0,0));aD.uv>=0&&(aI.__webglUVBuffer?(u.bindBuffer(u.ARRAY_BUFFER,aI.__webglUVBuffer),u.vertexAttribPointer(aD.uv,2,u.FLOAT,!1,0,0),u.enableVertexAttribArray(aD.uv)):u.disableVertexAttribArray(aD.uv));aD.uv2>=0&&(aI.__webglUV2Buffer?(u.bindBuffer(u.ARRAY_BUFFER,aI.__webglUV2Buffer),u.vertexAttribPointer(aD.uv2,2,u.FLOAT,!1,0,0),u.enableVertexAttribArray(aD.uv2)):u.disableVertexAttribArray(aD.uv2));aF.skinning&&aD.skinVertexA>=0&&aD.skinVertexB>=0&&aD.skinIndex>=0&&aD.skinWeight>=0&&(u.bindBuffer(u.ARRAY_BUFFER,aI.__webglSkinVertexABuffer),u.vertexAttribPointer(aD.skinVertexA,4,u.FLOAT,!1,0,0),u.bindBuffer(u.ARRAY_BUFFER,aI.__webglSkinVertexBBuffer),u.vertexAttribPointer(aD.skinVertexB,4,u.FLOAT,!1,0,0),u.bindBuffer(u.ARRAY_BUFFER,aI.__webglSkinIndicesBuffer),u.vertexAttribPointer(aD.skinIndex,4,u.FLOAT,!1,0,0),u.bindBuffer(u.ARRAY_BUFFER,aI.__webglSkinWeightsBuffer),u.vertexAttribPointer(aD.skinWeight,4,u.FLOAT,!1,0,0))}aH instanceof c.Mesh?(aF.wireframe?(aF=aF.wireframeLinewidth,aF!==m&&(u.lineWidth(aF),m=aF),aB&&u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,aI.__webglLineBuffer),u.drawElements(u.LINES,aI.__webglLineCount,u.UNSIGNED_SHORT,0)):(aB&&u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,aI.__webglFaceBuffer),u.drawElements(u.TRIANGLES,aI.__webglFaceCount,u.UNSIGNED_SHORT,0)),ah.info.render.calls++,ah.info.render.vertices+=aI.__webglFaceCount,ah.info.render.faces+=aI.__webglFaceCount/3):aH instanceof c.Line?(aH=aH.type===c.LineStrip?u.LINE_STRIP:u.LINES,aF=aF.linewidth,aF!==m&&(u.lineWidth(aF),m=aF),u.drawArrays(aH,0,aI.__webglLineCount),ah.info.render.calls++):aH instanceof c.ParticleSystem?(u.drawArrays(u.POINTS,0,aI.__webglParticleCount),ah.info.render.calls++):aH instanceof c.Ribbon&&(u.drawArrays(u.TRIANGLE_STRIP,0,aI.__webglVertexCount),ah.info.render.calls++)}}function x(z){aX[0].set(z.n41-z.n11,z.n42-z.n12,z.n43-z.n13,z.n44-z.n14);aX[1].set(z.n41+z.n11,z.n42+z.n12,z.n43+z.n13,z.n44+z.n14);aX[2].set(z.n41+z.n21,z.n42+z.n22,z.n43+z.n23,z.n44+z.n24);aX[3].set(z.n41-z.n21,z.n42-z.n22,z.n43-z.n23,z.n44-z.n24);aX[4].set(z.n41-z.n31,z.n42-z.n32,z.n43-z.n33,z.n44-z.n34);aX[5].set(z.n41+z.n31,z.n42+z.n32,z.n43+z.n33,z.n44+z.n34);for(var C,z=0;z<6;z++){C=aX[z],C.divideScalar(Math.sqrt(C.x*C.x+C.y*C.y+C.z*C.z))}}function v(D){for(var aA=D.matrixWorld,z=-D.geometry.boundingSphere.radius*Math.max(D.scale.x,Math.max(D.scale.y,D.scale.z)),C=0;C<6;C++){if(D=aX[C].x*aA.n14+aX[C].y*aA.n24+aX[C].z*aA.n34+aX[C].w,D<=z){return !1}}return !0}function F(z,C){return C.z-z.z}function G(aE){var aF,aG,aH,D,C,z,aA,aB,aC=0,aD=aE.lights;aj||(aj=new c.PerspectiveCamera(ah.shadowCameraFov,ah.shadowMapWidth/ah.shadowMapHeight,ah.shadowCameraNear,ah.shadowCameraFar));aF=0;for(aG=aD.length;aF<aG;aF++){if(aB=aD[aF],aB.castShadow&&aB instanceof c.SpotLight){n=-1;ah.shadowMap[aC]||(ah.shadowMap[aC]=new c.WebGLRenderTarget(ah.shadowMapWidth,ah.shadowMapHeight,{minFilter:c.LinearFilter,magFilter:c.LinearFilter,format:c.RGBAFormat}),b[aC]=new c.Matrix4);aH=ah.shadowMap[aC];D=b[aC];aj.position.copy(aB.position);aj.lookAt(aB.target.position);aj.parent==null&&(console.warn("Camera is not on the Scene. Adding it..."),aE.add(aj),this.autoUpdateScene&&aE.updateMatrixWorld());aj.matrixWorldInverse.getInverse(aj.matrixWorld);D.set(0.5,0,0,0.5,0,0.5,0,0.5,0,0,0.5,0.5,0,0,0,1);D.multiplySelf(aj.projectionMatrix);D.multiplySelf(aj.matrixWorldInverse);aj.matrixWorldInverse.flattenToArray(f);aj.projectionMatrix.flattenToArray(B);X.multiply(aj.projectionMatrix,aj.matrixWorldInverse);x(X);af(aH);u.clearColor(1,1,1,1);ah.clear();u.clearColor(W.r,W.g,W.b,ad);D=aE.__webglObjects.length;for(aH=0;aH<D;aH++){if(z=aE.__webglObjects[aH],aB=z.object,z.render=!1,aB.visible&&aB.castShadow&&(!(aB instanceof c.Mesh)||!aB.frustumCulled||v(aB))){aB.matrixWorld.flattenToArray(aB._objectMatrixArray),aw(aB,aj,!1),z.render=!0}}av(!0);M(c.NormalBlending);for(aH=0;aH<D;aH++){if(z=aE.__webglObjects[aH],z.render){aB=z.object,z=z.buffer,az(aB),aA=aB.customDepthMaterial?aB.customDepthMaterial:aB.geometry.morphTargets.length?q:Q,t(aj,aD,null,aA,z,aB)}}D=aE.__webglObjectsImmediate.length;for(aH=0;aH<D;aH++){z=aE.__webglObjectsImmediate[aH],aB=z.object,aB.visible&&aB.castShadow&&(aB.matrixAutoUpdate&&aB.matrixWorld.flattenToArray(aB._objectMatrixArray),k=-1,aw(aB,aj,!1),az(aB),C=L(aj,aD,null,Q,aB),aB.immediateRenderCallback?aB.immediateRenderCallback(C,u,aX):aB.render(function(aI){s(aI,C,Q.shading)}))}aC++}}}function A(aB,aD,aE,aF,aI,aH,aG,aJ){var z,aA,aC,D;aD?(aA=aB.length-1,D=aD=-1):(aA=0,aD=aB.length,D=1);for(var C=aA;C!==aD;C+=D){if(z=aB[C],z.render){aA=z.object;aC=z.buffer;if(aJ){z=aJ}else{z=z[aE];if(!z){continue}aG&&M(z.blending);av(z.depthTest);O(z.depthWrite);P(z.polygonOffset,z.polygonOffsetFactor,z.polygonOffsetUnits)}az(aA);t(aF,aI,aH,z,aC,aA)}}}function I(aA,aD,aE,aF,aI,aH,aG){for(var aJ,D,aB,C,z=0,aC=aA.length;z<aC;z++){if(aJ=aA[z],D=aJ.object,D.visible){k=-1;if(aG){aB=aG}else{aB=aJ[aD];if(!aB){continue}aH&&M(aB.blending);av(aB.depthTest);O(aB.depthWrite);P(aB.polygonOffset,aB.polygonOffsetFactor,aB.polygonOffsetUnits)}az(D);C=L(aE,aF,aI,aB,D);D.immediateRenderCallback?D.immediateRenderCallback(C,u,aX):D.render(function(aK){s(aK,C,aB.shading)})}}}function E(C,D,z){C.push({buffer:D,object:z,opaque:null,transparent:null})}function H(z){for(var C in z.attributes){if(z.attributes[C].needsUpdate){return !0}}return !1}function K(z){for(var C in z.attributes){z.attributes[C].needsUpdate=!1}}function N(C,D){for(var z=C.length-1;z>=0;z--){C[z].object===D&&C.splice(z,1)}}function L(z,C,D,aA,aD){aA.program||ah.initMaterial(aA,C,D,aD);if(aA.morphTargets&&!aD.__webglMorphTargetInfluences){aD.__webglMorphTargetInfluences=new Float32Array(ah.maxMorphTargets);for(var aC=0,aB=ah.maxMorphTargets;aC<aB;aC++){aD.__webglMorphTargetInfluences[aC]=0}}var aE=!1,aC=aA.program,aB=aC.uniforms,aF=aA.uniforms;aC!==ag&&(u.useProgram(aC),ag=aC,aE=!0);if(aA.id!==n){n=aA.id,aE=!0}if(aE){u.uniformMatrix4fv(aB.projectionMatrix,!1,B);if(D&&aA.fog){if(aF.fogColor.value=D.color,D instanceof c.Fog){aF.fogNear.value=D.near,aF.fogFar.value=D.far}else{if(D instanceof c.FogExp2){aF.fogDensity.value=D.density}}}if(aA instanceof c.MeshPhongMaterial||aA instanceof c.MeshLambertMaterial||aA.lights){for(var aI,aJ,aH=0,aG=0,aL=0,aN,aM,aP,aQ=h,aR=aQ.directional.colors,aS=aQ.directional.positions,aZ=aQ.point.colors,aY=aQ.point.positions,aT=aQ.point.distances,aK=0,aO=0,D=aI=aP=0,aE=C.length;D<aE;D++){if(aI=C[D],aJ=aI.color,aN=aI.position,aM=aI.intensity,aP=aI.distance,aI instanceof c.AmbientLight){ah.gammaInput?(aH+=aJ.r*aJ.r,aG+=aJ.g*aJ.g,aL+=aJ.b*aJ.b):(aH+=aJ.r,aG+=aJ.g,aL+=aJ.b)}else{if(aI instanceof c.DirectionalLight){aP=aK*3,ah.gammaInput?(aR[aP]=aJ.r*aJ.r*aM*aM,aR[aP+1]=aJ.g*aJ.g*aM*aM,aR[aP+2]=aJ.b*aJ.b*aM*aM):(aR[aP]=aJ.r*aM,aR[aP+1]=aJ.g*aM,aR[aP+2]=aJ.b*aM),aS[aP]=aN.x,aS[aP+1]=aN.y,aS[aP+2]=aN.z,aK+=1}else{if(aI instanceof c.SpotLight){aP=aK*3,ah.gammaInput?(aR[aP]=aJ.r*aJ.r*aM*aM,aR[aP+1]=aJ.g*aJ.g*aM*aM,aR[aP+2]=aJ.b*aJ.b*aM*aM):(aR[aP]=aJ.r*aM,aR[aP+1]=aJ.g*aM,aR[aP+2]=aJ.b*aM),aJ=1/aN.length(),aS[aP]=aN.x*aJ,aS[aP+1]=aN.y*aJ,aS[aP+2]=aN.z*aJ,aK+=1}else{if(aI instanceof c.PointLight){aI=aO*3,ah.gammaInput?(aZ[aI]=aJ.r*aJ.r*aM*aM,aZ[aI+1]=aJ.g*aJ.g*aM*aM,aZ[aI+2]=aJ.b*aJ.b*aM*aM):(aZ[aI]=aJ.r*aM,aZ[aI+1]=aJ.g*aM,aZ[aI+2]=aJ.b*aM),aY[aI]=aN.x,aY[aI+1]=aN.y,aY[aI+2]=aN.z,aT[aO]=aP,aO+=1}}}}}D=aK*3;for(aE=aR.length;D<aE;D++){aR[D]=0}D=aO*3;for(aE=aZ.length;D<aE;D++){aZ[D]=0}aQ.point.length=aO;aQ.directional.length=aK;aQ.ambient[0]=aH;aQ.ambient[1]=aG;aQ.ambient[2]=aL;C=h;aF.ambientLightColor.value=C.ambient;aF.directionalLightColor.value=C.directional.colors;aF.directionalLightDirection.value=C.directional.positions;aF.pointLightColor.value=C.point.colors;aF.pointLightPosition.value=C.point.positions;aF.pointLightDistance.value=C.point.distances}if(aA instanceof c.MeshBasicMaterial||aA instanceof c.MeshLambertMaterial||aA instanceof c.MeshPhongMaterial){aF.opacity.value=aA.opacity,ah.gammaInput?aF.diffuse.value.copyGammaToLinear(aA.color):aF.diffuse.value=aA.color,(aF.map.texture=aA.map)&&aF.offsetRepeat.value.set(aA.map.offset.x,aA.map.offset.y,aA.map.repeat.x,aA.map.repeat.y),aF.lightMap.texture=aA.lightMap,aF.envMap.texture=aA.envMap,aF.flipEnvMap.value=aA.envMap instanceof c.WebGLRenderTargetCube?1:-1,aF.reflectivity.value=aA.reflectivity,aF.refractionRatio.value=aA.refractionRatio,aF.combine.value=aA.combine,aF.useRefract.value=aA.envMap&&aA.envMap.mapping instanceof c.CubeRefractionMapping}if(aA instanceof c.LineBasicMaterial){aF.diffuse.value=aA.color,aF.opacity.value=aA.opacity}else{if(aA instanceof c.ParticleBasicMaterial){aF.psColor.value=aA.color,aF.opacity.value=aA.opacity,aF.size.value=aA.size,aF.scale.value=Y.height/2,aF.map.texture=aA.map}else{if(aA instanceof c.MeshPhongMaterial){aF.shininess.value=aA.shininess,ah.gammaInput?(aF.ambient.value.copyGammaToLinear(aA.ambient),aF.specular.value.copyGammaToLinear(aA.specular)):(aF.ambient.value=aA.ambient,aF.specular.value=aA.specular)}else{if(aA instanceof c.MeshLambertMaterial){ah.gammaInput?aF.ambient.value.copyGammaToLinear(aA.ambient):aF.ambient.value=aA.ambient}else{if(aA instanceof c.MeshDepthMaterial){aF.mNear.value=z.near,aF.mFar.value=z.far,aF.opacity.value=aA.opacity}else{if(aA instanceof c.MeshNormalMaterial){aF.opacity.value=aA.opacity}}}}}}if(aD.receiveShadow&&!aA._shadowPass&&aF.shadowMatrix){for(C=0;C<b.length;C++){aF.shadowMatrix.value[C]=b[C],aF.shadowMap.texture[C]=ah.shadowMap[C]}aF.shadowDarkness.value=ah.shadowMapDarkness;aF.shadowBias.value=ah.shadowMapBias}C=aA.uniformsList;aF=0;for(D=C.length;aF<D;aF++){if(aG=aC.uniforms[C[aF][1]]){if(aH=C[aF][0],aL=aH.type,aE=aH.value,aL==="i"){u.uniform1i(aG,aE)}else{if(aL==="f"){u.uniform1f(aG,aE)}else{if(aL==="v2"){u.uniform2f(aG,aE.x,aE.y)}else{if(aL==="v3"){u.uniform3f(aG,aE.x,aE.y,aE.z)}else{if(aL==="v4"){u.uniform4f(aG,aE.x,aE.y,aE.z,aE.w)}else{if(aL==="c"){u.uniform3f(aG,aE.r,aE.g,aE.b)}else{if(aL==="fv1"){u.uniform1fv(aG,aE)}else{if(aL==="fv"){u.uniform3fv(aG,aE)}else{if(aL==="v3v"){if(!aH._array){aH._array=new Float32Array(3*aE.length)}aL=0;for(aN=aE.length;aL<aN;aL++){aQ=aL*3,aH._array[aQ]=aE[aL].x,aH._array[aQ+1]=aE[aL].y,aH._array[aQ+2]=aE[aL].z}u.uniform3fv(aG,aH._array)}else{if(aL==="m4"){if(!aH._array){aH._array=new Float32Array(16)}aE.flattenToArray(aH._array);u.uniformMatrix4fv(aG,!1,aH._array)}else{if(aL==="m4v"){if(!aH._array){aH._array=new Float32Array(16*aE.length)}aL=0;for(aN=aE.length;aL<aN;aL++){aE[aL].flattenToArrayOffset(aH._array,aL*16)}u.uniformMatrix4fv(aG,!1,aH._array)}else{if(aL==="t"){if(u.uniform1i(aG,aE),aG=aH.texture){if(aG.image instanceof Array&&aG.image.length===6){if(aH=aG,aH.image.length===6){if(aH.needsUpdate){if(!aH.image.__webglTextureCube){aH.image.__webglTextureCube=u.createTexture()}u.activeTexture(u.TEXTURE0+aE);u.bindTexture(u.TEXTURE_CUBE_MAP,aH.image.__webglTextureCube);aE=J(u.TEXTURE_CUBE_MAP,aH,aH.image[0]);for(aG=0;aG<6;aG++){u.texImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+aG,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,aH.image[aG])}aE&&u.generateMipmap(u.TEXTURE_CUBE_MAP);aH.needsUpdate=!1}else{u.activeTexture(u.TEXTURE0+aE),u.bindTexture(u.TEXTURE_CUBE_MAP,aH.image.__webglTextureCube)}}}else{aG instanceof c.WebGLRenderTargetCube?(aH=aG,u.activeTexture(u.TEXTURE0+aE),u.bindTexture(u.TEXTURE_CUBE_MAP,aH.__webglTexture)):ay(aG,aE)}}}else{if(aL==="tv"){if(!aH._array){aH._array=[];aL=0;for(aN=aH.texture.length;aL<aN;aL++){aH._array[aL]=aE+aL}}u.uniform1iv(aG,aH._array);aL=0;for(aN=aH.texture.length;aL<aN;aL++){(aG=aH.texture[aL])&&ay(aG,aH._array[aL])}}}}}}}}}}}}}}}}(aA instanceof c.ShaderMaterial||aA instanceof c.MeshPhongMaterial||aA.envMap)&&aB.cameraPosition!==null&&u.uniform3f(aB.cameraPosition,z.position.x,z.position.y,z.position.z);(aA instanceof c.MeshPhongMaterial||aA instanceof c.MeshLambertMaterial||aA instanceof c.ShaderMaterial||aA.skinning)&&aB.viewMatrix!==null&&u.uniformMatrix4fv(aB.viewMatrix,!1,f);aA.skinning&&(u.uniformMatrix4fv(aB.cameraInverseMatrix,!1,f),u.uniformMatrix4fv(aB.boneGlobalMatrices,!1,aD.boneMatrices))}u.uniformMatrix4fv(aB.modelViewMatrix,!1,aD._modelViewMatrixArray);aB.normalMatrix&&u.uniformMatrix3fv(aB.normalMatrix,!1,aD._normalMatrixArray);(aA instanceof c.ShaderMaterial||aA.envMap||aA.skinning||aD.receiveShadow)&&aB.objectMatrix!==null&&u.uniformMatrix4fv(aB.objectMatrix,!1,aD._objectMatrixArray);return aC}function aw(C,D,z){C._modelViewMatrix.multiplyToArray(D.matrixWorldInverse,C.matrixWorld,C._modelViewMatrixArray);z&&c.Matrix4.makeInvert3x3(C._modelViewMatrix).transposeIntoArray(C._normalMatrixArray)}function az(z){if(e!==z.doubleSided){z.doubleSided?u.disable(u.CULL_FACE):u.enable(u.CULL_FACE),e=z.doubleSided}if(w!==z.flipSided){z.flipSided?u.frontFace(u.CW):u.frontFace(u.CCW),w=z.flipSided}}function av(z){ap!==z&&(z?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),ap=z)}function O(z){R!==z&&(u.depthMask(z),R=z)}function P(C,D,z){r!==C&&(C?u.enable(u.POLYGON_OFFSET_FILL):u.disable(u.POLYGON_OFFSET_FILL),r=C);if(C&&(p!==D||g!==z)){u.polygonOffset(D,z),p=D,g=z}}function M(z){if(z!==ax){switch(z){case c.AdditiveBlending:u.blendEquation(u.FUNC_ADD);u.blendFunc(u.SRC_ALPHA,u.ONE);break;case c.SubtractiveBlending:u.blendEquation(u.FUNC_ADD);u.blendFunc(u.ZERO,u.ONE_MINUS_SRC_COLOR);break;case c.MultiplyBlending:u.blendEquation(u.FUNC_ADD);u.blendFunc(u.ZERO,u.SRC_COLOR);break;default:u.blendEquationSeparate(u.FUNC_ADD,u.FUNC_ADD),u.blendFuncSeparate(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA,u.ONE,u.ONE_MINUS_SRC_ALPHA)}ax=z}}function a(C,D){var z;C==="fragment"?z=u.createShader(u.FRAGMENT_SHADER):C==="vertex"&&(z=u.createShader(u.VERTEX_SHADER));u.shaderSource(z,D);u.compileShader(z);if(!u.getShaderParameter(z,u.COMPILE_STATUS)){return console.error(u.getShaderInfoLog(z)),console.error(D),null}return z}function J(C,D,z){return(z.width&z.width-1)===0&&(z.height&z.height-1)===0?(u.texParameteri(C,u.TEXTURE_WRAP_S,aa(D.wrapS)),u.texParameteri(C,u.TEXTURE_WRAP_T,aa(D.wrapT)),u.texParameteri(C,u.TEXTURE_MAG_FILTER,aa(D.magFilter)),u.texParameteri(C,u.TEXTURE_MIN_FILTER,aa(D.minFilter)),!0):(u.texParameteri(C,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(C,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),u.texParameteri(C,u.TEXTURE_MAG_FILTER,U(D.magFilter)),u.texParameteri(C,u.TEXTURE_MIN_FILTER,U(D.minFilter)),!1)}function ay(C,D){if(C.needsUpdate){if(!C.__webglInit){C.__webglInit=!0,C.__webglTexture=u.createTexture(),ah.info.memory.textures++}u.activeTexture(u.TEXTURE0+D);u.bindTexture(u.TEXTURE_2D,C.__webglTexture);var z=J(u.TEXTURE_2D,C,C.image);C instanceof c.DataTexture?u.texImage2D(u.TEXTURE_2D,0,aa(C.format),C.image.width,C.image.height,0,aa(C.format),u.UNSIGNED_BYTE,C.image.data):u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,C.image);z&&u.generateMipmap(u.TEXTURE_2D);C.needsUpdate=!1;if(C.onUpdated){C.onUpdated()}}else{u.activeTexture(u.TEXTURE0+D),u.bindTexture(u.TEXTURE_2D,C.__webglTexture)}}function ac(z,C){u.bindRenderbuffer(u.RENDERBUFFER,z);C.depthBuffer&&!C.stencilBuffer?(u.renderbufferStorage(u.RENDERBUFFER,u.DEPTH_COMPONENT16,C.width,C.height),u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,u.RENDERBUFFER,z)):C.depthBuffer&&C.stencilBuffer?(u.renderbufferStorage(u.RENDERBUFFER,u.DEPTH_STENCIL,C.width,C.height),u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_STENCIL_ATTACHMENT,u.RENDERBUFFER,z)):u.renderbufferStorage(u.RENDERBUFFER,u.RGBA4,C.width,C.height)}function af(aA){var aB=aA instanceof c.WebGLRenderTargetCube;if(aA&&!aA.__webglFramebuffer){if(aA.depthBuffer===void 0){aA.depthBuffer=!0}if(aA.stencilBuffer===void 0){aA.stencilBuffer=!0}aA.__webglTexture=u.createTexture();if(aB){aA.__webglFramebuffer=[];aA.__webglRenderbuffer=[];u.bindTexture(u.TEXTURE_CUBE_MAP,aA.__webglTexture);J(u.TEXTURE_CUBE_MAP,aA,aA);for(var z=0;z<6;z++){aA.__webglFramebuffer[z]=u.createFramebuffer();aA.__webglRenderbuffer[z]=u.createRenderbuffer();u.texImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+z,0,aa(aA.format),aA.width,aA.height,0,aa(aA.format),aa(aA.type),null);var C=aA,D=u.TEXTURE_CUBE_MAP_POSITIVE_X+z;u.bindFramebuffer(u.FRAMEBUFFER,aA.__webglFramebuffer[z]);u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,D,C.__webglTexture,0);ac(aA.__webglRenderbuffer[z],aA)}}else{aA.__webglFramebuffer=u.createFramebuffer(),aA.__webglRenderbuffer=u.createRenderbuffer(),u.bindTexture(u.TEXTURE_2D,aA.__webglTexture),J(u.TEXTURE_2D,aA,aA),u.texImage2D(u.TEXTURE_2D,0,aa(aA.format),aA.width,aA.height,0,aa(aA.format),aa(aA.type),null),z=u.TEXTURE_2D,u.bindFramebuffer(u.FRAMEBUFFER,aA.__webglFramebuffer),u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,z,aA.__webglTexture,0),ac(aA.__webglRenderbuffer,aA)}aB?u.bindTexture(u.TEXTURE_CUBE_MAP,null):u.bindTexture(u.TEXTURE_2D,null);u.bindRenderbuffer(u.RENDERBUFFER,null);u.bindFramebuffer(u.FRAMEBUFFER,null)}aA?(aB=aB?aA.__webglFramebuffer[aA.activeCubeFace]:aA.__webglFramebuffer,z=aA.width,aA=aA.height,D=C=0):(aB=null,z=ab,aA=y,C=V,D=ak);aB!==S&&(u.bindFramebuffer(u.FRAMEBUFFER,aB),u.viewport(C,D,z,aA),S=aB)}function U(z){switch(z){case c.NearestFilter:case c.NearestMipMapNearestFilter:case c.NearestMipMapLinearFilter:return u.NEAREST;default:return u.LINEAR}}function aa(z){switch(z){case c.RepeatWrapping:return u.REPEAT;case c.ClampToEdgeWrapping:return u.CLAMP_TO_EDGE;case c.MirroredRepeatWrapping:return u.MIRRORED_REPEAT;case c.NearestFilter:return u.NEAREST;case c.NearestMipMapNearestFilter:return u.NEAREST_MIPMAP_NEAREST;case c.NearestMipMapLinearFilter:return u.NEAREST_MIPMAP_LINEAR;case c.LinearFilter:return u.LINEAR;case c.LinearMipMapNearestFilter:return u.LINEAR_MIPMAP_NEAREST;case c.LinearMipMapLinearFilter:return u.LINEAR_MIPMAP_LINEAR;case c.ByteType:return u.BYTE;case c.UnsignedByteType:return u.UNSIGNED_BYTE;case c.ShortType:return u.SHORT;case c.UnsignedShortType:return u.UNSIGNED_SHORT;case c.IntType:return u.INT;case c.UnsignedShortType:return u.UNSIGNED_INT;case c.FloatType:return u.FLOAT;case c.AlphaFormat:return u.ALPHA;case c.RGBFormat:return u.RGB;case c.RGBAFormat:return u.RGBA;case c.LuminanceFormat:return u.LUMINANCE;case c.LuminanceAlphaFormat:return u.LUMINANCE_ALPHA}return 0}var am=am||{},Y=am.canvas!==void 0?am.canvas:document.createElement("canvas"),o=am.precision!==void 0?am.precision:"highp",aV=am.antialias!==void 0?am.antialias:!1,aU=am.stencil!==void 0?am.stencil:!0,aW=am.preserveDrawingBuffer!==void 0?am.preserveDrawingBuffer:!1,W=am.clearColor!==void 0?new c.Color(am.clearColor):new c.Color(0),ad=am.clearAlpha!==void 0?am.clearAlpha:0,Z=am.maxLights!==void 0?am.maxLights:4;this.domElement=Y;this.context=null;this.autoUpdateScene=this.autoUpdateObjects=this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0;this.physicallyBasedShading=this.gammaOutput=this.gammaInput=!1;this.shadowMapBias=0.0039;this.shadowMapDarkness=0.5;this.shadowMapHeight=this.shadowMapWidth=512;this.shadowCameraNear=1;this.shadowCameraFar=5000;this.shadowCameraFov=50;this.shadowMap=[];this.shadowMapEnabled=!1;this.shadowMapSoft=this.shadowMapAutoUpdate=!0;this.maxMorphTargets=8;this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0}};var ah=this,u,ai=[],ag=null,S=null,n=-1,k=null,al=0,e=null,w=null,ax=null,ap=null,R=null,r=null,p=null,g=null,m=null,V=0,ak=0,ab=0,y=0,aX=[new c.Vector4,new c.Vector4,new c.Vector4,new c.Vector4,new c.Vector4,new c.Vector4],X=new c.Matrix4,B=new Float32Array(16),f=new Float32Array(16),l=new c.Vector4,h={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]}},aj,b=[],Q,q,ae={},T=!1;u=function(){var z;try{if(!(z=Y.getContext("experimental-webgl",{antialias:aV,stencil:aU,preserveDrawingBuffer:aW}))){throw"Error creating WebGL context."}console.log(navigator.userAgent+" | "+z.getParameter(z.VERSION)+" | "+z.getParameter(z.VENDOR)+" | "+z.getParameter(z.RENDERER)+" | "+z.getParameter(z.SHADING_LANGUAGE_VERSION))}catch(C){console.error(C)}return z}();u.clearColor(0,0,0,1);u.clearDepth(1);u.clearStencil(0);u.enable(u.DEPTH_TEST);u.depthFunc(u.LEQUAL);u.frontFace(u.CCW);u.cullFace(u.BACK);u.enable(u.CULL_FACE);u.enable(u.BLEND);u.blendEquation(u.FUNC_ADD);u.blendFunc(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA);u.clearColor(W.r,W.g,W.b,ad);(function(){ae.vertices=new Float32Array(16);ae.faces=new Uint16Array(6);var z=0;ae.vertices[z++]=-1;ae.vertices[z++]=-1;ae.vertices[z++]=0;ae.vertices[z++]=1;ae.vertices[z++]=1;ae.vertices[z++]=-1;ae.vertices[z++]=1;ae.vertices[z++]=1;ae.vertices[z++]=1;ae.vertices[z++]=1;ae.vertices[z++]=1;ae.vertices[z++]=0;ae.vertices[z++]=-1;ae.vertices[z++]=1;ae.vertices[z++]=0;z=ae.vertices[z++]=0;ae.faces[z++]=0;ae.faces[z++]=1;ae.faces[z++]=2;ae.faces[z++]=0;ae.faces[z++]=2;ae.faces[z++]=3;ae.vertexBuffer=u.createBuffer();ae.elementBuffer=u.createBuffer();u.bindBuffer(u.ARRAY_BUFFER,ae.vertexBuffer);u.bufferData(u.ARRAY_BUFFER,ae.vertices,u.STATIC_DRAW);u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,ae.elementBuffer);u.bufferData(u.ELEMENT_ARRAY_BUFFER,ae.faces,u.STATIC_DRAW);ae.program=u.createProgram();u.attachShader(ae.program,a("fragment",c.ShaderLib.sprite.fragmentShader));u.attachShader(ae.program,a("vertex",c.ShaderLib.sprite.vertexShader));u.linkProgram(ae.program);ae.attributes={};ae.uniforms={};ae.attributes.position=u.getAttribLocation(ae.program,"position");ae.attributes.uv=u.getAttribLocation(ae.program,"uv");ae.uniforms.uvOffset=u.getUniformLocation(ae.program,"uvOffset");ae.uniforms.uvScale=u.getUniformLocation(ae.program,"uvScale");ae.uniforms.rotation=u.getUniformLocation(ae.program,"rotation");ae.uniforms.scale=u.getUniformLocation(ae.program,"scale");ae.uniforms.alignment=u.getUniformLocation(ae.program,"alignment");ae.uniforms.color=u.getUniformLocation(ae.program,"color");ae.uniforms.map=u.getUniformLocation(ae.program,"map");ae.uniforms.opacity=u.getUniformLocation(ae.program,"opacity");ae.uniforms.useScreenCoordinates=u.getUniformLocation(ae.program,"useScreenCoordinates");ae.uniforms.affectedByDistance=u.getUniformLocation(ae.program,"affectedByDistance");ae.uniforms.screenPosition=u.getUniformLocation(ae.program,"screenPosition");ae.uniforms.modelViewMatrix=u.getUniformLocation(ae.program,"modelViewMatrix");ae.uniforms.projectionMatrix=u.getUniformLocation(ae.program,"projectionMatrix")})();(function(){var z=c.ShaderLib.depthRGBA,C=c.UniformsUtils.clone(z.uniforms);Q=new c.ShaderMaterial({fragmentShader:z.fragmentShader,vertexShader:z.vertexShader,uniforms:C});q=new c.ShaderMaterial({fragmentShader:z.fragmentShader,vertexShader:z.vertexShader,uniforms:C,morphTargets:!0});Q._shadowPass=!0;q._shadowPass=!0})();this.context=u;var j=u.getParameter(u.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;this.getContext=function(){return u};this.supportsVertexTextures=function(){return j};this.setSize=function(z,C){Y.width=z;Y.height=C;this.setViewport(0,0,Y.width,Y.height)};this.setViewport=function(D,aA,z,C){V=D;ak=aA;ab=z;y=C;u.viewport(V,ak,ab,y)};this.setScissor=function(D,aA,z,C){u.scissor(D,aA,z,C)};this.enableScissorTest=function(z){z?u.enable(u.SCISSOR_TEST):u.disable(u.SCISSOR_TEST)};this.setClearColorHex=function(z,C){W.setHex(z);ad=C;u.clearColor(W.r,W.g,W.b,ad)};this.setClearColor=function(z,C){W.copy(z);ad=C;u.clearColor(W.r,W.g,W.b,ad)};this.getClearColor=function(){return W};this.getClearAlpha=function(){return ad};this.clear=function(D,aA,z){var C=0;if(D===void 0||D){C|=u.COLOR_BUFFER_BIT}if(aA===void 0||aA){C|=u.DEPTH_BUFFER_BIT}if(z===void 0||z){C|=u.STENCIL_BUFFER_BIT}u.clear(C)};this.clearTarget=function(D,aA,z,C){af(D);this.clear(aA,z,C)};this.deallocateObject=function(aA){if(aA.__webglInit){if(aA.__webglInit=!1,delete aA._modelViewMatrix,delete aA._normalMatrixArray,delete aA._modelViewMatrixArray,delete aA._objectMatrixArray,aA instanceof c.Mesh){for(var aB in aA.geometry.geometryGroups){var z=aA.geometry.geometryGroups[aB];u.deleteBuffer(z.__webglVertexBuffer);u.deleteBuffer(z.__webglNormalBuffer);u.deleteBuffer(z.__webglTangentBuffer);u.deleteBuffer(z.__webglColorBuffer);u.deleteBuffer(z.__webglUVBuffer);u.deleteBuffer(z.__webglUV2Buffer);u.deleteBuffer(z.__webglSkinVertexABuffer);u.deleteBuffer(z.__webglSkinVertexBBuffer);u.deleteBuffer(z.__webglSkinIndicesBuffer);u.deleteBuffer(z.__webglSkinWeightsBuffer);u.deleteBuffer(z.__webglFaceBuffer);u.deleteBuffer(z.__webglLineBuffer);if(z.numMorphTargets){for(var C=0,D=z.numMorphTargets;C<D;C++){u.deleteBuffer(z.__webglMorphTargetsBuffers[C])}}if(z.__webglCustomAttributesList){for(C in C=void 0,z.__webglCustomAttributesList){u.deleteBuffer(z.__webglCustomAttributesList[C].buffer)}}ah.info.memory.geometries--}}else{if(aA instanceof c.Ribbon){aA=aA.geometry,u.deleteBuffer(aA.__webglVertexBuffer),u.deleteBuffer(aA.__webglColorBuffer),ah.info.memory.geometries--}else{if(aA instanceof c.Line){aA=aA.geometry,u.deleteBuffer(aA.__webglVertexBuffer),u.deleteBuffer(aA.__webglColorBuffer),ah.info.memory.geometries--}else{if(aA instanceof c.ParticleSystem){aA=aA.geometry,u.deleteBuffer(aA.__webglVertexBuffer),u.deleteBuffer(aA.__webglColorBuffer),ah.info.memory.geometries--}}}}}};this.deallocateTexture=function(z){if(z.__webglInit){z.__webglInit=!1,u.deleteTexture(z.__webglTexture),ah.info.memory.textures--}};this.updateShadowMap=function(z,C){G(z,C)};this.render=function(aF,aG,aH,aJ){var C,z,aK,aA,aB=aF.lights,aC=aF.fog;n=-1;this.autoUpdateObjects&&this.initWebGLObjects(aF);aG.parent===void 0&&(console.warn("DEPRECATED: Camera hasn't been added to a Scene. Adding it..."),aF.add(aG));this.autoUpdateScene&&aF.updateMatrixWorld();this.shadowMapEnabled&&this.shadowMapAutoUpdate&&G(aF,aG);ah.info.render.calls=0;ah.info.render.vertices=0;ah.info.render.faces=0;aG.matrixWorldInverse.getInverse(aG.matrixWorld);aG.matrixWorldInverse.flattenToArray(f);aG.projectionMatrix.flattenToArray(B);X.multiply(aG.projectionMatrix,aG.matrixWorldInverse);x(X);af(aH);(this.autoClear||aJ)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);aA=aF.__webglObjects;aJ=0;for(C=aA.length;aJ<C;aJ++){if(z=aA[aJ],aK=z.object,z.render=!1,aK.visible&&(!(aK instanceof c.Mesh)||!aK.frustumCulled||v(aK))){aK.matrixWorld.flattenToArray(aK._objectMatrixArray);aw(aK,aG,!0);var aI=z,aD=aI.object,D=aI.buffer,aE=void 0,aE=aE=void 0,aE=aD.material;if(aE instanceof c.MeshFaceMaterial){if(aE=D.materialIndex,aE>=0){aE=aD.geometry.materials[aE],aE.transparent?(aI.transparent=aE,aI.opaque=null):(aI.opaque=aE,aI.transparent=null)}}else{if(aE){aE.transparent?(aI.transparent=aE,aI.opaque=null):(aI.opaque=aE,aI.transparent=null)}}z.render=!0;if(this.sortObjects){aK.renderDepth?z.z=aK.renderDepth:(l.copy(aK.position),X.multiplyVector3(l),z.z=l.z)}}}this.sortObjects&&aA.sort(F);aA=aF.__webglObjectsImmediate;aJ=0;for(C=aA.length;aJ<C;aJ++){if(z=aA[aJ],aK=z.object,aK.visible){aK.matrixAutoUpdate&&aK.matrixWorld.flattenToArray(aK._objectMatrixArray),aw(aK,aG,!0),aK=z.object.material,aK.transparent?(z.transparent=aK,z.opaque=null):(z.opaque=aK,z.transparent=null)}}aF.overrideMaterial?(M(aF.overrideMaterial.blending),av(aF.overrideMaterial.depthTest),O(aF.overrideMaterial.depthWrite),P(aF.overrideMaterial.polygonOffset,aF.overrideMaterial.polygonOffsetFactor,aF.overrideMaterial.polygonOffsetUnits),A(aF.__webglObjects,!1,"",aG,aB,aC,!0,aF.overrideMaterial),I(aF.__webglObjectsImmediate,"",aG,aB,aC,!1,aF.overrideMaterial)):(M(c.NormalBlending),A(aF.__webglObjects,!0,"opaque",aG,aB,aC,!1),I(aF.__webglObjectsImmediate,"opaque",aG,aB,aC,!1),A(aF.__webglObjects,!1,"transparent",aG,aB,aC,!0),I(aF.__webglObjectsImmediate,"transparent",aG,aB,aC,!0));if(aF.__webglSprites.length){aK=ae.attributes;aB=ae.uniforms;aC=y/ab;aJ=[];C=ab*0.5;aA=y*0.5;z=!0;u.useProgram(ae.program);ag=ae.program;k=ap=ax=-1;T||(u.enableVertexAttribArray(ae.attributes.position),u.enableVertexAttribArray(ae.attributes.uv),T=!0);u.disable(u.CULL_FACE);u.enable(u.BLEND);u.depthMask(!0);u.bindBuffer(u.ARRAY_BUFFER,ae.vertexBuffer);u.vertexAttribPointer(aK.position,2,u.FLOAT,!1,16,0);u.vertexAttribPointer(aK.uv,2,u.FLOAT,!1,16,8);u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,ae.elementBuffer);u.uniformMatrix4fv(aB.projectionMatrix,!1,B);u.activeTexture(u.TEXTURE0);u.uniform1i(aB.map,0);aK=0;for(aI=aF.__webglSprites.length;aK<aI;aK++){if(aD=aF.__webglSprites[aK],aD.visible&&aD.opacity!==0){aD.useScreenCoordinates?aD.z=-aD.position.z:(aD._modelViewMatrix.multiplyToArray(aG.matrixWorldInverse,aD.matrixWorld,aD._modelViewMatrixArray),aD.z=-aD._modelViewMatrix.n34)}}aF.__webglSprites.sort(F);aK=0;for(aI=aF.__webglSprites.length;aK<aI;aK++){aD=aF.__webglSprites[aK],aD.visible&&aD.opacity!==0&&aD.map&&aD.map.image&&aD.map.image.width&&(aD.useScreenCoordinates?(u.uniform1i(aB.useScreenCoordinates,1),u.uniform3f(aB.screenPosition,(aD.position.x-C)/C,(aA-aD.position.y)/aA,Math.max(0,Math.min(1,aD.position.z)))):(u.uniform1i(aB.useScreenCoordinates,0),u.uniform1i(aB.affectedByDistance,aD.affectedByDistance?1:0),u.uniformMatrix4fv(aB.modelViewMatrix,!1,aD._modelViewMatrixArray)),aG=aD.map.image.width/(aD.scaleByViewport?y:1),aJ[0]=aG*aC*aD.scale.x,aJ[1]=aG*aD.scale.y,u.uniform2f(aB.uvScale,aD.uvScale.x,aD.uvScale.y),u.uniform2f(aB.uvOffset,aD.uvOffset.x,aD.uvOffset.y),u.uniform2f(aB.alignment,aD.alignment.x,aD.alignment.y),u.uniform1f(aB.opacity,aD.opacity),u.uniform3f(aB.color,aD.color.r,aD.color.g,aD.color.b),u.uniform1f(aB.rotation,aD.rotation),u.uniform2fv(aB.scale,aJ),aD.mergeWith3D&&!z?(u.enable(u.DEPTH_TEST),z=!0):!aD.mergeWith3D&&z&&(u.disable(u.DEPTH_TEST),z=!1),M(aD.blending),ay(aD.map,0),u.drawElements(u.TRIANGLES,6,u.UNSIGNED_SHORT,0))}u.enable(u.CULL_FACE);u.enable(u.DEPTH_TEST);u.depthMask(R)}aH&&aH.minFilter!==c.NearestFilter&&aH.minFilter!==c.LinearFilter&&(aH instanceof c.WebGLRenderTargetCube?(u.bindTexture(u.TEXTURE_CUBE_MAP,aH.__webglTexture),u.generateMipmap(u.TEXTURE_CUBE_MAP),u.bindTexture(u.TEXTURE_CUBE_MAP,null)):(u.bindTexture(u.TEXTURE_2D,aH.__webglTexture),u.generateMipmap(u.TEXTURE_2D),u.bindTexture(u.TEXTURE_2D,null)))};this.initWebGLObjects=function(bd){if(!bd.__webglObjects){bd.__webglObjects=[],bd.__webglObjectsImmediate=[],bd.__webglSprites=[]}for(;bd.__objectsAdded.length;){var be=bd.__objectsAdded[0],a2=bd,a5=void 0,a4=void 0,a3=void 0;if(!be.__webglInit){if(be.__webglInit=!0,be._modelViewMatrix=new c.Matrix4,be._normalMatrixArray=new Float32Array(9),be._modelViewMatrixArray=new Float32Array(16),be._objectMatrixArray=new Float32Array(16),be.matrixWorld.flattenToArray(be._objectMatrixArray),be instanceof c.Mesh){a4=be.geometry;if(a4.geometryGroups===void 0){var a3=a4,a6=void 0,a7=void 0,bj=void 0,a9=void 0,ce=void 0,cn=void 0,ba=void 0,z={},bg=a3.morphTargets.length;a3.geometryGroups={};a6=0;for(a7=a3.faces.length;a6<a7;a6++){bj=a3.faces[a6],a9=bj.materialIndex,cn=a9!==void 0?a9:-1,z[cn]===void 0&&(z[cn]={hash:cn,counter:0}),ba=z[cn].hash+"_"+z[cn].counter,a3.geometryGroups[ba]===void 0&&(a3.geometryGroups[ba]={faces3:[],faces4:[],materialIndex:a9,vertices:0,numMorphTargets:bg}),ce=bj instanceof c.Face3?3:4,a3.geometryGroups[ba].vertices+ce>65535&&(z[cn].counter+=1,ba=z[cn].hash+"_"+z[cn].counter,a3.geometryGroups[ba]===void 0&&(a3.geometryGroups[ba]={faces3:[],faces4:[],materialIndex:a9,vertices:0,numMorphTargets:bg})),bj instanceof c.Face3?a3.geometryGroups[ba].faces3.push(a6):a3.geometryGroups[ba].faces4.push(a6),a3.geometryGroups[ba].vertices+=ce}a3.geometryGroupsList=[];a6=void 0;for(a6 in a3.geometryGroups){a3.geometryGroups[a6].id=al++,a3.geometryGroupsList.push(a3.geometryGroups[a6])}}for(a5 in a4.geometryGroups){if(a3=a4.geometryGroups[a5],!a3.__webglVertexBuffer){a6=a3;a6.__webglVertexBuffer=u.createBuffer();a6.__webglNormalBuffer=u.createBuffer();a6.__webglTangentBuffer=u.createBuffer();a6.__webglColorBuffer=u.createBuffer();a6.__webglUVBuffer=u.createBuffer();a6.__webglUV2Buffer=u.createBuffer();a6.__webglSkinVertexABuffer=u.createBuffer();a6.__webglSkinVertexBBuffer=u.createBuffer();a6.__webglSkinIndicesBuffer=u.createBuffer();a6.__webglSkinWeightsBuffer=u.createBuffer();a6.__webglFaceBuffer=u.createBuffer();a6.__webglLineBuffer=u.createBuffer();if(a6.numMorphTargets){bj=a7=void 0;a6.__webglMorphTargetsBuffers=[];a7=0;for(bj=a6.numMorphTargets;a7<bj;a7++){a6.__webglMorphTargetsBuffers.push(u.createBuffer())}}ah.info.memory.geometries++;a9=be;ce=a9.geometry;a7=a3.faces3;cn=a3.faces4;a6=a7.length*3+cn.length*4;bj=a7.length*1+cn.length*2;cn=a7.length*3+cn.length*4;a7=an(a9,a3);ba=at(a7);z=aq(a7);bg=au(a7);a3.__vertexArray=new Float32Array(a6*3);if(z){a3.__normalArray=new Float32Array(a6*3)}if(ce.hasTangents){a3.__tangentArray=new Float32Array(a6*4)}if(bg){a3.__colorArray=new Float32Array(a6*3)}if(ba){if(ce.faceUvs.length>0||ce.faceVertexUvs.length>0){a3.__uvArray=new Float32Array(a6*2)}if(ce.faceUvs.length>1||ce.faceVertexUvs.length>1){a3.__uv2Array=new Float32Array(a6*2)}}if(a9.geometry.skinWeights.length&&a9.geometry.skinIndices.length){a3.__skinVertexAArray=new Float32Array(a6*4),a3.__skinVertexBArray=new Float32Array(a6*4),a3.__skinIndexArray=new Float32Array(a6*4),a3.__skinWeightArray=new Float32Array(a6*4)}a3.__faceArray=new Uint16Array(bj*3);a3.__lineArray=new Uint16Array(cn*2);if(a3.numMorphTargets){a3.__morphTargetsArrays=[];a9=0;for(ce=a3.numMorphTargets;a9<ce;a9++){a3.__morphTargetsArrays.push(new Float32Array(a6*3))}}a3.__webglFaceCount=bj*3;a3.__webglLineCount=cn*2;if(a7.attributes){if(a3.__webglCustomAttributesList===void 0){a3.__webglCustomAttributesList=[]}bj=void 0;for(bj in a7.attributes){var a9=a7.attributes[bj],ce={},cp;for(cp in a9){ce[cp]=a9[cp]}if(!ce.__webglInitialized||ce.createUniqueBuffers){ce.__webglInitialized=!0,cn=1,ce.type==="v2"?cn=2:ce.type==="v3"?cn=3:ce.type==="v4"?cn=4:ce.type==="c"&&(cn=3),ce.size=cn,ce.array=new Float32Array(a6*cn),ce.buffer=u.createBuffer(),ce.buffer.belongsToAttribute=bj,a9.needsUpdate=!0,ce.__original=a9}a3.__webglCustomAttributesList.push(ce)}}a3.__inittedArrays=!0;a4.__dirtyVertices=!0;a4.__dirtyMorphTargets=!0;a4.__dirtyElements=!0;a4.__dirtyUvs=!0;a4.__dirtyNormals=!0;a4.__dirtyTangents=!0;a4.__dirtyColors=!0}}}else{if(be instanceof c.Ribbon){if(a4=be.geometry,!a4.__webglVertexBuffer){a3=a4,a3.__webglVertexBuffer=u.createBuffer(),a3.__webglColorBuffer=u.createBuffer(),ah.info.memory.geometries++,a3=a4,a6=a3.vertices.length,a3.__vertexArray=new Float32Array(a6*3),a3.__colorArray=new Float32Array(a6*3),a3.__webglVertexCount=a6,a4.__dirtyVertices=!0,a4.__dirtyColors=!0}}else{if(be instanceof c.Line){if(a4=be.geometry,!a4.__webglVertexBuffer){a3=a4,a3.__webglVertexBuffer=u.createBuffer(),a3.__webglColorBuffer=u.createBuffer(),ah.info.memory.geometries++,a3=a4,a6=be,a7=a3.vertices.length,a3.__vertexArray=new Float32Array(a7*3),a3.__colorArray=new Float32Array(a7*3),a3.__webglLineCount=a7,ao(a3,a6),a4.__dirtyVertices=!0,a4.__dirtyColors=!0}}else{if(be instanceof c.ParticleSystem&&(a4=be.geometry,!a4.__webglVertexBuffer)){a3=a4,a3.__webglVertexBuffer=u.createBuffer(),a3.__webglColorBuffer=u.createBuffer(),ah.info.geometries++,a3=a4,a6=be,a7=a3.vertices.length,a3.__vertexArray=new Float32Array(a7*3),a3.__colorArray=new Float32Array(a7*3),a3.__sortArray=[],a3.__webglParticleCount=a7,ao(a3,a6),a4.__dirtyVertices=!0,a4.__dirtyColors=!0}}}}}if(!be.__webglActive){if(be instanceof c.Mesh){for(a5 in a4=be.geometry,a4.geometryGroups){a3=a4.geometryGroups[a5],E(a2.__webglObjects,a3,be)}}else{be instanceof c.Ribbon||be instanceof c.Line||be instanceof c.ParticleSystem?(a4=be.geometry,E(a2.__webglObjects,a4,be)):c.MarchingCubes!==void 0&&be instanceof c.MarchingCubes||be.immediateRenderCallback?a2.__webglObjectsImmediate.push({object:be,opaque:null,transparent:null}):be instanceof c.Sprite&&a2.__webglSprites.push(be)}be.__webglActive=!0}bd.__objectsAdded.splice(0,1)}for(;bd.__objectsRemoved.length;){be=bd.__objectsRemoved[0];a2=bd;if(be instanceof c.Mesh||be instanceof c.ParticleSystem||be instanceof c.Ribbon||be instanceof c.Line){N(a2.__webglObjects,be)}else{if(be instanceof c.Sprite){a2=a2.__webglSprites;a5=be;for(a4=a2.length-1;a4>=0;a4--){a2[a4]===a5&&a2.splice(a4,1)}}else{(be instanceof c.MarchingCubes||be.immediateRenderCallback)&&N(a2.__webglObjectsImmediate,be)}}be.__webglActive=!1;bd.__objectsRemoved.splice(0,1)}be=0;for(a2=bd.__webglObjects.length;be<a2;be++){if(cp=bd.__webglObjects[be].object,a5=cp.geometry,a4=bj=a7=void 0,cp instanceof c.Mesh){a3=0;for(a6=a5.geometryGroupsList.length;a3<a6;a3++){if(a7=a5.geometryGroupsList[a3],a4=an(cp,a7),bj=a4.attributes&&H(a4),a5.__dirtyVertices||a5.__dirtyMorphTargets||a5.__dirtyElements||a5.__dirtyUvs||a5.__dirtyNormals||a5.__dirtyColors||a5.__dirtyTangents||bj){var aY=cp,bj=u.DYNAMIC_DRAW,a9=!a5.dynamic,ba=a4;if(a7.__inittedArrays){var ce=aq(ba),cn=au(ba),aR=at(ba),ch=ce===c.SmoothShading,bl=z=ba=void 0,aT=void 0,a0=void 0,bf=void 0,D=void 0,aQ=void 0,co=void 0,aZ=bl=void 0,aD=void 0,aB=void 0,bm=void 0,a1=aT=void 0,ca=void 0,ci=void 0,aG=aT=co=void 0,bh=void 0,ck=bm=aB=aD=D=void 0,bi=aT=bm=aB=aD=ck=bm=aB=aD=ck=bm=aB=aD=void 0,bY=void 0,aC=bf=void 0,C=void 0,bZ=void 0,aN=void 0,aP=void 0,bc=aZ=bZ=bY=0,aO=0,aL=bi=bl=0,cl=D=a1=0,aS=0,aF=void 0,cl=a7.__vertexArray,C=a7.__uvArray,aS=a7.__uv2Array,aC=a7.__normalArray,a0=a7.__tangentArray,ca=a7.__colorArray,aG=a7.__skinVertexAArray,bh=a7.__skinVertexBArray,aQ=a7.__skinIndexArray,aH=a7.__skinWeightArray,ck=a7.__morphTargetsArrays,bg=a7.__webglCustomAttributesList,aE=void 0,aE=a7.__faceArray,aF=a7.__lineArray,ci=aY.geometry,a8=ci.__dirtyElements,cj=ci.__dirtyUvs,bf=ci.__dirtyNormals,co=ci.__dirtyTangents,bb=ci.__dirtyColors,aN=ci.__dirtyMorphTargets,aP=ci.vertices,aY=a7.faces3,aM=a7.faces4,cm=ci.faces,bk=ci.faceVertexUvs[0],aK=ci.faceVertexUvs[1],aJ=ci.skinVerticesA,cf=ci.skinVerticesB,aA=ci.skinIndices,cg=ci.skinWeights,aI=ci.morphTargets;if(ci.__dirtyVertices){ba=0;for(z=aY.length;ba<z;ba++){aT=cm[aY[ba]],aD=aP[aT.a].position,aB=aP[aT.b].position,bm=aP[aT.c].position,cl[bZ]=aD.x,cl[bZ+1]=aD.y,cl[bZ+2]=aD.z,cl[bZ+3]=aB.x,cl[bZ+4]=aB.y,cl[bZ+5]=aB.z,cl[bZ+6]=bm.x,cl[bZ+7]=bm.y,cl[bZ+8]=bm.z,bZ+=9}ba=0;for(z=aM.length;ba<z;ba++){aT=cm[aM[ba]],aD=aP[aT.a].position,aB=aP[aT.b].position,bm=aP[aT.c].position,aT=aP[aT.d].position,cl[bZ]=aD.x,cl[bZ+1]=aD.y,cl[bZ+2]=aD.z,cl[bZ+3]=aB.x,cl[bZ+4]=aB.y,cl[bZ+5]=aB.z,cl[bZ+6]=bm.x,cl[bZ+7]=bm.y,cl[bZ+8]=bm.z,cl[bZ+9]=aT.x,cl[bZ+10]=aT.y,cl[bZ+11]=aT.z,bZ+=12}u.bindBuffer(u.ARRAY_BUFFER,a7.__webglVertexBuffer);u.bufferData(u.ARRAY_BUFFER,cl,bj)}if(aN){bZ=0;for(aN=aI.length;bZ<aN;bZ++){ba=cl=0;for(z=aY.length;ba<z;ba++){aT=cm[aY[ba]],aD=aI[bZ].vertices[aT.a].position,aB=aI[bZ].vertices[aT.b].position,bm=aI[bZ].vertices[aT.c].position,aP=ck[bZ],aP[cl]=aD.x,aP[cl+1]=aD.y,aP[cl+2]=aD.z,aP[cl+3]=aB.x,aP[cl+4]=aB.y,aP[cl+5]=aB.z,aP[cl+6]=bm.x,aP[cl+7]=bm.y,aP[cl+8]=bm.z,cl+=9}ba=0;for(z=aM.length;ba<z;ba++){aT=cm[aM[ba]],aD=aI[bZ].vertices[aT.a].position,aB=aI[bZ].vertices[aT.b].position,bm=aI[bZ].vertices[aT.c].position,aT=aI[bZ].vertices[aT.d].position,aP=ck[bZ],aP[cl]=aD.x,aP[cl+1]=aD.y,aP[cl+2]=aD.z,aP[cl+3]=aB.x,aP[cl+4]=aB.y,aP[cl+5]=aB.z,aP[cl+6]=bm.x,aP[cl+7]=bm.y,aP[cl+8]=bm.z,aP[cl+9]=aT.x,aP[cl+10]=aT.y,aP[cl+11]=aT.z,cl+=12}u.bindBuffer(u.ARRAY_BUFFER,a7.__webglMorphTargetsBuffers[bZ]);u.bufferData(u.ARRAY_BUFFER,ck[bZ],bj)}}if(cg.length){ba=0;for(z=aY.length;ba<z;ba++){aT=cm[aY[ba]],aD=cg[aT.a],aB=cg[aT.b],bm=cg[aT.c],aH[D]=aD.x,aH[D+1]=aD.y,aH[D+2]=aD.z,aH[D+3]=aD.w,aH[D+4]=aB.x,aH[D+5]=aB.y,aH[D+6]=aB.z,aH[D+7]=aB.w,aH[D+8]=bm.x,aH[D+9]=bm.y,aH[D+10]=bm.z,aH[D+11]=bm.w,aD=aA[aT.a],aB=aA[aT.b],bm=aA[aT.c],aQ[D]=aD.x,aQ[D+1]=aD.y,aQ[D+2]=aD.z,aQ[D+3]=aD.w,aQ[D+4]=aB.x,aQ[D+5]=aB.y,aQ[D+6]=aB.z,aQ[D+7]=aB.w,aQ[D+8]=bm.x,aQ[D+9]=bm.y,aQ[D+10]=bm.z,aQ[D+11]=bm.w,aD=aJ[aT.a],aB=aJ[aT.b],bm=aJ[aT.c],aG[D]=aD.x,aG[D+1]=aD.y,aG[D+2]=aD.z,aG[D+3]=1,aG[D+4]=aB.x,aG[D+5]=aB.y,aG[D+6]=aB.z,aG[D+7]=1,aG[D+8]=bm.x,aG[D+9]=bm.y,aG[D+10]=bm.z,aG[D+11]=1,aD=cf[aT.a],aB=cf[aT.b],bm=cf[aT.c],bh[D]=aD.x,bh[D+1]=aD.y,bh[D+2]=aD.z,bh[D+3]=1,bh[D+4]=aB.x,bh[D+5]=aB.y,bh[D+6]=aB.z,bh[D+7]=1,bh[D+8]=bm.x,bh[D+9]=bm.y,bh[D+10]=bm.z,bh[D+11]=1,D+=12}ba=0;for(z=aM.length;ba<z;ba++){aT=cm[aM[ba]],aD=cg[aT.a],aB=cg[aT.b],bm=cg[aT.c],ck=cg[aT.d],aH[D]=aD.x,aH[D+1]=aD.y,aH[D+2]=aD.z,aH[D+3]=aD.w,aH[D+4]=aB.x,aH[D+5]=aB.y,aH[D+6]=aB.z,aH[D+7]=aB.w,aH[D+8]=bm.x,aH[D+9]=bm.y,aH[D+10]=bm.z,aH[D+11]=bm.w,aH[D+12]=ck.x,aH[D+13]=ck.y,aH[D+14]=ck.z,aH[D+15]=ck.w,aD=aA[aT.a],aB=aA[aT.b],bm=aA[aT.c],ck=aA[aT.d],aQ[D]=aD.x,aQ[D+1]=aD.y,aQ[D+2]=aD.z,aQ[D+3]=aD.w,aQ[D+4]=aB.x,aQ[D+5]=aB.y,aQ[D+6]=aB.z,aQ[D+7]=aB.w,aQ[D+8]=bm.x,aQ[D+9]=bm.y,aQ[D+10]=bm.z,aQ[D+11]=bm.w,aQ[D+12]=ck.x,aQ[D+13]=ck.y,aQ[D+14]=ck.z,aQ[D+15]=ck.w,aD=aJ[aT.a],aB=aJ[aT.b],bm=aJ[aT.c],ck=aJ[aT.d],aG[D]=aD.x,aG[D+1]=aD.y,aG[D+2]=aD.z,aG[D+3]=1,aG[D+4]=aB.x,aG[D+5]=aB.y,aG[D+6]=aB.z,aG[D+7]=1,aG[D+8]=bm.x,aG[D+9]=bm.y,aG[D+10]=bm.z,aG[D+11]=1,aG[D+12]=ck.x,aG[D+13]=ck.y,aG[D+14]=ck.z,aG[D+15]=1,aD=cf[aT.a],aB=cf[aT.b],bm=cf[aT.c],aT=cf[aT.d],bh[D]=aD.x,bh[D+1]=aD.y,bh[D+2]=aD.z,bh[D+3]=1,bh[D+4]=aB.x,bh[D+5]=aB.y,bh[D+6]=aB.z,bh[D+7]=1,bh[D+8]=bm.x,bh[D+9]=bm.y,bh[D+10]=bm.z,bh[D+11]=1,bh[D+12]=aT.x,bh[D+13]=aT.y,bh[D+14]=aT.z,bh[D+15]=1,D+=16}D>0&&(u.bindBuffer(u.ARRAY_BUFFER,a7.__webglSkinVertexABuffer),u.bufferData(u.ARRAY_BUFFER,aG,bj),u.bindBuffer(u.ARRAY_BUFFER,a7.__webglSkinVertexBBuffer),u.bufferData(u.ARRAY_BUFFER,bh,bj),u.bindBuffer(u.ARRAY_BUFFER,a7.__webglSkinIndicesBuffer),u.bufferData(u.ARRAY_BUFFER,aQ,bj),u.bindBuffer(u.ARRAY_BUFFER,a7.__webglSkinWeightsBuffer),u.bufferData(u.ARRAY_BUFFER,aH,bj))}if(bb&&cn){ba=0;for(z=aY.length;ba<z;ba++){aT=cm[aY[ba]],D=aT.vertexColors,aQ=aT.color,D.length===3&&cn===c.VertexColors?(aT=D[0],aG=D[1],bh=D[2]):bh=aG=aT=aQ,ca[a1]=aT.r,ca[a1+1]=aT.g,ca[a1+2]=aT.b,ca[a1+3]=aG.r,ca[a1+4]=aG.g,ca[a1+5]=aG.b,ca[a1+6]=bh.r,ca[a1+7]=bh.g,ca[a1+8]=bh.b,a1+=9}ba=0;for(z=aM.length;ba<z;ba++){aT=cm[aM[ba]],D=aT.vertexColors,aQ=aT.color,D.length===4&&cn===c.VertexColors?(aT=D[0],aG=D[1],bh=D[2],D=D[3]):D=bh=aG=aT=aQ,ca[a1]=aT.r,ca[a1+1]=aT.g,ca[a1+2]=aT.b,ca[a1+3]=aG.r,ca[a1+4]=aG.g,ca[a1+5]=aG.b,ca[a1+6]=bh.r,ca[a1+7]=bh.g,ca[a1+8]=bh.b,ca[a1+9]=D.r,ca[a1+10]=D.g,ca[a1+11]=D.b,a1+=12}a1>0&&(u.bindBuffer(u.ARRAY_BUFFER,a7.__webglColorBuffer),u.bufferData(u.ARRAY_BUFFER,ca,bj))}if(co&&ci.hasTangents){ba=0;for(z=aY.length;ba<z;ba++){aT=cm[aY[ba]],co=aT.vertexTangents,a1=co[0],ca=co[1],ci=co[2],a0[bi]=a1.x,a0[bi+1]=a1.y,a0[bi+2]=a1.z,a0[bi+3]=a1.w,a0[bi+4]=ca.x,a0[bi+5]=ca.y,a0[bi+6]=ca.z,a0[bi+7]=ca.w,a0[bi+8]=ci.x,a0[bi+9]=ci.y,a0[bi+10]=ci.z,a0[bi+11]=ci.w,bi+=12}ba=0;for(z=aM.length;ba<z;ba++){aT=cm[aM[ba]],co=aT.vertexTangents,a1=co[0],ca=co[1],ci=co[2],co=co[3],a0[bi]=a1.x,a0[bi+1]=a1.y,a0[bi+2]=a1.z,a0[bi+3]=a1.w,a0[bi+4]=ca.x,a0[bi+5]=ca.y,a0[bi+6]=ca.z,a0[bi+7]=ca.w,a0[bi+8]=ci.x,a0[bi+9]=ci.y,a0[bi+10]=ci.z,a0[bi+11]=ci.w,a0[bi+12]=co.x,a0[bi+13]=co.y,a0[bi+14]=co.z,a0[bi+15]=co.w,bi+=16}u.bindBuffer(u.ARRAY_BUFFER,a7.__webglTangentBuffer);u.bufferData(u.ARRAY_BUFFER,a0,bj)}if(bf&&ce){ba=0;for(z=aY.length;ba<z;ba++){if(aT=cm[aY[ba]],a0=aT.vertexNormals,bf=aT.normal,a0.length===3&&ch){for(bi=0;bi<3;bi++){bf=a0[bi],aC[bl]=bf.x,aC[bl+1]=bf.y,aC[bl+2]=bf.z,bl+=3}}else{for(bi=0;bi<3;bi++){aC[bl]=bf.x,aC[bl+1]=bf.y,aC[bl+2]=bf.z,bl+=3}}}ba=0;for(z=aM.length;ba<z;ba++){if(aT=cm[aM[ba]],a0=aT.vertexNormals,bf=aT.normal,a0.length===4&&ch){for(bi=0;bi<4;bi++){bf=a0[bi],aC[bl]=bf.x,aC[bl+1]=bf.y,aC[bl+2]=bf.z,bl+=3}}else{for(bi=0;bi<4;bi++){aC[bl]=bf.x,aC[bl+1]=bf.y,aC[bl+2]=bf.z,bl+=3}}}u.bindBuffer(u.ARRAY_BUFFER,a7.__webglNormalBuffer);u.bufferData(u.ARRAY_BUFFER,aC,bj)}if(cj&&bk&&aR){ba=0;for(z=aY.length;ba<z;ba++){if(bl=aY[ba],bl=bk[bl],bl!==void 0){for(bi=0;bi<3;bi++){aC=bl[bi],C[aZ]=aC.u,C[aZ+1]=aC.v,aZ+=2}}}ba=0;for(z=aM.length;ba<z;ba++){if(bl=aM[ba],bl=bk[bl],bl!==void 0){for(bi=0;bi<4;bi++){aC=bl[bi],C[aZ]=aC.u,C[aZ+1]=aC.v,aZ+=2}}}aZ>0&&(u.bindBuffer(u.ARRAY_BUFFER,a7.__webglUVBuffer),u.bufferData(u.ARRAY_BUFFER,C,bj))}if(cj&&aK&&aR){ba=0;for(z=aY.length;ba<z;ba++){if(bl=aY[ba],aZ=aK[bl],aZ!==void 0){for(bi=0;bi<3;bi++){C=aZ[bi],aS[bc]=C.u,aS[bc+1]=C.v,bc+=2}}}ba=0;for(z=aM.length;ba<z;ba++){if(bl=aM[ba],aZ=aK[bl],aZ!==void 0){for(bi=0;bi<4;bi++){C=aZ[bi],aS[bc]=C.u,aS[bc+1]=C.v,bc+=2}}}bc>0&&(u.bindBuffer(u.ARRAY_BUFFER,a7.__webglUV2Buffer),u.bufferData(u.ARRAY_BUFFER,aS,bj))}if(a8){ba=0;for(z=aY.length;ba<z;ba++){aE[aO]=bY,aE[aO+1]=bY+1,aE[aO+2]=bY+2,aO+=3,aF[aL]=bY,aF[aL+1]=bY+1,aF[aL+2]=bY,aF[aL+3]=bY+2,aF[aL+4]=bY+1,aF[aL+5]=bY+2,aL+=6,bY+=3}ba=0;for(z=aM.length;ba<z;ba++){aE[aO]=bY,aE[aO+1]=bY+1,aE[aO+2]=bY+3,aE[aO+3]=bY+1,aE[aO+4]=bY+2,aE[aO+5]=bY+3,aO+=6,aF[aL]=bY,aF[aL+1]=bY+1,aF[aL+2]=bY,aF[aL+3]=bY+3,aF[aL+4]=bY+1,aF[aL+5]=bY+2,aF[aL+6]=bY+2,aF[aL+7]=bY+3,aL+=8,bY+=4}u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,a7.__webglFaceBuffer);u.bufferData(u.ELEMENT_ARRAY_BUFFER,aE,bj);u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,a7.__webglLineBuffer);u.bufferData(u.ELEMENT_ARRAY_BUFFER,aF,bj)}if(bg){bi=0;for(bY=bg.length;bi<bY;bi++){if(aE=bg[bi],aE.__original.needsUpdate){aS=0;if(aE.size===1){if(aE.boundTo===void 0||aE.boundTo==="vertices"){ba=0;for(z=aY.length;ba<z;ba++){aT=cm[aY[ba]],aE.array[aS]=aE.value[aT.a],aE.array[aS+1]=aE.value[aT.b],aE.array[aS+2]=aE.value[aT.c],aS+=3}ba=0;for(z=aM.length;ba<z;ba++){aT=cm[aM[ba]],aE.array[aS]=aE.value[aT.a],aE.array[aS+1]=aE.value[aT.b],aE.array[aS+2]=aE.value[aT.c],aE.array[aS+3]=aE.value[aT.d],aS+=4}}else{if(aE.boundTo==="faces"){ba=0;for(z=aY.length;ba<z;ba++){aF=aE.value[aY[ba]],aE.array[aS]=aF,aE.array[aS+1]=aF,aE.array[aS+2]=aF,aS+=3}ba=0;for(z=aM.length;ba<z;ba++){aF=aE.value[aM[ba]],aE.array[aS]=aF,aE.array[aS+1]=aF,aE.array[aS+2]=aF,aE.array[aS+3]=aF,aS+=4}}}}else{if(aE.size===2){if(aE.boundTo===void 0||aE.boundTo==="vertices"){ba=0;for(z=aY.length;ba<z;ba++){aT=cm[aY[ba]],aD=aE.value[aT.a],aB=aE.value[aT.b],bm=aE.value[aT.c],aE.array[aS]=aD.x,aE.array[aS+1]=aD.y,aE.array[aS+2]=aB.x,aE.array[aS+3]=aB.y,aE.array[aS+4]=bm.x,aE.array[aS+5]=bm.y,aS+=6}ba=0;for(z=aM.length;ba<z;ba++){aT=cm[aM[ba]],aD=aE.value[aT.a],aB=aE.value[aT.b],bm=aE.value[aT.c],aT=aE.value[aT.d],aE.array[aS]=aD.x,aE.array[aS+1]=aD.y,aE.array[aS+2]=aB.x,aE.array[aS+3]=aB.y,aE.array[aS+4]=bm.x,aE.array[aS+5]=bm.y,aE.array[aS+6]=aT.x,aE.array[aS+7]=aT.y,aS+=8}}else{if(aE.boundTo==="faces"){ba=0;for(z=aY.length;ba<z;ba++){bm=aB=aD=aF=aE.value[aY[ba]],aE.array[aS]=aD.x,aE.array[aS+1]=aD.y,aE.array[aS+2]=aB.x,aE.array[aS+3]=aB.y,aE.array[aS+4]=bm.x,aE.array[aS+5]=bm.y,aS+=6}ba=0;for(z=aM.length;ba<z;ba++){aT=bm=aB=aD=aF=aE.value[aM[ba]],aE.array[aS]=aD.x,aE.array[aS+1]=aD.y,aE.array[aS+2]=aB.x,aE.array[aS+3]=aB.y,aE.array[aS+4]=bm.x,aE.array[aS+5]=bm.y,aE.array[aS+6]=aT.x,aE.array[aS+7]=aT.y,aS+=8}}}}else{if(aE.size===3){if(ce=aE.type==="c"?["r","g","b"]:["x","y","z"],aE.boundTo===void 0||aE.boundTo==="vertices"){ba=0;for(z=aY.length;ba<z;ba++){aT=cm[aY[ba]],aD=aE.value[aT.a],aB=aE.value[aT.b],bm=aE.value[aT.c],aE.array[aS]=aD[ce[0]],aE.array[aS+1]=aD[ce[1]],aE.array[aS+2]=aD[ce[2]],aE.array[aS+3]=aB[ce[0]],aE.array[aS+4]=aB[ce[1]],aE.array[aS+5]=aB[ce[2]],aE.array[aS+6]=bm[ce[0]],aE.array[aS+7]=bm[ce[1]],aE.array[aS+8]=bm[ce[2]],aS+=9}ba=0;for(z=aM.length;ba<z;ba++){aT=cm[aM[ba]],aD=aE.value[aT.a],aB=aE.value[aT.b],bm=aE.value[aT.c],aT=aE.value[aT.d],aE.array[aS]=aD[ce[0]],aE.array[aS+1]=aD[ce[1]],aE.array[aS+2]=aD[ce[2]],aE.array[aS+3]=aB[ce[0]],aE.array[aS+4]=aB[ce[1]],aE.array[aS+5]=aB[ce[2]],aE.array[aS+6]=bm[ce[0]],aE.array[aS+7]=bm[ce[1]],aE.array[aS+8]=bm[ce[2]],aE.array[aS+9]=aT[ce[0]],aE.array[aS+10]=aT[ce[1]],aE.array[aS+11]=aT[ce[2]],aS+=12}}else{if(aE.boundTo==="faces"){ba=0;for(z=aY.length;ba<z;ba++){bm=aB=aD=aF=aE.value[aY[ba]],aE.array[aS]=aD[ce[0]],aE.array[aS+1]=aD[ce[1]],aE.array[aS+2]=aD[ce[2]],aE.array[aS+3]=aB[ce[0]],aE.array[aS+4]=aB[ce[1]],aE.array[aS+5]=aB[ce[2]],aE.array[aS+6]=bm[ce[0]],aE.array[aS+7]=bm[ce[1]],aE.array[aS+8]=bm[ce[2]],aS+=9}ba=0;for(z=aM.length;ba<z;ba++){aT=bm=aB=aD=aF=aE.value[aM[ba]],aE.array[aS]=aD[ce[0]],aE.array[aS+1]=aD[ce[1]],aE.array[aS+2]=aD[ce[2]],aE.array[aS+3]=aB[ce[0]],aE.array[aS+4]=aB[ce[1]],aE.array[aS+5]=aB[ce[2]],aE.array[aS+6]=bm[ce[0]],aE.array[aS+7]=bm[ce[1]],aE.array[aS+8]=bm[ce[2]],aE.array[aS+9]=aT[ce[0]],aE.array[aS+10]=aT[ce[1]],aE.array[aS+11]=aT[ce[2]],aS+=12}}}}else{if(aE.size===4){if(aE.boundTo===void 0||aE.boundTo==="vertices"){ba=0;for(z=aY.length;ba<z;ba++){aT=cm[aY[ba]],aD=aE.value[aT.a],aB=aE.value[aT.b],bm=aE.value[aT.c],aE.array[aS]=aD.x,aE.array[aS+1]=aD.y,aE.array[aS+2]=aD.z,aE.array[aS+3]=aD.w,aE.array[aS+4]=aB.x,aE.array[aS+5]=aB.y,aE.array[aS+6]=aB.z,aE.array[aS+7]=aB.w,aE.array[aS+8]=bm.x,aE.array[aS+9]=bm.y,aE.array[aS+10]=bm.z,aE.array[aS+11]=bm.w,aS+=12}ba=0;for(z=aM.length;ba<z;ba++){aT=cm[aM[ba]],aD=aE.value[aT.a],aB=aE.value[aT.b],bm=aE.value[aT.c],aT=aE.value[aT.d],aE.array[aS]=aD.x,aE.array[aS+1]=aD.y,aE.array[aS+2]=aD.z,aE.array[aS+3]=aD.w,aE.array[aS+4]=aB.x,aE.array[aS+5]=aB.y,aE.array[aS+6]=aB.z,aE.array[aS+7]=aB.w,aE.array[aS+8]=bm.x,aE.array[aS+9]=bm.y,aE.array[aS+10]=bm.z,aE.array[aS+11]=bm.w,aE.array[aS+12]=aT.x,aE.array[aS+13]=aT.y,aE.array[aS+14]=aT.z,aE.array[aS+15]=aT.w,aS+=16}}else{if(aE.boundTo==="faces"){ba=0;for(z=aY.length;ba<z;ba++){bm=aB=aD=aF=aE.value[aY[ba]],aE.array[aS]=aD.x,aE.array[aS+1]=aD.y,aE.array[aS+2]=aD.z,aE.array[aS+3]=aD.w,aE.array[aS+4]=aB.x,aE.array[aS+5]=aB.y,aE.array[aS+6]=aB.z,aE.array[aS+7]=aB.w,aE.array[aS+8]=bm.x,aE.array[aS+9]=bm.y,aE.array[aS+10]=bm.z,aE.array[aS+11]=bm.w,aS+=12}ba=0;for(z=aM.length;ba<z;ba++){aT=bm=aB=aD=aF=aE.value[aM[ba]],aE.array[aS]=aD.x,aE.array[aS+1]=aD.y,aE.array[aS+2]=aD.z,aE.array[aS+3]=aD.w,aE.array[aS+4]=aB.x,aE.array[aS+5]=aB.y,aE.array[aS+6]=aB.z,aE.array[aS+7]=aB.w,aE.array[aS+8]=bm.x,aE.array[aS+9]=bm.y,aE.array[aS+10]=bm.z,aE.array[aS+11]=bm.w,aE.array[aS+12]=aT.x,aE.array[aS+13]=aT.y,aE.array[aS+14]=aT.z,aE.array[aS+15]=aT.w,aS+=16}}}}}}}u.bindBuffer(u.ARRAY_BUFFER,aE.buffer);u.bufferData(u.ARRAY_BUFFER,aE.array,bj)}}}a9&&(delete a7.__inittedArrays,delete a7.__colorArray,delete a7.__normalArray,delete a7.__tangentArray,delete a7.__uvArray,delete a7.__uv2Array,delete a7.__faceArray,delete a7.__vertexArray,delete a7.__lineArray,delete a7.__skinVertexAArray,delete a7.__skinVertexBArray,delete a7.__skinIndexArray,delete a7.__skinWeightArray)}}}a5.__dirtyVertices=!1;a5.__dirtyMorphTargets=!1;a5.__dirtyElements=!1;a5.__dirtyUvs=!1;a5.__dirtyNormals=!1;a5.__dirtyColors=!1;a5.__dirtyTangents=!1;a4.attributes&&K(a4)}else{if(cp instanceof c.Ribbon){if(a5.__dirtyVertices||a5.__dirtyColors){a4=a5;cp=u.DYNAMIC_DRAW;ce=a3=ce=a9=a9=void 0;cn=a4.vertices;a6=a4.colors;ba=cn.length;a7=a6.length;z=a4.__vertexArray;bj=a4.__colorArray;bg=a4.__dirtyColors;if(a4.__dirtyVertices){for(a9=0;a9<ba;a9++){ce=cn[a9].position,a3=a9*3,z[a3]=ce.x,z[a3+1]=ce.y,z[a3+2]=ce.z}u.bindBuffer(u.ARRAY_BUFFER,a4.__webglVertexBuffer);u.bufferData(u.ARRAY_BUFFER,z,cp)}if(bg){for(a9=0;a9<a7;a9++){ce=a6[a9],a3=a9*3,bj[a3]=ce.r,bj[a3+1]=ce.g,bj[a3+2]=ce.b}u.bindBuffer(u.ARRAY_BUFFER,a4.__webglColorBuffer);u.bufferData(u.ARRAY_BUFFER,bj,cp)}}a5.__dirtyVertices=!1;a5.__dirtyColors=!1}else{if(cp instanceof c.Line){a4=an(cp,a7);bj=a4.attributes&&H(a4);if(a5.__dirtyVertices||a5.__dirtyColors||bj){cp=a5;a3=u.DYNAMIC_DRAW;ba=a6=ch=cn=aR=void 0;cn=cp.vertices;a7=cp.colors;ba=cn.length;bj=a7.length;z=cp.__vertexArray;a9=cp.__colorArray;bg=cp.__dirtyColors;ce=cp.__webglCustomAttributesList;bY=cm=aM=aY=ch=aR=void 0;if(cp.__dirtyVertices){for(aR=0;aR<ba;aR++){ch=cn[aR].position,a6=aR*3,z[a6]=ch.x,z[a6+1]=ch.y,z[a6+2]=ch.z}u.bindBuffer(u.ARRAY_BUFFER,cp.__webglVertexBuffer);u.bufferData(u.ARRAY_BUFFER,z,a3)}if(bg){for(cn=0;cn<bj;cn++){ba=a7[cn],a6=cn*3,a9[a6]=ba.r,a9[a6+1]=ba.g,a9[a6+2]=ba.b}u.bindBuffer(u.ARRAY_BUFFER,cp.__webglColorBuffer);u.bufferData(u.ARRAY_BUFFER,a9,a3)}if(ce){aR=0;for(ch=ce.length;aR<ch;aR++){if(bY=ce[aR],bY.needsUpdate&&(bY.boundTo===void 0||bY.boundTo==="vertices")){a6=0;aM=bY.value.length;if(bY.size===1){for(aY=0;aY<aM;aY++){bY.array[aY]=bY.value[aY]}}else{if(bY.size===2){for(aY=0;aY<aM;aY++){cm=bY.value[aY],bY.array[a6]=cm.x,bY.array[a6+1]=cm.y,a6+=2}}else{if(bY.size===3){if(bY.type==="c"){for(aY=0;aY<aM;aY++){cm=bY.value[aY],bY.array[a6]=cm.r,bY.array[a6+1]=cm.g,bY.array[a6+2]=cm.b,a6+=3}}else{for(aY=0;aY<aM;aY++){cm=bY.value[aY],bY.array[a6]=cm.x,bY.array[a6+1]=cm.y,bY.array[a6+2]=cm.z,a6+=3}}}else{if(bY.size===4){for(aY=0;aY<aM;aY++){cm=bY.value[aY],bY.array[a6]=cm.x,bY.array[a6+1]=cm.y,bY.array[a6+2]=cm.z,bY.array[a6+3]=cm.w,a6+=4}}}}}u.bindBuffer(u.ARRAY_BUFFER,bY.buffer);u.bufferData(u.ARRAY_BUFFER,bY.array,a3)}}}}a5.__dirtyVertices=!1;a5.__dirtyColors=!1;a4.attributes&&K(a4)}else{if(cp instanceof c.ParticleSystem){a4=an(cp,a7),bj=a4.attributes&&H(a4),(a5.__dirtyVertices||a5.__dirtyColors||cp.sortParticles||bj)&&ar(a5,u.DYNAMIC_DRAW,cp),a5.__dirtyVertices=!1,a5.__dirtyColors=!1,a4.attributes&&K(a4)}}}}}};this.initMaterial=function(aG,aI,aK,D){var aD,aA,aC,aE;aG instanceof c.MeshDepthMaterial?aE="depth":aG instanceof c.MeshNormalMaterial?aE="normal":aG instanceof c.MeshBasicMaterial?aE="basic":aG instanceof c.MeshLambertMaterial?aE="lambert":aG instanceof c.MeshPhongMaterial?aE="phong":aG instanceof c.LineBasicMaterial?aE="basic":aG instanceof c.ParticleBasicMaterial&&(aE="particle_basic");if(aE){var aF=c.ShaderLib[aE];aG.uniforms=c.UniformsUtils.clone(aF.uniforms);aG.vertexShader=aF.vertexShader;aG.fragmentShader=aF.fragmentShader}var aH,aJ,aM;aH=aM=aF=0;for(aJ=aI.length;aH<aJ;aH++){aC=aI[aH],aC instanceof c.SpotLight&&aM++,aC instanceof c.DirectionalLight&&aM++,aC instanceof c.PointLight&&aF++}aF+aM<=Z?aH=aM:(aH=Math.ceil(Z*aM/(aF+aM)),aF=Z-aH);aC={directional:aH,point:aF};aF=aM=0;for(aH=aI.length;aF<aH;aF++){aJ=aI[aF],aJ instanceof c.SpotLight&&aJ.castShadow&&aM++}var z=50;if(D!==void 0&&D instanceof c.SkinnedMesh){z=D.bones.length}var C;aG:{aH=aG.fragmentShader;aJ=aG.vertexShader;var aF=aG.uniforms,aI=aG.attributes,aK={map:!!aG.map,envMap:!!aG.envMap,lightMap:!!aG.lightMap,vertexColors:aG.vertexColors,fog:aK,useFog:aG.fog,sizeAttenuation:aG.sizeAttenuation,skinning:aG.skinning,morphTargets:aG.morphTargets,maxMorphTargets:this.maxMorphTargets,maxDirLights:aC.directional,maxPointLights:aC.point,maxBones:z,shadowMapEnabled:this.shadowMapEnabled&&D.receiveShadow,shadowMapSoft:this.shadowMapSoft,shadowMapWidth:this.shadowMapWidth,shadowMapHeight:this.shadowMapHeight,maxShadows:aM,alphaTest:aG.alphaTest,metal:aG.metal,perPixel:aG.perPixel},aB,D=[];aE?D.push(aE):(D.push(aH),D.push(aJ));for(aB in aK){D.push(aB),D.push(aK[aB])}aE=D.join();aB=0;for(D=ai.length;aB<D;aB++){if(ai[aB].code===aE){C=ai[aB].program;break aG}}aB=u.createProgram();D=[j?"#define VERTEX_TEXTURES":"",ah.gammaInput?"#define GAMMA_INPUT":"",ah.gammaOutput?"#define GAMMA_OUTPUT":"",ah.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"","#define MAX_DIR_LIGHTS "+aK.maxDirLights,"#define MAX_POINT_LIGHTS "+aK.maxPointLights,"#define MAX_SHADOWS "+aK.maxShadows,"#define MAX_BONES "+aK.maxBones,aK.map?"#define USE_MAP":"",aK.envMap?"#define USE_ENVMAP":"",aK.lightMap?"#define USE_LIGHTMAP":"",aK.vertexColors?"#define USE_COLOR":"",aK.skinning?"#define USE_SKINNING":"",aK.morphTargets?"#define USE_MORPHTARGETS":"",aK.perPixel?"#define PHONG_PER_PIXEL":"",aK.shadowMapEnabled?"#define USE_SHADOWMAP":"",aK.shadowMapSoft?"#define SHADOWMAP_SOFT":"",aK.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 objectMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nuniform mat4 cameraInverseMatrix;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n#ifdef USE_COLOR\nattribute vec3 color;\n#endif\n#ifdef USE_MORPHTARGETS\nattribute vec3 morphTarget0;\nattribute vec3 morphTarget1;\nattribute vec3 morphTarget2;\nattribute vec3 morphTarget3;\nattribute vec3 morphTarget4;\nattribute vec3 morphTarget5;\nattribute vec3 morphTarget6;\nattribute vec3 morphTarget7;\n#endif\n#ifdef USE_SKINNING\nattribute vec4 skinVertexA;\nattribute vec4 skinVertexB;\nattribute vec4 skinIndex;\nattribute vec4 skinWeight;\n#endif\n"].join("\n");aC=["#ifdef GL_ES","precision "+o+" float;","#endif","#define MAX_DIR_LIGHTS "+aK.maxDirLights,"#define MAX_POINT_LIGHTS "+aK.maxPointLights,"#define MAX_SHADOWS "+aK.maxShadows,aK.alphaTest?"#define ALPHATEST "+aK.alphaTest:"",ah.gammaInput?"#define GAMMA_INPUT":"",ah.gammaOutput?"#define GAMMA_OUTPUT":"",ah.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"",aK.useFog&&aK.fog?"#define USE_FOG":"",aK.useFog&&aK.fog instanceof c.FogExp2?"#define FOG_EXP2":"",aK.map?"#define USE_MAP":"",aK.envMap?"#define USE_ENVMAP":"",aK.lightMap?"#define USE_LIGHTMAP":"",aK.vertexColors?"#define USE_COLOR":"",aK.metal?"#define METAL":"",aK.perPixel?"#define PHONG_PER_PIXEL":"",aK.shadowMapEnabled?"#define USE_SHADOWMAP":"",aK.shadowMapSoft?"#define SHADOWMAP_SOFT":"",aK.shadowMapSoft?"#define SHADOWMAP_WIDTH "+aK.shadowMapWidth.toFixed(1):"",aK.shadowMapSoft?"#define SHADOWMAP_HEIGHT "+aK.shadowMapHeight.toFixed(1):"","uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n");u.attachShader(aB,a("fragment",aC+aH));u.attachShader(aB,a("vertex",D+aJ));u.linkProgram(aB);u.getProgramParameter(aB,u.LINK_STATUS)||console.error("Could not initialise shader\nVALIDATE_STATUS: "+u.getProgramParameter(aB,u.VALIDATE_STATUS)+", gl error ["+u.getError()+"]");aB.uniforms={};aB.attributes={};var aL,D=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","objectMatrix","cameraPosition","cameraInverseMatrix","boneGlobalMatrices","morphTargetInfluences"];for(aL in aF){D.push(aL)}aL=D;D=0;for(aF=aL.length;D<aF;D++){aH=aL[D],aB.uniforms[aH]=u.getUniformLocation(aB,aH)}D=["position","normal","uv","uv2","tangent","color","skinVertexA","skinVertexB","skinIndex","skinWeight"];for(aL=0;aL<aK.maxMorphTargets;aL++){D.push("morphTarget"+aL)}for(C in aI){D.push(C)}C=D;aL=0;for(aI=C.length;aL<aI;aL++){aK=C[aL],aB.attributes[aK]=u.getAttribLocation(aB,aK)}aB.id=ai.length;ai.push({program:aB,code:aE});ah.info.memory.programs=ai.length;C=aB}aG.program=C;C=aG.program.attributes;C.position>=0&&u.enableVertexAttribArray(C.position);C.color>=0&&u.enableVertexAttribArray(C.color);C.normal>=0&&u.enableVertexAttribArray(C.normal);C.tangent>=0&&u.enableVertexAttribArray(C.tangent);aG.skinning&&C.skinVertexA>=0&&C.skinVertexB>=0&&C.skinIndex>=0&&C.skinWeight>=0&&(u.enableVertexAttribArray(C.skinVertexA),u.enableVertexAttribArray(C.skinVertexB),u.enableVertexAttribArray(C.skinIndex),u.enableVertexAttribArray(C.skinWeight));if(aG.attributes){for(aA in aG.attributes){C[aA]!==void 0&&C[aA]>=0&&u.enableVertexAttribArray(C[aA])}}if(aG.morphTargets){for(aA=aG.numSupportedMorphTargets=0;aA<this.maxMorphTargets;aA++){aL="morphTarget"+aA,C[aL]>=0&&(u.enableVertexAttribArray(C[aL]),aG.numSupportedMorphTargets++)}}aG.uniformsList=[];for(aD in aG.uniforms){aG.uniformsList.push([aG.uniforms[aD],aD])}};this.setFaceCulling=function(z,C){z?(!C||C==="ccw"?u.frontFace(u.CCW):u.frontFace(u.CW),z==="back"?u.cullFace(u.BACK):z==="front"?u.cullFace(u.FRONT):u.cullFace(u.FRONT_AND_BACK),u.enable(u.CULL_FACE)):u.disable(u.CULL_FACE)}};c.WebGLRenderTarget=function(b,a,g){this.width=b;this.height=a;g=g||{};this.wrapS=g.wrapS!==void 0?g.wrapS:c.ClampToEdgeWrapping;this.wrapT=g.wrapT!==void 0?g.wrapT:c.ClampToEdgeWrapping;this.magFilter=g.magFilter!==void 0?g.magFilter:c.LinearFilter;this.minFilter=g.minFilter!==void 0?g.minFilter:c.LinearMipMapLinearFilter;this.offset=new c.Vector2(0,0);this.repeat=new c.Vector2(1,1);this.format=g.format!==void 0?g.format:c.RGBAFormat;this.type=g.type!==void 0?g.type:c.UnsignedByteType;this.depthBuffer=g.depthBuffer!==void 0?g.depthBuffer:!0;this.stencilBuffer=g.stencilBuffer!==void 0?g.stencilBuffer:!0};c.WebGLRenderTarget.prototype.clone=function(){var a=new c.WebGLRenderTarget(this.width,this.height);a.wrapS=this.wrapS;a.wrapT=this.wrapT;a.magFilter=this.magFilter;a.minFilter=this.minFilter;a.offset.copy(this.offset);a.repeat.copy(this.repeat);a.format=this.format;a.type=this.type;a.depthBuffer=this.depthBuffer;a.stencilBuffer=this.stencilBuffer;return a};c.WebGLRenderTargetCube=function(b,a,g){c.WebGLRenderTarget.call(this,b,a,g);this.activeCubeFace=0};c.WebGLRenderTargetCube.prototype=new c.WebGLRenderTarget;c.WebGLRenderTargetCube.prototype.constructor=c.WebGLRenderTargetCube;c.RenderableVertex=function(){this.positionWorld=new c.Vector3;this.positionScreen=new c.Vector4;this.visible=!0};c.RenderableVertex.prototype.copy=function(a){this.positionWorld.copy(a.positionWorld);this.positionScreen.copy(a.positionScreen)};c.RenderableFace3=function(){this.v1=new c.RenderableVertex;this.v2=new c.RenderableVertex;this.v3=new c.RenderableVertex;this.centroidWorld=new c.Vector3;this.centroidScreen=new c.Vector3;this.normalWorld=new c.Vector3;this.vertexNormalsWorld=[new c.Vector3,new c.Vector3,new c.Vector3];this.faceMaterial=this.material=null;this.uvs=[[]];this.z=null};c.RenderableFace4=function(){this.v1=new c.RenderableVertex;this.v2=new c.RenderableVertex;this.v3=new c.RenderableVertex;this.v4=new c.RenderableVertex;this.centroidWorld=new c.Vector3;this.centroidScreen=new c.Vector3;this.normalWorld=new c.Vector3;this.vertexNormalsWorld=[new c.Vector3,new c.Vector3,new c.Vector3,new c.Vector3];this.faceMaterial=this.material=null;this.uvs=[[]];this.z=null};c.RenderableObject=function(){this.z=this.object=null};c.RenderableParticle=function(){this.rotation=this.z=this.y=this.x=null;this.scale=new c.Vector2;this.material=null};c.RenderableLine=function(){this.z=null;this.v1=new c.RenderableVertex;this.v2=new c.RenderableVertex;this.material=null};c.ColorUtils={adjustHSV:function(k,a,l,b){var g=c.ColorUtils.__hsv;c.ColorUtils.rgbToHsv(k,g);g.h=c.Math.clamp(g.h+a,0,1);g.s=c.Math.clamp(g.s+l,0,1);g.v=c.Math.clamp(g.v+b,0,1);k.setHSV(g.h,g.s,g.v)},rgbToHsv:function(f,h){var g=f.r,q=f.g,b=f.b,a=Math.max(Math.max(g,q),b),r=Math.min(Math.min(g,q),b);if(r===a){r=g=0}else{var e=a-r,r=e/a,g=g===a?(q-b)/e:q===a?2+(b-g)/e:4+(g-q)/e;g/=6;g<0&&(g+=1);g>1&&(g-=1)}h===void 0&&(h={h:0,s:0,v:0});h.h=g;h.s=r;h.v=a;return h}};c.ColorUtils.__hsv={h:0,s:0,v:0};c.GeometryUtils={merge:function(a,e){for(var b,f,n=a.vertices.length,l=e instanceof c.Mesh?e.geometry:e,h=a.vertices,p=l.vertices,q=a.faces,u=l.faces,r=a.faceVertexUvs[0],P=l.faceVertexUvs[0],g={},w=0;w<a.materials.length;w++){g[a.materials[w].id]=w}if(e instanceof c.Mesh){e.matrixAutoUpdate&&e.updateMatrix(),b=e.matrix,f=new c.Matrix4,f.extractRotation(b,e.scale)}for(var w=0,m=p.length;w<m;w++){var O=new c.Vertex(p[w].position.clone());b&&b.multiplyVector3(O.position);h.push(O)}w=0;for(m=u.length;w<m;w++){var h=u[w],k,o,Q=h.vertexNormals,t=h.vertexColors;h instanceof c.Face3?k=new c.Face3(h.a+n,h.b+n,h.c+n):h instanceof c.Face4&&(k=new c.Face4(h.a+n,h.b+n,h.c+n,h.d+n));k.normal.copy(h.normal);f&&f.multiplyVector3(k.normal);p=0;for(O=Q.length;p<O;p++){o=Q[p].clone(),f&&f.multiplyVector3(o),k.vertexNormals.push(o)}k.color.copy(h.color);p=0;for(O=t.length;p<O;p++){o=t[p],k.vertexColors.push(o.clone())}if(h.materialIndex!==void 0){p=l.materials[h.materialIndex];O=g[p.id];if(O===void 0){O=a.materials.length,a.materials.push(p)}k.materialIndex=O}k.centroid.copy(h.centroid);b&&b.multiplyVector3(k.centroid);q.push(k)}w=0;for(m=P.length;w<m;w++){b=P[w];f=[];p=0;for(O=b.length;p<O;p++){f.push(new c.UV(b[p].u,b[p].v))}r.push(f)}},clone:function(k){var o=new c.Geometry,l,y=k.vertices,a=k.faces,A=k.faceVertexUvs[0];if(k.materials){o.materials=k.materials.slice()}k=0;for(l=y.length;k<l;k++){var z=new c.Vertex(y[k].position.clone());o.vertices.push(z)}k=0;for(l=a.length;k<l;k++){var b=a[k],e,g,f=b.vertexNormals,h=b.vertexColors;b instanceof c.Face3?e=new c.Face3(b.a,b.b,b.c):b instanceof c.Face4&&(e=new c.Face4(b.a,b.b,b.c,b.d));e.normal.copy(b.normal);y=0;for(z=f.length;y<z;y++){g=f[y],e.vertexNormals.push(g.clone())}e.color.copy(b.color);y=0;for(z=h.length;y<z;y++){g=h[y],e.vertexColors.push(g.clone())}e.materialIndex=b.materialIndex;e.centroid.copy(b.centroid);o.faces.push(e)}k=0;for(l=A.length;k<l;k++){a=A[k];e=[];y=0;for(z=a.length;y<z;y++){e.push(new c.UV(a[y].u,a[y].v))}o.faceVertexUvs[0].push(e)}return o},randomPointInTriangle:function(f,h,g){var q,b,a,r=new c.Vector3,e=c.GeometryUtils.__v1;q=c.GeometryUtils.random();b=c.GeometryUtils.random();q+b>1&&(q=1-q,b=1-b);a=1-q-b;r.copy(f);r.multiplyScalar(q);e.copy(h);e.multiplyScalar(b);r.addSelf(e);e.copy(g);e.multiplyScalar(a);r.addSelf(e);return r},randomPointInFace:function(g,p,o){var a,f,e;if(g instanceof c.Face3){return a=p.vertices[g.a].position,f=p.vertices[g.b].position,e=p.vertices[g.c].position,c.GeometryUtils.randomPointInTriangle(a,f,e)}else{if(g instanceof c.Face4){a=p.vertices[g.a].position;f=p.vertices[g.b].position;e=p.vertices[g.c].position;var p=p.vertices[g.d].position,b;o?g._area1&&g._area2?(o=g._area1,b=g._area2):(o=c.GeometryUtils.triangleArea(a,f,p),b=c.GeometryUtils.triangleArea(f,e,p),g._area1=o,g._area2=b):(o=c.GeometryUtils.triangleArea(a,f,p),b=c.GeometryUtils.triangleArea(f,e,p));return c.GeometryUtils.random()*(o+b)<o?c.GeometryUtils.randomPointInTriangle(a,f,p):c.GeometryUtils.randomPointInTriangle(f,e,p)}}},randomPointsInGeometry:function(e,k){function f(j){function n(q,r){if(r<q){return q}var s=q+Math.floor((r-q)/2);return a[s]>j?n(q,s-1):a[s]<j?n(s+1,r):s}return n(0,a.length-1)}var l,p,o=e.faces,m=e.vertices,C=o.length,D=0,a=[],E,g,h,b;for(p=0;p<C;p++){l=o[p];if(l instanceof c.Face3){E=m[l.a].position,g=m[l.b].position,h=m[l.c].position,l._area=c.GeometryUtils.triangleArea(E,g,h)}else{if(l instanceof c.Face4){E=m[l.a].position,g=m[l.b].position,h=m[l.c].position,b=m[l.d].position,l._area1=c.GeometryUtils.triangleArea(E,g,b),l._area2=c.GeometryUtils.triangleArea(g,h,b),l._area=l._area1+l._area2}}D+=l._area;a[p]=D}l=[];m={};for(p=0;p<k;p++){C=c.GeometryUtils.random()*D,C=f(C),l[p]=c.GeometryUtils.randomPointInFace(o[C],e,!0),m[C]?m[C]+=1:m[C]=1}return l},triangleArea:function(k,a,l){var b,g=c.GeometryUtils.__v1;g.sub(k,a);b=g.length();g.sub(k,l);k=g.length();g.sub(a,l);l=g.length();a=0.5*(b+k+l);return Math.sqrt(a*(a-b)*(a-k)*(a-l))},center:function(b){b.computeBoundingBox();var a=new c.Matrix4;a.setTranslation(-0.5*(b.boundingBox.x[1]+b.boundingBox.x[0]),-0.5*(b.boundingBox.y[1]+b.boundingBox.y[0]),-0.5*(b.boundingBox.z[1]+b.boundingBox.z[0]));b.applyMatrix(a);b.computeBoundingBox()}};c.GeometryUtils.random=c.Math.random16;c.GeometryUtils.__v1=new c.Vector3;c.ImageUtils={loadTexture:function(k,a,l){var b=new Image,g=new c.Texture(b,a);b.onload=function(){g.needsUpdate=!0;l&&l(this)};b.crossOrigin="";b.src=k;return g},loadTextureCube:function(m,a,n){var b,g=[],f=new c.Texture(g,a),a=g.loadCount=0;for(b=m.length;a<b;++a){g[a]=new Image,g[a].onload=function(){g.loadCount+=1;if(g.loadCount===6){f.needsUpdate=!0}n&&n(this)},g[a].crossOrigin="",g[a].src=m[a]}return f},getNormalMap:function(a,f){var b=function(j){var s=Math.sqrt(j[0]*j[0]+j[1]*j[1]+j[2]*j[2]);return[j[0]/s,j[1]/s,j[2]/s]};f|=1;var h=a.width,o=a.height,m=document.createElement("canvas");m.width=h;m.height=o;var l=m.getContext("2d");l.drawImage(a,0,0);for(var q=l.getImageData(0,0,h,o).data,t=l.createImageData(h,o),M=t.data,w=0;w<h;w++){for(var g=1;g<o;g++){var k=g-1<0?o-1:g-1,N=(g+1)%o,p=w-1<0?h-1:w-1,e=(w+1)%h,n=[],r=[0,0,q[(g*h+w)*4]/255*f];n.push([-1,0,q[(g*h+p)*4]/255*f]);n.push([-1,-1,q[(k*h+p)*4]/255*f]);n.push([0,-1,q[(k*h+w)*4]/255*f]);n.push([1,-1,q[(k*h+e)*4]/255*f]);n.push([1,0,q[(g*h+e)*4]/255*f]);n.push([1,1,q[(N*h+e)*4]/255*f]);n.push([0,1,q[(N*h+w)*4]/255*f]);n.push([-1,1,q[(N*h+p)*4]/255*f]);k=[];p=n.length;for(N=0;N<p;N++){var e=n[N],O=n[(N+1)%p],e=[e[0]-r[0],e[1]-r[1],e[2]-r[2]],O=[O[0]-r[0],O[1]-r[1],O[2]-r[2]];k.push(b([e[1]*O[2]-e[2]*O[1],e[2]*O[0]-e[0]*O[2],e[0]*O[1]-e[1]*O[0]]))}n=[0,0,0];for(N=0;N<k.length;N++){n[0]+=k[N][0],n[1]+=k[N][1],n[2]+=k[N][2]}n[0]/=k.length;n[1]/=k.length;n[2]/=k.length;r=(g*h+w)*4;M[r]=(n[0]+1)/2*255|0;M[r+1]=(n[1]+0.5)*255|0;M[r+2]=n[2]*255|0;M[r+3]=255}}l.putImageData(t,0,0);return m}};c.SceneUtils={showHierarchy:function(b,a){c.SceneUtils.traverseHierarchy(b,function(e){e.visible=a})},traverseHierarchy:function(k,a){var l,b,g=k.children.length;for(b=0;b<g;b++){l=k.children[b],a(l),c.SceneUtils.traverseHierarchy(l,a)}},createMultiMaterialObject:function(m,a){var n,b=a.length,g=new c.Object3D;for(n=0;n<b;n++){var f=new c.Mesh(m,a[n]);g.add(f)}return g},cloneObject:function(j){var a;j instanceof c.MorphAnimMesh?(a=new c.MorphAnimMesh(j.geometry,j.material),a.duration=j.duration,a.mirroredLoop=j.mirroredLoop,a.time=j.time,a.lastKeyframe=j.lastKeyframe,a.currentKeyframe=j.currentKeyframe,a.direction=j.direction,a.directionBackwards=j.directionBackwards):j instanceof c.SkinnedMesh?a=new c.SkinnedMesh(j.geometry,j.material):j instanceof c.Mesh?a=new c.Mesh(j.geometry,j.material):j instanceof c.Line?a=new c.Line(j.geometry,j.material,j.type):j instanceof c.Ribbon?a=new c.Ribbon(j.geometry,j.material):j instanceof c.ParticleSystem?(a=new c.ParticleSystem(j.geometry,j.material),a.sortParticles=j.sortParticles):j instanceof c.Particle?a=new c.Particle(j.material):j instanceof c.Sprite?(a=new c.Sprite({}),a.color.copy(j.color),a.map=j.map,a.blending=j.blending,a.useScreenCoordinates=j.useScreenCoordinates,a.mergeWith3D=j.mergeWith3D,a.affectedByDistance=j.affectedByDistance,a.scaleByViewport=j.scaleByViewport,a.alignment=j.alignment,a.rotation3d.copy(j.rotation3d),a.rotation=j.rotation,a.opacity=j.opacity,a.uvOffset.copy(j.uvOffset),a.uvScale.copy(j.uvScale)):j instanceof c.LOD?a=new c.LOD:j instanceof c.MarchingCubes?(a=new c.MarchingCubes(j.resolution,j.material),a.field.set(j.field),a.isolation=j.isolation):j instanceof c.Object3D&&(a=new c.Object3D);a.parent=j.parent;a.up.copy(j.up);a.position.copy(j.position);a.rotation instanceof c.Vector3&&a.rotation.copy(j.rotation);a.eulerOrder=j.eulerOrder;a.scale.copy(j.scale);a.dynamic=j.dynamic;a.doubleSided=j.doubleSided;a.flipSided=j.flipSided;a.renderDepth=j.renderDepth;a.rotationAutoUpdate=j.rotationAutoUpdate;a.matrix.copy(j.matrix);a.matrixWorld.copy(j.matrixWorld);a.matrixRotationWorld.copy(j.matrixRotationWorld);a.matrixAutoUpdate=j.matrixAutoUpdate;a.matrixWorldNeedsUpdate=j.matrixWorldNeedsUpdate;a.quaternion.copy(j.quaternion);a.useQuaternion=j.useQuaternion;a.boundRadius=j.boundRadius;a.boundRadiusScale=j.boundRadiusScale;a.visible=j.visible;a.castShadow=j.castShadow;a.receiveShadow=j.receiveShadow;a.frustumCulled=j.frustumCulled;for(var k=0;k<j.children.length;k++){var b=c.SceneUtils.cloneObject(j.children[k]);a.children[k]=b;b.parent=a}if(j instanceof c.LOD){for(k=0;k<j.LODs.length;k++){a.LODs[k]={visibleAtDistance:j.LODs[k].visibleAtDistance,object3D:a.children[k]}}}return a}};if(c.WebGLRenderer){c.ShaderUtils={lib:{fresnel:{uniforms:{mRefractionRatio:{type:"f",value:1.02},mFresnelBias:{type:"f",value:0.1},mFresnelPower:{type:"f",value:2},mFresnelScale:{type:"f",value:1},tCube:{type:"t",value:1,texture:null}},fragmentShader:"uniform samplerCube tCube;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\nvec4 refractedColor = vec4( 1.0, 1.0, 1.0, 1.0 );\nrefractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;\nrefractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;\nrefractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;\nrefractedColor.a = 1.0;\ngl_FragColor = mix( refractedColor, reflectedColor, clamp( vReflectionFactor, 0.0, 1.0 ) );\n}",vertexShader:"uniform float mRefractionRatio;\nuniform float mFresnelBias;\nuniform float mFresnelScale;\nuniform float mFresnelPower;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = normalize ( mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal );\nvec3 I = mPosition.xyz - cameraPosition;\nvReflect = reflect( I, nWorld );\nvRefract[0] = refract( normalize( I ), nWorld, mRefractionRatio );\nvRefract[1] = refract( normalize( I ), nWorld, mRefractionRatio * 0.99 );\nvRefract[2] = refract( normalize( I ), nWorld, mRefractionRatio * 0.98 );\nvReflectionFactor = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( I ), nWorld ), mFresnelPower );\ngl_Position = projectionMatrix * mvPosition;\n}"},normal:{uniforms:c.UniformsUtils.merge([c.UniformsLib.fog,c.UniformsLib.lights,c.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},tDiffuse:{type:"t",value:0,texture:null},tCube:{type:"t",value:1,texture:null},tNormal:{type:"t",value:2,texture:null},tSpecular:{type:"t",value:3,texture:null},tAO:{type:"t",value:4,texture:null},tDisplacement:{type:"t",value:5,texture:null},uNormalScale:{type:"f",value:1},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new c.Color(15658734)},uSpecularColor:{type:"c",value:new c.Color(1118481)},uAmbientColor:{type:"c",value:new c.Color(328965)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1},uReflectivity:{type:"f",value:0.5},uOffset:{type:"v2",value:new c.Vector2(0,0)},uRepeat:{type:"v2",value:new c.Vector2(1,1)}}]),fragmentShader:["uniform vec3 uAmbientColor;\nuniform vec3 uDiffuseColor;\nuniform vec3 uSpecularColor;\nuniform float uShininess;\nuniform float uOpacity;\nuniform bool enableDiffuse;\nuniform bool enableSpecular;\nuniform bool enableAO;\nuniform bool enableReflection;\nuniform sampler2D tDiffuse;\nuniform sampler2D tNormal;\nuniform sampler2D tSpecular;\nuniform sampler2D tAO;\nuniform samplerCube tCube;\nuniform float uNormalScale;\nuniform float uReflectivity;\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\nvarying vec3 vViewPosition;",c.ShaderChunk.shadowmap_pars_fragment,c.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3( 1.0 ), uOpacity );\nvec3 specularTex = vec3( 1.0 );\nvec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;\nnormalTex.xy *= uNormalScale;\nnormalTex = normalize( normalTex );\nif( enableDiffuse )\ngl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );\nif( enableAO )\ngl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;\nif( enableSpecular )\nspecularTex = texture2D( tSpecular, vUv ).xyz;\nmat3 tsb = mat3( vTangent, vBinormal, vNormal );\nvec3 finalNormal = tsb * normalTex;\nvec3 normal = normalize( finalNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec3 pointVector = normalize( vPointLight[ i ].xyz );\nvec3 pointHalfVector = normalize( vPointLight[ i ].xyz + viewPosition );\nfloat pointDistance = vPointLight[ i ].w;\nfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\nfloat pointSpecularWeight = specularTex.r * pow( pointDotNormalHalf, uShininess );\npointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;\npointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nvec3 dirHalfVector = normalize( lDirection.xyz + viewPosition );\nfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\nfloat dirSpecularWeight = specularTex.r * pow( dirDotNormalHalf, uShininess );\ndirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;\ndirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;\n}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\ngl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor) + totalSpecular;\nif ( enableReflection ) {\nvec3 wPos = cameraPosition - vViewPosition;\nvec3 vReflect = reflect( normalize( wPos ), normal );\nvec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\ngl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, uReflectivity );\n}",c.ShaderChunk.shadowmap_fragment,c.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;\nuniform vec2 uOffset;\nuniform vec2 uRepeat;\n#ifdef VERTEX_TEXTURES\nuniform sampler2D tDisplacement;\nuniform float uDisplacementScale;\nuniform float uDisplacementBias;\n#endif\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\nvarying vec3 vViewPosition;",c.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvViewPosition = -mvPosition.xyz;\nvNormal = normalize( normalMatrix * normal );\nvTangent = normalize( normalMatrix * tangent.xyz );\nvBinormal = cross( vNormal, vTangent ) * tangent.w;\nvBinormal = normalize( vBinormal );\nvUv = uv * uRepeat + uOffset;\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nvPointLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#ifdef VERTEX_TEXTURES\nvec3 dv = texture2D( tDisplacement, uv ).xyz;\nfloat df = uDisplacementScale * dv.x + uDisplacementBias;\nvec4 displacedPosition = vec4( vNormal.xyz * df, 0.0 ) + mvPosition;\ngl_Position = projectionMatrix * displacedPosition;\n#else\ngl_Position = projectionMatrix * mvPosition;\n#endif",c.ShaderChunk.shadowmap_vertex,"}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:1,texture:null},tFlip:{type:"f",value:-1}},vertexShader:"varying vec3 vViewPosition;\nvoid main() {\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvViewPosition = cameraPosition - mPosition.xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform samplerCube tCube;\nuniform float tFlip;\nvarying vec3 vViewPosition;\nvoid main() {\nvec3 wPos = cameraPosition - vViewPosition;\ngl_FragColor = textureCube( tCube, vec3( tFlip * wPos.x, wPos.yz ) );\n}"}}}}c.Curve=function(){};c.Curve.prototype.getPoint=function(){console.log("Warning, getPoint() not implemented!");return null};c.Curve.prototype.getPointAt=function(a){return this.getPoint(this.getUtoTmapping(a))};c.Curve.prototype.getPoints=function(b){b||(b=5);var a,g=[];for(a=0;a<=b;a++){g.push(this.getPoint(a/b))}return g};c.Curve.prototype.getSpacedPoints=function(b){b||(b=5);var a,g=[];for(a=0;a<=b;a++){g.push(this.getPointAt(a/b))}return g};c.Curve.prototype.getLength=function(){var a=this.getLengths();return a[a.length-1]};c.Curve.prototype.getLengths=function(m){m||(m=200);if(this.cacheArcLengths&&this.cacheArcLengths.length==m+1){return this.cacheArcLengths}var a=[],n,b=this.getPoint(0),g,f=0;a.push(0);for(g=1;g<=m;g++){n=this.getPoint(g/m),f+=n.distanceTo(b),a.push(f),b=n}return this.cacheArcLengths=a};c.Curve.prototype.getUtoTmapping=function(a,e){var b=this.getLengths(),f=0,s=b.length,h;h=e?e:a*b[s-1];for(var g=0,t=s-1,u;g<=t;){if(f=Math.floor(g+(t-g)/2),u=b[f]-h,u<0){g=f+1}else{if(u>0){t=f-1}else{t=f;break}}}f=t;if(b[f]==h){return f/(s-1)}g=b[f];return b=(f+(h-g)/(b[f+1]-g))/(s-1)};c.Curve.prototype.getNormalVector=function(a){a=this.getTangent(a);return new c.Vector2(-a.y,a.x)};c.Curve.prototype.getTangent=function(b){var a=b-0.0001;b+=0.0001;a<0&&(a=0);b>1&&(b=1);a=this.getPoint(a);b=this.getPoint(b);return a.clone().subSelf(b).normalize()};c.Curve.prototype.getTangentAt=function(a){return this.getTangent(this.getUtoTmapping(a))};c.LineCurve=function(b,a){b instanceof c.Vector2?(this.v1=b,this.v2=a):c.LineCurve.oldConstructor.apply(this,arguments)};c.LineCurve.oldConstructor=function(j,a,k,b){this.constructor(new c.Vector2(j,a),new c.Vector2(k,b))};c.LineCurve.prototype=new c.Curve;c.LineCurve.prototype.constructor=c.LineCurve;c.LineCurve.prototype.getPoint=function(b){var a=new c.Vector2;a.sub(this.v2,this.v1);a.multiplyScalar(b).addSelf(this.v1);return a};c.LineCurve.prototype.getPointAt=function(a){return this.getPoint(a)};c.LineCurve.prototype.getTangent=function(){var a=new c.Vector2;a.sub(this.v2,this.v1);a.normalize();return a};c.QuadraticBezierCurve=function(j,a,k){if(!(a instanceof c.Vector2)){var b=Array.prototype.slice.call(arguments),j=new c.Vector2(b[0],b[1]),a=new c.Vector2(b[2],b[3]),k=new c.Vector2(b[4],b[5])}this.v0=j;this.v1=a;this.v2=k};c.QuadraticBezierCurve.prototype=new c.Curve;c.QuadraticBezierCurve.prototype.constructor=c.QuadraticBezierCurve;c.QuadraticBezierCurve.prototype.getPoint=function(b){var a;a=c.Shape.Utils.b2(b,this.v0.x,this.v1.x,this.v2.x);b=c.Shape.Utils.b2(b,this.v0.y,this.v1.y,this.v2.y);return new c.Vector2(a,b)};c.QuadraticBezierCurve.prototype.getTangent=function(b){var a;a=c.Curve.Utils.tangentQuadraticBezier(b,this.v0.x,this.v1.x,this.v2.x);b=c.Curve.Utils.tangentQuadraticBezier(b,this.v0.y,this.v1.y,this.v2.y);a=new c.Vector2(a,b);a.normalize();return a};c.CubicBezierCurve=function(k,a,l,b){if(!(a instanceof c.Vector2)){var g=Array.prototype.slice.call(arguments),k=new c.Vector2(g[0],g[1]),a=new c.Vector2(g[2],g[3]),l=new c.Vector2(g[4],g[5]),b=new c.Vector2(g[6],g[7])}this.v0=k;this.v1=a;this.v2=l;this.v3=b};c.CubicBezierCurve.prototype=new c.Curve;c.CubicBezierCurve.prototype.constructor=c.CubicBezierCurve;c.CubicBezierCurve.prototype.getPoint=function(b){var a;a=c.Shape.Utils.b3(b,this.v0.x,this.v1.x,this.v2.x,this.v3.x);b=c.Shape.Utils.b3(b,this.v0.y,this.v1.y,this.v2.y,this.v3.y);return new c.Vector2(a,b)};c.CubicBezierCurve.prototype.getTangent=function(b){var a;a=c.Curve.Utils.tangentCubicBezier(b,this.v0.x,this.v1.x,this.v2.x,this.v3.x);b=c.Curve.Utils.tangentCubicBezier(b,this.v0.y,this.v1.y,this.v2.y,this.v3.y);a=new c.Vector2(a,b);a.normalize();return a};c.SplineCurve=function(a){this.points=a==void 0?[]:a};c.SplineCurve.prototype=new c.Curve;c.SplineCurve.prototype.constructor=c.SplineCurve;c.SplineCurve.prototype.getPoint=function(k){var a=new c.Vector2,l=[],b=this.points,g;g=(b.length-1)*k;k=Math.floor(g);g-=k;l[0]=k==0?k:k-1;l[1]=k;l[2]=k>b.length-2?k:k+1;l[3]=k>b.length-3?k:k+2;a.x=c.Curve.Utils.interpolate(b[l[0]].x,b[l[1]].x,b[l[2]].x,b[l[3]].x,g);a.y=c.Curve.Utils.interpolate(b[l[0]].y,b[l[1]].y,b[l[2]].y,b[l[3]].y,g);return a};c.ArcCurve=function(m,a,n,b,g,f){this.aX=m;this.aY=a;this.aRadius=n;this.aStartAngle=b;this.aEndAngle=g;this.aClockwise=f};c.ArcCurve.prototype=new c.Curve;c.ArcCurve.prototype.constructor=c.ArcCurve;c.ArcCurve.prototype.getPoint=function(b){var a=this.aEndAngle-this.aStartAngle;this.aClockwise||(b=1-b);b=this.aStartAngle+b*a;return new c.Vector2(this.aX+this.aRadius*Math.cos(b),this.aY+this.aRadius*Math.sin(b))};c.Curve.Utils={tangentQuadraticBezier:function(j,a,k,b){return 2*(1-j)*(k-a)+2*j*(b-k)},tangentCubicBezier:function(k,a,l,b,g){return -3*a*(1-k)*(1-k)+3*l*(1-k)*(1-k)-6*k*l*(1-k)+6*k*b*(1-k)-3*k*k*b+3*k*k*g},tangentSpline:function(a){return 6*a*a-6*a+(3*a*a-4*a+1)+(-6*a*a+6*a)+(3*a*a-2*a)},interpolate:function(m,a,n,b,g){var m=(n-m)*0.5,b=(b-a)*0.5,f=g*g;return(2*a-2*n+m+b)*g*f+(-3*a+3*n-2*m-b)*f+m*g+a}};c.Curve.create=function(b,a){b.prototype=new c.Curve;b.prototype.constructor=b;b.prototype.getPoint=a;return b};c.LineCurve3=c.Curve.create(function(b,a){this.v1=b;this.v2=a},function(b){var a=new c.Vector3;a.sub(this.v2,this.v1);a.multiplyScalar(b);a.addSelf(this.v1);return a});c.QuadraticBezierCurve3=c.Curve.create(function(b,a,g){this.v0=b;this.v1=a;this.v2=g},function(b){var a,g;a=c.Shape.Utils.b2(b,this.v0.x,this.v1.x,this.v2.x);g=c.Shape.Utils.b2(b,this.v0.y,this.v1.y,this.v2.y);b=c.Shape.Utils.b2(b,this.v0.z,this.v1.z,this.v2.z);return new c.Vector3(a,g,b)});c.CubicBezierCurve3=c.Curve.create(function(j,a,k,b){this.v0=j;this.v1=a;this.v2=k;this.v3=b},function(b){var a,g;a=c.Shape.Utils.b3(b,this.v0.x,this.v1.x,this.v2.x,this.v3.x);g=c.Shape.Utils.b3(b,this.v0.y,this.v1.y,this.v2.y,this.v3.y);b=c.Shape.Utils.b3(b,this.v0.z,this.v1.z,this.v2.z,this.v3.z);return new c.Vector3(a,g,b)});c.SplineCurve3=c.Curve.create(function(a){this.points=a==void 0?[]:a},function(k){var a=new c.Vector3,l=[],b=this.points,g;g=(b.length-1)*k;k=Math.floor(g);g-=k;l[0]=k==0?k:k-1;l[1]=k;l[2]=k>b.length-2?k:k+1;l[3]=k>b.length-3?k:k+2;a.x=c.Curve.Utils.interpolate(b[l[0]].x,b[l[1]].x,b[l[2]].x,b[l[3]].x,g);a.y=c.Curve.Utils.interpolate(b[l[0]].y,b[l[1]].y,b[l[2]].y,b[l[3]].y,g);a.z=c.Curve.Utils.interpolate(b[l[0]].z,b[l[1]].z,b[l[2]].z,b[l[3]].z,g);return a});c.CurvePath=function(){this.curves=[];this.bends=[]};c.CurvePath.prototype=new c.Curve;c.CurvePath.prototype.constructor=c.CurvePath;c.CurvePath.prototype.add=function(a){this.curves.push(a)};c.CurvePath.prototype.checkConnection=function(){};c.CurvePath.prototype.closePath=function(){};c.CurvePath.prototype.getPoint=function(b){for(var a=b*this.getLength(),g=this.getCurveLengths(),b=0;b<g.length;){if(g[b]>=a){return a=g[b]-a,b=this.curves[b],a=1-a/b.getLength(),b.getPointAt(a)}b++}return null};c.CurvePath.prototype.getLength=function(){var a=this.getCurveLengths();return a[a.length-1]};c.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length){return this.cacheLengths}var j=[],a=0,k,b=this.curves.length;for(k=0;k<b;k++){a+=this.curves[k].getLength(),j.push(a)}return this.cacheLengths=j};c.CurvePath.prototype.getBoundingBox=function(){var a=this.getPoints(),e,b,f,s;e=b=Number.NEGATIVE_INFINITY;f=s=Number.POSITIVE_INFINITY;var h,g,t,u;u=new c.Vector2;g=0;for(t=a.length;g<t;g++){h=a[g];if(h.x>e){e=h.x}else{if(h.x<f){f=h.x}}if(h.y>b){b=h.y}else{if(h.y<b){s=h.y}}u.addSelf(h.x,h.y)}return{minX:f,minY:s,maxX:e,maxY:b,centroid:u.divideScalar(t)}};c.CurvePath.prototype.createPointsGeometry=function(a){return this.createGeometry(this.getPoints(a,!0))};c.CurvePath.prototype.createSpacedPointsGeometry=function(a){return this.createGeometry(this.getSpacedPoints(a,!0))};c.CurvePath.prototype.createGeometry=function(b){for(var a=new c.Geometry,g=0;g<b.length;g++){a.vertices.push(new c.Vertex(new c.Vector3(b[g].x,b[g].y,0)))}return a};c.CurvePath.prototype.addWrapPath=function(a){this.bends.push(a)};c.CurvePath.prototype.getTransformedPoints=function(k,a){var l=this.getPoints(k),b,g;if(!a){a=this.bends}b=0;for(g=a.length;b<g;b++){l=this.getWrapPoints(l,a[b])}return l};c.CurvePath.prototype.getTransformedSpacedPoints=function(k,a){var l=this.getSpacedPoints(k),b,g;if(!a){a=this.bends}b=0;for(g=a.length;b<g;b++){l=this.getWrapPoints(l,a[b])}return l};c.CurvePath.prototype.getWrapPoints=function(a,e){var b=this.getBoundingBox(),f,s,h,g,t,u;f=0;for(s=a.length;f<s;f++){h=a[f],g=h.x,t=h.y,u=g/b.maxX,u=e.getUtoTmapping(u,g),g=e.getPoint(u),t=e.getNormalVector(u).multiplyScalar(t),h.x=g.x+t.x,h.y=g.y+t.y}return a};c.Path=function(a){c.CurvePath.call(this);this.actions=[];a&&this.fromPoints(a)};c.Path.prototype=new c.CurvePath;c.Path.prototype.constructor=c.Path;c.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc"};c.Path.prototype.fromPoints=function(b){this.moveTo(b[0].x,b[0].y);var a,g=b.length;for(a=1;a<g;a++){this.lineTo(b[a].x,b[a].y)}};c.Path.prototype.moveTo=function(){var a=Array.prototype.slice.call(arguments);this.actions.push({action:c.PathActions.MOVE_TO,args:a})};c.Path.prototype.lineTo=function(j,a){var k=Array.prototype.slice.call(arguments),b=this.actions[this.actions.length-1].args;this.curves.push(new c.LineCurve(new c.Vector2(b[b.length-2],b[b.length-1]),new c.Vector2(j,a)));this.actions.push({action:c.PathActions.LINE_TO,args:k})};c.Path.prototype.quadraticCurveTo=function(m,a,n,b){var g=Array.prototype.slice.call(arguments),f=this.actions[this.actions.length-1].args;this.curves.push(new c.QuadraticBezierCurve(new c.Vector2(f[f.length-2],f[f.length-1]),new c.Vector2(m,a),new c.Vector2(n,b)));this.actions.push({action:c.PathActions.QUADRATIC_CURVE_TO,args:g})};c.Path.prototype.bezierCurveTo=function(f,h,g,q,b,a){var r=Array.prototype.slice.call(arguments),e=this.actions[this.actions.length-1].args;this.curves.push(new c.CubicBezierCurve(new c.Vector2(e[e.length-2],e[e.length-1]),new c.Vector2(f,h),new c.Vector2(g,q),new c.Vector2(b,a)));this.actions.push({action:c.PathActions.BEZIER_CURVE_TO,args:r})};c.Path.prototype.splineThru=function(b){var a=Array.prototype.slice.call(arguments),g=this.actions[this.actions.length-1].args,g=[new c.Vector2(g[g.length-2],g[g.length-1])];Array.prototype.push.apply(g,b);this.curves.push(new c.SplineCurve(g));this.actions.push({action:c.PathActions.CSPLINE_THRU,args:a})};c.Path.prototype.arc=function(g,p,o,a,f,e){var b=Array.prototype.slice.call(arguments);this.curves.push(new c.ArcCurve(g,p,o,a,f,e));this.actions.push({action:c.PathActions.ARC,args:b})};c.Path.prototype.getSpacedPoints=function(b){b||(b=40);for(var a=[],g=0;g<b;g++){a.push(this.getPoint(g/b))}return a};c.Path.prototype.getPoints=function(o,I){var o=o||12,q=[],K,e,b,a,f,h,l,k,p,r,m,g,n;K=0;for(e=this.actions.length;K<e;K++){switch(b=this.actions[K],a=b.action,b=b.args,a){case c.PathActions.LINE_TO:q.push(new c.Vector2(b[0],b[1]));break;case c.PathActions.QUADRATIC_CURVE_TO:f=b[2];h=b[3];p=b[0];r=b[1];q.length>0?(a=q[q.length-1],m=a.x,g=a.y):(a=this.actions[K-1].args,m=a[a.length-2],g=a[a.length-1]);for(a=1;a<=o;a++){n=a/o,b=c.Shape.Utils.b2(n,m,p,f),n=c.Shape.Utils.b2(n,g,r,h),q.push(new c.Vector2(b,n))}break;case c.PathActions.BEZIER_CURVE_TO:f=b[4];h=b[5];p=b[0];r=b[1];l=b[2];k=b[3];q.length>0?(a=q[q.length-1],m=a.x,g=a.y):(a=this.actions[K-1].args,m=a[a.length-2],g=a[a.length-1]);for(a=1;a<=o;a++){n=a/o,b=c.Shape.Utils.b3(n,m,p,l,f),n=c.Shape.Utils.b3(n,g,r,k,h),q.push(new c.Vector2(b,n))}break;case c.PathActions.CSPLINE_THRU:a=this.actions[K-1].args;a=[new c.Vector2(a[a.length-2],a[a.length-1])];n=o*b[0].length;a=a.concat(b[0]);b=new c.SplineCurve(a);for(a=1;a<=n;a++){q.push(b.getPointAt(a/n))}break;case c.PathActions.ARC:a=this.actions[K-1].args;f=b[0];h=b[1];l=b[2];p=b[3];n=b[4];r=!!b[5];k=a[a.length-2];m=a[a.length-1];a.length==0&&(k=m=0);g=n-p;var J=o*2;for(a=1;a<=J;a++){n=a/J,r||(n=1-n),n=p+n*g,b=k+f+l*Math.cos(n),n=m+h+l*Math.sin(n),q.push(new c.Vector2(b,n))}}}I&&q.push(q[0]);return q};c.Path.prototype.transform=function(b,a){this.getBoundingBox();return this.getWrapPoints(this.getPoints(a),b)};c.Path.prototype.nltransform=function(k,o,l,y,a,A){var z=this.getPoints(),b,e,g,f,h;b=0;for(e=z.length;b<e;b++){g=z[b],f=g.x,h=g.y,g.x=k*f+o*h+l,g.y=y*h+a*f+A}return z};c.Path.prototype.debug=function(k){var a=this.getBoundingBox();k||(k=document.createElement("canvas"),k.setAttribute("width",a.maxX+100),k.setAttribute("height",a.maxY+100),document.body.appendChild(k));a=k.getContext("2d");a.fillStyle="white";a.fillRect(0,0,k.width,k.height);a.strokeStyle="black";a.beginPath();var l,b,g,k=0;for(l=this.actions.length;k<l;k++){b=this.actions[k],g=b.args,b=b.action,b!=c.PathActions.CSPLINE_THRU&&a[b].apply(a,g)}a.stroke();a.closePath();a.strokeStyle="red";b=this.getPoints();k=0;for(l=b.length;k<l;k++){g=b[k],a.beginPath(),a.arc(g.x,g.y,1.5,0,Math.PI*2,!1),a.stroke(),a.closePath()}};c.Path.prototype.toShapes=function(){var g,p,o,a,f=[],e=new c.Path;g=0;for(p=this.actions.length;g<p;g++){o=this.actions[g],a=o.args,o=o.action,o==c.PathActions.MOVE_TO&&e.actions.length!=0&&(f.push(e),e=new c.Path),e[o].apply(e,a)}e.actions.length!=0&&f.push(e);if(f.length==0){return[]}var b,e=[];if(c.Shape.Utils.isClockWise(f[0].getPoints())){g=0;for(p=f.length;g<p;g++){a=f[g],c.Shape.Utils.isClockWise(a.getPoints())?(b&&e.push(b),b=new c.Shape,b.actions=a.actions,b.curves=a.curves):b.holes.push(a)}e.push(b)}else{b=new c.Shape;g=0;for(p=f.length;g<p;g++){a=f[g],c.Shape.Utils.isClockWise(a.getPoints())?(b.actions=a.actions,b.curves=a.curves,e.push(b),b=new c.Shape):b.holes.push(a)}}return e};c.Shape=function(){c.Path.apply(this,arguments);this.holes=[]};c.Shape.prototype=new c.Path;c.Shape.prototype.constructor=c.Path;c.Shape.prototype.extrude=function(a){return new c.ExtrudeGeometry(this,a)};c.Shape.prototype.getPointsHoles=function(j){var a,k=this.holes.length,b=[];for(a=0;a<k;a++){b[a]=this.holes[a].getTransformedPoints(j,this.bends)}return b};c.Shape.prototype.getSpacedPointsHoles=function(j){var a,k=this.holes.length,b=[];for(a=0;a<k;a++){b[a]=this.holes[a].getTransformedSpacedPoints(j,this.bends)}return b};c.Shape.prototype.extractAllPoints=function(a){return{shape:this.getTransformedPoints(a),holes:this.getPointsHoles(a)}};c.Shape.prototype.extractAllSpacedPoints=function(a){return{shape:this.getTransformedSpacedPoints(a),holes:this.getSpacedPointsHoles(a)}};c.Shape.Utils={removeHoles:function(o,I){var q=o.concat(),K=q.concat(),e,b,a,f,h,l,k,p,r,m,g=[];for(h=0;h<I.length;h++){l=I[h];Array.prototype.push.apply(K,l);b=Number.POSITIVE_INFINITY;for(e=0;e<l.length;e++){r=l[e];m=[];for(p=0;p<q.length;p++){k=q[p],k=r.distanceToSquared(k),m.push(k),k<b&&(b=k,a=e,f=p)}}e=f-1>=0?f-1:q.length-1;b=a-1>=0?a-1:l.length-1;var n=[l[a],q[f],q[e]];p=c.FontUtils.Triangulate.area(n);var J=[l[a],l[b],q[f]];r=c.FontUtils.Triangulate.area(J);m=f;k=a;f+=1;a+=-1;f<0&&(f+=q.length);f%=q.length;a<0&&(a+=l.length);a%=l.length;e=f-1>=0?f-1:q.length-1;b=a-1>=0?a-1:l.length-1;n=[l[a],q[f],q[e]];n=c.FontUtils.Triangulate.area(n);J=[l[a],l[b],q[f]];J=c.FontUtils.Triangulate.area(J);p+r>n+J&&(f=m,a=k,f<0&&(f+=q.length),f%=q.length,a<0&&(a+=l.length),a%=l.length,e=f-1>=0?f-1:q.length-1,b=a-1>=0?a-1:l.length-1);p=q.slice(0,f);r=q.slice(f);m=l.slice(a);k=l.slice(0,a);b=[l[a],l[b],q[f]];g.push([l[a],q[f],q[e]]);g.push(b);q=p.concat(m).concat(k).concat(r)}return{shape:q,isolatedPts:g,allpoints:K}},triangulateShape:function(v,a){var w=c.Shape.Utils.removeHoles(v,a),b=w.allpoints,g=w.isolatedPts,w=c.FontUtils.Triangulate(w.shape,!1),f,e,h,l,u={};f=0;for(e=b.length;f<e;f++){l=b[f].x+":"+b[f].y,u[l]!==void 0&&console.log("Duplicate point",l),u[l]=f}f=0;for(e=w.length;f<e;f++){h=w[f];for(b=0;b<3;b++){l=h[b].x+":"+h[b].y,l=u[l],l!==void 0&&(h[b]=l)}}f=0;for(e=g.length;f<e;f++){h=g[f];for(b=0;b<3;b++){l=h[b].x+":"+h[b].y,l=u[l],l!==void 0&&(h[b]=l)}}return w.concat(g)},isClockWise:function(a){return c.FontUtils.Triangulate.area(a)<0},b2p0:function(b,a){var g=1-b;return g*g*a},b2p1:function(b,a){return 2*(1-b)*b*a},b2p2:function(b,a){return b*b*a},b2:function(j,a,k,b){return this.b2p0(j,a)+this.b2p1(j,k)+this.b2p2(j,b)},b3p0:function(b,a){var g=1-b;return g*g*g*a},b3p1:function(b,a){var g=1-b;return 3*g*g*b*a},b3p2:function(b,a){return 3*(1-b)*b*b*a},b3p3:function(b,a){return b*b*b*a},b3:function(k,a,l,b,g){return this.b3p0(k,a)+this.b3p1(k,l)+this.b3p2(k,b)+this.b3p3(k,g)}};c.TextPath=function(b,a){c.Path.call(this);this.parameters=a||{};this.set(b)};c.TextPath.prototype.set=function(m,a){this.text=m;var a=a||this.parameters,n=a.curveSegments!==void 0?a.curveSegments:4,b=a.font!==void 0?a.font:"helvetiker",g=a.weight!==void 0?a.weight:"normal",f=a.style!==void 0?a.style:"normal";c.FontUtils.size=a.size!==void 0?a.size:100;c.FontUtils.divisions=n;c.FontUtils.face=b;c.FontUtils.weight=g;c.FontUtils.style=f};c.TextPath.prototype.toShapes=function(){for(var j=c.FontUtils.drawText(this.text).paths,a=[],k=0,b=j.length;k<b;k++){Array.prototype.push.apply(a,j[k].toShapes())}return a};c.AnimationHandler=function(){var j=[],a={},k={update:function(f){for(var e=0;e<j.length;e++){j[e].update(f)}},addToUpdate:function(e){j.indexOf(e)===-1&&j.push(e)},removeFromUpdate:function(e){e=j.indexOf(e);e!==-1&&j.splice(e,1)},add:function(e){a[e.name]!==void 0&&console.log("THREE.AnimationHandler.add: Warning! "+e.name+" already exists in library. Overwriting.");a[e.name]=e;if(e.initialized!==!0){for(var s=0;s<e.hierarchy.length;s++){for(var g=0;g<e.hierarchy[s].keys.length;g++){if(e.hierarchy[s].keys[g].time<0){e.hierarchy[s].keys[g].time=0}if(e.hierarchy[s].keys[g].rot!==void 0&&!(e.hierarchy[s].keys[g].rot instanceof c.Quaternion)){var h=e.hierarchy[s].keys[g].rot;e.hierarchy[s].keys[g].rot=new c.Quaternion(h[0],h[1],h[2],h[3])}}if(e.hierarchy[s].keys[0].morphTargets!==void 0){h={};for(g=0;g<e.hierarchy[s].keys.length;g++){for(var l=0;l<e.hierarchy[s].keys[g].morphTargets.length;l++){var f=e.hierarchy[s].keys[g].morphTargets[l];h[f]=-1}}e.hierarchy[s].usedMorphTargets=h;for(g=0;g<e.hierarchy[s].keys.length;g++){var r={};for(f in h){for(l=0;l<e.hierarchy[s].keys[g].morphTargets.length;l++){if(e.hierarchy[s].keys[g].morphTargets[l]===f){r[f]=e.hierarchy[s].keys[g].morphTargetsInfluences[l];break}}l===e.hierarchy[s].keys[g].morphTargets.length&&(r[f]=0)}e.hierarchy[s].keys[g].morphTargetsInfluences=r}}for(g=1;g<e.hierarchy[s].keys.length;g++){e.hierarchy[s].keys[g].time===e.hierarchy[s].keys[g-1].time&&(e.hierarchy[s].keys.splice(g,1),g--)}for(g=1;g<e.hierarchy[s].keys.length;g++){e.hierarchy[s].keys[g].index=g}}g=parseInt(e.length*e.fps,10);e.JIT={};e.JIT.hierarchy=[];for(s=0;s<e.hierarchy.length;s++){e.JIT.hierarchy.push(Array(g))}e.initialized=!0}},get:function(e){if(typeof e==="string"){return a[e]?a[e]:(console.log("THREE.AnimationHandler.get: Couldn't find animation "+e),null)}},parse:function(f){var g=[];if(f instanceof c.SkinnedMesh){for(var e=0;e<f.bones.length;e++){g.push(f.bones[e])}}else{b(f,g)}return g}},b=function(f,g){g.push(f);for(var e=0;e<f.children.length;e++){b(f.children[e],g)}};k.LINEAR=0;k.CATMULLROM=1;k.CATMULLROM_FORWARD=2;return k}();c.Animation=function(j,a,k,b){this.root=j;this.data=c.AnimationHandler.get(a);this.hierarchy=c.AnimationHandler.parse(j);this.currentTime=0;this.timeScale=1;this.isPlaying=!1;this.loop=this.isPaused=!0;this.interpolationType=k!==void 0?k:c.AnimationHandler.LINEAR;this.JITCompile=b!==void 0?b:!0;this.points=[];this.target=new c.Vector3};c.Animation.prototype.play=function(m,a){if(!this.isPlaying){this.isPlaying=!0;this.loop=m!==void 0?m:!0;this.currentTime=a!==void 0?a:0;var n,b=this.hierarchy.length,g;for(n=0;n<b;n++){g=this.hierarchy[n];if(this.interpolationType!==c.AnimationHandler.CATMULLROM_FORWARD){g.useQuaternion=!0}g.matrixAutoUpdate=!0;if(g.animationCache===void 0){g.animationCache={},g.animationCache.prevKey={pos:0,rot:0,scl:0},g.animationCache.nextKey={pos:0,rot:0,scl:0},g.animationCache.originalMatrix=g instanceof c.Bone?g.skinMatrix:g.matrix}var f=g.animationCache.prevKey;g=g.animationCache.nextKey;f.pos=this.data.hierarchy[n].keys[0];f.rot=this.data.hierarchy[n].keys[0];f.scl=this.data.hierarchy[n].keys[0];g.pos=this.getNextKeyWith("pos",n,1);g.rot=this.getNextKeyWith("rot",n,1);g.scl=this.getNextKeyWith("scl",n,1)}this.update(0)}this.isPaused=!1;c.AnimationHandler.addToUpdate(this)};c.Animation.prototype.pause=function(){this.isPaused?c.AnimationHandler.addToUpdate(this):c.AnimationHandler.removeFromUpdate(this);this.isPaused=!this.isPaused};c.Animation.prototype.stop=function(){this.isPaused=this.isPlaying=!1;c.AnimationHandler.removeFromUpdate(this);for(var a=0;a<this.hierarchy.length;a++){if(this.hierarchy[a].animationCache!==void 0){this.hierarchy[a] instanceof c.Bone?this.hierarchy[a].skinMatrix=this.hierarchy[a].animationCache.originalMatrix:this.hierarchy[a].matrix=this.hierarchy[a].animationCache.originalMatrix,delete this.hierarchy[a].animationCache}}};c.Animation.prototype.update=function(G){if(this.isPlaying){var a=["pos","rot","scl"],I,e,k,g,f,l,m,o,n=this.data.JIT.hierarchy,H,b;this.currentTime+=G*this.timeScale;b=this.currentTime;H=this.currentTime%=this.data.length;o=parseInt(Math.min(H*this.data.fps,this.data.length*this.data.fps),10);for(var p=0,h=this.hierarchy.length;p<h;p++){if(G=this.hierarchy[p],m=G.animationCache,this.JITCompile&&n[p][o]!==void 0){G instanceof c.Bone?(G.skinMatrix=n[p][o],G.matrixAutoUpdate=!1,G.matrixWorldNeedsUpdate=!1):(G.matrix=n[p][o],G.matrixAutoUpdate=!1,G.matrixWorldNeedsUpdate=!0)}else{if(this.JITCompile){G instanceof c.Bone?G.skinMatrix=G.animationCache.originalMatrix:G.matrix=G.animationCache.originalMatrix}for(var r=0;r<3;r++){I=a[r];f=m.prevKey[I];l=m.nextKey[I];if(l.time<=b){if(H<b){if(this.loop){f=this.data.hierarchy[p].keys[0];for(l=this.getNextKeyWith(I,p,1);l.time<H;){f=l,l=this.getNextKeyWith(I,p,l.index+1)}}else{this.stop();return}}else{do{f=l,l=this.getNextKeyWith(I,p,l.index+1)}while(l.time<H)}m.prevKey[I]=f;m.nextKey[I]=l}G.matrixAutoUpdate=!0;G.matrixWorldNeedsUpdate=!0;e=(H-f.time)/(l.time-f.time);k=f[I];g=l[I];if(e<0||e>1){console.log("THREE.Animation.update: Warning! Scale out of bounds:"+e+" on bone "+p),e=e<0?0:1}if(I==="pos"){if(I=G.position,this.interpolationType===c.AnimationHandler.LINEAR){I.x=k[0]+(g[0]-k[0])*e,I.y=k[1]+(g[1]-k[1])*e,I.z=k[2]+(g[2]-k[2])*e}else{if(this.interpolationType===c.AnimationHandler.CATMULLROM||this.interpolationType===c.AnimationHandler.CATMULLROM_FORWARD){if(this.points[0]=this.getPrevKeyWith("pos",p,f.index-1).pos,this.points[1]=k,this.points[2]=g,this.points[3]=this.getNextKeyWith("pos",p,l.index+1).pos,e=e*0.33+0.33,k=this.interpolateCatmullRom(this.points,e),I.x=k[0],I.y=k[1],I.z=k[2],this.interpolationType===c.AnimationHandler.CATMULLROM_FORWARD){e=this.interpolateCatmullRom(this.points,e*1.01),this.target.set(e[0],e[1],e[2]),this.target.subSelf(I),this.target.y=0,this.target.normalize(),e=Math.atan2(this.target.x,this.target.z),G.rotation.set(0,e,0)}}}}else{if(I==="rot"){c.Quaternion.slerp(k,g,G.quaternion,e)}else{if(I==="scl"){I=G.scale,I.x=k[0]+(g[0]-k[0])*e,I.y=k[1]+(g[1]-k[1])*e,I.z=k[2]+(g[2]-k[2])*e}}}}}}if(this.JITCompile&&n[0][o]===void 0){this.hierarchy[0].update(null,!0);for(p=0;p<this.hierarchy.length;p++){n[p][o]=this.hierarchy[p] instanceof c.Bone?this.hierarchy[p].skinMatrix.clone():this.hierarchy[p].matrix.clone()}}}};c.Animation.prototype.interpolateCatmullRom=function(v,a){var w=[],b=[],g,f,e,h,l,u;g=(v.length-1)*a;f=Math.floor(g);g-=f;w[0]=f===0?f:f-1;w[1]=f;w[2]=f>v.length-2?f:f+1;w[3]=f>v.length-3?f:f+2;f=v[w[0]];h=v[w[1]];l=v[w[2]];u=v[w[3]];w=g*g;e=g*w;b[0]=this.interpolate(f[0],h[0],l[0],u[0],g,w,e);b[1]=this.interpolate(f[1],h[1],l[1],u[1],g,w,e);b[2]=this.interpolate(f[2],h[2],l[2],u[2],g,w,e);return b};c.Animation.prototype.interpolate=function(g,p,o,a,f,e,b){g=(o-g)*0.5;a=(a-p)*0.5;return(2*(p-o)+g+a)*b+(-3*(p-o)-2*g-a)*e+g*f+p};c.Animation.prototype.getNextKeyWith=function(j,a,k){var b=this.data.hierarchy[a].keys;for(this.interpolationType===c.AnimationHandler.CATMULLROM||this.interpolationType===c.AnimationHandler.CATMULLROM_FORWARD?k=k<b.length-1?k:b.length-1:k%=b.length;k<b.length;k++){if(b[k][j]!==void 0){return b[k]}}return this.data.hierarchy[a].keys[0]};c.Animation.prototype.getPrevKeyWith=function(j,a,k){for(var b=this.data.hierarchy[a].keys,k=this.interpolationType===c.AnimationHandler.CATMULLROM||this.interpolationType===c.AnimationHandler.CATMULLROM_FORWARD?k>0?k:0:k>=0?k:k+b.length;k>=0;k--){if(b[k][j]!==void 0){return b[k]}}return this.data.hierarchy[a].keys[b.length-1]};c.CubeCamera=function(j,a,k,b){this.heightOffset=k;this.position=new c.Vector3(0,k,0);this.cameraPX=new c.PerspectiveCamera(90,1,j,a);this.cameraNX=new c.PerspectiveCamera(90,1,j,a);this.cameraPY=new c.PerspectiveCamera(90,1,j,a);this.cameraNY=new c.PerspectiveCamera(90,1,j,a);this.cameraPZ=new c.PerspectiveCamera(90,1,j,a);this.cameraNZ=new c.PerspectiveCamera(90,1,j,a);this.cameraPX.position=this.position;this.cameraNX.position=this.position;this.cameraPY.position=this.position;this.cameraNY.position=this.position;this.cameraPZ.position=this.position;this.cameraNZ.position=this.position;this.cameraPX.up.set(0,-1,0);this.cameraNX.up.set(0,-1,0);this.cameraPY.up.set(0,0,1);this.cameraNY.up.set(0,0,-1);this.cameraPZ.up.set(0,-1,0);this.cameraNZ.up.set(0,-1,0);this.targetPX=new c.Vector3(0,0,0);this.targetNX=new c.Vector3(0,0,0);this.targetPY=new c.Vector3(0,0,0);this.targetNY=new c.Vector3(0,0,0);this.targetPZ=new c.Vector3(0,0,0);this.targetNZ=new c.Vector3(0,0,0);this.renderTarget=new c.WebGLRenderTargetCube(b,b,{format:c.RGBFormat,magFilter:c.LinearFilter,minFilter:c.LinearFilter});this.updatePosition=function(e){this.position.copy(e);this.position.y+=this.heightOffset;this.targetPX.copy(this.position);this.targetNX.copy(this.position);this.targetPY.copy(this.position);this.targetNY.copy(this.position);this.targetPZ.copy(this.position);this.targetNZ.copy(this.position);this.targetPX.x+=1;this.targetNX.x-=1;this.targetPY.y+=1;this.targetNY.y-=1;this.targetPZ.z+=1;this.targetNZ.z-=1;this.cameraPX.lookAt(this.targetPX);this.cameraNX.lookAt(this.targetNX);this.cameraPY.lookAt(this.targetPY);this.cameraNY.lookAt(this.targetNY);this.cameraPZ.lookAt(this.targetPZ);this.cameraNZ.lookAt(this.targetNZ)};this.updateCubeMap=function(f,g){var e=this.renderTarget;e.activeCubeFace=0;f.render(g,this.cameraPX,e);e.activeCubeFace=1;f.render(g,this.cameraNX,e);e.activeCubeFace=2;f.render(g,this.cameraPY,e);e.activeCubeFace=3;f.render(g,this.cameraNY,e);e.activeCubeFace=4;f.render(g,this.cameraPZ,e);e.activeCubeFace=5;f.render(g,this.cameraNZ,e)}};c.FirstPersonCamera=function(){console.warn("DEPRECATED: FirstPersonCamera() is FirstPersonControls().")};c.PathCamera=function(){console.warn("DEPRECATED: PathCamera() is PathControls().")};c.FlyCamera=function(){console.warn("DEPRECATED: FlyCamera() is FlyControls().")};c.RollCamera=function(){console.warn("DEPRECATED: RollCamera() is RollControls().")};c.TrackballCamera=function(){console.warn("DEPRECATED: TrackballCamera() is TrackballControls().")};c.CombinedCamera=function(g,p,o,a,f,e,b){c.Camera.call(this);this.fov=o;this.left=-g/2;this.right=g/2;this.top=p/2;this.bottom=-p/2;this.cameraO=new c.OrthographicCamera(g/-2,g/2,p/2,p/-2,e,b);this.cameraP=new c.PerspectiveCamera(o,g/p,a,f);this.zoom=1;this.toPerspective()};c.CombinedCamera.prototype=new c.Camera;c.CombinedCamera.prototype.constructor=c.CoolCamera;c.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near;this.far=this.cameraP.far;this.cameraP.fov=this.fov/this.zoom;this.cameraP.updateProjectionMatrix();this.projectionMatrix=this.cameraP.projectionMatrix;this.inPersepectiveMode=!0;this.inOrthographicMode=!1};c.CombinedCamera.prototype.toOrthographic=function(){var b=Math.tan(this.fov/2)*((this.cameraP.near+this.cameraP.far)/2),a=2*b*this.cameraP.aspect/2;b/=this.zoom;a/=this.zoom;this.cameraO.left=-a;this.cameraO.right=a;this.cameraO.top=b;this.cameraO.bottom=-b;this.cameraO.updateProjectionMatrix();this.near=this.cameraO.near;this.far=this.cameraO.far;this.projectionMatrix=this.cameraO.projectionMatrix;this.inPersepectiveMode=!1;this.inOrthographicMode=!0};c.CombinedCamera.prototype.setFov=function(a){this.fov=a;this.inPersepectiveMode?this.toPerspective():this.toOrthographic()};c.CombinedCamera.prototype.setLens=function(b,a){a||(a=43.25);var g=2*Math.atan(a/(b*2));g*=180/Math.PI;this.setFov(g);return g};c.CombinedCamera.prototype.setZoom=function(a){this.zoom=a;this.inPersepectiveMode?this.toPerspective():this.toOrthographic()};c.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=!1};c.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0;this.rotation.y=Math.PI;this.rotation.z=0;this.rotationAutoUpdate=!1};c.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0;this.rotation.y=-Math.PI/2;this.rotation.z=0;this.rotationAutoUpdate=!1};c.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0;this.rotation.y=Math.PI/2;this.rotation.z=0;this.rotationAutoUpdate=!1};c.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=!1};c.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=!1};c.FirstPersonControls=function(b,a){function g(e,f){return function(){f.apply(e,arguments)}}this.object=b;this.target=new c.Vector3(0,0,0);this.domElement=a!==void 0?a:document;this.movementSpeed=1;this.lookSpeed=0.005;this.noFly=!1;this.lookVertical=!0;this.autoForward=!1;this.activeLook=!0;this.heightSpeed=!1;this.heightCoef=1;this.heightMin=0;this.constrainVertical=!1;this.verticalMin=0;this.verticalMax=Math.PI;this.theta=this.phi=this.lon=this.lat=this.mouseY=this.mouseX=this.autoSpeedFactor=0;this.mouseDragOn=this.freeze=this.moveRight=this.moveLeft=this.moveBackward=this.moveForward=!1;this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2,this.domElement.setAttribute("tabindex",-1));this.onMouseDown=function(e){this.domElement!==document&&this.domElement.focus();e.preventDefault();e.stopPropagation();if(this.activeLook){switch(e.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}}this.mouseDragOn=!0};this.onMouseUp=function(e){e.preventDefault();e.stopPropagation();if(this.activeLook){switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}}this.mouseDragOn=!1};this.onMouseMove=function(e){this.domElement===document?(this.mouseX=e.pageX-this.viewHalfX,this.mouseY=e.pageY-this.viewHalfY):(this.mouseX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=e.pageY-this.domElement.offsetTop-this.viewHalfY)};this.onKeyDown=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 82:this.moveUp=!0;break;case 70:this.moveDown=!0;break;case 81:this.freeze=!this.freeze}};this.onKeyUp=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1;break;case 82:this.moveUp=!1;break;case 70:this.moveDown=!1}};this.update=function(f){var j=0;if(!this.freeze){if(this.heightSpeed){var e=c.Math.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=f*e*this.heightCoef}else{this.autoSpeedFactor=0}j=f*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(j+this.autoSpeedFactor));this.moveBackward&&this.object.translateZ(j);this.moveLeft&&this.object.translateX(-j);this.moveRight&&this.object.translateX(j);this.moveUp&&this.object.translateY(j);this.moveDown&&this.object.translateY(-j);e=f*this.lookSpeed;this.activeLook||(e=0);this.lon+=this.mouseX*e;this.lookVertical&&(this.lat-=this.mouseY*e);this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=(90-this.lat)*Math.PI/180;this.theta=this.lon*Math.PI/180;f=this.target;j=this.object.position;f.x=j.x+100*Math.sin(this.phi)*Math.cos(this.theta);f.y=j.y+100*Math.cos(this.phi);f.z=j.z+100*Math.sin(this.phi)*Math.sin(this.theta)}f=1;this.constrainVertical&&(f=Math.PI/(this.verticalMax-this.verticalMin));this.lon+=this.mouseX*e;this.lookVertical&&(this.lat-=this.mouseY*e*f);this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=(90-this.lat)*Math.PI/180;this.theta=this.lon*Math.PI/180;if(this.constrainVertical){this.phi=c.Math.mapLinear(this.phi,0,Math.PI,this.verticalMin,this.verticalMax)}f=this.target;j=this.object.position;f.x=j.x+100*Math.sin(this.phi)*Math.cos(this.theta);f.y=j.y+100*Math.cos(this.phi);f.z=j.z+100*Math.sin(this.phi)*Math.sin(this.theta);this.object.lookAt(f)};this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1);this.domElement.addEventListener("mousemove",g(this,this.onMouseMove),!1);this.domElement.addEventListener("mousedown",g(this,this.onMouseDown),!1);this.domElement.addEventListener("mouseup",g(this,this.onMouseUp),!1);this.domElement.addEventListener("keydown",g(this,this.onKeyDown),!1);this.domElement.addEventListener("keyup",g(this,this.onKeyUp),!1)};c.PathControls=function(f,h){function g(j){if((j*=2)<1){return 0.5*j*j}return -0.5*(--j*(j-2)-1)}function q(j,k){return function(){k.apply(j,arguments)}}function b(l,m,n,o){var p={name:n,fps:0.6,length:o,hierarchy:[]},t,C=m.getControlPointsArray(),D=m.getLength(),j=C.length,k=0;t=j-1;m={parent:-1,keys:[]};m.keys[0]={time:0,pos:C[0],rot:[0,0,0,1],scl:[1,1,1]};m.keys[t]={time:o,pos:C[t],rot:[0,0,0,1],scl:[1,1,1]};for(t=1;t<j-1;t++){k=o*D.chunks[t]/D.total,m.keys[t]={time:k,pos:C[t]}}p.hierarchy[0]=m;c.AnimationHandler.add(p);return new c.Animation(l,n,c.AnimationHandler.CATMULLROM_FORWARD,!1)}function a(l,n){var k,m,j=new c.Geometry;for(k=0;k<l.points.length*n;k++){m=k/(l.points.length*n),m=l.getPoint(m),j.vertices[k]=new c.Vertex(new c.Vector3(m.x,m.y,m.z))}return j}this.object=f;this.domElement=h!==void 0?h:document;this.id="PathControls"+c.PathControlsIdCounter++;this.duration=10000;this.waypoints=[];this.useConstantSpeed=!0;this.resamplingCoef=50;this.debugPath=new c.Object3D;this.debugDummy=new c.Object3D;this.animationParent=new c.Object3D;this.lookSpeed=0.005;this.lookHorizontal=this.lookVertical=!0;this.verticalAngleMap={srcRange:[0,2*Math.PI],dstRange:[0,2*Math.PI]};this.horizontalAngleMap={srcRange:[0,2*Math.PI],dstRange:[0,2*Math.PI]};this.target=new c.Object3D;this.theta=this.phi=this.lon=this.lat=this.mouseY=this.mouseX=0;this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2,this.domElement.setAttribute("tabindex",-1));var r=Math.PI*2,e=Math.PI/180;this.update=function(l){var j;this.lookHorizontal&&(this.lon+=this.mouseX*this.lookSpeed*l);this.lookVertical&&(this.lat-=this.mouseY*this.lookSpeed*l);this.lon=Math.max(0,Math.min(360,this.lon));this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=(90-this.lat)*e;this.theta=this.lon*e;l=this.phi%r;this.phi=l>=0?l:l+r;j=this.verticalAngleMap.srcRange;l=this.verticalAngleMap.dstRange;j=c.Math.mapLinear(this.phi,j[0],j[1],l[0],l[1]);var k=l[1]-l[0];this.phi=g((j-l[0])/k)*k+l[0];j=this.horizontalAngleMap.srcRange;l=this.horizontalAngleMap.dstRange;j=c.Math.mapLinear(this.theta,j[0],j[1],l[0],l[1]);k=l[1]-l[0];this.theta=g((j-l[0])/k)*k+l[0];l=this.target.position;l.x=100*Math.sin(this.phi)*Math.cos(this.theta);l.y=100*Math.cos(this.phi);l.z=100*Math.sin(this.phi)*Math.sin(this.theta);this.object.lookAt(this.target.position)};this.onMouseMove=function(j){this.domElement===document?(this.mouseX=j.pageX-this.viewHalfX,this.mouseY=j.pageY-this.viewHalfY):(this.mouseX=j.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=j.pageY-this.domElement.offsetTop-this.viewHalfY)};this.init=function(){this.spline=new c.Spline;this.spline.initFromArray(this.waypoints);this.useConstantSpeed&&this.spline.reparametrizeByArcLength(this.resamplingCoef);if(this.createDebugDummy){var l=new c.MeshLambertMaterial({color:30719}),n=new c.MeshLambertMaterial({color:65280}),j=new c.CubeGeometry(10,10,20),k=new c.CubeGeometry(2,2,10);this.animationParent=new c.Mesh(j,l);l=new c.Mesh(k,n);l.position.set(0,10,0);this.animation=b(this.animationParent,this.spline,this.id,this.duration);this.animationParent.add(this.object);this.animationParent.add(this.target);this.animationParent.add(l)}else{this.animation=b(this.animationParent,this.spline,this.id,this.duration),this.animationParent.add(this.target),this.animationParent.add(this.object)}if(this.createDebugPath){var l=this.debugPath,n=this.spline,k=a(n,10),j=a(n,10),m=new c.LineBasicMaterial({color:16711680,linewidth:3}),k=new c.Line(k,m),j=new c.ParticleSystem(j,new c.ParticleBasicMaterial({color:16755200,size:3}));k.scale.set(1,1,1);l.add(k);j.scale.set(1,1,1);l.add(j);for(var k=new c.SphereGeometry(1,16,8),m=new c.MeshBasicMaterial({color:65280}),o=0;o<n.points.length;o++){j=new c.Mesh(k,m),j.position.copy(n.points[o]),l.add(j)}}this.domElement.addEventListener("mousemove",q(this,this.onMouseMove),!1)}};c.PathControlsIdCounter=0;c.FlyControls=function(b,a){function g(e,f){return function(){f.apply(e,arguments)}}this.object=b;this.domElement=a!==void 0?a:document;a&&this.domElement.setAttribute("tabindex",-1);this.movementSpeed=1;this.rollSpeed=0.005;this.autoForward=this.dragToLook=!1;this.object.useQuaternion=!0;this.tmpQuaternion=new c.Quaternion;this.mouseStatus=0;this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0};this.moveVector=new c.Vector3(0,0,0);this.rotationVector=new c.Vector3(0,0,0);this.handleEvent=function(e){if(typeof this[e.type]=="function"){this[e.type](e)}};this.keydown=function(e){if(!e.altKey){switch(e.keyCode){case 16:this.movementSpeedMultiplier=0.1;break;case 87:this.moveState.forward=1;break;case 83:this.moveState.back=1;break;case 65:this.moveState.left=1;break;case 68:this.moveState.right=1;break;case 82:this.moveState.up=1;break;case 70:this.moveState.down=1;break;case 38:this.moveState.pitchUp=1;break;case 40:this.moveState.pitchDown=1;break;case 37:this.moveState.yawLeft=1;break;case 39:this.moveState.yawRight=1;break;case 81:this.moveState.rollLeft=1;break;case 69:this.moveState.rollRight=1}this.updateMovementVector();this.updateRotationVector()}};this.keyup=function(e){switch(e.keyCode){case 16:this.movementSpeedMultiplier=1;break;case 87:this.moveState.forward=0;break;case 83:this.moveState.back=0;break;case 65:this.moveState.left=0;break;case 68:this.moveState.right=0;break;case 82:this.moveState.up=0;break;case 70:this.moveState.down=0;break;case 38:this.moveState.pitchUp=0;break;case 40:this.moveState.pitchDown=0;break;case 37:this.moveState.yawLeft=0;break;case 39:this.moveState.yawRight=0;break;case 81:this.moveState.rollLeft=0;break;case 69:this.moveState.rollRight=0}this.updateMovementVector();this.updateRotationVector()};this.mousedown=function(e){this.domElement!==document&&this.domElement.focus();e.preventDefault();e.stopPropagation();if(this.dragToLook){this.mouseStatus++}else{switch(e.button){case 0:this.object.moveForward=!0;break;case 2:this.object.moveBackward=!0}}};this.mousemove=function(k){if(!this.dragToLook||this.mouseStatus>0){var l=this.getContainerDimensions(),e=l.size[0]/2,f=l.size[1]/2;this.moveState.yawLeft=-(k.pageX-l.offset[0]-e)/e;this.moveState.pitchDown=(k.pageY-l.offset[1]-f)/f;this.updateRotationVector()}};this.mouseup=function(e){e.preventDefault();e.stopPropagation();if(this.dragToLook){this.mouseStatus--,this.moveState.yawLeft=this.moveState.pitchDown=0}else{switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}}this.updateRotationVector()};this.update=function(e){var f=e*this.movementSpeed;e*=this.rollSpeed;this.object.translateX(this.moveVector.x*f);this.object.translateY(this.moveVector.y*f);this.object.translateZ(this.moveVector.z*f);this.tmpQuaternion.set(this.rotationVector.x*e,this.rotationVector.y*e,this.rotationVector.z*e,1).normalize();this.object.quaternion.multiplySelf(this.tmpQuaternion);this.object.matrix.setPosition(this.object.position);this.object.matrix.setRotationFromQuaternion(this.object.quaternion);this.object.matrixWorldNeedsUpdate=!0};this.updateMovementVector=function(){var e=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right;this.moveVector.y=-this.moveState.down+this.moveState.up;this.moveVector.z=-e+this.moveState.back};this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp;this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft;this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft};this.getContainerDimensions=function(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}};this.domElement.addEventListener("mousemove",g(this,this.mousemove),!1);this.domElement.addEventListener("mousedown",g(this,this.mousedown),!1);this.domElement.addEventListener("mouseup",g(this,this.mouseup),!1);this.domElement.addEventListener("keydown",g(this,this.keydown),!1);this.domElement.addEventListener("keyup",g(this,this.keyup),!1);this.updateMovementVector();this.updateRotationVector()};c.RollControls=function(a,f){this.object=a;this.domElement=f!==void 0?f:document;this.mouseLook=!0;this.autoForward=!1;this.rollSpeed=this.movementSpeed=this.lookSpeed=1;this.constrainVertical=[-0.9,0.9];this.object.matrixAutoUpdate=!1;this.forward=new c.Vector3(0,0,1);this.roll=0;var e=new c.Vector3,g=new c.Vector3,o=new c.Vector3,m=new c.Matrix4,l=!1,p=1,r=0,F=0,E=0,b=0,h=0,G=window.innerWidth/2,k=window.innerHeight/2;this.update=function(n){if(this.mouseLook){var j=n*this.lookSpeed;this.rotateHorizontally(j*b);this.rotateVertically(j*h)}j=n*this.movementSpeed;this.object.translateZ(-j*(r>0||this.autoForward&&!(r<0)?1:r));this.object.translateX(j*F);this.object.translateY(j*E);l&&(this.roll+=this.rollSpeed*n*p);if(this.forward.y>this.constrainVertical[1]){this.forward.y=this.constrainVertical[1],this.forward.normalize()}else{if(this.forward.y<this.constrainVertical[0]){this.forward.y=this.constrainVertical[0],this.forward.normalize()}}o.copy(this.forward);g.set(0,1,0);e.cross(g,o).normalize();g.cross(o,e).normalize();this.object.matrix.n11=e.x;this.object.matrix.n12=g.x;this.object.matrix.n13=o.x;this.object.matrix.n21=e.y;this.object.matrix.n22=g.y;this.object.matrix.n23=o.y;this.object.matrix.n31=e.z;this.object.matrix.n32=g.z;this.object.matrix.n33=o.z;m.identity();m.n11=Math.cos(this.roll);m.n12=-Math.sin(this.roll);m.n21=Math.sin(this.roll);m.n22=Math.cos(this.roll);this.object.matrix.multiplySelf(m);this.object.matrixWorldNeedsUpdate=!0;this.object.matrix.n14=this.object.position.x;this.object.matrix.n24=this.object.position.y;this.object.matrix.n34=this.object.position.z};this.translateX=function(j){this.object.position.x+=this.object.matrix.n11*j;this.object.position.y+=this.object.matrix.n21*j;this.object.position.z+=this.object.matrix.n31*j};this.translateY=function(j){this.object.position.x+=this.object.matrix.n12*j;this.object.position.y+=this.object.matrix.n22*j;this.object.position.z+=this.object.matrix.n32*j};this.translateZ=function(j){this.object.position.x-=this.object.matrix.n13*j;this.object.position.y-=this.object.matrix.n23*j;this.object.position.z-=this.object.matrix.n33*j};this.rotateHorizontally=function(j){e.set(this.object.matrix.n11,this.object.matrix.n21,this.object.matrix.n31);e.multiplyScalar(j);this.forward.subSelf(e);this.forward.normalize()};this.rotateVertically=function(j){g.set(this.object.matrix.n12,this.object.matrix.n22,this.object.matrix.n32);g.multiplyScalar(j);this.forward.addSelf(g);this.forward.normalize()};this.domElement.addEventListener("contextmenu",function(j){j.preventDefault()},!1);this.domElement.addEventListener("mousemove",function(j){b=(j.clientX-G)/window.innerWidth;h=(j.clientY-k)/window.innerHeight},!1);this.domElement.addEventListener("mousedown",function(j){j.preventDefault();j.stopPropagation();switch(j.button){case 0:r=1;break;case 2:r=-1}},!1);this.domElement.addEventListener("mouseup",function(j){j.preventDefault();j.stopPropagation();switch(j.button){case 0:r=0;break;case 2:r=0}},!1);this.domElement.addEventListener("keydown",function(j){switch(j.keyCode){case 38:case 87:r=1;break;case 37:case 65:F=-1;break;case 40:case 83:r=-1;break;case 39:case 68:F=1;break;case 81:l=!0;p=1;break;case 69:l=!0;p=-1;break;case 82:E=1;break;case 70:E=-1}},!1);this.domElement.addEventListener("keyup",function(j){switch(j.keyCode){case 38:case 87:r=0;break;case 37:case 65:F=0;break;case 40:case 83:r=0;break;case 39:case 68:F=0;break;case 81:l=!1;break;case 69:l=!1;break;case 82:E=0;break;case 70:E=0}},!1)};c.TrackballControls=function(h,l){var k=this,o={NONE:-1,ROTATE:0,ZOOM:1,PAN:2};this.object=h;this.domElement=l!==void 0?l:document;this.enabled=!0;this.screen={width:window.innerWidth,height:window.innerHeight,offsetLeft:0,offsetTop:0};this.radius=(this.screen.width+this.screen.height)/4;this.rotateSpeed=1;this.zoomSpeed=1.2;this.panSpeed=0.3;this.staticMoving=this.noPan=this.noZoom=this.noRotate=!1;this.dynamicDampingFactor=0.2;this.minDistance=0;this.maxDistance=Infinity;this.keys=[65,83,68];this.target=new c.Vector3(0,0,0);var B=!1,A=o.NONE,p=new c.Vector3,C=new c.Vector3,a=new c.Vector3,e=new c.Vector2,b=new c.Vector2,f=new c.Vector2,g=new c.Vector2;this.handleEvent=function(j){if(typeof this[j.type]=="function"){this[j.type](j)}};this.getMouseOnScreen=function(m,j){return new c.Vector2((m-k.screen.offsetLeft)/k.radius*0.5,(j-k.screen.offsetTop)/k.radius*0.5)};this.getMouseProjectionOnBall=function(q,j){var m=new c.Vector3((q-k.screen.width*0.5-k.screen.offsetLeft)/k.radius,(k.screen.height*0.5+k.screen.offsetTop-j)/k.radius,0),n=m.length();n>1?m.normalize():m.z=Math.sqrt(1-n*n);p.copy(k.object.position).subSelf(k.target);n=k.object.up.clone().setLength(m.y);n.addSelf(k.object.up.clone().crossSelf(p).setLength(m.x));n.addSelf(p.setLength(m.z));return n};this.rotateCamera=function(){var n=Math.acos(C.dot(a)/C.length()/a.length());if(n){var j=(new c.Vector3).cross(C,a).normalize(),m=new c.Quaternion;n*=k.rotateSpeed;m.setFromAxisAngle(j,-n);m.multiplyVector3(p);m.multiplyVector3(k.object.up);m.multiplyVector3(a);k.staticMoving?C=a:(m.setFromAxisAngle(j,n*(k.dynamicDampingFactor-1)),m.multiplyVector3(C))}};this.zoomCamera=function(){var j=1+(b.y-e.y)*k.zoomSpeed;j!==1&&j>0&&(p.multiplyScalar(j),k.staticMoving?e=b:e.y+=(b.y-e.y)*this.dynamicDampingFactor)};this.panCamera=function(){var m=g.clone().subSelf(f);if(m.lengthSq()){m.multiplyScalar(p.length()*k.panSpeed);var j=p.clone().crossSelf(k.object.up).setLength(m.x);j.addSelf(k.object.up.clone().setLength(m.y));k.object.position.addSelf(j);k.target.addSelf(j);k.staticMoving?f=g:f.addSelf(m.sub(g,f).multiplyScalar(k.dynamicDampingFactor))}};this.checkDistances=function(){if(!k.noZoom||!k.noPan){k.object.position.lengthSq()>k.maxDistance*k.maxDistance&&k.object.position.setLength(k.maxDistance),p.lengthSq()<k.minDistance*k.minDistance&&k.object.position.add(k.target,p.setLength(k.minDistance))}};this.update=function(){p.copy(k.object.position).subSelf(this.target);k.noRotate||k.rotateCamera();k.noZoom||k.zoomCamera();k.noPan||k.panCamera();k.object.position.add(k.target,p);k.checkDistances();k.object.lookAt(k.target)};this.domElement.addEventListener("contextmenu",function(j){j.preventDefault()},!1);this.domElement.addEventListener("mousemove",function(j){k.enabled&&(B&&(C=a=k.getMouseProjectionOnBall(j.clientX,j.clientY),e=b=k.getMouseOnScreen(j.clientX,j.clientY),f=g=k.getMouseOnScreen(j.clientX,j.clientY),B=!1),A!==o.NONE&&(A===o.ROTATE&&!k.noRotate?a=k.getMouseProjectionOnBall(j.clientX,j.clientY):A===o.ZOOM&&!k.noZoom?b=k.getMouseOnScreen(j.clientX,j.clientY):A===o.PAN&&!k.noPan&&(g=k.getMouseOnScreen(j.clientX,j.clientY))))},!1);this.domElement.addEventListener("mousedown",function(j){if(k.enabled&&(j.preventDefault(),j.stopPropagation(),A===o.NONE)){A=j.button,A===o.ROTATE&&!k.noRotate?C=a=k.getMouseProjectionOnBall(j.clientX,j.clientY):A===o.ZOOM&&!k.noZoom?e=b=k.getMouseOnScreen(j.clientX,j.clientY):this.noPan||(f=g=k.getMouseOnScreen(j.clientX,j.clientY))}},!1);this.domElement.addEventListener("mouseup",function(j){if(k.enabled){j.preventDefault(),j.stopPropagation(),A=o.NONE}},!1);window.addEventListener("keydown",function(j){if(k.enabled&&A===o.NONE){if(j.keyCode===k.keys[o.ROTATE]&&!k.noRotate){A=o.ROTATE}else{if(j.keyCode===k.keys[o.ZOOM]&&!k.noZoom){A=o.ZOOM}else{if(j.keyCode===k.keys[o.PAN]&&!k.noPan){A=o.PAN}}}A!==o.NONE&&(B=!0)}},!1);window.addEventListener("keyup",function(){if(k.enabled&&A!==o.NONE){A=o.NONE}},!1)};c.CubeGeometry=function(a,e,b,f,n,l,h,p){function q(J,K,L,M,N,j,s,v){var x,y=f||1,z=n||1,A=N/2,B=j/2,C=u.vertices.length;if(J==="x"&&K==="y"||J==="y"&&K==="x"){x="z"}else{if(J==="x"&&K==="z"||J==="z"&&K==="x"){x="y",z=l||1}else{if(J==="z"&&K==="y"||J==="y"&&K==="z"){x="x",y=l||1}}}var D=y+1,F=z+1,E=N/y,G=j/z,H=new c.Vector3;H[x]=s>0?1:-1;for(N=0;N<F;N++){for(j=0;j<D;j++){var I=new c.Vector3;I[J]=(j*E-A)*L;I[K]=(N*G-B)*M;I[x]=s;u.vertices.push(new c.Vertex(I))}}for(N=0;N<z;N++){for(j=0;j<y;j++){J=new c.Face4(j+D*N+C,j+D*(N+1)+C,j+1+D*(N+1)+C,j+1+D*N+C),J.normal.copy(H),J.vertexNormals.push(H.clone(),H.clone(),H.clone(),H.clone()),J.materialIndex=v,u.faces.push(J),u.faceVertexUvs[0].push([new c.UV(j/y,N/z),new c.UV(j/y,(N+1)/z),new c.UV((j+1)/y,(N+1)/z),new c.UV((j+1)/y,N/z)])}}}c.Geometry.call(this);var u=this,r=a/2,P=e/2,g=b/2,w,m,O,k,o,Q;if(h!==void 0){if(h instanceof Array){this.materials=h}else{this.materials=[];for(w=0;w<6;w++){this.materials.push(h)}}w=0;k=1;m=2;o=3;O=4;Q=5}else{this.materials=[]}this.sides={px:!0,nx:!0,py:!0,ny:!0,pz:!0,nz:!0};if(p!=void 0){for(var t in p){this.sides[t]!=void 0&&(this.sides[t]=p[t])}}this.sides.px&&q("z","y",-1,-1,b,e,r,w);this.sides.nx&&q("z","y",1,-1,b,e,-r,k);this.sides.py&&q("x","z",1,1,a,b,P,m);this.sides.ny&&q("x","z",1,-1,a,b,-P,o);this.sides.pz&&q("x","y",1,-1,a,e,g,O);this.sides.nz&&q("x","y",-1,-1,a,e,-g,Q);this.computeCentroids();this.mergeVertices()};c.CubeGeometry.prototype=new c.Geometry;c.CubeGeometry.prototype.constructor=c.CubeGeometry;c.CylinderGeometry=function(a,e,b,f,k,h){c.Geometry.call(this);var a=a!=null?a:20,e=e!=null?e:20,b=b||100,g=b/2,f=f||8,k=k||1,m,n,r=[],q=[];for(n=0;n<=k;n++){var F=[],S=[],u=n/k,o=u*(e-a)+a;for(m=0;m<=f;m++){var w=m/f;this.vertices.push(new c.Vertex(new c.Vector3(o*Math.sin(w*Math.PI*2),-u*b+g,o*Math.cos(w*Math.PI*2))));F.push(this.vertices.length-1);S.push(new c.UV(w,u))}r.push(F);q.push(S)}for(n=0;n<k;n++){for(m=0;m<f;m++){var b=r[n][m],F=r[n+1][m],S=r[n+1][m+1],u=r[n][m+1],o=this.vertices[b].position.clone().setY(0).normalize(),w=this.vertices[F].position.clone().setY(0).normalize(),T=this.vertices[S].position.clone().setY(0).normalize(),p=this.vertices[u].position.clone().setY(0).normalize(),U=q[n][m].clone(),t=q[n+1][m].clone(),l=q[n+1][m+1].clone(),B=q[n][m+1].clone();this.faces.push(new c.Face4(b,F,S,u,[o,w,T,p]));this.faceVertexUvs[0].push([U,t,l,B])}}if(!h&&a>0){this.vertices.push(new c.Vertex(new c.Vector3(0,g,0)));for(m=0;m<f;m++){b=r[0][m],F=r[0][m+1],S=this.vertices.length-1,o=new c.Vector3(0,1,0),w=new c.Vector3(0,1,0),T=new c.Vector3(0,1,0),U=q[0][m].clone(),t=q[0][m+1].clone(),l=new c.UV(t.u,0),this.faces.push(new c.Face3(b,F,S,[o,w,T])),this.faceVertexUvs[0].push([U,t,l])}}if(!h&&e>0){this.vertices.push(new c.Vertex(new c.Vector3(0,-g,0)));for(m=0;m<f;m++){b=r[n][m+1],F=r[n][m],S=this.vertices.length-1,o=new c.Vector3(0,-1,0),w=new c.Vector3(0,-1,0),T=new c.Vector3(0,-1,0),U=q[n][m+1].clone(),t=q[n][m].clone(),l=new c.UV(t.u,1),this.faces.push(new c.Face3(b,F,S,[o,w,T])),this.faceVertexUvs[0].push([U,t,l])}}this.computeCentroids();this.computeFaceNormals()};c.CylinderGeometry.prototype=new c.Geometry;c.CylinderGeometry.prototype.constructor=c.CylinderGeometry;c.ExtrudeGeometry=function(k,a){if(typeof k!=="undefined"){c.Geometry.call(this);var k=k instanceof Array?k:[k],l,b=k.length,g;this.shapebb=k[b-1].getBoundingBox();for(l=0;l<b;l++){g=k[l],this.addShape(g,a)}this.computeCentroids();this.computeFaceNormals()}};c.ExtrudeGeometry.prototype=new c.Geometry;c.ExtrudeGeometry.prototype.constructor=c.ExtrudeGeometry;c.ExtrudeGeometry.prototype.addShape=function(U,aa){function W(z,C,j){C||console.log("die");return C.clone().multiplyScalar(j).addSelf(z)}function ab(V,j,z){var C=c.ExtrudeGeometry.__v1,D=c.ExtrudeGeometry.__v2,L=c.ExtrudeGeometry.__v3,N=c.ExtrudeGeometry.__v4,Q=c.ExtrudeGeometry.__v5,T=c.ExtrudeGeometry.__v6;C.set(V.x-j.x,V.y-j.y);D.set(V.x-z.x,V.y-z.y);C=C.normalize();D=D.normalize();L.set(-C.y,C.x);N.set(D.y,-D.x);Q.copy(V).addSelf(L);T.copy(V).addSelf(N);if(Q.equals(T)){return N.clone()}Q.copy(j).addSelf(L);T.copy(z).addSelf(N);L=C.dot(N);N=T.subSelf(Q).dot(N);L===0&&(console.log("Either infinite or no solutions!"),N===0?console.log("Its finite solutions."):console.log("Too bad, no solutions."));N/=L;if(N<0){return j=Math.atan2(j.y-V.y,j.x-V.x),V=Math.atan2(z.y-V.y,z.x-V.x),j>V&&(V+=Math.PI*2),V=(j+V)/2,new c.Vector2(-Math.cos(V),-Math.sin(V))}return C.multiplyScalar(N).addSelf(Q).subSelf(V).clone()}function g(V){for(x=V.length;--x>=0;){M=x;S=x-1;S<0&&(S=V.length-1);for(var j=0,z=p+m*2,j=0;j<z;j++){var C=v*j,D=v*(j+1),L=ae+M+C,N=ae+M+D,Q=L,C=ae+S+C,D=ae+S+D,T=N;Q+=l;C+=l;D+=l;T+=l;E.faces.push(new c.Face4(Q,C,D,T,null,null,O));O&&(Q=j/z,C=(j+1)/z,D=h+k*2,L=(E.vertices[L].position.z+k)/D,N=(E.vertices[N].position.z+k)/D,E.faceVertexUvs[0].push([new c.UV(L,Q),new c.UV(N,Q),new c.UV(N,C),new c.UV(L,C)]))}}}function e(z,C,j){E.vertices.push(new c.Vertex(new c.Vector3(z,C,j)))}function ac(D,L,N){D+=l;L+=l;N+=l;E.faces.push(new c.Face3(D,L,N,null,null,B));if(B){var Q=R.maxY,j=R.maxX,z=E.vertices[L].position.x,L=E.vertices[L].position.y,C=E.vertices[N].position.x,N=E.vertices[N].position.y;E.faceVertexUvs[0].push([new c.UV(E.vertices[D].position.x/j,E.vertices[D].position.y/Q),new c.UV(z/j,L/Q),new c.UV(C/j,N/Q)])}}var h=aa.amount!==void 0?aa.amount:100,k=aa.bevelThickness!==void 0?aa.bevelThickness:6,n=aa.bevelSize!==void 0?aa.bevelSize:k-2,m=aa.bevelSegments!==void 0?aa.bevelSegments:3,s=aa.bevelEnabled!==void 0?aa.bevelEnabled:!0,t=aa.curveSegments!==void 0?aa.curveSegments:12,p=aa.steps!==void 0?aa.steps:1,w=aa.bendPath,r=aa.extrudePath,u,A=!1,F=aa.useSpacedPoints!==void 0?aa.useSpacedPoints:!1,B=aa.material,O=aa.extrudeMaterial,R=this.shapebb;if(r){u=r.getPoints(t),p=u.length,A=!0,s=!1}s||(n=k=m=0);var J,G,H,E=this,l=this.vertices.length;w&&U.addWrapPath(w);t=F?U.extractAllSpacedPoints(t):U.extractAllPoints(t);w=t.shape;t=t.holes;if(r=!c.Shape.Utils.isClockWise(w)){w=w.reverse();G=0;for(H=t.length;G<H;G++){J=t[G],c.Shape.Utils.isClockWise(J)&&(t[G]=J.reverse())}r=!1}r=c.Shape.Utils.triangulateShape(w,t);F=w;G=0;for(H=t.length;G<H;G++){J=t[G],w=w.concat(J)}var x,P,K,ad,o,y,v=w.length,I=r.length,b=[];x=0;P=F.length;M=P-1;for(S=x+1;x<P;x++,M++,S++){M===P&&(M=0),S===P&&(S=0),b[x]=ab(F[x],F[M],F[S])}var a=[],f,q=b.concat();G=0;for(H=t.length;G<H;G++){J=t[G];f=[];x=0;P=J.length;M=P-1;for(S=x+1;x<P;x++,M++,S++){M===P&&(M=0),S===P&&(S=0),f[x]=ab(J[x],J[M],J[S])}a.push(f);q=q.concat(f)}for(K=0;K<m;K++){ad=K/m;o=k*(1-ad);ad=n*Math.sin(ad*Math.PI/2);x=0;for(P=F.length;x<P;x++){y=W(F[x],b[x],ad),e(y.x,y.y,-o)}G=0;for(H=t.length;G<H;G++){J=t[G];f=a[G];x=0;for(P=J.length;x<P;x++){y=W(J[x],f[x],ad),e(y.x,y.y,-o)}}}ad=n;for(x=0;x<v;x++){y=s?W(w[x],q[x],ad):w[x],A?e(y.x,y.y+u[0].y,u[0].x):e(y.x,y.y,0)}for(K=1;K<=p;K++){for(x=0;x<v;x++){y=s?W(w[x],q[x],ad):w[x],A?e(y.x,y.y+u[K-1].y,u[K-1].x):e(y.x,y.y,h/p*K)}}for(K=m-1;K>=0;K--){ad=K/m;o=k*(1-ad);ad=n*Math.sin(ad*Math.PI/2);x=0;for(P=F.length;x<P;x++){y=W(F[x],b[x],ad),e(y.x,y.y,h+o)}G=0;for(H=t.length;G<H;G++){J=t[G];f=a[G];x=0;for(P=J.length;x<P;x++){y=W(J[x],f[x],ad),A?e(y.x,y.y+u[p-1].y,u[p-1].x+o):e(y.x,y.y,h+o)}}}if(s){s=v*0;for(x=0;x<I;x++){n=r[x],ac(n[2]+s,n[1]+s,n[0]+s)}s=v*(p+m*2);for(x=0;x<I;x++){n=r[x],ac(n[0]+s,n[1]+s,n[2]+s)}}else{for(x=0;x<I;x++){n=r[x],ac(n[2],n[1],n[0])}for(x=0;x<I;x++){n=r[x],ac(n[0]+v*p,n[1]+v*p,n[2]+v*p)}}var M,S,ae=0;g(F);ae+=F.length;G=0;for(H=t.length;G<H;G++){J=t[G],g(J),ae+=J.length}};c.ExtrudeGeometry.__v1=new c.Vector2;c.ExtrudeGeometry.__v2=new c.Vector2;c.ExtrudeGeometry.__v3=new c.Vector2;c.ExtrudeGeometry.__v4=new c.Vector2;c.ExtrudeGeometry.__v5=new c.Vector2;c.ExtrudeGeometry.__v6=new c.Vector2;c.IcosahedronGeometry=function(l){function x(n,o,j){var m=Math.sqrt(n*n+o*o+j*j);return e.vertices.push(new c.Vertex(new c.Vector3(n/m,o/m,j/m)))-1}function w(p,q,r,j){var n=e.vertices[p].position,m=e.vertices[q].position,o=e.vertices[r].position,p=new c.Face3(p,q,r);p.vertexNormals.push(n.clone().normalize(),m.clone().normalize(),o.clone().normalize());j.faces.push(p);j.faceVertexUvs[0].push([new c.UV(1-(Math.atan2(n.z,n.x)+Math.PI)%Math.PI/Math.PI*0.5,0.5-n.y/2),new c.UV(1-(Math.atan2(m.z,m.x)+Math.PI)%Math.PI/Math.PI*0.5,0.5-m.y/2),new c.UV(1-(Math.atan2(o.z,o.x)+Math.PI)%Math.PI/Math.PI*0.5,0.5-o.y/2)])}function y(n,o){var j=e.vertices[n].position,m=e.vertices[o].position;return x((j.x+m.x)/2,(j.y+m.y)/2,(j.z+m.z)/2)}var e=this,b=new c.Geometry;this.subdivisions=l||0;c.Geometry.call(this);l=(1+Math.sqrt(5))/2;x(-1,l,0);x(1,l,0);x(-1,-l,0);x(1,-l,0);x(0,-1,l);x(0,1,l);x(0,-1,-l);x(0,1,-l);x(l,0,-1);x(l,0,1);x(-l,0,-1);x(-l,0,1);w(0,11,5,b);w(0,5,1,b);w(0,1,7,b);w(0,7,10,b);w(0,10,11,b);w(1,5,9,b);w(5,11,4,b);w(11,10,2,b);w(10,7,6,b);w(7,1,8,b);w(3,9,4,b);w(3,4,2,b);w(3,2,6,b);w(3,6,8,b);w(3,8,9,b);w(4,9,5,b);w(2,4,11,b);w(6,2,10,b);w(8,6,7,b);w(9,8,1,b);for(var a=0;a<this.subdivisions;a++){var l=new c.Geometry,f;for(f in b.faces){var g=y(b.faces[f].a,b.faces[f].b),k=y(b.faces[f].b,b.faces[f].c),h=y(b.faces[f].c,b.faces[f].a);w(b.faces[f].a,g,h,l);w(b.faces[f].b,k,g,l);w(b.faces[f].c,h,k,l);w(g,k,h,l)}b.faces=l.faces;b.faceVertexUvs[0]=l.faceVertexUvs[0]}e.faces=b.faces;e.faceVertexUvs[0]=b.faceVertexUvs[0];this.computeCentroids();this.computeFaceNormals()};c.IcosahedronGeometry.prototype=new c.Geometry;c.IcosahedronGeometry.prototype.constructor=c.IcosahedronGeometry;c.LatheGeometry=function(a,e,b){c.Geometry.call(this);this.steps=e||12;this.angle=b||2*Math.PI;for(var e=this.angle/this.steps,b=[],f=[],s=[],h=[],g=(new c.Matrix4).setRotationZ(e),t=0;t<a.length;t++){this.vertices.push(new c.Vertex(a[t])),b[t]=a[t].clone(),f[t]=this.vertices.length-1}for(var u=0;u<=this.angle+0.001;u+=e){for(t=0;t<b.length;t++){u<this.angle?(b[t]=g.multiplyVector3(b[t].clone()),this.vertices.push(new c.Vertex(b[t])),s[t]=this.vertices.length-1):s=h}u==0&&(h=f);for(t=0;t<f.length-1;t++){this.faces.push(new c.Face4(s[t],s[t+1],f[t+1],f[t])),this.faceVertexUvs[0].push([new c.UV(1-u/this.angle,t/a.length),new c.UV(1-u/this.angle,(t+1)/a.length),new c.UV(1-(u-e)/this.angle,(t+1)/a.length),new c.UV(1-(u-e)/this.angle,t/a.length)])}f=s;s=[]}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};c.LatheGeometry.prototype=new c.Geometry;c.LatheGeometry.prototype.constructor=c.LatheGeometry;c.OctahedronGeometry=function(a,e){function b(k){var j=k.clone().normalize(),j=new c.Vertex(j.clone().multiplyScalar(a));j.index=g.vertices.push(j)-1;j.uv=new c.UV(Math.atan2(k.z,-k.x)/2/Math.PI+0.5,Math.atan2(-k.y,Math.sqrt(k.x*k.x+k.z*k.z))/Math.PI+0.5);return j}function f(l,m,j,k){k<1?(k=new c.Face3(l.index,m.index,j.index,[l.position,m.position,j.position]),k.centroid.addSelf(l.position).addSelf(m.position).addSelf(j.position).divideScalar(3),k.normal=k.centroid.clone().normalize(),g.faces.push(k),k=Math.atan2(k.centroid.z,-k.centroid.x),g.faceVertexUvs[0].push([h(l.uv,l.position,k),h(m.uv,m.position,k),h(j.uv,j.position,k)])):(k-=1,f(l,s(l,m),s(l,j),k),f(s(l,m),m,s(m,j),k),f(s(l,j),s(m,j),j,k),f(s(l,m),s(m,j),s(l,j),k))}function s(l,j){t[l.index]||(t[l.index]=[]);t[j.index]||(t[j.index]=[]);var k=t[l.index][j.index];k===void 0&&(t[l.index][j.index]=t[j.index][l.index]=k=b((new c.Vector3).add(l.position,j.position).divideScalar(2)));return k}function h(k,l,j){j<0&&k.u===1&&(k=new c.UV(k.u-1,k.v));l.x===0&&l.z===0&&(k=new c.UV(j/2/Math.PI+0.5,k.v));return k}c.Geometry.call(this);var e=e||0,g=this;b(new c.Vector3(1,0,0));b(new c.Vector3(-1,0,0));b(new c.Vector3(0,1,0));b(new c.Vector3(0,-1,0));b(new c.Vector3(0,0,1));b(new c.Vector3(0,0,-1));var t=[],u=this.vertices;f(u[0],u[2],u[4],e);f(u[0],u[4],u[3],e);f(u[0],u[3],u[5],e);f(u[0],u[5],u[2],e);f(u[1],u[2],u[5],e);f(u[1],u[5],u[3],e);f(u[1],u[3],u[4],e);f(u[1],u[4],u[2],e);this.boundingSphere={radius:a}};c.OctahedronGeometry.prototype=new c.Geometry;c.OctahedronGeometry.prototype.constructor=c.OctahedronGeometry;c.PlaneGeometry=function(l,x,w,y){c.Geometry.call(this);for(var e=l/2,b=x/2,w=w||1,y=y||1,a=w+1,f=y+1,g=l/w,k=x/y,h=new c.Vector3(0,0,1),l=0;l<f;l++){for(x=0;x<a;x++){this.vertices.push(new c.Vertex(new c.Vector3(x*g-e,-(l*k-b),0)))}}for(l=0;l<y;l++){for(x=0;x<w;x++){e=new c.Face4(x+a*l,x+a*(l+1),x+1+a*(l+1),x+1+a*l),e.normal.copy(h),e.vertexNormals.push(h.clone(),h.clone(),h.clone(),h.clone()),this.faces.push(e),this.faceVertexUvs[0].push([new c.UV(x/w,l/y),new c.UV(x/w,(l+1)/y),new c.UV((x+1)/w,(l+1)/y),new c.UV((x+1)/w,l/y)])}}this.computeCentroids()};c.PlaneGeometry.prototype=new c.Geometry;c.PlaneGeometry.prototype.constructor=c.PlaneGeometry;c.SphereGeometry=function(a,f,b,h,o,m,l){c.Geometry.call(this);var a=a||50,f=Math.max(3,Math.floor(f)||8),b=Math.max(2,Math.floor(b)||6),h=h!=void 0?h:0,o=o!=void 0?o:Math.PI*2,m=m!=void 0?m:0,l=l!=void 0?l:Math.PI,q,t,M=[],w=[];for(t=0;t<=b;t++){var g=[],k=[];for(q=0;q<=f;q++){var N=q/f,p=t/b;this.vertices.push(new c.Vertex(new c.Vector3(-a*Math.cos(h+N*o)*Math.sin(m+p*l),a*Math.cos(m+p*l),a*Math.sin(h+N*o)*Math.sin(m+p*l))));g.push(this.vertices.length-1);k.push(new c.UV(N,p))}M.push(g);w.push(k)}for(t=0;t<b;t++){for(q=0;q<f;q++){var h=M[t][q+1],o=M[t][q],m=M[t+1][q],l=M[t+1][q+1],g=this.vertices[h].position.clone().normalize(),k=this.vertices[o].position.clone().normalize(),N=this.vertices[m].position.clone().normalize(),p=this.vertices[l].position.clone().normalize(),e=w[t][q+1].clone(),n=w[t][q].clone(),r=w[t+1][q].clone(),O=w[t+1][q+1].clone();Math.abs(this.vertices[h].position.y)==a?(this.faces.push(new c.Face3(h,m,l,[g,N,p])),this.faceVertexUvs[0].push([e,r,O])):Math.abs(this.vertices[m].position.y)==a?(this.faces.push(new c.Face3(h,o,m,[g,k,N])),this.faceVertexUvs[0].push([e,n,r])):(this.faces.push(new c.Face4(h,o,m,l,[g,k,N,p])),this.faceVertexUvs[0].push([e,n,r,O]))}}this.computeCentroids();this.computeFaceNormals();this.boundingSphere={radius:a}};c.SphereGeometry.prototype=new c.Geometry;c.SphereGeometry.prototype.constructor=c.SphereGeometry;c.TextGeometry=function(j,a){var k=(new c.TextPath(j,a)).toShapes();a.amount=a.height!==void 0?a.height:50;if(a.bevelThickness===void 0){a.bevelThickness=10}if(a.bevelSize===void 0){a.bevelSize=8}if(a.bevelEnabled===void 0){a.bevelEnabled=!1}if(a.bend){var b=k[k.length-1].getBoundingBox().maxX;a.bendPath=new c.QuadraticBezierCurve(new c.Vector2(0,0),new c.Vector2(b/2,120),new c.Vector2(b,0))}c.ExtrudeGeometry.call(this,k,a)};c.TextGeometry.prototype=new c.ExtrudeGeometry;c.TextGeometry.prototype.constructor=c.TextGeometry;c.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(b){var a=b.familyName.toLowerCase();this.faces[a]=this.faces[a]||{};this.faces[a][b.cssFontWeight]=this.faces[a][b.cssFontWeight]||{};this.faces[a][b.cssFontWeight][b.cssFontStyle]=b;return this.faces[a][b.cssFontWeight][b.cssFontStyle]=b},drawText:function(f){for(var h=this.getFace(),g=this.size/h.resolution,q=0,b=String(f).split(""),a=b.length,r=[],f=0;f<a;f++){var e=new c.Path,e=this.extractGlyphPoints(b[f],h,g,q,e);q+=e.offset;r.push(e.path)}return{paths:r,offset:q/2}},extractGlyphPoints:function(a,e,b,f,n){var l=[],h,p,q,u,r,P,g,w,m,O,k,o=e.glyphs[a]||e.glyphs["?"];if(o){if(o.o){e=o._cachedOutline||(o._cachedOutline=o.o.split(" "));u=e.length;for(a=0;a<u;){switch(q=e[a++],q){case"m":q=e[a++]*b+f;r=e[a++]*b;l.push(new c.Vector2(q,r));n.moveTo(q,r);break;case"l":q=e[a++]*b+f;r=e[a++]*b;l.push(new c.Vector2(q,r));n.lineTo(q,r);break;case"q":q=e[a++]*b+f;r=e[a++]*b;w=e[a++]*b+f;m=e[a++]*b;n.quadraticCurveTo(w,m,q,r);if(h=l[l.length-1]){P=h.x;g=h.y;h=1;for(p=this.divisions;h<=p;h++){var Q=h/p,t=c.Shape.Utils.b2(Q,P,w,q),Q=c.Shape.Utils.b2(Q,g,m,r);l.push(new c.Vector2(t,Q))}}break;case"b":if(q=e[a++]*b+f,r=e[a++]*b,w=e[a++]*b+f,m=e[a++]*-b,O=e[a++]*b+f,k=e[a++]*-b,n.bezierCurveTo(q,r,w,m,O,k),h=l[l.length-1]){P=h.x;g=h.y;h=1;for(p=this.divisions;h<=p;h++){Q=h/p,t=c.Shape.Utils.b3(Q,P,w,O,q),Q=c.Shape.Utils.b3(Q,g,m,k,r),l.push(new c.Vector2(t,Q))}}}}}return{offset:o.ha*b,points:l,path:n}}}};(function(b){var a=function(n){for(var e=n.length,m=0,g=e-1,f=0;f<e;g=f++){m+=n[g].x*n[f].y-n[f].x*n[g].y}return m*0.5};b.Triangulate=function(k,m){var s=k.length;if(s<3){return null}var p=[],n=[],t=[],u,x,v;if(a(k)>0){for(x=0;x<s;x++){n[x]=x}}else{for(x=0;x<s;x++){n[x]=s-1-x}}var E=2*s;for(x=s-1;s>2;){if(E--<=0){console.log("Warning, unable to triangulate polygon!");if(m){return t}return p}u=x;s<=u&&(u=0);x=u+1;s<=x&&(x=0);v=x+1;s<=v&&(v=0);var F;k:{F=k;var y=u,H=x,B=v,G=s,J=n,R=void 0,M=void 0,g=void 0,l=void 0,f=void 0,U=void 0,ab=void 0,O=void 0,w=void 0,M=F[J[y]].x,g=F[J[y]].y,l=F[J[H]].x,f=F[J[H]].y,U=F[J[B]].x,ab=F[J[B]].y;if(1e-10>(l-M)*(ab-g)-(f-g)*(U-M)){F=!1}else{for(R=0;R<G;R++){if(!(R==y||R==H||R==B)){var O=F[J[R]].x,w=F[J[R]].y,I=void 0,h=void 0,ad=void 0,ae=void 0,A=void 0,ac=void 0,P=void 0,e=void 0,q=void 0,o=void 0,r=void 0,K=void 0,I=ad=A=void 0,I=U-l,h=ab-f,ad=M-U,ae=g-ab,A=l-M,ac=f-g,P=O-M,e=w-g,q=O-l,o=w-f,r=O-U,K=w-ab,I=I*o-h*q,A=A*e-ac*P,ad=ad*K-ae*r;if(I>=0&&ad>=0&&A>=0){F=!1;break k}}}F=!0}}if(F){p.push([k[n[u]],k[n[x]],k[n[v]]]);t.push([n[u],n[x],n[v]]);u=x;for(v=x+1;v<s;u++,v++){n[u]=n[v]}s--;E=2*s}}if(m){return t}return p};b.Triangulate.area=a;return b})(c.FontUtils);d._typeface_js={faces:c.FontUtils.faces,loadFace:c.FontUtils.loadFace};c.TorusGeometry=function(a,e,b,f,s){c.Geometry.call(this);this.radius=a||100;this.tube=e||40;this.segmentsR=b||8;this.segmentsT=f||6;this.arc=s||Math.PI*2;s=new c.Vector3;a=[];e=[];for(b=0;b<=this.segmentsR;b++){for(f=0;f<=this.segmentsT;f++){var h=f/this.segmentsT*this.arc,g=b/this.segmentsR*Math.PI*2;s.x=this.radius*Math.cos(h);s.y=this.radius*Math.sin(h);var t=new c.Vector3;t.x=(this.radius+this.tube*Math.cos(g))*Math.cos(h);t.y=(this.radius+this.tube*Math.cos(g))*Math.sin(h);t.z=this.tube*Math.sin(g);this.vertices.push(new c.Vertex(t));a.push(new c.UV(f/this.segmentsT,1-b/this.segmentsR));e.push(t.clone().subSelf(s).normalize())}}for(b=1;b<=this.segmentsR;b++){for(f=1;f<=this.segmentsT;f++){var s=(this.segmentsT+1)*b+f-1,h=(this.segmentsT+1)*(b-1)+f-1,g=(this.segmentsT+1)*(b-1)+f,t=(this.segmentsT+1)*b+f,u=new c.Face4(s,h,g,t,[e[s],e[h],e[g],e[t]]);u.normal.addSelf(e[s]);u.normal.addSelf(e[h]);u.normal.addSelf(e[g]);u.normal.addSelf(e[t]);u.normal.normalize();this.faces.push(u);this.faceVertexUvs[0].push([a[s].clone(),a[h].clone(),a[g].clone(),a[t].clone()])}}this.computeCentroids()};c.TorusGeometry.prototype=new c.Geometry;c.TorusGeometry.prototype.constructor=c.TorusGeometry;c.TorusKnotGeometry=function(l,x,w,y,e,b,a){function f(p,q,m,j,n,o){q=m/j*p;m=Math.cos(q);return new c.Vector3(n*(2+m)*0.5*Math.cos(p),n*(2+m)*Math.sin(p)*0.5,o*n*Math.sin(q)*0.5)}c.Geometry.call(this);this.radius=l||200;this.tube=x||40;this.segmentsR=w||64;this.segmentsT=y||8;this.p=e||2;this.q=b||3;this.heightScale=a||1;this.grid=Array(this.segmentsR);w=new c.Vector3;y=new c.Vector3;b=new c.Vector3;for(l=0;l<this.segmentsR;++l){this.grid[l]=Array(this.segmentsT);for(x=0;x<this.segmentsT;++x){var g=l/this.segmentsR*2*this.p*Math.PI,a=x/this.segmentsT*2*Math.PI,e=f(g,a,this.q,this.p,this.radius,this.heightScale),g=f(g+0.01,a,this.q,this.p,this.radius,this.heightScale);w.x=g.x-e.x;w.y=g.y-e.y;w.z=g.z-e.z;y.x=g.x+e.x;y.y=g.y+e.y;y.z=g.z+e.z;b.cross(w,y);y.cross(b,w);b.normalize();y.normalize();g=-this.tube*Math.cos(a);a=this.tube*Math.sin(a);e.x+=g*y.x+a*b.x;e.y+=g*y.y+a*b.y;e.z+=g*y.z+a*b.z;this.grid[l][x]=this.vertices.push(new c.Vertex(new c.Vector3(e.x,e.y,e.z)))-1}}for(l=0;l<this.segmentsR;++l){for(x=0;x<this.segmentsT;++x){var y=(l+1)%this.segmentsR,b=(x+1)%this.segmentsT,e=this.grid[l][x],w=this.grid[y][x],y=this.grid[y][b],b=this.grid[l][b],a=new c.UV(l/this.segmentsR,x/this.segmentsT),g=new c.UV((l+1)/this.segmentsR,x/this.segmentsT),k=new c.UV((l+1)/this.segmentsR,(x+1)/this.segmentsT),h=new c.UV(l/this.segmentsR,(x+1)/this.segmentsT);this.faces.push(new c.Face4(e,w,y,b));this.faceVertexUvs[0].push([a,g,k,h])}}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};c.TorusKnotGeometry.prototype=new c.Geometry;c.TorusKnotGeometry.prototype.constructor=c.TorusKnotGeometry;c.SubdivisionModifier=function(a){this.subdivisions=a===void 0?1:a;this.useOldVertexColors=!1;this.supportUVs=!0};c.SubdivisionModifier.prototype.constructor=c.SubdivisionModifier;c.SubdivisionModifier.prototype.modify=function(b){for(var a=this.subdivisions;a-->0;){this.smooth(b)}};c.SubdivisionModifier.prototype.smooth=function(x){function B(I,L,M,N,O,P){var z=new c.Face4(I,L,M,N,null,O.color,O.material);if(F.useOldVertexColors){z.vertexColors=[];for(var C,D,G,j=0;j<4;j++){G=P[j];C=new c.Color;C.setRGB(0,0,0);for(var H=0;H<G.length;H++){D=O.vertexColors[G[H]-1],C.r+=D.r,C.g+=D.g,C.b+=D.b}C.r/=G.length;C.g/=G.length;C.b/=G.length;z.vertexColors[j]=C}}K.push(z);(!F.supportUVs||e.length!=0)&&J.push([e[I],e[L],e[M],e[N]])}function A(j,z){return Math.min(j,z)+"_"+Math.max(j,z)}var E=[],K=[],J=[],F=this,R=x.vertices,E=x.faces,U=R.concat(),ae=[],ad={},b={},e=[],af,k,a,g,m,s=x.faceVertexUvs[0];af=0;for(k=s.length;af<k;af++){a=0;for(g=s[af].length;a<g;a++){m=E[af]["abcd".charAt(a)],e[m]||(e[m]=s[af][a])}}var o;af=0;for(k=E.length;af<k;af++){if(m=E[af],ae.push(m.centroid),U.push(new c.Vertex(m.centroid)),F.supportUVs&&e.length!=0){o=new c.UV;if(m instanceof c.Face3){o.u=e[m.a].u+e[m.b].u+e[m.c].u,o.v=e[m.a].v+e[m.b].v+e[m.c].v,o.u/=3,o.v/=3}else{if(m instanceof c.Face4){o.u=e[m.a].u+e[m.b].u+e[m.c].u+e[m.d].u,o.v=e[m.a].v+e[m.b].v+e[m.c].v+e[m.d].v,o.u/=4,o.v/=4}}e.push(o)}}k=function(D){function G(M,N,L){M[N]===void 0&&(M[N]=[]);M[N].push(L)}var H,I,j,z,C={};H=0;for(I=D.faces.length;H<I;H++){j=D.faces[H],j instanceof c.Face3?(z=A(j.a,j.b),G(C,z,H),z=A(j.b,j.c),G(C,z,H),z=A(j.c,j.a),G(C,z,H)):j instanceof c.Face4&&(z=A(j.a,j.b),G(C,z,H),z=A(j.b,j.c),G(C,z,H),z=A(j.c,j.d),G(C,z,H),z=A(j.d,j.a),G(C,z,H))}return C}(x);var h=0,s=R.length,p,f,t={},u={},q=function(j,z){t[j]===void 0&&(t[j]=[]);t[j].push(z)},v=function(j,z){u[j]===void 0&&(u[j]={});u[j][z]=null};for(af in k){o=k[af];p=af.split("_");f=p[0];p=p[1];q(f,[f,p]);q(p,[f,p]);a=0;for(g=o.length;a<g;a++){m=o[a],v(f,m,af),v(p,m,af)}o.length<2&&(b[af]=!0)}for(af in k){if(o=k[af],m=o[0],o=o[1],p=af.split("_"),f=p[0],p=p[1],g=new c.Vector3,b[af]?(g.addSelf(R[f].position),g.addSelf(R[p].position),g.multiplyScalar(0.5)):(g.addSelf(ae[m]),g.addSelf(ae[o]),g.addSelf(R[f].position),g.addSelf(R[p].position),g.multiplyScalar(0.25)),ad[af]=s+E.length+h,U.push(new c.Vertex(g)),h++,F.supportUVs&&e.length!=0){o=new c.UV,o.u=e[f].u+e[p].u,o.v=e[f].v+e[p].v,o.u/=2,o.v/=2,e.push(o)}}var l,n;p=["123","12","2","23"];g=["123","23","3","31"];var q=["123","31","1","12"],v=["1234","12","2","23"],r=["1234","23","3","34"],y=["1234","34","4","41"],w=["1234","41","1","12"];af=0;for(k=ae.length;af<k;af++){m=E[af],o=s+af,m instanceof c.Face3?(h=A(m.a,m.b),f=A(m.b,m.c),l=A(m.c,m.a),B(o,ad[h],m.b,ad[f],m,p),B(o,ad[f],m.c,ad[l],m,g),B(o,ad[l],m.a,ad[h],m,q)):m instanceof c.Face4?(h=A(m.a,m.b),f=A(m.b,m.c),l=A(m.c,m.d),n=A(m.d,m.a),B(o,ad[h],m.b,ad[f],m,v),B(o,ad[f],m.c,ad[l],m,r),B(o,ad[l],m.d,ad[n],m,y),B(o,ad[n],m.a,ad[h],m,w)):console.log("face should be a face!",m)}E=U;U=new c.Vector3;ad=new c.Vector3;af=0;for(k=R.length;af<k;af++){if(t[af]!==void 0){U.set(0,0,0);ad.set(0,0,0);m=new c.Vector3(0,0,0);o=0;for(a in u[af]){U.addSelf(ae[a]),o++}h=0;s=t[af].length;for(a=0;a<s;a++){b[A(t[af][a][0],t[af][a][1])]&&h++}if(h!=2){U.divideScalar(o);for(a=0;a<s;a++){o=t[af][a],o=R[o[0]].position.clone().addSelf(R[o[1]].position).divideScalar(2),ad.addSelf(o)}ad.divideScalar(s);m.addSelf(R[af].position);m.multiplyScalar(s-3);m.addSelf(U);m.addSelf(ad.multiplyScalar(2));m.divideScalar(s);E[af].position=m}}}x.vertices=E;x.faces=K;x.faceVertexUvs[0]=J;delete x.__tmpVertices;x.computeCentroids();x.computeFaceNormals();x.computeVertexNormals()};c.Loader=function(a){this.statusDomElement=(this.showStatus=a)?c.Loader.prototype.addStatusElement():null;this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}};c.Loader.prototype={constructor:c.Loader,addStatusElement:function(){var a=document.createElement("div");a.style.position="absolute";a.style.right="0px";a.style.top="0px";a.style.fontSize="0.8em";a.style.textAlign="left";a.style.background="rgba(0,0,0,0.25)";a.style.color="#fff";a.style.width="120px";a.style.padding="0.5em 0.5em 0.5em 0.5em";a.style.zIndex=1000;a.innerHTML="Loading ...";return a},updateProgress:function(b){var a="Loaded ";a+=b.total?(100*b.loaded/b.total).toFixed(0)+"%":(b.loaded/1000).toFixed(2)+" KB";this.statusDomElement.innerHTML=a},extractUrlbase:function(a){a=a.split("/");a.pop();return a.length<1?"":a.join("/")+"/"},initMaterials:function(j,a,k){j.materials=[];for(var b=0;b<a.length;++b){j.materials[b]=c.Loader.prototype.createMaterial(a[b],k)}},hasNormals:function(j){var a,k,b=j.materials.length;for(k=0;k<b;k++){if(a=j.materials[k],a instanceof c.ShaderMaterial){return !0}}return !1},createMaterial:function(h,l){function k(j){j=Math.log(j)/Math.LN2;return Math.floor(j)==j}function o(n,j){var m=new Image;m.onload=function(){if(!k(this.width)||!k(this.height)){var q=Math.pow(2,Math.round(Math.log(this.width)/Math.LN2)),r=Math.pow(2,Math.round(Math.log(this.height)/Math.LN2));n.image.width=q;n.image.height=r;n.image.getContext("2d").drawImage(this,0,0,q,r)}else{n.image=this}n.needsUpdate=!0};m.src=j}function B(s,t,j,q,r,m){var n=document.createElement("canvas");s[t]=new c.Texture(n);s[t].sourceFile=j;if(q){s[t].repeat.set(q[0],q[1]);if(q[0]!=1){s[t].wrapS=c.RepeatWrapping}if(q[1]!=1){s[t].wrapT=c.RepeatWrapping}}r&&s[t].offset.set(r[0],r[1]);if(m){q={repeat:c.RepeatWrapping,mirror:c.MirroredRepeatWrapping};if(q[m[0]]!==void 0){s[t].wrapS=q[m[0]]}if(q[m[1]]!==void 0){s[t].wrapT=q[m[1]]}}o(s[t],l+"/"+j)}function A(j){return(j[0]*255<<16)+(j[1]*255<<8)+j[2]*255}var p,C,a;C="MeshLambertMaterial";p={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,wireframe:h.wireframe};h.shading&&(h.shading=="Phong"?C="MeshPhongMaterial":h.shading=="Basic"&&(C="MeshBasicMaterial"));if(h.blending){if(h.blending=="Additive"){p.blending=c.AdditiveBlending}else{if(h.blending=="Subtractive"){p.blending=c.SubtractiveBlending}else{if(h.blending=="Multiply"){p.blending=c.MultiplyBlending}}}}if(h.transparent!==void 0||h.opacity<1){p.transparent=h.transparent}if(h.depthTest!==void 0){p.depthTest=h.depthTest}if(h.vertexColors!==void 0){if(h.vertexColors=="face"){p.vertexColors=c.FaceColors}else{if(h.vertexColors){p.vertexColors=c.VertexColors}}}if(h.colorDiffuse){p.color=A(h.colorDiffuse)}else{if(h.DbgColor){p.color=h.DbgColor}}if(h.colorSpecular){p.specular=A(h.colorSpecular)}if(h.colorAmbient){p.ambient=A(h.colorAmbient)}if(h.transparency){p.opacity=h.transparency}if(h.specularCoef){p.shininess=h.specularCoef}h.mapDiffuse&&l&&B(p,"map",h.mapDiffuse,h.mapDiffuseRepeat,h.mapDiffuseOffset,h.mapDiffuseWrap);h.mapLight&&l&&B(p,"lightMap",h.mapLight,h.mapLightRepeat,h.mapLightOffset,h.mapLightWrap);h.mapNormal&&l&&B(p,"normalMap",h.mapNormal,h.mapNormalRepeat,h.mapNormalOffset,h.mapNormalWrap);h.mapSpecular&&l&&B(p,"specularMap",h.mapSpecular,h.mapSpecularRepeat,h.mapSpecularOffset,h.mapSpecularWrap);if(h.mapNormal){var e=c.ShaderUtils.lib.normal,b=c.UniformsUtils.clone(e.uniforms),f=p.color;C=p.specular;a=p.ambient;var g=p.shininess;b.tNormal.texture=p.normalMap;if(h.mapNormalFactor){b.uNormalScale.value=h.mapNormalFactor}if(p.map){b.tDiffuse.texture=p.map,b.enableDiffuse.value=!0}if(p.specularMap){b.tSpecular.texture=p.specularMap,b.enableSpecular.value=!0}if(p.lightMap){b.tAO.texture=p.lightMap,b.enableAO.value=!0}b.uDiffuseColor.value.setHex(f);b.uSpecularColor.value.setHex(C);b.uAmbientColor.value.setHex(a);b.uShininess.value=g;if(p.opacity){b.uOpacity.value=p.opacity}p=new c.ShaderMaterial({fragmentShader:e.fragmentShader,vertexShader:e.vertexShader,uniforms:b,lights:!0,fog:!0})}else{p=new c[C](p)}return p}};c.BinaryLoader=function(a){c.Loader.call(this,a)};c.BinaryLoader.prototype=new c.Loader;c.BinaryLoader.prototype.constructor=c.BinaryLoader;c.BinaryLoader.prototype.supr=c.Loader.prototype;c.BinaryLoader.prototype.load=function(k,a,l,b){if(k instanceof Object){console.warn("DEPRECATED: BinaryLoader( parameters ) is now BinaryLoader( url, callback, texturePath, binaryPath )."),b=k,k=b.model,a=b.callback,l=b.texture_path,b=b.bin_path}var l=l?l:this.extractUrlbase(k),b=b?b:this.extractUrlbase(k),g=this.showProgress?c.Loader.prototype.updateProgress:null;this.onLoadStart();this.loadAjaxJSON(this,k,a,l,b,g)};c.BinaryLoader.prototype.loadAjaxJSON=function(g,p,o,a,f,e){var b=new XMLHttpRequest;b.onreadystatechange=function(){if(b.readyState==4){if(b.status==200||b.status==0){try{var h=JSON.parse(b.responseText);h.metadata===void 0||h.metadata.formatVersion===void 0||h.metadata.formatVersion!==3?console.error("Deprecated file format."):g.loadAjaxBuffers(h,o,f,a,e)}catch(j){console.error(j),console.warn("DEPRECATED: ["+p+"] seems to be using old model format")}}else{console.error("Couldn't load ["+p+"] ["+b.status+"]")}}};b.open("GET",p,!0);b.overrideMimeType("text/plain; charset=x-user-defined");b.setRequestHeader("Content-Type","text/plain");b.send(null)};c.BinaryLoader.prototype.loadAjaxBuffers=function(f,h,g,q,b){var a=new XMLHttpRequest,r=g+"/"+f.buffers,e=0;a.onreadystatechange=function(){a.readyState==4?a.status==200||a.status==0?c.BinaryLoader.prototype.createBinModel(a.response,h,q,f.materials):console.error("Couldn't load ["+r+"] ["+a.status+"]"):a.readyState==3?b&&(e==0&&(e=a.getResponseHeader("Content-Length")),b({total:e,loaded:a.responseText.length})):a.readyState==2&&(e=a.getResponseHeader("Content-Length"))};a.open("GET",r,!0);a.responseType="arraybuffer";a.send(null)};c.BinaryLoader.prototype.createBinModel=function(k,a,l,b){var g=function(e){function f(s){return s%4?4-s%4:0}function h(s,z){return(new Uint8Array(s,z,1))[0]}function j(s,z){return(new Uint32Array(s,z,1))[0]}function n(D,E){var H,I,J,K,L,M,s,z,C=new Uint32Array(k,E,3*D);for(H=0;H<D;H++){I=C[H*3];J=C[H*3+1];K=C[H*3+2];L=A[I*2];I=A[I*2+1];M=A[J*2];s=A[J*2+1];J=A[K*2];z=A[K*2+1];K=p.faceVertexUvs[0];var G=[];G.push(new c.UV(L,I));G.push(new c.UV(M,s));G.push(new c.UV(J,z));K.push(G)}}function m(C,G){var H,O,z,D,I,J,K,L,M,N,s=new Uint32Array(k,G,4*C);for(H=0;H<C;H++){O=s[H*4];z=s[H*4+1];D=s[H*4+2];I=s[H*4+3];J=A[O*2];O=A[O*2+1];K=A[z*2];M=A[z*2+1];L=A[D*2];N=A[D*2+1];D=A[I*2];z=A[I*2+1];I=p.faceVertexUvs[0];var E=[];E.push(new c.UV(J,O));E.push(new c.UV(K,M));E.push(new c.UV(L,N));E.push(new c.UV(D,z));I.push(E)}}function q(C,D,E){for(var G,H,I,s,D=new Uint32Array(k,D,3*C),z=new Uint16Array(k,E,C),E=0;E<C;E++){G=D[E*3],H=D[E*3+1],I=D[E*3+2],s=z[E],p.faces.push(new c.Face3(G,H,I,null,null,s))}}function r(I,J,s){for(var z,C,D,E,G,J=new Uint32Array(k,J,4*I),H=new Uint16Array(k,s,I),s=0;s<I;s++){z=J[s*4],C=J[s*4+1],D=J[s*4+2],E=J[s*4+3],G=H[s],p.faces.push(new c.Face4(z,C,D,E,null,null,G))}}function o(s,z,D,G){for(var I,J,P,C,E,K,L,z=new Uint32Array(k,z,3*s),D=new Uint32Array(k,D,3*s),M=new Uint16Array(k,G,s),G=0;G<s;G++){I=z[G*3];J=z[G*3+1];P=z[G*3+2];E=D[G*3];K=D[G*3+1];L=D[G*3+2];C=M[G];var N=u[K*3],O=u[K*3+1];K=u[K*3+2];var H=u[L*3],Q=u[L*3+1];L=u[L*3+2];p.faces.push(new c.Face3(I,J,P,[new c.Vector3(u[E*3],u[E*3+1],u[E*3+2]),new c.Vector3(N,O,K),new c.Vector3(H,Q,L)],null,C))}}function x(M,N,O,P){for(var Q,R,S,T,s,z,C,D,E,N=new Uint32Array(k,N,4*M),O=new Uint32Array(k,O,4*M),I=new Uint16Array(k,P,M),P=0;P<M;P++){Q=N[P*4];R=N[P*4+1];S=N[P*4+2];T=N[P*4+3];z=O[P*4];C=O[P*4+1];D=O[P*4+2];E=O[P*4+3];s=I[P];var J=u[C*3],K=u[C*3+1];C=u[C*3+2];var U=u[D*3],G=u[D*3+1];D=u[D*3+2];var H=u[E*3],L=u[E*3+1];E=u[E*3+2];p.faces.push(new c.Face4(Q,R,S,T,[new c.Vector3(u[z*3],u[z*3+1],u[z*3+2]),new c.Vector3(J,K,C),new c.Vector3(U,G,D),new c.Vector3(H,L,E)],null,s))}}var p=this,v=0,y,u=[],A=[],w,F,t,B,W,V;c.Geometry.call(this);c.Loader.prototype.initMaterials(p,b,e);y={signature:function(C,D,E){for(var C=new Uint8Array(C,D,E),s="",z=0;z<E;z++){s+=String.fromCharCode(C[D+z])}return s}(k,v,12),header_bytes:h(k,v+12),vertex_coordinate_bytes:h(k,v+13),normal_coordinate_bytes:h(k,v+14),uv_coordinate_bytes:h(k,v+15),vertex_index_bytes:h(k,v+16),normal_index_bytes:h(k,v+17),uv_index_bytes:h(k,v+18),material_index_bytes:h(k,v+19),nvertices:j(k,v+20),nnormals:j(k,v+20+4),nuvs:j(k,v+20+8),ntri_flat:j(k,v+20+12),ntri_smooth:j(k,v+20+16),ntri_flat_uv:j(k,v+20+20),ntri_smooth_uv:j(k,v+20+24),nquad_flat:j(k,v+20+28),nquad_smooth:j(k,v+20+32),nquad_flat_uv:j(k,v+20+36),nquad_smooth_uv:j(k,v+20+40)};y.signature!=="Three.js 003"&&console.warn("DEPRECATED: binary model seems to be using old format");v+=y.header_bytes;e=y.vertex_index_bytes*3+y.material_index_bytes;V=y.vertex_index_bytes*4+y.material_index_bytes;w=y.ntri_flat*e;F=y.ntri_smooth*(e+y.normal_index_bytes*3);t=y.ntri_flat_uv*(e+y.uv_index_bytes*3);B=y.ntri_smooth_uv*(e+y.normal_index_bytes*3+y.uv_index_bytes*3);W=y.nquad_flat*V;e=y.nquad_smooth*(V+y.normal_index_bytes*4);V=y.nquad_flat_uv*(V+y.uv_index_bytes*4);v+=function(C){var D=y.nvertices,C=new Float32Array(k,C,D*3),E,G,s,z;for(E=0;E<D;E++){G=C[E*3],s=C[E*3+1],z=C[E*3+2],p.vertices.push(new c.Vertex(new c.Vector3(G,s,z)))}return D*3*Float32Array.BYTES_PER_ELEMENT}(v);v+=function(C){var D=y.nnormals;if(D){var C=new Int8Array(k,C,D*3),E,G,s,z;for(E=0;E<D;E++){G=C[E*3],s=C[E*3+1],z=C[E*3+2],u.push(G/127,s/127,z/127)}}return D*3*Int8Array.BYTES_PER_ELEMENT}(v);v+=f(y.nnormals*3);v+=function(D){var E=y.nuvs;if(E){var D=new Float32Array(k,D,E*2),s,z,C;for(s=0;s<E;s++){z=D[s*2],C=D[s*2+1],A.push(z,C)}}return E*2*Float32Array.BYTES_PER_ELEMENT}(v);w=v+w+f(y.ntri_flat*2);F=w+F+f(y.ntri_smooth*2);t=F+t+f(y.ntri_flat_uv*2);B=t+B+f(y.ntri_smooth_uv*2);W=B+W+f(y.nquad_flat*2);e=W+e+f(y.nquad_smooth*2);V=e+V+f(y.nquad_flat_uv*2);(function(z){var C=y.ntri_flat_uv;if(C){var s=z+C*Uint32Array.BYTES_PER_ELEMENT*3;q(C,z,s+C*Uint32Array.BYTES_PER_ELEMENT*3);n(C,s)}})(F);(function(C){var D=y.ntri_smooth_uv;if(D){var s=C+D*Uint32Array.BYTES_PER_ELEMENT*3,z=s+D*Uint32Array.BYTES_PER_ELEMENT*3;o(D,C,s,z+D*Uint32Array.BYTES_PER_ELEMENT*3);n(D,z)}})(t);(function(z){var C=y.nquad_flat_uv;if(C){var s=z+C*Uint32Array.BYTES_PER_ELEMENT*4;r(C,z,s+C*Uint32Array.BYTES_PER_ELEMENT*4);m(C,s)}})(e);(function(C){var D=y.nquad_smooth_uv;if(D){var s=C+D*Uint32Array.BYTES_PER_ELEMENT*4,z=s+D*Uint32Array.BYTES_PER_ELEMENT*4;x(D,C,s,z+D*Uint32Array.BYTES_PER_ELEMENT*4);m(D,z)}})(V);(function(s){var z=y.ntri_flat;z&&q(z,s,s+z*Uint32Array.BYTES_PER_ELEMENT*3)})(v);(function(z){var C=y.ntri_smooth;if(C){var s=z+C*Uint32Array.BYTES_PER_ELEMENT*3;o(C,z,s,s+C*Uint32Array.BYTES_PER_ELEMENT*3)}})(w);(function(s){var z=y.nquad_flat;z&&r(z,s,s+z*Uint32Array.BYTES_PER_ELEMENT*4)})(B);(function(z){var C=y.nquad_smooth;if(C){var s=z+C*Uint32Array.BYTES_PER_ELEMENT*4;x(C,z,s,s+C*Uint32Array.BYTES_PER_ELEMENT*4)}})(W);this.computeCentroids();this.computeFaceNormals();c.Loader.prototype.hasNormals(this)&&this.computeTangents()};g.prototype=new c.Geometry;g.prototype.constructor=g;a(new g(l))};c.ColladaLoader=function(){function P(L,z,C){ac=L;z=z||s;C!==void 0&&(L=C.split("/"),L.pop(),an=L.length<1?"":L.join("/")+"/");m=S("//dae:library_images/dae:image",V,"image");I=S("//dae:library_materials/dae:material",l,"material");g=S("//dae:library_effects/dae:effect",e,"effect");r=S("//dae:library_geometries/dae:geometry",aj,"geometry");ap=S("//dae:library_controllers/dae:controller",aa,"controller");al=S("//dae:library_animations/dae:animation",H,"animation");p=S(".//dae:library_visual_scenes/dae:visual_scene",ad,"visual_scene");M=[];b=[];(L=ac.evaluate(".//dae:scene/dae:instance_visual_scene",ac,B,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null).iterateNext())?(L=L.getAttribute("url").replace(/^#/,""),u=p[L]):u=null;ar=new c.Object3D;for(L=0;L<u.nodes.length;L++){ar.add(W(u.nodes[L]))}R();for(var D in al){}D={scene:ar,morphs:M,skins:b,dae:{images:m,materials:I,effects:g,geometries:r,controllers:ap,animations:al,visualScenes:p,scene:u}};z&&z(D);return D}function S(N,Q,z){for(var N=ac.evaluate(N,ac,B,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null),C={},D=N.iterateNext(),L=0;D;){D=(new Q).parse(D);if(D.id.length==0){D.id=z+L++}C[D.id]=D;D=N.iterateNext()}return C}function R(){var N=1000000,Q=-N,T=0,z;for(z in al){for(var C=al[z],D=0;D<C.sampler.length;D++){var L=C.sampler[D];L.create();N=Math.min(N,L.startTime);Q=Math.max(Q,L.endTime);T=Math.max(T,L.input.length)}}return{start:N,end:Q,frames:T}}function U(L,N,z,C){L.world=L.world||new c.Matrix4;L.world.copy(L.matrix);if(L.channels&&L.channels.length){var D=L.channels[0].sampler.output[z];D instanceof c.Matrix4&&L.world.copy(D)}C&&L.world.multiply(C,L.world);N.push(L);for(C=0;C<L.nodes.length;C++){U(L.nodes[C],N,z,L.world)}}function X(Q,Y,at){var av=ap[Y.url];if(!av||!av.skin){console.log("ColladaLoader: Could not find skin controller.")}else{if(!Y.skeleton||!Y.skeleton.length){console.log("ColladaLoader: Could not find the skeleton for the skin. ")}else{var ax=R(),Y=u.getChildById(Y.skeleton[0],!0)||u.getChildBySid(Y.skeleton[0],!0),az,z,C,L,N=new c.Vector3,T;for(az=0;az<Q.vertices.length;az++){av.skin.bindShapeMatrix.multiplyVector3(Q.vertices[az].position)}for(at=0;at<ax.frames;at++){var Z=[],au=[];for(az=0;az<Q.vertices.length;az++){au.push(new c.Vertex(new c.Vector3))}U(Y,Z,at);az=Z;z=av.skin;for(L=0;L<az.length;L++){if(C=az[L],T=-1,C.type=="JOINT"){for(var aw=0;aw<z.joints.length;aw++){if(C.sid==z.joints[aw]){T=aw;break}}if(T>=0){aw=z.invBindMatrices[T];C.invBindMatrix=aw;C.skinningMatrix=new c.Matrix4;C.skinningMatrix.multiply(C.world,aw);C.weights=[];for(aw=0;aw<z.weights.length;aw++){for(var ay=0;ay<z.weights[aw].length;ay++){var D=z.weights[aw][ay];D.joint==T&&C.weights.push(D)}}}else{throw"ColladaLoader: Could not find joint '"+C.sid+"'."}}}for(az=0;az<Z.length;az++){if(Z[az].type=="JOINT"){for(z=0;z<Z[az].weights.length;z++){C=Z[az].weights[z],L=C.index,C=C.weight,T=Q.vertices[L],L=au[L],N.x=T.position.x,N.y=T.position.y,N.z=T.position.z,Z[az].skinningMatrix.multiplyVector3(N),L.position.x+=N.x*C,L.position.y+=N.y*C,L.position.z+=N.z*C}}}Q.morphTargets.push({name:"target_"+at,vertices:au})}}}}function W(T){var Y=new c.Object3D,Z,at,au,av;for(au=0;au<T.controllers.length;au++){var z=ap[T.controllers[au].url];switch(z.type){case"skin":if(r[z.skin.source]){var C=new ag;C.url=z.skin.source;C.instance_material=T.controllers[au].instance_material;T.geometries.push(C);Z=T.controllers[au]}else{if(ap[z.skin.source]&&(at=z=ap[z.skin.source],z.morph&&r[z.morph.source])){C=new ag,C.url=z.morph.source,C.instance_material=T.controllers[au].instance_material,T.geometries.push(C)}}break;case"morph":if(r[z.morph.source]){C=new ag,C.url=z.morph.source,C.instance_material=T.controllers[au].instance_material,T.geometries.push(C),at=T.controllers[au]}console.log("ColladaLoader: Morph-controller partially supported.")}}for(au=0;au<T.geometries.length;au++){var z=T.geometries[au],C=z.instance_material,z=r[z.url],D={},L=0,N;if(z&&z.mesh&&z.mesh.primitives){if(Y.name.length==0){Y.name=z.id}if(C){for(av=0;av<C.length;av++){N=C[av];var Q=g[I[N.target].instance_effect.url].shader;Q.material.opacity=!Q.material.opacity?1:Q.material.opacity;N=D[N.symbol]=Q.material;L++}}C=N||new c.MeshLambertMaterial({color:14540253,shading:c.FlatShading});z=z.mesh.geometry3js;if(L>1){C=new c.MeshFaceMaterial;for(av=0;av<z.faces.length;av++){L=z.faces[av],L.materials=[D[L.daeMaterial]]}}if(Z!==void 0){X(z,Z),C.morphTargets=!0,C=new c.SkinnedMesh(z,C),C.skeleton=Z.skeleton,C.skinController=ap[Z.url],C.skinInstanceController=Z,C.name="skin_"+b.length,b.push(C)}else{if(at!==void 0){av=z;D=at instanceof af?ap[at.url]:at;if(!D||!D.morph){console.log("could not find morph controller!")}else{D=D.morph;for(L=0;L<D.targets.length;L++){if(Q=r[D.targets[L]],Q.mesh&&Q.mesh.primitives&&Q.mesh.primitives.length){Q=Q.mesh.primitives[0].geometry,Q.vertices.length===av.vertices.length&&av.morphTargets.push({name:"target_1",vertices:Q.vertices})}}av.morphTargets.push({name:"target_Z",vertices:av.vertices})}C.morphTargets=!0;C=new c.Mesh(z,C);C.name="morph_"+M.length;M.push(C)}else{C=new c.Mesh(z,C)}}T.geometries.length>1?Y.add(C):Y=C}}Y.name=T.id||"";T.matrix.decompose(Y.position,Y.rotation,Y.scale);for(au=0;au<T.nodes.length;au++){Y.add(W(T.nodes[au],T))}return Y}function V(){this.init_from=this.id=""}function aa(){this.type=this.name=this.id="";this.morph=this.skin=null}function ab(){this.weights=this.targets=this.source=this.method=null}function ae(){this.source="";this.bindShapeMatrix=null;this.invBindMatrices=[];this.joints=[];this.weights=[]}function ad(){this.name=this.id="";this.nodes=[];this.scene=new c.Object3D}function ah(){this.sid=this.name=this.id="";this.nodes=[];this.controllers=[];this.transforms=[];this.geometries=[];this.channels=[];this.matrix=new c.Matrix4}function ai(){this.type=this.sid="";this.data=[];this.matrix=new c.Matrix4}function af(){this.url="";this.skeleton=[];this.instance_material=[]}function ak(){this.target=this.symbol=""}function ag(){this.url="";this.instance_material=[]}function aj(){this.id="";this.mesh=null}function ao(z){this.geometry=z.id;this.primitives=[];this.geometry3js=this.vertices=null}function h(){}function aq(){this.material="";this.count=0;this.inputs=[];this.vcount=null;this.p=[];this.geometry=new c.Geometry}function w(){this.source="";this.stride=this.count=0;this.params=[]}function y(){this.input={}}function v(){this.semantic="";this.offset=0;this.source="";this.set=0}function j(z){this.id=z;this.type=null}function l(){this.name=this.id="";this.instance_effect=null}function f(){this.color=new c.Color(0);this.color.setRGB(Math.random(),Math.random(),Math.random());this.color.a=1;this.texcoord=this.texture=null}function F(z,C){this.type=z;this.effect=C;this.material=null}function am(z){this.effect=z;this.format=this.init_from=null}function x(z){this.effect=z;this.mipfilter=this.magfilter=this.minfilter=this.wrap_t=this.wrap_s=this.source=null}function e(){this.name=this.id="";this.sampler=this.surface=this.shader=null}function o(){this.url=""}function H(){this.name=this.id="";this.source={};this.sampler=[];this.channel=[]}function a(z){this.animation=z;this.target=this.source="";this.member=this.arrIndices=this.arrSyntax=this.dotSyntax=this.sid=null}function K(z){this.id="";this.animation=z;this.inputs=[];this.endTime=this.startTime=this.interpolation=this.output=this.input=null;this.duration=0}function t(z){var C=z.getAttribute("id");if(q[C]!=void 0){return q[C]}q[C]=(new j(C)).parse(z);return q[C]}function B(z){if(z=="dae"){return"http://www.collada.org/2005/11/COLLADASchema"}return null}function A(C){for(var C=J(C),D=[],z=0;z<C.length;z++){D.push(parseFloat(C[z]))}return D}function E(C){for(var C=J(C),D=[],z=0;z<C.length;z++){D.push(parseInt(C[z],10))}return D}function J(z){return z.replace(/^\s+/,"").replace(/\s+$/,"").split(/\s+/)}function k(C,D,z){return C.hasAttribute(D)?parseInt(C.getAttribute(D),10):z}function O(C,D){if(C===void 0){for(var z="0.";z.length<D+2;){z+="0"}return z}D=D||2;z=C.toString().split(".");for(z[1]=z.length>1?z[1].substr(0,D):"0";z[1].length<D;){z[1]+="0"}return z.join(".")}function G(C,D){var z="";z+=O(C.x,D)+",";z+=O(C.y,D)+",";z+=O(C.z,D);return z}var ac=null,ar=null,u,s=null,q={},m={},al={},ap={},r={},I={},g={},p,an,M,b,n=c.SmoothShading;V.prototype.parse=function(C){this.id=C.getAttribute("id");for(var D=0;D<C.childNodes.length;D++){var z=C.childNodes[D];if(z.nodeName=="init_from"){this.init_from=z.textContent}}return this};aa.prototype.parse=function(C){this.id=C.getAttribute("id");this.name=C.getAttribute("name");this.type="none";for(var D=0;D<C.childNodes.length;D++){var z=C.childNodes[D];switch(z.nodeName){case"skin":this.skin=(new ae).parse(z);this.type=z.nodeName;break;case"morph":this.morph=(new ab).parse(z),this.type=z.nodeName}}return this};ab.prototype.parse=function(L){var N={},z=[],C;this.method=L.getAttribute("method");this.source=L.getAttribute("source").replace(/^#/,"");for(C=0;C<L.childNodes.length;C++){var D=L.childNodes[C];if(D.nodeType==1){switch(D.nodeName){case"source":D=(new j).parse(D);N[D.id]=D;break;case"targets":z=this.parseInputs(D);break;default:console.log(D.nodeName)}}}for(C=0;C<z.length;C++){switch(L=z[C],D=N[L.source],L.semantic){case"MORPH_TARGET":this.targets=D.read();break;case"MORPH_WEIGHT":this.weights=D.read()}}return this};ab.prototype.parseInputs=function(D){for(var L=[],z=0;z<D.childNodes.length;z++){var C=D.childNodes[z];if(C.nodeType==1){switch(C.nodeName){case"input":L.push((new v).parse(C))}}}return L};ae.prototype.parse=function(N){var Q={},z,C;this.source=N.getAttribute("source").replace(/^#/,"");this.invBindMatrices=[];this.joints=[];this.weights=[];for(var D=0;D<N.childNodes.length;D++){var L=N.childNodes[D];if(L.nodeType==1){switch(L.nodeName){case"bind_shape_matrix":L=A(L.textContent);this.bindShapeMatrix=new c.Matrix4;this.bindShapeMatrix.set(L[0],L[1],L[2],L[3],L[4],L[5],L[6],L[7],L[8],L[9],L[10],L[11],L[12],L[13],L[14],L[15]);break;case"source":L=(new j).parse(L);Q[L.id]=L;break;case"joints":z=L;break;case"vertex_weights":C=L;break;default:console.log(L.nodeName)}}}this.parseJoints(z,Q);this.parseWeights(C,Q);return this};ae.prototype.parseJoints=function(L,N){for(var z=0;z<L.childNodes.length;z++){var C=L.childNodes[z];if(C.nodeType==1){switch(C.nodeName){case"input":var C=(new v).parse(C),D=N[C.source];if(C.semantic=="JOINT"){this.joints=D.read()}else{if(C.semantic=="INV_BIND_MATRIX"){this.invBindMatrices=D.read()}}}}}};ae.prototype.parseWeights=function(ax,L){for(var Q,T,Y=[],Z=0;Z<ax.childNodes.length;Z++){var at=ax.childNodes[Z];if(at.nodeType==1){switch(at.nodeName){case"input":Y.push((new v).parse(at));break;case"v":Q=E(at.textContent);break;case"vcount":T=E(at.textContent)}}}for(Z=at=0;Z<T.length;Z++){for(var au=T[Z],av=[],aw=0;aw<au;aw++){for(var z={},C=0;C<Y.length;C++){var D=Y[C],N=Q[at+D.offset];switch(D.semantic){case"JOINT":z.joint=N;break;case"WEIGHT":z.weight=L[D.source].data[N]}}av.push(z);at+=Y.length}for(aw=0;aw<av.length;aw++){av[aw].index=Z}this.weights.push(av)}};ad.prototype.getChildById=function(D,L){for(var z=0;z<this.nodes.length;z++){var C=this.nodes[z].getChildById(D,L);if(C){return C}}return null};ad.prototype.getChildBySid=function(D,L){for(var z=0;z<this.nodes.length;z++){var C=this.nodes[z].getChildBySid(D,L);if(C){return C}}return null};ad.prototype.parse=function(C){this.id=C.getAttribute("id");this.name=C.getAttribute("name");this.nodes=[];for(var D=0;D<C.childNodes.length;D++){var z=C.childNodes[D];if(z.nodeType==1){switch(z.nodeName){case"node":this.nodes.push((new ah).parse(z))}}}return this};ah.prototype.getChannelForTransform=function(L){for(var N=0;N<this.channels.length;N++){var Q=this.channels[N],T=Q.target.split("/");T.shift();var Y=T.shift(),z=Y.indexOf(".")>=0,C=Y.indexOf("(")>=0,D;if(z){T=Y.split("."),Y=T.shift(),T.shift()}else{if(C){D=Y.split("(");Y=D.shift();for(T=0;T<D.length;T++){D[T]=parseInt(D[T].replace(/\)/,""))}}}if(Y==L){return Q.info={sid:Y,dotSyntax:z,arrSyntax:C,arrIndices:D},Q}}return null};ah.prototype.getChildById=function(D,L){if(this.id==D){return this}if(L){for(var z=0;z<this.nodes.length;z++){var C=this.nodes[z].getChildById(D,L);if(C){return C}}}return null};ah.prototype.getChildBySid=function(D,L){if(this.sid==D){return this}if(L){for(var z=0;z<this.nodes.length;z++){var C=this.nodes[z].getChildBySid(D,L);if(C){return C}}}return null};ah.prototype.getTransformBySid=function(z){for(var C=0;C<this.transforms.length;C++){if(this.transforms[C].sid==z){return this.transforms[C]}}return null};ah.prototype.parse=function(Y){var Z;this.id=Y.getAttribute("id");this.sid=Y.getAttribute("sid");this.name=Y.getAttribute("name");this.type=Y.getAttribute("type");this.type=this.type=="JOINT"?this.type:"NODE";this.nodes=[];this.transforms=[];this.geometries=[];this.controllers=[];this.matrix=new c.Matrix4;for(var at=0;at<Y.childNodes.length;at++){if(Z=Y.childNodes[at],Z.nodeType==1){switch(Z.nodeName){case"node":this.nodes.push((new ah).parse(Z));break;case"instance_camera":break;case"instance_controller":this.controllers.push((new af).parse(Z));break;case"instance_geometry":this.geometries.push((new ag).parse(Z));break;case"instance_light":break;case"instance_node":Z=Z.getAttribute("url").replace(/^#/,"");(Z=ac.evaluate(".//dae:library_nodes//dae:node[@id='"+Z+"']",ac,B,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null).iterateNext())&&this.nodes.push((new ah).parse(Z));break;case"rotate":case"translate":case"scale":case"matrix":case"lookat":case"skew":this.transforms.push((new ai).parse(Z));break;case"extra":break;default:console.log(Z.nodeName)}}}Y=[];at=1000000;Z=-1000000;for(var au in al){for(var z=al[au],C=0;C<z.channel.length;C++){var D=z.channel[C],L=z.sampler[C];au=D.target.split("/")[0];if(au==this.id){L.create(),D.sampler=L,at=Math.min(at,L.startTime),Z=Math.max(Z,L.endTime),Y.push(D)}}}if(Y.length){this.startTime=at,this.endTime=Z}if((this.channels=Y)&&this.channels.length){au=10000000;for(Y=0;Y<this.channels.length;Y++){at=this.channels[Y].sampler;for(Z=0;Z<at.input.length-1;Z++){au=Math.min(au,at.input[Z+1]-at.input[Z])}}at=[];for(Y=this.startTime;Y<this.endTime;Y+=au){Z=Y;for(var z={},N=C=void 0,C=0;C<this.channels.length;C++){N=this.channels[C],z[N.sid]=N}D=new c.Matrix4;for(C=0;C<this.transforms.length;C++){if(L=this.transforms[C],N=z[L.sid],N!==void 0){for(var Q=N.sampler,T,N=0;N<Q.input.length-1;N++){if(Q.input[N+1]>Z){T=Q.output[N];break}}D=T!==void 0?T instanceof c.Matrix4?D.multiply(D,T):D.multiply(D,L.matrix):D.multiply(D,L.matrix)}else{D=D.multiply(D,L.matrix)}}Z=D;at.push({time:Y,pos:[Z.n14,Z.n24,Z.n34],rotq:[0,0,0,1],scl:[1,1,1]})}this.keys=at}this.updateMatrix();return this};ah.prototype.updateMatrix=function(){this.matrix.identity();for(var z=0;z<this.transforms.length;z++){this.matrix.multiply(this.matrix,this.transforms[z].matrix)}};ai.prototype.parse=function(z){this.sid=z.getAttribute("sid");this.type=z.nodeName;this.data=A(z.textContent);this.updateMatrix();return this};ai.prototype.updateMatrix=function(){var z=0;this.matrix.identity();switch(this.type){case"matrix":this.matrix.set(this.data[0],this.data[1],this.data[2],this.data[3],this.data[4],this.data[5],this.data[6],this.data[7],this.data[8],this.data[9],this.data[10],this.data[11],this.data[12],this.data[13],this.data[14],this.data[15]);break;case"translate":this.matrix.setTranslation(this.data[0],this.data[1],this.data[2]);break;case"rotate":z=this.data[3]*(Math.PI/180);this.matrix.setRotationAxis(new c.Vector3(this.data[0],this.data[1],this.data[2]),z);break;case"scale":this.matrix.setScale(this.data[0],this.data[1],this.data[2])}return this.matrix};af.prototype.parse=function(D){this.url=D.getAttribute("url").replace(/^#/,"");this.skeleton=[];this.instance_material=[];for(var L=0;L<D.childNodes.length;L++){var z=D.childNodes[L];if(z.nodeType==1){switch(z.nodeName){case"skeleton":this.skeleton.push(z.textContent.replace(/^#/,""));break;case"bind_material":if(z=ac.evaluate(".//dae:instance_material",z,B,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null)){for(var C=z.iterateNext();C;){this.instance_material.push((new ak).parse(C)),C=z.iterateNext()}}}}}return this};ak.prototype.parse=function(z){this.symbol=z.getAttribute("symbol");this.target=z.getAttribute("target").replace(/^#/,"");return this};ag.prototype.parse=function(C){this.url=C.getAttribute("url").replace(/^#/,"");this.instance_material=[];for(var D=0;D<C.childNodes.length;D++){var z=C.childNodes[D];if(z.nodeType==1&&z.nodeName=="bind_material"){if(C=ac.evaluate(".//dae:instance_material",z,B,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null)){for(D=C.iterateNext();D;){this.instance_material.push((new ak).parse(D)),D=C.iterateNext()}}break}}return this};aj.prototype.parse=function(C){this.id=C.getAttribute("id");for(var D=0;D<C.childNodes.length;D++){var z=C.childNodes[D];switch(z.nodeName){case"mesh":this.mesh=(new ao(this)).parse(z)}}return this};ao.prototype.parse=function(N){function Q(Z,T){var Y=G(Z.position);D[Y]===void 0&&(D[Y]={v:Z,index:T});return D[Y]}this.primitives=[];var z;for(z=0;z<N.childNodes.length;z++){var C=N.childNodes[z];switch(C.nodeName){case"source":t(C);break;case"vertices":this.vertices=(new y).parse(C);break;case"triangles":this.primitives.push((new aq).parse(C));break;case"polygons":console.warn("polygon holes not yet supported!");case"polylist":this.primitives.push((new h).parse(C))}}var D={};this.geometry3js=new c.Geometry;C=q[this.vertices.input.POSITION.source].data;for(N=z=0;z<C.length;z+=3,N++){var L=new c.Vertex(new c.Vector3(C[z],C[z+1],C[z+2]));Q(L,N);this.geometry3js.vertices.push(L)}for(z=0;z<this.primitives.length;z++){N=this.primitives[z],N.setVertices(this.vertices),this.handlePrimitive(N,this.geometry3js,D)}this.geometry3js.computeCentroids();this.geometry3js.computeFaceNormals();this.geometry3js.computeVertexNormals();this.geometry3js.computeBoundingBox();return this};ao.prototype.handlePrimitive=function(z,C,D){var L=0,N,Q,T=z.p,Y=z.inputs,at,aw,ay,aA,aB=0,aC=3,aD=[];for(N=0;N<Y.length;N++){switch(at=Y[N],at.semantic){case"TEXCOORD":aD.push(at.set)}}for(;L<T.length;){var Z=[],au=[],av={},az=[];z.vcount&&(aC=z.vcount[aB++]);for(N=0;N<aC;N++){for(Q=0;Q<Y.length;Q++){switch(at=Y[Q],aA=q[at.source],aw=T[L+N*Y.length+at.offset],ay=aA.accessor.params.length,ay*=aw,at.semantic){case"VERTEX":at=G(C.vertices[aw].position);Z.push(D[at].index);break;case"NORMAL":au.push(new c.Vector3(aA.data[ay],aA.data[ay+1],aA.data[ay+2]));break;case"TEXCOORD":av[at.set]===void 0&&(av[at.set]=[]);av[at.set].push(new c.UV(aA.data[ay],aA.data[ay+1]));break;case"COLOR":az.push((new c.Color).setRGB(aA.data[ay],aA.data[ay+1],aA.data[ay+2]))}}}var ax;aC==3?ax=new c.Face3(Z[0],Z[1],Z[2],[au[0],au[1],au[2]],az.length?az:new c.Color):aC==4&&(ax=new c.Face4(Z[0],Z[1],Z[2],Z[3],[au[0],au[1],au[2],au[3]],az.length?az:new c.Color));ax.daeMaterial=z.material;C.faces.push(ax);for(Q=0;Q<aD.length;Q++){N=av[aD[Q]],C.faceVertexUvs[Q].push([N[0],N[1],N[2]])}L+=Y.length*aC}};h.prototype=new aq;h.prototype.constructor=h;aq.prototype.setVertices=function(z){for(var C=0;C<this.inputs.length;C++){if(this.inputs[C].source==z.id){this.inputs[C].source=z.input.POSITION.source}}};aq.prototype.parse=function(C){this.inputs=[];this.material=C.getAttribute("material");this.count=k(C,"count",0);for(var D=0;D<C.childNodes.length;D++){var z=C.childNodes[D];switch(z.nodeName){case"input":this.inputs.push((new v).parse(C.childNodes[D]));break;case"vcount":this.vcount=E(z.textContent);break;case"p":this.p=E(z.textContent)}}return this};w.prototype.parse=function(D){this.params=[];this.source=D.getAttribute("source");this.count=k(D,"count",0);this.stride=k(D,"stride",0);for(var L=0;L<D.childNodes.length;L++){var z=D.childNodes[L];if(z.nodeName=="param"){var C={};C.name=z.getAttribute("name");C.type=z.getAttribute("type");this.params.push(C)}}return this};y.prototype.parse=function(C){this.id=C.getAttribute("id");for(var D=0;D<C.childNodes.length;D++){if(C.childNodes[D].nodeName=="input"){var z=(new v).parse(C.childNodes[D]);this.input[z.semantic]=z}}return this};v.prototype.parse=function(z){this.semantic=z.getAttribute("semantic");this.source=z.getAttribute("source").replace(/^#/,"");this.set=k(z,"set",-1);this.offset=k(z,"offset",0);if(this.semantic=="TEXCOORD"&&this.set<0){this.set=0}return this};j.prototype.parse=function(N){this.id=N.getAttribute("id");for(var Q=0;Q<N.childNodes.length;Q++){var z=N.childNodes[Q];switch(z.nodeName){case"bool_array":for(var C=J(z.textContent),D=[],L=0;L<C.length;L++){D.push(C[L]=="true"||C[L]=="1"?!0:!1)}this.data=D;this.type=z.nodeName;break;case"float_array":this.data=A(z.textContent);this.type=z.nodeName;break;case"int_array":this.data=E(z.textContent);this.type=z.nodeName;break;case"IDREF_array":case"Name_array":this.data=J(z.textContent);this.type=z.nodeName;break;case"technique_common":for(C=0;C<z.childNodes.length;C++){if(z.childNodes[C].nodeName=="accessor"){this.accessor=(new w).parse(z.childNodes[C]);break}}}}return this};j.prototype.read=function(){var D=[],L=this.accessor.params[0];switch(L.type){case"IDREF":case"Name":case"name":case"float":return this.data;case"float4x4":for(L=0;L<this.data.length;L+=16){var z=this.data.slice(L,L+16),C=new c.Matrix4;C.set(z[0],z[1],z[2],z[3],z[4],z[5],z[6],z[7],z[8],z[9],z[10],z[11],z[12],z[13],z[14],z[15]);D.push(C)}break;default:console.log("ColladaLoader: Source: Read dont know how to read "+L.type+".")}return D};l.prototype.parse=function(z){this.id=z.getAttribute("id");this.name=z.getAttribute("name");for(var C=0;C<z.childNodes.length;C++){if(z.childNodes[C].nodeName=="instance_effect"){this.instance_effect=(new o).parse(z.childNodes[C]);break}}return this};f.prototype.isColor=function(){return this.texture==null};f.prototype.isTexture=function(){return this.texture!=null};f.prototype.parse=function(C){for(var D=0;D<C.childNodes.length;D++){var z=C.childNodes[D];if(z.nodeType==1){switch(z.nodeName){case"color":z=A(z.textContent);this.color=new c.Color(0);this.color.setRGB(z[0],z[1],z[2]);this.color.a=z[3];break;case"texture":this.texture=z.getAttribute("texture"),this.texcoord=z.getAttribute("texcoord")}}}return this};F.prototype.parse=function(N){for(var Q=0;Q<N.childNodes.length;Q++){var z=N.childNodes[Q];if(z.nodeType==1){switch(z.nodeName){case"ambient":case"emission":case"diffuse":case"specular":case"transparent":this[z.nodeName]=(new f).parse(z);break;case"shininess":case"reflectivity":case"transparency":var C;C=ac.evaluate(".//dae:float",z,B,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);for(var D=C.iterateNext(),L=[];D;){L.push(D),D=C.iterateNext()}C=L;C.length>0&&(this[z.nodeName]=parseFloat(C[0].textContent))}}}this.create();return this};F.prototype.create=function(){var D={},L=this.transparency!==void 0&&this.transparency<1,z;for(z in this){switch(z){case"ambient":case"emission":case"diffuse":case"specular":var C=this[z];if(C instanceof f){if(C.isTexture()){if(this.effect.sampler&&this.effect.surface&&this.effect.sampler.source==this.effect.surface.sid&&(C=m[this.effect.surface.init_from])){D.map=c.ImageUtils.loadTexture(an+C.init_from),D.map.wrapS=c.RepeatWrapping,D.map.wrapT=c.RepeatWrapping,D.map.repeat.x=1,D.map.repeat.y=-1}}else{z=="diffuse"?D.color=C.color.getHex():L||(D[z]=C.color.getHex())}}break;case"shininess":case"reflectivity":D[z]=this[z];break;case"transparency":if(L){D.transparent=!0,D.opacity=this[z],L=!0}}}D.shading=n;return this.material=new c.MeshLambertMaterial(D)};am.prototype.parse=function(C){for(var D=0;D<C.childNodes.length;D++){var z=C.childNodes[D];if(z.nodeType==1){switch(z.nodeName){case"init_from":this.init_from=z.textContent;break;case"format":this.format=z.textContent;break;default:console.log("unhandled Surface prop: "+z.nodeName)}}}return this};x.prototype.parse=function(C){for(var D=0;D<C.childNodes.length;D++){var z=C.childNodes[D];if(z.nodeType==1){switch(z.nodeName){case"source":this.source=z.textContent;break;case"minfilter":this.minfilter=z.textContent;break;case"magfilter":this.magfilter=z.textContent;break;case"mipfilter":this.mipfilter=z.textContent;break;case"wrap_s":this.wrap_s=z.textContent;break;case"wrap_t":this.wrap_t=z.textContent;break;default:console.log("unhandled Sampler2D prop: "+z.nodeName)}}}return this};e.prototype.create=function(){if(this.shader==null){return null}};e.prototype.parse=function(C){this.id=C.getAttribute("id");this.name=C.getAttribute("name");this.shader=null;for(var D=0;D<C.childNodes.length;D++){var z=C.childNodes[D];if(z.nodeType==1){switch(z.nodeName){case"profile_COMMON":this.parseTechnique(this.parseProfileCOMMON(z))}}}return this};e.prototype.parseNewparam=function(D){for(var L=D.getAttribute("sid"),z=0;z<D.childNodes.length;z++){var C=D.childNodes[z];if(C.nodeType==1){switch(C.nodeName){case"surface":this.surface=(new am(this)).parse(C);this.surface.sid=L;break;case"sampler2D":this.sampler=(new x(this)).parse(C);this.sampler.sid=L;break;case"extra":break;default:console.log(C.nodeName)}}}};e.prototype.parseProfileCOMMON=function(D){for(var L,z=0;z<D.childNodes.length;z++){var C=D.childNodes[z];if(C.nodeType==1){switch(C.nodeName){case"profile_COMMON":this.parseProfileCOMMON(C);break;case"technique":L=C;break;case"newparam":this.parseNewparam(C);break;case"extra":break;default:console.log(C.nodeName)}}}return L};e.prototype.parseTechnique=function(C){for(var D=0;D<C.childNodes.length;D++){var z=C.childNodes[D];if(z.nodeType==1){switch(z.nodeName){case"lambert":case"blinn":case"phong":this.shader=(new F(z.nodeName,this)).parse(z)}}}};o.prototype.parse=function(z){this.url=z.getAttribute("url").replace(/^#/,"");return this};H.prototype.parse=function(C){this.id=C.getAttribute("id");this.name=C.getAttribute("name");this.source={};for(var D=0;D<C.childNodes.length;D++){var z=C.childNodes[D];if(z.nodeType==1){switch(z.nodeName){case"source":z=(new j).parse(z);this.source[z.id]=z;break;case"sampler":this.sampler.push((new K(this)).parse(z));break;case"channel":this.channel.push((new a(this)).parse(z))}}}return this};a.prototype.parse=function(N){this.source=N.getAttribute("source").replace(/^#/,"");this.target=N.getAttribute("target");var Q=this.target.split("/");Q.shift();var N=Q.shift(),z=N.indexOf(".")>=0,C=N.indexOf("(")>=0,D,L;if(z){Q=N.split("."),N=Q.shift(),L=Q.shift()}else{if(C){D=N.split("(");N=D.shift();for(Q=0;Q<D.length;Q++){D[Q]=parseInt(D[Q].replace(/\)/,""))}}}this.sid=N;this.dotSyntax=z;this.arrSyntax=C;this.arrIndices=D;this.member=L;return this};K.prototype.parse=function(C){this.id=C.getAttribute("id");this.inputs=[];for(var D=0;D<C.childNodes.length;D++){var z=C.childNodes[D];if(z.nodeType==1){switch(z.nodeName){case"input":this.inputs.push((new v).parse(z))}}}return this};K.prototype.create=function(){for(var C=0;C<this.inputs.length;C++){var D=this.inputs[C],z=this.animation.source[D.source];switch(D.semantic){case"INPUT":this.input=z.read();break;case"OUTPUT":this.output=z.read();break;case"INTERPOLATION":this.interpolation=z.read();break;case"IN_TANGENT":break;case"OUT_TANGENT":break;default:console.log(D.semantic)}}this.duration=this.endTime=this.startTime=0;if(this.input.length){this.startTime=100000000;this.endTime=-100000000;for(C=0;C<this.input.length;C++){this.startTime=Math.min(this.startTime,this.input[C]),this.endTime=Math.max(this.endTime,this.input[C])}this.duration=this.endTime-this.startTime}};return{load:function(D,z){if(document.implementation&&document.implementation.createDocument){document.implementation.createDocument("http://www.collada.org/2005/11/COLLADASchema","COLLADA",null);D+="?rnd="+Math.random();var C=new XMLHttpRequest;C.overrideMimeType&&C.overrideMimeType("text/xml");C.onreadystatechange=function(){if(C.readyState==4&&(C.status==0||C.status==200)){s=z,P(C.responseXML,void 0,D)}};C.open("GET",D,!0);C.send(null)}else{alert("Don't know how to parse XML!")}},parse:P,setPreferredShading:function(z){n=z},applySkin:X,geometries:r}};c.JSONLoader=function(a){c.Loader.call(this,a)};c.JSONLoader.prototype=new c.Loader;c.JSONLoader.prototype.constructor=c.JSONLoader;c.JSONLoader.prototype.supr=c.Loader.prototype;c.JSONLoader.prototype.load=function(b,a,g){if(b instanceof Object){console.warn("DEPRECATED: JSONLoader( parameters ) is now JSONLoader( url, callback, texturePath )."),g=b,b=g.model,a=g.callback,g=g.texture_path}g=g?g:this.extractUrlbase(b);this.onLoadStart();this.loadAjaxJSON(this,b,a,g)};c.JSONLoader.prototype.loadAjaxJSON=function(g,p,o,a,f){var e=new XMLHttpRequest,b=0;e.onreadystatechange=function(){if(e.readyState==4){if(e.status==200||e.status==0){try{var h=JSON.parse(e.responseText);g.createModel(h,o,a);g.onLoadComplete()}catch(j){console.error(j),console.warn("DEPRECATED: ["+p+"] seems to be using old model format")}}else{console.error("Couldn't load ["+p+"] ["+e.status+"]")}}else{e.readyState==3?f&&(b==0&&(b=e.getResponseHeader("Content-Length")),f({total:b,loaded:e.responseText.length})):e.readyState==2&&(b=e.getResponseHeader("Content-Length"))}};e.open("GET",p,!0);e.overrideMimeType("text/plain; charset=x-user-defined");e.setRequestHeader("Content-Type","text/plain");e.send(null)};c.JSONLoader.prototype.createModel=function(k,a,l){var b=new c.Geometry,g=k.scale!==void 0?1/k.scale:1;this.initMaterials(b,k.materials,l);(function(e){if(k.metadata===void 0||k.metadata.formatVersion===void 0||k.metadata.formatVersion!==3){console.error("Deprecated file format.")}else{var f,h,j,n,m,t,u,o,R,q,A,p,B,r,F=k.faces;t=k.vertices;var x=k.normals,w=k.colors,S=0;for(f=0;f<k.uvs.length;f++){k.uvs[f].length&&S++}for(f=0;f<S;f++){b.faceUvs[f]=[],b.faceVertexUvs[f]=[]}n=0;for(m=t.length;n<m;){u=new c.Vertex,u.position.x=t[n++]*e,u.position.y=t[n++]*e,u.position.z=t[n++]*e,b.vertices.push(u)}n=0;for(m=F.length;n<m;){e=F[n++];t=e&1;j=e&2;f=e&4;h=e&8;o=e&16;u=e&32;q=e&64;e&=128;t?(A=new c.Face4,A.a=F[n++],A.b=F[n++],A.c=F[n++],A.d=F[n++],t=4):(A=new c.Face3,A.a=F[n++],A.b=F[n++],A.c=F[n++],t=3);if(j){j=F[n++],A.materialIndex=j}j=b.faces.length;if(f){for(f=0;f<S;f++){p=k.uvs[f],R=F[n++],r=p[R*2],R=p[R*2+1],b.faceUvs[f][j]=new c.UV(r,R)}}if(h){for(f=0;f<S;f++){p=k.uvs[f];B=[];for(h=0;h<t;h++){R=F[n++],r=p[R*2],R=p[R*2+1],B[h]=new c.UV(r,R)}b.faceVertexUvs[f][j]=B}}if(o){o=F[n++]*3,h=new c.Vector3,h.x=x[o++],h.y=x[o++],h.z=x[o],A.normal=h}if(u){for(f=0;f<t;f++){o=F[n++]*3,h=new c.Vector3,h.x=x[o++],h.y=x[o++],h.z=x[o],A.vertexNormals.push(h)}}if(q){u=F[n++],u=new c.Color(w[u]),A.color=u}if(e){for(f=0;f<t;f++){u=F[n++],u=new c.Color(w[u]),A.vertexColors.push(u)}}b.faces.push(A)}}})(g);(function(){var j,e,f,h;if(k.skinWeights){j=0;for(e=k.skinWeights.length;j<e;j+=2){f=k.skinWeights[j],h=k.skinWeights[j+1],b.skinWeights.push(new c.Vector4(f,h,0,0))}}if(k.skinIndices){j=0;for(e=k.skinIndices.length;j<e;j+=2){f=k.skinIndices[j],h=k.skinIndices[j+1],b.skinIndices.push(new c.Vector4(f,h,0,0))}}b.bones=k.bones;b.animation=k.animation})();(function(j){if(k.morphTargets!==void 0){var m,o,p,z,r,e,f,A,h;m=0;for(o=k.morphTargets.length;m<o;m++){b.morphTargets[m]={};b.morphTargets[m].name=k.morphTargets[m].name;b.morphTargets[m].vertices=[];A=b.morphTargets[m].vertices;h=k.morphTargets[m].vertices;p=0;for(z=h.length;p<z;p+=3){r=h[p]*j,e=h[p+1]*j,f=h[p+2]*j,A.push(new c.Vertex(new c.Vector3(r,e,f)))}}}if(k.morphColors!==void 0){m=0;for(o=k.morphColors.length;m<o;m++){b.morphColors[m]={};b.morphColors[m].name=k.morphColors[m].name;b.morphColors[m].colors=[];z=b.morphColors[m].colors;r=k.morphColors[m].colors;j=0;for(p=r.length;j<p;j+=3){e=new c.Color(16755200),e.setRGB(r[j],r[j+1],r[j+2]),z.push(e)}}}})(g);b.computeCentroids();b.computeFaceNormals();this.hasNormals(b)&&b.computeTangents();a(b)};c.SceneLoader=function(){this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){};this.callbackSync=function(){};this.callbackProgress=function(){}};c.SceneLoader.prototype.constructor=c.SceneLoader;c.SceneLoader.prototype.load=function(j,a){var k=this,b=new XMLHttpRequest;b.onreadystatechange=function(){if(b.readyState==4){if(b.status==200||b.status==0){try{var f=JSON.parse(b.responseText);f.metadata===void 0||f.metadata.formatVersion===void 0||f.metadata.formatVersion!==3?console.error("Deprecated file format."):k.createScene(f,a,j)}catch(e){console.error(e),console.warn("DEPRECATED: ["+j+"] seems to be using old model format")}}else{console.error("Couldn't load ["+j+"] ["+b.status+"]")}}};b.open("GET",j,!0);b.overrideMimeType("text/plain; charset=x-user-defined");b.setRequestHeader("Content-Type","text/plain");b.send(null)};c.SceneLoader.prototype.createScene=function(f,l,h){function m(j,z){return z=="relativeToHTML"?j:y+"/"+j}function s(){var j;for(G in ae.objects){if(!q.objects[G]){if(K=ae.objects[G],K.geometry!==void 0){if(U=q.geometries[K.geometry]){j=!1;for(u=0;u<K.materials.length;u++){k=q.materials[K.materials[u]],j=k instanceof c.ShaderMaterial}j&&U.computeTangents();g=K.position;n=K.rotation;e=K.quaternion;ad=K.scale;e=0;k.length==0&&(k=new c.MeshFaceMaterial);k.length>1&&(k=new c.MeshFaceMaterial);j=new c.Mesh(U,k);j.name=G;j.position.set(g[0],g[1],g[2]);e?(j.quaternion.set(e[0],e[1],e[2],e[3]),j.useQuaternion=!0):j.rotation.set(n[0],n[1],n[2]);j.scale.set(ad[0],ad[1],ad[2]);j.visible=K.visible;q.scene.add(j);q.objects[G]=j;if(K.meshCollider){var z=c.CollisionUtils.MeshColliderWBox(j);q.scene.collisions.colliders.push(z)}if(K.castsShadow){z=new c.ShadowVolume(U),q.scene.add(z),z.position=j.position,z.rotation=j.rotation,z.scale=j.scale}K.trigger&&K.trigger.toLowerCase()!="none"&&(z={type:K.trigger,object:K},q.triggers[j.name]=z)}}else{g=K.position,n=K.rotation,e=K.quaternion,ad=K.scale,e=0,j=new c.Object3D,j.name=G,j.position.set(g[0],g[1],g[2]),e?(j.quaternion.set(e[0],e[1],e[2],e[3]),j.useQuaternion=!0):j.rotation.set(n[0],n[1],n[2]),j.scale.set(ad[0],ad[1],ad[2]),j.visible=K.visible!==void 0?K.visible:!1,q.scene.add(j),q.objects[G]=j,q.empties[G]=j,K.trigger&&K.trigger.toLowerCase()!="none"&&(z={type:K.trigger,object:K},q.triggers[j.name]=z)}}}}function r(j){return function(z){q.geometries[j]=z;s();A-=1;v.onLoadComplete();t()}}function p(j){return function(z){q.geometries[j]=z}}function t(){v.callbackProgress({totalModels:O,totalTextures:b,loadedModels:O-A,loadedTextures:b-R},q);v.onLoadProgress();A==0&&R==0&&l(q)}var v=this,y=c.Loader.prototype.extractUrlbase(h),w,F,G,B,I,E,H,K,ac,P,g,n,e,ad,a,U,x,J,k,ae,af,A,R,O,b,q;ae=f;h=new c.BinaryLoader;af=new c.JSONLoader;R=A=0;q={scene:new c.Scene,geometries:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},triggers:{},empties:{}};f=!1;for(G in ae.objects){if(K=ae.objects[G],K.meshCollider){f=!0;break}}if(f){q.scene.collisions=new c.CollisionSystem}if(ae.transform){f=ae.transform.position;ac=ae.transform.rotation;var o=ae.transform.scale;f&&q.scene.position.set(f[0],f[1],f[2]);ac&&q.scene.rotation.set(ac[0],ac[1],ac[2]);o&&q.scene.scale.set(o[0],o[1],o[2]);(f||ac||o)&&q.scene.updateMatrix()}f=function(){R-=1;t();v.onLoadComplete()};for(I in ae.cameras){ac=ae.cameras[I],ac.type=="perspective"?x=new c.PerspectiveCamera(ac.fov,ac.aspect,ac.near,ac.far):ac.type=="ortho"&&(x=new c.OrthographicCamera(ac.left,ac.right,ac.top,ac.bottom,ac.near,ac.far)),g=ac.position,ac=ac.target,x.position.set(g[0],g[1],g[2]),x.target=new c.Vector3(ac[0],ac[1],ac[2]),q.cameras[I]=x}for(B in ae.lights){ac=ae.lights[B],I=ac.color!==void 0?ac.color:16777215,x=ac.intensity!==void 0?ac.intensity:1,ac.type=="directional"?(g=ac.direction,P=new c.DirectionalLight(I,x),P.position.set(g[0],g[1],g[2]),P.position.normalize()):ac.type=="point"?(g=ac.position,P=ac.distance,P=new c.PointLight(I,x,P),P.position.set(g[0],g[1],g[2])):ac.type=="ambient"&&(P=new c.AmbientLight(I)),q.scene.add(P),q.lights[B]=P}for(E in ae.fogs){B=ae.fogs[E],B.type=="linear"?J=new c.Fog(0,B.near,B.far):B.type=="exp2"&&(J=new c.FogExp2(0,B.density)),ac=B.color,J.color.setRGB(ac[0],ac[1],ac[2]),q.fogs[E]=J}if(q.cameras&&ae.defaults.camera){q.currentCamera=q.cameras[ae.defaults.camera]}if(q.fogs&&ae.defaults.fog){q.scene.fog=q.fogs[ae.defaults.fog]}ac=ae.defaults.bgcolor;q.bgColor=new c.Color;q.bgColor.setRGB(ac[0],ac[1],ac[2]);q.bgColorAlpha=ae.defaults.bgalpha;for(w in ae.geometries){if(E=ae.geometries[w],E.type=="bin_mesh"||E.type=="ascii_mesh"){A+=1,v.onLoadStart()}}O=A;for(w in ae.geometries){E=ae.geometries[w],E.type=="cube"?(U=new c.CubeGeometry(E.width,E.height,E.depth,E.segmentsWidth,E.segmentsHeight,E.segmentsDepth,null,E.flipped,E.sides),q.geometries[w]=U):E.type=="plane"?(U=new c.PlaneGeometry(E.width,E.height,E.segmentsWidth,E.segmentsHeight),q.geometries[w]=U):E.type=="sphere"?(U=new c.SphereGeometry(E.radius,E.segmentsWidth,E.segmentsHeight),q.geometries[w]=U):E.type=="cylinder"?(U=new c.CylinderGeometry(E.topRad,E.botRad,E.height,E.radSegs,E.heightSegs),q.geometries[w]=U):E.type=="torus"?(U=new c.TorusGeometry(E.radius,E.tube,E.segmentsR,E.segmentsT),q.geometries[w]=U):E.type=="icosahedron"?(U=new c.IcosahedronGeometry(E.subdivisions),q.geometries[w]=U):E.type=="bin_mesh"?h.load(m(E.url,ae.urlBaseType),r(w)):E.type=="ascii_mesh"?af.load(m(E.url,ae.urlBaseType),r(w)):E.type=="embedded_mesh"&&(E=ae.embeds[E.id])&&af.createModel(E,p(w),"")}for(H in ae.textures){if(w=ae.textures[H],w.url instanceof Array){R+=w.url.length;for(E=0;E<w.url.length;E++){v.onLoadStart()}}else{R+=1,v.onLoadStart()}}b=R;for(H in ae.textures){w=ae.textures[H];if(w.mapping!=void 0&&c[w.mapping]!=void 0){w.mapping=new c[w.mapping]}if(w.url instanceof Array){E=[];for(var u=0;u<w.url.length;u++){E[u]=m(w.url[u],ae.urlBaseType)}E=c.ImageUtils.loadTextureCube(E,w.mapping,f)}else{E=c.ImageUtils.loadTexture(m(w.url,ae.urlBaseType),w.mapping,f);if(c[w.minFilter]!=void 0){E.minFilter=c[w.minFilter]}if(c[w.magFilter]!=void 0){E.magFilter=c[w.magFilter]}if(w.repeat){E.repeat.set(w.repeat[0],w.repeat[1]);if(w.repeat[0]!=1){E.wrapS=c.RepeatWrapping}if(w.repeat[1]!=1){E.wrapT=c.RepeatWrapping}}w.offset&&E.offset.set(w.offset[0],w.offset[1]);if(w.wrap){J={repeat:c.RepeatWrapping,mirror:c.MirroredRepeatWrapping};if(J[w.wrap[0]]!==void 0){E.wrapS=J[w.wrap[0]]}if(J[w.wrap[1]]!==void 0){E.wrapT=J[w.wrap[1]]}}}q.textures[H]=E}for(F in ae.materials){H=ae.materials[F];for(a in H.parameters){if(a=="envMap"||a=="map"||a=="lightMap"){H.parameters[a]=q.textures[H.parameters[a]]}else{if(a=="shading"){H.parameters[a]=H.parameters[a]=="flat"?c.FlatShading:c.SmoothShading}else{if(a=="blending"){H.parameters[a]=c[H.parameters[a]]?c[H.parameters[a]]:c.NormalBlending}else{if(a=="combine"){H.parameters[a]=H.parameters[a]=="MixOperation"?c.MixOperation:c.MultiplyOperation}else{if(a=="vertexColors"){if(H.parameters[a]=="face"){H.parameters[a]=c.FaceColors}else{if(H.parameters[a]){H.parameters[a]=c.VertexColors}}}}}}}}if(H.parameters.opacity!==void 0&&H.parameters.opacity<1){H.parameters.transparent=!0}if(H.parameters.normalMap){w=c.ShaderUtils.lib.normal;f=c.UniformsUtils.clone(w.uniforms);E=H.parameters.color;J=H.parameters.specular;h=H.parameters.ambient;af=H.parameters.shininess;f.tNormal.texture=q.textures[H.parameters.normalMap];if(H.parameters.normalMapFactor){f.uNormalScale.value=H.parameters.normalMapFactor}if(H.parameters.map){f.tDiffuse.texture=H.parameters.map,f.enableDiffuse.value=!0}if(H.parameters.lightMap){f.tAO.texture=H.parameters.lightMap,f.enableAO.value=!0}if(H.parameters.specularMap){f.tSpecular.texture=q.textures[H.parameters.specularMap],f.enableSpecular.value=!0}f.uDiffuseColor.value.setHex(E);f.uSpecularColor.value.setHex(J);f.uAmbientColor.value.setHex(h);f.uShininess.value=af;if(H.parameters.opacity){f.uOpacity.value=H.parameters.opacity}H=new c.ShaderMaterial({fragmentShader:w.fragmentShader,vertexShader:w.vertexShader,uniforms:f,lights:!0,fog:!0})}else{H=new c[H.type](H.parameters)}q.materials[F]=H}s();v.callbackSync(q);t()};c.UTF8Loader=function(){};c.UTF8Loader.prototype=new c.UTF8Loader;c.UTF8Loader.prototype.constructor=c.UTF8Loader;c.UTF8Loader.prototype.load=function(f,h,g){if(f instanceof Object){console.warn("DEPRECATED: UTF8Loader( parameters ) is now UTF8Loader( url, callback, metaData )."),g=f,f=g.model,h=g.callback,g={scale:g.scale,offsetX:g.offsetX,offsetY:g.offsetY,offsetZ:g.offsetZ}}var q=new XMLHttpRequest,b=g.scale!==void 0?g.scale:1,a=g.offsetX!==void 0?g.offsetX:0,r=g.offsetY!==void 0?g.offsetY:0,e=g.offsetZ!==void 0?g.offsetZ:0;q.onreadystatechange=function(){q.readyState==4?q.status==200||q.status==0?c.UTF8Loader.prototype.createModel(q.responseText,h,b,a,r,e):alert("Couldn't load ["+f+"] ["+q.status+"]"):q.readyState!=3&&q.readyState==2&&q.getResponseHeader("Content-Length")};q.open("GET",f,!0);q.send(null)};c.UTF8Loader.prototype.decompressMesh=function(f){var h=f.charCodeAt(0);h>=57344&&(h-=2048);h++;for(var g=new Float32Array(8*h),q=1,b=0;b<8;b++){for(var a=0,r=0;r<h;++r){var e=f.charCodeAt(r+q);a+=e>>1^-(e&1);g[8*r+b]=a}q+=h}h=f.length-q;a=new Uint16Array(h);for(b=r=0;b<h;b++){e=f.charCodeAt(b+q),a[b]=r-e,e==0&&r++}return[g,a]};c.UTF8Loader.prototype.createModel=function(g,p,o,a,f,e){var b=function(){var l=this;l.materials=[];c.Geometry.call(this);var h=c.UTF8Loader.prototype.decompressMesh(g),k=[],j=[];(function(y,m,q){for(var x,z,n,t=y.length;q<t;q+=m){x=y[q],z=y[q+1],n=y[q+2],x=x/16383*o,z=z/16383*o,n=n/16383*o,x+=a,z+=f,n+=e,l.vertices.push(new c.Vertex(new c.Vector3(x,z,n)))}})(h[0],8,0);(function(x,y,m){for(var n,v,w=x.length;m<w;m+=y){n=x[m],v=x[m+1],n/=1023,v/=1023,j.push(n,1-v)}})(h[0],8,3);(function(z,A,m){for(var n,w,x,y=z.length;m<y;m+=A){n=z[m],w=z[m+1],x=z[m+2],n=(n-512)/511,w=(w-512)/511,x=(x-512)/511,k.push(n,w,x)}})(h[0],8,5);(function(m){var n,s,u,v,w,x,S,R,B,y=m.length;for(n=0;n<y;n+=3){s=m[n];u=m[n+1];v=m[n+2];w=l;R=s;B=u;x=v;S=s;var A=u,T=v,U=w.materials[0],F=k[A*3],V=k[A*3+1],A=k[A*3+2],E=k[T*3],J=k[T*3+1],T=k[T*3+2];S=new c.Vector3(k[S*3],k[S*3+1],k[S*3+2]);A=new c.Vector3(F,V,A);T=new c.Vector3(E,J,T);w.faces.push(new c.Face3(R,B,x,[S,A,T],null,U));w=j[s*2];s=j[s*2+1];x=j[u*2];S=j[u*2+1];R=j[v*2];B=j[v*2+1];v=l.faceVertexUvs[0];u=x;x=S;S=[];S.push(new c.UV(w,s));S.push(new c.UV(u,x));S.push(new c.UV(R,B));v.push(S)}})(h[1]);this.computeCentroids();this.computeFaceNormals()};b.prototype=new c.Geometry;b.prototype.constructor=b;p(new b)};c.Axes=function(){c.Object3D.call(this);var b=new c.Geometry;b.vertices.push(new c.Vertex);b.vertices.push(new c.Vertex(new c.Vector3(0,100,0)));var a=new c.CylinderGeometry(0,5,25,5,1),g=new c.Line(b,new c.LineBasicMaterial({color:16711680}));g.rotation.z=-Math.PI/2;this.add(g);g=new c.Mesh(a,new c.MeshBasicMaterial({color:16711680}));g.position.x=100;g.rotation.z=-Math.PI/2;this.add(g);g=new c.Line(b,new c.LineBasicMaterial({color:65280}));this.add(g);g=new c.Mesh(a,new c.MeshBasicMaterial({color:65280}));g.position.y=100;this.add(g);g=new c.Line(b,new c.LineBasicMaterial({color:255}));g.rotation.x=Math.PI/2;this.add(g);g=new c.Mesh(a,new c.MeshBasicMaterial({color:255}));g.position.z=100;g.rotation.x=Math.PI/2;this.add(g)};c.Axes.prototype=new c.Object3D;c.Axes.prototype.constructor=c.Axes;c.MarchingCubes=function(b,a){c.Object3D.call(this);this.material=a;this.init=function(e){this.resolution=e;this.isolation=80;this.size=e;this.size2=this.size*this.size;this.size3=this.size2*this.size;this.halfsize=this.size/2;this.delta=2/this.size;this.yd=this.size;this.zd=this.size2;this.field=new Float32Array(this.size3);this.normal_cache=new Float32Array(this.size3*3);this.vlist=new Float32Array(36);this.nlist=new Float32Array(36);this.firstDraw=!0;this.maxCount=4096;this.count=0;this.hasNormal=this.hasPos=!1;this.positionArray=new Float32Array(this.maxCount*3);this.normalArray=new Float32Array(this.maxCount*3)};this.lerp=function(j,e,g){return j+(e-j)*g};this.VIntX=function(o,w,e,y,x,f,g,k,h,l){x=(x-h)/(l-h);h=this.normal_cache;w[y]=f+x*this.delta;w[y+1]=g;w[y+2]=k;e[y]=this.lerp(h[o],h[o+3],x);e[y+1]=this.lerp(h[o+1],h[o+4],x);e[y+2]=this.lerp(h[o+2],h[o+5],x)};this.VIntY=function(o,w,e,y,x,f,g,k,h,l){x=(x-h)/(l-h);h=this.normal_cache;w[y]=f;w[y+1]=g+x*this.delta;w[y+2]=k;w=o+this.yd*3;e[y]=this.lerp(h[o],h[w],x);e[y+1]=this.lerp(h[o+1],h[w+1],x);e[y+2]=this.lerp(h[o+2],h[w+2],x)};this.VIntZ=function(o,w,e,y,x,f,g,k,h,l){x=(x-h)/(l-h);h=this.normal_cache;w[y]=f;w[y+1]=g;w[y+2]=k+x*this.delta;w=o+this.zd*3;e[y]=this.lerp(h[o],h[w],x);e[y+1]=this.lerp(h[o+1],h[w+1],x);e[y+2]=this.lerp(h[o+2],h[w+2],x)};this.compNorm=function(h){var e=h*3;this.normal_cache[e]===0&&(this.normal_cache[e]=this.field[h-1]-this.field[h+1],this.normal_cache[e+1]=this.field[h-this.yd]-this.field[h+this.yd],this.normal_cache[e+2]=this.field[h-this.zd]-this.field[h+this.zd])};this.polygonize=function(ad,ae,g,f,e,h){var k=f+1,m=f+this.yd,l=f+this.zd,p=k+this.yd,q=k+this.zd,n=f+this.yd+this.zd,u=k+this.yd+this.zd,o=0,s=this.field[f],x=this.field[k],F=this.field[m],y=this.field[p],t=this.field[l],A=this.field[q],r=this.field[n],J=this.field[u];s<e&&(o|=1);x<e&&(o|=2);F<e&&(o|=8);y<e&&(o|=4);t<e&&(o|=16);A<e&&(o|=32);r<e&&(o|=128);J<e&&(o|=64);var w=c.edgeTable[o];if(w===0){return 0}var B=this.delta,ac=ad+B,v=ae+B,B=g+B;w&1&&(this.compNorm(f),this.compNorm(k),this.VIntX(f*3,this.vlist,this.nlist,0,e,ad,ae,g,s,x));w&2&&(this.compNorm(k),this.compNorm(p),this.VIntY(k*3,this.vlist,this.nlist,3,e,ac,ae,g,x,y));w&4&&(this.compNorm(m),this.compNorm(p),this.VIntX(m*3,this.vlist,this.nlist,6,e,ad,v,g,F,y));w&8&&(this.compNorm(f),this.compNorm(m),this.VIntY(f*3,this.vlist,this.nlist,9,e,ad,ae,g,s,F));w&16&&(this.compNorm(l),this.compNorm(q),this.VIntX(l*3,this.vlist,this.nlist,12,e,ad,ae,B,t,A));w&32&&(this.compNorm(q),this.compNorm(u),this.VIntY(q*3,this.vlist,this.nlist,15,e,ac,ae,B,A,J));w&64&&(this.compNorm(n),this.compNorm(u),this.VIntX(n*3,this.vlist,this.nlist,18,e,ad,v,B,r,J));w&128&&(this.compNorm(l),this.compNorm(n),this.VIntY(l*3,this.vlist,this.nlist,21,e,ad,ae,B,t,r));w&256&&(this.compNorm(f),this.compNorm(l),this.VIntZ(f*3,this.vlist,this.nlist,24,e,ad,ae,g,s,t));w&512&&(this.compNorm(k),this.compNorm(q),this.VIntZ(k*3,this.vlist,this.nlist,27,e,ac,ae,g,x,A));w&1024&&(this.compNorm(p),this.compNorm(u),this.VIntZ(p*3,this.vlist,this.nlist,30,e,ac,v,g,y,J));w&2048&&(this.compNorm(m),this.compNorm(n),this.VIntZ(m*3,this.vlist,this.nlist,33,e,ad,v,g,F,r));o<<=4;for(e=f=0;c.triTable[o+e]!=-1;){ad=o+e,ae=ad+1,g=ad+2,this.posnormtriv(this.vlist,this.nlist,3*c.triTable[ad],3*c.triTable[ae],3*c.triTable[g],h),e+=3,f++}return f};this.posnormtriv=function(h,q,e,s,r,f){var g=this.count*3;this.positionArray[g]=h[e];this.positionArray[g+1]=h[e+1];this.positionArray[g+2]=h[e+2];this.positionArray[g+3]=h[s];this.positionArray[g+4]=h[s+1];this.positionArray[g+5]=h[s+2];this.positionArray[g+6]=h[r];this.positionArray[g+7]=h[r+1];this.positionArray[g+8]=h[r+2];this.normalArray[g]=q[e];this.normalArray[g+1]=q[e+1];this.normalArray[g+2]=q[e+2];this.normalArray[g+3]=q[s];this.normalArray[g+4]=q[s+1];this.normalArray[g+5]=q[s+2];this.normalArray[g+6]=q[r];this.normalArray[g+7]=q[r+1];this.normalArray[g+8]=q[r+2];this.hasNormal=this.hasPos=!0;this.count+=3;this.count>=this.maxCount-3&&f(this)};this.begin=function(){this.count=0;this.hasNormal=this.hasPos=!1};this.end=function(h){if(this.count!==0){for(var e=this.count*3;e<this.positionArray.length;e++){this.positionArray[e]=0}h(this)}};this.addBall=function(e,f,n,l,h){var o=this.size*Math.sqrt(l/h),q=n*this.size,u=f*this.size,r=e*this.size,N=Math.floor(q-o);N<1&&(N=1);q=Math.floor(q+o);q>this.size-1&&(q=this.size-1);var g=Math.floor(u-o);g<1&&(g=1);u=Math.floor(u+o);u>this.size-1&&(u=this.size-1);var w=Math.floor(r-o);w<1&&(w=1);o=Math.floor(r+o);o>this.size-1&&(o=this.size-1);for(var m,M,k,p,O,t;N<q;N++){r=this.size2*N;M=N/this.size-n;O=M*M;for(M=g;M<u;M++){k=r+this.size*M;m=M/this.size-f;t=m*m;for(m=w;m<o;m++){p=m/this.size-e,p=l/(0.000001+p*p+t+O)-h,p>0&&(this.field[k+m]+=p)}}}};this.addPlaneX=function(k,l){var p,o,m,A,B,e=this.size,C=this.yd,g=this.zd,h=this.field,f=e*Math.sqrt(k/l);f>e&&(f=e);for(p=0;p<f;p++){if(o=p/e,o*=o,A=k/(0.0001+o)-l,A>0){for(o=0;o<e;o++){B=p+o*C;for(m=0;m<e;m++){h[g*m+B]+=A}}}}};this.addPlaneY=function(f,g){var o,m,l,p,r,D,C=this.size,e=this.yd,h=this.zd,E=this.field,k=C*Math.sqrt(f/g);k>C&&(k=C);for(m=0;m<k;m++){if(o=m/C,o*=o,p=f/(0.0001+o)-g,p>0){r=m*e;for(o=0;o<C;o++){D=r+o;for(l=0;l<C;l++){E[h*l+D]+=p}}}}};this.addPlaneZ=function(f,g){var o,m,l,p,r,D,C=this.size,e=this.yd,h=this.zd,E=this.field,k=C*Math.sqrt(f/g);k>C&&(k=C);for(l=0;l<k;l++){if(o=l/C,o*=o,p=f/(0.0001+o)-g,p>0){r=h*l;for(m=0;m<C;m++){D=r+m*e;for(o=0;o<C;o++){E[D+o]+=p}}}}};this.reset=function(){var e;for(e=0;e<this.size3;e++){this.normal_cache[e*3]=0,this.field[e]=0}};this.render=function(l){this.begin();var o,z,y,p,A,e,g,f,h,k=this.size-2;for(p=1;p<k;p++){h=this.size2*p;g=(p-this.halfsize)/this.halfsize;for(y=1;y<k;y++){f=h+this.size*y;e=(y-this.halfsize)/this.halfsize;for(z=1;z<k;z++){A=(z-this.halfsize)/this.halfsize,o=f+z,this.polygonize(A,e,g,o,this.isolation,l)}}}this.end(l)};this.generateGeometry=function(){var j=0,e=new c.Geometry,g=[];this.render(function(v){var p,w,f,k,h,m,o,l;for(p=0;p<v.count;p++){o=p*3,h=o+1,l=o+2,w=v.positionArray[o],f=v.positionArray[h],k=v.positionArray[l],m=new c.Vector3(w,f,k),w=v.normalArray[o],f=v.normalArray[h],k=v.normalArray[l],o=new c.Vector3(w,f,k),o.normalize(),h=new c.Vertex(m),e.vertices.push(h),g.push(o)}m=v.count/3;for(p=0;p<m;p++){o=(j+p)*3,h=o+1,l=o+2,w=g[o],f=g[h],k=g[l],o=new c.Face3(o,h,l,[w,f,k]),e.faces.push(o)}j+=m;v.count=0});return e};this.init(b)};c.MarchingCubes.prototype=new c.Object3D;c.MarchingCubes.prototype.constructor=c.MarchingCubes;c.edgeTable=new Int32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]);c.triTable=new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]);if(c.WebGLRenderer){c.AnaglyphWebGLRenderer=function(G){c.WebGLRenderer.call(this,G);this.autoUpdateScene=!1;var a=this,I=this.setSize,e=this.render,k=new c.PerspectiveCamera,g=new c.PerspectiveCamera,f=new c.Matrix4,l=new c.Matrix4,m,o,n,H;k.matrixAutoUpdate=g.matrixAutoUpdate=!1;var G={minFilter:c.LinearFilter,magFilter:c.NearestFilter,format:c.RGBAFormat},b=new c.WebGLRenderTarget(512,512,G),p=new c.WebGLRenderTarget(512,512,G),h=new c.PerspectiveCamera(53,1,1,10000);h.position.z=2;var G=new c.ShaderMaterial({uniforms:{mapLeft:{type:"t",value:0,texture:b},mapRight:{type:"t",value:1,texture:p}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D mapLeft;\nuniform sampler2D mapRight;\nvarying vec2 vUv;\nvoid main() {\nvec4 colorL, colorR;\nvec2 uv = vUv;\ncolorL = texture2D( mapLeft, uv );\ncolorR = texture2D( mapRight, uv );\ngl_FragColor = vec4( colorL.g * 0.7 + colorL.b * 0.3, colorR.g, colorR.b, colorL.a + colorR.a ) * 1.1;\n}"}),r=new c.Scene;r.add(new c.Mesh(new c.PlaneGeometry(2,2),G));r.add(h);this.setSize=function(q,j){I.call(a,q,j);b.width=q;b.height=j;p.width=q;p.height=j};this.render=function(t,v){t.updateMatrixWorld();if(m!==v.aspect||o!==v.near||n!==v.far||H!==v.fov){m=v.aspect;o=v.near;n=v.far;H=v.fov;var u=v.projectionMatrix.clone(),s=125/30*0.5,j=s*o/125,q=o*Math.tan(H*Math.PI/360),w;f.n14=s;l.n14=-s;s=-q*m+j;w=q*m+j;u.n11=2*o/(w-s);u.n13=(w+s)/(w-s);k.projectionMatrix.copy(u);s=-q*m-j;w=q*m-j;u.n11=2*o/(w-s);u.n13=(w+s)/(w-s);g.projectionMatrix.copy(u)}k.matrixWorld.copy(v.matrixWorld).multiplySelf(l);k.position.copy(v.position);k.near=v.near;k.far=v.far;e.call(a,t,k,b,!0);g.matrixWorld.copy(v.matrixWorld).multiplySelf(f);g.position.copy(v.position);g.near=v.near;g.far=v.far;e.call(a,t,g,p,!0);r.updateMatrixWorld();e.call(a,r,h)}}}if(c.WebGLRenderer){c.CrosseyedWebGLRenderer=function(f){c.WebGLRenderer.call(this,f);this.autoClear=!1;var h=this,g=this.setSize,q=this.render,b,a,r=new c.PerspectiveCamera;r.target=new c.Vector3(0,0,0);var e=new c.PerspectiveCamera;e.target=new c.Vector3(0,0,0);h.separation=10;if(f&&f.separation!==void 0){h.separation=f.separation}this.setSize=function(k,j){g.call(h,k,j);b=k/2;a=j};this.render=function(j,k){this.clear();r.fov=k.fov;r.aspect=0.5*k.aspect;r.near=k.near;r.far=k.far;r.updateProjectionMatrix();r.position.copy(k.position);r.target.copy(k.target);r.translateX(h.separation);r.lookAt(r.target);e.projectionMatrix=r.projectionMatrix;e.position.copy(k.position);e.target.copy(k.target);e.translateX(-h.separation);e.lookAt(e.target);this.setViewport(0,0,b,a);q.call(h,j,r);this.setViewport(b,0,b,a);q.call(h,j,e,!1)}}}return c});define("lib/requestAnimationFrame",[],function(){var h=null;var g=["ms","moz","webkit","o"];for(var f=0;f<g.length&&!h;++f){h=window[g[f]+"RequestAnimationFrame"]}var e=0;if(!h){h=function(a,d){var j=new Date().getTime(),c=Math.max(0,16-(j-e)),b=window.setTimeout(function(){a(j+c)},c);e=j+c;return b}}return h});define("lib/cancelAnimationFrame",[],function(){var h=null;var g=["ms","moz","webkit","o"];for(var f=0;f<g.length&&!h;++f){h=window[g[f]+"CancelAnimationFrame"]||window[g[f]+"CancelRequestAnimationFrame"]}var e=0;if(!h){h=function(a){clearTimeout(a)}}return h});define("animator",["jquery","lib/Three","lib/requestAnimationFrame","lib/cancelAnimationFrame"],function(j,m,l,h){var g=function(a){this.opts=j.extend(true,{},g.opts,a);this._isRunning=false;this._actors=[];this._setupScene()};g.opts={mediator:null,container:"body",width:window.innerWidth,height:window.innerHeight,camera:{fov:75,aspect:window.innerWidth/window.innerHeight,near:1,far:10000,pos:[0,0,0]}};var k=g.prototype;k.start=function(){this._isRunning=true;this._render()};k.stop=function(){this._isRunning=false;h(this._timer)};k.isAnimated=function(){return this._isRunning==true};k.addActors=function(a){for(var b=0,c=a.length;b<c;++b){this._actors.push(a[b])}};k.getIntersects=function(e){var c=(e.clientX/this.opts.width)*2-1,d=-(e.clientY/this.opts.height)*2+1,f=new m.Vector3(c,d,0.5),n,b,a=null;this.projector.unprojectVector(f,this.camera);n=new m.Ray(this.camera.position,f.subSelf(this.camera.position).normalize());b=n.intersectObjects(this.scene.objects);return b};k._update=function(){var b=Object.prototype.hasOwnProperty,d=this.opts,c=d.mediator,e=this._actors;for(var a in e){if(b.call(e,a)){e[a]&&e[a].update&&e[a].update()}}c&&c.publish&&c.publish("actorsUpdated",this._timer)};k._render=function(){if(this._isRunning){var a=this;this._timer=l(function(b){a._render()});this._update();this.renderer.render(this.scene,this.camera)}};k._setupScene=function(){var a=this.opts;this.scene=new m.Scene();this.camera=new m.PerspectiveCamera(a.camera.fov,a.camera.aspect,a.camera.near,a.camera.far);this.camera.position=new m.Vector3(a.camera.pos[0],a.camera.pos[1],a.camera.pos[2]);this.scene.add(this.camera);this.renderer=new m.CanvasRenderer();this.renderer.setSize(a.width,a.height);j(this.opts.container).append(this.renderer.domElement);this.projector=new m.Projector()};return g});define("cube",["lib/Three"],function(d){function c(a){a=a||{};this._init(a);this.speedX=0;this.speedY=0;this.speedZ=0;this.rotX=a.rotSpeed[0]||0;this.rotY=a.rotSpeed[1]||0;this.rotZ=a.rotSpeed[2]||0;this.farestDist=0;this.nearestDist=0;this.arrviedEnd="none";this._isAnimated=true}c.prototype.start=function(){this._isAnimated=true};c.prototype.stop=function(){this._isAnimated=false};c.prototype.move=function(a){var b=a.speed;this.speedX=b[0];this.speedY=b[1];this.speedZ=b[2];this.nearestDist=a.near;this.farestDist=a.far};c.prototype.update=function(){if(this._isAnimated){var a=this.mesh;a.rotation.y+=this.rotY;a.rotation.x+=this.rotX;a.rotation.z+=this.rotZ;if(a.position.z<this.nearestDist||a.position.z>this.farestDist){a.position.z+=this.speedZ;a.position.x+=this.speedX;a.position.y+=this.speedY}else{if(a.position.z>=this.nearestDist){this.arrivedEnd="near"}if(a.position.z<=this.farestDist){this.arrviedEnd="far"}}}};c.prototype._init=function(w){var b=[],p,q=w.pos||[],a=w.size||200,t=w.scene,o=w.textures||[];for(var u=0;u<6;u++){var v,r=o[u],s;if(r){s=new d.MeshBasicMaterial({map:d.ImageUtils.loadTexture(r)})}else{s=new d.MeshBasicMaterial({color:Math.random()*16777215})}b.push(s)}p=new d.CubeGeometry(a,a,a,1,1,1,b);this.mesh=new d.Mesh(p,new d.MeshFaceMaterial());this.mesh.position.x=q[0]||0;this.mesh.position.y=q[1]||0;this.mesh.position.z=q[2]||0;this.mesh.overdraw=true;t&&t.add&&t.add(this.mesh)};return c});define("textParticle",["lib/Three"],function(e){var d=function(){var r=new e.Vector3(),o,p=600,n=700,b=200,c,q=160,t=4,s=0.01,a=false;this.position=new e.Vector3();this.velocity=new e.Vector3();o=new e.Vector3();this.setGoal=function(g){c=g};this.setAvoidWalls=function(g){a=g};this.setWorldSize=function(h,j,g){p=h;n=j;r;b=g};this.run=function(g){if(a){r.set(-p,this.position.y,this.position.z);r=this.avoid(r);r.multiplyScalar(5);o.addSelf(r);r.set(p,this.position.y,this.position.z);r=this.avoid(r);r.multiplyScalar(5);o.addSelf(r);r.set(this.position.x,-n,this.position.z);r=this.avoid(r);r.multiplyScalar(5);o.addSelf(r);r.set(this.position.x,n,this.position.z);r=this.avoid(r);r.multiplyScalar(5);o.addSelf(r);r.set(this.position.x,this.position.y,-b);r=this.avoid(r);r.multiplyScalar(5);o.addSelf(r);r.set(this.position.x,this.position.y,b);r=this.avoid(r);r.multiplyScalar(5);o.addSelf(r)}if(Math.random()>0.5){this.flock(g)}this.move()};this.flock=function(g){if(c){o.addSelf(this.reach(c,0.005))}o.addSelf(this.alignment(g));o.addSelf(this.cohesion(g));o.addSelf(this.separation(g))};this.move=function(){this.velocity.addSelf(o);var g=this.velocity.length();if(g>t){this.velocity.divideScalar(g/t)}this.position.addSelf(this.velocity);o.set(0,0,0)};this.checkBounds=function(){if(this.position.x>p){this.position.x=-p}if(this.position.x<-p){this.position.x=p}if(this.position.y>n){this.position.y=-n}if(this.position.y<-n){this.position.y=n}if(this.position.z>b){this.position.z=-b}if(this.position.z<-b){this.position.z=b}};this.avoid=function(g){var h=new e.Vector3();h.copy(this.position);h.subSelf(g);h.multiplyScalar(1/this.position.distanceToSquared(g));return h};this.repulse=function(h){var g=this.position.distanceTo(h);if(g<250){var j=new e.Vector3();j.sub(this.position,h);j.multiplyScalar(0.5/g);o.addSelf(j)}};this.reach=function(g,h){var j=new e.Vector3();j.sub(g,this.position);j.multiplyScalar(h);return j};this.alignment=function(h){var g,l=new e.Vector3(),j=0;for(var k=0,m=h.length;k<m;k++){if(Math.random()>0.6){continue}g=h[k];distance=g.position.distanceTo(this.position);if(distance>0&&distance<=q){l.addSelf(g.velocity);j++}}if(j>0){l.divideScalar(j);var u=l.length();if(u>s){l.divideScalar(u/s)}}return l};this.cohesion=function(g){var w,l,j=new e.Vector3(),x=new e.Vector3(),y=0;for(var h=0,m=g.length;h<m;h++){if(Math.random()>0.6){continue}w=g[h];l=w.position.distanceTo(this.position);if(l>0&&l<=q){j.addSelf(w.position);y++}}if(y>0){j.divideScalar(y)}x.sub(j,this.position);var k=x.length();if(k>s){x.divideScalar(k/s)}return x};this.separation=function(k){var h,g,m=new e.Vector3(),j=new e.Vector3();for(var l=0,u=k.length;l<u;l++){if(Math.random()>0.6){continue}h=k[l];g=h.position.distanceTo(this.position);if(g>0&&g<=q){j.sub(this.position,h.position);j.normalize();j.divideScalar(g);m.addSelf(j)}}return m}};function f(a){a=a||{};this._init(a)}f.prototype.update=function(){var c=Math.random(),l=0,a,b;if(c>=0.55){l=0.002}for(var k=0,m=this.particles.length;k<m;k++){a=this.boids[k];a.run(this.boids);b=this.particles[k];l&&(b.material.opacity-=l);if(b.material.opacity<0){b.material.opacity=1}a&&a.repulse(new e.Vector3(-20,-20,0))}};f.prototype._init=function(s){var p=s.amount||26,a=s.textures||[],c=s.opacitys||[],q=s.scene,b;this.particles=[];this.boids=[];for(var r=0;r<p;r++){b=this.boids[r]=new d();b.position.x=Math.random()*300-200;b.position.y=Math.random()*400-200;b.position.z=Math.random()*400-200;b.velocity.x=Math.random()*2-1.5;b.velocity.y=Math.random()*2-1.5;b.velocity.z=Math.random()*2-1.5;b.setAvoidWalls(true);b.setWorldSize(800,400,900);var o=c[r]||(0.1+Math.random()*0.9),n=a[r]||"textures/h.jpg";this.particles[r]=new e.Particle(new e.ParticleBasicMaterial({map:e.ImageUtils.loadTexture(n),opacity:o}));this.particles[r].position=this.boids[r].position;this.particles[r].doubleSided=true;q&&q.add&&q.add(this.particles[r])}};return f});define("widget",["jquery"],function(h){var k=function(a){this.opts=h.extend({},k.opts,a);this.widget=h("<div>").addClass(this.opts.cls)};k.prototype.update=function(a){a.header&&this.hd.html(a.header);a.body&&this.bd.html(a.body)};k.prototype.render=function(a){a=a||{};var b=a.header||this.opts.header||h("<div/>"),c=a.body||this.opts.body||h("<div/>");this.hd=b.addClass(this.opts.cls+"-hd");this.bd=c.addClass(this.opts.cls+"-bd");this.widget.html("");this.widget.append(this.hd).append(this.bd).appendTo(this.opts.container);return this.widget};k.opts={cls:"",header:null,body:null,container:"body"};var g=function(a){this.opts=h.extend({},g.opts,a)};g.prototype.render=function(b){var d=b.style||{},c=b.data||{},a=b.to||this.opts.container;this.tip&&this.tip.remove();this.tip=h("<div>").addClass(this.opts.cls);this.tip.html(h.tmpl.object(this.opts.tmpl,c)).css(d).hide().appendTo(a).fadeIn(200);return this.tip};g.prototype.unrender=function(){this.tip&&this.tip.remove()};g.opts={cls:"",tmpl:"",container:"body"};var f=function(a){this.opts=h.extend({},f.opts,a)};f.prototype.render=function(a){a=a||{};var c='<li data-index="{index}">'+this.opts.tmpl+"</li>",b=h("<ul/>").attr("id",this.opts._id).addClass(this.opts.cls);b.html("").html(h.tmpl["for"](c,a));return h("<div/>").append(b)};f.prototype.slideTo=function(d,u){var b={},c=h("#"+this.opts._id),v=c.children(),e=v.length,a,r,q=15,t,s;h.each(u,function(l,m){b[l]=""});a=h(v[d-1]);v.css(b);t=c.height();s=c[0].scrollHeight;r=s/e*(d-1)-t/2-q;c.animate({scrollTop:r},10,function(){a.css(u)})};f.opts={cls:"",tmpl:"",_id:"J-WList"};var j={};j.Base=k;j.Tip=g;j.List=f;return j});(function(b){if(typeof b.tmpl==="undefined"){b.tmpl={};b.tmpl.object=function(f,h){var g="",a=/\{(\w+)\}/g;g=f.replace(a,function(d,c){return h[c]});return g};b.tmpl["for"]=function(h,k){var j=[];for(var m=0,a=k.length;m<a;++m){var l=k[m];l.index||(l.index=m);j.push(b.tmpl.object(h,l))}return j.join("")}}})(jQuery);define("lib/jquery.template",function(){});(function(){var n=typeof document!=="undefined"&&typeof window!=="undefined"&&document.createElement("script"),l=n&&(n.async||((window.opera&&Object.prototype.toString.call(window.opera)==="[object Opera]")||("MozAppearance" in document.documentElement.style))),m=n&&n.readyState==="uninitialized",p=/^(complete|loaded)$/,o=[],q={},r={},s=[];n=null;function k(c){var e=c.currentTarget||c.srcElement,a,b,d;if(c.type==="load"||p.test(e.readyState)){b=e.getAttribute("data-requiremodule");q[b]=true;for(a=0;(d=o[a]);a++){if(q[d.name]){d.req([d.name],d.onLoad)}else{break}}if(a>0){o.splice(0,a)}setTimeout(function(){e.parentNode.removeChild(e)},15)}}function t(d){var a,b,c;d.setAttribute("data-orderloaded","loaded");for(a=0;(c=s[a]);a++){b=r[c];if(b&&b.getAttribute("data-orderloaded")==="loaded"){delete r[c];require.addScriptToDom(b)}else{break}}if(a>0){s.splice(0,a)}}define("order",{version:"1.0.5",load:function(a,e,g,b){var d=!!e.nameToUrl,c,f,h;if(!d){e([a],g);return}c=e.nameToUrl(a,null);require.s.skipAsync[c]=true;if(l||b.isBuild){e([a],g)}else{if(m){h=require.s.contexts._;if(!h.urlFetched[c]&&!h.loaded[a]){h.urlFetched[c]=true;require.resourcesReady(false);h.scriptCount+=1;f=require.attach(c,h,a,null,null,t);r[a]=f;s.push(a)}e([a],g)}else{if(e.specified(a)){e([a],g)}else{o.push({name:a,req:e,onLoad:g});require.attach(c,null,a,k,"script/cache")}}}}})}());(function(c){c.color={};c.color.make=function(j,h,a,b){var k={};k.r=j||0;k.g=h||0;k.b=a||0;k.a=b!=null?b:1;k.add=function(g,f){for(var e=0;e<g.length;++e){k[g.charAt(e)]+=f}return k.normalize()};k.scale=function(g,f){for(var e=0;e<g.length;++e){k[g.charAt(e)]*=f}return k.normalize()};k.toString=function(){if(k.a>=1){return"rgb("+[k.r,k.g,k.b].join(",")+")"}else{return"rgba("+[k.r,k.g,k.b,k.a].join(",")+")"}};k.normalize=function(){function e(g,m,f){return m<g?g:(m>f?f:m)}k.r=e(0,parseInt(k.r),255);k.g=e(0,parseInt(k.g),255);k.b=e(0,parseInt(k.b),255);k.a=e(0,k.a,1);return k};k.clone=function(){return c.color.make(k.r,k.b,k.g,k.a)};return k.normalize()};c.color.extract=function(b,a){var f;do{f=b.css(a).toLowerCase();if(f!=""&&f!="transparent"){break}b=b.parent()}while(!c.nodeName(b.get(0),"body"));if(f=="rgba(0, 0, 0, 0)"){f="transparent"}return c.color.parse(f)};c.color.parse=function(h){var g,a=c.color.make;if(g=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(h)){return a(parseInt(g[1],10),parseInt(g[2],10),parseInt(g[3],10))}if(g=/rgba\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]+(?:\.[0-9]+)?)\s*\)/.exec(h)){return a(parseInt(g[1],10),parseInt(g[2],10),parseInt(g[3],10),parseFloat(g[4]))}if(g=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(h)){return a(parseFloat(g[1])*2.55,parseFloat(g[2])*2.55,parseFloat(g[3])*2.55)}if(g=/rgba\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\s*\)/.exec(h)){return a(parseFloat(g[1])*2.55,parseFloat(g[2])*2.55,parseFloat(g[3])*2.55,parseFloat(g[4]))}if(g=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(h)){return a(parseInt(g[1],16),parseInt(g[2],16),parseInt(g[3],16))}if(g=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(h)){return a(parseInt(g[1]+g[1],16),parseInt(g[2]+g[2],16),parseInt(g[3]+g[3],16))}var b=c.trim(h).toLowerCase();if(b=="transparent"){return a(255,255,255,0)}else{g=d[b]||[0,0,0];return a(g[0],g[1],g[2])}};var d={aqua:[0,255,255],azure:[240,255,255],beige:[245,245,220],black:[0,0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgrey:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkviolet:[148,0,211],fuchsia:[255,0,255],gold:[255,215,0],green:[0,128,0],indigo:[75,0,130],khaki:[240,230,140],lightblue:[173,216,230],lightcyan:[224,255,255],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightyellow:[255,255,224],lime:[0,255,0],magenta:[255,0,255],maroon:[128,0,0],navy:[0,0,128],olive:[128,128,0],orange:[255,165,0],pink:[255,192,203],purple:[128,0,128],violet:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0]}})(jQuery);(function(f){function d(bj,bA,bd,bD){var a4=[],a6={colors:["#edc240","#afd8f8","#cb4b4b","#4da74d","#9440ed"],legend:{show:true,noColumns:1,labelFormatter:null,labelBoxBorderColor:"#ccc",container:null,position:"ne",margin:5,backgroundColor:null,backgroundOpacity:0.85},xaxis:{show:null,position:"bottom",mode:null,font:null,color:null,tickColor:null,transform:null,inverseTransform:null,min:null,max:null,autoscaleMargin:null,ticks:null,tickFormatter:null,labelWidth:null,labelHeight:null,reserveSpace:null,tickLength:null,alignTicksWithAxis:null,tickDecimals:null,tickSize:null,minTickSize:null,monthNames:null,timeformat:null,twelveHourClock:false},yaxis:{autoscaleMargin:0.02,position:"left"},xaxes:[],yaxes:[],series:{points:{show:false,radius:3,lineWidth:2,fill:true,fillColor:"#ffffff",symbol:"circle"},lines:{lineWidth:2,fill:false,fillColor:null,steps:false},bars:{show:false,lineWidth:2,barWidth:1,fill:true,fillColor:null,align:"left",horizontal:false},shadowSize:3},grid:{show:true,aboveData:false,color:"#545454",backgroundColor:null,borderColor:null,tickColor:null,labelMargin:5,axisMargin:8,borderWidth:2,minBorderMargin:null,markings:null,markingsColor:"#f4f4f4",markingsLineWidth:2,clickable:false,hoverable:false,autoHighlight:true,mouseActiveRadius:10},interaction:{redrawOverlayInterval:1000/60},hooks:{}},bL=null,bF=null,c=null,bg=null,a=null,aK=[],bh=[],aJ={left:0,right:0,top:0,bottom:0},bi=0,be=0,aQ=0,aD=0,by={processOptions:[],processRawData:[],processDatapoints:[],drawSeries:[],draw:[],bindEvents:[],drawOverlay:[],shutdown:[]},bs=this;bs.setData=bz;bs.setupGrid=aG;bs.draw=aX;bs.getPlaceholder=function(){return bj};bs.getCanvas=function(){return bL};bs.getPlotOffset=function(){return aJ};bs.width=function(){return aQ};bs.height=function(){return aD};bs.offset=function(){var g=c.offset();g.left+=aJ.left;g.top+=aJ.top;return g};bs.getData=function(){return a4};bs.getAxes=function(){var g={},h;f.each(aK.concat(bh),function(k,j){if(j){g[j.direction+(j.n!=1?j.n:"")+"axis"]=j}});return g};bs.getXAxes=function(){return aK};bs.getYAxes=function(){return bh};bs.c2p=bq;bs.p2c=bp;bs.getOptions=function(){return a6};bs.highlight=aC;bs.unhighlight=a0;bs.triggerRedrawOverlay=aS;bs.pointOffset=function(g){return{left:parseInt(aK[bK(g,"x")-1].p2c(+g.x)+aJ.left),top:parseInt(bh[bK(g,"y")-1].p2c(+g.y)+aJ.top)}};bs.shutdown=bC;bs.resize=function(){br();aR(bL);aR(bF)};bs.hooks=by;bk(bs);bJ(bd);aW();bz(bA);aG();aX();bB();function bv(g,j){j=[bs].concat(j);for(var h=0;h<g.length;++h){g[h].apply(this,j)}}function bk(){for(var h=0;h<bD.length;++h){var g=bD[h];g.init(bs);if(g.options){f.extend(true,a6,g.options)}}}function bJ(h){var j;f.extend(true,a6,h);if(a6.xaxis.color==null){a6.xaxis.color=a6.grid.color}if(a6.yaxis.color==null){a6.yaxis.color=a6.grid.color}if(a6.xaxis.tickColor==null){a6.xaxis.tickColor=a6.grid.tickColor}if(a6.yaxis.tickColor==null){a6.yaxis.tickColor=a6.grid.tickColor}if(a6.grid.borderColor==null){a6.grid.borderColor=a6.grid.color}if(a6.grid.tickColor==null){a6.grid.tickColor=f.color.parse(a6.grid.color).scale("a",0.22).toString()}for(j=0;j<Math.max(1,a6.xaxes.length);++j){a6.xaxes[j]=f.extend(true,{},a6.xaxis,a6.xaxes[j])}for(j=0;j<Math.max(1,a6.yaxes.length);++j){a6.yaxes[j]=f.extend(true,{},a6.yaxis,a6.yaxes[j])}if(a6.xaxis.noTicks&&a6.xaxis.ticks==null){a6.xaxis.ticks=a6.xaxis.noTicks}if(a6.yaxis.noTicks&&a6.yaxis.ticks==null){a6.yaxis.ticks=a6.yaxis.noTicks}if(a6.x2axis){a6.xaxes[1]=f.extend(true,{},a6.xaxis,a6.x2axis);a6.xaxes[1].position="top"}if(a6.y2axis){a6.yaxes[1]=f.extend(true,{},a6.yaxis,a6.y2axis);a6.yaxes[1].position="right"}if(a6.grid.coloredAreas){a6.grid.markings=a6.grid.coloredAreas}if(a6.grid.coloredAreasColor){a6.grid.markingsColor=a6.grid.coloredAreasColor}if(a6.lines){f.extend(true,a6.series.lines,a6.lines)}if(a6.points){f.extend(true,a6.series.points,a6.points)}if(a6.bars){f.extend(true,a6.series.bars,a6.bars)}if(a6.shadowSize!=null){a6.series.shadowSize=a6.shadowSize}for(j=0;j<a6.xaxes.length;++j){aY(aK,j+1).options=a6.xaxes[j]}for(j=0;j<a6.yaxes.length;++j){aY(bh,j+1).options=a6.yaxes[j]}for(var g in by){if(a6.hooks[g]&&a6.hooks[g].length){by[g]=by[g].concat(a6.hooks[g])}}bv(by.processOptions,[a6])}function bz(g){a4=aV(g);bf();b()}function aV(g){var j=[];for(var k=0;k<g.length;++k){var h=f.extend(true,{},a6.series);if(g[k].data!=null){h.data=g[k].data;delete g[k].data;f.extend(true,h,g[k]);g[k].data=h.data}else{h.data=g[k]}j.push(h)}return j}function bK(h,g){var j=h[g+"axis"];if(typeof j=="object"){j=j.n}if(typeof j!="number"){j=1}return j}function aN(){return f.grep(aK.concat(bh),function(g){return g})}function bq(g){var j={},k,h;for(k=0;k<aK.length;++k){h=aK[k];if(h&&h.used){j["x"+h.n]=h.c2p(g.left)}}for(k=0;k<bh.length;++k){h=bh[k];if(h&&h.used){j["y"+h.n]=h.c2p(g.top)}}if(j.x1!==undefined){j.x=j.x1}if(j.y1!==undefined){j.y=j.y1}return j}function bp(g){var j={},k,h,l;for(k=0;k<aK.length;++k){h=aK[k];if(h&&h.used){l="x"+h.n;if(g[l]==null&&h.n==1){l="x"}if(g[l]!=null){j.left=h.p2c(g[l]);break}}}for(k=0;k<bh.length;++k){h=bh[k];if(h&&h.used){l="y"+h.n;if(g[l]==null&&h.n==1){l="y"}if(g[l]!=null){j.top=h.p2c(g[l]);break}}}return j}function aY(g,h){if(!g[h-1]){g[h-1]={n:h,direction:g==aK?"x":"y",options:f.extend(true,{},g==aK?a6.xaxis:a6.yaxis)}}return g[h-1]}function bf(){var j;var q=a4.length,o=[],l=[];for(j=0;j<a4.length;++j){var t=a4[j].color;if(t!=null){--q;if(typeof t=="number"){l.push(t)}else{o.push(f.color.parse(a4[j].color))}}}for(j=0;j<l.length;++j){q=Math.max(q,l[j]+1)}var n=[],k=0;j=0;while(n.length<q){var g;if(a6.colors.length==j){g=f.color.make(100,100,100)}else{g=f.color.parse(a6.colors[j])}var m=k%2==1?-1:1;g.scale("rgb",1+m*Math.ceil(k/2)*0.2);n.push(g);++j;if(j>=a6.colors.length){j=0;++k}}var h=0,p;for(j=0;j<a4.length;++j){p=a4[j];if(p.color==null){p.color=n[h].toString();++h}else{if(typeof p.color=="number"){p.color=n[p.color].toString()}}if(p.lines.show==null){var r,s=true;for(r in p){if(p[r]&&p[r].show){s=false;break}}if(s){p.lines.show=true}}p.xaxis=aY(aK,bK(p,"x"));p.yaxis=aY(bh,bK(p,"y"))}}function b(){var r=Number.POSITIVE_INFINITY,x=Number.NEGATIVE_INFINITY,E=Number.MAX_VALUE,l,n,o,s,C,w,m,q,y,z,D,F,h,u;function A(I,J,H){if(J<I.datamin&&J!=-E){I.datamin=J}if(H>I.datamax&&H!=E){I.datamax=H}}f.each(aN(),function(H,I){I.datamin=r;I.datamax=x;I.used=false});for(l=0;l<a4.length;++l){w=a4[l];w.datapoints={points:[]};bv(by.processRawData,[w,w.data,w.datapoints])}for(l=0;l<a4.length;++l){w=a4[l];var G=w.data,j=w.datapoints.format;if(!j){j=[];j.push({x:true,number:true,required:true});j.push({y:true,number:true,required:true});if(w.bars.show||(w.lines.show&&w.lines.fill)){j.push({y:true,number:true,required:false,defaultValue:0});if(w.bars.horizontal){delete j[j.length-1].y;j[j.length-1].x=true}}w.datapoints.format=j}if(w.datapoints.pointsize!=null){continue}w.datapoints.pointsize=j.length;q=w.datapoints.pointsize;m=w.datapoints.points;insertSteps=w.lines.show&&w.lines.steps;w.xaxis.used=w.yaxis.used=true;for(n=o=0;n<G.length;++n,o+=q){u=G[n];var B=u==null;if(!B){for(s=0;s<q;++s){F=u[s];h=j[s];if(h){if(h.number&&F!=null){F=+F;if(isNaN(F)){F=null}else{if(F==Infinity){F=E}else{if(F==-Infinity){F=-E}}}}if(F==null){if(h.required){B=true}if(h.defaultValue!=null){F=h.defaultValue}}}m[o+s]=F}}if(B){for(s=0;s<q;++s){F=m[o+s];if(F!=null){h=j[s];if(h.x){A(w.xaxis,F,F)}if(h.y){A(w.yaxis,F,F)}}m[o+s]=null}}else{if(insertSteps&&o>0&&m[o-q]!=null&&m[o-q]!=m[o]&&m[o-q+1]!=m[o+1]){for(s=0;s<q;++s){m[o+q+s]=m[o+s]}m[o+1]=m[o-q+1];o+=q}}}}for(l=0;l<a4.length;++l){w=a4[l];bv(by.processDatapoints,[w,w.datapoints])}for(l=0;l<a4.length;++l){w=a4[l];m=w.datapoints.points,q=w.datapoints.pointsize;j=w.datapoints.format;var v=r,p=r,t=x,k=x;for(n=0;n<m.length;n+=q){if(m[n]==null){continue}for(s=0;s<q;++s){F=m[n+s];h=j[s];if(!h||F==E||F==-E){continue}if(h.x){if(F<v){v=F}if(F>t){t=F}}if(h.y){if(F<p){p=F}if(F>k){k=F}}}}if(w.bars.show){var g=w.bars.align=="left"?0:-w.bars.barWidth/2;if(w.bars.horizontal){p+=g;k+=g+w.bars.barWidth}else{v+=g;t+=g+w.bars.barWidth}}A(w.xaxis,v,t);A(w.yaxis,p,k)}f.each(aN(),function(H,I){if(I.datamin==r){I.datamin=null}if(I.datamax==x){I.datamax=null}})}function aP(j,h){var g=document.createElement("canvas");g.className=h;g.width=bi;g.height=be;if(!j){f(g).css({position:"absolute",left:0,top:0})}f(g).appendTo(bj);if(!g.getContext){g=window.G_vmlCanvasManager.initElement(g)}g.getContext("2d").save();return g}function br(){bi=bj.width();be=bj.height();if(bi<=0||be<=0){throw"Invalid dimensions for plot, width = "+bi+", height = "+be}}function aR(g){if(g.width!=bi){g.width=bi}if(g.height!=be){g.height=be}var h=g.getContext("2d");h.restore();h.save()}function aW(){var h,j=bj.children("canvas.flot-base"),g=bj.children("canvas.flot-overlay");if(j.length==0||g==0){bj.html("");bj.css({padding:0});if(bj.css("position")=="static"){bj.css("position","relative")}br();bL=aP(true,"flot-base");bF=aP(false,"flot-overlay");h=false}else{bL=j.get(0);bF=g.get(0);h=true}bg=bL.getContext("2d");a=bF.getContext("2d");c=f(bF);if(h){bj.data("plot").shutdown();bs.resize();a.clearRect(0,0,bi,be);c.unbind();bj.children().not([bL,bF]).remove()}bj.data("plot",bs)}function bB(){if(a6.grid.hoverable){c.mousemove(bI);c.mouseleave(aO)}if(a6.grid.clickable){c.click(a3)}bv(by.bindEvents,[c])}function bC(){if(a9){clearTimeout(a9)}c.unbind("mousemove",bI);c.unbind("mouseleave",aO);c.unbind("click",a3);bv(by.shutdown,[c])}function aI(g){function l(n){return n}var h,m,k=g.options.transform||l,j=g.options.inverseTransform;if(g.direction=="x"){h=g.scale=aQ/Math.abs(k(g.max)-k(g.min));m=Math.min(k(g.max),k(g.min))}else{h=g.scale=aD/Math.abs(k(g.max)-k(g.min));h=-h;m=Math.max(k(g.max),k(g.min))}if(k==l){g.p2c=function(n){return(n-m)*h}}else{g.p2c=function(n){return(k(n)-m)*h}}if(!j){g.c2p=function(n){return m+n/h}}else{g.c2p=function(n){return j(m+n/h)}}}function ba(m){var o=m.options,g=m.ticks||[],s=o.labelWidth||0,h=o.labelHeight||0,j=m.font;bg.save();bg.font=j.style+" "+j.variant+" "+j.weight+" "+j.size+"px '"+j.family+"'";for(var k=0;k<g.length;++k){var r=g[k];r.lines=[];r.width=r.height=0;if(!r.label){continue}var p=r.label.replace(/<br ?\/?>|\r\n|\r/g,"\n").split("\n");for(var l=0;l<p.length;++l){var q={text:p[l]},n=bg.measureText(q.text);q.width=n.width;q.height=n.height!=null?n.height:j.size;q.height+=Math.round(j.size*0.15);r.width=Math.max(q.width,r.width);r.height+=q.height;r.lines.push(q)}if(o.labelWidth==null){s=Math.max(s,r.width)}if(o.labelHeight==null){h=Math.max(h,r.height)}}bg.restore();m.labelWidth=Math.ceil(s);m.labelHeight=Math.ceil(h)}function bl(m){var n=m.labelWidth,q=m.labelHeight,h=m.options.position,k=m.options.tickLength,j=a6.grid.axisMargin,s=a6.grid.labelMargin,r=m.direction=="x"?aK:bh,l;var o=f.grep(r,function(t){return t&&t.options.position==h&&t.reserveSpace});if(f.inArray(m,o)==o.length-1){j=0}if(k==null){var g=f.grep(r,function(t){return t&&t.reserveSpace});var p=f.inArray(m,g)==0;if(p){k="full"}else{k=5}}if(!isNaN(+k)){s+=+k}if(m.direction=="x"){q+=s;if(h=="bottom"){aJ.bottom+=q+j;m.box={top:be-aJ.bottom,height:q}}else{m.box={top:aJ.top+j,height:q};aJ.top+=q+j}}else{n+=s;if(h=="left"){m.box={left:aJ.left+j,width:n};aJ.left+=n+j}else{aJ.right+=n+j;m.box={left:bi-aJ.right,width:n}}}m.position=h;m.tickLength=k;m.box.padding=s;m.innermost=p}function aZ(g){if(g.direction=="x"){g.box.left=aJ.left-g.labelWidth/2;g.box.width=bi-aJ.left-aJ.right+g.labelWidth}else{g.box.top=aJ.top-g.labelHeight/2;g.box.height=be-aJ.bottom-aJ.top+g.labelHeight}}function a8(){var h=a6.grid.minBorderMargin,g={x:0,y:0},k,j;if(h==null){h=0;for(k=0;k<a4.length;++k){h=Math.max(h,2*(a4[k].points.radius+a4[k].points.lineWidth/2))}}g.x=g.y=Math.ceil(h);f.each(aN(),function(l,n){var m=n.direction;if(n.reserveSpace){g[m]=Math.ceil(Math.max(g[m],(m=="x"?n.labelWidth:n.labelHeight)/2))}});aJ.left=Math.max(g.x,aJ.left);aJ.right=Math.max(g.x,aJ.right);aJ.top=Math.max(g.y,aJ.top);aJ.bottom=Math.max(g.y,aJ.bottom)}function aG(){var k,h=aN(),g=a6.grid.show;for(var l in aJ){aJ[l]=g?a6.grid.borderWidth:0}f.each(h,function(o,n){n.show=n.options.show;if(n.show==null){n.show=n.used}n.reserveSpace=n.show||n.options.reserveSpace;aM(n)});if(g){var j={style:bj.css("font-style"),size:Math.round(0.8*(+bj.css("font-size").replace("px","")||13)),variant:bj.css("font-variant"),weight:bj.css("font-weight"),family:bj.css("font-family")};var m=f.grep(h,function(n){return n.reserveSpace});f.each(m,function(o,n){a2(n);a5(n);bt(n,n.ticks);n.font=f.extend({},j,n.options.font);ba(n)});for(k=m.length-1;k>=0;--k){bl(m[k])}a8();f.each(m,function(o,n){aZ(n)})}aQ=bi-aJ.left-aJ.right;aD=be-aJ.bottom-aJ.top;f.each(h,function(o,n){aI(n)});aL()}function aM(j){var h=j.options,k=+(h.min!=null?h.min:j.datamin),m=+(h.max!=null?h.max:j.datamax),n=m-k;if(n==0){var l=m==0?1:0.01;if(h.min==null){k-=l}if(h.max==null||h.min!=null){m+=l}}else{var g=h.autoscaleMargin;if(g!=null){if(h.min==null){k-=n*g;if(k<0&&j.datamin!=null&&j.datamin>=0){k=0}}if(h.max==null){m+=n*g;if(m>0&&j.datamax!=null&&j.datamax<=0){m=0}}}}j.min=k;j.max=m}function a2(v){var p=v.options;var u;if(typeof p.ticks=="number"&&p.ticks>0){u=p.ticks}else{u=0.3*Math.sqrt(v.direction=="x"?bi:be)}var h=(v.max-v.min)/u,n,A,o,k,j,l,t;if(p.mode=="time"){var s={second:1000,minute:60*1000,hour:60*60*1000,day:24*60*60*1000,month:30*24*60*60*1000,year:365.2425*24*60*60*1000};var r=[[1,"second"],[2,"second"],[5,"second"],[10,"second"],[30,"second"],[1,"minute"],[2,"minute"],[5,"minute"],[10,"minute"],[30,"minute"],[1,"hour"],[2,"hour"],[4,"hour"],[8,"hour"],[12,"hour"],[1,"day"],[2,"day"],[3,"day"],[0.25,"month"],[0.5,"month"],[1,"month"],[2,"month"],[3,"month"],[6,"month"],[1,"year"]];var z=0;if(p.minTickSize!=null){if(typeof p.tickSize=="number"){z=p.tickSize}else{z=p.minTickSize[0]*s[p.minTickSize[1]]}}for(var j=0;j<r.length-1;++j){if(h<(r[j][0]*s[r[j][1]]+r[j+1][0]*s[r[j+1][1]])/2&&r[j][0]*s[r[j][1]]>=z){break}}n=r[j][0];o=r[j][1];if(o=="year"){l=Math.pow(10,Math.floor(Math.log(h/s.year)/Math.LN10));t=(h/s.year)/l;if(t<1.5){n=1}else{if(t<3){n=2}else{if(t<7.5){n=5}else{n=10}}}n*=l}v.tickSize=p.tickSize||[n,o];A=function(G){var B=[],D=G.tickSize[0],L=G.tickSize[1],C=new Date(G.min);var H=D*s[L];if(L=="second"){C.setUTCSeconds(e(C.getUTCSeconds(),D))}if(L=="minute"){C.setUTCMinutes(e(C.getUTCMinutes(),D))}if(L=="hour"){C.setUTCHours(e(C.getUTCHours(),D))}if(L=="month"){C.setUTCMonth(e(C.getUTCMonth(),D))}if(L=="year"){C.setUTCFullYear(e(C.getUTCFullYear(),D))}C.setUTCMilliseconds(0);if(H>=s.minute){C.setUTCSeconds(0)}if(H>=s.hour){C.setUTCMinutes(0)}if(H>=s.day){C.setUTCHours(0)}if(H>=s.day*4){C.setUTCDate(1)}if(H>=s.year){C.setUTCMonth(0)}var J=0,K=Number.NaN,F;do{F=K;K=C.getTime();B.push(K);if(L=="month"){if(D<1){C.setUTCDate(1);var I=C.getTime();C.setUTCMonth(C.getUTCMonth()+1);var E=C.getTime();C.setTime(K+J*s.hour+(E-I)*D);J=C.getUTCHours();C.setUTCHours(0)}else{C.setUTCMonth(C.getUTCMonth()+D)}}else{if(L=="year"){C.setUTCFullYear(C.getUTCFullYear()+D)}else{C.setTime(K+H)}}}while(K<G.max&&K!=F);return B};k=function(G,D){var B=new Date(G);if(p.timeformat!=null){return f.plot.formatDate(B,p.timeformat,p.monthNames)}var F=D.tickSize[0]*s[D.tickSize[1]];var E=D.max-D.min;var C=(p.twelveHourClock)?" %p":"";if(F<s.minute){fmt="%h:%M:%S"+C}else{if(F<s.day){if(E<2*s.day){fmt="%h:%M"+C}else{fmt="%b %d %h:%M"+C}}else{if(F<s.month){fmt="%b %d"}else{if(F<s.year){if(E<s.year){fmt="%b"}else{fmt="%b %y"}}else{fmt="%y"}}}}return f.plot.formatDate(B,fmt,p.monthNames)}}else{var g=p.tickDecimals;var m=-Math.floor(Math.log(h)/Math.LN10);if(g!=null&&m>g){m=g}l=Math.pow(10,-m);t=h/l;if(t<1.5){n=1}else{if(t<3){n=2;if(t>2.25&&(g==null||m+1<=g)){n=2.5;++m}}else{if(t<7.5){n=5}else{n=10}}}n*=l;if(p.minTickSize!=null&&n<p.minTickSize){n=p.minTickSize}v.tickDecimals=Math.max(0,g!=null?g:m);v.tickSize=p.tickSize||n;A=function(E){var C=[];var B=e(E.min,E.tickSize),F=0,G=Number.NaN,D;do{D=G;G=B+F*E.tickSize;C.push(G);++F}while(G<E.max&&G!=D);return C};k=function(C,B){return C.toFixed(B.tickDecimals)}}if(p.alignTicksWithAxis!=null){var w=(v.direction=="x"?aK:bh)[p.alignTicksWithAxis-1];if(w&&w.used&&w!=v){var q=A(v);if(q.length>0){if(p.min==null){v.min=Math.min(v.min,q[0])}if(p.max==null&&q.length>1){v.max=Math.max(v.max,q[q.length-1])}}A=function(C){var B=[],E,D;for(D=0;D<w.ticks.length;++D){E=(w.ticks[D].v-w.min)/(w.max-w.min);E=C.min+E*(C.max-C.min);B.push(E)}return B};if(!v.mode&&p.tickDecimals==null){var x=Math.max(0,-Math.floor(Math.log(h)/Math.LN10)+1),y=A(v);if(!(y.length>1&&/\..*0$/.test((y[1]-y[0]).toFixed(x)))){v.tickDecimals=x}}}}v.tickGenerator=A;if(f.isFunction(p.tickFormatter)){v.tickFormatter=function(C,B){return""+p.tickFormatter(C,B)}}else{v.tickFormatter=k}}function a5(h){var n=h.options.ticks,g=[];if(n==null||(typeof n=="number"&&n>0)){g=h.tickGenerator(h)}else{if(n){if(f.isFunction(n)){g=n(h)}else{g=n}}}var j,m;h.ticks=[];for(j=0;j<g.length;++j){var l=null;var k=g[j];if(typeof k=="object"){m=+k[0];if(k.length>1){l=k[1]}}else{m=+k}if(l==null){l=h.tickFormatter(m,h)}if(!isNaN(m)){h.ticks.push({v:m,label:l})}}}function bt(h,g){if(h.options.autoscaleMargin&&g.length>0){if(h.options.min==null){h.min=Math.min(h.min,g[0].v)}if(h.options.max==null&&g.length>1){h.max=Math.max(h.max,g[g.length-1].v)}}}function aX(){bg.clearRect(0,0,bi,be);var g=a6.grid;if(g.show&&g.backgroundColor){a7()}if(g.show&&!g.aboveData){bG();a1()}for(var h=0;h<a4.length;++h){bv(by.drawSeries,[bg,a4[h]]);aU(a4[h])}bv(by.draw,[bg]);if(g.show&&g.aboveData){bG();a1()}}function bo(m,n){var j,o,g,k,h=aN();for(i=0;i<h.length;++i){j=h[i];if(j.direction==n){k=n+j.n+"axis";if(!m[k]&&j.n==1){k=n+"axis"}if(m[k]){o=m[k].from;g=m[k].to;break}}}if(!m[k]){j=n=="x"?aK[0]:bh[0];o=m[n+"1"];g=m[n+"2"]}if(o!=null&&g!=null&&o>g){var l=o;o=g;g=l}return{from:o,to:g,axis:j}}function a7(){bg.save();bg.translate(aJ.left,aJ.top);bg.fillStyle=bw(a6.grid.backgroundColor,aD,0,"rgba(255, 255, 255, 0)");bg.fillRect(0,0,aQ,aD);bg.restore()}function bG(){var k;bg.save();bg.translate(aJ.left,aJ.top);var h=a6.grid.markings;if(h){if(f.isFunction(h)){var v=bs.getAxes();v.xmin=v.xaxis.min;v.xmax=v.xaxis.max;v.ymin=v.yaxis.min;v.ymax=v.yaxis.max;h=h(v)}for(k=0;k<h.length;++k){var m=h[k],n=bo(m,"x"),g=bo(m,"y");if(n.from==null){n.from=n.axis.min}if(n.to==null){n.to=n.axis.max}if(g.from==null){g.from=g.axis.min}if(g.to==null){g.to=g.axis.max}if(n.to<n.axis.min||n.from>n.axis.max||g.to<g.axis.min||g.from>g.axis.max){continue}n.from=Math.max(n.from,n.axis.min);n.to=Math.min(n.to,n.axis.max);g.from=Math.max(g.from,g.axis.min);g.to=Math.min(g.to,g.axis.max);if(n.from==n.to&&g.from==g.to){continue}n.from=n.axis.p2c(n.from);n.to=n.axis.p2c(n.to);g.from=g.axis.p2c(g.from);g.to=g.axis.p2c(g.to);if(n.from==n.to||g.from==g.to){bg.beginPath();bg.strokeStyle=m.color||a6.grid.markingsColor;bg.lineWidth=m.lineWidth||a6.grid.markingsLineWidth;bg.moveTo(n.from,g.from);bg.lineTo(n.to,g.to);bg.stroke()}else{bg.fillStyle=m.color||a6.grid.markingsColor;bg.fillRect(n.from,g.to,n.to-n.from,g.from-g.to)}}}var v=aN(),t=a6.grid.borderWidth;for(var l=0;l<v.length;++l){var o=v[l],j=o.box,p=o.tickLength,s,u,q,w;if(!o.show||o.ticks.length==0){continue}bg.strokeStyle=o.options.tickColor||f.color.parse(o.options.color).scale("a",0.22).toString();bg.lineWidth=1;if(o.direction=="x"){s=0;if(p=="full"){u=(o.position=="top"?0:aD)}else{u=j.top-aJ.top+(o.position=="top"?j.height:0)}}else{u=0;if(p=="full"){s=(o.position=="left"?0:aQ)}else{s=j.left-aJ.left+(o.position=="left"?j.width:0)}}if(!o.innermost){bg.beginPath();q=w=0;if(o.direction=="x"){q=aQ}else{w=aD}if(bg.lineWidth==1){s=Math.floor(s)+0.5;u=Math.floor(u)+0.5}bg.moveTo(s,u);bg.lineTo(s+q,u+w);bg.stroke()}bg.beginPath();for(k=0;k<o.ticks.length;++k){var r=o.ticks[k].v;q=w=0;if(r<o.min||r>o.max||(p=="full"&&t>0&&(r==o.min||r==o.max))){continue}if(o.direction=="x"){s=o.p2c(r);w=p=="full"?-aD:p;if(o.position=="top"){w=-w}}else{u=o.p2c(r);q=p=="full"?-aQ:p;if(o.position=="left"){q=-q}}if(bg.lineWidth==1){if(o.direction=="x"){s=Math.floor(s)+0.5}else{u=Math.floor(u)+0.5}}bg.moveTo(s,u);bg.lineTo(s+q,u+w)}bg.stroke()}if(t){bg.lineWidth=t;bg.strokeStyle=a6.grid.borderColor;bg.strokeRect(-t/2,-t/2,aQ+t,aD+t)}bg.restore()}function a1(){bg.save();f.each(aN(),function(q,o){if(!o.show||o.ticks.length==0){return}var k=o.box,h=o.font;bg.fillStyle=o.options.color;bg.font=h.style+" "+h.variant+" "+h.weight+" "+h.size+"px "+h.family;bg.textAlign="start";bg.textBaseline="middle";for(var l=0;l<o.ticks.length;++l){var j=o.ticks[l];if(!j.label||j.v<o.min||j.v>o.max){continue}var r,g,m=0,p;for(var n=0;n<j.lines.length;++n){p=j.lines[n];if(o.direction=="x"){r=aJ.left+o.p2c(j.v)-p.width/2;if(o.position=="bottom"){g=k.top+k.padding}else{g=k.top+k.height-k.padding-j.height}}else{g=aJ.top+o.p2c(j.v)-j.height/2;if(o.position=="left"){r=k.left+k.width-k.padding-p.width}else{r=k.left+k.padding}}g+=p.height/2+m;m+=p.height;if(f.browser.opera){r=Math.floor(r);g=Math.ceil(g-2)}bg.fillText(p.text,r,g)}}});bg.restore()}function aU(g){if(g.lines.show){bn(g)}if(g.bars.show){aT(g)}if(g.points.show){bu(g)}}function bn(j){function k(v,u,o,q,r){var p=v.points,B=v.pointsize,x=null,y=null;bg.beginPath();for(var w=B;w<p.length;w+=B){var z=p[w-B],s=p[w-B+1],A=p[w],t=p[w+1];if(z==null||A==null){continue}if(s<=t&&s<r.min){if(t<r.min){continue}z=(r.min-s)/(t-s)*(A-z)+z;s=r.min}else{if(t<=s&&t<r.min){if(s<r.min){continue}A=(r.min-s)/(t-s)*(A-z)+z;t=r.min}}if(s>=t&&s>r.max){if(t>r.max){continue}z=(r.max-s)/(t-s)*(A-z)+z;s=r.max}else{if(t>=s&&t>r.max){if(s>r.max){continue}A=(r.max-s)/(t-s)*(A-z)+z;t=r.max}}if(z<=A&&z<q.min){if(A<q.min){continue}s=(q.min-z)/(A-z)*(t-s)+s;z=q.min}else{if(A<=z&&A<q.min){if(z<q.min){continue}t=(q.min-z)/(A-z)*(t-s)+s;A=q.min}}if(z>=A&&z>q.max){if(A>q.max){continue}s=(q.max-z)/(A-z)*(t-s)+s;z=q.max}else{if(A>=z&&A>q.max){if(z>q.max){continue}t=(q.max-z)/(A-z)*(t-s)+s;A=q.max}}if(z!=x||s!=y){bg.moveTo(q.p2c(z)+u,r.p2c(s)+o)}x=A;y=t;bg.lineTo(q.p2c(A)+u,r.p2c(t)+o)}bg.stroke()}function h(E,w,x){var q=E.points,r=E.pointsize,z=Math.min(Math.max(0,x.min),x.max),p=0,s,t=false,A=1,B=0,v=0;while(true){if(r>0&&p>q.length+r){break}p+=r;var F=q[p-r],C=q[p-r+A],o=q[p],D=q[p+A];if(t){if(r>0&&F!=null&&o==null){v=p;r=-r;A=2;continue}if(r<0&&p==B+r){bg.fill();t=false;r=-r;A=1;p=B=v+r;continue}}if(F==null||o==null){continue}if(F<=o&&F<w.min){if(o<w.min){continue}C=(w.min-F)/(o-F)*(D-C)+C;F=w.min}else{if(o<=F&&o<w.min){if(F<w.min){continue}D=(w.min-F)/(o-F)*(D-C)+C;o=w.min}}if(F>=o&&F>w.max){if(o>w.max){continue}C=(w.max-F)/(o-F)*(D-C)+C;F=w.max}else{if(o>=F&&o>w.max){if(F>w.max){continue}D=(w.max-F)/(o-F)*(D-C)+C;o=w.max}}if(!t){bg.beginPath();bg.moveTo(w.p2c(F),x.p2c(z));t=true}if(C>=x.max&&D>=x.max){bg.lineTo(w.p2c(F),x.p2c(x.max));bg.lineTo(w.p2c(o),x.p2c(x.max));continue}else{if(C<=x.min&&D<=x.min){bg.lineTo(w.p2c(F),x.p2c(x.min));bg.lineTo(w.p2c(o),x.p2c(x.min));continue}}var y=F,u=o;if(C<=D&&C<x.min&&D>=x.min){F=(x.min-C)/(D-C)*(o-F)+F;C=x.min}else{if(D<=C&&D<x.min&&C>=x.min){o=(x.min-C)/(D-C)*(o-F)+F;D=x.min}}if(C>=D&&C>x.max&&D<=x.max){F=(x.max-C)/(D-C)*(o-F)+F;C=x.max}else{if(D>=C&&D>x.max&&C<=x.max){o=(x.max-C)/(D-C)*(o-F)+F;D=x.max}}if(F!=y){bg.lineTo(w.p2c(y),x.p2c(C))}bg.lineTo(w.p2c(F),x.p2c(C));bg.lineTo(w.p2c(o),x.p2c(D));if(o!=u){bg.lineTo(w.p2c(o),x.p2c(D));bg.lineTo(w.p2c(u),x.p2c(D))}}}bg.save();bg.translate(aJ.left,aJ.top);bg.lineJoin="round";var g=j.lines.lineWidth,m=j.shadowSize;if(g>0&&m>0){bg.lineWidth=m;bg.strokeStyle="rgba(0,0,0,0.1)";var n=Math.PI/18;k(j.datapoints,Math.sin(n)*(g/2+m/2),Math.cos(n)*(g/2+m/2),j.xaxis,j.yaxis);bg.lineWidth=m/2;k(j.datapoints,Math.sin(n)*(g/2+m/4),Math.cos(n)*(g/2+m/4),j.xaxis,j.yaxis)}bg.lineWidth=g;bg.strokeStyle=j.color;var l=bE(j.lines,j.color,0,aD);if(l){bg.fillStyle=l;h(j.datapoints,j.xaxis,j.yaxis)}if(g>0){k(j.datapoints,0,0,j.xaxis,j.yaxis)}bg.restore()}function bu(j){function n(w,x,p,z,r,q,t,A){var s=w.points,o=w.pointsize;for(var y=0;y<s.length;y+=o){var u=s[y],v=s[y+1];if(u==null||u<q.min||u>q.max||v<t.min||v>t.max){continue}bg.beginPath();u=q.p2c(u);v=t.p2c(v)+z;if(A=="circle"){bg.arc(u,v,x,0,r?Math.PI:Math.PI*2,false)}else{A(bg,u,v,x,r)}bg.closePath();if(p){bg.fillStyle=p;bg.fill()}bg.stroke()}}bg.save();bg.translate(aJ.left,aJ.top);var g=j.points.lineWidth,l=j.shadowSize,m=j.points.radius,h=j.points.symbol;if(g>0&&l>0){var k=l/2;bg.lineWidth=k;bg.strokeStyle="rgba(0,0,0,0.1)";n(j.datapoints,m,null,k+k/2,true,j.xaxis,j.yaxis,h);bg.strokeStyle="rgba(0,0,0,0.2)";n(j.datapoints,m,null,k/2,true,j.xaxis,j.yaxis,h)}bg.lineWidth=g;bg.strokeStyle=j.color;n(j.datapoints,m,bE(j.points,j.color),0,false,j.xaxis,j.yaxis,h);bg.restore()}function bm(p,q,g,u,m,x,z,r,s,h,l,A){var y,j,t,n,w,B,o,v,k;if(l){v=B=o=true;w=false;y=g;j=p;n=q+u;t=q+m;if(j<y){k=j;j=y;y=k;w=true;B=false}}else{w=B=o=true;v=false;y=p+u;j=p+m;t=g;n=q;if(n<t){k=n;n=t;t=k;v=true;o=false}}if(j<r.min||y>r.max||n<s.min||t>s.max){return}if(y<r.min){y=r.min;w=false}if(j>r.max){j=r.max;B=false}if(t<s.min){t=s.min;v=false}if(n>s.max){n=s.max;o=false}y=r.p2c(y);t=s.p2c(t);j=r.p2c(j);n=s.p2c(n);if(z){h.beginPath();h.moveTo(y,t);h.lineTo(y,n);h.lineTo(j,n);h.lineTo(j,t);h.fillStyle=z(t,n);h.fill()}if(A>0&&(w||B||o||v)){h.beginPath();h.moveTo(y,t+x);if(w){h.lineTo(y,n+x)}else{h.moveTo(y,n+x)}if(o){h.lineTo(j,n+x)}else{h.moveTo(j,n+x)}if(B){h.lineTo(j,t+x)}else{h.moveTo(j,t+x)}if(v){h.lineTo(y,t+x)}else{h.moveTo(y,t+x)}h.stroke()}}function aT(h){function j(u,l,s,n,t,q,r){var p=u.points,o=u.pointsize;for(var m=0;m<p.length;m+=o){if(p[m]==null){continue}bm(p[m],p[m+1],p[m+2],l,s,n,t,q,r,bg,h.bars.horizontal,h.bars.lineWidth)}}bg.save();bg.translate(aJ.left,aJ.top);bg.lineWidth=h.bars.lineWidth;bg.strokeStyle=h.color;var k=h.bars.align=="left"?0:-h.bars.barWidth/2;var g=h.bars.fill?function(m,l){return bE(h.bars,h.color,m,l)}:null;j(h.datapoints,k,k+h.bars.barWidth,0,g,h.xaxis,h.yaxis);bg.restore()}function bE(k,m,l,h){var j=k.fill;if(!j){return null}if(k.fillColor){return bw(k.fillColor,l,h,m)}var g=f.color.parse(m);g.a=typeof j=="number"?j:0.4;g.normalize();return g.toString()}function aL(){bj.find(".legend").remove();if(!a6.legend.show){return}var h=[],k=false,p=a6.legend.labelFormatter,q,t;for(var l=0;l<a4.length;++l){q=a4[l];t=q.label;if(!t){continue}if(l%a6.legend.noColumns==0){if(k){h.push("</tr>")}h.push("<tr>");k=true}if(p){t=p(t,q)}h.push('<td class="legendColorBox"><div style="border:1px solid '+a6.legend.labelBoxBorderColor+';padding:1px"><div style="width:4px;height:0;border:5px solid '+q.color+';overflow:hidden"></div></div></td><td class="legendLabel">'+t+"</td>")}if(k){h.push("</tr>")}if(h.length==0){return}var r='<table style="font-size:smaller;color:'+a6.grid.color+'">'+h.join("")+"</table>";if(a6.legend.container!=null){f(a6.legend.container).html(r)}else{var g="",n=a6.legend.position,m=a6.legend.margin;if(m[0]==null){m=[m,m]}if(n.charAt(0)=="n"){g+="top:"+(m[1]+aJ.top)+"px;"}else{if(n.charAt(0)=="s"){g+="bottom:"+(m[1]+aJ.bottom)+"px;"}}if(n.charAt(1)=="e"){g+="right:"+(m[0]+aJ.right)+"px;"}else{if(n.charAt(1)=="w"){g+="left:"+(m[0]+aJ.left)+"px;"}}var s=f('<div class="legend">'+r.replace('style="','style="position:absolute;'+g+";")+"</div>").appendTo(bj);if(a6.legend.backgroundOpacity!=0){var j=a6.legend.backgroundColor;if(j==null){j=a6.grid.backgroundColor;if(j&&typeof j=="string"){j=f.color.parse(j)}else{j=f.color.extract(s,"background-color")}j.a=1;j=j.toString()}var o=s.children();f('<div style="position:absolute;width:'+o.width()+"px;height:"+o.height()+"px;"+g+"background-color:"+j+';"> </div>').prependTo(s).css("opacity",a6.legend.backgroundOpacity)}}}var bH=[],a9=null;function bb(x,z,C){var r=a6.grid.mouseActiveRadius,F=r*r+1,g=null,o=false,j,l;for(j=a4.length-1;j>=0;--j){if(!C(a4[j])){continue}var q=a4[j],y=q.xaxis,A=q.yaxis,k=q.datapoints.points,m=q.datapoints.pointsize,p=y.c2p(x),s=A.c2p(z),D=r/y.scale,E=r/A.scale;if(y.options.inverseTransform){D=Number.MAX_VALUE}if(A.options.inverseTransform){E=Number.MAX_VALUE}if(q.lines.show||q.points.show){for(l=0;l<k.length;l+=m){var v=k[l],w=k[l+1];if(v==null){continue}if(v-p>D||v-p<-D||w-s>E||w-s<-E){continue}var t=Math.abs(y.p2c(v)-x),u=Math.abs(A.p2c(w)-z),n=t*t+u*u;if(n<F){F=n;g=[j,l/m]}}}if(q.bars.show&&!g){var B=q.bars.align=="left"?0:-q.bars.barWidth/2,h=B+q.bars.barWidth;for(l=0;l<k.length;l+=m){var v=k[l],w=k[l+1],G=k[l+2];if(v==null){continue}if(a4[j].bars.horizontal?(p<=Math.max(G,v)&&p>=Math.min(G,v)&&s>=w+B&&s<=w+h):(p>=v+B&&p<=v+h&&s>=Math.min(G,w)&&s<=Math.max(G,w))){g=[j,l/m]}}}}if(g){j=g[0];l=g[1];m=a4[j].datapoints.pointsize;return{datapoint:a4[j].datapoints.points.slice(l*m,(l+1)*m),dataIndex:l,series:a4[j],seriesIndex:j}}return null}function bI(g){if(a6.grid.hoverable){aF("plothover",g,function(h){return h.hoverable!=false})}}function aO(g){if(a6.grid.hoverable){aF("plothover",g,function(h){return false})}}function a3(g){aF("plotclick",g,function(h){return h.clickable!=false})}function aF(n,o,m){var l=c.offset(),h=o.pageX-l.left-aJ.left,k=o.pageY-l.top-aJ.top,q=bq({left:h,top:k});q.pageX=o.pageX;q.pageY=o.pageY;var p=bb(h,k,m);if(p){p.pageX=parseInt(p.series.xaxis.p2c(p.datapoint[0])+l.left+aJ.left);p.pageY=parseInt(p.series.yaxis.p2c(p.datapoint[1])+l.top+aJ.top)}if(a6.grid.autoHighlight){for(var j=0;j<bH.length;++j){var g=bH[j];if(g.auto==n&&!(p&&g.series==p.series&&g.point[0]==p.datapoint[0]&&g.point[1]==p.datapoint[1])){a0(g.series,g.point)}}if(p){aC(p.series,p.datapoint,n)}}bj.trigger(n,[q,p])}function aS(){var g=a6.interaction.redrawOverlayInterval;if(g==-1){aH();return}if(!a9){a9=setTimeout(aH,g)}}function aH(){a9=null;a.save();a.clearRect(0,0,bi,be);a.translate(aJ.left,aJ.top);var g,h;for(g=0;g<bH.length;++g){h=bH[g];if(h.series.bars.show){aE(h.series,h.point)}else{bc(h.series,h.point)}}a.restore();bv(by.drawOverlay,[a])}function aC(j,l,g){if(typeof j=="number"){j=a4[j]}if(typeof l=="number"){var h=j.datapoints.pointsize;l=j.datapoints.points.slice(h*l,h*(l+1))}var k=bx(j,l);if(k==-1){bH.push({series:j,point:l,auto:g});aS()}else{if(!g){bH[k].auto=false}}}function a0(g,j){if(g==null&&j==null){bH=[];aS()}if(typeof g=="number"){g=a4[g]}if(typeof j=="number"){j=g.data[j]}var h=bx(g,j);if(h!=-1){bH.splice(h,1);aS()}}function bx(h,g){for(var k=0;k<bH.length;++k){var j=bH[k];if(j.series==h&&j.point[0]==g[0]&&j.point[1]==g[1]){return k}}return -1}function bc(j,k){var l=k[0],n=k[1],o=j.xaxis,g=j.yaxis;if(l<o.min||l>o.max||n<g.min||n>g.max){return}var h=j.points.radius+j.points.lineWidth/2;a.lineWidth=h;a.strokeStyle=f.color.parse(j.color).scale("a",0.5).toString();var m=1.5*h,l=o.p2c(l),n=g.p2c(n);a.beginPath();if(j.points.symbol=="circle"){a.arc(l,n,m,0,2*Math.PI,false)}else{j.points.symbol(a,l,n,m,false)}a.closePath();a.stroke()}function aE(g,k){a.lineWidth=g.bars.lineWidth;a.strokeStyle=f.color.parse(g.color).scale("a",0.5).toString();var h=f.color.parse(g.color).scale("a",0.5).toString();var j=g.bars.align=="left"?0:-g.bars.barWidth/2;bm(k[0],k[1],k[2]||0,j,j+g.bars.barWidth,0,function(){return h},g.xaxis,g.yaxis,a,g.bars.horizontal,g.bars.lineWidth)}function bw(p,o,h,n){if(typeof p=="string"){return p}else{var g=bg.createLinearGradient(0,h,0,o);for(var l=0,m=p.colors.length;l<m;++l){var k=p.colors[l];if(typeof k!="string"){var j=f.color.parse(n);if(k.brightness!=null){j=j.scale("rgb",k.brightness)}if(k.opacity!=null){j.a*=k.opacity}k=j.toString()}g.addColorStop(l/(m-1),k)}return g}}}f.plot=function(a,c,h){var b=new d(f(a),c,h,f.plot.plugins);return b};f.plot.version="0.7";f.plot.plugins=[];f.plot.formatDate=function(r,w,u){var b=function(g){g=""+g;return g.length==1?"0"+g:g};var x=[];var a=false,t=false;var c=r.getUTCHours();var s=c<12;if(u==null){u=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}if(w.search(/%p|%P/)!=-1){if(c>12){c=c-12}else{if(c==0){c=12}}}for(var v=0;v<w.length;++v){var q=w.charAt(v);if(a){switch(q){case"h":q=""+c;break;case"H":q=b(c);break;case"M":q=b(r.getUTCMinutes());break;case"S":q=b(r.getUTCSeconds());break;case"d":q=""+r.getUTCDate();break;case"m":q=""+(r.getUTCMonth()+1);break;case"y":q=""+r.getUTCFullYear();break;case"b":q=""+u[r.getUTCMonth()];break;case"p":q=(s)?("am"):("pm");break;case"P":q=(s)?("AM"):("PM");break;case"0":q="";t=true;break}if(q&&t){q=b(q);t=false}x.push(q);if(!t){a=false}}else{if(q=="%"){a=true}else{x.push(q)}}}return x.join("")};function e(a,b){return b*Math.floor(a/b)}})(jQuery);define("lib/flot/jquery.flot",function(){});(function(d){function c(x){var s={first:{x:-1,y:-1},second:{x:-1,y:-1},show:false,active:false};var v={};var a=null;function D(e){if(s.active){w(e);x.getPlaceholder().trigger("plotselecting",[B()])}}function u(e){if(e.which!=1){return}document.body.focus();if(document.onselectstart!==undefined&&v.onselectstart==null){v.onselectstart=document.onselectstart;document.onselectstart=function(){return false}}if(document.ondrag!==undefined&&v.ondrag==null){v.ondrag=document.ondrag;document.ondrag=function(){return false}}E(s.first,e);s.active=true;a=function(f){y(f)};d(document).one("mouseup",a)}function y(e){a=null;if(document.onselectstart!==undefined){document.onselectstart=v.onselectstart}if(document.ondrag!==undefined){document.ondrag=v.ondrag}s.active=false;w(e);if(C()){z()}else{x.getPlaceholder().trigger("plotunselected",[]);x.getPlaceholder().trigger("plotselecting",[null])}return false}function B(){if(!C()){return null}var e={},f=s.first,g=s.second;d.each(x.getAxes(),function(k,j){if(j.used){var l=j.c2p(f[j.direction]),h=j.c2p(g[j.direction]);e[k]={from:Math.min(l,h),to:Math.max(l,h)}}});return e}function z(){var e=B();x.getPlaceholder().trigger("plotselected",[e]);if(e.xaxis&&e.yaxis){x.getPlaceholder().trigger("selected",[{x1:e.xaxis.from,y1:e.yaxis.from,x2:e.xaxis.to,y2:e.yaxis.to}])}}function A(f,e,g){return e<f?f:(e>g?g:e)}function E(e,h){var f=x.getOptions();var g=x.getPlaceholder().offset();var j=x.getPlotOffset();e.x=A(0,h.pageX-g.left-j.left,x.width());e.y=A(0,h.pageY-g.top-j.top,x.height());if(f.selection.mode=="y"){e.x=e==s.first?0:x.width()}if(f.selection.mode=="x"){e.y=e==s.first?0:x.height()}}function w(e){if(e.pageX==null){return}E(s.second,e);if(C()){s.show=true;x.triggerRedrawOverlay()}else{b(true)}}function b(e){if(s.show){s.show=false;x.triggerRedrawOverlay();if(!e){x.getPlaceholder().trigger("plotunselected",[])}}}function F(n,j){var m,g,f,e,h=x.getAxes();for(var l in h){m=h[l];if(m.direction==j){e=j+m.n+"axis";if(!n[e]&&m.n==1){e=j+"axis"}if(n[e]){g=n[e].from;f=n[e].to;break}}}if(!n[e]){m=j=="x"?x.getXAxes()[0]:x.getYAxes()[0];g=n[j+"1"];f=n[j+"2"]}if(g!=null&&f!=null&&g>f){var k=g;g=f;f=k}return{from:g,to:f,axis:m}}function t(h,j){var f,g,e=x.getOptions();if(e.selection.mode=="y"){s.first.x=0;s.second.x=x.width()}else{g=F(h,"x");s.first.x=g.axis.p2c(g.from);s.second.x=g.axis.p2c(g.to)}if(e.selection.mode=="x"){s.first.y=0;s.second.y=x.height()}else{g=F(h,"y");s.first.y=g.axis.p2c(g.from);s.second.y=g.axis.p2c(g.to)}s.show=true;x.triggerRedrawOverlay();if(!j&&C()){z()}}function C(){var e=5;return Math.abs(s.second.x-s.first.x)>=e&&Math.abs(s.second.y-s.first.y)>=e}x.clearSelection=b;x.setSelection=t;x.getSelection=B;x.hooks.bindEvents.push(function(f,g){var e=f.getOptions();if(e.selection.mode!=null){g.mousemove(D);g.mousedown(u)}});x.hooks.drawOverlay.push(function(k,e){if(s.show&&C()){var m=k.getPlotOffset();var n=k.getOptions();e.save();e.translate(m.left,m.top);var j=d.color.parse(n.selection.color);e.strokeStyle=j.scale("a",0.8).toString();e.lineWidth=1;e.lineJoin="round";e.fillStyle=j.scale("a",0.4).toString();var g=Math.min(s.first.x,s.second.x),h=Math.min(s.first.y,s.second.y),f=Math.abs(s.second.x-s.first.x),l=Math.abs(s.second.y-s.first.y);e.fillRect(g,h,f,l);e.strokeRect(g,h,f,l);e.restore()}});x.hooks.shutdown.push(function(e,f){f.unbind("mousemove",D);f.unbind("mousedown",u);if(a){d(document).unbind("mouseup",a)}})}d.plot.plugins.push({init:c,options:{selection:{mode:null,color:"#e8cfac"}},name:"selection",version:"1.1"})})(jQuery);define("lib/flot/jquery.flot.selection",function(){});define("graph",["jquery","lib/jquery.template","order!lib/flot/jquery.flot","order!lib/flot/jquery.flot.selection"],function(g){var h=function(){};var f=function(a){var b=[];a.renderTo&&(b=g("#"+a.renderTo));if(!b.length){throw new Error("no render container")}this.renderdata=[];this.config=g.extend(true,{},f.__config,a.config);this.events=g.extend(true,{},f.__events,a.events);this.plot=g.plot(b[0],this.renderdata,this.config.base);this.placeholder=this.plot.getPlaceholder();this._renderUI();this._bindEvents()};var e=f.prototype;e.render=function(a){a=this.events.datapreprocess(a);this.renderdata=this.events._datapreprocess(a);this.resetHist(this.renderdata);this.redraw(this.renderdata)};e.redraw=function(a){this.plot.setData(a);this.plot.setupGrid();this.plot.draw();this.plot.clearSelection()};e.resetHist=function(a){this.renderhist=[];this.renderhist[0]=a};e.getRenderData=function(b,r){var c,d,a=this.renderdata,p=[];if(typeof b=="undefined"&&typeof r=="undefined"){return a}for(var o=0,q=a.length;o<q;++o){c=g.extend(true,{},a[o]);d=g.grep(c.data,function(k,j){return k[0]>=b&&k[0]<=r});if(d.length!==0){c.data=d;p.push(c)}}return p};e._transToPointData=function(q){var o=[],a,b;for(var c=0,p=q.length;c<p;++c){a=q[c];b=a.data;for(var j=0,d=b.length;j<d;++j){if(b[j][2]){o.push({x:b[j][0],y:b[j][1],color:a.color,label:a.label,data:b[j][2]})}}}return o};e._renderUI=function(){var p=this.config.ui,a=this.placeholder,q=a.width(),d=a.height(),c,b,o,n;b=g("<div>").html(p.coord.x.content).addClass(p.coord.x.cls).css({position:"absolute",bottom:-15,left:q-50});o=g("<div>").html(p.coord.y.content).addClass(p.coord.y.cls).css({position:"absolute",top:5,left:-20});c=g("<div>").html(p.tip.content).addClass(p.tip.cls).css({position:"absolute",top:25,left:120});n=g("<div>").html(p.back.content).attr("title",p.back.content).addClass(p.back.cls).bind("click",(function(j){return function(k){j._goBack()}})(this));a.append(c).append(b).append(o).append(n)};e._goBack=function(){var a=this.renderhist.length;if(a===1){return}this.renderhist.pop();a=this.renderhist.length;this.redraw(this.renderhist[a-1])};e._bindEvents=function(){var c=this;a();b();function b(){var d=c.events.datarangeselect;c.placeholder.unbind("plotselected").bind("plotselected",function(p,q){var n=Math.ceil(q.xaxis.from),r=Math.floor(q.xaxis.to);if(n>r){c.plot.clearSelection();return}var o=c.getRenderData(n,r);c.redraw(o);c.renderhist.push(o);d.call(c,c._transToPointData(o))})}function a(){var d=null,n=null,m=c.events.datapointhover.hoverin,l=c.events.datapointhover.hoverout;c.placeholder.unbind("plothover").bind("plothover",function(k,o,j){if(j){if(n!==j.dataIndex){n=j.dataIndex;clearTimeout(d);d=setTimeout(function(){var s=(g.grep(j.series.data,function(p,q){return p[0]===j.datapoint[0]&&p[1]===j.datapoint[1]}))[0];var t={x:s[0],y:s[1],color:j.series.color,label:j.series.label,data:s[2]};var r={top:j.pageY,left:j.pageX};m.call(c,r,t)},150)}}else{clearTimeout(d);l.call(c);n=null}})}};f.__config={base:{series:{lines:{show:true},points:{show:true}},grid:{hoverable:true,clickable:true},selection:{mode:"x"}},ui:{back:{content:"",cls:""},tip:{content:"(,)",cls:""},coord:{x:{content:"x",cls:""},y:{content:"y",cls:""}}}};f.__events={_datapreprocess:function(a){a=a||[];for(var b=0,d=a.length;b<d;++b){var c=a[b];if(c.label){c.label=g.tmpl.object(c.label,{count:c.data.length})}}return a},datapreprocess:function(a){return a},datarangeselect:h,datapointhover:{hoverin:h,hoverout:h}};return f});define("ctm",["jquery","lib/pubsub","animator","cube","textParticle","widget","graph"],function(e,a,c,h,g,d,b){var f={};f.init=function(){this.Scene.init();this.NetData.init();this.ViewGraph.init()};f.Scene={init:function(){this.painter=e("#painter");this.content=e("#content");this.initActor();this.initMessageResponse();this.bindEvent();this.animator.start()},initActor:function(){this.animator=new c({container:this.painter,camera:{pos:[0,0,550]},mediator:a});this.cube=new h({scene:this.animator.scene,size:200,pos:[-10,-20,-10000],rotSpeed:[1.8*0.005,2.4*0.005,0],textures:f.util.generateTextures("cube",6,".jpg")});this.textParticle=new g({scene:this.animator.scene,amount:31,textures:f.util.generateTextures("text",31,".png")});this.animator.addActors([this.cube,this.textParticle])},initMessageResponse:function(){var p=false,j=this.cube,m=this.animator,l=this.painter,o=this.content,n,k=e("#regionInfo");a.subscribe("actorsUpdated",function(r,q){if(j.arrviedEnd=="far"){m.stop();l.fadeOut("fast",function(){j.arrviedEnd="none";if(!m.isAnimated()){a.publish("animatorStopped",n);o.fadeIn("fast")}})}});a.subscribe("dataReceived",function(r,q){j.move({speed:[0,0,100],near:0})});a.subscribe("mouseOverCube",function(r,q){l[0].style.cursor="pointer";if(!p){j.stop();p=false}});a.subscribe("mouseOutCube",function(r,q){l[0].style.cursor="auto";j.start()});a.subscribe("mouseClickCube",function(r,q){j.move({speed:[140,75,-100],far:-2000});j.start();p=true;n=f.util.materialIndexToRegion[parseInt(q,10)];k.html(n.content)});a.subscribe("mouseClickBack",function(r,q){o.fadeOut("fast",function(){l.fadeIn("fast",function(){j.move({speed:[-140,-75,100],near:0});m.start();p=false})})})},bindEvent:function(){var l=this.animator,j=this.cube,k=this.painter,m=e("#cubeBack"),q=[];var o=function(r){q=l.getIntersects(r);if(q.length!=0){if(q[0].object.id==j.mesh.id){a.publish("mouseOverCube")}}else{a.publish("mouseOutCube")}},n=function(r){q=l.getIntersects(r);if(q.length!=0){if(q[0].object.id==j.mesh.id){a.publish("mouseClickCube",q[0].face.materialIndex)}}},p=function(r){a.publish("mouseClickBack")};k.on("click",n);k.on("mousemove",o);m.on("click",p)}};f.NetData={init:function(){this.fetch()},fetch:function(){var j=this;e.getJSON(f.config.fetchUrl,function(k){j.receivedData=k;a.publish("dataReceived")})},getData:function(n,l){var m=this.receivedData[n][l],o=[];for(var k=0,j=m.length;k<j;++k){o.push(e.extend({},m[k]))}return o},getLevelData:function(q,p){var n,r=this.getData(q,p),o=r.length,l,m,s,k=[-1];for(n=0;n<o;++n){m=r[n].data;s=m.length;k.push([m[0][0],m[s-1][0]])}k[0]=[k[1][0],k[k.length-1][1]];return k},getListData:function(r,q){var n,t=this.getData(r,q),p=t.length,l,m,u,s,o=[];for(n=0;n<p;++n){s=t[n].label.slice(0,2);m=t[n].data;u=m.length;for(l=0;l<u;++l){var k=m[l];o.push({l:s,f:k[1],d:k[2]})}}return o}};f.ViewGraph={init:function(){this.initWidget();this.initGraph();this.initMessageResponse();this.bindEvent();this.dataContainer.render()},initWidget:function(){this.tip=new d.Tip({cls:"data-info",tmpl:"<ul><li><em>: </em>{d}</li><li><em>: </em>{f}</li><li><em>: </em>{l}</li></ul>"});this.list=new d.List({cls:"data-list",tmpl:'<span class="f">{f}</span><span class="d">{d}</span><span class="l">{l}</span>'});this.dataContainer=new d.Base({cls:"data-container",header:e("<div/>").html('<span class="f"></span><span class="d"></span><span class="l"></span>'),container:e("#dataWin")})},initGraph:function(){var k=this.tip,j=this.list;this.graph=new b({renderTo:"placeHolder",config:{base:{xaxis:{tickDecimals:0,color:"#fff"},yaxis:{tickDecimals:0,color:"#fff"},grid:{backgroundColor:{colors:["#ffd986","#f9b447"]}}},ui:{back:{cls:"go-back"},tip:{cls:"usage-tip"},coord:{x:{content:"",cls:"coord-tip"},y:{content:"<br/>",cls:"coord-tip"}}}},events:{datapreprocess:function(p){var m=f.config.colors;for(var o=0,l=p.length;o<l;++o){var n=p[o];n.label&&(n.label=n.label+"<{count}>");n.color=m[o]}return p},datarangeselect:function(l){},datapointhover:{hoverin:function(m,l){k.render({data:{d:l.data,f:l.y,l:l.label.slice(0,2)},style:{top:m.top,left:m.left,backgroundColor:l.color}});j.slideTo(l.x,{backgroundColor:l.color,"border-radius":3})},hoverout:function(){k.unrender()}}}})},initMessageResponse:function(){var o=this.graph,n=this.list,q=this.dataContainer,p,m="char",l=e("#typeMenu").find("button"),k=e("#levelMenu").find("button"),j=this;a.subscribe("animatorStopped",function(s,r){l.removeClass("checked");k.removeClass("checked");e(l[0]).addClass("checked");e(k[0]).addClass("checked");p=r.region;j._render(p,"char")});a.subscribe("mouseClickTypeButton",function(r,s){m=s;j._render(p,m)});a.subscribe("mouseClickLevelButton",function(s,v){var t=f.NetData.getLevelData(p,m),w=parseInt(v,10),r=t[w],u=o.getRenderData(r[0],r[1]);o.redraw(u);o.resetHist(u)});a.subscribe("mouseClickSearchButton",function(x,v){var u=f.NetData.getListData(p,m),s=f.config.colors;for(var t=0,r=u.length;t<r;++t){if(u[t].d==v){var w=parseInt(u[t].l,10);n.slideTo(t+1,{backgroundColor:s[w-1],"border-radius":3});break}}if(t>=r){alert(":"+v)}})},bindEvent:function(){var j=e("#levelMenu").find("button"),l=e("#typeMenu").find("button"),m=e("#searchKey"),k=e("#searchForm");l.on("click",function(n){var p=e(this),o=p.val();if(p.hasClass("checked")){return}l.removeClass("checked");p.addClass("checked");j.removeClass("checked");e(j[0]).addClass("checked");a.publish("mouseClickTypeButton",o)});j.on("click",function(n){var p=e(this),o=p.val();if(p.hasClass("checked")){return}j.removeClass("checked");p.addClass("checked");a.publish("mouseClickLevelButton",o)});m.on("focusin",function(n){if(e.trim(m.val())=="..."){m.removeClass("search-key").val("")}});m.on("focusout",function(n){if(e.trim(m.val())==""){m.addClass("search-key").val("...")}});k.on("submit",function(n){n.preventDefault();var o=e.trim(m.val());a.publish("mouseClickSearchButton",o)})},_render:function(o,j){var n=this.graph,m=this.list,p=this.dataContainer,l=f.NetData.getData(o,j),k=f.NetData.getListData(o,j);setTimeout(function(){console.time("render graph");n.render(l);console.timeEnd("render graph")},0);setTimeout(function(){console.time("render data list");var q=m.render(k).html();console.timeEnd("render data list");console.time("render data container");p.update({body:q});console.timeEnd("render data container")},0)}};f.config={fetchUrl:"data/fetchdata.php",textureUrl:"image/textures/",colors:["#e44323","#3686cc","#6caf24","#806061"]};f.util={generateTextures:function(o,m,n){var k=f.config.textureUrl,j=[];for(var l=1;l<=m;++l){j.push(k+o+"/"+l+n)}return j},materialIndexToRegion:[{region:"all",content:""},{region:"all",content:""},{region:"ml",content:""},{region:"hmt",content:""},{region:"jk",content:""},{region:"other",content:""}]};return f});require(["jquery","ctm"],function(a,b){b.init()});define("main",function(){});