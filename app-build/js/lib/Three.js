define(function(){var d=window;var c=c||{};if(!d.Int32Array){d.Int32Array=Array,d.Float32Array=Array}c.Clock=function(a){this.autoStart=a!==void 0?a:!0;this.elapsedTime=this.oldTime=this.startTime=0;this.running=!1};c.Clock.prototype.start=function(){this.oldTime=this.startTime=Date.now();this.running=!0};c.Clock.prototype.stop=function(){this.getElapsedTime();this.running=!1};c.Clock.prototype.getElapsedTime=function(){this.elapsedTime+=this.getDelta();return this.elapsedTime};c.Clock.prototype.getDelta=function(){var b=0;this.autoStart&&!this.running&&this.start();if(this.running){var a=Date.now(),b=0.001*(a-this.oldTime);this.oldTime=a;this.elapsedTime+=b}return b};c.Color=function(a){a!==void 0&&this.setHex(a);return this};c.Color.prototype={constructor:c.Color,r:1,g:1,b:1,copy:function(a){this.r=a.r;this.g=a.g;this.b=a.b;return this},copyGammaToLinear:function(a){this.r=a.r*a.r;this.g=a.g*a.g;this.b=a.b*a.b;return this},copyLinearToGamma:function(a){this.r=Math.sqrt(a.r);this.g=Math.sqrt(a.g);this.b=Math.sqrt(a.b);return this},setRGB:function(b,a,g){this.r=b;this.g=a;this.b=g;return this},setHSV:function(m,a,n){var b,g,f;if(n===0){this.r=this.g=this.b=0}else{switch(b=Math.floor(m*6),g=m*6-b,m=n*(1-a),f=n*(1-a*g),a=n*(1-a*(1-g)),b){case 1:this.r=f;this.g=n;this.b=m;break;case 2:this.r=m;this.g=n;this.b=a;break;case 3:this.r=m;this.g=f;this.b=n;break;case 4:this.r=a;this.g=m;this.b=n;break;case 5:this.r=n;this.g=m;this.b=f;break;case 6:case 0:this.r=n,this.g=a,this.b=m}}return this},setHex:function(a){a=Math.floor(a);this.r=(a>>16&255)/255;this.g=(a>>8&255)/255;this.b=(a&255)/255;return this},getHex:function(){return ~~(this.r*255)<<16^~~(this.g*255)<<8^~~(this.b*255)},getContextStyle:function(){return"rgb("+Math.floor(this.r*255)+","+Math.floor(this.g*255)+","+Math.floor(this.b*255)+")"},clone:function(){return(new c.Color).setRGB(this.r,this.g,this.b)}};c.Vector2=function(b,a){this.x=b||0;this.y=a||0};c.Vector2.prototype={constructor:c.Vector2,set:function(b,a){this.x=b;this.y=a;return this},copy:function(a){this.x=a.x;this.y=a.y;return this},clone:function(){return new c.Vector2(this.x,this.y)},add:function(b,a){this.x=b.x+a.x;this.y=b.y+a.y;return this},addSelf:function(a){this.x+=a.x;this.y+=a.y;return this},sub:function(b,a){this.x=b.x-a.x;this.y=b.y-a.y;return this},subSelf:function(a){this.x-=a.x;this.y-=a.y;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;return this},divideScalar:function(a){a?(this.x/=a,this.y/=a):this.set(0,0);return this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(b){var a=this.x-b.x,b=this.y-b.y;return a*a+b*b},setLength:function(a){return this.normalize().multiplyScalar(a)},equals:function(a){return a.x===this.x&&a.y===this.y}};c.Vector3=function(b,a,g){this.x=b||0;this.y=a||0;this.z=g||0};c.Vector3.prototype={constructor:c.Vector3,set:function(b,a,g){this.x=b;this.y=a;this.z=g;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this},clone:function(){return new c.Vector3(this.x,this.y,this.z)},add:function(b,a){this.x=b.x+a.x;this.y=b.y+a.y;this.z=b.z+a.z;return this},addSelf:function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;return this},sub:function(b,a){this.x=b.x-a.x;this.y=b.y-a.y;this.z=b.z-a.z;return this},subSelf:function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;return this},multiply:function(b,a){this.x=b.x*a.x;this.y=b.y*a.y;this.z=b.z*a.z;return this},multiplySelf:function(a){this.x*=a.x;this.y*=a.y;this.z*=a.z;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;this.z*=a;return this},divideSelf:function(a){this.x/=a.x;this.y/=a.y;this.z/=a.z;return this},divideScalar:function(a){a?(this.x/=a,this.y/=a,this.z/=a):this.z=this.y=this.x=0;return this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.lengthSq())},lengthManhattan:function(){return this.x+this.y+this.z},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){return this.normalize().multiplyScalar(a)},cross:function(b,a){this.x=b.y*a.z-b.z*a.y;this.y=b.z*a.x-b.x*a.z;this.z=b.x*a.y-b.y*a.x;return this},crossSelf:function(i){var a=this.x,j=this.y,b=this.z;this.x=j*i.z-b*i.y;this.y=b*i.x-a*i.z;this.z=a*i.y-j*i.x;return this},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){return(new c.Vector3).sub(this,a).lengthSq()},setPositionFromMatrix:function(a){this.x=a.n14;this.y=a.n24;this.z=a.n34},setRotationFromMatrix:function(b){var a=Math.cos(this.y);this.y=Math.asin(b.n13);Math.abs(a)>0.00001?(this.x=Math.atan2(-b.n23/a,b.n33/a),this.z=Math.atan2(-b.n12/a,b.n11/a)):(this.x=0,this.z=Math.atan2(b.n21,b.n22))},isZero:function(){return this.lengthSq()<0.0001}};c.Vector4=function(i,a,j,b){this.x=i||0;this.y=a||0;this.z=j||0;this.w=b!==void 0?b:1};c.Vector4.prototype={constructor:c.Vector4,set:function(i,a,j,b){this.x=i;this.y=a;this.z=j;this.w=b;return this},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w!==void 0?a.w:1},clone:function(){return new c.Vector4(this.x,this.y,this.z,this.w)},add:function(b,a){this.x=b.x+a.x;this.y=b.y+a.y;this.z=b.z+a.z;this.w=b.w+a.w;return this},addSelf:function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;this.w+=a.w;return this},sub:function(b,a){this.x=b.x-a.x;this.y=b.y-a.y;this.z=b.z-a.z;this.w=b.w-a.w;return this},subSelf:function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;this.w-=a.w;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;this.z*=a;this.w*=a;return this},divideScalar:function(a){a?(this.x/=a,this.y/=a,this.z/=a,this.w/=a):(this.z=this.y=this.x=0,this.w=1);return this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w},lengthSq:function(){return this.dot(this)},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){return this.normalize().multiplyScalar(a)},lerpSelf:function(b,a){this.x+=(b.x-this.x)*a;this.y+=(b.y-this.y)*a;this.z+=(b.z-this.z)*a;this.w+=(b.w-this.w)*a;return this}};c.Ray=function(a,e){function b(s,v,j){r.sub(j,s);A=r.dot(v);if(A<=0){return null}p=t.add(s,o.copy(v).multiplyScalar(A));return w=j.distanceTo(p)}function f(v,z,j,s){r.sub(s,z);t.sub(j,z);o.sub(v,z);F=r.dot(r);y=r.dot(t);Y=r.dot(o);x=t.dot(t);q=t.dot(o);u=1/(F*x-y*y);B=(x*Y-y*q)*u;Z=(F*q-y*Y)*u;return B>=0&&Z>=0&&B+Z<1}this.origin=a||new c.Vector3;this.direction=e||new c.Vector3;this.intersectScene=function(j){return this.intersectObjects(j.children)};this.intersectObjects=function(v){var z,j,s=[];z=0;for(j=v.length;z<j;z++){Array.prototype.push.apply(s,this.intersectObject(v[z]))}s.sort(function(C,D){return C.distance-D.distance});return s};var i=new c.Vector3,h=new c.Vector3,g=new c.Vector3,k=new c.Vector3,a=new c.Vector3,e=new c.Vector3,l=new c.Vector3,n=new c.Vector3,m=new c.Vector3;this.intersectObject=function(z){for(var C,D=[],E=0,H=z.children.length;E<H;E++){Array.prototype.push.apply(D,this.intersectObject(z.children[E]))}if(z instanceof c.Particle){E=b(this.origin,this.direction,z.matrixWorld.getPosition());if(E===null||E>z.scale.x){return[]}C={distance:E,point:z.position,face:null,object:z};D.push(C)}else{if(z instanceof c.Mesh){E=b(this.origin,this.direction,z.matrixWorld.getPosition());if(E===null||E>z.geometry.boundingSphere.radius*Math.max(z.scale.x,Math.max(z.scale.y,z.scale.z))){return D}var G,j=z.geometry,v=j.vertices,s;z.matrixRotationWorld.extractRotation(z.matrixWorld);E=0;for(H=j.faces.length;E<H;E++){if(C=j.faces[E],a.copy(this.origin),e.copy(this.direction),s=z.matrixWorld,l=s.multiplyVector3(l.copy(C.centroid)).subSelf(a),G=l.dot(e),!(G<=0)&&(i=s.multiplyVector3(i.copy(v[C.a].position)),h=s.multiplyVector3(h.copy(v[C.b].position)),g=s.multiplyVector3(g.copy(v[C.c].position)),C instanceof c.Face4&&(k=s.multiplyVector3(k.copy(v[C.d].position))),n=z.matrixRotationWorld.multiplyVector3(n.copy(C.normal)),G=e.dot(n),z.doubleSided||(z.flipSided?G>0:G<0))){if(G=n.dot(l.sub(i,a))/G,m.add(a,e.multiplyScalar(G)),C instanceof c.Face3){f(m,i,h,g)&&(C={distance:a.distanceTo(m),point:m.clone(),face:C,object:z},D.push(C))}else{if(C instanceof c.Face4&&(f(m,i,h,k)||f(m,h,g,k))){C={distance:a.distanceTo(m),point:m.clone(),face:C,object:z},D.push(C)}}}}}}return D};var r=new c.Vector3,t=new c.Vector3,o=new c.Vector3,A,p,w,F,y,Y,x,q,u,B,Z};c.Rectangle=function(){function f(){a=q-h;r=b-g}var h,g,q,b,a,r,e=!0;this.getX=function(){return h};this.getY=function(){return g};this.getWidth=function(){return a};this.getHeight=function(){return r};this.getLeft=function(){return h};this.getTop=function(){return g};this.getRight=function(){return q};this.getBottom=function(){return b};this.set=function(k,j,l,i){e=!1;h=k;g=j;q=l;b=i;f()};this.addPoint=function(j,i){e?(e=!1,h=j,g=i,q=j,b=i):(h=h<j?h:j,g=g<i?g:i,q=q>j?q:j,b=b>i?b:i);f()};this.add3Points=function(k,l,m,j,i,n){e?(e=!1,h=k<m?k<i?k:i:m<i?m:i,g=l<j?l<n?l:n:j<n?j:n,q=k>m?k>i?k:i:m>i?m:i,b=l>j?l>n?l:n:j>n?j:n):(h=k<m?k<i?k<h?k:h:i<h?i:h:m<i?m<h?m:h:i<h?i:h,g=l<j?l<n?l<g?l:g:n<g?n:g:j<n?j<g?j:g:n<g?n:g,q=k>m?k>i?k>q?k:q:i>q?i:q:m>i?m>q?m:q:i>q?i:q,b=l>j?l>n?l>b?l:b:n>b?n:b:j>n?j>b?j:b:n>b?n:b);f()};this.addRectangle=function(i){e?(e=!1,h=i.getLeft(),g=i.getTop(),q=i.getRight(),b=i.getBottom()):(h=h<i.getLeft()?h:i.getLeft(),g=g<i.getTop()?g:i.getTop(),q=q>i.getRight()?q:i.getRight(),b=b>i.getBottom()?b:i.getBottom());f()};this.inflate=function(i){h-=i;g-=i;q+=i;b+=i;f()};this.minSelf=function(i){h=h>i.getLeft()?h:i.getLeft();g=g>i.getTop()?g:i.getTop();q=q<i.getRight()?q:i.getRight();b=b<i.getBottom()?b:i.getBottom();f()};this.intersects=function(i){return Math.min(q,i.getRight())-Math.max(h,i.getLeft())>=0&&Math.min(b,i.getBottom())-Math.max(g,i.getTop())>=0};this.empty=function(){e=!0;b=q=g=h=0;f()};this.isEmpty=function(){return e}};c.Math={clamp:function(b,a,g){return b<a?a:b>g?g:b},clampBottom:function(b,a){return b<a?a:b},mapLinear:function(k,a,l,b,g){return b+(k-a)*(g-b)/(l-a)},random16:function(){return(65280*Math.random()+255*Math.random())/65535}};c.Matrix3=function(){this.m=[]};c.Matrix3.prototype={constructor:c.Matrix3,transpose:function(){var b,a=this.m;b=a[1];a[1]=a[3];a[3]=b;b=a[2];a[2]=a[6];a[6]=b;b=a[5];a[5]=a[7];a[7]=b;return this},transposeIntoArray:function(b){var a=this.m;b[0]=a[0];b[1]=a[3];b[2]=a[6];b[3]=a[1];b[4]=a[4];b[5]=a[7];b[6]=a[2];b[7]=a[5];b[8]=a[8];return this}};c.Matrix4=function(r,a,H,e,i,g,f,k,l,n,m,G,b,o,h,p){this.set(r!==void 0?r:1,a||0,H||0,e||0,i||0,g!==void 0?g:1,f||0,k||0,l||0,n||0,m!==void 0?m:1,G||0,b||0,o||0,h||0,p!==void 0?p:1);this.flat=Array(16);this.m33=new c.Matrix3};c.Matrix4.prototype={constructor:c.Matrix4,set:function(r,a,H,e,i,g,f,k,l,n,m,G,b,o,h,p){this.n11=r;this.n12=a;this.n13=H;this.n14=e;this.n21=i;this.n22=g;this.n23=f;this.n24=k;this.n31=l;this.n32=n;this.n33=m;this.n34=G;this.n41=b;this.n42=o;this.n43=h;this.n44=p;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},copy:function(a){this.set(a.n11,a.n12,a.n13,a.n14,a.n21,a.n22,a.n23,a.n24,a.n31,a.n32,a.n33,a.n34,a.n41,a.n42,a.n43,a.n44);return this},lookAt:function(m,a,n){var b=c.Matrix4.__v1,g=c.Matrix4.__v2,f=c.Matrix4.__v3;f.sub(m,a).normalize();if(f.length()===0){f.z=1}b.cross(n,f).normalize();b.length()===0&&(f.x+=0.0001,b.cross(n,f).normalize());g.cross(f,b).normalize();this.n11=b.x;this.n12=g.x;this.n13=f.x;this.n21=b.y;this.n22=g.y;this.n23=f.y;this.n31=b.z;this.n32=g.z;this.n33=f.z;return this},multiply:function(u,w){var v=u.n11,x=u.n12,E=u.n13,B=u.n14,y=u.n21,F=u.n22,J=u.n23,O=u.n24,K=u.n31,U=u.n32,ac=u.n33,P=u.n34,e=u.n41,R=u.n42,a=u.n43,g=u.n44,m=w.n11,i=w.n12,b=w.n13,k=w.n14,ad=w.n21,n=w.n22,p=w.n23,l=w.n24,q=w.n31,f=w.n32,h=w.n33,o=w.n34,A=w.n41,r=w.n42,t=w.n43,s=w.n44;this.n11=v*m+x*ad+E*q+B*A;this.n12=v*i+x*n+E*f+B*r;this.n13=v*b+x*p+E*h+B*t;this.n14=v*k+x*l+E*o+B*s;this.n21=y*m+F*ad+J*q+O*A;this.n22=y*i+F*n+J*f+O*r;this.n23=y*b+F*p+J*h+O*t;this.n24=y*k+F*l+J*o+O*s;this.n31=K*m+U*ad+ac*q+P*A;this.n32=K*i+U*n+ac*f+P*r;this.n33=K*b+U*p+ac*h+P*t;this.n34=K*k+U*l+ac*o+P*s;this.n41=e*m+R*ad+a*q+g*A;this.n42=e*i+R*n+a*f+g*r;this.n43=e*b+R*p+a*h+g*t;this.n44=e*k+R*l+a*o+g*s;return this},multiplySelf:function(a){return this.multiply(this,a)},multiplyToArray:function(b,a,g){this.multiply(b,a);g[0]=this.n11;g[1]=this.n21;g[2]=this.n31;g[3]=this.n41;g[4]=this.n12;g[5]=this.n22;g[6]=this.n32;g[7]=this.n42;g[8]=this.n13;g[9]=this.n23;g[10]=this.n33;g[11]=this.n43;g[12]=this.n14;g[13]=this.n24;g[14]=this.n34;g[15]=this.n44;return this},multiplyScalar:function(a){this.n11*=a;this.n12*=a;this.n13*=a;this.n14*=a;this.n21*=a;this.n22*=a;this.n23*=a;this.n24*=a;this.n31*=a;this.n32*=a;this.n33*=a;this.n34*=a;this.n41*=a;this.n42*=a;this.n43*=a;this.n44*=a;return this},multiplyVector3:function(k){var a=k.x,l=k.y,b=k.z,g=1/(this.n41*a+this.n42*l+this.n43*b+this.n44);k.x=(this.n11*a+this.n12*l+this.n13*b+this.n14)*g;k.y=(this.n21*a+this.n22*l+this.n23*b+this.n24)*g;k.z=(this.n31*a+this.n32*l+this.n33*b+this.n34)*g;return k},multiplyVector4:function(k){var a=k.x,l=k.y,b=k.z,g=k.w;k.x=this.n11*a+this.n12*l+this.n13*b+this.n14*g;k.y=this.n21*a+this.n22*l+this.n23*b+this.n24*g;k.z=this.n31*a+this.n32*l+this.n33*b+this.n34*g;k.w=this.n41*a+this.n42*l+this.n43*b+this.n44*g;return k},rotateAxis:function(i){var a=i.x,j=i.y,b=i.z;i.x=a*this.n11+j*this.n12+b*this.n13;i.y=a*this.n21+j*this.n22+b*this.n23;i.z=a*this.n31+j*this.n32+b*this.n33;i.normalize();return i},crossVector:function(b){var a=new c.Vector4;a.x=this.n11*b.x+this.n12*b.y+this.n13*b.z+this.n14*b.w;a.y=this.n21*b.x+this.n22*b.y+this.n23*b.z+this.n24*b.w;a.z=this.n31*b.x+this.n32*b.y+this.n33*b.z+this.n34*b.w;a.w=b.w?this.n41*b.x+this.n42*b.y+this.n43*b.z+this.n44*b.w:1;return a},determinant:function(){var r=this.n11,a=this.n12,H=this.n13,e=this.n14,i=this.n21,g=this.n22,f=this.n23,k=this.n24,l=this.n31,n=this.n32,m=this.n33,G=this.n34,b=this.n41,o=this.n42,h=this.n43,p=this.n44;return e*f*n*b-H*k*n*b-e*g*m*b+a*k*m*b+H*g*G*b-a*f*G*b-e*f*l*o+H*k*l*o+e*i*m*o-r*k*m*o-H*i*G*o+r*f*G*o+e*g*l*h-a*k*l*h-e*i*n*h+r*k*n*h+a*i*G*h-r*g*G*h-H*g*l*p+a*f*l*p+H*i*n*p-r*f*n*p-a*i*m*p+r*g*m*p},transpose:function(){var a;a=this.n21;this.n21=this.n12;this.n12=a;a=this.n31;this.n31=this.n13;this.n13=a;a=this.n32;this.n32=this.n23;this.n23=a;a=this.n41;this.n41=this.n14;this.n14=a;a=this.n42;this.n42=this.n24;this.n24=a;a=this.n43;this.n43=this.n34;this.n43=a;return this},clone:function(){var a=new c.Matrix4;a.n11=this.n11;a.n12=this.n12;a.n13=this.n13;a.n14=this.n14;a.n21=this.n21;a.n22=this.n22;a.n23=this.n23;a.n24=this.n24;a.n31=this.n31;a.n32=this.n32;a.n33=this.n33;a.n34=this.n34;a.n41=this.n41;a.n42=this.n42;a.n43=this.n43;a.n44=this.n44;return a},flatten:function(){this.flat[0]=this.n11;this.flat[1]=this.n21;this.flat[2]=this.n31;this.flat[3]=this.n41;this.flat[4]=this.n12;this.flat[5]=this.n22;this.flat[6]=this.n32;this.flat[7]=this.n42;this.flat[8]=this.n13;this.flat[9]=this.n23;this.flat[10]=this.n33;this.flat[11]=this.n43;this.flat[12]=this.n14;this.flat[13]=this.n24;this.flat[14]=this.n34;this.flat[15]=this.n44;return this.flat},flattenToArray:function(a){a[0]=this.n11;a[1]=this.n21;a[2]=this.n31;a[3]=this.n41;a[4]=this.n12;a[5]=this.n22;a[6]=this.n32;a[7]=this.n42;a[8]=this.n13;a[9]=this.n23;a[10]=this.n33;a[11]=this.n43;a[12]=this.n14;a[13]=this.n24;a[14]=this.n34;a[15]=this.n44;return a},flattenToArrayOffset:function(b,a){b[a]=this.n11;b[a+1]=this.n21;b[a+2]=this.n31;b[a+3]=this.n41;b[a+4]=this.n12;b[a+5]=this.n22;b[a+6]=this.n32;b[a+7]=this.n42;b[a+8]=this.n13;b[a+9]=this.n23;b[a+10]=this.n33;b[a+11]=this.n43;b[a+12]=this.n14;b[a+13]=this.n24;b[a+14]=this.n34;b[a+15]=this.n44;return b},setTranslation:function(b,a,g){this.set(1,0,0,b,0,1,0,a,0,0,1,g,0,0,0,1);return this},setScale:function(b,a,g){this.set(b,0,0,0,0,a,0,0,0,0,g,0,0,0,0,1);return this},setRotationX:function(b){var a=Math.cos(b),b=Math.sin(b);this.set(1,0,0,0,0,a,-b,0,0,b,a,0,0,0,0,1);return this},setRotationY:function(b){var a=Math.cos(b),b=Math.sin(b);this.set(a,0,b,0,0,1,0,0,-b,0,a,0,0,0,0,1);return this},setRotationZ:function(b){var a=Math.cos(b),b=Math.sin(b);this.set(a,-b,0,0,b,a,0,0,0,0,1,0,0,0,0,1);return this},setRotationAxis:function(u,a){var v=Math.cos(a),b=Math.sin(a),g=1-v,f=u.x,e=u.y,h=u.z,i=g*f,l=g*e;this.set(i*f+v,i*e-b*h,i*h+b*e,0,i*e+b*h,l*e+v,l*h-b*f,0,i*h-b*e,l*h+b*f,g*h*h+v,0,0,0,0,1);return this},setPosition:function(a){this.n14=a.x;this.n24=a.y;this.n34=a.z;return this},getPosition:function(){return c.Matrix4.__v1.set(this.n14,this.n24,this.n34)},getColumnX:function(){return c.Matrix4.__v1.set(this.n11,this.n21,this.n31)},getColumnY:function(){return c.Matrix4.__v1.set(this.n12,this.n22,this.n32)},getColumnZ:function(){return c.Matrix4.__v1.set(this.n13,this.n23,this.n33)},getInverse:function(n){var r=n.n11,p=n.n12,J=n.n13,e=n.n14,b=n.n21,a=n.n22,f=n.n23,h=n.n24,k=n.n31,i=n.n32,o=n.n33,q=n.n34,l=n.n41,g=n.n42,m=n.n43,I=n.n44;this.n11=f*q*g-h*o*g+h*i*m-a*q*m-f*i*I+a*o*I;this.n12=e*o*g-J*q*g-e*i*m+p*q*m+J*i*I-p*o*I;this.n13=J*h*g-e*f*g+e*a*m-p*h*m-J*a*I+p*f*I;this.n14=e*f*i-J*h*i-e*a*o+p*h*o+J*a*q-p*f*q;this.n21=h*o*l-f*q*l-h*k*m+b*q*m+f*k*I-b*o*I;this.n22=J*q*l-e*o*l+e*k*m-r*q*m-J*k*I+r*o*I;this.n23=e*f*l-J*h*l-e*b*m+r*h*m+J*b*I-r*f*I;this.n24=J*h*k-e*f*k+e*b*o-r*h*o-J*b*q+r*f*q;this.n31=a*q*l-h*i*l+h*k*g-b*q*g-a*k*I+b*i*I;this.n32=e*i*l-p*q*l-e*k*g+r*q*g+p*k*I-r*i*I;this.n33=J*h*l-e*a*l+e*b*g-r*h*g-p*b*I+r*a*I;this.n34=e*a*k-p*h*k-e*b*i+r*h*i+p*b*q-r*a*q;this.n41=f*i*l-a*o*l-f*k*g+b*o*g+a*k*m-b*i*m;this.n42=p*o*l-J*i*l+J*k*g-r*o*g-p*k*m+r*i*m;this.n43=J*a*l-p*f*l-J*b*g+r*f*g+p*b*m-r*a*m;this.n44=p*f*k-J*a*k+J*b*i-r*f*i-p*b*o+r*a*o;this.multiplyScalar(1/n.determinant());return this},setRotationFromEuler:function(i,l){var k=i.x,o=i.y,a=i.z,z=Math.cos(k),k=Math.sin(k),y=Math.cos(o),o=Math.sin(o),b=Math.cos(a),a=Math.sin(a);switch(l){case"YXZ":var e=y*b,g=y*a,f=o*b,h=o*a;this.n11=e+h*k;this.n12=f*k-g;this.n13=z*o;this.n21=z*a;this.n22=z*b;this.n23=-k;this.n31=g*k-f;this.n32=h+e*k;this.n33=z*y;break;case"ZXY":e=y*b;g=y*a;f=o*b;h=o*a;this.n11=e-h*k;this.n12=-z*a;this.n13=f+g*k;this.n21=g+f*k;this.n22=z*b;this.n23=h-e*k;this.n31=-z*o;this.n32=k;this.n33=z*y;break;case"ZYX":e=z*b;g=z*a;f=k*b;h=k*a;this.n11=y*b;this.n12=f*o-g;this.n13=e*o+h;this.n21=y*a;this.n22=h*o+e;this.n23=g*o-f;this.n31=-o;this.n32=k*y;this.n33=z*y;break;case"YZX":e=z*y;g=z*o;f=k*y;h=k*o;this.n11=y*b;this.n12=h-e*a;this.n13=f*a+g;this.n21=a;this.n22=z*b;this.n23=-k*b;this.n31=-o*b;this.n32=g*a+f;this.n33=e-h*a;break;case"XZY":e=z*y;g=z*o;f=k*y;h=k*o;this.n11=y*b;this.n12=-a;this.n13=o*b;this.n21=e*a+h;this.n22=z*b;this.n23=g*a-f;this.n31=f*a-g;this.n32=k*b;this.n33=h*a+e;break;default:e=z*b,g=z*a,f=k*b,h=k*a,this.n11=y*b,this.n12=-y*a,this.n13=o,this.n21=g+f*o,this.n22=e-h*o,this.n23=-k*y,this.n31=h-e*o,this.n32=f+g*o,this.n33=z*y}return this},setRotationFromQuaternion:function(u){var a=u.x,v=u.y,b=u.z,g=u.w,f=a+a,e=v+v,h=b+b,u=a*f,i=a*e;a*=h;var l=v*e;v*=h;b*=h;f*=g;e*=g;g*=h;this.n11=1-(l+b);this.n12=i-g;this.n13=a+e;this.n21=i+g;this.n22=1-(u+b);this.n23=v-f;this.n31=a-e;this.n32=v+f;this.n33=1-(u+l);return this},scale:function(b){var a=b.x,g=b.y,b=b.z;this.n11*=a;this.n12*=g;this.n13*=b;this.n21*=a;this.n22*=g;this.n23*=b;this.n31*=a;this.n32*=g;this.n33*=b;this.n41*=a;this.n42*=g;this.n43*=b;return this},compose:function(k,a,l){var b=c.Matrix4.__m1,g=c.Matrix4.__m2;b.identity();b.setRotationFromQuaternion(a);g.setScale(l.x,l.y,l.z);this.multiply(b,g);this.n14=k.x;this.n24=k.y;this.n34=k.z;return this},decompose:function(m,a,n){var b=c.Matrix4.__v1,g=c.Matrix4.__v2,f=c.Matrix4.__v3;b.set(this.n11,this.n21,this.n31);g.set(this.n12,this.n22,this.n32);f.set(this.n13,this.n23,this.n33);m=m instanceof c.Vector3?m:new c.Vector3;a=a instanceof c.Quaternion?a:new c.Quaternion;n=n instanceof c.Vector3?n:new c.Vector3;n.x=b.length();n.y=g.length();n.z=f.length();m.x=this.n14;m.y=this.n24;m.z=this.n34;b=c.Matrix4.__m1;b.copy(this);b.n11/=n.x;b.n21/=n.x;b.n31/=n.x;b.n12/=n.y;b.n22/=n.y;b.n32/=n.y;b.n13/=n.z;b.n23/=n.z;b.n33/=n.z;a.setFromRotationMatrix(b);return[m,a,n]},extractPosition:function(a){this.n14=a.n14;this.n24=a.n24;this.n34=a.n34;return this},extractRotation:function(i){var a=c.Matrix4.__v1,j=1/a.set(i.n11,i.n21,i.n31).length(),b=1/a.set(i.n12,i.n22,i.n32).length(),a=1/a.set(i.n13,i.n23,i.n33).length();this.n11=i.n11*j;this.n21=i.n21*j;this.n31=i.n31*j;this.n12=i.n12*b;this.n22=i.n22*b;this.n32=i.n32*b;this.n13=i.n13*a;this.n23=i.n23*a;this.n33=i.n33*a;return this}};c.Matrix4.makeInvert3x3=function(i){var l=i.m33,k=l.m,o=i.n33*i.n22-i.n32*i.n23,a=-i.n33*i.n21+i.n31*i.n23,z=i.n32*i.n21-i.n31*i.n22,y=-i.n33*i.n12+i.n32*i.n13,b=i.n33*i.n11-i.n31*i.n13,e=-i.n32*i.n11+i.n31*i.n12,g=i.n23*i.n12-i.n22*i.n13,f=-i.n23*i.n11+i.n21*i.n13,h=i.n22*i.n11-i.n21*i.n12,i=i.n11*o+i.n21*y+i.n31*g;i===0&&console.error("THREE.Matrix4.makeInvert3x3: Matrix not invertible.");i=1/i;k[0]=i*o;k[1]=i*a;k[2]=i*z;k[3]=i*y;k[4]=i*b;k[5]=i*e;k[6]=i*g;k[7]=i*f;k[8]=i*h;return l};c.Matrix4.makeFrustum=function(g,p,o,a,f,e){var b;b=new c.Matrix4;b.n11=2*f/(p-g);b.n12=0;b.n13=(p+g)/(p-g);b.n14=0;b.n21=0;b.n22=2*f/(a-o);b.n23=(a+o)/(a-o);b.n24=0;b.n31=0;b.n32=0;b.n33=-(e+f)/(e-f);b.n34=-2*e*f/(e-f);b.n41=0;b.n42=0;b.n43=-1;b.n44=0;return b};c.Matrix4.makePerspective=function(k,a,l,b){var g,k=l*Math.tan(k*Math.PI/360);g=-k;return c.Matrix4.makeFrustum(g*a,k*a,g,k,l,b)};c.Matrix4.makeOrtho=function(u,a,v,b,g,f){var e,h,i,l;e=new c.Matrix4;h=a-u;i=v-b;l=f-g;e.n11=2/h;e.n12=0;e.n13=0;e.n14=-((a+u)/h);e.n21=0;e.n22=2/i;e.n23=0;e.n24=-((v+b)/i);e.n31=0;e.n32=0;e.n33=-2/l;e.n34=-((f+g)/l);e.n41=0;e.n42=0;e.n43=0;e.n44=1;return e};c.Matrix4.__v1=new c.Vector3;c.Matrix4.__v2=new c.Vector3;c.Matrix4.__v3=new c.Vector3;c.Matrix4.__m1=new c.Matrix4;c.Matrix4.__m2=new c.Matrix4;c.Object3D=function(){this.name="";this.id=c.Object3DCount++;this.parent=void 0;this.children=[];this.up=new c.Vector3(0,1,0);this.position=new c.Vector3;this.rotation=new c.Vector3;this.eulerOrder="XYZ";this.scale=new c.Vector3(1,1,1);this.flipSided=this.doubleSided=this.dynamic=!1;this.renderDepth=null;this.rotationAutoUpdate=!0;this.matrix=new c.Matrix4;this.matrixWorld=new c.Matrix4;this.matrixRotationWorld=new c.Matrix4;this.matrixWorldNeedsUpdate=this.matrixAutoUpdate=!0;this.quaternion=new c.Quaternion;this.useQuaternion=!1;this.boundRadius=0;this.boundRadiusScale=1;this.visible=!0;this.receiveShadow=this.castShadow=!1;this.frustumCulled=!0;this._vector=new c.Vector3};c.Object3D.prototype={constructor:c.Object3D,translate:function(b,a){this.matrix.rotateAxis(a);this.position.addSelf(a.multiplyScalar(b))},translateX:function(a){this.translate(a,this._vector.set(1,0,0))},translateY:function(a){this.translate(a,this._vector.set(0,1,0))},translateZ:function(a){this.translate(a,this._vector.set(0,0,1))},lookAt:function(a){this.matrix.lookAt(a,this.position,this.up);this.rotationAutoUpdate&&this.rotation.setRotationFromMatrix(this.matrix)},add:function(b){if(this.children.indexOf(b)===-1){b.parent!==void 0&&b.parent.remove(b);b.parent=this;this.children.push(b);for(var a=this;a.parent!==void 0;){a=a.parent}a!==void 0&&a instanceof c.Scene&&a.addObject(b)}},remove:function(b){var a=this.children.indexOf(b);if(a!==-1){b.parent=void 0;this.children.splice(a,1);for(a=this;a.parent!==void 0;){a=a.parent}a!==void 0&&a instanceof c.Scene&&a.removeObject(b)}},getChildByName:function(k,a){var l,b,g;l=0;for(b=this.children.length;l<b;l++){g=this.children[l];if(g.name===k){return g}if(a&&(g=g.getChildByName(k,a),g!==void 0)){return g}}},updateMatrix:function(){this.matrix.setPosition(this.position);this.useQuaternion?this.matrix.setRotationFromQuaternion(this.quaternion):this.matrix.setRotationFromEuler(this.rotation,this.eulerOrder);if(this.scale.x!==1||this.scale.y!==1||this.scale.z!==1){this.matrix.scale(this.scale),this.boundRadiusScale=Math.max(this.scale.x,Math.max(this.scale.y,this.scale.z))}this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(b){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||b){this.parent?this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,b=!0}for(var a=0,g=this.children.length;a<g;a++){this.children[a].updateMatrixWorld(b)}}};c.Object3DCount=0;c.Projector=function(){function B(){var j=ac[ad]=ac[ad]||new c.RenderableObject;ad++;return j}function F(){var j=g[e]=g[e]||new c.RenderableVertex;e++;return j}function E(j,z){return z.z-j.z}function J(C,D){var G=0,H=1,j=C.z+C.w,K=D.z+D.w,I=-C.z+C.w,z=-D.z+D.w;return j>=0&&K>=0&&I>=0&&z>=0?!0:j<0&&K<0||I<0&&z<0?!1:(j<0?G=Math.max(G,j/(j-K)):K<0&&(H=Math.min(H,j/(j-K))),I<0?G=Math.max(G,I/(I-z)):z<0&&(H=Math.min(H,I/(I-z))),H<G?!1:(C.lerpSelf(D,G),D.lerpSelf(C,1-H),!0))}var a,ad,ac=[],b,e,g=[],f,k,l=[],h,p=[],i,n,r=[],x,u,o=[],v={objects:[],sprites:[],lights:[],elements:[]},m=new c.Vector3,y=new c.Vector4,t=new c.Matrix4,w=new c.Matrix4,A=[new c.Vector4,new c.Vector4,new c.Vector4,new c.Vector4,new c.Vector4,new c.Vector4],q=new c.Vector4,s=new c.Vector4;this.computeFrustum=function(j){A[0].set(j.n41-j.n11,j.n42-j.n12,j.n43-j.n13,j.n44-j.n14);A[1].set(j.n41+j.n11,j.n42+j.n12,j.n43+j.n13,j.n44+j.n14);A[2].set(j.n41+j.n21,j.n42+j.n22,j.n43+j.n23,j.n44+j.n24);A[3].set(j.n41-j.n21,j.n42-j.n22,j.n43-j.n23,j.n44-j.n24);A[4].set(j.n41-j.n31,j.n42-j.n32,j.n43-j.n33,j.n44-j.n34);A[5].set(j.n41+j.n31,j.n42+j.n32,j.n43+j.n33,j.n44+j.n34);for(j=0;j<6;j++){var z=A[j];z.divideScalar(Math.sqrt(z.x*z.x+z.y*z.y+z.z*z.z))}};this.projectVector=function(j,z){z.matrixWorldInverse.getInverse(z.matrixWorld);t.multiply(z.projectionMatrix,z.matrixWorldInverse);t.multiplyVector3(j);return j};this.unprojectVector=function(j,z){z.projectionMatrixInverse.getInverse(z.projectionMatrix);t.multiply(z.matrixWorld,z.projectionMatrixInverse);t.multiplyVector3(j);return j};this.pickingRay=function(z,C){var j;z.z=-1;j=new c.Vector3(z.x,z.y,1);this.unprojectVector(z,C);this.unprojectVector(j,C);j.subSelf(z).normalize();return new c.Ray(z,j)};this.projectGraph=function(j,z){ad=0;v.objects.length=0;v.sprites.length=0;v.lights.length=0;var C=function(K){if(K.visible!==!1){var D;if(D=K instanceof c.Mesh||K instanceof c.Line){if(!(D=K.frustumCulled===!1)){B:{for(var G=K.matrixWorld,H=-K.geometry.boundingSphere.radius*Math.max(K.scale.x,Math.max(K.scale.y,K.scale.z)),I=0;I<6;I++){if(D=A[I].x*G.n14+A[I].y*G.n24+A[I].z*G.n34+A[I].w,D<=H){D=!1;break B}}D=!0}}}D?(t.multiplyVector3(m.copy(K.position)),a=B(),a.object=K,a.z=m.z,v.objects.push(a)):K instanceof c.Sprite||K instanceof c.Particle?(t.multiplyVector3(m.copy(K.position)),a=B(),a.object=K,a.z=m.z,v.sprites.push(a)):K instanceof c.Light&&v.lights.push(K);D=0;for(G=K.children.length;D<G;D++){C(K.children[D])}}};C(j);z&&v.objects.sort(E);return v};this.projectScene=function(j,D,C){var z=D.near,Q=D.far,L,O,N,P,R,T,S,W,I,X,V,M,H,U,G,K;u=n=h=k=0;v.elements.length=0;D.parent===void 0&&(console.warn("DEPRECATED: Camera hasn't been added to a Scene. Adding it..."),j.add(D));j.updateMatrixWorld();D.matrixWorldInverse.getInverse(D.matrixWorld);t.multiply(D.projectionMatrix,D.matrixWorldInverse);this.computeFrustum(t);v=this.projectGraph(j,!1);j=0;for(L=v.objects.length;j<L;j++){if(I=v.objects[j].object,X=I.matrixWorld,M=I.material,e=0,I instanceof c.Mesh){V=I.geometry;H=I.geometry.materials;P=V.vertices;U=V.faces;G=V.faceVertexUvs;V=I.matrixRotationWorld.extractRotation(X);O=0;for(N=P.length;O<N;O++){b=F(),b.positionWorld.copy(P[O].position),X.multiplyVector3(b.positionWorld),b.positionScreen.copy(b.positionWorld),t.multiplyVector4(b.positionScreen),b.positionScreen.x/=b.positionScreen.w,b.positionScreen.y/=b.positionScreen.w,b.visible=b.positionScreen.z>z&&b.positionScreen.z<Q}P=0;for(O=U.length;P<O;P++){N=U[P];if(N instanceof c.Face3){if(R=g[N.a],T=g[N.b],S=g[N.c],R.visible&&T.visible&&S.visible&&(I.doubleSided||I.flipSided!=(S.positionScreen.x-R.positionScreen.x)*(T.positionScreen.y-R.positionScreen.y)-(S.positionScreen.y-R.positionScreen.y)*(T.positionScreen.x-R.positionScreen.x)<0)){W=l[k]=l[k]||new c.RenderableFace3,k++,f=W,f.v1.copy(R),f.v2.copy(T),f.v3.copy(S)}else{continue}}else{if(N instanceof c.Face4){if(R=g[N.a],T=g[N.b],S=g[N.c],W=g[N.d],R.visible&&T.visible&&S.visible&&W.visible&&(I.doubleSided||I.flipSided!=((W.positionScreen.x-R.positionScreen.x)*(T.positionScreen.y-R.positionScreen.y)-(W.positionScreen.y-R.positionScreen.y)*(T.positionScreen.x-R.positionScreen.x)<0||(T.positionScreen.x-S.positionScreen.x)*(W.positionScreen.y-S.positionScreen.y)-(T.positionScreen.y-S.positionScreen.y)*(W.positionScreen.x-S.positionScreen.x)<0))){K=p[h]=p[h]||new c.RenderableFace4,h++,f=K,f.v1.copy(R),f.v2.copy(T),f.v3.copy(S),f.v4.copy(W)}else{continue}}}f.normalWorld.copy(N.normal);V.multiplyVector3(f.normalWorld);f.centroidWorld.copy(N.centroid);X.multiplyVector3(f.centroidWorld);f.centroidScreen.copy(f.centroidWorld);t.multiplyVector3(f.centroidScreen);S=N.vertexNormals;R=0;for(T=S.length;R<T;R++){W=f.vertexNormalsWorld[R],W.copy(S[R]),V.multiplyVector3(W)}R=0;for(T=G.length;R<T;R++){if(K=G[R][P]){S=0;for(W=K.length;S<W;S++){f.uvs[R][S]=K[S]}}}f.material=M;f.faceMaterial=N.materialIndex!==null?H[N.materialIndex]:null;f.z=f.centroidScreen.z;v.elements.push(f)}}else{if(I instanceof c.Line){w.multiply(t,X);P=I.geometry.vertices;R=F();R.positionScreen.copy(P[0].position);w.multiplyVector4(R.positionScreen);O=1;for(N=P.length;O<N;O++){if(R=F(),R.positionScreen.copy(P[O].position),w.multiplyVector4(R.positionScreen),T=g[e-2],q.copy(R.positionScreen),s.copy(T.positionScreen),J(q,s)){q.multiplyScalar(1/q.w),s.multiplyScalar(1/s.w),I=r[n]=r[n]||new c.RenderableLine,n++,i=I,i.v1.positionScreen.copy(q),i.v2.positionScreen.copy(s),i.z=Math.max(q.z,s.z),i.material=M,v.elements.push(i)}}}}}j=0;for(L=v.sprites.length;j<L;j++){if(I=v.sprites[j].object,X=I.matrixWorld,I instanceof c.Particle&&(y.set(X.n14,X.n24,X.n34,1),t.multiplyVector4(y),y.z/=y.w,y.z>0&&y.z<1)){z=o[u]=o[u]||new c.RenderableParticle,u++,x=z,x.x=y.x/y.w,x.y=y.y/y.w,x.z=y.z,x.rotation=I.rotation.z,x.scale.x=I.scale.x*Math.abs(x.x-(y.x+D.projectionMatrix.n11)/(y.w+D.projectionMatrix.n14)),x.scale.y=I.scale.y*Math.abs(x.y-(y.y+D.projectionMatrix.n22)/(y.w+D.projectionMatrix.n24)),x.material=I.material,v.elements.push(x)}}C&&v.elements.sort(E);return v}};c.Quaternion=function(i,a,j,b){this.set(i||0,a||0,j||0,b!==void 0?b:1)};c.Quaternion.prototype={constructor:c.Quaternion,set:function(i,a,j,b){this.x=i;this.y=a;this.z=j;this.w=b;return this},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w;return this},setFromEuler:function(f){var h=Math.PI/360,g=f.x*h,q=f.y*h,b=f.z*h,f=Math.cos(q),q=Math.sin(q),h=Math.cos(-b),b=Math.sin(-b),a=Math.cos(g),g=Math.sin(g),r=f*h,e=q*b;this.w=r*a-e*g;this.x=r*g+e*a;this.y=q*h*a+f*b*g;this.z=f*b*a-q*h*g;return this},setFromAxisAngle:function(i,a){var j=a/2,b=Math.sin(j);this.x=i.x*b;this.y=i.y*b;this.z=i.z*b;this.w=Math.cos(j);return this},setFromRotationMatrix:function(b){var a=Math.pow(b.determinant(),1/3);this.w=Math.sqrt(Math.max(0,a+b.n11+b.n22+b.n33))/2;this.x=Math.sqrt(Math.max(0,a+b.n11-b.n22-b.n33))/2;this.y=Math.sqrt(Math.max(0,a-b.n11+b.n22-b.n33))/2;this.z=Math.sqrt(Math.max(0,a-b.n11-b.n22+b.n33))/2;this.x=b.n32-b.n23<0?-Math.abs(this.x):Math.abs(this.x);this.y=b.n13-b.n31<0?-Math.abs(this.y):Math.abs(this.y);this.z=b.n21-b.n12<0?-Math.abs(this.z):Math.abs(this.z);this.normalize();return this},calculateW:function(){this.w=-Math.sqrt(Math.abs(1-this.x*this.x-this.y*this.y-this.z*this.z));return this},inverse:function(){this.x*=-1;this.y*=-1;this.z*=-1;return this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var a=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);a===0?this.w=this.z=this.y=this.x=0:(a=1/a,this.x*=a,this.y*=a,this.z*=a,this.w*=a);return this},multiplySelf:function(f){var h=this.x,g=this.y,q=this.z,b=this.w,a=f.x,r=f.y,e=f.z,f=f.w;this.x=h*f+b*a+g*e-q*r;this.y=g*f+b*r+q*a-h*e;this.z=q*f+b*e+h*r-g*a;this.w=b*f-h*a-g*r-q*e;return this},multiply:function(b,a){this.x=b.x*a.w+b.y*a.z-b.z*a.y+b.w*a.x;this.y=-b.x*a.z+b.y*a.w+b.z*a.x+b.w*a.y;this.z=b.x*a.y-b.y*a.x+b.z*a.w+b.w*a.z;this.w=-b.x*a.x-b.y*a.y-b.z*a.z+b.w*a.w;return this},multiplyVector3:function(i,l){l||(l=i);var k=i.x,o=i.y,a=i.z,z=this.x,y=this.y,b=this.z,e=this.w,g=e*k+y*a-b*o,f=e*o+b*k-z*a,h=e*a+z*o-y*k,k=-z*k-y*o-b*a;l.x=g*e+k*-z+f*-b-h*-y;l.y=f*e+k*-y+h*-z-g*-b;l.z=h*e+k*-b+g*-y-f*-z;return l}};c.Quaternion.slerp=function(m,a,n,b){var g=m.w*a.w+m.x*a.x+m.y*a.y+m.z*a.z;g<0?(n.w=-a.w,n.x=-a.x,n.y=-a.y,n.z=-a.z,g=-g):n.copy(a);if(Math.abs(g)>=1){return n.w=m.w,n.x=m.x,n.y=m.y,n.z=m.z,n}var f=Math.acos(g),g=Math.sqrt(1-g*g);if(Math.abs(g)<0.001){return n.w=0.5*(m.w+a.w),n.x=0.5*(m.x+a.x),n.y=0.5*(m.y+a.y),n.z=0.5*(m.z+a.z),n}a=Math.sin((1-b)*f)/g;b=Math.sin(b*f)/g;n.w=m.w*a+n.w*b;n.x=m.x*a+n.x*b;n.y=m.y*a+n.y*b;n.z=m.z*a+n.z*b;return n};c.Vertex=function(a){this.position=a||new c.Vector3};c.Face3=function(m,a,n,b,g,f){this.a=m;this.b=a;this.c=n;this.normal=b instanceof c.Vector3?b:new c.Vector3;this.vertexNormals=b instanceof Array?b:[];this.color=g instanceof c.Color?g:new c.Color;this.vertexColors=g instanceof Array?g:[];this.vertexTangents=[];this.materialIndex=f;this.centroid=new c.Vector3};c.Face4=function(g,p,o,a,f,e,b){this.a=g;this.b=p;this.c=o;this.d=a;this.normal=f instanceof c.Vector3?f:new c.Vector3;this.vertexNormals=f instanceof Array?f:[];this.color=e instanceof c.Color?e:new c.Color;this.vertexColors=e instanceof Array?e:[];this.vertexTangents=[];this.materialIndex=b;this.centroid=new c.Vector3};c.UV=function(b,a){this.u=b||0;this.v=a||0};c.UV.prototype={constructor:c.UV,set:function(b,a){this.u=b;this.v=a;return this},copy:function(a){this.u=a.u;this.v=a.v;return this},clone:function(){return new c.UV(this.u,this.v)}};c.Geometry=function(){this.id=c.GeometryCount++;this.vertices=[];this.colors=[];this.materials=[];this.faces=[];this.faceUvs=[[]];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphColors=[];this.skinWeights=[];this.skinIndices=[];this.boundingSphere=this.boundingBox=null;this.dynamic=this.hasTangents=!1};c.Geometry.prototype={constructor:c.Geometry,applyMatrix:function(g){var p=new c.Matrix4;p.extractRotation(g,new c.Vector3(1,1,1));for(var o=0,a=this.vertices.length;o<a;o++){g.multiplyVector3(this.vertices[o].position)}o=0;for(a=this.faces.length;o<a;o++){var f=this.faces[o];p.multiplyVector3(f.normal);for(var e=0,b=f.vertexNormals.length;e<b;e++){p.multiplyVector3(f.vertexNormals[e])}g.multiplyVector3(f.centroid)}},computeCentroids:function(){var b,a,g;b=0;for(a=this.faces.length;b<a;b++){g=this.faces[b],g.centroid.set(0,0,0),g instanceof c.Face3?(g.centroid.addSelf(this.vertices[g.a].position),g.centroid.addSelf(this.vertices[g.b].position),g.centroid.addSelf(this.vertices[g.c].position),g.centroid.divideScalar(3)):g instanceof c.Face4&&(g.centroid.addSelf(this.vertices[g.a].position),g.centroid.addSelf(this.vertices[g.b].position),g.centroid.addSelf(this.vertices[g.c].position),g.centroid.addSelf(this.vertices[g.d].position),g.centroid.divideScalar(4))}},computeFaceNormals:function(){var f,h,g,q,b,a,r=new c.Vector3,e=new c.Vector3;f=0;for(h=this.faces.length;f<h;f++){g=this.faces[f],q=this.vertices[g.a],b=this.vertices[g.b],a=this.vertices[g.c],r.sub(a.position,b.position),e.sub(q.position,b.position),r.crossSelf(e),r.isZero()||r.normalize(),g.normal.copy(r)}},computeVertexNormals:function(){var i,a,j,b;if(this.__tmpVertices===void 0){b=this.__tmpVertices=Array(this.vertices.length);i=0;for(a=this.vertices.length;i<a;i++){b[i]=new c.Vector3}i=0;for(a=this.faces.length;i<a;i++){if(j=this.faces[i],j instanceof c.Face3){j.vertexNormals=[new c.Vector3,new c.Vector3,new c.Vector3]}else{if(j instanceof c.Face4){j.vertexNormals=[new c.Vector3,new c.Vector3,new c.Vector3,new c.Vector3]}}}}else{b=this.__tmpVertices;i=0;for(a=this.vertices.length;i<a;i++){b[i].set(0,0,0)}}i=0;for(a=this.faces.length;i<a;i++){j=this.faces[i],j instanceof c.Face3?(b[j.a].addSelf(j.normal),b[j.b].addSelf(j.normal),b[j.c].addSelf(j.normal)):j instanceof c.Face4&&(b[j.a].addSelf(j.normal),b[j.b].addSelf(j.normal),b[j.c].addSelf(j.normal),b[j.d].addSelf(j.normal))}i=0;for(a=this.vertices.length;i<a;i++){b[i].normalize()}i=0;for(a=this.faces.length;i<a;i++){j=this.faces[i],j instanceof c.Face3?(j.vertexNormals[0].copy(b[j.a]),j.vertexNormals[1].copy(b[j.b]),j.vertexNormals[2].copy(b[j.c])):j instanceof c.Face4&&(j.vertexNormals[0].copy(b[j.a]),j.vertexNormals[1].copy(b[j.b]),j.vertexNormals[2].copy(b[j.c]),j.vertexNormals[3].copy(b[j.d]))}},computeTangents:function(){function v(G,H,I,j,C,z,D){J=G.vertices[H].position;K=G.vertices[I].position;R=G.vertices[j].position;P=B[C];ad=B[z];a=B[D];U=K.x-J.x;g=R.x-J.x;ac=K.y-J.y;e=R.y-J.y;i=K.z-J.z;o=R.z-J.z;l=ad.u-P.u;f=a.u-P.u;m=ad.v-P.v;b=a.v-P.v;q=1/(l*b-f*m);h.set((b*U-m*g)*q,(b*ac-m*e)*q,(b*i-m*o)*q);k.set((l*g-f*U)*q,(l*e-f*ac)*q,(l*o-f*i)*q);n[H].addSelf(h);n[I].addSelf(h);n[j].addSelf(h);s[H].addSelf(k);s[I].addSelf(k);s[j].addSelf(k)}var x,w,A,F,E,B,J,K,R,P,ad,a,U,g,ac,e,i,o,l,f,m,b,q,r,n=[],s=[],h=new c.Vector3,k=new c.Vector3,p=new c.Vector3,y=new c.Vector3,t=new c.Vector3;x=0;for(w=this.vertices.length;x<w;x++){n[x]=new c.Vector3,s[x]=new c.Vector3}x=0;for(w=this.faces.length;x<w;x++){E=this.faces[x],B=this.faceVertexUvs[0][x],E instanceof c.Face3?v(this,E.a,E.b,E.c,0,1,2):E instanceof c.Face4&&(v(this,E.a,E.b,E.c,0,1,2),v(this,E.a,E.b,E.d,0,1,3))}var u=["a","b","c","d"];x=0;for(w=this.faces.length;x<w;x++){E=this.faces[x];for(A=0;A<E.vertexNormals.length;A++){t.copy(E.vertexNormals[A]),F=E[u[A]],r=n[F],p.copy(r),p.subSelf(t.multiplyScalar(t.dot(r))).normalize(),y.cross(E.vertexNormals[A],r),F=y.dot(s[F]),F=F<0?-1:1,E.vertexTangents[A]=new c.Vector4(p.x,p.y,p.z,F)}}this.hasTangents=!0},computeBoundingBox:function(){var b;if(this.vertices.length>0){this.boundingBox={x:[this.vertices[0].position.x,this.vertices[0].position.x],y:[this.vertices[0].position.y,this.vertices[0].position.y],z:[this.vertices[0].position.z,this.vertices[0].position.z]};for(var a=1,g=this.vertices.length;a<g;a++){b=this.vertices[a];if(b.position.x<this.boundingBox.x[0]){this.boundingBox.x[0]=b.position.x}else{if(b.position.x>this.boundingBox.x[1]){this.boundingBox.x[1]=b.position.x}}if(b.position.y<this.boundingBox.y[0]){this.boundingBox.y[0]=b.position.y}else{if(b.position.y>this.boundingBox.y[1]){this.boundingBox.y[1]=b.position.y}}if(b.position.z<this.boundingBox.z[0]){this.boundingBox.z[0]=b.position.z}else{if(b.position.z>this.boundingBox.z[1]){this.boundingBox.z[1]=b.position.z}}}}},computeBoundingSphere:function(){for(var b=0,a=0,g=this.vertices.length;a<g;a++){b=Math.max(b,this.vertices[a].position.length())}this.boundingSphere={radius:b}},mergeVertices:function(){var g={},p=[],o=[],a,f=Math.pow(10,4),e,b;e=0;for(b=this.vertices.length;e<b;e++){a=this.vertices[e].position,a=[Math.round(a.x*f),Math.round(a.y*f),Math.round(a.z*f)].join("_"),g[a]===void 0?(g[a]=e,p.push(this.vertices[e]),o[e]=p.length-1):o[e]=o[g[a]]}e=0;for(b=this.faces.length;e<b;e++){if(g=this.faces[e],g instanceof c.Face3){g.a=o[g.a],g.b=o[g.b],g.c=o[g.c]}else{if(g instanceof c.Face4){g.a=o[g.a],g.b=o[g.b],g.c=o[g.c],g.d=o[g.d]}}}this.vertices=p}};c.GeometryCount=0;c.Spline=function(h){function k(q,r,j,s,n,m,t){q=(j-q)*0.5;s=(s-r)*0.5;return(2*(r-j)+q+s)*t+(-3*(r-j)-2*q-s)*m+q*n+r}this.points=h;var i=[],l={x:0,y:0,z:0},A,p,o,B,a,e,b,f,g;this.initFromArray=function(j){this.points=[];for(var m=0;m<j.length;m++){this.points[m]={x:j[m][0],y:j[m][1],z:j[m][2]}}};this.getPoint=function(j){A=(this.points.length-1)*j;p=Math.floor(A);o=A-p;i[0]=p===0?p:p-1;i[1]=p;i[2]=p>this.points.length-2?p:p+1;i[3]=p>this.points.length-3?p:p+2;e=this.points[i[0]];b=this.points[i[1]];f=this.points[i[2]];g=this.points[i[3]];B=o*o;a=o*B;l.x=k(e.x,b.x,f.x,g.x,o,B,a);l.y=k(e.y,b.y,f.y,g.y,o,B,a);l.z=k(e.z,b.z,f.z,g.z,o,B,a);return l};this.getControlPointsArray=function(){var n,q,j=this.points.length,m=[];for(n=0;n<j;n++){q=this.points[n],m[n]=[q.x,q.y,q.z]}return m};this.getLength=function(v){var j,m,n,r=j=j=0,q=new c.Vector3,s=new c.Vector3,t=[],u=0;t[0]=0;v||(v=100);m=this.points.length*v;q.copy(this.points[0]);for(v=1;v<m;v++){j=v/m,n=this.getPoint(j),s.copy(n),u+=s.distanceTo(q),q.copy(n),j*=this.points.length-1,j=Math.floor(j),j!=r&&(t[j]=u,r=j)}t[t.length]=u;return{chunks:t,total:u}};this.reparametrizeByArcLength=function(u){var v,w,j,s,n,m,q=[],r=new c.Vector3,t=this.getLength();q.push(r.copy(this.points[0]).clone());for(v=1;v<this.points.length;v++){w=t.chunks[v]-t.chunks[v-1];m=Math.ceil(u*w/t.total);s=(v-1)/(this.points.length-1);n=v/(this.points.length-1);for(w=1;w<m-1;w++){j=s+w*(1/m)*(n-s),j=this.getPoint(j),q.push(r.copy(j).clone())}q.push(r.copy(this.points[v]).clone())}this.points=q}};c.Edge=function(i,a,j,b){this.vertices=[i,a];this.vertexIndices=[j,b];this.faces=[];this.faceIndices=[]};c.Camera=function(){if(arguments.length){return console.warn("DEPRECATED: Camera() is now PerspectiveCamera() or OrthographicCamera()."),new c.PerspectiveCamera(arguments[0],arguments[1],arguments[2],arguments[3])}c.Object3D.call(this);this.matrixWorldInverse=new c.Matrix4;this.projectionMatrix=new c.Matrix4;this.projectionMatrixInverse=new c.Matrix4};c.Camera.prototype=new c.Object3D;c.Camera.prototype.constructor=c.Camera;c.Camera.prototype.lookAt=function(a){this.matrix.lookAt(this.position,a,this.up);this.rotationAutoUpdate&&this.rotation.setRotationFromMatrix(this.matrix)};c.OrthographicCamera=function(m,a,n,b,g,f){c.Camera.call(this);this.left=m;this.right=a;this.top=n;this.bottom=b;this.near=g!==void 0?g:0.1;this.far=f!==void 0?f:2000;this.updateProjectionMatrix()};c.OrthographicCamera.prototype=new c.Camera;c.OrthographicCamera.prototype.constructor=c.OrthographicCamera;c.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix=c.Matrix4.makeOrtho(this.left,this.right,this.top,this.bottom,this.near,this.far)};c.PerspectiveCamera=function(i,a,j,b){c.Camera.call(this);this.fov=i!==void 0?i:50;this.aspect=a!==void 0?a:1;this.near=j!==void 0?j:0.1;this.far=b!==void 0?b:2000;this.updateProjectionMatrix()};c.PerspectiveCamera.prototype=new c.Camera;c.PerspectiveCamera.prototype.constructor=c.PerspectiveCamera;c.PerspectiveCamera.prototype.setLens=function(b,a){this.fov=2*Math.atan((a!==void 0?a:43.25)/(b*2));this.fov*=180/Math.PI;this.updateProjectionMatrix()};c.PerspectiveCamera.prototype.setViewOffset=function(m,a,n,b,g,f){this.fullWidth=m;this.fullHeight=a;this.x=n;this.y=b;this.width=g;this.height=f;this.updateProjectionMatrix()};c.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var i=this.fullWidth/this.fullHeight,a=Math.tan(this.fov*Math.PI/360)*this.near,j=-a,b=i*j,i=Math.abs(i*a-b),j=Math.abs(a-j);this.projectionMatrix=c.Matrix4.makeFrustum(b+this.x*i/this.fullWidth,b+(this.x+this.width)*i/this.fullWidth,a-(this.y+this.height)*j/this.fullHeight,a-this.y*j/this.fullHeight,this.near,this.far)}else{this.projectionMatrix=c.Matrix4.makePerspective(this.fov,this.aspect,this.near,this.far)}};c.Light=function(a){c.Object3D.call(this);this.color=new c.Color(a)};c.Light.prototype=new c.Object3D;c.Light.prototype.constructor=c.Light;c.Light.prototype.supr=c.Object3D.prototype;c.AmbientLight=function(a){c.Light.call(this,a)};c.AmbientLight.prototype=new c.Light;c.AmbientLight.prototype.constructor=c.AmbientLight;c.DirectionalLight=function(b,a,g){c.Light.call(this,b);this.position=new c.Vector3(0,1,0);this.intensity=a!==void 0?a:1;this.distance=g!==void 0?g:0};c.DirectionalLight.prototype=new c.Light;c.DirectionalLight.prototype.constructor=c.DirectionalLight;c.PointLight=function(b,a,g){c.Light.call(this,b);this.position=new c.Vector3(0,0,0);this.intensity=a!==void 0?a:1;this.distance=g!==void 0?g:0};c.PointLight.prototype=new c.Light;c.PointLight.prototype.constructor=c.PointLight;c.SpotLight=function(i,a,j,b){c.Light.call(this,i);this.position=new c.Vector3(0,1,0);this.target=new c.Object3D;this.intensity=a!==void 0?a:1;this.distance=j!==void 0?j:0;this.castShadow=b!==void 0?b:!1};c.SpotLight.prototype=new c.Light;c.SpotLight.prototype.constructor=c.SpotLight;c.Material=function(a){this.name="";this.id=c.MaterialCount++;a=a||{};this.opacity=a.opacity!==void 0?a.opacity:1;this.transparent=a.transparent!==void 0?a.transparent:!1;this.blending=a.blending!==void 0?a.blending:c.NormalBlending;this.depthTest=a.depthTest!==void 0?a.depthTest:!0;this.depthWrite=a.depthWrite!==void 0?a.depthWrite:!0;this.polygonOffset=a.polygonOffset!==void 0?a.polygonOffset:!1;this.polygonOffsetFactor=a.polygonOffsetFactor!==void 0?a.polygonOffsetFactor:0;this.polygonOffsetUnits=a.polygonOffsetUnits!==void 0?a.polygonOffsetUnits:0;this.alphaTest=a.alphaTest!==void 0?a.alphaTest:0;this.overdraw=a.overdraw!==void 0?a.overdraw:!1};c.MaterialCount=0;c.NoShading=0;c.FlatShading=1;c.SmoothShading=2;c.NoColors=0;c.FaceColors=1;c.VertexColors=2;c.NormalBlending=0;c.AdditiveBlending=1;c.SubtractiveBlending=2;c.MultiplyBlending=3;c.AdditiveAlphaBlending=4;c.LineBasicMaterial=function(a){c.Material.call(this,a);a=a||{};this.color=a.color!==void 0?new c.Color(a.color):new c.Color(16777215);this.linewidth=a.linewidth!==void 0?a.linewidth:1;this.linecap=a.linecap!==void 0?a.linecap:"round";this.linejoin=a.linejoin!==void 0?a.linejoin:"round";this.vertexColors=a.vertexColors?a.vertexColors:!1;this.fog=a.fog!==void 0?a.fog:!0};c.LineBasicMaterial.prototype=new c.Material;c.LineBasicMaterial.prototype.constructor=c.LineBasicMaterial;c.MeshBasicMaterial=function(a){c.Material.call(this,a);a=a||{};this.color=a.color!==void 0?new c.Color(a.color):new c.Color(16777215);this.map=a.map!==void 0?a.map:null;this.lightMap=a.lightMap!==void 0?a.lightMap:null;this.envMap=a.envMap!==void 0?a.envMap:null;this.combine=a.combine!==void 0?a.combine:c.MultiplyOperation;this.reflectivity=a.reflectivity!==void 0?a.reflectivity:1;this.refractionRatio=a.refractionRatio!==void 0?a.refractionRatio:0.98;this.fog=a.fog!==void 0?a.fog:!0;this.shading=a.shading!==void 0?a.shading:c.SmoothShading;this.wireframe=a.wireframe!==void 0?a.wireframe:!1;this.wireframeLinewidth=a.wireframeLinewidth!==void 0?a.wireframeLinewidth:1;this.wireframeLinecap=a.wireframeLinecap!==void 0?a.wireframeLinecap:"round";this.wireframeLinejoin=a.wireframeLinejoin!==void 0?a.wireframeLinejoin:"round";this.vertexColors=a.vertexColors!==void 0?a.vertexColors:!1;this.skinning=a.skinning!==void 0?a.skinning:!1;this.morphTargets=a.morphTargets!==void 0?a.morphTargets:!1};c.MeshBasicMaterial.prototype=new c.Material;c.MeshBasicMaterial.prototype.constructor=c.MeshBasicMaterial;c.MeshLambertMaterial=function(a){c.Material.call(this,a);a=a||{};this.color=a.color!==void 0?new c.Color(a.color):new c.Color(16777215);this.ambient=a.ambient!==void 0?new c.Color(a.ambient):new c.Color(328965);this.map=a.map!==void 0?a.map:null;this.lightMap=a.lightMap!==void 0?a.lightMap:null;this.envMap=a.envMap!==void 0?a.envMap:null;this.combine=a.combine!==void 0?a.combine:c.MultiplyOperation;this.reflectivity=a.reflectivity!==void 0?a.reflectivity:1;this.refractionRatio=a.refractionRatio!==void 0?a.refractionRatio:0.98;this.fog=a.fog!==void 0?a.fog:!0;this.shading=a.shading!==void 0?a.shading:c.SmoothShading;this.wireframe=a.wireframe!==void 0?a.wireframe:!1;this.wireframeLinewidth=a.wireframeLinewidth!==void 0?a.wireframeLinewidth:1;this.wireframeLinecap=a.wireframeLinecap!==void 0?a.wireframeLinecap:"round";this.wireframeLinejoin=a.wireframeLinejoin!==void 0?a.wireframeLinejoin:"round";this.vertexColors=a.vertexColors!==void 0?a.vertexColors:!1;this.skinning=a.skinning!==void 0?a.skinning:!1;this.morphTargets=a.morphTargets!==void 0?a.morphTargets:!1};c.MeshLambertMaterial.prototype=new c.Material;c.MeshLambertMaterial.prototype.constructor=c.MeshLambertMaterial;c.MeshPhongMaterial=function(a){c.Material.call(this,a);a=a||{};this.color=a.color!==void 0?new c.Color(a.color):new c.Color(16777215);this.ambient=a.ambient!==void 0?new c.Color(a.ambient):new c.Color(328965);this.specular=a.specular!==void 0?new c.Color(a.specular):new c.Color(1118481);this.shininess=a.shininess!==void 0?a.shininess:30;this.metal=a.metal!==void 0?a.metal:!1;this.perPixel=a.perPixel!==void 0?a.perPixel:!1;this.map=a.map!==void 0?a.map:null;this.lightMap=a.lightMap!==void 0?a.lightMap:null;this.envMap=a.envMap!==void 0?a.envMap:null;this.combine=a.combine!==void 0?a.combine:c.MultiplyOperation;this.reflectivity=a.reflectivity!==void 0?a.reflectivity:1;this.refractionRatio=a.refractionRatio!==void 0?a.refractionRatio:0.98;this.fog=a.fog!==void 0?a.fog:!0;this.shading=a.shading!==void 0?a.shading:c.SmoothShading;this.wireframe=a.wireframe!==void 0?a.wireframe:!1;this.wireframeLinewidth=a.wireframeLinewidth!==void 0?a.wireframeLinewidth:1;this.wireframeLinecap=a.wireframeLinecap!==void 0?a.wireframeLinecap:"round";this.wireframeLinejoin=a.wireframeLinejoin!==void 0?a.wireframeLinejoin:"round";this.vertexColors=a.vertexColors!==void 0?a.vertexColors:!1;this.skinning=a.skinning!==void 0?a.skinning:!1;this.morphTargets=a.morphTargets!==void 0?a.morphTargets:!1};c.MeshPhongMaterial.prototype=new c.Material;c.MeshPhongMaterial.prototype.constructor=c.MeshPhongMaterial;c.MeshDepthMaterial=function(a){c.Material.call(this,a);a=a||{};this.shading=a.shading!==void 0?a.shading:c.SmoothShading;this.wireframe=a.wireframe!==void 0?a.wireframe:!1;this.wireframeLinewidth=a.wireframeLinewidth!==void 0?a.wireframeLinewidth:1};c.MeshDepthMaterial.prototype=new c.Material;c.MeshDepthMaterial.prototype.constructor=c.MeshDepthMaterial;c.MeshNormalMaterial=function(a){c.Material.call(this,a);a=a||{};this.shading=a.shading?a.shading:c.FlatShading;this.wireframe=a.wireframe?a.wireframe:!1;this.wireframeLinewidth=a.wireframeLinewidth?a.wireframeLinewidth:1};c.MeshNormalMaterial.prototype=new c.Material;c.MeshNormalMaterial.prototype.constructor=c.MeshNormalMaterial;c.MeshFaceMaterial=function(){};c.MeshShaderMaterial=function(a){console.warn("DEPRECATED: MeshShaderMaterial() is now ShaderMaterial().");return new c.ShaderMaterial(a)};c.ParticleBasicMaterial=function(a){c.Material.call(this,a);a=a||{};this.color=a.color!==void 0?new c.Color(a.color):new c.Color(16777215);this.map=a.map!==void 0?a.map:null;this.size=a.size!==void 0?a.size:1;this.sizeAttenuation=a.sizeAttenuation!==void 0?a.sizeAttenuation:!0;this.vertexColors=a.vertexColors!==void 0?a.vertexColors:!1;this.fog=a.fog!==void 0?a.fog:!0};c.ParticleBasicMaterial.prototype=new c.Material;c.ParticleBasicMaterial.prototype.constructor=c.ParticleBasicMaterial;c.ParticleCanvasMaterial=function(a){c.Material.call(this,a);a=a||{};this.color=a.color!==void 0?new c.Color(a.color):new c.Color(16777215);this.program=a.program!==void 0?a.program:function(){}};c.ParticleCanvasMaterial.prototype=new c.Material;c.ParticleCanvasMaterial.prototype.constructor=c.ParticleCanvasMaterial;c.ParticleDOMMaterial=function(a){c.Material.call(this);this.domElement=a};c.ShaderMaterial=function(a){c.Material.call(this,a);a=a||{};this.fragmentShader=a.fragmentShader!==void 0?a.fragmentShader:"void main() {}";this.vertexShader=a.vertexShader!==void 0?a.vertexShader:"void main() {}";this.uniforms=a.uniforms!==void 0?a.uniforms:{};this.attributes=a.attributes;this.shading=a.shading!==void 0?a.shading:c.SmoothShading;this.wireframe=a.wireframe!==void 0?a.wireframe:!1;this.wireframeLinewidth=a.wireframeLinewidth!==void 0?a.wireframeLinewidth:1;this.fog=a.fog!==void 0?a.fog:!1;this.lights=a.lights!==void 0?a.lights:!1;this.vertexColors=a.vertexColors!==void 0?a.vertexColors:!1;this.skinning=a.skinning!==void 0?a.skinning:!1;this.morphTargets=a.morphTargets!==void 0?a.morphTargets:!1};c.ShaderMaterial.prototype=new c.Material;c.ShaderMaterial.prototype.constructor=c.ShaderMaterial;c.Texture=function(m,a,n,b,g,f){this.id=c.TextureCount++;this.image=m;this.mapping=a!==void 0?a:new c.UVMapping;this.wrapS=n!==void 0?n:c.ClampToEdgeWrapping;this.wrapT=b!==void 0?b:c.ClampToEdgeWrapping;this.magFilter=g!==void 0?g:c.LinearFilter;this.minFilter=f!==void 0?f:c.LinearMipMapLinearFilter;this.offset=new c.Vector2(0,0);this.repeat=new c.Vector2(1,1);this.needsUpdate=!1;this.onUpdate=null};c.Texture.prototype={constructor:c.Texture,clone:function(){var a=new c.Texture(this.image,this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter);a.offset.copy(this.offset);a.repeat.copy(this.repeat);return a}};c.TextureCount=0;c.MultiplyOperation=0;c.MixOperation=1;c.CubeReflectionMapping=function(){};c.CubeRefractionMapping=function(){};c.LatitudeReflectionMapping=function(){};c.LatitudeRefractionMapping=function(){};c.SphericalReflectionMapping=function(){};c.SphericalRefractionMapping=function(){};c.UVMapping=function(){};c.RepeatWrapping=0;c.ClampToEdgeWrapping=1;c.MirroredRepeatWrapping=2;c.NearestFilter=3;c.NearestMipMapNearestFilter=4;c.NearestMipMapLinearFilter=5;c.LinearFilter=6;c.LinearMipMapNearestFilter=7;c.LinearMipMapLinearFilter=8;c.ByteType=9;c.UnsignedByteType=10;c.ShortType=11;c.UnsignedShortType=12;c.IntType=13;c.UnsignedIntType=14;c.FloatType=15;c.AlphaFormat=16;c.RGBFormat=17;c.RGBAFormat=18;c.LuminanceFormat=19;c.LuminanceAlphaFormat=20;c.DataTexture=function(a,e,b,f,i,h,g,s,t){c.Texture.call(this,null,i,h,g,s,t);this.image={data:a,width:e,height:b};this.format=f!==void 0?f:c.RGBAFormat};c.DataTexture.prototype=new c.Texture;c.DataTexture.prototype.constructor=c.DataTexture;c.DataTexture.prototype.clone=function(){var a=new c.DataTexture(this.data.slice(0),this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter);a.offset.copy(this.offset);a.repeat.copy(this.repeat);return a};c.Particle=function(a){c.Object3D.call(this);this.material=a};c.Particle.prototype=new c.Object3D;c.Particle.prototype.constructor=c.Particle;c.ParticleSystem=function(b,a){c.Object3D.call(this);this.geometry=b;this.material=a;this.sortParticles=!1};c.ParticleSystem.prototype=new c.Object3D;c.ParticleSystem.prototype.constructor=c.ParticleSystem;c.Line=function(b,a,g){c.Object3D.call(this);this.geometry=b;this.material=a;this.type=g!==void 0?g:c.LineStrip;this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere())};c.LineStrip=0;c.LinePieces=1;c.Line.prototype=new c.Object3D;c.Line.prototype.constructor=c.Line;c.Mesh=function(b,a){c.Object3D.call(this);this.geometry=b;this.material=a;if(a instanceof Array){console.warn("DEPRECATED: Mesh material can no longer be an Array. Using material at index 0..."),this.material=a[0]}if(this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere(),this.boundRadius=b.boundingSphere.radius,this.geometry.morphTargets.length)){this.morphTargetBase=-1;this.morphTargetForcedOrder=[];this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var g=0;g<this.geometry.morphTargets.length;g++){this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[g].name]=g}}};c.Mesh.prototype=new c.Object3D;c.Mesh.prototype.constructor=c.Mesh;c.Mesh.prototype.supr=c.Object3D.prototype;c.Mesh.prototype.getMorphTargetIndexByName=function(a){if(this.morphTargetDictionary[a]!==void 0){return this.morphTargetDictionary[a]}console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+a+" does not exist. Returning 0.");return 0};c.Bone=function(a){c.Object3D.call(this);this.skin=a;this.skinMatrix=new c.Matrix4};c.Bone.prototype=new c.Object3D;c.Bone.prototype.constructor=c.Bone;c.Bone.prototype.supr=c.Object3D.prototype;c.Bone.prototype.update=function(i,a){this.matrixAutoUpdate&&(a|=this.updateMatrix());if(a||this.matrixWorldNeedsUpdate){i?this.skinMatrix.multiply(i,this.matrix):this.skinMatrix.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,a=!0}var j,b=this.children.length;for(j=0;j<b;j++){this.children[j].update(this.skinMatrix,a)}};c.SkinnedMesh=function(f,h){c.Mesh.call(this,f,h);this.identityMatrix=new c.Matrix4;this.bones=[];this.boneMatrices=[];var g,q,b,a,r,e;if(this.geometry.bones!==void 0){for(g=0;g<this.geometry.bones.length;g++){b=this.geometry.bones[g],a=b.pos,r=b.rotq,e=b.scl,q=this.addBone(),q.name=b.name,q.position.set(a[0],a[1],a[2]),q.quaternion.set(r[0],r[1],r[2],r[3]),q.useQuaternion=!0,e!==void 0?q.scale.set(e[0],e[1],e[2]):q.scale.set(1,1,1)}for(g=0;g<this.bones.length;g++){b=this.geometry.bones[g],q=this.bones[g],b.parent===-1?this.add(q):this.bones[b.parent].add(q)}this.boneMatrices=new Float32Array(16*this.bones.length);this.pose()}};c.SkinnedMesh.prototype=new c.Mesh;c.SkinnedMesh.prototype.constructor=c.SkinnedMesh;c.SkinnedMesh.prototype.addBone=function(a){a===void 0&&(a=new c.Bone(this));this.bones.push(a);return a};c.SkinnedMesh.prototype.updateMatrixWorld=function(i){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||i){this.parent?this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1}for(var i=0,a=this.children.length;i<a;i++){var j=this.children[i];j instanceof c.Bone?j.update(this.identityMatrix,!1):j.updateMatrixWorld(!0)}for(var a=this.bones.length,j=this.bones,b=this.boneMatrices,i=0;i<a;i++){j[i].skinMatrix.flattenToArrayOffset(b,i*16)}};c.SkinnedMesh.prototype.pose=function(){this.updateMatrixWorld(!0);for(var m,a=[],n=0;n<this.bones.length;n++){m=this.bones[n];var b=new c.Matrix4;b.getInverse(m.skinMatrix);a.push(b);m.skinMatrix.flattenToArrayOffset(this.boneMatrices,n*16)}if(this.geometry.skinVerticesA===void 0){this.geometry.skinVerticesA=[];this.geometry.skinVerticesB=[];for(m=0;m<this.geometry.skinIndices.length;m++){var n=this.geometry.vertices[m].position,g=this.geometry.skinIndices[m].x,f=this.geometry.skinIndices[m].y,b=new c.Vector3(n.x,n.y,n.z);this.geometry.skinVerticesA.push(a[g].multiplyVector3(b));b=new c.Vector3(n.x,n.y,n.z);this.geometry.skinVerticesB.push(a[f].multiplyVector3(b));this.geometry.skinWeights[m].x+this.geometry.skinWeights[m].y!==1&&(n=(1-(this.geometry.skinWeights[m].x+this.geometry.skinWeights[m].y))*0.5,this.geometry.skinWeights[m].x+=n,this.geometry.skinWeights[m].y+=n)}}};c.MorphAnimMesh=function(b,a){c.Mesh.call(this,b,a);this.duration=1000;this.mirroredLoop=!1;this.currentKeyframe=this.lastKeyframe=this.time=0;this.direction=1;this.directionBackwards=!1};c.MorphAnimMesh.prototype=new c.Mesh;c.MorphAnimMesh.prototype.constructor=c.MorphAnimMesh;c.MorphAnimMesh.prototype.updateAnimation=function(b){var a=this.duration/(this.geometry.morphTargets.length-1);this.time+=this.direction*b;if(this.mirroredLoop){if(this.time>this.duration||this.time<0){this.direction*=-1;if(this.time>this.duration){this.time=this.duration,this.directionBackwards=!0}if(this.time<0){this.time=0,this.directionBackwards=!1}}}else{this.time%=this.duration}b=c.Math.clamp(Math.floor(this.time/a),0,this.geometry.morphTargets.length-1);if(b!=this.currentKeyframe){this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[b]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=b}a=this.time%a/a;this.directionBackwards&&(a=1-a);this.morphTargetInfluences[this.currentKeyframe]=a;this.morphTargetInfluences[this.lastKeyframe]=1-a};c.Ribbon=function(b,a){c.Object3D.call(this);this.geometry=b;this.material=a};c.Ribbon.prototype=new c.Object3D;c.Ribbon.prototype.constructor=c.Ribbon;c.LOD=function(){c.Object3D.call(this);this.LODs=[]};c.LOD.prototype=new c.Object3D;c.LOD.prototype.constructor=c.LOD;c.LOD.prototype.supr=c.Object3D.prototype;c.LOD.prototype.addLevel=function(b,a){a===void 0&&(a=0);for(var a=Math.abs(a),g=0;g<this.LODs.length;g++){if(a<this.LODs[g].visibleAtDistance){break}}this.LODs.splice(g,0,{visibleAtDistance:a,object3D:b});this.add(b)};c.LOD.prototype.update=function(b){if(this.LODs.length>1){b.matrixWorldInverse.getInverse(b.matrixWorld);b=b.matrixWorldInverse;b=-(b.n31*this.position.x+b.n32*this.position.y+b.n33*this.position.z+b.n34);this.LODs[0].object3D.visible=!0;for(var a=1;a<this.LODs.length;a++){if(b>=this.LODs[a].visibleAtDistance){this.LODs[a-1].object3D.visible=!1,this.LODs[a].object3D.visible=!0}else{break}}for(;a<this.LODs.length;a++){this.LODs[a].object3D.visible=!1}}};c.Sprite=function(a){c.Object3D.call(this);this.color=a.color!==void 0?new c.Color(a.color):new c.Color(16777215);this.map=a.map instanceof c.Texture?a.map:c.ImageUtils.loadTexture(a.map);this.blending=a.blending!==void 0?a.blending:c.NormalBlending;this.useScreenCoordinates=a.useScreenCoordinates!==void 0?a.useScreenCoordinates:!0;this.mergeWith3D=a.mergeWith3D!==void 0?a.mergeWith3D:!this.useScreenCoordinates;this.affectedByDistance=a.affectedByDistance!==void 0?a.affectedByDistance:!this.useScreenCoordinates;this.scaleByViewport=a.scaleByViewport!==void 0?a.scaleByViewport:!this.affectedByDistance;this.alignment=a.alignment instanceof c.Vector2?a.alignment:c.SpriteAlignment.center;this.rotation3d=this.rotation;this.rotation=0;this.opacity=1;this.uvOffset=new c.Vector2(0,0);this.uvScale=new c.Vector2(1,1)};c.Sprite.prototype=new c.Object3D;c.Sprite.prototype.constructor=c.Sprite;c.Sprite.prototype.updateMatrix=function(){this.matrix.setPosition(this.position);this.rotation3d.set(0,0,this.rotation);this.matrix.setRotationFromEuler(this.rotation3d);if(this.scale.x!==1||this.scale.y!==1){this.matrix.scale(this.scale),this.boundRadiusScale=Math.max(this.scale.x,this.scale.y)}this.matrixWorldNeedsUpdate=!0};c.SpriteAlignment={};c.SpriteAlignment.topLeft=new c.Vector2(1,-1);c.SpriteAlignment.topCenter=new c.Vector2(0,-1);c.SpriteAlignment.topRight=new c.Vector2(-1,-1);c.SpriteAlignment.centerLeft=new c.Vector2(1,0);c.SpriteAlignment.center=new c.Vector2(0,0);c.SpriteAlignment.centerRight=new c.Vector2(-1,0);c.SpriteAlignment.bottomLeft=new c.Vector2(1,1);c.SpriteAlignment.bottomCenter=new c.Vector2(0,1);c.SpriteAlignment.bottomRight=new c.Vector2(-1,1);c.Scene=function(){c.Object3D.call(this);this.overrideMaterial=this.fog=null;this.matrixAutoUpdate=!1;this.objects=[];this.lights=[];this.__objectsAdded=[];this.__objectsRemoved=[]};c.Scene.prototype=new c.Object3D;c.Scene.prototype.constructor=c.Scene;c.Scene.prototype.addObject=function(b){if(b instanceof c.Light){this.lights.indexOf(b)===-1&&this.lights.push(b)}else{if(!(b instanceof c.Camera||b instanceof c.Bone)&&this.objects.indexOf(b)===-1){this.objects.push(b);this.__objectsAdded.push(b);var a=this.__objectsRemoved.indexOf(b);a!==-1&&this.__objectsRemoved.splice(a,1)}}for(a=0;a<b.children.length;a++){this.addObject(b.children[a])}};c.Scene.prototype.removeObject=function(b){if(b instanceof c.Light){var a=this.lights.indexOf(b);a!==-1&&this.lights.splice(a,1)}else{b instanceof c.Camera||(a=this.objects.indexOf(b),a!==-1&&(this.objects.splice(a,1),this.__objectsRemoved.push(b),a=this.__objectsAdded.indexOf(b),a!==-1&&this.__objectsAdded.splice(a,1)))}for(a=0;a<b.children.length;a++){this.removeObject(b.children[a])}};c.Fog=function(b,a,g){this.color=new c.Color(b);this.near=a!==void 0?a:1;this.far=g!==void 0?g:1000};c.FogExp2=function(b,a){this.color=new c.Color(b);this.density=a!==void 0?a:0.00025};c.DOMRenderer=function(){c.Renderer.call(this);var m=null,a=new c.Projector,n,b,g,f;this.domElement=document.createElement("div");this.setSize=function(h,e){n=h;b=e;g=n/2;f=b/2};this.render=function(k,l){var o,r,p,h,i,y,j,e;m=a.projectScene(k,l);o=0;for(r=m.length;o<r;o++){if(i=m[o],i instanceof c.RenderableParticle){j=i.x*g+g;e=i.y*f+f;p=0;for(h=i.material.length;p<h;p++){if(y=i.material[p],y instanceof c.ParticleDOMMaterial){y=y.domElement,y.style.left=j+"px",y.style.top=e+"px"}}}}}};c.CanvasRenderer=function(ak){function am(z){if(L!=z){A.globalAlpha=L=z}}function al(z){if(J!=z){switch(z){case c.NormalBlending:A.globalCompositeOperation="source-over";break;case c.AdditiveBlending:A.globalCompositeOperation="lighter";break;case c.SubtractiveBlending:A.globalCompositeOperation="darker"}J=z}}function ao(z){if(au!=z){A.strokeStyle=au=z}}function ar(z){if(ax!=z){A.fillStyle=ax=z}}var aq=this,ap,q,r,v=new c.Projector,ak=ak||{},t=ak.canvas!==void 0?ak.canvas:document.createElement("canvas"),B,E,x,G,A=t.getContext("2d"),F=new c.Color(0),I=0,L=1,J=0,au=null,ax=null,at=null,M=null,N=null,K,a,H,aw,aa=new c.RenderableVertex,ad=new c.RenderableVertex,S,Y,W,m,az,ay,aS,U,ab,X,af,s,ag=new c.Color,ae=new c.Color,Q=new c.Color,l=new c.Color,i=new c.Color,aj=[],e=[],u,av,an,P,p,n,g,k,T,ai,Z=new c.Rectangle,w=new c.Rectangle,aT=new c.Rectangle,V=!1,y=new c.Color,f=new c.Color,j=new c.Color,h=new c.Vector3,ah,b,O,o,ac,R,ak=16;ah=document.createElement("canvas");ah.width=ah.height=2;b=ah.getContext("2d");b.fillStyle="rgba(0,0,0,1)";b.fillRect(0,0,2,2);O=b.getImageData(0,0,2,2);o=O.data;ac=document.createElement("canvas");ac.width=ac.height=ak;R=ac.getContext("2d");R.translate(-ak/2,-ak/2);R.scale(ak,ak);ak--;this.domElement=t;this.sortElements=this.sortObjects=this.autoClear=!0;this.info={render:{vertices:0,faces:0}};this.setSize=function(z,C){B=z;E=C;x=Math.floor(B/2);G=Math.floor(E/2);t.width=B;t.height=E;Z.set(-x,-G,x,G);w.set(-x,-G,x,G);L=1;J=0;N=M=at=ax=au=null};this.setClearColor=function(z,C){F.copy(z);I=C;w.set(-x,-G,x,G)};this.setClearColorHex=function(z,C){F.setHex(z);I=C;w.set(-x,-G,x,G)};this.clear=function(){A.setTransform(1,0,0,-1,x,G);w.isEmpty()||(w.minSelf(Z),w.inflate(2),I<1&&A.clearRect(Math.floor(w.getX()),Math.floor(w.getY()),Math.floor(w.getWidth()),Math.floor(w.getHeight())),I>0&&(al(c.NormalBlending),am(1),ar("rgba("+Math.floor(F.r*255)+","+Math.floor(F.g*255)+","+Math.floor(F.b*255)+","+I+")"),A.fillRect(Math.floor(w.getX()),Math.floor(w.getY()),Math.floor(w.getWidth()),Math.floor(w.getHeight()))),w.empty())};this.render=function(z,aH){function aA(aZ){var aV,aW,aX,aY;y.setRGB(0,0,0);f.setRGB(0,0,0);j.setRGB(0,0,0);aV=0;for(aW=aZ.length;aV<aW;aV++){aX=aZ[aV],aY=aX.color,aX instanceof c.AmbientLight?(y.r+=aY.r,y.g+=aY.g,y.b+=aY.b):aX instanceof c.DirectionalLight?(f.r+=aY.r,f.g+=aY.g,f.b+=aY.b):aX instanceof c.PointLight&&(j.r+=aY.r,j.g+=aY.g,j.b+=aY.b)}}function C(a0,a3,aX,a1){var aV,a4,a2,aZ,aW,aY;aV=0;for(a4=a0.length;aV<a4;aV++){a2=a0[aV],aZ=a2.color,a2 instanceof c.DirectionalLight?(aW=a2.matrixWorld.getPosition(),aY=aX.dot(aW),aY<=0||(aY*=a2.intensity,a1.r+=aZ.r*aY,a1.g+=aZ.g*aY,a1.b+=aZ.b*aY)):a2 instanceof c.PointLight&&(aW=a2.matrixWorld.getPosition(),aY=aX.dot(h.sub(aW,a3).normalize()),aY<=0||(aY*=a2.distance==0?1:1-Math.min(a3.distanceTo(aW)/a2.distance,1),aY!=0&&(aY*=a2.intensity,a1.r+=aZ.r*aY,a1.g+=aZ.g*aY,a1.b+=aZ.b*aY)))}}function aD(aZ,aW,a2){am(a2.opacity);al(a2.blending);var a3,a0,a1,aV,aX,aY;if(a2 instanceof c.ParticleBasicMaterial){if(a2.map){aV=a2.map.image,aX=aV.width>>1,aY=aV.height>>1,a2=aW.scale.x*x,a1=aW.scale.y*G,a3=a2*aX,a0=a1*aY,aT.set(aZ.x-a3,aZ.y-a0,aZ.x+a3,aZ.y+a0),Z.intersects(aT)&&(A.save(),A.translate(aZ.x,aZ.y),A.rotate(-aW.rotation),A.scale(a2,-a1),A.translate(-aX,-aY),A.drawImage(aV,0,0),A.restore())}}else{a2 instanceof c.ParticleCanvasMaterial&&(a3=aW.scale.x*x,a0=aW.scale.y*G,aT.set(aZ.x-a3,aZ.y-a0,aZ.x+a3,aZ.y+a0),Z.intersects(aT)&&(ao(a2.color.getContextStyle()),ar(a2.color.getContextStyle()),A.save(),A.translate(aZ.x,aZ.y),A.rotate(-aW.rotation),A.scale(a3,a0),a2.program(A),A.restore()))}}function aI(aV,aY,aX,aW){am(aW.opacity);al(aW.blending);A.beginPath();A.moveTo(aV.positionScreen.x,aV.positionScreen.y);A.lineTo(aY.positionScreen.x,aY.positionScreen.y);A.closePath();if(aW instanceof c.LineBasicMaterial){aV=aW.linewidth;if(at!=aV){A.lineWidth=at=aV}aV=aW.linecap;if(M!=aV){A.lineCap=M=aV}aV=aW.linejoin;if(N!=aV){A.lineJoin=N=aV}ao(aW.color.getContextStyle());A.stroke();aT.inflate(aW.linewidth*2)}}function aM(a1,aV,aY,aX,a0,aZ,aW,a2){aq.info.render.vertices+=3;aq.info.render.faces++;am(a2.opacity);al(a2.blending);S=a1.positionScreen.x;Y=a1.positionScreen.y;W=aV.positionScreen.x;m=aV.positionScreen.y;az=aY.positionScreen.x;ay=aY.positionScreen.y;aR(S,Y,W,m,az,ay);if(a2 instanceof c.MeshBasicMaterial){if(a2.map){a2.map.mapping instanceof c.UVMapping&&(P=aW.uvs[0],aL(S,Y,W,m,az,ay,P[aX].u,P[aX].v,P[a0].u,P[a0].v,P[aZ].u,P[aZ].v,a2.map))}else{if(a2.envMap){if(a2.envMap.mapping instanceof c.SphericalReflectionMapping){a1=aH.matrixWorldInverse,h.copy(aW.vertexNormalsWorld[aX]),p=(h.x*a1.n11+h.y*a1.n12+h.z*a1.n13)*0.5+0.5,n=-(h.x*a1.n21+h.y*a1.n22+h.z*a1.n23)*0.5+0.5,h.copy(aW.vertexNormalsWorld[a0]),g=(h.x*a1.n11+h.y*a1.n12+h.z*a1.n13)*0.5+0.5,k=-(h.x*a1.n21+h.y*a1.n22+h.z*a1.n23)*0.5+0.5,h.copy(aW.vertexNormalsWorld[aZ]),T=(h.x*a1.n11+h.y*a1.n12+h.z*a1.n13)*0.5+0.5,ai=-(h.x*a1.n21+h.y*a1.n22+h.z*a1.n23)*0.5+0.5,aL(S,Y,W,m,az,ay,p,n,g,k,T,ai,a2.envMap)}}else{a2.wireframe?aJ(a2.color,a2.wireframeLinewidth,a2.wireframeLinecap,a2.wireframeLinejoin):aE(a2.color)}}}else{if(a2 instanceof c.MeshLambertMaterial){a2.map&&!a2.wireframe&&(a2.map.mapping instanceof c.UVMapping&&(P=aW.uvs[0],aL(S,Y,W,m,az,ay,P[aX].u,P[aX].v,P[a0].u,P[a0].v,P[aZ].u,P[aZ].v,a2.map)),al(c.SubtractiveBlending)),V?!a2.wireframe&&a2.shading==c.SmoothShading&&aW.vertexNormalsWorld.length==3?(ae.r=Q.r=l.r=y.r,ae.g=Q.g=l.g=y.g,ae.b=Q.b=l.b=y.b,C(r,aW.v1.positionWorld,aW.vertexNormalsWorld[0],ae),C(r,aW.v2.positionWorld,aW.vertexNormalsWorld[1],Q),C(r,aW.v3.positionWorld,aW.vertexNormalsWorld[2],l),ae.r=Math.max(0,Math.min(a2.color.r*ae.r,1)),ae.g=Math.max(0,Math.min(a2.color.g*ae.g,1)),ae.b=Math.max(0,Math.min(a2.color.b*ae.b,1)),Q.r=Math.max(0,Math.min(a2.color.r*Q.r,1)),Q.g=Math.max(0,Math.min(a2.color.g*Q.g,1)),Q.b=Math.max(0,Math.min(a2.color.b*Q.b,1)),l.r=Math.max(0,Math.min(a2.color.r*l.r,1)),l.g=Math.max(0,Math.min(a2.color.g*l.g,1)),l.b=Math.max(0,Math.min(a2.color.b*l.b,1)),i.r=(Q.r+l.r)*0.5,i.g=(Q.g+l.g)*0.5,i.b=(Q.b+l.b)*0.5,an=aN(ae,Q,l,i),aC(S,Y,W,m,az,ay,0,0,1,0,0,1,an)):(ag.r=y.r,ag.g=y.g,ag.b=y.b,C(r,aW.centroidWorld,aW.normalWorld,ag),ag.r=Math.max(0,Math.min(a2.color.r*ag.r,1)),ag.g=Math.max(0,Math.min(a2.color.g*ag.g,1)),ag.b=Math.max(0,Math.min(a2.color.b*ag.b,1)),a2.wireframe?aJ(ag,a2.wireframeLinewidth,a2.wireframeLinecap,a2.wireframeLinejoin):aE(ag)):a2.wireframe?aJ(a2.color,a2.wireframeLinewidth,a2.wireframeLinecap,a2.wireframeLinejoin):aE(a2.color)}else{if(a2 instanceof c.MeshDepthMaterial){u=aH.near,av=aH.far,ae.r=ae.g=ae.b=1-aF(a1.positionScreen.z,u,av),Q.r=Q.g=Q.b=1-aF(aV.positionScreen.z,u,av),l.r=l.g=l.b=1-aF(aY.positionScreen.z,u,av),i.r=(Q.r+l.r)*0.5,i.g=(Q.g+l.g)*0.5,i.b=(Q.b+l.b)*0.5,an=aN(ae,Q,l,i),aC(S,Y,W,m,az,ay,0,0,1,0,0,1,an)}else{if(a2 instanceof c.MeshNormalMaterial){ag.r=aK(aW.normalWorld.x),ag.g=aK(aW.normalWorld.y),ag.b=aK(aW.normalWorld.z),a2.wireframe?aJ(ag,a2.wireframeLinewidth,a2.wireframeLinecap,a2.wireframeLinejoin):aE(ag)}}}}}function aP(aZ,a2,a0,aW,a1,aX,aV,a3,aY){aq.info.render.vertices+=4;aq.info.render.faces++;am(a3.opacity);al(a3.blending);if(a3.map||a3.envMap){aM(aZ,a2,aW,0,1,3,aV,a3,aY),aM(a1,a0,aX,1,2,3,aV,a3,aY)}else{if(S=aZ.positionScreen.x,Y=aZ.positionScreen.y,W=a2.positionScreen.x,m=a2.positionScreen.y,az=a0.positionScreen.x,ay=a0.positionScreen.y,aS=aW.positionScreen.x,U=aW.positionScreen.y,ab=a1.positionScreen.x,X=a1.positionScreen.y,af=aX.positionScreen.x,s=aX.positionScreen.y,a3 instanceof c.MeshBasicMaterial){aB(S,Y,W,m,az,ay,aS,U),a3.wireframe?aJ(a3.color,a3.wireframeLinewidth,a3.wireframeLinecap,a3.wireframeLinejoin):aE(a3.color)}else{if(a3 instanceof c.MeshLambertMaterial){V?!a3.wireframe&&a3.shading==c.SmoothShading&&aV.vertexNormalsWorld.length==4?(ae.r=Q.r=l.r=i.r=y.r,ae.g=Q.g=l.g=i.g=y.g,ae.b=Q.b=l.b=i.b=y.b,C(r,aV.v1.positionWorld,aV.vertexNormalsWorld[0],ae),C(r,aV.v2.positionWorld,aV.vertexNormalsWorld[1],Q),C(r,aV.v4.positionWorld,aV.vertexNormalsWorld[3],l),C(r,aV.v3.positionWorld,aV.vertexNormalsWorld[2],i),ae.r=Math.max(0,Math.min(a3.color.r*ae.r,1)),ae.g=Math.max(0,Math.min(a3.color.g*ae.g,1)),ae.b=Math.max(0,Math.min(a3.color.b*ae.b,1)),Q.r=Math.max(0,Math.min(a3.color.r*Q.r,1)),Q.g=Math.max(0,Math.min(a3.color.g*Q.g,1)),Q.b=Math.max(0,Math.min(a3.color.b*Q.b,1)),l.r=Math.max(0,Math.min(a3.color.r*l.r,1)),l.g=Math.max(0,Math.min(a3.color.g*l.g,1)),l.b=Math.max(0,Math.min(a3.color.b*l.b,1)),i.r=Math.max(0,Math.min(a3.color.r*i.r,1)),i.g=Math.max(0,Math.min(a3.color.g*i.g,1)),i.b=Math.max(0,Math.min(a3.color.b*i.b,1)),an=aN(ae,Q,l,i),aR(S,Y,W,m,aS,U),aC(S,Y,W,m,aS,U,0,0,1,0,0,1,an),aR(ab,X,az,ay,af,s),aC(ab,X,az,ay,af,s,1,0,1,1,0,1,an)):(ag.r=y.r,ag.g=y.g,ag.b=y.b,C(r,aV.centroidWorld,aV.normalWorld,ag),ag.r=Math.max(0,Math.min(a3.color.r*ag.r,1)),ag.g=Math.max(0,Math.min(a3.color.g*ag.g,1)),ag.b=Math.max(0,Math.min(a3.color.b*ag.b,1)),aB(S,Y,W,m,az,ay,aS,U),a3.wireframe?aJ(ag,a3.wireframeLinewidth,a3.wireframeLinecap,a3.wireframeLinejoin):aE(ag)):(aB(S,Y,W,m,az,ay,aS,U),a3.wireframe?aJ(a3.color,a3.wireframeLinewidth,a3.wireframeLinecap,a3.wireframeLinejoin):aE(a3.color))}else{if(a3 instanceof c.MeshNormalMaterial){ag.r=aK(aV.normalWorld.x),ag.g=aK(aV.normalWorld.y),ag.b=aK(aV.normalWorld.z),aB(S,Y,W,m,az,ay,aS,U),a3.wireframe?aJ(ag,a3.wireframeLinewidth,a3.wireframeLinecap,a3.wireframeLinejoin):aE(ag)}else{if(a3 instanceof c.MeshDepthMaterial){u=aH.near,av=aH.far,ae.r=ae.g=ae.b=1-aF(aZ.positionScreen.z,u,av),Q.r=Q.g=Q.b=1-aF(a2.positionScreen.z,u,av),l.r=l.g=l.b=1-aF(aW.positionScreen.z,u,av),i.r=i.g=i.b=1-aF(a0.positionScreen.z,u,av),an=aN(ae,Q,l,i),aR(S,Y,W,m,aS,U),aC(S,Y,W,m,aS,U,0,0,1,0,0,1,an),aR(ab,X,az,ay,af,s),aC(ab,X,az,ay,af,s,1,0,1,1,0,1,an)}}}}}}function aR(a0,aV,aW,aX,aZ,aY){A.beginPath();A.moveTo(a0,aV);A.lineTo(aW,aX);A.lineTo(aZ,aY);A.lineTo(a0,aV);A.closePath()}function aB(a1,aW,a2,aV,aZ,aX,aY,a0){A.beginPath();A.moveTo(a1,aW);A.lineTo(a2,aV);A.lineTo(aZ,aX);A.lineTo(aY,a0);A.lineTo(a1,aW);A.closePath()}function aJ(aY,aV,aW,aX){if(at!=aV){A.lineWidth=at=aV}if(M!=aW){A.lineCap=M=aW}if(N!=aX){A.lineJoin=N=aX}ao(aY.getContextStyle());A.stroke();aT.inflate(aV*2)}function aE(aV){ar(aV.getContextStyle());A.fill()}function aL(aW,aX,aY,a0,a1,a2,a5,a3,a4,bb,a6,a7,aV){if(aV.image.width!=0){if(aV.needsUpdate==!0||aj[aV.id]==void 0){var a8=aV.wrapS==c.RepeatWrapping,a9=aV.wrapT==c.RepeatWrapping;aj[aV.id]=A.createPattern(aV.image,a8&&a9?"repeat":a8&&!a9?"repeat-x":!a8&&a9?"repeat-y":"no-repeat");aV.needsUpdate=!1}ar(aj[aV.id]);var a8=aV.offset.x/aV.repeat.x,a9=aV.offset.y/aV.repeat.y,aZ=aV.image.width*aV.repeat.x,ba=aV.image.height*aV.repeat.y,a5=(a5+a8)*aZ,a3=(a3+a9)*ba,a4=(a4+a8)*aZ,bb=(bb+a9)*ba,a6=(a6+a8)*aZ,a7=(a7+a9)*ba;aY-=aW;a0-=aX;a1-=aW;a2-=aX;a4-=a5;bb-=a3;a6-=a5;a7-=a3;a8=a4*a7-a6*bb;if(a8==0){if(e[aV.id]==void 0){aX=document.createElement("canvas"),aX.width=aV.image.width,aX.height=aV.image.height,aW=aX.getContext("2d"),aW.drawImage(aV.image,0,0),e[aV.id]=aW.getImageData(0,0,aV.image.width,aV.image.height).data,delete aX}aX=e[aV.id];a5=(Math.floor(a5)+Math.floor(a3)*aV.image.width)*4;ag.setRGB(aX[a5]/255,aX[a5+1]/255,aX[a5+2]/255);aE(ag)}else{a8=1/a8,aV=(a7*aY-bb*a1)*a8,bb=(a7*a0-bb*a2)*a8,aY=(a4*a1-a6*aY)*a8,a0=(a4*a2-a6*a0)*a8,aW=aW-aV*a5-aY*a3,a5=aX-bb*a5-a0*a3,A.save(),A.transform(aV,bb,aY,a0,aW,a5),A.fill(),A.restore()}}}function aC(aY,aZ,a0,a1,a4,a2,a3,aX,a5,a9,a8,a6,a7){var aV,aW;aV=a7.width-1;aW=a7.height-1;a3*=aV;aX*=aW;a5*=aV;a9*=aW;a8*=aV;a6*=aW;a0-=aY;a1-=aZ;a4-=aY;a2-=aZ;a5-=a3;a9-=aX;a8-=a3;a6-=aX;aW=1/(a5*a6-a8*a9);aV=(a6*a0-a9*a4)*aW;a9=(a6*a1-a9*a2)*aW;a0=(a5*a4-a8*a0)*aW;a1=(a5*a2-a8*a1)*aW;aY=aY-aV*a3-a0*aX;aZ=aZ-a9*a3-a1*aX;A.save();A.transform(aV,a9,a0,a1,aY,aZ);A.clip();A.drawImage(a7,0,0);A.restore()}function aN(aZ,a0,a1,a2){var a3=~~(aZ.r*255),a6=~~(aZ.g*255),aZ=~~(aZ.b*255),aX=~~(a0.r*255),aV=~~(a0.g*255),a0=~~(a0.b*255),a4=~~(a1.r*255),a5=~~(a1.g*255),a1=~~(a1.b*255),aY=~~(a2.r*255),aW=~~(a2.g*255),a2=~~(a2.b*255);o[0]=a3<0?0:a3>255?255:a3;o[1]=a6<0?0:a6>255?255:a6;o[2]=aZ<0?0:aZ>255?255:aZ;o[4]=aX<0?0:aX>255?255:aX;o[5]=aV<0?0:aV>255?255:aV;o[6]=a0<0?0:a0>255?255:a0;o[8]=a4<0?0:a4>255?255:a4;o[9]=a5<0?0:a5>255?255:a5;o[10]=a1<0?0:a1>255?255:a1;o[12]=aY<0?0:aY>255?255:aY;o[13]=aW<0?0:aW>255?255:aW;o[14]=a2<0?0:a2>255?255:a2;b.putImageData(O,0,0);R.drawImage(ah,0,0);return ac}function aF(aX,aV,aW){aX=(aX-aV)/(aW-aV);return aX*aX*(3-2*aX)}function aK(aV){aV=(aV+1)*0.5;return aV<0?0:aV>1?1:aV}function aO(aZ,aV){var aW=aV.x-aZ.x,aX=aV.y-aZ.y,aY=aW*aW+aX*aX;aY!=0&&(aY=1/Math.sqrt(aY),aW*=aY,aX*=aY,aV.x+=aW,aV.y+=aX,aZ.x-=aW,aZ.y-=aX)}var aQ,D,aU,aG;this.autoClear?this.clear():A.setTransform(1,0,0,-1,x,G);aq.info.render.vertices=0;aq.info.render.faces=0;ap=v.projectScene(z,aH,this.sortElements);q=ap.elements;r=ap.lights;(V=r.length>0)&&aA(r);aQ=0;for(D=q.length;aQ<D;aQ++){if(aU=q[aQ],aG=aU.material,aG=aG instanceof c.MeshFaceMaterial?aU.faceMaterial:aG,!(aG==null||aG.opacity==0)){aT.empty();if(aU instanceof c.RenderableParticle){K=aU,K.x*=x,K.y*=G,aD(K,aU,aG,z)}else{if(aU instanceof c.RenderableLine){K=aU.v1,a=aU.v2,K.positionScreen.x*=x,K.positionScreen.y*=G,a.positionScreen.x*=x,a.positionScreen.y*=G,aT.addPoint(K.positionScreen.x,K.positionScreen.y),aT.addPoint(a.positionScreen.x,a.positionScreen.y),Z.intersects(aT)&&aI(K,a,aU,aG,z)}else{if(aU instanceof c.RenderableFace3){K=aU.v1,a=aU.v2,H=aU.v3,K.positionScreen.x*=x,K.positionScreen.y*=G,a.positionScreen.x*=x,a.positionScreen.y*=G,H.positionScreen.x*=x,H.positionScreen.y*=G,aG.overdraw&&(aO(K.positionScreen,a.positionScreen),aO(a.positionScreen,H.positionScreen),aO(H.positionScreen,K.positionScreen)),aT.add3Points(K.positionScreen.x,K.positionScreen.y,a.positionScreen.x,a.positionScreen.y,H.positionScreen.x,H.positionScreen.y),Z.intersects(aT)&&aM(K,a,H,0,1,2,aU,aG,z)}else{if(aU instanceof c.RenderableFace4){K=aU.v1,a=aU.v2,H=aU.v3,aw=aU.v4,K.positionScreen.x*=x,K.positionScreen.y*=G,a.positionScreen.x*=x,a.positionScreen.y*=G,H.positionScreen.x*=x,H.positionScreen.y*=G,aw.positionScreen.x*=x,aw.positionScreen.y*=G,aa.positionScreen.copy(a.positionScreen),ad.positionScreen.copy(aw.positionScreen),aG.overdraw&&(aO(K.positionScreen,a.positionScreen),aO(a.positionScreen,aw.positionScreen),aO(aw.positionScreen,K.positionScreen),aO(H.positionScreen,aa.positionScreen),aO(H.positionScreen,ad.positionScreen)),aT.addPoint(K.positionScreen.x,K.positionScreen.y),aT.addPoint(a.positionScreen.x,a.positionScreen.y),aT.addPoint(H.positionScreen.x,H.positionScreen.y),aT.addPoint(aw.positionScreen.x,aw.positionScreen.y),Z.intersects(aT)&&aP(K,a,H,aw,aa,ad,aU,aG,z)}}}}w.addRectangle(aT)}}A.setTransform(1,0,0,1,0,0)}};c.SVGRenderer=function(){function w(L,M,N,j){var D,z,C,G,H,I;D=0;for(z=L.length;D<z;D++){C=L[D],G=C.color,C instanceof c.DirectionalLight?(H=C.matrixWorld.getPosition(),I=N.dot(H),I<=0||(I*=C.intensity,j.r+=G.r*I,j.g+=G.g*I,j.b+=G.b*I)):C instanceof c.PointLight&&(H=C.matrixWorld.getPosition(),I=N.dot(p.sub(H,M).normalize()),I<=0||(I*=C.distance==0?1:1-Math.min(M.distanceTo(H)/C.distance,1),I!=0&&(I*=C.intensity,j.r+=G.r*I,j.g+=G.g*I,j.b+=G.b*I)))}}function A(j){u[j]==null&&(u[j]=document.createElementNS("http://www.w3.org/2000/svg","path"),v==0&&u[j].setAttribute("shape-rendering","crispEdges"));return u[j]}function y(j){j=(j+1)*0.5;return j<0?0:j>1?1:j}var B=this,J,F,E,K=new c.Projector,R=document.createElementNS("http://www.w3.org/2000/svg","svg"),ac,U,b,e,ad,i,a,g,l=new c.Rectangle,r=new c.Rectangle,n=!1,h=new c.Color,o=new c.Color,f=new c.Color,s=new c.Color,t,p=new c.Vector3,u=[],k=[],m,q,x,v=1;this.domElement=R;this.sortElements=this.sortObjects=this.autoClear=!0;this.info={render:{vertices:0,faces:0}};this.setQuality=function(j){switch(j){case"high":v=1;break;case"low":v=0}};this.setSize=function(j,z){ac=j;U=z;b=ac/2;e=U/2;R.setAttribute("viewBox",-b+" "+-e+" "+ac+" "+U);R.setAttribute("width",ac);R.setAttribute("height",U);l.set(-b,-e,b,e)};this.clear=function(){for(;R.childNodes.length>0;){R.removeChild(R.childNodes[0])}};this.render=function(L,M){var D,z,j,C;this.autoClear&&this.clear();B.info.render.vertices=0;B.info.render.faces=0;J=K.projectScene(L,M,this.sortElements);F=J.elements;E=J.lights;x=q=0;if(n=E.length>0){o.setRGB(0,0,0);f.setRGB(0,0,0);s.setRGB(0,0,0);D=0;for(z=E.length;D<z;D++){C=E[D],j=C.color,C instanceof c.AmbientLight?(o.r+=j.r,o.g+=j.g,o.b+=j.b):C instanceof c.DirectionalLight?(f.r+=j.r,f.g+=j.g,f.b+=j.b):C instanceof c.PointLight&&(s.r+=j.r,s.g+=j.g,s.b+=j.b)}}D=0;for(z=F.length;D<z;D++){if(j=F[D],C=j.material,C=C instanceof c.MeshFaceMaterial?j.faceMaterial:C,!(C==null||C.opacity==0)){if(r.empty(),j instanceof c.RenderableParticle){ad=j,ad.x*=b,ad.y*=-e}else{if(j instanceof c.RenderableLine){if(ad=j.v1,i=j.v2,ad.positionScreen.x*=b,ad.positionScreen.y*=-e,i.positionScreen.x*=b,i.positionScreen.y*=-e,r.addPoint(ad.positionScreen.x,ad.positionScreen.y),r.addPoint(i.positionScreen.x,i.positionScreen.y),l.intersects(r)){j=ad;var H=i,I=x++;k[I]==null&&(k[I]=document.createElementNS("http://www.w3.org/2000/svg","line"),v==0&&k[I].setAttribute("shape-rendering","crispEdges"));m=k[I];m.setAttribute("x1",j.positionScreen.x);m.setAttribute("y1",j.positionScreen.y);m.setAttribute("x2",H.positionScreen.x);m.setAttribute("y2",H.positionScreen.y);C instanceof c.LineBasicMaterial&&(m.setAttribute("style","fill: none; stroke: "+C.color.getContextStyle()+"; stroke-width: "+C.linewidth+"; stroke-opacity: "+C.opacity+"; stroke-linecap: "+C.linecap+"; stroke-linejoin: "+C.linejoin),R.appendChild(m))}}else{if(j instanceof c.RenderableFace3){if(ad=j.v1,i=j.v2,a=j.v3,ad.positionScreen.x*=b,ad.positionScreen.y*=-e,i.positionScreen.x*=b,i.positionScreen.y*=-e,a.positionScreen.x*=b,a.positionScreen.y*=-e,r.addPoint(ad.positionScreen.x,ad.positionScreen.y),r.addPoint(i.positionScreen.x,i.positionScreen.y),r.addPoint(a.positionScreen.x,a.positionScreen.y),l.intersects(r)){var H=ad,I=i,G=a;B.info.render.vertices+=3;B.info.render.faces++;m=A(q++);m.setAttribute("d","M "+H.positionScreen.x+" "+H.positionScreen.y+" L "+I.positionScreen.x+" "+I.positionScreen.y+" L "+G.positionScreen.x+","+G.positionScreen.y+"z");C instanceof c.MeshBasicMaterial?h.copy(C.color):C instanceof c.MeshLambertMaterial?n?(h.r=o.r,h.g=o.g,h.b=o.b,w(E,j.centroidWorld,j.normalWorld,h),h.r=Math.max(0,Math.min(C.color.r*h.r,1)),h.g=Math.max(0,Math.min(C.color.g*h.g,1)),h.b=Math.max(0,Math.min(C.color.b*h.b,1))):h.copy(C.color):C instanceof c.MeshDepthMaterial?(t=1-C.__2near/(C.__farPlusNear-j.z*C.__farMinusNear),h.setRGB(t,t,t)):C instanceof c.MeshNormalMaterial&&h.setRGB(y(j.normalWorld.x),y(j.normalWorld.y),y(j.normalWorld.z));C.wireframe?m.setAttribute("style","fill: none; stroke: "+h.getContextStyle()+"; stroke-width: "+C.wireframeLinewidth+"; stroke-opacity: "+C.opacity+"; stroke-linecap: "+C.wireframeLinecap+"; stroke-linejoin: "+C.wireframeLinejoin):m.setAttribute("style","fill: "+h.getContextStyle()+"; fill-opacity: "+C.opacity);R.appendChild(m)}}else{if(j instanceof c.RenderableFace4&&(ad=j.v1,i=j.v2,a=j.v3,g=j.v4,ad.positionScreen.x*=b,ad.positionScreen.y*=-e,i.positionScreen.x*=b,i.positionScreen.y*=-e,a.positionScreen.x*=b,a.positionScreen.y*=-e,g.positionScreen.x*=b,g.positionScreen.y*=-e,r.addPoint(ad.positionScreen.x,ad.positionScreen.y),r.addPoint(i.positionScreen.x,i.positionScreen.y),r.addPoint(a.positionScreen.x,a.positionScreen.y),r.addPoint(g.positionScreen.x,g.positionScreen.y),l.intersects(r))){var H=ad,I=i,G=a,N=g;B.info.render.vertices+=4;B.info.render.faces++;m=A(q++);m.setAttribute("d","M "+H.positionScreen.x+" "+H.positionScreen.y+" L "+I.positionScreen.x+" "+I.positionScreen.y+" L "+G.positionScreen.x+","+G.positionScreen.y+" L "+N.positionScreen.x+","+N.positionScreen.y+"z");C instanceof c.MeshBasicMaterial?h.copy(C.color):C instanceof c.MeshLambertMaterial?n?(h.r=o.r,h.g=o.g,h.b=o.b,w(E,j.centroidWorld,j.normalWorld,h),h.r=Math.max(0,Math.min(C.color.r*h.r,1)),h.g=Math.max(0,Math.min(C.color.g*h.g,1)),h.b=Math.max(0,Math.min(C.color.b*h.b,1))):h.copy(C.color):C instanceof c.MeshDepthMaterial?(t=1-C.__2near/(C.__farPlusNear-j.z*C.__farMinusNear),h.setRGB(t,t,t)):C instanceof c.MeshNormalMaterial&&h.setRGB(y(j.normalWorld.x),y(j.normalWorld.y),y(j.normalWorld.z));C.wireframe?m.setAttribute("style","fill: none; stroke: "+h.getContextStyle()+"; stroke-width: "+C.wireframeLinewidth+"; stroke-opacity: "+C.opacity+"; stroke-linecap: "+C.wireframeLinecap+"; stroke-linejoin: "+C.wireframeLinejoin):m.setAttribute("style","fill: "+h.getContextStyle()+"; fill-opacity: "+C.opacity);R.appendChild(m)}}}}}}}};c.ShaderChunk={fog_pars_fragment:"#ifdef USE_FOG\nuniform vec3 fogColor;\n#ifdef FOG_EXP2\nuniform float fogDensity;\n#else\nuniform float fogNear;\nuniform float fogFar;\n#endif\n#endif",fog_fragment:"#ifdef USE_FOG\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n#ifdef FOG_EXP2\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n#else\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n#endif\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float reflectivity;\nuniform samplerCube envMap;\nuniform float flipEnvMap;\nuniform int combine;\n#endif",envmap_fragment:"#ifdef USE_ENVMAP\nvec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * vReflect.x, vReflect.yz ) );\n#ifdef GAMMA_INPUT\ncubeColor.xyz *= cubeColor.xyz;\n#endif\nif ( combine == 1 ) {\ngl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, reflectivity );\n} else {\ngl_FragColor.xyz = gl_FragColor.xyz * cubeColor.xyz;\n}\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float refractionRatio;\nuniform bool useRefract;\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = mat3( objectMatrix[ 0 ].xyz, objectMatrix[ 1 ].xyz, objectMatrix[ 2 ].xyz ) * normal;\nif ( useRefract ) {\nvReflect = refract( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ), refractionRatio );\n} else {\nvReflect = reflect( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ) );\n}\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\nuniform sampler2D map;\n#endif",map_particle_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, gl_PointCoord );\n#endif",map_pars_vertex:"#ifdef USE_MAP\nvarying vec2 vUv;\nuniform vec4 offsetRepeat;\n#endif",map_pars_fragment:"#ifdef USE_MAP\nvarying vec2 vUv;\nuniform sampler2D map;\n#endif",map_vertex:"#ifdef USE_MAP\nvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",map_fragment:"#ifdef USE_MAP\n#ifdef GAMMA_INPUT\nvec4 texelColor = texture2D( map, vUv );\ntexelColor.xyz *= texelColor.xyz;\ngl_FragColor = gl_FragColor * texelColor;\n#else\ngl_FragColor = gl_FragColor * texture2D( map, vUv );\n#endif\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\nuniform sampler2D lightMap;\n#endif",lightmap_pars_vertex:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\ngl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n#endif",lightmap_vertex:"#ifdef USE_LIGHTMAP\nvUv2 = uv2;\n#endif",lights_lambert_pars_vertex:"uniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif",lights_lambert_vertex:"vLightWeighting = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nfloat directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ i ] * directionalLightWeighting;\n}\n#endif\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat pointLightWeighting = max( dot( transformedNormal, lVector ), 0.0 );\nvLightWeighting += pointLightColor[ i ] * pointLightWeighting * lDistance;\n}\n#endif\nvLightWeighting = vLightWeighting * diffuse + ambient * ambientLightColor;",lights_phong_pars_vertex:"#if MAX_POINT_LIGHTS > 0\n#ifndef PHONG_PER_PIXEL\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#endif",lights_phong_vertex:"#if MAX_POINT_LIGHTS > 0\n#ifndef PHONG_PER_PIXEL\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nvPointLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#endif",lights_phong_pars_fragment:"uniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n#ifdef PHONG_PER_PIXEL\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#else\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#endif\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",lights_phong_fragment:"vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse  = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n#ifdef PHONG_PER_PIXEL\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz + vViewPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\n#else\nvec3 lVector = normalize( vPointLight[ i ].xyz );\nfloat lDistance = vPointLight[ i ].w;\n#endif\nvec3 pointHalfVector = normalize( lVector + viewPosition );\nfloat pointDistance = lDistance;\nfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\nfloat pointDiffuseWeight = max( dot( normal, lVector ), 0.0 );\nfloat pointSpecularWeight = pow( pointDotNormalHalf, shininess );\n#ifdef PHYSICALLY_BASED_SHADING\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( dot( lVector, pointHalfVector ), 5.0 );\npointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance;\n#else\npointSpecular += specular * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance;\n#endif\npointDiffuse  += diffuse * pointLightColor[ i ] * pointDiffuseWeight * pointDistance;\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse  = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nvec3 dirHalfVector = normalize( lDirection.xyz + viewPosition );\nfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\nfloat dirSpecularWeight = pow( dirDotNormalHalf, shininess );\n#ifdef PHYSICALLY_BASED_SHADING\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( dot( dirVector, dirHalfVector ), 5.0 );\ndirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;\n#else\ndirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;\n#endif\ndirDiffuse  += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;\n}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\n#ifdef METAL\ngl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient + totalSpecular );\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_fragment:"#ifdef USE_COLOR\ngl_FragColor = gl_FragColor * vec4( vColor, opacity );\n#endif",color_pars_vertex:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n#ifdef GAMMA_INPUT\nvColor = color * color;\n#else\nvColor = color;\n#endif\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\nuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n#endif",skinning_vertex:"#ifdef USE_SKINNING\ngl_Position  = ( boneGlobalMatrices[ int( skinIndex.x ) ] * skinVertexA ) * skinWeight.x;\ngl_Position += ( boneGlobalMatrices[ int( skinIndex.y ) ] * skinVertexB ) * skinWeight.y;\ngl_Position  = projectionMatrix * viewMatrix * objectMatrix * gl_Position;\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\nuniform float morphTargetInfluences[ 8 ];\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\nvec3 morphed = vec3( 0.0, 0.0, 0.0 );\nmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\nmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\nmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\nmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\nmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\nmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\nmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\nmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\nmorphed += position;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( morphed, 1.0 );\n#endif",default_vertex:"#ifndef USE_MORPHTARGETS\n#ifndef USE_SKINNING\ngl_Position = projectionMatrix * mvPosition;\n#endif\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\nuniform sampler2D shadowMap[ MAX_SHADOWS ];\nuniform float shadowDarkness;\nuniform float shadowBias;\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nfloat unpackDepth( const in vec4 rgba_depth ) {\nconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\nfloat depth = dot( rgba_depth, bit_shift );\nreturn depth;\n}\n#endif",shadowmap_fragment:"#ifdef USE_SHADOWMAP\n#ifdef SHADOWMAP_SOFT\nconst float xPixelOffset = 1.0 / SHADOWMAP_WIDTH;\nconst float yPixelOffset = 1.0 / SHADOWMAP_HEIGHT;\n#endif\nvec3 shadowColor = vec3( 1.0 );\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\nshadowCoord.z += shadowBias;\nif ( shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0 ) {\n#ifdef SHADOWMAP_SOFT\nfloat shadow = 0.0;\nfor ( float y = -1.25; y <= 1.25; y += 1.25 )\nfor ( float x = -1.25; x <= 1.25; x += 1.25 ) {\nvec4 rgbaDepth = texture2D( shadowMap[ i ], vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy );\nfloat fDepth = unpackDepth( rgbaDepth );\nif ( fDepth < shadowCoord.z )\nshadow += 1.0;\n}\nshadow /= 9.0;\nshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness * shadow ) );\n#else\nvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\nfloat fDepth = unpackDepth( rgbaDepth );\nif ( fDepth < shadowCoord.z )\nshadowColor = shadowColor * vec3( shadowDarkness );\n#endif\n}\n}\n#ifdef GAMMA_OUTPUT\nshadowColor *= shadowColor;\n#endif\ngl_FragColor.xyz = gl_FragColor.xyz * shadowColor;\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nuniform mat4 shadowMatrix[ MAX_SHADOWS ];\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvShadowCoord[ i ] = shadowMatrix[ i ] * objectMatrix * vec4( position, 1.0 );\n}\n#endif",alphatest_fragment:"#ifdef ALPHATEST\nif ( gl_FragColor.a < ALPHATEST ) discard;\n#endif",linear_to_gamma_fragment:"#ifdef GAMMA_OUTPUT\ngl_FragColor.xyz = sqrt( gl_FragColor.xyz );\n#endif"};c.UniformsUtils={merge:function(k){var a,l,b,g={};for(a=0;a<k.length;a++){for(l in b=this.clone(k[a]),b){g[l]=b[l]}}return g},clone:function(k){var a,l,b,g={};for(a in k){for(l in g[a]={},k[a]){b=k[a][l],g[a][l]=b instanceof c.Color||b instanceof c.Vector2||b instanceof c.Vector3||b instanceof c.Vector4||b instanceof c.Matrix4||b instanceof c.Texture?b.clone():b instanceof Array?b.slice():b}}return g}};c.UniformsLib={common:{diffuse:{type:"c",value:new c.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:0,texture:null},offsetRepeat:{type:"v4",value:new c.Vector4(0,0,1,1)},lightMap:{type:"t",value:2,texture:null},envMap:{type:"t",value:1,texture:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:0.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},fog:{fogDensity:{type:"f",value:0.00025},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2000},fogColor:{type:"c",value:new c.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new c.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:0,texture:null},fogDensity:{type:"f",value:0.00025},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2000},fogColor:{type:"c",value:new c.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:6,texture:[]},shadowMatrix:{type:"m4v",value:[]},shadowBias:{type:"f",value:0.0039},shadowDarkness:{type:"f",value:0.2}}};c.ShaderLib={sprite:{vertexShader:"uniform int useScreenCoordinates;\nuniform int affectedByDistance;\nuniform vec3 screenPosition;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 alignment;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position + alignment;\nvec2 rotatedPosition;\nrotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;\nrotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;\nvec4 finalPosition;\nif( useScreenCoordinates != 0 ) {\nfinalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );\n} else {\nfinalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition * ( affectedByDistance == 1 ? 1.0 : finalPosition.z );\n}\ngl_Position = finalPosition;\n}",fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nvarying vec2 vUV;\nvoid main() {\nvec4 texture = texture2D( map, vUV );\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\n}"},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2000},opacity:{type:"f",value:1}},vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float mNear;\nuniform float mFar;\nuniform float opacity;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat color = 1.0 - smoothstep( mNear, mFar, depth );\ngl_FragColor = vec4( vec3( color ), opacity );\n}"},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:"varying vec3 vNormal;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvNormal = normalize( normalMatrix * normal );\ngl_Position = projectionMatrix * mvPosition;\n}",fragmentShader:"uniform float opacity;\nvarying vec3 vNormal;\nvoid main() {\ngl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\n}"},basic:{uniforms:c.UniformsUtils.merge([c.UniformsLib.common,c.UniformsLib.fog,c.UniformsLib.shadowmap]),vertexShader:[c.ShaderChunk.map_pars_vertex,c.ShaderChunk.lightmap_pars_vertex,c.ShaderChunk.envmap_pars_vertex,c.ShaderChunk.color_pars_vertex,c.ShaderChunk.skinning_pars_vertex,c.ShaderChunk.morphtarget_pars_vertex,c.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",c.ShaderChunk.map_vertex,c.ShaderChunk.lightmap_vertex,c.ShaderChunk.envmap_vertex,c.ShaderChunk.color_vertex,c.ShaderChunk.skinning_vertex,c.ShaderChunk.morphtarget_vertex,c.ShaderChunk.default_vertex,c.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",c.ShaderChunk.color_pars_fragment,c.ShaderChunk.map_pars_fragment,c.ShaderChunk.lightmap_pars_fragment,c.ShaderChunk.envmap_pars_fragment,c.ShaderChunk.fog_pars_fragment,c.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );",c.ShaderChunk.map_fragment,c.ShaderChunk.alphatest_fragment,c.ShaderChunk.lightmap_fragment,c.ShaderChunk.color_fragment,c.ShaderChunk.envmap_fragment,c.ShaderChunk.shadowmap_fragment,c.ShaderChunk.linear_to_gamma_fragment,c.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:c.UniformsUtils.merge([c.UniformsLib.common,c.UniformsLib.fog,c.UniformsLib.lights,c.UniformsLib.shadowmap,{ambient:{type:"c",value:new c.Color(328965)}}]),vertexShader:["varying vec3 vLightWeighting;",c.ShaderChunk.map_pars_vertex,c.ShaderChunk.lightmap_pars_vertex,c.ShaderChunk.envmap_pars_vertex,c.ShaderChunk.lights_lambert_pars_vertex,c.ShaderChunk.color_pars_vertex,c.ShaderChunk.skinning_pars_vertex,c.ShaderChunk.morphtarget_pars_vertex,c.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",c.ShaderChunk.map_vertex,c.ShaderChunk.lightmap_vertex,c.ShaderChunk.envmap_vertex,c.ShaderChunk.color_vertex,"vec3 transformedNormal = normalize( normalMatrix * normal );",c.ShaderChunk.lights_lambert_vertex,c.ShaderChunk.skinning_vertex,c.ShaderChunk.morphtarget_vertex,c.ShaderChunk.default_vertex,c.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;\nvarying vec3 vLightWeighting;",c.ShaderChunk.color_pars_fragment,c.ShaderChunk.map_pars_fragment,c.ShaderChunk.lightmap_pars_fragment,c.ShaderChunk.envmap_pars_fragment,c.ShaderChunk.fog_pars_fragment,c.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );",c.ShaderChunk.map_fragment,c.ShaderChunk.alphatest_fragment,"gl_FragColor.xyz = gl_FragColor.xyz * vLightWeighting;",c.ShaderChunk.lightmap_fragment,c.ShaderChunk.color_fragment,c.ShaderChunk.envmap_fragment,c.ShaderChunk.shadowmap_fragment,c.ShaderChunk.linear_to_gamma_fragment,c.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:c.UniformsUtils.merge([c.UniformsLib.common,c.UniformsLib.fog,c.UniformsLib.lights,c.UniformsLib.shadowmap,{ambient:{type:"c",value:new c.Color(328965)},specular:{type:"c",value:new c.Color(1118481)},shininess:{type:"f",value:30}}]),vertexShader:["varying vec3 vViewPosition;\nvarying vec3 vNormal;",c.ShaderChunk.map_pars_vertex,c.ShaderChunk.lightmap_pars_vertex,c.ShaderChunk.envmap_pars_vertex,c.ShaderChunk.lights_phong_pars_vertex,c.ShaderChunk.color_pars_vertex,c.ShaderChunk.skinning_pars_vertex,c.ShaderChunk.morphtarget_pars_vertex,c.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",c.ShaderChunk.map_vertex,c.ShaderChunk.lightmap_vertex,c.ShaderChunk.envmap_vertex,c.ShaderChunk.color_vertex,"#ifndef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\n#endif\nvViewPosition = -mvPosition.xyz;\nvec3 transformedNormal = normalMatrix * normal;\nvNormal = transformedNormal;",c.ShaderChunk.lights_phong_vertex,c.ShaderChunk.skinning_vertex,c.ShaderChunk.morphtarget_vertex,c.ShaderChunk.default_vertex,c.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform vec3 ambient;\nuniform vec3 specular;\nuniform float shininess;",c.ShaderChunk.color_pars_fragment,c.ShaderChunk.map_pars_fragment,c.ShaderChunk.lightmap_pars_fragment,c.ShaderChunk.envmap_pars_fragment,c.ShaderChunk.fog_pars_fragment,c.ShaderChunk.lights_phong_pars_fragment,c.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );",c.ShaderChunk.map_fragment,c.ShaderChunk.alphatest_fragment,c.ShaderChunk.lights_phong_fragment,c.ShaderChunk.lightmap_fragment,c.ShaderChunk.color_fragment,c.ShaderChunk.envmap_fragment,c.ShaderChunk.shadowmap_fragment,c.ShaderChunk.linear_to_gamma_fragment,c.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:c.UniformsUtils.merge([c.UniformsLib.particle,c.UniformsLib.shadowmap]),vertexShader:["uniform float size;\nuniform float scale;",c.ShaderChunk.color_pars_vertex,c.ShaderChunk.shadowmap_pars_vertex,"void main() {",c.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n#ifdef USE_SIZEATTENUATION\ngl_PointSize = size * ( scale / length( mvPosition.xyz ) );\n#else\ngl_PointSize = size;\n#endif\ngl_Position = projectionMatrix * mvPosition;",c.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;\nuniform float opacity;",c.ShaderChunk.color_pars_fragment,c.ShaderChunk.map_particle_pars_fragment,c.ShaderChunk.fog_pars_fragment,c.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( psColor, opacity );",c.ShaderChunk.map_particle_fragment,c.ShaderChunk.alphatest_fragment,c.ShaderChunk.color_fragment,c.ShaderChunk.shadowmap_fragment,c.ShaderChunk.fog_fragment,"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[c.ShaderChunk.morphtarget_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",c.ShaderChunk.morphtarget_vertex,c.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:"vec4 pack_depth( const in float depth ) {\nconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\nconst vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\nvec4 res = fract( depth * bit_shift );\nres -= res.xxyz * bit_mask;\nreturn res;\n}\nvoid main() {\ngl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );\n}"}};c.WebGLRenderer=function(al){function an(aB,aC){var aD=aB.vertices.length,z=aC.material;if(z.attributes){if(aB.__webglCustomAttributesList===void 0){aB.__webglCustomAttributesList=[]}for(var aA in z.attributes){var D=z.attributes[aA];if(!D.__webglInitialized||D.createUniqueBuffers){D.__webglInitialized=!0;var C=1;D.type==="v2"?C=2:D.type==="v3"?C=3:D.type==="v4"?C=4:D.type==="c"&&(C=3);D.size=C;D.array=new Float32Array(aD*C);D.buffer=t.createBuffer();D.buffer.belongsToAttribute=aA;D.needsUpdate=!0}aB.__webglCustomAttributesList.push(D)}}}function am(z,C){if(z.material&&!(z.material instanceof c.MeshFaceMaterial)){return z.material}else{if(C.materialIndex>=0){return z.geometry.materials[C.materialIndex]}}}function ap(z){if(z instanceof c.MeshBasicMaterial&&!z.envMap||z instanceof c.MeshDepthMaterial){return !1}return z&&z.shading!==void 0&&z.shading===c.SmoothShading?c.SmoothShading:c.FlatShading}function at(z){if(z.vertexColors){return z.vertexColors}return !1}function ar(z){if(z.map||z.lightMap||z instanceof c.ShaderMaterial){return !0}return !1}function aq(aG,aI,aK){var D,aD,aC,aA,aE=aG.vertices;aA=aE.length;var aF=aG.colors,aM=aF.length,aH=aG.__vertexArray,z=aG.__colorArray,aJ=aG.__sortArray,C=aG.__dirtyVertices,aB=aG.__dirtyColors,aL=aG.__webglCustomAttributesList;if(aK.sortParticles){W.multiplySelf(aK.matrixWorld);for(D=0;D<aA;D++){aD=aE[D].position,k.copy(aD),W.multiplyVector3(k),aJ[D]=[k.z,D]}aJ.sort(function(aN,aO){return aO[0]-aN[0]});for(D=0;D<aA;D++){aD=aE[aJ[D][1]].position,aC=D*3,aH[aC]=aD.x,aH[aC+1]=aD.y,aH[aC+2]=aD.z}for(D=0;D<aM;D++){aC=D*3,aD=aF[aJ[D][1]],z[aC]=aD.r,z[aC+1]=aD.g,z[aC+2]=aD.b}if(aL){aF=0;for(aM=aL.length;aF<aM;aF++){if(aE=aL[aF],aE.boundTo===void 0||aE.boundTo==="vertices"){if(aC=0,aD=aE.value.length,aE.size===1){for(D=0;D<aD;D++){aA=aJ[D][1],aE.array[D]=aE.value[aA]}}else{if(aE.size===2){for(D=0;D<aD;D++){aA=aJ[D][1],aA=aE.value[aA],aE.array[aC]=aA.x,aE.array[aC+1]=aA.y,aC+=2}}else{if(aE.size===3){if(aE.type==="c"){for(D=0;D<aD;D++){aA=aJ[D][1],aA=aE.value[aA],aE.array[aC]=aA.r,aE.array[aC+1]=aA.g,aE.array[aC+2]=aA.b,aC+=3}}else{for(D=0;D<aD;D++){aA=aJ[D][1],aA=aE.value[aA],aE.array[aC]=aA.x,aE.array[aC+1]=aA.y,aE.array[aC+2]=aA.z,aC+=3}}}else{if(aE.size===4){for(D=0;D<aD;D++){aA=aJ[D][1],aA=aE.value[aA],aE.array[aC]=aA.x,aE.array[aC+1]=aA.y,aE.array[aC+2]=aA.z,aE.array[aC+3]=aA.w,aC+=4}}}}}}}}}else{if(C){for(D=0;D<aA;D++){aD=aE[D].position,aC=D*3,aH[aC]=aD.x,aH[aC+1]=aD.y,aH[aC+2]=aD.z}}if(aB){for(D=0;D<aM;D++){aD=aF[D],aC=D*3,z[aC]=aD.r,z[aC+1]=aD.g,z[aC+2]=aD.b}}if(aL){aF=0;for(aM=aL.length;aF<aM;aF++){if(aE=aL[aF],aE.needsUpdate&&(aE.boundTo===void 0||aE.boundTo==="vertices")){if(aD=aE.value.length,aC=0,aE.size===1){for(D=0;D<aD;D++){aE.array[D]=aE.value[D]}}else{if(aE.size===2){for(D=0;D<aD;D++){aA=aE.value[D],aE.array[aC]=aA.x,aE.array[aC+1]=aA.y,aC+=2}}else{if(aE.size===3){if(aE.type==="c"){for(D=0;D<aD;D++){aA=aE.value[D],aE.array[aC]=aA.r,aE.array[aC+1]=aA.g,aE.array[aC+2]=aA.b,aC+=3}}else{for(D=0;D<aD;D++){aA=aE.value[D],aE.array[aC]=aA.x,aE.array[aC+1]=aA.y,aE.array[aC+2]=aA.z,aC+=3}}}else{if(aE.size===4){for(D=0;D<aD;D++){aA=aE.value[D],aE.array[aC]=aA.x,aE.array[aC+1]=aA.y,aE.array[aC+2]=aA.z,aE.array[aC+3]=aA.w,aC+=4}}}}}}}}}if(C||aK.sortParticles){t.bindBuffer(t.ARRAY_BUFFER,aG.__webglVertexBuffer),t.bufferData(t.ARRAY_BUFFER,aH,aI)}if(aB||aK.sortParticles){t.bindBuffer(t.ARRAY_BUFFER,aG.__webglColorBuffer),t.bufferData(t.ARRAY_BUFFER,z,aI)}if(aL){aF=0;for(aM=aL.length;aF<aM;aF++){if(aE=aL[aF],aE.needsUpdate||aK.sortParticles){t.bindBuffer(t.ARRAY_BUFFER,aE.buffer),t.bufferData(t.ARRAY_BUFFER,aE.array,aI)}}}}function r(aK,aA,aB){if(!aK.__webglVertexBuffer){aK.__webglVertexBuffer=t.createBuffer()}if(!aK.__webglNormalBuffer){aK.__webglNormalBuffer=t.createBuffer()}aK.hasPos&&(t.bindBuffer(t.ARRAY_BUFFER,aK.__webglVertexBuffer),t.bufferData(t.ARRAY_BUFFER,aK.positionArray,t.DYNAMIC_DRAW),t.enableVertexAttribArray(aA.attributes.position),t.vertexAttribPointer(aA.attributes.position,3,t.FLOAT,!1,0,0));if(aK.hasNormal){t.bindBuffer(t.ARRAY_BUFFER,aK.__webglNormalBuffer);if(aB===c.FlatShading){var aD,aG,aF,aE,aH,aI,C,aJ,D,z,aC=aK.count*3;for(z=0;z<aC;z+=9){aB=aK.normalArray,aD=aB[z],aG=aB[z+1],aF=aB[z+2],aE=aB[z+3],aI=aB[z+4],aJ=aB[z+5],aH=aB[z+6],C=aB[z+7],D=aB[z+8],aD=(aD+aE+aH)/3,aG=(aG+aI+C)/3,aF=(aF+aJ+D)/3,aB[z]=aD,aB[z+1]=aG,aB[z+2]=aF,aB[z+3]=aD,aB[z+4]=aG,aB[z+5]=aF,aB[z+6]=aD,aB[z+7]=aG,aB[z+8]=aF}}t.bufferData(t.ARRAY_BUFFER,aK.normalArray,t.DYNAMIC_DRAW);t.enableVertexAttribArray(aA.attributes.normal);t.vertexAttribPointer(aA.attributes.normal,3,t.FLOAT,!1,0,0)}t.drawArrays(t.TRIANGLES,0,aK.count);aK.count=0}function s(aB,aD,aE,aF,aI,aH){if(aF.opacity!==0){var aG,aJ,aE=K(aB,aD,aE,aF,aH),aD=aE.attributes,aB=!1,aE=aI.id*16777215+aE.id*2+(aF.wireframe?1:0);aE!==j&&(j=aE,aB=!0);if(!aF.morphTargets&&aD.position>=0){aB&&(t.bindBuffer(t.ARRAY_BUFFER,aI.__webglVertexBuffer),t.vertexAttribPointer(aD.position,3,t.FLOAT,!1,0,0))}else{if(aH.morphTargetBase){aE=aF.program.attributes;aH.morphTargetBase!==-1?(t.bindBuffer(t.ARRAY_BUFFER,aI.__webglMorphTargetsBuffers[aH.morphTargetBase]),t.vertexAttribPointer(aE.position,3,t.FLOAT,!1,0,0)):aE.position>=0&&(t.bindBuffer(t.ARRAY_BUFFER,aI.__webglVertexBuffer),t.vertexAttribPointer(aE.position,3,t.FLOAT,!1,0,0));if(aH.morphTargetForcedOrder.length){aG=0;var z=aH.morphTargetForcedOrder;for(aJ=aH.morphTargetInfluences;aG<aF.numSupportedMorphTargets&&aG<z.length;){t.bindBuffer(t.ARRAY_BUFFER,aI.__webglMorphTargetsBuffers[z[aG]]),t.vertexAttribPointer(aE["morphTarget"+aG],3,t.FLOAT,!1,0,0),aH.__webglMorphTargetInfluences[aG]=aJ[z[aG]],aG++}}else{var z=[],aA=-1,D=0;aJ=aH.morphTargetInfluences;var C,aC=aJ.length;aG=0;for(aH.morphTargetBase!==-1&&(z[aH.morphTargetBase]=!0);aG<aF.numSupportedMorphTargets;){for(C=0;C<aC;C++){!z[C]&&aJ[C]>aA&&(D=C,aA=aJ[D])}t.bindBuffer(t.ARRAY_BUFFER,aI.__webglMorphTargetsBuffers[D]);t.vertexAttribPointer(aE["morphTarget"+aG],3,t.FLOAT,!1,0,0);aH.__webglMorphTargetInfluences[aG]=aA;z[D]=1;aA=-1;aG++}}aF.program.uniforms.morphTargetInfluences!==null&&t.uniform1fv(aF.program.uniforms.morphTargetInfluences,aH.__webglMorphTargetInfluences)}}if(aB){if(aI.__webglCustomAttributesList){aG=0;for(aJ=aI.__webglCustomAttributesList.length;aG<aJ;aG++){aE=aI.__webglCustomAttributesList[aG],aD[aE.buffer.belongsToAttribute]>=0&&(t.bindBuffer(t.ARRAY_BUFFER,aE.buffer),t.vertexAttribPointer(aD[aE.buffer.belongsToAttribute],aE.size,t.FLOAT,!1,0,0))}}aD.color>=0&&(t.bindBuffer(t.ARRAY_BUFFER,aI.__webglColorBuffer),t.vertexAttribPointer(aD.color,3,t.FLOAT,!1,0,0));aD.normal>=0&&(t.bindBuffer(t.ARRAY_BUFFER,aI.__webglNormalBuffer),t.vertexAttribPointer(aD.normal,3,t.FLOAT,!1,0,0));aD.tangent>=0&&(t.bindBuffer(t.ARRAY_BUFFER,aI.__webglTangentBuffer),t.vertexAttribPointer(aD.tangent,4,t.FLOAT,!1,0,0));aD.uv>=0&&(aI.__webglUVBuffer?(t.bindBuffer(t.ARRAY_BUFFER,aI.__webglUVBuffer),t.vertexAttribPointer(aD.uv,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(aD.uv)):t.disableVertexAttribArray(aD.uv));aD.uv2>=0&&(aI.__webglUV2Buffer?(t.bindBuffer(t.ARRAY_BUFFER,aI.__webglUV2Buffer),t.vertexAttribPointer(aD.uv2,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(aD.uv2)):t.disableVertexAttribArray(aD.uv2));aF.skinning&&aD.skinVertexA>=0&&aD.skinVertexB>=0&&aD.skinIndex>=0&&aD.skinWeight>=0&&(t.bindBuffer(t.ARRAY_BUFFER,aI.__webglSkinVertexABuffer),t.vertexAttribPointer(aD.skinVertexA,4,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,aI.__webglSkinVertexBBuffer),t.vertexAttribPointer(aD.skinVertexB,4,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,aI.__webglSkinIndicesBuffer),t.vertexAttribPointer(aD.skinIndex,4,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,aI.__webglSkinWeightsBuffer),t.vertexAttribPointer(aD.skinWeight,4,t.FLOAT,!1,0,0))}aH instanceof c.Mesh?(aF.wireframe?(aF=aF.wireframeLinewidth,aF!==l&&(t.lineWidth(aF),l=aF),aB&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,aI.__webglLineBuffer),t.drawElements(t.LINES,aI.__webglLineCount,t.UNSIGNED_SHORT,0)):(aB&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,aI.__webglFaceBuffer),t.drawElements(t.TRIANGLES,aI.__webglFaceCount,t.UNSIGNED_SHORT,0)),ag.info.render.calls++,ag.info.render.vertices+=aI.__webglFaceCount,ag.info.render.faces+=aI.__webglFaceCount/3):aH instanceof c.Line?(aH=aH.type===c.LineStrip?t.LINE_STRIP:t.LINES,aF=aF.linewidth,aF!==l&&(t.lineWidth(aF),l=aF),t.drawArrays(aH,0,aI.__webglLineCount),ag.info.render.calls++):aH instanceof c.ParticleSystem?(t.drawArrays(t.POINTS,0,aI.__webglParticleCount),ag.info.render.calls++):aH instanceof c.Ribbon&&(t.drawArrays(t.TRIANGLE_STRIP,0,aI.__webglVertexCount),ag.info.render.calls++)}}function w(z){aV[0].set(z.n41-z.n11,z.n42-z.n12,z.n43-z.n13,z.n44-z.n14);aV[1].set(z.n41+z.n11,z.n42+z.n12,z.n43+z.n13,z.n44+z.n14);aV[2].set(z.n41+z.n21,z.n42+z.n22,z.n43+z.n23,z.n44+z.n24);aV[3].set(z.n41-z.n21,z.n42-z.n22,z.n43-z.n23,z.n44-z.n24);aV[4].set(z.n41-z.n31,z.n42-z.n32,z.n43-z.n33,z.n44-z.n34);aV[5].set(z.n41+z.n31,z.n42+z.n32,z.n43+z.n33,z.n44+z.n34);for(var C,z=0;z<6;z++){C=aV[z],C.divideScalar(Math.sqrt(C.x*C.x+C.y*C.y+C.z*C.z))}}function u(D){for(var aA=D.matrixWorld,z=-D.geometry.boundingSphere.radius*Math.max(D.scale.x,Math.max(D.scale.y,D.scale.z)),C=0;C<6;C++){if(D=aV[C].x*aA.n14+aV[C].y*aA.n24+aV[C].z*aA.n34+aV[C].w,D<=z){return !1}}return !0}function E(z,C){return C.z-z.z}function F(aE){var aF,aG,aH,D,C,z,aA,aB,aC=0,aD=aE.lights;ai||(ai=new c.PerspectiveCamera(ag.shadowCameraFov,ag.shadowMapWidth/ag.shadowMapHeight,ag.shadowCameraNear,ag.shadowCameraFar));aF=0;for(aG=aD.length;aF<aG;aF++){if(aB=aD[aF],aB.castShadow&&aB instanceof c.SpotLight){m=-1;ag.shadowMap[aC]||(ag.shadowMap[aC]=new c.WebGLRenderTarget(ag.shadowMapWidth,ag.shadowMapHeight,{minFilter:c.LinearFilter,magFilter:c.LinearFilter,format:c.RGBAFormat}),b[aC]=new c.Matrix4);aH=ag.shadowMap[aC];D=b[aC];ai.position.copy(aB.position);ai.lookAt(aB.target.position);ai.parent==null&&(console.warn("Camera is not on the Scene. Adding it..."),aE.add(ai),this.autoUpdateScene&&aE.updateMatrixWorld());ai.matrixWorldInverse.getInverse(ai.matrixWorld);D.set(0.5,0,0,0.5,0,0.5,0,0.5,0,0,0.5,0.5,0,0,0,1);D.multiplySelf(ai.projectionMatrix);D.multiplySelf(ai.matrixWorldInverse);ai.matrixWorldInverse.flattenToArray(f);ai.projectionMatrix.flattenToArray(A);W.multiply(ai.projectionMatrix,ai.matrixWorldInverse);w(W);ae(aH);t.clearColor(1,1,1,1);ag.clear();t.clearColor(V.r,V.g,V.b,ac);D=aE.__webglObjects.length;for(aH=0;aH<D;aH++){if(z=aE.__webglObjects[aH],aB=z.object,z.render=!1,aB.visible&&aB.castShadow&&(!(aB instanceof c.Mesh)||!aB.frustumCulled||u(aB))){aB.matrixWorld.flattenToArray(aB._objectMatrixArray),av(aB,ai,!1),z.render=!0}}au(!0);L(c.NormalBlending);for(aH=0;aH<D;aH++){if(z=aE.__webglObjects[aH],z.render){aB=z.object,z=z.buffer,ay(aB),aA=aB.customDepthMaterial?aB.customDepthMaterial:aB.geometry.morphTargets.length?p:P,s(ai,aD,null,aA,z,aB)}}D=aE.__webglObjectsImmediate.length;for(aH=0;aH<D;aH++){z=aE.__webglObjectsImmediate[aH],aB=z.object,aB.visible&&aB.castShadow&&(aB.matrixAutoUpdate&&aB.matrixWorld.flattenToArray(aB._objectMatrixArray),j=-1,av(aB,ai,!1),ay(aB),C=K(ai,aD,null,P,aB),aB.immediateRenderCallback?aB.immediateRenderCallback(C,t,aV):aB.render(function(aI){r(aI,C,P.shading)}))}aC++}}}function y(aB,aD,aE,aF,aI,aH,aG,aJ){var z,aA,aC,D;aD?(aA=aB.length-1,D=aD=-1):(aA=0,aD=aB.length,D=1);for(var C=aA;C!==aD;C+=D){if(z=aB[C],z.render){aA=z.object;aC=z.buffer;if(aJ){z=aJ}else{z=z[aE];if(!z){continue}aG&&L(z.blending);au(z.depthTest);N(z.depthWrite);O(z.polygonOffset,z.polygonOffsetFactor,z.polygonOffsetUnits)}ay(aA);s(aF,aI,aH,z,aC,aA)}}}function H(aA,aD,aE,aF,aI,aH,aG){for(var aJ,D,aB,C,z=0,aC=aA.length;z<aC;z++){if(aJ=aA[z],D=aJ.object,D.visible){j=-1;if(aG){aB=aG}else{aB=aJ[aD];if(!aB){continue}aH&&L(aB.blending);au(aB.depthTest);N(aB.depthWrite);O(aB.polygonOffset,aB.polygonOffsetFactor,aB.polygonOffsetUnits)}ay(D);C=K(aE,aF,aI,aB,D);D.immediateRenderCallback?D.immediateRenderCallback(C,t,aV):D.render(function(aK){r(aK,C,aB.shading)})}}}function B(C,D,z){C.push({buffer:D,object:z,opaque:null,transparent:null})}function G(z){for(var C in z.attributes){if(z.attributes[C].needsUpdate){return !0}}return !1}function J(z){for(var C in z.attributes){z.attributes[C].needsUpdate=!1}}function M(C,D){for(var z=C.length-1;z>=0;z--){C[z].object===D&&C.splice(z,1)}}function K(z,C,D,aA,aD){aA.program||ag.initMaterial(aA,C,D,aD);if(aA.morphTargets&&!aD.__webglMorphTargetInfluences){aD.__webglMorphTargetInfluences=new Float32Array(ag.maxMorphTargets);for(var aC=0,aB=ag.maxMorphTargets;aC<aB;aC++){aD.__webglMorphTargetInfluences[aC]=0}}var aE=!1,aC=aA.program,aB=aC.uniforms,aF=aA.uniforms;aC!==af&&(t.useProgram(aC),af=aC,aE=!0);if(aA.id!==m){m=aA.id,aE=!0}if(aE){t.uniformMatrix4fv(aB.projectionMatrix,!1,A);if(D&&aA.fog){if(aF.fogColor.value=D.color,D instanceof c.Fog){aF.fogNear.value=D.near,aF.fogFar.value=D.far}else{if(D instanceof c.FogExp2){aF.fogDensity.value=D.density}}}if(aA instanceof c.MeshPhongMaterial||aA instanceof c.MeshLambertMaterial||aA.lights){for(var aI,aJ,aH=0,aG=0,aL=0,aN,aM,aP,aQ=h,aR=aQ.directional.colors,aS=aQ.directional.positions,aY=aQ.point.colors,aX=aQ.point.positions,aW=aQ.point.distances,aK=0,aO=0,D=aI=aP=0,aE=C.length;D<aE;D++){if(aI=C[D],aJ=aI.color,aN=aI.position,aM=aI.intensity,aP=aI.distance,aI instanceof c.AmbientLight){ag.gammaInput?(aH+=aJ.r*aJ.r,aG+=aJ.g*aJ.g,aL+=aJ.b*aJ.b):(aH+=aJ.r,aG+=aJ.g,aL+=aJ.b)}else{if(aI instanceof c.DirectionalLight){aP=aK*3,ag.gammaInput?(aR[aP]=aJ.r*aJ.r*aM*aM,aR[aP+1]=aJ.g*aJ.g*aM*aM,aR[aP+2]=aJ.b*aJ.b*aM*aM):(aR[aP]=aJ.r*aM,aR[aP+1]=aJ.g*aM,aR[aP+2]=aJ.b*aM),aS[aP]=aN.x,aS[aP+1]=aN.y,aS[aP+2]=aN.z,aK+=1}else{if(aI instanceof c.SpotLight){aP=aK*3,ag.gammaInput?(aR[aP]=aJ.r*aJ.r*aM*aM,aR[aP+1]=aJ.g*aJ.g*aM*aM,aR[aP+2]=aJ.b*aJ.b*aM*aM):(aR[aP]=aJ.r*aM,aR[aP+1]=aJ.g*aM,aR[aP+2]=aJ.b*aM),aJ=1/aN.length(),aS[aP]=aN.x*aJ,aS[aP+1]=aN.y*aJ,aS[aP+2]=aN.z*aJ,aK+=1}else{if(aI instanceof c.PointLight){aI=aO*3,ag.gammaInput?(aY[aI]=aJ.r*aJ.r*aM*aM,aY[aI+1]=aJ.g*aJ.g*aM*aM,aY[aI+2]=aJ.b*aJ.b*aM*aM):(aY[aI]=aJ.r*aM,aY[aI+1]=aJ.g*aM,aY[aI+2]=aJ.b*aM),aX[aI]=aN.x,aX[aI+1]=aN.y,aX[aI+2]=aN.z,aW[aO]=aP,aO+=1}}}}}D=aK*3;for(aE=aR.length;D<aE;D++){aR[D]=0}D=aO*3;for(aE=aY.length;D<aE;D++){aY[D]=0}aQ.point.length=aO;aQ.directional.length=aK;aQ.ambient[0]=aH;aQ.ambient[1]=aG;aQ.ambient[2]=aL;C=h;aF.ambientLightColor.value=C.ambient;aF.directionalLightColor.value=C.directional.colors;aF.directionalLightDirection.value=C.directional.positions;aF.pointLightColor.value=C.point.colors;aF.pointLightPosition.value=C.point.positions;aF.pointLightDistance.value=C.point.distances}if(aA instanceof c.MeshBasicMaterial||aA instanceof c.MeshLambertMaterial||aA instanceof c.MeshPhongMaterial){aF.opacity.value=aA.opacity,ag.gammaInput?aF.diffuse.value.copyGammaToLinear(aA.color):aF.diffuse.value=aA.color,(aF.map.texture=aA.map)&&aF.offsetRepeat.value.set(aA.map.offset.x,aA.map.offset.y,aA.map.repeat.x,aA.map.repeat.y),aF.lightMap.texture=aA.lightMap,aF.envMap.texture=aA.envMap,aF.flipEnvMap.value=aA.envMap instanceof c.WebGLRenderTargetCube?1:-1,aF.reflectivity.value=aA.reflectivity,aF.refractionRatio.value=aA.refractionRatio,aF.combine.value=aA.combine,aF.useRefract.value=aA.envMap&&aA.envMap.mapping instanceof c.CubeRefractionMapping}if(aA instanceof c.LineBasicMaterial){aF.diffuse.value=aA.color,aF.opacity.value=aA.opacity}else{if(aA instanceof c.ParticleBasicMaterial){aF.psColor.value=aA.color,aF.opacity.value=aA.opacity,aF.size.value=aA.size,aF.scale.value=X.height/2,aF.map.texture=aA.map}else{if(aA instanceof c.MeshPhongMaterial){aF.shininess.value=aA.shininess,ag.gammaInput?(aF.ambient.value.copyGammaToLinear(aA.ambient),aF.specular.value.copyGammaToLinear(aA.specular)):(aF.ambient.value=aA.ambient,aF.specular.value=aA.specular)}else{if(aA instanceof c.MeshLambertMaterial){ag.gammaInput?aF.ambient.value.copyGammaToLinear(aA.ambient):aF.ambient.value=aA.ambient}else{if(aA instanceof c.MeshDepthMaterial){aF.mNear.value=z.near,aF.mFar.value=z.far,aF.opacity.value=aA.opacity}else{if(aA instanceof c.MeshNormalMaterial){aF.opacity.value=aA.opacity}}}}}}if(aD.receiveShadow&&!aA._shadowPass&&aF.shadowMatrix){for(C=0;C<b.length;C++){aF.shadowMatrix.value[C]=b[C],aF.shadowMap.texture[C]=ag.shadowMap[C]}aF.shadowDarkness.value=ag.shadowMapDarkness;aF.shadowBias.value=ag.shadowMapBias}C=aA.uniformsList;aF=0;for(D=C.length;aF<D;aF++){if(aG=aC.uniforms[C[aF][1]]){if(aH=C[aF][0],aL=aH.type,aE=aH.value,aL==="i"){t.uniform1i(aG,aE)}else{if(aL==="f"){t.uniform1f(aG,aE)}else{if(aL==="v2"){t.uniform2f(aG,aE.x,aE.y)}else{if(aL==="v3"){t.uniform3f(aG,aE.x,aE.y,aE.z)}else{if(aL==="v4"){t.uniform4f(aG,aE.x,aE.y,aE.z,aE.w)}else{if(aL==="c"){t.uniform3f(aG,aE.r,aE.g,aE.b)}else{if(aL==="fv1"){t.uniform1fv(aG,aE)}else{if(aL==="fv"){t.uniform3fv(aG,aE)}else{if(aL==="v3v"){if(!aH._array){aH._array=new Float32Array(3*aE.length)}aL=0;for(aN=aE.length;aL<aN;aL++){aQ=aL*3,aH._array[aQ]=aE[aL].x,aH._array[aQ+1]=aE[aL].y,aH._array[aQ+2]=aE[aL].z}t.uniform3fv(aG,aH._array)}else{if(aL==="m4"){if(!aH._array){aH._array=new Float32Array(16)}aE.flattenToArray(aH._array);t.uniformMatrix4fv(aG,!1,aH._array)}else{if(aL==="m4v"){if(!aH._array){aH._array=new Float32Array(16*aE.length)}aL=0;for(aN=aE.length;aL<aN;aL++){aE[aL].flattenToArrayOffset(aH._array,aL*16)}t.uniformMatrix4fv(aG,!1,aH._array)}else{if(aL==="t"){if(t.uniform1i(aG,aE),aG=aH.texture){if(aG.image instanceof Array&&aG.image.length===6){if(aH=aG,aH.image.length===6){if(aH.needsUpdate){if(!aH.image.__webglTextureCube){aH.image.__webglTextureCube=t.createTexture()}t.activeTexture(t.TEXTURE0+aE);t.bindTexture(t.TEXTURE_CUBE_MAP,aH.image.__webglTextureCube);aE=I(t.TEXTURE_CUBE_MAP,aH,aH.image[0]);for(aG=0;aG<6;aG++){t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+aG,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,aH.image[aG])}aE&&t.generateMipmap(t.TEXTURE_CUBE_MAP);aH.needsUpdate=!1}else{t.activeTexture(t.TEXTURE0+aE),t.bindTexture(t.TEXTURE_CUBE_MAP,aH.image.__webglTextureCube)}}}else{aG instanceof c.WebGLRenderTargetCube?(aH=aG,t.activeTexture(t.TEXTURE0+aE),t.bindTexture(t.TEXTURE_CUBE_MAP,aH.__webglTexture)):ax(aG,aE)}}}else{if(aL==="tv"){if(!aH._array){aH._array=[];aL=0;for(aN=aH.texture.length;aL<aN;aL++){aH._array[aL]=aE+aL}}t.uniform1iv(aG,aH._array);aL=0;for(aN=aH.texture.length;aL<aN;aL++){(aG=aH.texture[aL])&&ax(aG,aH._array[aL])}}}}}}}}}}}}}}}}(aA instanceof c.ShaderMaterial||aA instanceof c.MeshPhongMaterial||aA.envMap)&&aB.cameraPosition!==null&&t.uniform3f(aB.cameraPosition,z.position.x,z.position.y,z.position.z);(aA instanceof c.MeshPhongMaterial||aA instanceof c.MeshLambertMaterial||aA instanceof c.ShaderMaterial||aA.skinning)&&aB.viewMatrix!==null&&t.uniformMatrix4fv(aB.viewMatrix,!1,f);aA.skinning&&(t.uniformMatrix4fv(aB.cameraInverseMatrix,!1,f),t.uniformMatrix4fv(aB.boneGlobalMatrices,!1,aD.boneMatrices))}t.uniformMatrix4fv(aB.modelViewMatrix,!1,aD._modelViewMatrixArray);aB.normalMatrix&&t.uniformMatrix3fv(aB.normalMatrix,!1,aD._normalMatrixArray);(aA instanceof c.ShaderMaterial||aA.envMap||aA.skinning||aD.receiveShadow)&&aB.objectMatrix!==null&&t.uniformMatrix4fv(aB.objectMatrix,!1,aD._objectMatrixArray);return aC}function av(C,D,z){C._modelViewMatrix.multiplyToArray(D.matrixWorldInverse,C.matrixWorld,C._modelViewMatrixArray);z&&c.Matrix4.makeInvert3x3(C._modelViewMatrix).transposeIntoArray(C._normalMatrixArray)}function ay(z){if(e!==z.doubleSided){z.doubleSided?t.disable(t.CULL_FACE):t.enable(t.CULL_FACE),e=z.doubleSided}if(v!==z.flipSided){z.flipSided?t.frontFace(t.CW):t.frontFace(t.CCW),v=z.flipSided}}function au(z){ao!==z&&(z?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),ao=z)}function N(z){Q!==z&&(t.depthMask(z),Q=z)}function O(C,D,z){q!==C&&(C?t.enable(t.POLYGON_OFFSET_FILL):t.disable(t.POLYGON_OFFSET_FILL),q=C);if(C&&(o!==D||g!==z)){t.polygonOffset(D,z),o=D,g=z}}function L(z){if(z!==aw){switch(z){case c.AdditiveBlending:t.blendEquation(t.FUNC_ADD);t.blendFunc(t.SRC_ALPHA,t.ONE);break;case c.SubtractiveBlending:t.blendEquation(t.FUNC_ADD);t.blendFunc(t.ZERO,t.ONE_MINUS_SRC_COLOR);break;case c.MultiplyBlending:t.blendEquation(t.FUNC_ADD);t.blendFunc(t.ZERO,t.SRC_COLOR);break;default:t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA)}aw=z}}function a(C,D){var z;C==="fragment"?z=t.createShader(t.FRAGMENT_SHADER):C==="vertex"&&(z=t.createShader(t.VERTEX_SHADER));t.shaderSource(z,D);t.compileShader(z);if(!t.getShaderParameter(z,t.COMPILE_STATUS)){return console.error(t.getShaderInfoLog(z)),console.error(D),null}return z}function I(C,D,z){return(z.width&z.width-1)===0&&(z.height&z.height-1)===0?(t.texParameteri(C,t.TEXTURE_WRAP_S,Z(D.wrapS)),t.texParameteri(C,t.TEXTURE_WRAP_T,Z(D.wrapT)),t.texParameteri(C,t.TEXTURE_MAG_FILTER,Z(D.magFilter)),t.texParameteri(C,t.TEXTURE_MIN_FILTER,Z(D.minFilter)),!0):(t.texParameteri(C,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(C,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(C,t.TEXTURE_MAG_FILTER,T(D.magFilter)),t.texParameteri(C,t.TEXTURE_MIN_FILTER,T(D.minFilter)),!1)}function ax(C,D){if(C.needsUpdate){if(!C.__webglInit){C.__webglInit=!0,C.__webglTexture=t.createTexture(),ag.info.memory.textures++}t.activeTexture(t.TEXTURE0+D);t.bindTexture(t.TEXTURE_2D,C.__webglTexture);var z=I(t.TEXTURE_2D,C,C.image);C instanceof c.DataTexture?t.texImage2D(t.TEXTURE_2D,0,Z(C.format),C.image.width,C.image.height,0,Z(C.format),t.UNSIGNED_BYTE,C.image.data):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,C.image);z&&t.generateMipmap(t.TEXTURE_2D);C.needsUpdate=!1;if(C.onUpdated){C.onUpdated()}}else{t.activeTexture(t.TEXTURE0+D),t.bindTexture(t.TEXTURE_2D,C.__webglTexture)}}function ab(z,C){t.bindRenderbuffer(t.RENDERBUFFER,z);C.depthBuffer&&!C.stencilBuffer?(t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,C.width,C.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,z)):C.depthBuffer&&C.stencilBuffer?(t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,C.width,C.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,z)):t.renderbufferStorage(t.RENDERBUFFER,t.RGBA4,C.width,C.height)}function ae(aA){var aB=aA instanceof c.WebGLRenderTargetCube;if(aA&&!aA.__webglFramebuffer){if(aA.depthBuffer===void 0){aA.depthBuffer=!0}if(aA.stencilBuffer===void 0){aA.stencilBuffer=!0}aA.__webglTexture=t.createTexture();if(aB){aA.__webglFramebuffer=[];aA.__webglRenderbuffer=[];t.bindTexture(t.TEXTURE_CUBE_MAP,aA.__webglTexture);I(t.TEXTURE_CUBE_MAP,aA,aA);for(var z=0;z<6;z++){aA.__webglFramebuffer[z]=t.createFramebuffer();aA.__webglRenderbuffer[z]=t.createRenderbuffer();t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+z,0,Z(aA.format),aA.width,aA.height,0,Z(aA.format),Z(aA.type),null);var C=aA,D=t.TEXTURE_CUBE_MAP_POSITIVE_X+z;t.bindFramebuffer(t.FRAMEBUFFER,aA.__webglFramebuffer[z]);t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,D,C.__webglTexture,0);ab(aA.__webglRenderbuffer[z],aA)}}else{aA.__webglFramebuffer=t.createFramebuffer(),aA.__webglRenderbuffer=t.createRenderbuffer(),t.bindTexture(t.TEXTURE_2D,aA.__webglTexture),I(t.TEXTURE_2D,aA,aA),t.texImage2D(t.TEXTURE_2D,0,Z(aA.format),aA.width,aA.height,0,Z(aA.format),Z(aA.type),null),z=t.TEXTURE_2D,t.bindFramebuffer(t.FRAMEBUFFER,aA.__webglFramebuffer),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,z,aA.__webglTexture,0),ab(aA.__webglRenderbuffer,aA)}aB?t.bindTexture(t.TEXTURE_CUBE_MAP,null):t.bindTexture(t.TEXTURE_2D,null);t.bindRenderbuffer(t.RENDERBUFFER,null);t.bindFramebuffer(t.FRAMEBUFFER,null)}aA?(aB=aB?aA.__webglFramebuffer[aA.activeCubeFace]:aA.__webglFramebuffer,z=aA.width,aA=aA.height,D=C=0):(aB=null,z=aa,aA=x,C=U,D=aj);aB!==R&&(t.bindFramebuffer(t.FRAMEBUFFER,aB),t.viewport(C,D,z,aA),R=aB)}function T(z){switch(z){case c.NearestFilter:case c.NearestMipMapNearestFilter:case c.NearestMipMapLinearFilter:return t.NEAREST;default:return t.LINEAR}}function Z(z){switch(z){case c.RepeatWrapping:return t.REPEAT;case c.ClampToEdgeWrapping:return t.CLAMP_TO_EDGE;case c.MirroredRepeatWrapping:return t.MIRRORED_REPEAT;case c.NearestFilter:return t.NEAREST;case c.NearestMipMapNearestFilter:return t.NEAREST_MIPMAP_NEAREST;case c.NearestMipMapLinearFilter:return t.NEAREST_MIPMAP_LINEAR;case c.LinearFilter:return t.LINEAR;case c.LinearMipMapNearestFilter:return t.LINEAR_MIPMAP_NEAREST;case c.LinearMipMapLinearFilter:return t.LINEAR_MIPMAP_LINEAR;case c.ByteType:return t.BYTE;case c.UnsignedByteType:return t.UNSIGNED_BYTE;case c.ShortType:return t.SHORT;case c.UnsignedShortType:return t.UNSIGNED_SHORT;case c.IntType:return t.INT;case c.UnsignedShortType:return t.UNSIGNED_INT;case c.FloatType:return t.FLOAT;case c.AlphaFormat:return t.ALPHA;case c.RGBFormat:return t.RGB;case c.RGBAFormat:return t.RGBA;case c.LuminanceFormat:return t.LUMINANCE;case c.LuminanceAlphaFormat:return t.LUMINANCE_ALPHA}return 0}var al=al||{},X=al.canvas!==void 0?al.canvas:document.createElement("canvas"),n=al.precision!==void 0?al.precision:"highp",aT=al.antialias!==void 0?al.antialias:!1,az=al.stencil!==void 0?al.stencil:!0,aU=al.preserveDrawingBuffer!==void 0?al.preserveDrawingBuffer:!1,V=al.clearColor!==void 0?new c.Color(al.clearColor):new c.Color(0),ac=al.clearAlpha!==void 0?al.clearAlpha:0,Y=al.maxLights!==void 0?al.maxLights:4;this.domElement=X;this.context=null;this.autoUpdateScene=this.autoUpdateObjects=this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0;this.physicallyBasedShading=this.gammaOutput=this.gammaInput=!1;this.shadowMapBias=0.0039;this.shadowMapDarkness=0.5;this.shadowMapHeight=this.shadowMapWidth=512;this.shadowCameraNear=1;this.shadowCameraFar=5000;this.shadowCameraFov=50;this.shadowMap=[];this.shadowMapEnabled=!1;this.shadowMapSoft=this.shadowMapAutoUpdate=!0;this.maxMorphTargets=8;this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0}};var ag=this,t,ah=[],af=null,R=null,m=-1,j=null,ak=0,e=null,v=null,aw=null,ao=null,Q=null,q=null,o=null,g=null,l=null,U=0,aj=0,aa=0,x=0,aV=[new c.Vector4,new c.Vector4,new c.Vector4,new c.Vector4,new c.Vector4,new c.Vector4],W=new c.Matrix4,A=new Float32Array(16),f=new Float32Array(16),k=new c.Vector4,h={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]}},ai,b=[],P,p,ad={},S=!1;t=function(){var z;try{if(!(z=X.getContext("experimental-webgl",{antialias:aT,stencil:az,preserveDrawingBuffer:aU}))){throw"Error creating WebGL context."}console.log(navigator.userAgent+" | "+z.getParameter(z.VERSION)+" | "+z.getParameter(z.VENDOR)+" | "+z.getParameter(z.RENDERER)+" | "+z.getParameter(z.SHADING_LANGUAGE_VERSION))}catch(C){console.error(C)}return z}();t.clearColor(0,0,0,1);t.clearDepth(1);t.clearStencil(0);t.enable(t.DEPTH_TEST);t.depthFunc(t.LEQUAL);t.frontFace(t.CCW);t.cullFace(t.BACK);t.enable(t.CULL_FACE);t.enable(t.BLEND);t.blendEquation(t.FUNC_ADD);t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA);t.clearColor(V.r,V.g,V.b,ac);(function(){ad.vertices=new Float32Array(16);ad.faces=new Uint16Array(6);var z=0;ad.vertices[z++]=-1;ad.vertices[z++]=-1;ad.vertices[z++]=0;ad.vertices[z++]=1;ad.vertices[z++]=1;ad.vertices[z++]=-1;ad.vertices[z++]=1;ad.vertices[z++]=1;ad.vertices[z++]=1;ad.vertices[z++]=1;ad.vertices[z++]=1;ad.vertices[z++]=0;ad.vertices[z++]=-1;ad.vertices[z++]=1;ad.vertices[z++]=0;z=ad.vertices[z++]=0;ad.faces[z++]=0;ad.faces[z++]=1;ad.faces[z++]=2;ad.faces[z++]=0;ad.faces[z++]=2;ad.faces[z++]=3;ad.vertexBuffer=t.createBuffer();ad.elementBuffer=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,ad.vertexBuffer);t.bufferData(t.ARRAY_BUFFER,ad.vertices,t.STATIC_DRAW);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,ad.elementBuffer);t.bufferData(t.ELEMENT_ARRAY_BUFFER,ad.faces,t.STATIC_DRAW);ad.program=t.createProgram();t.attachShader(ad.program,a("fragment",c.ShaderLib.sprite.fragmentShader));t.attachShader(ad.program,a("vertex",c.ShaderLib.sprite.vertexShader));t.linkProgram(ad.program);ad.attributes={};ad.uniforms={};ad.attributes.position=t.getAttribLocation(ad.program,"position");ad.attributes.uv=t.getAttribLocation(ad.program,"uv");ad.uniforms.uvOffset=t.getUniformLocation(ad.program,"uvOffset");ad.uniforms.uvScale=t.getUniformLocation(ad.program,"uvScale");ad.uniforms.rotation=t.getUniformLocation(ad.program,"rotation");ad.uniforms.scale=t.getUniformLocation(ad.program,"scale");ad.uniforms.alignment=t.getUniformLocation(ad.program,"alignment");ad.uniforms.color=t.getUniformLocation(ad.program,"color");ad.uniforms.map=t.getUniformLocation(ad.program,"map");ad.uniforms.opacity=t.getUniformLocation(ad.program,"opacity");ad.uniforms.useScreenCoordinates=t.getUniformLocation(ad.program,"useScreenCoordinates");ad.uniforms.affectedByDistance=t.getUniformLocation(ad.program,"affectedByDistance");ad.uniforms.screenPosition=t.getUniformLocation(ad.program,"screenPosition");ad.uniforms.modelViewMatrix=t.getUniformLocation(ad.program,"modelViewMatrix");ad.uniforms.projectionMatrix=t.getUniformLocation(ad.program,"projectionMatrix")})();(function(){var z=c.ShaderLib.depthRGBA,C=c.UniformsUtils.clone(z.uniforms);P=new c.ShaderMaterial({fragmentShader:z.fragmentShader,vertexShader:z.vertexShader,uniforms:C});p=new c.ShaderMaterial({fragmentShader:z.fragmentShader,vertexShader:z.vertexShader,uniforms:C,morphTargets:!0});P._shadowPass=!0;p._shadowPass=!0})();this.context=t;var i=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;this.getContext=function(){return t};this.supportsVertexTextures=function(){return i};this.setSize=function(z,C){X.width=z;X.height=C;this.setViewport(0,0,X.width,X.height)};this.setViewport=function(D,aA,z,C){U=D;aj=aA;aa=z;x=C;t.viewport(U,aj,aa,x)};this.setScissor=function(D,aA,z,C){t.scissor(D,aA,z,C)};this.enableScissorTest=function(z){z?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST)};this.setClearColorHex=function(z,C){V.setHex(z);ac=C;t.clearColor(V.r,V.g,V.b,ac)};this.setClearColor=function(z,C){V.copy(z);ac=C;t.clearColor(V.r,V.g,V.b,ac)};this.getClearColor=function(){return V};this.getClearAlpha=function(){return ac};this.clear=function(D,aA,z){var C=0;if(D===void 0||D){C|=t.COLOR_BUFFER_BIT}if(aA===void 0||aA){C|=t.DEPTH_BUFFER_BIT}if(z===void 0||z){C|=t.STENCIL_BUFFER_BIT}t.clear(C)};this.clearTarget=function(D,aA,z,C){ae(D);this.clear(aA,z,C)};this.deallocateObject=function(aA){if(aA.__webglInit){if(aA.__webglInit=!1,delete aA._modelViewMatrix,delete aA._normalMatrixArray,delete aA._modelViewMatrixArray,delete aA._objectMatrixArray,aA instanceof c.Mesh){for(var aB in aA.geometry.geometryGroups){var z=aA.geometry.geometryGroups[aB];t.deleteBuffer(z.__webglVertexBuffer);t.deleteBuffer(z.__webglNormalBuffer);t.deleteBuffer(z.__webglTangentBuffer);t.deleteBuffer(z.__webglColorBuffer);t.deleteBuffer(z.__webglUVBuffer);t.deleteBuffer(z.__webglUV2Buffer);t.deleteBuffer(z.__webglSkinVertexABuffer);t.deleteBuffer(z.__webglSkinVertexBBuffer);t.deleteBuffer(z.__webglSkinIndicesBuffer);t.deleteBuffer(z.__webglSkinWeightsBuffer);t.deleteBuffer(z.__webglFaceBuffer);t.deleteBuffer(z.__webglLineBuffer);if(z.numMorphTargets){for(var C=0,D=z.numMorphTargets;C<D;C++){t.deleteBuffer(z.__webglMorphTargetsBuffers[C])}}if(z.__webglCustomAttributesList){for(C in C=void 0,z.__webglCustomAttributesList){t.deleteBuffer(z.__webglCustomAttributesList[C].buffer)}}ag.info.memory.geometries--}}else{if(aA instanceof c.Ribbon){aA=aA.geometry,t.deleteBuffer(aA.__webglVertexBuffer),t.deleteBuffer(aA.__webglColorBuffer),ag.info.memory.geometries--}else{if(aA instanceof c.Line){aA=aA.geometry,t.deleteBuffer(aA.__webglVertexBuffer),t.deleteBuffer(aA.__webglColorBuffer),ag.info.memory.geometries--}else{if(aA instanceof c.ParticleSystem){aA=aA.geometry,t.deleteBuffer(aA.__webglVertexBuffer),t.deleteBuffer(aA.__webglColorBuffer),ag.info.memory.geometries--}}}}}};this.deallocateTexture=function(z){if(z.__webglInit){z.__webglInit=!1,t.deleteTexture(z.__webglTexture),ag.info.memory.textures--}};this.updateShadowMap=function(z,C){F(z,C)};this.render=function(aF,aG,aH,aJ){var C,z,aK,aA,aB=aF.lights,aC=aF.fog;m=-1;this.autoUpdateObjects&&this.initWebGLObjects(aF);aG.parent===void 0&&(console.warn("DEPRECATED: Camera hasn't been added to a Scene. Adding it..."),aF.add(aG));this.autoUpdateScene&&aF.updateMatrixWorld();this.shadowMapEnabled&&this.shadowMapAutoUpdate&&F(aF,aG);ag.info.render.calls=0;ag.info.render.vertices=0;ag.info.render.faces=0;aG.matrixWorldInverse.getInverse(aG.matrixWorld);aG.matrixWorldInverse.flattenToArray(f);aG.projectionMatrix.flattenToArray(A);W.multiply(aG.projectionMatrix,aG.matrixWorldInverse);w(W);ae(aH);(this.autoClear||aJ)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);aA=aF.__webglObjects;aJ=0;for(C=aA.length;aJ<C;aJ++){if(z=aA[aJ],aK=z.object,z.render=!1,aK.visible&&(!(aK instanceof c.Mesh)||!aK.frustumCulled||u(aK))){aK.matrixWorld.flattenToArray(aK._objectMatrixArray);av(aK,aG,!0);var aI=z,aD=aI.object,D=aI.buffer,aE=void 0,aE=aE=void 0,aE=aD.material;if(aE instanceof c.MeshFaceMaterial){if(aE=D.materialIndex,aE>=0){aE=aD.geometry.materials[aE],aE.transparent?(aI.transparent=aE,aI.opaque=null):(aI.opaque=aE,aI.transparent=null)}}else{if(aE){aE.transparent?(aI.transparent=aE,aI.opaque=null):(aI.opaque=aE,aI.transparent=null)}}z.render=!0;if(this.sortObjects){aK.renderDepth?z.z=aK.renderDepth:(k.copy(aK.position),W.multiplyVector3(k),z.z=k.z)}}}this.sortObjects&&aA.sort(E);aA=aF.__webglObjectsImmediate;aJ=0;for(C=aA.length;aJ<C;aJ++){if(z=aA[aJ],aK=z.object,aK.visible){aK.matrixAutoUpdate&&aK.matrixWorld.flattenToArray(aK._objectMatrixArray),av(aK,aG,!0),aK=z.object.material,aK.transparent?(z.transparent=aK,z.opaque=null):(z.opaque=aK,z.transparent=null)}}aF.overrideMaterial?(L(aF.overrideMaterial.blending),au(aF.overrideMaterial.depthTest),N(aF.overrideMaterial.depthWrite),O(aF.overrideMaterial.polygonOffset,aF.overrideMaterial.polygonOffsetFactor,aF.overrideMaterial.polygonOffsetUnits),y(aF.__webglObjects,!1,"",aG,aB,aC,!0,aF.overrideMaterial),H(aF.__webglObjectsImmediate,"",aG,aB,aC,!1,aF.overrideMaterial)):(L(c.NormalBlending),y(aF.__webglObjects,!0,"opaque",aG,aB,aC,!1),H(aF.__webglObjectsImmediate,"opaque",aG,aB,aC,!1),y(aF.__webglObjects,!1,"transparent",aG,aB,aC,!0),H(aF.__webglObjectsImmediate,"transparent",aG,aB,aC,!0));if(aF.__webglSprites.length){aK=ad.attributes;aB=ad.uniforms;aC=x/aa;aJ=[];C=aa*0.5;aA=x*0.5;z=!0;t.useProgram(ad.program);af=ad.program;j=ao=aw=-1;S||(t.enableVertexAttribArray(ad.attributes.position),t.enableVertexAttribArray(ad.attributes.uv),S=!0);t.disable(t.CULL_FACE);t.enable(t.BLEND);t.depthMask(!0);t.bindBuffer(t.ARRAY_BUFFER,ad.vertexBuffer);t.vertexAttribPointer(aK.position,2,t.FLOAT,!1,16,0);t.vertexAttribPointer(aK.uv,2,t.FLOAT,!1,16,8);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,ad.elementBuffer);t.uniformMatrix4fv(aB.projectionMatrix,!1,A);t.activeTexture(t.TEXTURE0);t.uniform1i(aB.map,0);aK=0;for(aI=aF.__webglSprites.length;aK<aI;aK++){if(aD=aF.__webglSprites[aK],aD.visible&&aD.opacity!==0){aD.useScreenCoordinates?aD.z=-aD.position.z:(aD._modelViewMatrix.multiplyToArray(aG.matrixWorldInverse,aD.matrixWorld,aD._modelViewMatrixArray),aD.z=-aD._modelViewMatrix.n34)}}aF.__webglSprites.sort(E);aK=0;for(aI=aF.__webglSprites.length;aK<aI;aK++){aD=aF.__webglSprites[aK],aD.visible&&aD.opacity!==0&&aD.map&&aD.map.image&&aD.map.image.width&&(aD.useScreenCoordinates?(t.uniform1i(aB.useScreenCoordinates,1),t.uniform3f(aB.screenPosition,(aD.position.x-C)/C,(aA-aD.position.y)/aA,Math.max(0,Math.min(1,aD.position.z)))):(t.uniform1i(aB.useScreenCoordinates,0),t.uniform1i(aB.affectedByDistance,aD.affectedByDistance?1:0),t.uniformMatrix4fv(aB.modelViewMatrix,!1,aD._modelViewMatrixArray)),aG=aD.map.image.width/(aD.scaleByViewport?x:1),aJ[0]=aG*aC*aD.scale.x,aJ[1]=aG*aD.scale.y,t.uniform2f(aB.uvScale,aD.uvScale.x,aD.uvScale.y),t.uniform2f(aB.uvOffset,aD.uvOffset.x,aD.uvOffset.y),t.uniform2f(aB.alignment,aD.alignment.x,aD.alignment.y),t.uniform1f(aB.opacity,aD.opacity),t.uniform3f(aB.color,aD.color.r,aD.color.g,aD.color.b),t.uniform1f(aB.rotation,aD.rotation),t.uniform2fv(aB.scale,aJ),aD.mergeWith3D&&!z?(t.enable(t.DEPTH_TEST),z=!0):!aD.mergeWith3D&&z&&(t.disable(t.DEPTH_TEST),z=!1),L(aD.blending),ax(aD.map,0),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0))}t.enable(t.CULL_FACE);t.enable(t.DEPTH_TEST);t.depthMask(Q)}aH&&aH.minFilter!==c.NearestFilter&&aH.minFilter!==c.LinearFilter&&(aH instanceof c.WebGLRenderTargetCube?(t.bindTexture(t.TEXTURE_CUBE_MAP,aH.__webglTexture),t.generateMipmap(t.TEXTURE_CUBE_MAP),t.bindTexture(t.TEXTURE_CUBE_MAP,null)):(t.bindTexture(t.TEXTURE_2D,aH.__webglTexture),t.generateMipmap(t.TEXTURE_2D),t.bindTexture(t.TEXTURE_2D,null)))};this.initWebGLObjects=function(bc){if(!bc.__webglObjects){bc.__webglObjects=[],bc.__webglObjectsImmediate=[],bc.__webglSprites=[]}for(;bc.__objectsAdded.length;){var bd=bc.__objectsAdded[0],a1=bc,a4=void 0,a3=void 0,a2=void 0;if(!bd.__webglInit){if(bd.__webglInit=!0,bd._modelViewMatrix=new c.Matrix4,bd._normalMatrixArray=new Float32Array(9),bd._modelViewMatrixArray=new Float32Array(16),bd._objectMatrixArray=new Float32Array(16),bd.matrixWorld.flattenToArray(bd._objectMatrixArray),bd instanceof c.Mesh){a3=bd.geometry;if(a3.geometryGroups===void 0){var a2=a3,a5=void 0,a6=void 0,bi=void 0,a8=void 0,ca=void 0,cm=void 0,a9=void 0,z={},bf=a2.morphTargets.length;a2.geometryGroups={};a5=0;for(a6=a2.faces.length;a5<a6;a5++){bi=a2.faces[a5],a8=bi.materialIndex,cm=a8!==void 0?a8:-1,z[cm]===void 0&&(z[cm]={hash:cm,counter:0}),a9=z[cm].hash+"_"+z[cm].counter,a2.geometryGroups[a9]===void 0&&(a2.geometryGroups[a9]={faces3:[],faces4:[],materialIndex:a8,vertices:0,numMorphTargets:bf}),ca=bi instanceof c.Face3?3:4,a2.geometryGroups[a9].vertices+ca>65535&&(z[cm].counter+=1,a9=z[cm].hash+"_"+z[cm].counter,a2.geometryGroups[a9]===void 0&&(a2.geometryGroups[a9]={faces3:[],faces4:[],materialIndex:a8,vertices:0,numMorphTargets:bf})),bi instanceof c.Face3?a2.geometryGroups[a9].faces3.push(a5):a2.geometryGroups[a9].faces4.push(a5),a2.geometryGroups[a9].vertices+=ca}a2.geometryGroupsList=[];a5=void 0;for(a5 in a2.geometryGroups){a2.geometryGroups[a5].id=ak++,a2.geometryGroupsList.push(a2.geometryGroups[a5])}}for(a4 in a3.geometryGroups){if(a2=a3.geometryGroups[a4],!a2.__webglVertexBuffer){a5=a2;a5.__webglVertexBuffer=t.createBuffer();a5.__webglNormalBuffer=t.createBuffer();a5.__webglTangentBuffer=t.createBuffer();a5.__webglColorBuffer=t.createBuffer();a5.__webglUVBuffer=t.createBuffer();a5.__webglUV2Buffer=t.createBuffer();a5.__webglSkinVertexABuffer=t.createBuffer();a5.__webglSkinVertexBBuffer=t.createBuffer();a5.__webglSkinIndicesBuffer=t.createBuffer();a5.__webglSkinWeightsBuffer=t.createBuffer();a5.__webglFaceBuffer=t.createBuffer();a5.__webglLineBuffer=t.createBuffer();if(a5.numMorphTargets){bi=a6=void 0;a5.__webglMorphTargetsBuffers=[];a6=0;for(bi=a5.numMorphTargets;a6<bi;a6++){a5.__webglMorphTargetsBuffers.push(t.createBuffer())}}ag.info.memory.geometries++;a8=bd;ca=a8.geometry;a6=a2.faces3;cm=a2.faces4;a5=a6.length*3+cm.length*4;bi=a6.length*1+cm.length*2;cm=a6.length*3+cm.length*4;a6=am(a8,a2);a9=ar(a6);z=ap(a6);bf=at(a6);a2.__vertexArray=new Float32Array(a5*3);if(z){a2.__normalArray=new Float32Array(a5*3)}if(ca.hasTangents){a2.__tangentArray=new Float32Array(a5*4)}if(bf){a2.__colorArray=new Float32Array(a5*3)}if(a9){if(ca.faceUvs.length>0||ca.faceVertexUvs.length>0){a2.__uvArray=new Float32Array(a5*2)}if(ca.faceUvs.length>1||ca.faceVertexUvs.length>1){a2.__uv2Array=new Float32Array(a5*2)}}if(a8.geometry.skinWeights.length&&a8.geometry.skinIndices.length){a2.__skinVertexAArray=new Float32Array(a5*4),a2.__skinVertexBArray=new Float32Array(a5*4),a2.__skinIndexArray=new Float32Array(a5*4),a2.__skinWeightArray=new Float32Array(a5*4)}a2.__faceArray=new Uint16Array(bi*3);a2.__lineArray=new Uint16Array(cm*2);if(a2.numMorphTargets){a2.__morphTargetsArrays=[];a8=0;for(ca=a2.numMorphTargets;a8<ca;a8++){a2.__morphTargetsArrays.push(new Float32Array(a5*3))}}a2.__webglFaceCount=bi*3;a2.__webglLineCount=cm*2;if(a6.attributes){if(a2.__webglCustomAttributesList===void 0){a2.__webglCustomAttributesList=[]}bi=void 0;for(bi in a6.attributes){var a8=a6.attributes[bi],ca={},co;for(co in a8){ca[co]=a8[co]}if(!ca.__webglInitialized||ca.createUniqueBuffers){ca.__webglInitialized=!0,cm=1,ca.type==="v2"?cm=2:ca.type==="v3"?cm=3:ca.type==="v4"?cm=4:ca.type==="c"&&(cm=3),ca.size=cm,ca.array=new Float32Array(a5*cm),ca.buffer=t.createBuffer(),ca.buffer.belongsToAttribute=bi,a8.needsUpdate=!0,ca.__original=a8}a2.__webglCustomAttributesList.push(ca)}}a2.__inittedArrays=!0;a3.__dirtyVertices=!0;a3.__dirtyMorphTargets=!0;a3.__dirtyElements=!0;a3.__dirtyUvs=!0;a3.__dirtyNormals=!0;a3.__dirtyTangents=!0;a3.__dirtyColors=!0}}}else{if(bd instanceof c.Ribbon){if(a3=bd.geometry,!a3.__webglVertexBuffer){a2=a3,a2.__webglVertexBuffer=t.createBuffer(),a2.__webglColorBuffer=t.createBuffer(),ag.info.memory.geometries++,a2=a3,a5=a2.vertices.length,a2.__vertexArray=new Float32Array(a5*3),a2.__colorArray=new Float32Array(a5*3),a2.__webglVertexCount=a5,a3.__dirtyVertices=!0,a3.__dirtyColors=!0}}else{if(bd instanceof c.Line){if(a3=bd.geometry,!a3.__webglVertexBuffer){a2=a3,a2.__webglVertexBuffer=t.createBuffer(),a2.__webglColorBuffer=t.createBuffer(),ag.info.memory.geometries++,a2=a3,a5=bd,a6=a2.vertices.length,a2.__vertexArray=new Float32Array(a6*3),a2.__colorArray=new Float32Array(a6*3),a2.__webglLineCount=a6,an(a2,a5),a3.__dirtyVertices=!0,a3.__dirtyColors=!0}}else{if(bd instanceof c.ParticleSystem&&(a3=bd.geometry,!a3.__webglVertexBuffer)){a2=a3,a2.__webglVertexBuffer=t.createBuffer(),a2.__webglColorBuffer=t.createBuffer(),ag.info.geometries++,a2=a3,a5=bd,a6=a2.vertices.length,a2.__vertexArray=new Float32Array(a6*3),a2.__colorArray=new Float32Array(a6*3),a2.__sortArray=[],a2.__webglParticleCount=a6,an(a2,a5),a3.__dirtyVertices=!0,a3.__dirtyColors=!0}}}}}if(!bd.__webglActive){if(bd instanceof c.Mesh){for(a4 in a3=bd.geometry,a3.geometryGroups){a2=a3.geometryGroups[a4],B(a1.__webglObjects,a2,bd)}}else{bd instanceof c.Ribbon||bd instanceof c.Line||bd instanceof c.ParticleSystem?(a3=bd.geometry,B(a1.__webglObjects,a3,bd)):c.MarchingCubes!==void 0&&bd instanceof c.MarchingCubes||bd.immediateRenderCallback?a1.__webglObjectsImmediate.push({object:bd,opaque:null,transparent:null}):bd instanceof c.Sprite&&a1.__webglSprites.push(bd)}bd.__webglActive=!0}bc.__objectsAdded.splice(0,1)}for(;bc.__objectsRemoved.length;){bd=bc.__objectsRemoved[0];a1=bc;if(bd instanceof c.Mesh||bd instanceof c.ParticleSystem||bd instanceof c.Ribbon||bd instanceof c.Line){M(a1.__webglObjects,bd)}else{if(bd instanceof c.Sprite){a1=a1.__webglSprites;a4=bd;for(a3=a1.length-1;a3>=0;a3--){a1[a3]===a4&&a1.splice(a3,1)}}else{(bd instanceof c.MarchingCubes||bd.immediateRenderCallback)&&M(a1.__webglObjectsImmediate,bd)}}bd.__webglActive=!1;bc.__objectsRemoved.splice(0,1)}bd=0;for(a1=bc.__webglObjects.length;bd<a1;bd++){if(co=bc.__webglObjects[bd].object,a4=co.geometry,a3=bi=a6=void 0,co instanceof c.Mesh){a2=0;for(a5=a4.geometryGroupsList.length;a2<a5;a2++){if(a6=a4.geometryGroupsList[a2],a3=am(co,a6),bi=a3.attributes&&G(a3),a4.__dirtyVertices||a4.__dirtyMorphTargets||a4.__dirtyElements||a4.__dirtyUvs||a4.__dirtyNormals||a4.__dirtyColors||a4.__dirtyTangents||bi){var aX=co,bi=t.DYNAMIC_DRAW,a8=!a4.dynamic,a9=a3;if(a6.__inittedArrays){var ca=ap(a9),cm=at(a9),aR=ar(a9),cg=ca===c.SmoothShading,bk=z=a9=void 0,aW=void 0,aZ=void 0,be=void 0,D=void 0,aQ=void 0,cn=void 0,aY=bk=void 0,aD=void 0,aB=void 0,bl=void 0,a0=aW=void 0,bZ=void 0,ch=void 0,aG=aW=cn=void 0,bg=void 0,cj=bl=aB=aD=D=void 0,bh=aW=bl=aB=aD=cj=bl=aB=aD=cj=bl=aB=aD=void 0,bm=void 0,aC=be=void 0,C=void 0,bY=void 0,aN=void 0,aP=void 0,bb=aY=bY=bm=0,aO=0,aL=bh=bk=0,ck=D=a0=0,aS=0,aF=void 0,ck=a6.__vertexArray,C=a6.__uvArray,aS=a6.__uv2Array,aC=a6.__normalArray,aZ=a6.__tangentArray,bZ=a6.__colorArray,aG=a6.__skinVertexAArray,bg=a6.__skinVertexBArray,aQ=a6.__skinIndexArray,aH=a6.__skinWeightArray,cj=a6.__morphTargetsArrays,bf=a6.__webglCustomAttributesList,aE=void 0,aE=a6.__faceArray,aF=a6.__lineArray,ch=aX.geometry,a7=ch.__dirtyElements,ci=ch.__dirtyUvs,be=ch.__dirtyNormals,cn=ch.__dirtyTangents,ba=ch.__dirtyColors,aN=ch.__dirtyMorphTargets,aP=ch.vertices,aX=a6.faces3,aM=a6.faces4,cl=ch.faces,bj=ch.faceVertexUvs[0],aK=ch.faceVertexUvs[1],aJ=ch.skinVerticesA,ce=ch.skinVerticesB,aA=ch.skinIndices,cf=ch.skinWeights,aI=ch.morphTargets;if(ch.__dirtyVertices){a9=0;for(z=aX.length;a9<z;a9++){aW=cl[aX[a9]],aD=aP[aW.a].position,aB=aP[aW.b].position,bl=aP[aW.c].position,ck[bY]=aD.x,ck[bY+1]=aD.y,ck[bY+2]=aD.z,ck[bY+3]=aB.x,ck[bY+4]=aB.y,ck[bY+5]=aB.z,ck[bY+6]=bl.x,ck[bY+7]=bl.y,ck[bY+8]=bl.z,bY+=9}a9=0;for(z=aM.length;a9<z;a9++){aW=cl[aM[a9]],aD=aP[aW.a].position,aB=aP[aW.b].position,bl=aP[aW.c].position,aW=aP[aW.d].position,ck[bY]=aD.x,ck[bY+1]=aD.y,ck[bY+2]=aD.z,ck[bY+3]=aB.x,ck[bY+4]=aB.y,ck[bY+5]=aB.z,ck[bY+6]=bl.x,ck[bY+7]=bl.y,ck[bY+8]=bl.z,ck[bY+9]=aW.x,ck[bY+10]=aW.y,ck[bY+11]=aW.z,bY+=12}t.bindBuffer(t.ARRAY_BUFFER,a6.__webglVertexBuffer);t.bufferData(t.ARRAY_BUFFER,ck,bi)}if(aN){bY=0;for(aN=aI.length;bY<aN;bY++){a9=ck=0;for(z=aX.length;a9<z;a9++){aW=cl[aX[a9]],aD=aI[bY].vertices[aW.a].position,aB=aI[bY].vertices[aW.b].position,bl=aI[bY].vertices[aW.c].position,aP=cj[bY],aP[ck]=aD.x,aP[ck+1]=aD.y,aP[ck+2]=aD.z,aP[ck+3]=aB.x,aP[ck+4]=aB.y,aP[ck+5]=aB.z,aP[ck+6]=bl.x,aP[ck+7]=bl.y,aP[ck+8]=bl.z,ck+=9}a9=0;for(z=aM.length;a9<z;a9++){aW=cl[aM[a9]],aD=aI[bY].vertices[aW.a].position,aB=aI[bY].vertices[aW.b].position,bl=aI[bY].vertices[aW.c].position,aW=aI[bY].vertices[aW.d].position,aP=cj[bY],aP[ck]=aD.x,aP[ck+1]=aD.y,aP[ck+2]=aD.z,aP[ck+3]=aB.x,aP[ck+4]=aB.y,aP[ck+5]=aB.z,aP[ck+6]=bl.x,aP[ck+7]=bl.y,aP[ck+8]=bl.z,aP[ck+9]=aW.x,aP[ck+10]=aW.y,aP[ck+11]=aW.z,ck+=12}t.bindBuffer(t.ARRAY_BUFFER,a6.__webglMorphTargetsBuffers[bY]);t.bufferData(t.ARRAY_BUFFER,cj[bY],bi)}}if(cf.length){a9=0;for(z=aX.length;a9<z;a9++){aW=cl[aX[a9]],aD=cf[aW.a],aB=cf[aW.b],bl=cf[aW.c],aH[D]=aD.x,aH[D+1]=aD.y,aH[D+2]=aD.z,aH[D+3]=aD.w,aH[D+4]=aB.x,aH[D+5]=aB.y,aH[D+6]=aB.z,aH[D+7]=aB.w,aH[D+8]=bl.x,aH[D+9]=bl.y,aH[D+10]=bl.z,aH[D+11]=bl.w,aD=aA[aW.a],aB=aA[aW.b],bl=aA[aW.c],aQ[D]=aD.x,aQ[D+1]=aD.y,aQ[D+2]=aD.z,aQ[D+3]=aD.w,aQ[D+4]=aB.x,aQ[D+5]=aB.y,aQ[D+6]=aB.z,aQ[D+7]=aB.w,aQ[D+8]=bl.x,aQ[D+9]=bl.y,aQ[D+10]=bl.z,aQ[D+11]=bl.w,aD=aJ[aW.a],aB=aJ[aW.b],bl=aJ[aW.c],aG[D]=aD.x,aG[D+1]=aD.y,aG[D+2]=aD.z,aG[D+3]=1,aG[D+4]=aB.x,aG[D+5]=aB.y,aG[D+6]=aB.z,aG[D+7]=1,aG[D+8]=bl.x,aG[D+9]=bl.y,aG[D+10]=bl.z,aG[D+11]=1,aD=ce[aW.a],aB=ce[aW.b],bl=ce[aW.c],bg[D]=aD.x,bg[D+1]=aD.y,bg[D+2]=aD.z,bg[D+3]=1,bg[D+4]=aB.x,bg[D+5]=aB.y,bg[D+6]=aB.z,bg[D+7]=1,bg[D+8]=bl.x,bg[D+9]=bl.y,bg[D+10]=bl.z,bg[D+11]=1,D+=12}a9=0;for(z=aM.length;a9<z;a9++){aW=cl[aM[a9]],aD=cf[aW.a],aB=cf[aW.b],bl=cf[aW.c],cj=cf[aW.d],aH[D]=aD.x,aH[D+1]=aD.y,aH[D+2]=aD.z,aH[D+3]=aD.w,aH[D+4]=aB.x,aH[D+5]=aB.y,aH[D+6]=aB.z,aH[D+7]=aB.w,aH[D+8]=bl.x,aH[D+9]=bl.y,aH[D+10]=bl.z,aH[D+11]=bl.w,aH[D+12]=cj.x,aH[D+13]=cj.y,aH[D+14]=cj.z,aH[D+15]=cj.w,aD=aA[aW.a],aB=aA[aW.b],bl=aA[aW.c],cj=aA[aW.d],aQ[D]=aD.x,aQ[D+1]=aD.y,aQ[D+2]=aD.z,aQ[D+3]=aD.w,aQ[D+4]=aB.x,aQ[D+5]=aB.y,aQ[D+6]=aB.z,aQ[D+7]=aB.w,aQ[D+8]=bl.x,aQ[D+9]=bl.y,aQ[D+10]=bl.z,aQ[D+11]=bl.w,aQ[D+12]=cj.x,aQ[D+13]=cj.y,aQ[D+14]=cj.z,aQ[D+15]=cj.w,aD=aJ[aW.a],aB=aJ[aW.b],bl=aJ[aW.c],cj=aJ[aW.d],aG[D]=aD.x,aG[D+1]=aD.y,aG[D+2]=aD.z,aG[D+3]=1,aG[D+4]=aB.x,aG[D+5]=aB.y,aG[D+6]=aB.z,aG[D+7]=1,aG[D+8]=bl.x,aG[D+9]=bl.y,aG[D+10]=bl.z,aG[D+11]=1,aG[D+12]=cj.x,aG[D+13]=cj.y,aG[D+14]=cj.z,aG[D+15]=1,aD=ce[aW.a],aB=ce[aW.b],bl=ce[aW.c],aW=ce[aW.d],bg[D]=aD.x,bg[D+1]=aD.y,bg[D+2]=aD.z,bg[D+3]=1,bg[D+4]=aB.x,bg[D+5]=aB.y,bg[D+6]=aB.z,bg[D+7]=1,bg[D+8]=bl.x,bg[D+9]=bl.y,bg[D+10]=bl.z,bg[D+11]=1,bg[D+12]=aW.x,bg[D+13]=aW.y,bg[D+14]=aW.z,bg[D+15]=1,D+=16}D>0&&(t.bindBuffer(t.ARRAY_BUFFER,a6.__webglSkinVertexABuffer),t.bufferData(t.ARRAY_BUFFER,aG,bi),t.bindBuffer(t.ARRAY_BUFFER,a6.__webglSkinVertexBBuffer),t.bufferData(t.ARRAY_BUFFER,bg,bi),t.bindBuffer(t.ARRAY_BUFFER,a6.__webglSkinIndicesBuffer),t.bufferData(t.ARRAY_BUFFER,aQ,bi),t.bindBuffer(t.ARRAY_BUFFER,a6.__webglSkinWeightsBuffer),t.bufferData(t.ARRAY_BUFFER,aH,bi))}if(ba&&cm){a9=0;for(z=aX.length;a9<z;a9++){aW=cl[aX[a9]],D=aW.vertexColors,aQ=aW.color,D.length===3&&cm===c.VertexColors?(aW=D[0],aG=D[1],bg=D[2]):bg=aG=aW=aQ,bZ[a0]=aW.r,bZ[a0+1]=aW.g,bZ[a0+2]=aW.b,bZ[a0+3]=aG.r,bZ[a0+4]=aG.g,bZ[a0+5]=aG.b,bZ[a0+6]=bg.r,bZ[a0+7]=bg.g,bZ[a0+8]=bg.b,a0+=9}a9=0;for(z=aM.length;a9<z;a9++){aW=cl[aM[a9]],D=aW.vertexColors,aQ=aW.color,D.length===4&&cm===c.VertexColors?(aW=D[0],aG=D[1],bg=D[2],D=D[3]):D=bg=aG=aW=aQ,bZ[a0]=aW.r,bZ[a0+1]=aW.g,bZ[a0+2]=aW.b,bZ[a0+3]=aG.r,bZ[a0+4]=aG.g,bZ[a0+5]=aG.b,bZ[a0+6]=bg.r,bZ[a0+7]=bg.g,bZ[a0+8]=bg.b,bZ[a0+9]=D.r,bZ[a0+10]=D.g,bZ[a0+11]=D.b,a0+=12}a0>0&&(t.bindBuffer(t.ARRAY_BUFFER,a6.__webglColorBuffer),t.bufferData(t.ARRAY_BUFFER,bZ,bi))}if(cn&&ch.hasTangents){a9=0;for(z=aX.length;a9<z;a9++){aW=cl[aX[a9]],cn=aW.vertexTangents,a0=cn[0],bZ=cn[1],ch=cn[2],aZ[bh]=a0.x,aZ[bh+1]=a0.y,aZ[bh+2]=a0.z,aZ[bh+3]=a0.w,aZ[bh+4]=bZ.x,aZ[bh+5]=bZ.y,aZ[bh+6]=bZ.z,aZ[bh+7]=bZ.w,aZ[bh+8]=ch.x,aZ[bh+9]=ch.y,aZ[bh+10]=ch.z,aZ[bh+11]=ch.w,bh+=12}a9=0;for(z=aM.length;a9<z;a9++){aW=cl[aM[a9]],cn=aW.vertexTangents,a0=cn[0],bZ=cn[1],ch=cn[2],cn=cn[3],aZ[bh]=a0.x,aZ[bh+1]=a0.y,aZ[bh+2]=a0.z,aZ[bh+3]=a0.w,aZ[bh+4]=bZ.x,aZ[bh+5]=bZ.y,aZ[bh+6]=bZ.z,aZ[bh+7]=bZ.w,aZ[bh+8]=ch.x,aZ[bh+9]=ch.y,aZ[bh+10]=ch.z,aZ[bh+11]=ch.w,aZ[bh+12]=cn.x,aZ[bh+13]=cn.y,aZ[bh+14]=cn.z,aZ[bh+15]=cn.w,bh+=16}t.bindBuffer(t.ARRAY_BUFFER,a6.__webglTangentBuffer);t.bufferData(t.ARRAY_BUFFER,aZ,bi)}if(be&&ca){a9=0;for(z=aX.length;a9<z;a9++){if(aW=cl[aX[a9]],aZ=aW.vertexNormals,be=aW.normal,aZ.length===3&&cg){for(bh=0;bh<3;bh++){be=aZ[bh],aC[bk]=be.x,aC[bk+1]=be.y,aC[bk+2]=be.z,bk+=3}}else{for(bh=0;bh<3;bh++){aC[bk]=be.x,aC[bk+1]=be.y,aC[bk+2]=be.z,bk+=3}}}a9=0;for(z=aM.length;a9<z;a9++){if(aW=cl[aM[a9]],aZ=aW.vertexNormals,be=aW.normal,aZ.length===4&&cg){for(bh=0;bh<4;bh++){be=aZ[bh],aC[bk]=be.x,aC[bk+1]=be.y,aC[bk+2]=be.z,bk+=3}}else{for(bh=0;bh<4;bh++){aC[bk]=be.x,aC[bk+1]=be.y,aC[bk+2]=be.z,bk+=3}}}t.bindBuffer(t.ARRAY_BUFFER,a6.__webglNormalBuffer);t.bufferData(t.ARRAY_BUFFER,aC,bi)}if(ci&&bj&&aR){a9=0;for(z=aX.length;a9<z;a9++){if(bk=aX[a9],bk=bj[bk],bk!==void 0){for(bh=0;bh<3;bh++){aC=bk[bh],C[aY]=aC.u,C[aY+1]=aC.v,aY+=2}}}a9=0;for(z=aM.length;a9<z;a9++){if(bk=aM[a9],bk=bj[bk],bk!==void 0){for(bh=0;bh<4;bh++){aC=bk[bh],C[aY]=aC.u,C[aY+1]=aC.v,aY+=2}}}aY>0&&(t.bindBuffer(t.ARRAY_BUFFER,a6.__webglUVBuffer),t.bufferData(t.ARRAY_BUFFER,C,bi))}if(ci&&aK&&aR){a9=0;for(z=aX.length;a9<z;a9++){if(bk=aX[a9],aY=aK[bk],aY!==void 0){for(bh=0;bh<3;bh++){C=aY[bh],aS[bb]=C.u,aS[bb+1]=C.v,bb+=2}}}a9=0;for(z=aM.length;a9<z;a9++){if(bk=aM[a9],aY=aK[bk],aY!==void 0){for(bh=0;bh<4;bh++){C=aY[bh],aS[bb]=C.u,aS[bb+1]=C.v,bb+=2}}}bb>0&&(t.bindBuffer(t.ARRAY_BUFFER,a6.__webglUV2Buffer),t.bufferData(t.ARRAY_BUFFER,aS,bi))}if(a7){a9=0;for(z=aX.length;a9<z;a9++){aE[aO]=bm,aE[aO+1]=bm+1,aE[aO+2]=bm+2,aO+=3,aF[aL]=bm,aF[aL+1]=bm+1,aF[aL+2]=bm,aF[aL+3]=bm+2,aF[aL+4]=bm+1,aF[aL+5]=bm+2,aL+=6,bm+=3}a9=0;for(z=aM.length;a9<z;a9++){aE[aO]=bm,aE[aO+1]=bm+1,aE[aO+2]=bm+3,aE[aO+3]=bm+1,aE[aO+4]=bm+2,aE[aO+5]=bm+3,aO+=6,aF[aL]=bm,aF[aL+1]=bm+1,aF[aL+2]=bm,aF[aL+3]=bm+3,aF[aL+4]=bm+1,aF[aL+5]=bm+2,aF[aL+6]=bm+2,aF[aL+7]=bm+3,aL+=8,bm+=4}t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,a6.__webglFaceBuffer);t.bufferData(t.ELEMENT_ARRAY_BUFFER,aE,bi);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,a6.__webglLineBuffer);t.bufferData(t.ELEMENT_ARRAY_BUFFER,aF,bi)}if(bf){bh=0;for(bm=bf.length;bh<bm;bh++){if(aE=bf[bh],aE.__original.needsUpdate){aS=0;if(aE.size===1){if(aE.boundTo===void 0||aE.boundTo==="vertices"){a9=0;for(z=aX.length;a9<z;a9++){aW=cl[aX[a9]],aE.array[aS]=aE.value[aW.a],aE.array[aS+1]=aE.value[aW.b],aE.array[aS+2]=aE.value[aW.c],aS+=3}a9=0;for(z=aM.length;a9<z;a9++){aW=cl[aM[a9]],aE.array[aS]=aE.value[aW.a],aE.array[aS+1]=aE.value[aW.b],aE.array[aS+2]=aE.value[aW.c],aE.array[aS+3]=aE.value[aW.d],aS+=4}}else{if(aE.boundTo==="faces"){a9=0;for(z=aX.length;a9<z;a9++){aF=aE.value[aX[a9]],aE.array[aS]=aF,aE.array[aS+1]=aF,aE.array[aS+2]=aF,aS+=3}a9=0;for(z=aM.length;a9<z;a9++){aF=aE.value[aM[a9]],aE.array[aS]=aF,aE.array[aS+1]=aF,aE.array[aS+2]=aF,aE.array[aS+3]=aF,aS+=4}}}}else{if(aE.size===2){if(aE.boundTo===void 0||aE.boundTo==="vertices"){a9=0;for(z=aX.length;a9<z;a9++){aW=cl[aX[a9]],aD=aE.value[aW.a],aB=aE.value[aW.b],bl=aE.value[aW.c],aE.array[aS]=aD.x,aE.array[aS+1]=aD.y,aE.array[aS+2]=aB.x,aE.array[aS+3]=aB.y,aE.array[aS+4]=bl.x,aE.array[aS+5]=bl.y,aS+=6}a9=0;for(z=aM.length;a9<z;a9++){aW=cl[aM[a9]],aD=aE.value[aW.a],aB=aE.value[aW.b],bl=aE.value[aW.c],aW=aE.value[aW.d],aE.array[aS]=aD.x,aE.array[aS+1]=aD.y,aE.array[aS+2]=aB.x,aE.array[aS+3]=aB.y,aE.array[aS+4]=bl.x,aE.array[aS+5]=bl.y,aE.array[aS+6]=aW.x,aE.array[aS+7]=aW.y,aS+=8}}else{if(aE.boundTo==="faces"){a9=0;for(z=aX.length;a9<z;a9++){bl=aB=aD=aF=aE.value[aX[a9]],aE.array[aS]=aD.x,aE.array[aS+1]=aD.y,aE.array[aS+2]=aB.x,aE.array[aS+3]=aB.y,aE.array[aS+4]=bl.x,aE.array[aS+5]=bl.y,aS+=6}a9=0;for(z=aM.length;a9<z;a9++){aW=bl=aB=aD=aF=aE.value[aM[a9]],aE.array[aS]=aD.x,aE.array[aS+1]=aD.y,aE.array[aS+2]=aB.x,aE.array[aS+3]=aB.y,aE.array[aS+4]=bl.x,aE.array[aS+5]=bl.y,aE.array[aS+6]=aW.x,aE.array[aS+7]=aW.y,aS+=8}}}}else{if(aE.size===3){if(ca=aE.type==="c"?["r","g","b"]:["x","y","z"],aE.boundTo===void 0||aE.boundTo==="vertices"){a9=0;for(z=aX.length;a9<z;a9++){aW=cl[aX[a9]],aD=aE.value[aW.a],aB=aE.value[aW.b],bl=aE.value[aW.c],aE.array[aS]=aD[ca[0]],aE.array[aS+1]=aD[ca[1]],aE.array[aS+2]=aD[ca[2]],aE.array[aS+3]=aB[ca[0]],aE.array[aS+4]=aB[ca[1]],aE.array[aS+5]=aB[ca[2]],aE.array[aS+6]=bl[ca[0]],aE.array[aS+7]=bl[ca[1]],aE.array[aS+8]=bl[ca[2]],aS+=9}a9=0;for(z=aM.length;a9<z;a9++){aW=cl[aM[a9]],aD=aE.value[aW.a],aB=aE.value[aW.b],bl=aE.value[aW.c],aW=aE.value[aW.d],aE.array[aS]=aD[ca[0]],aE.array[aS+1]=aD[ca[1]],aE.array[aS+2]=aD[ca[2]],aE.array[aS+3]=aB[ca[0]],aE.array[aS+4]=aB[ca[1]],aE.array[aS+5]=aB[ca[2]],aE.array[aS+6]=bl[ca[0]],aE.array[aS+7]=bl[ca[1]],aE.array[aS+8]=bl[ca[2]],aE.array[aS+9]=aW[ca[0]],aE.array[aS+10]=aW[ca[1]],aE.array[aS+11]=aW[ca[2]],aS+=12}}else{if(aE.boundTo==="faces"){a9=0;for(z=aX.length;a9<z;a9++){bl=aB=aD=aF=aE.value[aX[a9]],aE.array[aS]=aD[ca[0]],aE.array[aS+1]=aD[ca[1]],aE.array[aS+2]=aD[ca[2]],aE.array[aS+3]=aB[ca[0]],aE.array[aS+4]=aB[ca[1]],aE.array[aS+5]=aB[ca[2]],aE.array[aS+6]=bl[ca[0]],aE.array[aS+7]=bl[ca[1]],aE.array[aS+8]=bl[ca[2]],aS+=9}a9=0;for(z=aM.length;a9<z;a9++){aW=bl=aB=aD=aF=aE.value[aM[a9]],aE.array[aS]=aD[ca[0]],aE.array[aS+1]=aD[ca[1]],aE.array[aS+2]=aD[ca[2]],aE.array[aS+3]=aB[ca[0]],aE.array[aS+4]=aB[ca[1]],aE.array[aS+5]=aB[ca[2]],aE.array[aS+6]=bl[ca[0]],aE.array[aS+7]=bl[ca[1]],aE.array[aS+8]=bl[ca[2]],aE.array[aS+9]=aW[ca[0]],aE.array[aS+10]=aW[ca[1]],aE.array[aS+11]=aW[ca[2]],aS+=12}}}}else{if(aE.size===4){if(aE.boundTo===void 0||aE.boundTo==="vertices"){a9=0;for(z=aX.length;a9<z;a9++){aW=cl[aX[a9]],aD=aE.value[aW.a],aB=aE.value[aW.b],bl=aE.value[aW.c],aE.array[aS]=aD.x,aE.array[aS+1]=aD.y,aE.array[aS+2]=aD.z,aE.array[aS+3]=aD.w,aE.array[aS+4]=aB.x,aE.array[aS+5]=aB.y,aE.array[aS+6]=aB.z,aE.array[aS+7]=aB.w,aE.array[aS+8]=bl.x,aE.array[aS+9]=bl.y,aE.array[aS+10]=bl.z,aE.array[aS+11]=bl.w,aS+=12}a9=0;for(z=aM.length;a9<z;a9++){aW=cl[aM[a9]],aD=aE.value[aW.a],aB=aE.value[aW.b],bl=aE.value[aW.c],aW=aE.value[aW.d],aE.array[aS]=aD.x,aE.array[aS+1]=aD.y,aE.array[aS+2]=aD.z,aE.array[aS+3]=aD.w,aE.array[aS+4]=aB.x,aE.array[aS+5]=aB.y,aE.array[aS+6]=aB.z,aE.array[aS+7]=aB.w,aE.array[aS+8]=bl.x,aE.array[aS+9]=bl.y,aE.array[aS+10]=bl.z,aE.array[aS+11]=bl.w,aE.array[aS+12]=aW.x,aE.array[aS+13]=aW.y,aE.array[aS+14]=aW.z,aE.array[aS+15]=aW.w,aS+=16}}else{if(aE.boundTo==="faces"){a9=0;for(z=aX.length;a9<z;a9++){bl=aB=aD=aF=aE.value[aX[a9]],aE.array[aS]=aD.x,aE.array[aS+1]=aD.y,aE.array[aS+2]=aD.z,aE.array[aS+3]=aD.w,aE.array[aS+4]=aB.x,aE.array[aS+5]=aB.y,aE.array[aS+6]=aB.z,aE.array[aS+7]=aB.w,aE.array[aS+8]=bl.x,aE.array[aS+9]=bl.y,aE.array[aS+10]=bl.z,aE.array[aS+11]=bl.w,aS+=12}a9=0;for(z=aM.length;a9<z;a9++){aW=bl=aB=aD=aF=aE.value[aM[a9]],aE.array[aS]=aD.x,aE.array[aS+1]=aD.y,aE.array[aS+2]=aD.z,aE.array[aS+3]=aD.w,aE.array[aS+4]=aB.x,aE.array[aS+5]=aB.y,aE.array[aS+6]=aB.z,aE.array[aS+7]=aB.w,aE.array[aS+8]=bl.x,aE.array[aS+9]=bl.y,aE.array[aS+10]=bl.z,aE.array[aS+11]=bl.w,aE.array[aS+12]=aW.x,aE.array[aS+13]=aW.y,aE.array[aS+14]=aW.z,aE.array[aS+15]=aW.w,aS+=16}}}}}}}t.bindBuffer(t.ARRAY_BUFFER,aE.buffer);t.bufferData(t.ARRAY_BUFFER,aE.array,bi)}}}a8&&(delete a6.__inittedArrays,delete a6.__colorArray,delete a6.__normalArray,delete a6.__tangentArray,delete a6.__uvArray,delete a6.__uv2Array,delete a6.__faceArray,delete a6.__vertexArray,delete a6.__lineArray,delete a6.__skinVertexAArray,delete a6.__skinVertexBArray,delete a6.__skinIndexArray,delete a6.__skinWeightArray)}}}a4.__dirtyVertices=!1;a4.__dirtyMorphTargets=!1;a4.__dirtyElements=!1;a4.__dirtyUvs=!1;a4.__dirtyNormals=!1;a4.__dirtyColors=!1;a4.__dirtyTangents=!1;a3.attributes&&J(a3)}else{if(co instanceof c.Ribbon){if(a4.__dirtyVertices||a4.__dirtyColors){a3=a4;co=t.DYNAMIC_DRAW;ca=a2=ca=a8=a8=void 0;cm=a3.vertices;a5=a3.colors;a9=cm.length;a6=a5.length;z=a3.__vertexArray;bi=a3.__colorArray;bf=a3.__dirtyColors;if(a3.__dirtyVertices){for(a8=0;a8<a9;a8++){ca=cm[a8].position,a2=a8*3,z[a2]=ca.x,z[a2+1]=ca.y,z[a2+2]=ca.z}t.bindBuffer(t.ARRAY_BUFFER,a3.__webglVertexBuffer);t.bufferData(t.ARRAY_BUFFER,z,co)}if(bf){for(a8=0;a8<a6;a8++){ca=a5[a8],a2=a8*3,bi[a2]=ca.r,bi[a2+1]=ca.g,bi[a2+2]=ca.b}t.bindBuffer(t.ARRAY_BUFFER,a3.__webglColorBuffer);t.bufferData(t.ARRAY_BUFFER,bi,co)}}a4.__dirtyVertices=!1;a4.__dirtyColors=!1}else{if(co instanceof c.Line){a3=am(co,a6);bi=a3.attributes&&G(a3);if(a4.__dirtyVertices||a4.__dirtyColors||bi){co=a4;a2=t.DYNAMIC_DRAW;a9=a5=cg=cm=aR=void 0;cm=co.vertices;a6=co.colors;a9=cm.length;bi=a6.length;z=co.__vertexArray;a8=co.__colorArray;bf=co.__dirtyColors;ca=co.__webglCustomAttributesList;bm=cl=aM=aX=cg=aR=void 0;if(co.__dirtyVertices){for(aR=0;aR<a9;aR++){cg=cm[aR].position,a5=aR*3,z[a5]=cg.x,z[a5+1]=cg.y,z[a5+2]=cg.z}t.bindBuffer(t.ARRAY_BUFFER,co.__webglVertexBuffer);t.bufferData(t.ARRAY_BUFFER,z,a2)}if(bf){for(cm=0;cm<bi;cm++){a9=a6[cm],a5=cm*3,a8[a5]=a9.r,a8[a5+1]=a9.g,a8[a5+2]=a9.b}t.bindBuffer(t.ARRAY_BUFFER,co.__webglColorBuffer);t.bufferData(t.ARRAY_BUFFER,a8,a2)}if(ca){aR=0;for(cg=ca.length;aR<cg;aR++){if(bm=ca[aR],bm.needsUpdate&&(bm.boundTo===void 0||bm.boundTo==="vertices")){a5=0;aM=bm.value.length;if(bm.size===1){for(aX=0;aX<aM;aX++){bm.array[aX]=bm.value[aX]}}else{if(bm.size===2){for(aX=0;aX<aM;aX++){cl=bm.value[aX],bm.array[a5]=cl.x,bm.array[a5+1]=cl.y,a5+=2}}else{if(bm.size===3){if(bm.type==="c"){for(aX=0;aX<aM;aX++){cl=bm.value[aX],bm.array[a5]=cl.r,bm.array[a5+1]=cl.g,bm.array[a5+2]=cl.b,a5+=3}}else{for(aX=0;aX<aM;aX++){cl=bm.value[aX],bm.array[a5]=cl.x,bm.array[a5+1]=cl.y,bm.array[a5+2]=cl.z,a5+=3}}}else{if(bm.size===4){for(aX=0;aX<aM;aX++){cl=bm.value[aX],bm.array[a5]=cl.x,bm.array[a5+1]=cl.y,bm.array[a5+2]=cl.z,bm.array[a5+3]=cl.w,a5+=4}}}}}t.bindBuffer(t.ARRAY_BUFFER,bm.buffer);t.bufferData(t.ARRAY_BUFFER,bm.array,a2)}}}}a4.__dirtyVertices=!1;a4.__dirtyColors=!1;a3.attributes&&J(a3)}else{if(co instanceof c.ParticleSystem){a3=am(co,a6),bi=a3.attributes&&G(a3),(a4.__dirtyVertices||a4.__dirtyColors||co.sortParticles||bi)&&aq(a4,t.DYNAMIC_DRAW,co),a4.__dirtyVertices=!1,a4.__dirtyColors=!1,a3.attributes&&J(a3)}}}}}};this.initMaterial=function(aG,aI,aK,D){var aD,aA,aC,aE;aG instanceof c.MeshDepthMaterial?aE="depth":aG instanceof c.MeshNormalMaterial?aE="normal":aG instanceof c.MeshBasicMaterial?aE="basic":aG instanceof c.MeshLambertMaterial?aE="lambert":aG instanceof c.MeshPhongMaterial?aE="phong":aG instanceof c.LineBasicMaterial?aE="basic":aG instanceof c.ParticleBasicMaterial&&(aE="particle_basic");if(aE){var aF=c.ShaderLib[aE];aG.uniforms=c.UniformsUtils.clone(aF.uniforms);aG.vertexShader=aF.vertexShader;aG.fragmentShader=aF.fragmentShader}var aH,aJ,aM;aH=aM=aF=0;for(aJ=aI.length;aH<aJ;aH++){aC=aI[aH],aC instanceof c.SpotLight&&aM++,aC instanceof c.DirectionalLight&&aM++,aC instanceof c.PointLight&&aF++}aF+aM<=Y?aH=aM:(aH=Math.ceil(Y*aM/(aF+aM)),aF=Y-aH);aC={directional:aH,point:aF};aF=aM=0;for(aH=aI.length;aF<aH;aF++){aJ=aI[aF],aJ instanceof c.SpotLight&&aJ.castShadow&&aM++}var z=50;if(D!==void 0&&D instanceof c.SkinnedMesh){z=D.bones.length}var C;aG:{aH=aG.fragmentShader;aJ=aG.vertexShader;var aF=aG.uniforms,aI=aG.attributes,aK={map:!!aG.map,envMap:!!aG.envMap,lightMap:!!aG.lightMap,vertexColors:aG.vertexColors,fog:aK,useFog:aG.fog,sizeAttenuation:aG.sizeAttenuation,skinning:aG.skinning,morphTargets:aG.morphTargets,maxMorphTargets:this.maxMorphTargets,maxDirLights:aC.directional,maxPointLights:aC.point,maxBones:z,shadowMapEnabled:this.shadowMapEnabled&&D.receiveShadow,shadowMapSoft:this.shadowMapSoft,shadowMapWidth:this.shadowMapWidth,shadowMapHeight:this.shadowMapHeight,maxShadows:aM,alphaTest:aG.alphaTest,metal:aG.metal,perPixel:aG.perPixel},aB,D=[];aE?D.push(aE):(D.push(aH),D.push(aJ));for(aB in aK){D.push(aB),D.push(aK[aB])}aE=D.join();aB=0;for(D=ah.length;aB<D;aB++){if(ah[aB].code===aE){C=ah[aB].program;break aG}}aB=t.createProgram();D=[i?"#define VERTEX_TEXTURES":"",ag.gammaInput?"#define GAMMA_INPUT":"",ag.gammaOutput?"#define GAMMA_OUTPUT":"",ag.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"","#define MAX_DIR_LIGHTS "+aK.maxDirLights,"#define MAX_POINT_LIGHTS "+aK.maxPointLights,"#define MAX_SHADOWS "+aK.maxShadows,"#define MAX_BONES "+aK.maxBones,aK.map?"#define USE_MAP":"",aK.envMap?"#define USE_ENVMAP":"",aK.lightMap?"#define USE_LIGHTMAP":"",aK.vertexColors?"#define USE_COLOR":"",aK.skinning?"#define USE_SKINNING":"",aK.morphTargets?"#define USE_MORPHTARGETS":"",aK.perPixel?"#define PHONG_PER_PIXEL":"",aK.shadowMapEnabled?"#define USE_SHADOWMAP":"",aK.shadowMapSoft?"#define SHADOWMAP_SOFT":"",aK.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 objectMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nuniform mat4 cameraInverseMatrix;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n#ifdef USE_COLOR\nattribute vec3 color;\n#endif\n#ifdef USE_MORPHTARGETS\nattribute vec3 morphTarget0;\nattribute vec3 morphTarget1;\nattribute vec3 morphTarget2;\nattribute vec3 morphTarget3;\nattribute vec3 morphTarget4;\nattribute vec3 morphTarget5;\nattribute vec3 morphTarget6;\nattribute vec3 morphTarget7;\n#endif\n#ifdef USE_SKINNING\nattribute vec4 skinVertexA;\nattribute vec4 skinVertexB;\nattribute vec4 skinIndex;\nattribute vec4 skinWeight;\n#endif\n"].join("\n");aC=["#ifdef GL_ES","precision "+n+" float;","#endif","#define MAX_DIR_LIGHTS "+aK.maxDirLights,"#define MAX_POINT_LIGHTS "+aK.maxPointLights,"#define MAX_SHADOWS "+aK.maxShadows,aK.alphaTest?"#define ALPHATEST "+aK.alphaTest:"",ag.gammaInput?"#define GAMMA_INPUT":"",ag.gammaOutput?"#define GAMMA_OUTPUT":"",ag.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"",aK.useFog&&aK.fog?"#define USE_FOG":"",aK.useFog&&aK.fog instanceof c.FogExp2?"#define FOG_EXP2":"",aK.map?"#define USE_MAP":"",aK.envMap?"#define USE_ENVMAP":"",aK.lightMap?"#define USE_LIGHTMAP":"",aK.vertexColors?"#define USE_COLOR":"",aK.metal?"#define METAL":"",aK.perPixel?"#define PHONG_PER_PIXEL":"",aK.shadowMapEnabled?"#define USE_SHADOWMAP":"",aK.shadowMapSoft?"#define SHADOWMAP_SOFT":"",aK.shadowMapSoft?"#define SHADOWMAP_WIDTH "+aK.shadowMapWidth.toFixed(1):"",aK.shadowMapSoft?"#define SHADOWMAP_HEIGHT "+aK.shadowMapHeight.toFixed(1):"","uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n");t.attachShader(aB,a("fragment",aC+aH));t.attachShader(aB,a("vertex",D+aJ));t.linkProgram(aB);t.getProgramParameter(aB,t.LINK_STATUS)||console.error("Could not initialise shader\nVALIDATE_STATUS: "+t.getProgramParameter(aB,t.VALIDATE_STATUS)+", gl error ["+t.getError()+"]");aB.uniforms={};aB.attributes={};var aL,D=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","objectMatrix","cameraPosition","cameraInverseMatrix","boneGlobalMatrices","morphTargetInfluences"];for(aL in aF){D.push(aL)}aL=D;D=0;for(aF=aL.length;D<aF;D++){aH=aL[D],aB.uniforms[aH]=t.getUniformLocation(aB,aH)}D=["position","normal","uv","uv2","tangent","color","skinVertexA","skinVertexB","skinIndex","skinWeight"];for(aL=0;aL<aK.maxMorphTargets;aL++){D.push("morphTarget"+aL)}for(C in aI){D.push(C)}C=D;aL=0;for(aI=C.length;aL<aI;aL++){aK=C[aL],aB.attributes[aK]=t.getAttribLocation(aB,aK)}aB.id=ah.length;ah.push({program:aB,code:aE});ag.info.memory.programs=ah.length;C=aB}aG.program=C;C=aG.program.attributes;C.position>=0&&t.enableVertexAttribArray(C.position);C.color>=0&&t.enableVertexAttribArray(C.color);C.normal>=0&&t.enableVertexAttribArray(C.normal);C.tangent>=0&&t.enableVertexAttribArray(C.tangent);aG.skinning&&C.skinVertexA>=0&&C.skinVertexB>=0&&C.skinIndex>=0&&C.skinWeight>=0&&(t.enableVertexAttribArray(C.skinVertexA),t.enableVertexAttribArray(C.skinVertexB),t.enableVertexAttribArray(C.skinIndex),t.enableVertexAttribArray(C.skinWeight));if(aG.attributes){for(aA in aG.attributes){C[aA]!==void 0&&C[aA]>=0&&t.enableVertexAttribArray(C[aA])}}if(aG.morphTargets){for(aA=aG.numSupportedMorphTargets=0;aA<this.maxMorphTargets;aA++){aL="morphTarget"+aA,C[aL]>=0&&(t.enableVertexAttribArray(C[aL]),aG.numSupportedMorphTargets++)}}aG.uniformsList=[];for(aD in aG.uniforms){aG.uniformsList.push([aG.uniforms[aD],aD])}};this.setFaceCulling=function(z,C){z?(!C||C==="ccw"?t.frontFace(t.CCW):t.frontFace(t.CW),z==="back"?t.cullFace(t.BACK):z==="front"?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK),t.enable(t.CULL_FACE)):t.disable(t.CULL_FACE)}};c.WebGLRenderTarget=function(b,a,g){this.width=b;this.height=a;g=g||{};this.wrapS=g.wrapS!==void 0?g.wrapS:c.ClampToEdgeWrapping;this.wrapT=g.wrapT!==void 0?g.wrapT:c.ClampToEdgeWrapping;this.magFilter=g.magFilter!==void 0?g.magFilter:c.LinearFilter;this.minFilter=g.minFilter!==void 0?g.minFilter:c.LinearMipMapLinearFilter;this.offset=new c.Vector2(0,0);this.repeat=new c.Vector2(1,1);this.format=g.format!==void 0?g.format:c.RGBAFormat;this.type=g.type!==void 0?g.type:c.UnsignedByteType;this.depthBuffer=g.depthBuffer!==void 0?g.depthBuffer:!0;this.stencilBuffer=g.stencilBuffer!==void 0?g.stencilBuffer:!0};c.WebGLRenderTarget.prototype.clone=function(){var a=new c.WebGLRenderTarget(this.width,this.height);a.wrapS=this.wrapS;a.wrapT=this.wrapT;a.magFilter=this.magFilter;a.minFilter=this.minFilter;a.offset.copy(this.offset);a.repeat.copy(this.repeat);a.format=this.format;a.type=this.type;a.depthBuffer=this.depthBuffer;a.stencilBuffer=this.stencilBuffer;return a};c.WebGLRenderTargetCube=function(b,a,g){c.WebGLRenderTarget.call(this,b,a,g);this.activeCubeFace=0};c.WebGLRenderTargetCube.prototype=new c.WebGLRenderTarget;c.WebGLRenderTargetCube.prototype.constructor=c.WebGLRenderTargetCube;c.RenderableVertex=function(){this.positionWorld=new c.Vector3;this.positionScreen=new c.Vector4;this.visible=!0};c.RenderableVertex.prototype.copy=function(a){this.positionWorld.copy(a.positionWorld);this.positionScreen.copy(a.positionScreen)};c.RenderableFace3=function(){this.v1=new c.RenderableVertex;this.v2=new c.RenderableVertex;this.v3=new c.RenderableVertex;this.centroidWorld=new c.Vector3;this.centroidScreen=new c.Vector3;this.normalWorld=new c.Vector3;this.vertexNormalsWorld=[new c.Vector3,new c.Vector3,new c.Vector3];this.faceMaterial=this.material=null;this.uvs=[[]];this.z=null};c.RenderableFace4=function(){this.v1=new c.RenderableVertex;this.v2=new c.RenderableVertex;this.v3=new c.RenderableVertex;this.v4=new c.RenderableVertex;this.centroidWorld=new c.Vector3;this.centroidScreen=new c.Vector3;this.normalWorld=new c.Vector3;this.vertexNormalsWorld=[new c.Vector3,new c.Vector3,new c.Vector3,new c.Vector3];this.faceMaterial=this.material=null;this.uvs=[[]];this.z=null};c.RenderableObject=function(){this.z=this.object=null};c.RenderableParticle=function(){this.rotation=this.z=this.y=this.x=null;this.scale=new c.Vector2;this.material=null};c.RenderableLine=function(){this.z=null;this.v1=new c.RenderableVertex;this.v2=new c.RenderableVertex;this.material=null};c.ColorUtils={adjustHSV:function(k,a,l,b){var g=c.ColorUtils.__hsv;c.ColorUtils.rgbToHsv(k,g);g.h=c.Math.clamp(g.h+a,0,1);g.s=c.Math.clamp(g.s+l,0,1);g.v=c.Math.clamp(g.v+b,0,1);k.setHSV(g.h,g.s,g.v)},rgbToHsv:function(f,h){var g=f.r,q=f.g,b=f.b,a=Math.max(Math.max(g,q),b),r=Math.min(Math.min(g,q),b);if(r===a){r=g=0}else{var e=a-r,r=e/a,g=g===a?(q-b)/e:q===a?2+(b-g)/e:4+(g-q)/e;g/=6;g<0&&(g+=1);g>1&&(g-=1)}h===void 0&&(h={h:0,s:0,v:0});h.h=g;h.s=r;h.v=a;return h}};c.ColorUtils.__hsv={h:0,s:0,v:0};c.GeometryUtils={merge:function(a,e){for(var b,f,m=a.vertices.length,k=e instanceof c.Mesh?e.geometry:e,h=a.vertices,o=k.vertices,p=a.faces,t=k.faces,q=a.faceVertexUvs[0],O=k.faceVertexUvs[0],g={},u=0;u<a.materials.length;u++){g[a.materials[u].id]=u}if(e instanceof c.Mesh){e.matrixAutoUpdate&&e.updateMatrix(),b=e.matrix,f=new c.Matrix4,f.extractRotation(b,e.scale)}for(var u=0,l=o.length;u<l;u++){var w=new c.Vertex(o[u].position.clone());b&&b.multiplyVector3(w.position);h.push(w)}u=0;for(l=t.length;u<l;u++){var h=t[u],i,n,P=h.vertexNormals,r=h.vertexColors;h instanceof c.Face3?i=new c.Face3(h.a+m,h.b+m,h.c+m):h instanceof c.Face4&&(i=new c.Face4(h.a+m,h.b+m,h.c+m,h.d+m));i.normal.copy(h.normal);f&&f.multiplyVector3(i.normal);o=0;for(w=P.length;o<w;o++){n=P[o].clone(),f&&f.multiplyVector3(n),i.vertexNormals.push(n)}i.color.copy(h.color);o=0;for(w=r.length;o<w;o++){n=r[o],i.vertexColors.push(n.clone())}if(h.materialIndex!==void 0){o=k.materials[h.materialIndex];w=g[o.id];if(w===void 0){w=a.materials.length,a.materials.push(o)}i.materialIndex=w}i.centroid.copy(h.centroid);b&&b.multiplyVector3(i.centroid);p.push(i)}u=0;for(l=O.length;u<l;u++){b=O[u];f=[];o=0;for(w=b.length;o<w;o++){f.push(new c.UV(b[o].u,b[o].v))}q.push(f)}},clone:function(i){var l=new c.Geometry,k,o=i.vertices,a=i.faces,z=i.faceVertexUvs[0];if(i.materials){l.materials=i.materials.slice()}i=0;for(k=o.length;i<k;i++){var y=new c.Vertex(o[i].position.clone());l.vertices.push(y)}i=0;for(k=a.length;i<k;i++){var b=a[i],e,g,f=b.vertexNormals,h=b.vertexColors;b instanceof c.Face3?e=new c.Face3(b.a,b.b,b.c):b instanceof c.Face4&&(e=new c.Face4(b.a,b.b,b.c,b.d));e.normal.copy(b.normal);o=0;for(y=f.length;o<y;o++){g=f[o],e.vertexNormals.push(g.clone())}e.color.copy(b.color);o=0;for(y=h.length;o<y;o++){g=h[o],e.vertexColors.push(g.clone())}e.materialIndex=b.materialIndex;e.centroid.copy(b.centroid);l.faces.push(e)}i=0;for(k=z.length;i<k;i++){a=z[i];e=[];o=0;for(y=a.length;o<y;o++){e.push(new c.UV(a[o].u,a[o].v))}l.faceVertexUvs[0].push(e)}return l},randomPointInTriangle:function(f,h,g){var q,b,a,r=new c.Vector3,e=c.GeometryUtils.__v1;q=c.GeometryUtils.random();b=c.GeometryUtils.random();q+b>1&&(q=1-q,b=1-b);a=1-q-b;r.copy(f);r.multiplyScalar(q);e.copy(h);e.multiplyScalar(b);r.addSelf(e);e.copy(g);e.multiplyScalar(a);r.addSelf(e);return r},randomPointInFace:function(g,p,o){var a,f,e;if(g instanceof c.Face3){return a=p.vertices[g.a].position,f=p.vertices[g.b].position,e=p.vertices[g.c].position,c.GeometryUtils.randomPointInTriangle(a,f,e)}else{if(g instanceof c.Face4){a=p.vertices[g.a].position;f=p.vertices[g.b].position;e=p.vertices[g.c].position;var p=p.vertices[g.d].position,b;o?g._area1&&g._area2?(o=g._area1,b=g._area2):(o=c.GeometryUtils.triangleArea(a,f,p),b=c.GeometryUtils.triangleArea(f,e,p),g._area1=o,g._area2=b):(o=c.GeometryUtils.triangleArea(a,f,p),b=c.GeometryUtils.triangleArea(f,e,p));return c.GeometryUtils.random()*(o+b)<o?c.GeometryUtils.randomPointInTriangle(a,f,p):c.GeometryUtils.randomPointInTriangle(f,e,p)}}},randomPointsInGeometry:function(e,i){function f(j){function n(q,r){if(r<q){return q}var s=q+Math.floor((r-q)/2);return a[s]>j?n(q,s-1):a[s]<j?n(s+1,r):s}return n(0,a.length-1)}var k,o,m=e.faces,l=e.vertices,p=m.length,C=0,a=[],D,g,h,b;for(o=0;o<p;o++){k=m[o];if(k instanceof c.Face3){D=l[k.a].position,g=l[k.b].position,h=l[k.c].position,k._area=c.GeometryUtils.triangleArea(D,g,h)}else{if(k instanceof c.Face4){D=l[k.a].position,g=l[k.b].position,h=l[k.c].position,b=l[k.d].position,k._area1=c.GeometryUtils.triangleArea(D,g,b),k._area2=c.GeometryUtils.triangleArea(g,h,b),k._area=k._area1+k._area2}}C+=k._area;a[o]=C}k=[];l={};for(o=0;o<i;o++){p=c.GeometryUtils.random()*C,p=f(p),k[o]=c.GeometryUtils.randomPointInFace(m[p],e,!0),l[p]?l[p]+=1:l[p]=1}return k},triangleArea:function(k,a,l){var b,g=c.GeometryUtils.__v1;g.sub(k,a);b=g.length();g.sub(k,l);k=g.length();g.sub(a,l);l=g.length();a=0.5*(b+k+l);return Math.sqrt(a*(a-b)*(a-k)*(a-l))},center:function(b){b.computeBoundingBox();var a=new c.Matrix4;a.setTranslation(-0.5*(b.boundingBox.x[1]+b.boundingBox.x[0]),-0.5*(b.boundingBox.y[1]+b.boundingBox.y[0]),-0.5*(b.boundingBox.z[1]+b.boundingBox.z[0]));b.applyMatrix(a);b.computeBoundingBox()}};c.GeometryUtils.random=c.Math.random16;c.GeometryUtils.__v1=new c.Vector3;c.ImageUtils={loadTexture:function(k,a,l){var b=new Image,g=new c.Texture(b,a);b.onload=function(){g.needsUpdate=!0;l&&l(this)};b.crossOrigin="";b.src=k;return g},loadTextureCube:function(m,a,n){var b,g=[],f=new c.Texture(g,a),a=g.loadCount=0;for(b=m.length;a<b;++a){g[a]=new Image,g[a].onload=function(){g.loadCount+=1;if(g.loadCount===6){f.needsUpdate=!0}n&&n(this)},g[a].crossOrigin="",g[a].src=m[a]}return f},getNormalMap:function(a,f){var b=function(j){var s=Math.sqrt(j[0]*j[0]+j[1]*j[1]+j[2]*j[2]);return[j[0]/s,j[1]/s,j[2]/s]};f|=1;var h=a.width,n=a.height,l=document.createElement("canvas");l.width=h;l.height=n;var k=l.getContext("2d");k.drawImage(a,0,0);for(var p=k.getImageData(0,0,h,n).data,r=k.createImageData(h,n),w=r.data,t=0;t<h;t++){for(var g=1;g<n;g++){var i=g-1<0?n-1:g-1,M=(g+1)%n,o=t-1<0?h-1:t-1,e=(t+1)%h,m=[],q=[0,0,p[(g*h+t)*4]/255*f];m.push([-1,0,p[(g*h+o)*4]/255*f]);m.push([-1,-1,p[(i*h+o)*4]/255*f]);m.push([0,-1,p[(i*h+t)*4]/255*f]);m.push([1,-1,p[(i*h+e)*4]/255*f]);m.push([1,0,p[(g*h+e)*4]/255*f]);m.push([1,1,p[(M*h+e)*4]/255*f]);m.push([0,1,p[(M*h+t)*4]/255*f]);m.push([-1,1,p[(M*h+o)*4]/255*f]);i=[];o=m.length;for(M=0;M<o;M++){var e=m[M],N=m[(M+1)%o],e=[e[0]-q[0],e[1]-q[1],e[2]-q[2]],N=[N[0]-q[0],N[1]-q[1],N[2]-q[2]];i.push(b([e[1]*N[2]-e[2]*N[1],e[2]*N[0]-e[0]*N[2],e[0]*N[1]-e[1]*N[0]]))}m=[0,0,0];for(M=0;M<i.length;M++){m[0]+=i[M][0],m[1]+=i[M][1],m[2]+=i[M][2]}m[0]/=i.length;m[1]/=i.length;m[2]/=i.length;q=(g*h+t)*4;w[q]=(m[0]+1)/2*255|0;w[q+1]=(m[1]+0.5)*255|0;w[q+2]=m[2]*255|0;w[q+3]=255}}k.putImageData(r,0,0);return l}};c.SceneUtils={showHierarchy:function(b,a){c.SceneUtils.traverseHierarchy(b,function(e){e.visible=a})},traverseHierarchy:function(k,a){var l,b,g=k.children.length;for(b=0;b<g;b++){l=k.children[b],a(l),c.SceneUtils.traverseHierarchy(l,a)}},createMultiMaterialObject:function(m,a){var n,b=a.length,g=new c.Object3D;for(n=0;n<b;n++){var f=new c.Mesh(m,a[n]);g.add(f)}return g},cloneObject:function(i){var a;i instanceof c.MorphAnimMesh?(a=new c.MorphAnimMesh(i.geometry,i.material),a.duration=i.duration,a.mirroredLoop=i.mirroredLoop,a.time=i.time,a.lastKeyframe=i.lastKeyframe,a.currentKeyframe=i.currentKeyframe,a.direction=i.direction,a.directionBackwards=i.directionBackwards):i instanceof c.SkinnedMesh?a=new c.SkinnedMesh(i.geometry,i.material):i instanceof c.Mesh?a=new c.Mesh(i.geometry,i.material):i instanceof c.Line?a=new c.Line(i.geometry,i.material,i.type):i instanceof c.Ribbon?a=new c.Ribbon(i.geometry,i.material):i instanceof c.ParticleSystem?(a=new c.ParticleSystem(i.geometry,i.material),a.sortParticles=i.sortParticles):i instanceof c.Particle?a=new c.Particle(i.material):i instanceof c.Sprite?(a=new c.Sprite({}),a.color.copy(i.color),a.map=i.map,a.blending=i.blending,a.useScreenCoordinates=i.useScreenCoordinates,a.mergeWith3D=i.mergeWith3D,a.affectedByDistance=i.affectedByDistance,a.scaleByViewport=i.scaleByViewport,a.alignment=i.alignment,a.rotation3d.copy(i.rotation3d),a.rotation=i.rotation,a.opacity=i.opacity,a.uvOffset.copy(i.uvOffset),a.uvScale.copy(i.uvScale)):i instanceof c.LOD?a=new c.LOD:i instanceof c.MarchingCubes?(a=new c.MarchingCubes(i.resolution,i.material),a.field.set(i.field),a.isolation=i.isolation):i instanceof c.Object3D&&(a=new c.Object3D);a.parent=i.parent;a.up.copy(i.up);a.position.copy(i.position);a.rotation instanceof c.Vector3&&a.rotation.copy(i.rotation);a.eulerOrder=i.eulerOrder;a.scale.copy(i.scale);a.dynamic=i.dynamic;a.doubleSided=i.doubleSided;a.flipSided=i.flipSided;a.renderDepth=i.renderDepth;a.rotationAutoUpdate=i.rotationAutoUpdate;a.matrix.copy(i.matrix);a.matrixWorld.copy(i.matrixWorld);a.matrixRotationWorld.copy(i.matrixRotationWorld);a.matrixAutoUpdate=i.matrixAutoUpdate;a.matrixWorldNeedsUpdate=i.matrixWorldNeedsUpdate;a.quaternion.copy(i.quaternion);a.useQuaternion=i.useQuaternion;a.boundRadius=i.boundRadius;a.boundRadiusScale=i.boundRadiusScale;a.visible=i.visible;a.castShadow=i.castShadow;a.receiveShadow=i.receiveShadow;a.frustumCulled=i.frustumCulled;for(var j=0;j<i.children.length;j++){var b=c.SceneUtils.cloneObject(i.children[j]);a.children[j]=b;b.parent=a}if(i instanceof c.LOD){for(j=0;j<i.LODs.length;j++){a.LODs[j]={visibleAtDistance:i.LODs[j].visibleAtDistance,object3D:a.children[j]}}}return a}};if(c.WebGLRenderer){c.ShaderUtils={lib:{fresnel:{uniforms:{mRefractionRatio:{type:"f",value:1.02},mFresnelBias:{type:"f",value:0.1},mFresnelPower:{type:"f",value:2},mFresnelScale:{type:"f",value:1},tCube:{type:"t",value:1,texture:null}},fragmentShader:"uniform samplerCube tCube;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\nvec4 refractedColor = vec4( 1.0, 1.0, 1.0, 1.0 );\nrefractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;\nrefractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;\nrefractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;\nrefractedColor.a = 1.0;\ngl_FragColor = mix( refractedColor, reflectedColor, clamp( vReflectionFactor, 0.0, 1.0 ) );\n}",vertexShader:"uniform float mRefractionRatio;\nuniform float mFresnelBias;\nuniform float mFresnelScale;\nuniform float mFresnelPower;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = normalize ( mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal );\nvec3 I = mPosition.xyz - cameraPosition;\nvReflect = reflect( I, nWorld );\nvRefract[0] = refract( normalize( I ), nWorld, mRefractionRatio );\nvRefract[1] = refract( normalize( I ), nWorld, mRefractionRatio * 0.99 );\nvRefract[2] = refract( normalize( I ), nWorld, mRefractionRatio * 0.98 );\nvReflectionFactor = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( I ), nWorld ), mFresnelPower );\ngl_Position = projectionMatrix * mvPosition;\n}"},normal:{uniforms:c.UniformsUtils.merge([c.UniformsLib.fog,c.UniformsLib.lights,c.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},tDiffuse:{type:"t",value:0,texture:null},tCube:{type:"t",value:1,texture:null},tNormal:{type:"t",value:2,texture:null},tSpecular:{type:"t",value:3,texture:null},tAO:{type:"t",value:4,texture:null},tDisplacement:{type:"t",value:5,texture:null},uNormalScale:{type:"f",value:1},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new c.Color(15658734)},uSpecularColor:{type:"c",value:new c.Color(1118481)},uAmbientColor:{type:"c",value:new c.Color(328965)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1},uReflectivity:{type:"f",value:0.5},uOffset:{type:"v2",value:new c.Vector2(0,0)},uRepeat:{type:"v2",value:new c.Vector2(1,1)}}]),fragmentShader:["uniform vec3 uAmbientColor;\nuniform vec3 uDiffuseColor;\nuniform vec3 uSpecularColor;\nuniform float uShininess;\nuniform float uOpacity;\nuniform bool enableDiffuse;\nuniform bool enableSpecular;\nuniform bool enableAO;\nuniform bool enableReflection;\nuniform sampler2D tDiffuse;\nuniform sampler2D tNormal;\nuniform sampler2D tSpecular;\nuniform sampler2D tAO;\nuniform samplerCube tCube;\nuniform float uNormalScale;\nuniform float uReflectivity;\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\nvarying vec3 vViewPosition;",c.ShaderChunk.shadowmap_pars_fragment,c.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3( 1.0 ), uOpacity );\nvec3 specularTex = vec3( 1.0 );\nvec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;\nnormalTex.xy *= uNormalScale;\nnormalTex = normalize( normalTex );\nif( enableDiffuse )\ngl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );\nif( enableAO )\ngl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;\nif( enableSpecular )\nspecularTex = texture2D( tSpecular, vUv ).xyz;\nmat3 tsb = mat3( vTangent, vBinormal, vNormal );\nvec3 finalNormal = tsb * normalTex;\nvec3 normal = normalize( finalNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec3 pointVector = normalize( vPointLight[ i ].xyz );\nvec3 pointHalfVector = normalize( vPointLight[ i ].xyz + viewPosition );\nfloat pointDistance = vPointLight[ i ].w;\nfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\nfloat pointSpecularWeight = specularTex.r * pow( pointDotNormalHalf, uShininess );\npointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;\npointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nvec3 dirHalfVector = normalize( lDirection.xyz + viewPosition );\nfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\nfloat dirSpecularWeight = specularTex.r * pow( dirDotNormalHalf, uShininess );\ndirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;\ndirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;\n}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\ngl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor) + totalSpecular;\nif ( enableReflection ) {\nvec3 wPos = cameraPosition - vViewPosition;\nvec3 vReflect = reflect( normalize( wPos ), normal );\nvec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\ngl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, uReflectivity );\n}",c.ShaderChunk.shadowmap_fragment,c.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;\nuniform vec2 uOffset;\nuniform vec2 uRepeat;\n#ifdef VERTEX_TEXTURES\nuniform sampler2D tDisplacement;\nuniform float uDisplacementScale;\nuniform float uDisplacementBias;\n#endif\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\nvarying vec3 vViewPosition;",c.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvViewPosition = -mvPosition.xyz;\nvNormal = normalize( normalMatrix * normal );\nvTangent = normalize( normalMatrix * tangent.xyz );\nvBinormal = cross( vNormal, vTangent ) * tangent.w;\nvBinormal = normalize( vBinormal );\nvUv = uv * uRepeat + uOffset;\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nvPointLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#ifdef VERTEX_TEXTURES\nvec3 dv = texture2D( tDisplacement, uv ).xyz;\nfloat df = uDisplacementScale * dv.x + uDisplacementBias;\nvec4 displacedPosition = vec4( vNormal.xyz * df, 0.0 ) + mvPosition;\ngl_Position = projectionMatrix * displacedPosition;\n#else\ngl_Position = projectionMatrix * mvPosition;\n#endif",c.ShaderChunk.shadowmap_vertex,"}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:1,texture:null},tFlip:{type:"f",value:-1}},vertexShader:"varying vec3 vViewPosition;\nvoid main() {\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvViewPosition = cameraPosition - mPosition.xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform samplerCube tCube;\nuniform float tFlip;\nvarying vec3 vViewPosition;\nvoid main() {\nvec3 wPos = cameraPosition - vViewPosition;\ngl_FragColor = textureCube( tCube, vec3( tFlip * wPos.x, wPos.yz ) );\n}"}}}}c.Curve=function(){};c.Curve.prototype.getPoint=function(){console.log("Warning, getPoint() not implemented!");return null};c.Curve.prototype.getPointAt=function(a){return this.getPoint(this.getUtoTmapping(a))};c.Curve.prototype.getPoints=function(b){b||(b=5);var a,g=[];for(a=0;a<=b;a++){g.push(this.getPoint(a/b))}return g};c.Curve.prototype.getSpacedPoints=function(b){b||(b=5);var a,g=[];for(a=0;a<=b;a++){g.push(this.getPointAt(a/b))}return g};c.Curve.prototype.getLength=function(){var a=this.getLengths();return a[a.length-1]};c.Curve.prototype.getLengths=function(m){m||(m=200);if(this.cacheArcLengths&&this.cacheArcLengths.length==m+1){return this.cacheArcLengths}var a=[],n,b=this.getPoint(0),g,f=0;a.push(0);for(g=1;g<=m;g++){n=this.getPoint(g/m),f+=n.distanceTo(b),a.push(f),b=n}return this.cacheArcLengths=a};c.Curve.prototype.getUtoTmapping=function(a,e){var b=this.getLengths(),f=0,i=b.length,h;h=e?e:a*b[i-1];for(var g=0,s=i-1,t;g<=s;){if(f=Math.floor(g+(s-g)/2),t=b[f]-h,t<0){g=f+1}else{if(t>0){s=f-1}else{s=f;break}}}f=s;if(b[f]==h){return f/(i-1)}g=b[f];return b=(f+(h-g)/(b[f+1]-g))/(i-1)};c.Curve.prototype.getNormalVector=function(a){a=this.getTangent(a);return new c.Vector2(-a.y,a.x)};c.Curve.prototype.getTangent=function(b){var a=b-0.0001;b+=0.0001;a<0&&(a=0);b>1&&(b=1);a=this.getPoint(a);b=this.getPoint(b);return a.clone().subSelf(b).normalize()};c.Curve.prototype.getTangentAt=function(a){return this.getTangent(this.getUtoTmapping(a))};c.LineCurve=function(b,a){b instanceof c.Vector2?(this.v1=b,this.v2=a):c.LineCurve.oldConstructor.apply(this,arguments)};c.LineCurve.oldConstructor=function(i,a,j,b){this.constructor(new c.Vector2(i,a),new c.Vector2(j,b))};c.LineCurve.prototype=new c.Curve;c.LineCurve.prototype.constructor=c.LineCurve;c.LineCurve.prototype.getPoint=function(b){var a=new c.Vector2;a.sub(this.v2,this.v1);a.multiplyScalar(b).addSelf(this.v1);return a};c.LineCurve.prototype.getPointAt=function(a){return this.getPoint(a)};c.LineCurve.prototype.getTangent=function(){var a=new c.Vector2;a.sub(this.v2,this.v1);a.normalize();return a};c.QuadraticBezierCurve=function(i,a,j){if(!(a instanceof c.Vector2)){var b=Array.prototype.slice.call(arguments),i=new c.Vector2(b[0],b[1]),a=new c.Vector2(b[2],b[3]),j=new c.Vector2(b[4],b[5])}this.v0=i;this.v1=a;this.v2=j};c.QuadraticBezierCurve.prototype=new c.Curve;c.QuadraticBezierCurve.prototype.constructor=c.QuadraticBezierCurve;c.QuadraticBezierCurve.prototype.getPoint=function(b){var a;a=c.Shape.Utils.b2(b,this.v0.x,this.v1.x,this.v2.x);b=c.Shape.Utils.b2(b,this.v0.y,this.v1.y,this.v2.y);return new c.Vector2(a,b)};c.QuadraticBezierCurve.prototype.getTangent=function(b){var a;a=c.Curve.Utils.tangentQuadraticBezier(b,this.v0.x,this.v1.x,this.v2.x);b=c.Curve.Utils.tangentQuadraticBezier(b,this.v0.y,this.v1.y,this.v2.y);a=new c.Vector2(a,b);a.normalize();return a};c.CubicBezierCurve=function(k,a,l,b){if(!(a instanceof c.Vector2)){var g=Array.prototype.slice.call(arguments),k=new c.Vector2(g[0],g[1]),a=new c.Vector2(g[2],g[3]),l=new c.Vector2(g[4],g[5]),b=new c.Vector2(g[6],g[7])}this.v0=k;this.v1=a;this.v2=l;this.v3=b};c.CubicBezierCurve.prototype=new c.Curve;c.CubicBezierCurve.prototype.constructor=c.CubicBezierCurve;c.CubicBezierCurve.prototype.getPoint=function(b){var a;a=c.Shape.Utils.b3(b,this.v0.x,this.v1.x,this.v2.x,this.v3.x);b=c.Shape.Utils.b3(b,this.v0.y,this.v1.y,this.v2.y,this.v3.y);return new c.Vector2(a,b)};c.CubicBezierCurve.prototype.getTangent=function(b){var a;a=c.Curve.Utils.tangentCubicBezier(b,this.v0.x,this.v1.x,this.v2.x,this.v3.x);b=c.Curve.Utils.tangentCubicBezier(b,this.v0.y,this.v1.y,this.v2.y,this.v3.y);a=new c.Vector2(a,b);a.normalize();return a};c.SplineCurve=function(a){this.points=a==void 0?[]:a};c.SplineCurve.prototype=new c.Curve;c.SplineCurve.prototype.constructor=c.SplineCurve;c.SplineCurve.prototype.getPoint=function(k){var a=new c.Vector2,l=[],b=this.points,g;g=(b.length-1)*k;k=Math.floor(g);g-=k;l[0]=k==0?k:k-1;l[1]=k;l[2]=k>b.length-2?k:k+1;l[3]=k>b.length-3?k:k+2;a.x=c.Curve.Utils.interpolate(b[l[0]].x,b[l[1]].x,b[l[2]].x,b[l[3]].x,g);a.y=c.Curve.Utils.interpolate(b[l[0]].y,b[l[1]].y,b[l[2]].y,b[l[3]].y,g);return a};c.ArcCurve=function(m,a,n,b,g,f){this.aX=m;this.aY=a;this.aRadius=n;this.aStartAngle=b;this.aEndAngle=g;this.aClockwise=f};c.ArcCurve.prototype=new c.Curve;c.ArcCurve.prototype.constructor=c.ArcCurve;c.ArcCurve.prototype.getPoint=function(b){var a=this.aEndAngle-this.aStartAngle;this.aClockwise||(b=1-b);b=this.aStartAngle+b*a;return new c.Vector2(this.aX+this.aRadius*Math.cos(b),this.aY+this.aRadius*Math.sin(b))};c.Curve.Utils={tangentQuadraticBezier:function(i,a,j,b){return 2*(1-i)*(j-a)+2*i*(b-j)},tangentCubicBezier:function(k,a,l,b,g){return -3*a*(1-k)*(1-k)+3*l*(1-k)*(1-k)-6*k*l*(1-k)+6*k*b*(1-k)-3*k*k*b+3*k*k*g},tangentSpline:function(a){return 6*a*a-6*a+(3*a*a-4*a+1)+(-6*a*a+6*a)+(3*a*a-2*a)},interpolate:function(m,a,n,b,g){var m=(n-m)*0.5,b=(b-a)*0.5,f=g*g;return(2*a-2*n+m+b)*g*f+(-3*a+3*n-2*m-b)*f+m*g+a}};c.Curve.create=function(b,a){b.prototype=new c.Curve;b.prototype.constructor=b;b.prototype.getPoint=a;return b};c.LineCurve3=c.Curve.create(function(b,a){this.v1=b;this.v2=a},function(b){var a=new c.Vector3;a.sub(this.v2,this.v1);a.multiplyScalar(b);a.addSelf(this.v1);return a});c.QuadraticBezierCurve3=c.Curve.create(function(b,a,g){this.v0=b;this.v1=a;this.v2=g},function(b){var a,g;a=c.Shape.Utils.b2(b,this.v0.x,this.v1.x,this.v2.x);g=c.Shape.Utils.b2(b,this.v0.y,this.v1.y,this.v2.y);b=c.Shape.Utils.b2(b,this.v0.z,this.v1.z,this.v2.z);return new c.Vector3(a,g,b)});c.CubicBezierCurve3=c.Curve.create(function(i,a,j,b){this.v0=i;this.v1=a;this.v2=j;this.v3=b},function(b){var a,g;a=c.Shape.Utils.b3(b,this.v0.x,this.v1.x,this.v2.x,this.v3.x);g=c.Shape.Utils.b3(b,this.v0.y,this.v1.y,this.v2.y,this.v3.y);b=c.Shape.Utils.b3(b,this.v0.z,this.v1.z,this.v2.z,this.v3.z);return new c.Vector3(a,g,b)});c.SplineCurve3=c.Curve.create(function(a){this.points=a==void 0?[]:a},function(k){var a=new c.Vector3,l=[],b=this.points,g;g=(b.length-1)*k;k=Math.floor(g);g-=k;l[0]=k==0?k:k-1;l[1]=k;l[2]=k>b.length-2?k:k+1;l[3]=k>b.length-3?k:k+2;a.x=c.Curve.Utils.interpolate(b[l[0]].x,b[l[1]].x,b[l[2]].x,b[l[3]].x,g);a.y=c.Curve.Utils.interpolate(b[l[0]].y,b[l[1]].y,b[l[2]].y,b[l[3]].y,g);a.z=c.Curve.Utils.interpolate(b[l[0]].z,b[l[1]].z,b[l[2]].z,b[l[3]].z,g);return a});c.CurvePath=function(){this.curves=[];this.bends=[]};c.CurvePath.prototype=new c.Curve;c.CurvePath.prototype.constructor=c.CurvePath;c.CurvePath.prototype.add=function(a){this.curves.push(a)};c.CurvePath.prototype.checkConnection=function(){};c.CurvePath.prototype.closePath=function(){};c.CurvePath.prototype.getPoint=function(b){for(var a=b*this.getLength(),g=this.getCurveLengths(),b=0;b<g.length;){if(g[b]>=a){return a=g[b]-a,b=this.curves[b],a=1-a/b.getLength(),b.getPointAt(a)}b++}return null};c.CurvePath.prototype.getLength=function(){var a=this.getCurveLengths();return a[a.length-1]};c.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length){return this.cacheLengths}var i=[],a=0,j,b=this.curves.length;for(j=0;j<b;j++){a+=this.curves[j].getLength(),i.push(a)}return this.cacheLengths=i};c.CurvePath.prototype.getBoundingBox=function(){var a=this.getPoints(),e,b,f,i;e=b=Number.NEGATIVE_INFINITY;f=i=Number.POSITIVE_INFINITY;var h,g,s,t;t=new c.Vector2;g=0;for(s=a.length;g<s;g++){h=a[g];if(h.x>e){e=h.x}else{if(h.x<f){f=h.x}}if(h.y>b){b=h.y}else{if(h.y<b){i=h.y}}t.addSelf(h.x,h.y)}return{minX:f,minY:i,maxX:e,maxY:b,centroid:t.divideScalar(s)}};c.CurvePath.prototype.createPointsGeometry=function(a){return this.createGeometry(this.getPoints(a,!0))};c.CurvePath.prototype.createSpacedPointsGeometry=function(a){return this.createGeometry(this.getSpacedPoints(a,!0))};c.CurvePath.prototype.createGeometry=function(b){for(var a=new c.Geometry,g=0;g<b.length;g++){a.vertices.push(new c.Vertex(new c.Vector3(b[g].x,b[g].y,0)))}return a};c.CurvePath.prototype.addWrapPath=function(a){this.bends.push(a)};c.CurvePath.prototype.getTransformedPoints=function(k,a){var l=this.getPoints(k),b,g;if(!a){a=this.bends}b=0;for(g=a.length;b<g;b++){l=this.getWrapPoints(l,a[b])}return l};c.CurvePath.prototype.getTransformedSpacedPoints=function(k,a){var l=this.getSpacedPoints(k),b,g;if(!a){a=this.bends}b=0;for(g=a.length;b<g;b++){l=this.getWrapPoints(l,a[b])}return l};c.CurvePath.prototype.getWrapPoints=function(a,e){var b=this.getBoundingBox(),f,i,h,g,s,t;f=0;for(i=a.length;f<i;f++){h=a[f],g=h.x,s=h.y,t=g/b.maxX,t=e.getUtoTmapping(t,g),g=e.getPoint(t),s=e.getNormalVector(t).multiplyScalar(s),h.x=g.x+s.x,h.y=g.y+s.y}return a};c.Path=function(a){c.CurvePath.call(this);this.actions=[];a&&this.fromPoints(a)};c.Path.prototype=new c.CurvePath;c.Path.prototype.constructor=c.Path;c.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc"};c.Path.prototype.fromPoints=function(b){this.moveTo(b[0].x,b[0].y);var a,g=b.length;for(a=1;a<g;a++){this.lineTo(b[a].x,b[a].y)}};c.Path.prototype.moveTo=function(){var a=Array.prototype.slice.call(arguments);this.actions.push({action:c.PathActions.MOVE_TO,args:a})};c.Path.prototype.lineTo=function(i,a){var j=Array.prototype.slice.call(arguments),b=this.actions[this.actions.length-1].args;this.curves.push(new c.LineCurve(new c.Vector2(b[b.length-2],b[b.length-1]),new c.Vector2(i,a)));this.actions.push({action:c.PathActions.LINE_TO,args:j})};c.Path.prototype.quadraticCurveTo=function(m,a,n,b){var g=Array.prototype.slice.call(arguments),f=this.actions[this.actions.length-1].args;this.curves.push(new c.QuadraticBezierCurve(new c.Vector2(f[f.length-2],f[f.length-1]),new c.Vector2(m,a),new c.Vector2(n,b)));this.actions.push({action:c.PathActions.QUADRATIC_CURVE_TO,args:g})};c.Path.prototype.bezierCurveTo=function(f,h,g,q,b,a){var r=Array.prototype.slice.call(arguments),e=this.actions[this.actions.length-1].args;this.curves.push(new c.CubicBezierCurve(new c.Vector2(e[e.length-2],e[e.length-1]),new c.Vector2(f,h),new c.Vector2(g,q),new c.Vector2(b,a)));this.actions.push({action:c.PathActions.BEZIER_CURVE_TO,args:r})};c.Path.prototype.splineThru=function(b){var a=Array.prototype.slice.call(arguments),g=this.actions[this.actions.length-1].args,g=[new c.Vector2(g[g.length-2],g[g.length-1])];Array.prototype.push.apply(g,b);this.curves.push(new c.SplineCurve(g));this.actions.push({action:c.PathActions.CSPLINE_THRU,args:a})};c.Path.prototype.arc=function(g,p,o,a,f,e){var b=Array.prototype.slice.call(arguments);this.curves.push(new c.ArcCurve(g,p,o,a,f,e));this.actions.push({action:c.PathActions.ARC,args:b})};c.Path.prototype.getSpacedPoints=function(b){b||(b=40);for(var a=[],g=0;g<b;g++){a.push(this.getPoint(g/b))}return a};c.Path.prototype.getPoints=function(n,r){var n=n||12,p=[],J,e,b,a,f,h,k,i,o,q,l,g,m;J=0;for(e=this.actions.length;J<e;J++){switch(b=this.actions[J],a=b.action,b=b.args,a){case c.PathActions.LINE_TO:p.push(new c.Vector2(b[0],b[1]));break;case c.PathActions.QUADRATIC_CURVE_TO:f=b[2];h=b[3];o=b[0];q=b[1];p.length>0?(a=p[p.length-1],l=a.x,g=a.y):(a=this.actions[J-1].args,l=a[a.length-2],g=a[a.length-1]);for(a=1;a<=n;a++){m=a/n,b=c.Shape.Utils.b2(m,l,o,f),m=c.Shape.Utils.b2(m,g,q,h),p.push(new c.Vector2(b,m))}break;case c.PathActions.BEZIER_CURVE_TO:f=b[4];h=b[5];o=b[0];q=b[1];k=b[2];i=b[3];p.length>0?(a=p[p.length-1],l=a.x,g=a.y):(a=this.actions[J-1].args,l=a[a.length-2],g=a[a.length-1]);for(a=1;a<=n;a++){m=a/n,b=c.Shape.Utils.b3(m,l,o,k,f),m=c.Shape.Utils.b3(m,g,q,i,h),p.push(new c.Vector2(b,m))}break;case c.PathActions.CSPLINE_THRU:a=this.actions[J-1].args;a=[new c.Vector2(a[a.length-2],a[a.length-1])];m=n*b[0].length;a=a.concat(b[0]);b=new c.SplineCurve(a);for(a=1;a<=m;a++){p.push(b.getPointAt(a/m))}break;case c.PathActions.ARC:a=this.actions[J-1].args;f=b[0];h=b[1];k=b[2];o=b[3];m=b[4];q=!!b[5];i=a[a.length-2];l=a[a.length-1];a.length==0&&(i=l=0);g=m-o;var I=n*2;for(a=1;a<=I;a++){m=a/I,q||(m=1-m),m=o+m*g,b=i+f+k*Math.cos(m),m=l+h+k*Math.sin(m),p.push(new c.Vector2(b,m))}}}r&&p.push(p[0]);return p};c.Path.prototype.transform=function(b,a){this.getBoundingBox();return this.getWrapPoints(this.getPoints(a),b)};c.Path.prototype.nltransform=function(i,l,k,o,a,z){var y=this.getPoints(),b,e,g,f,h;b=0;for(e=y.length;b<e;b++){g=y[b],f=g.x,h=g.y,g.x=i*f+l*h+k,g.y=o*h+a*f+z}return y};c.Path.prototype.debug=function(k){var a=this.getBoundingBox();k||(k=document.createElement("canvas"),k.setAttribute("width",a.maxX+100),k.setAttribute("height",a.maxY+100),document.body.appendChild(k));a=k.getContext("2d");a.fillStyle="white";a.fillRect(0,0,k.width,k.height);a.strokeStyle="black";a.beginPath();var l,b,g,k=0;for(l=this.actions.length;k<l;k++){b=this.actions[k],g=b.args,b=b.action,b!=c.PathActions.CSPLINE_THRU&&a[b].apply(a,g)}a.stroke();a.closePath();a.strokeStyle="red";b=this.getPoints();k=0;for(l=b.length;k<l;k++){g=b[k],a.beginPath(),a.arc(g.x,g.y,1.5,0,Math.PI*2,!1),a.stroke(),a.closePath()}};c.Path.prototype.toShapes=function(){var g,p,o,a,f=[],e=new c.Path;g=0;for(p=this.actions.length;g<p;g++){o=this.actions[g],a=o.args,o=o.action,o==c.PathActions.MOVE_TO&&e.actions.length!=0&&(f.push(e),e=new c.Path),e[o].apply(e,a)}e.actions.length!=0&&f.push(e);if(f.length==0){return[]}var b,e=[];if(c.Shape.Utils.isClockWise(f[0].getPoints())){g=0;for(p=f.length;g<p;g++){a=f[g],c.Shape.Utils.isClockWise(a.getPoints())?(b&&e.push(b),b=new c.Shape,b.actions=a.actions,b.curves=a.curves):b.holes.push(a)}e.push(b)}else{b=new c.Shape;g=0;for(p=f.length;g<p;g++){a=f[g],c.Shape.Utils.isClockWise(a.getPoints())?(b.actions=a.actions,b.curves=a.curves,e.push(b),b=new c.Shape):b.holes.push(a)}}return e};c.Shape=function(){c.Path.apply(this,arguments);this.holes=[]};c.Shape.prototype=new c.Path;c.Shape.prototype.constructor=c.Path;c.Shape.prototype.extrude=function(a){return new c.ExtrudeGeometry(this,a)};c.Shape.prototype.getPointsHoles=function(i){var a,j=this.holes.length,b=[];for(a=0;a<j;a++){b[a]=this.holes[a].getTransformedPoints(i,this.bends)}return b};c.Shape.prototype.getSpacedPointsHoles=function(i){var a,j=this.holes.length,b=[];for(a=0;a<j;a++){b[a]=this.holes[a].getTransformedSpacedPoints(i,this.bends)}return b};c.Shape.prototype.extractAllPoints=function(a){return{shape:this.getTransformedPoints(a),holes:this.getPointsHoles(a)}};c.Shape.prototype.extractAllSpacedPoints=function(a){return{shape:this.getTransformedSpacedPoints(a),holes:this.getSpacedPointsHoles(a)}};c.Shape.Utils={removeHoles:function(n,r){var p=n.concat(),J=p.concat(),e,b,a,f,h,k,i,o,q,l,g=[];for(h=0;h<r.length;h++){k=r[h];Array.prototype.push.apply(J,k);b=Number.POSITIVE_INFINITY;for(e=0;e<k.length;e++){q=k[e];l=[];for(o=0;o<p.length;o++){i=p[o],i=q.distanceToSquared(i),l.push(i),i<b&&(b=i,a=e,f=o)}}e=f-1>=0?f-1:p.length-1;b=a-1>=0?a-1:k.length-1;var m=[k[a],p[f],p[e]];o=c.FontUtils.Triangulate.area(m);var I=[k[a],k[b],p[f]];q=c.FontUtils.Triangulate.area(I);l=f;i=a;f+=1;a+=-1;f<0&&(f+=p.length);f%=p.length;a<0&&(a+=k.length);a%=k.length;e=f-1>=0?f-1:p.length-1;b=a-1>=0?a-1:k.length-1;m=[k[a],p[f],p[e]];m=c.FontUtils.Triangulate.area(m);I=[k[a],k[b],p[f]];I=c.FontUtils.Triangulate.area(I);o+q>m+I&&(f=l,a=i,f<0&&(f+=p.length),f%=p.length,a<0&&(a+=k.length),a%=k.length,e=f-1>=0?f-1:p.length-1,b=a-1>=0?a-1:k.length-1);o=p.slice(0,f);q=p.slice(f);l=k.slice(a);i=k.slice(0,a);b=[k[a],k[b],p[f]];g.push([k[a],p[f],p[e]]);g.push(b);p=o.concat(l).concat(i).concat(q)}return{shape:p,isolatedPts:g,allpoints:J}},triangulateShape:function(u,a){var v=c.Shape.Utils.removeHoles(u,a),b=v.allpoints,g=v.isolatedPts,v=c.FontUtils.Triangulate(v.shape,!1),f,e,h,i,l={};f=0;for(e=b.length;f<e;f++){i=b[f].x+":"+b[f].y,l[i]!==void 0&&console.log("Duplicate point",i),l[i]=f}f=0;for(e=v.length;f<e;f++){h=v[f];for(b=0;b<3;b++){i=h[b].x+":"+h[b].y,i=l[i],i!==void 0&&(h[b]=i)}}f=0;for(e=g.length;f<e;f++){h=g[f];for(b=0;b<3;b++){i=h[b].x+":"+h[b].y,i=l[i],i!==void 0&&(h[b]=i)}}return v.concat(g)},isClockWise:function(a){return c.FontUtils.Triangulate.area(a)<0},b2p0:function(b,a){var g=1-b;return g*g*a},b2p1:function(b,a){return 2*(1-b)*b*a},b2p2:function(b,a){return b*b*a},b2:function(i,a,j,b){return this.b2p0(i,a)+this.b2p1(i,j)+this.b2p2(i,b)},b3p0:function(b,a){var g=1-b;return g*g*g*a},b3p1:function(b,a){var g=1-b;return 3*g*g*b*a},b3p2:function(b,a){return 3*(1-b)*b*b*a},b3p3:function(b,a){return b*b*b*a},b3:function(k,a,l,b,g){return this.b3p0(k,a)+this.b3p1(k,l)+this.b3p2(k,b)+this.b3p3(k,g)}};c.TextPath=function(b,a){c.Path.call(this);this.parameters=a||{};this.set(b)};c.TextPath.prototype.set=function(m,a){this.text=m;var a=a||this.parameters,n=a.curveSegments!==void 0?a.curveSegments:4,b=a.font!==void 0?a.font:"helvetiker",g=a.weight!==void 0?a.weight:"normal",f=a.style!==void 0?a.style:"normal";c.FontUtils.size=a.size!==void 0?a.size:100;c.FontUtils.divisions=n;c.FontUtils.face=b;c.FontUtils.weight=g;c.FontUtils.style=f};c.TextPath.prototype.toShapes=function(){for(var i=c.FontUtils.drawText(this.text).paths,a=[],j=0,b=i.length;j<b;j++){Array.prototype.push.apply(a,i[j].toShapes())}return a};c.AnimationHandler=function(){var i=[],a={},j={update:function(f){for(var e=0;e<i.length;e++){i[e].update(f)}},addToUpdate:function(e){i.indexOf(e)===-1&&i.push(e)},removeFromUpdate:function(e){e=i.indexOf(e);e!==-1&&i.splice(e,1)},add:function(e){a[e.name]!==void 0&&console.log("THREE.AnimationHandler.add: Warning! "+e.name+" already exists in library. Overwriting.");a[e.name]=e;if(e.initialized!==!0){for(var r=0;r<e.hierarchy.length;r++){for(var g=0;g<e.hierarchy[r].keys.length;g++){if(e.hierarchy[r].keys[g].time<0){e.hierarchy[r].keys[g].time=0}if(e.hierarchy[r].keys[g].rot!==void 0&&!(e.hierarchy[r].keys[g].rot instanceof c.Quaternion)){var h=e.hierarchy[r].keys[g].rot;e.hierarchy[r].keys[g].rot=new c.Quaternion(h[0],h[1],h[2],h[3])}}if(e.hierarchy[r].keys[0].morphTargets!==void 0){h={};for(g=0;g<e.hierarchy[r].keys.length;g++){for(var k=0;k<e.hierarchy[r].keys[g].morphTargets.length;k++){var f=e.hierarchy[r].keys[g].morphTargets[k];h[f]=-1}}e.hierarchy[r].usedMorphTargets=h;for(g=0;g<e.hierarchy[r].keys.length;g++){var l={};for(f in h){for(k=0;k<e.hierarchy[r].keys[g].morphTargets.length;k++){if(e.hierarchy[r].keys[g].morphTargets[k]===f){l[f]=e.hierarchy[r].keys[g].morphTargetsInfluences[k];break}}k===e.hierarchy[r].keys[g].morphTargets.length&&(l[f]=0)}e.hierarchy[r].keys[g].morphTargetsInfluences=l}}for(g=1;g<e.hierarchy[r].keys.length;g++){e.hierarchy[r].keys[g].time===e.hierarchy[r].keys[g-1].time&&(e.hierarchy[r].keys.splice(g,1),g--)}for(g=1;g<e.hierarchy[r].keys.length;g++){e.hierarchy[r].keys[g].index=g}}g=parseInt(e.length*e.fps,10);e.JIT={};e.JIT.hierarchy=[];for(r=0;r<e.hierarchy.length;r++){e.JIT.hierarchy.push(Array(g))}e.initialized=!0}},get:function(e){if(typeof e==="string"){return a[e]?a[e]:(console.log("THREE.AnimationHandler.get: Couldn't find animation "+e),null)}},parse:function(f){var g=[];if(f instanceof c.SkinnedMesh){for(var e=0;e<f.bones.length;e++){g.push(f.bones[e])}}else{b(f,g)}return g}},b=function(f,g){g.push(f);for(var e=0;e<f.children.length;e++){b(f.children[e],g)}};j.LINEAR=0;j.CATMULLROM=1;j.CATMULLROM_FORWARD=2;return j}();c.Animation=function(i,a,j,b){this.root=i;this.data=c.AnimationHandler.get(a);this.hierarchy=c.AnimationHandler.parse(i);this.currentTime=0;this.timeScale=1;this.isPlaying=!1;this.loop=this.isPaused=!0;this.interpolationType=j!==void 0?j:c.AnimationHandler.LINEAR;this.JITCompile=b!==void 0?b:!0;this.points=[];this.target=new c.Vector3};c.Animation.prototype.play=function(m,a){if(!this.isPlaying){this.isPlaying=!0;this.loop=m!==void 0?m:!0;this.currentTime=a!==void 0?a:0;var n,b=this.hierarchy.length,g;for(n=0;n<b;n++){g=this.hierarchy[n];if(this.interpolationType!==c.AnimationHandler.CATMULLROM_FORWARD){g.useQuaternion=!0}g.matrixAutoUpdate=!0;if(g.animationCache===void 0){g.animationCache={},g.animationCache.prevKey={pos:0,rot:0,scl:0},g.animationCache.nextKey={pos:0,rot:0,scl:0},g.animationCache.originalMatrix=g instanceof c.Bone?g.skinMatrix:g.matrix}var f=g.animationCache.prevKey;g=g.animationCache.nextKey;f.pos=this.data.hierarchy[n].keys[0];f.rot=this.data.hierarchy[n].keys[0];f.scl=this.data.hierarchy[n].keys[0];g.pos=this.getNextKeyWith("pos",n,1);g.rot=this.getNextKeyWith("rot",n,1);g.scl=this.getNextKeyWith("scl",n,1)}this.update(0)}this.isPaused=!1;c.AnimationHandler.addToUpdate(this)};c.Animation.prototype.pause=function(){this.isPaused?c.AnimationHandler.addToUpdate(this):c.AnimationHandler.removeFromUpdate(this);this.isPaused=!this.isPaused};c.Animation.prototype.stop=function(){this.isPaused=this.isPlaying=!1;c.AnimationHandler.removeFromUpdate(this);for(var a=0;a<this.hierarchy.length;a++){if(this.hierarchy[a].animationCache!==void 0){this.hierarchy[a] instanceof c.Bone?this.hierarchy[a].skinMatrix=this.hierarchy[a].animationCache.originalMatrix:this.hierarchy[a].matrix=this.hierarchy[a].animationCache.originalMatrix,delete this.hierarchy[a].animationCache}}};c.Animation.prototype.update=function(r){if(this.isPlaying){var a=["pos","rot","scl"],H,e,i,g,f,k,l,n,m=this.data.JIT.hierarchy,G,b;this.currentTime+=r*this.timeScale;b=this.currentTime;G=this.currentTime%=this.data.length;n=parseInt(Math.min(G*this.data.fps,this.data.length*this.data.fps),10);for(var o=0,h=this.hierarchy.length;o<h;o++){if(r=this.hierarchy[o],l=r.animationCache,this.JITCompile&&m[o][n]!==void 0){r instanceof c.Bone?(r.skinMatrix=m[o][n],r.matrixAutoUpdate=!1,r.matrixWorldNeedsUpdate=!1):(r.matrix=m[o][n],r.matrixAutoUpdate=!1,r.matrixWorldNeedsUpdate=!0)}else{if(this.JITCompile){r instanceof c.Bone?r.skinMatrix=r.animationCache.originalMatrix:r.matrix=r.animationCache.originalMatrix}for(var p=0;p<3;p++){H=a[p];f=l.prevKey[H];k=l.nextKey[H];if(k.time<=b){if(G<b){if(this.loop){f=this.data.hierarchy[o].keys[0];for(k=this.getNextKeyWith(H,o,1);k.time<G;){f=k,k=this.getNextKeyWith(H,o,k.index+1)}}else{this.stop();return}}else{do{f=k,k=this.getNextKeyWith(H,o,k.index+1)}while(k.time<G)}l.prevKey[H]=f;l.nextKey[H]=k}r.matrixAutoUpdate=!0;r.matrixWorldNeedsUpdate=!0;e=(G-f.time)/(k.time-f.time);i=f[H];g=k[H];if(e<0||e>1){console.log("THREE.Animation.update: Warning! Scale out of bounds:"+e+" on bone "+o),e=e<0?0:1}if(H==="pos"){if(H=r.position,this.interpolationType===c.AnimationHandler.LINEAR){H.x=i[0]+(g[0]-i[0])*e,H.y=i[1]+(g[1]-i[1])*e,H.z=i[2]+(g[2]-i[2])*e}else{if(this.interpolationType===c.AnimationHandler.CATMULLROM||this.interpolationType===c.AnimationHandler.CATMULLROM_FORWARD){if(this.points[0]=this.getPrevKeyWith("pos",o,f.index-1).pos,this.points[1]=i,this.points[2]=g,this.points[3]=this.getNextKeyWith("pos",o,k.index+1).pos,e=e*0.33+0.33,i=this.interpolateCatmullRom(this.points,e),H.x=i[0],H.y=i[1],H.z=i[2],this.interpolationType===c.AnimationHandler.CATMULLROM_FORWARD){e=this.interpolateCatmullRom(this.points,e*1.01),this.target.set(e[0],e[1],e[2]),this.target.subSelf(H),this.target.y=0,this.target.normalize(),e=Math.atan2(this.target.x,this.target.z),r.rotation.set(0,e,0)}}}}else{if(H==="rot"){c.Quaternion.slerp(i,g,r.quaternion,e)}else{if(H==="scl"){H=r.scale,H.x=i[0]+(g[0]-i[0])*e,H.y=i[1]+(g[1]-i[1])*e,H.z=i[2]+(g[2]-i[2])*e}}}}}}if(this.JITCompile&&m[0][n]===void 0){this.hierarchy[0].update(null,!0);for(o=0;o<this.hierarchy.length;o++){m[o][n]=this.hierarchy[o] instanceof c.Bone?this.hierarchy[o].skinMatrix.clone():this.hierarchy[o].matrix.clone()}}}};c.Animation.prototype.interpolateCatmullRom=function(u,a){var v=[],b=[],g,f,e,h,i,l;g=(u.length-1)*a;f=Math.floor(g);g-=f;v[0]=f===0?f:f-1;v[1]=f;v[2]=f>u.length-2?f:f+1;v[3]=f>u.length-3?f:f+2;f=u[v[0]];h=u[v[1]];i=u[v[2]];l=u[v[3]];v=g*g;e=g*v;b[0]=this.interpolate(f[0],h[0],i[0],l[0],g,v,e);b[1]=this.interpolate(f[1],h[1],i[1],l[1],g,v,e);b[2]=this.interpolate(f[2],h[2],i[2],l[2],g,v,e);return b};c.Animation.prototype.interpolate=function(g,p,o,a,f,e,b){g=(o-g)*0.5;a=(a-p)*0.5;return(2*(p-o)+g+a)*b+(-3*(p-o)-2*g-a)*e+g*f+p};c.Animation.prototype.getNextKeyWith=function(i,a,j){var b=this.data.hierarchy[a].keys;for(this.interpolationType===c.AnimationHandler.CATMULLROM||this.interpolationType===c.AnimationHandler.CATMULLROM_FORWARD?j=j<b.length-1?j:b.length-1:j%=b.length;j<b.length;j++){if(b[j][i]!==void 0){return b[j]}}return this.data.hierarchy[a].keys[0]};c.Animation.prototype.getPrevKeyWith=function(i,a,j){for(var b=this.data.hierarchy[a].keys,j=this.interpolationType===c.AnimationHandler.CATMULLROM||this.interpolationType===c.AnimationHandler.CATMULLROM_FORWARD?j>0?j:0:j>=0?j:j+b.length;j>=0;j--){if(b[j][i]!==void 0){return b[j]}}return this.data.hierarchy[a].keys[b.length-1]};c.CubeCamera=function(i,a,j,b){this.heightOffset=j;this.position=new c.Vector3(0,j,0);this.cameraPX=new c.PerspectiveCamera(90,1,i,a);this.cameraNX=new c.PerspectiveCamera(90,1,i,a);this.cameraPY=new c.PerspectiveCamera(90,1,i,a);this.cameraNY=new c.PerspectiveCamera(90,1,i,a);this.cameraPZ=new c.PerspectiveCamera(90,1,i,a);this.cameraNZ=new c.PerspectiveCamera(90,1,i,a);this.cameraPX.position=this.position;this.cameraNX.position=this.position;this.cameraPY.position=this.position;this.cameraNY.position=this.position;this.cameraPZ.position=this.position;this.cameraNZ.position=this.position;this.cameraPX.up.set(0,-1,0);this.cameraNX.up.set(0,-1,0);this.cameraPY.up.set(0,0,1);this.cameraNY.up.set(0,0,-1);this.cameraPZ.up.set(0,-1,0);this.cameraNZ.up.set(0,-1,0);this.targetPX=new c.Vector3(0,0,0);this.targetNX=new c.Vector3(0,0,0);this.targetPY=new c.Vector3(0,0,0);this.targetNY=new c.Vector3(0,0,0);this.targetPZ=new c.Vector3(0,0,0);this.targetNZ=new c.Vector3(0,0,0);this.renderTarget=new c.WebGLRenderTargetCube(b,b,{format:c.RGBFormat,magFilter:c.LinearFilter,minFilter:c.LinearFilter});this.updatePosition=function(e){this.position.copy(e);this.position.y+=this.heightOffset;this.targetPX.copy(this.position);this.targetNX.copy(this.position);this.targetPY.copy(this.position);this.targetNY.copy(this.position);this.targetPZ.copy(this.position);this.targetNZ.copy(this.position);this.targetPX.x+=1;this.targetNX.x-=1;this.targetPY.y+=1;this.targetNY.y-=1;this.targetPZ.z+=1;this.targetNZ.z-=1;this.cameraPX.lookAt(this.targetPX);this.cameraNX.lookAt(this.targetNX);this.cameraPY.lookAt(this.targetPY);this.cameraNY.lookAt(this.targetNY);this.cameraPZ.lookAt(this.targetPZ);this.cameraNZ.lookAt(this.targetNZ)};this.updateCubeMap=function(f,g){var e=this.renderTarget;e.activeCubeFace=0;f.render(g,this.cameraPX,e);e.activeCubeFace=1;f.render(g,this.cameraNX,e);e.activeCubeFace=2;f.render(g,this.cameraPY,e);e.activeCubeFace=3;f.render(g,this.cameraNY,e);e.activeCubeFace=4;f.render(g,this.cameraPZ,e);e.activeCubeFace=5;f.render(g,this.cameraNZ,e)}};c.FirstPersonCamera=function(){console.warn("DEPRECATED: FirstPersonCamera() is FirstPersonControls().")};c.PathCamera=function(){console.warn("DEPRECATED: PathCamera() is PathControls().")};c.FlyCamera=function(){console.warn("DEPRECATED: FlyCamera() is FlyControls().")};c.RollCamera=function(){console.warn("DEPRECATED: RollCamera() is RollControls().")};c.TrackballCamera=function(){console.warn("DEPRECATED: TrackballCamera() is TrackballControls().")};c.CombinedCamera=function(g,p,o,a,f,e,b){c.Camera.call(this);this.fov=o;this.left=-g/2;this.right=g/2;this.top=p/2;this.bottom=-p/2;this.cameraO=new c.OrthographicCamera(g/-2,g/2,p/2,p/-2,e,b);this.cameraP=new c.PerspectiveCamera(o,g/p,a,f);this.zoom=1;this.toPerspective()};c.CombinedCamera.prototype=new c.Camera;c.CombinedCamera.prototype.constructor=c.CoolCamera;c.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near;this.far=this.cameraP.far;this.cameraP.fov=this.fov/this.zoom;this.cameraP.updateProjectionMatrix();this.projectionMatrix=this.cameraP.projectionMatrix;this.inPersepectiveMode=!0;this.inOrthographicMode=!1};c.CombinedCamera.prototype.toOrthographic=function(){var b=Math.tan(this.fov/2)*((this.cameraP.near+this.cameraP.far)/2),a=2*b*this.cameraP.aspect/2;b/=this.zoom;a/=this.zoom;this.cameraO.left=-a;this.cameraO.right=a;this.cameraO.top=b;this.cameraO.bottom=-b;this.cameraO.updateProjectionMatrix();this.near=this.cameraO.near;this.far=this.cameraO.far;this.projectionMatrix=this.cameraO.projectionMatrix;this.inPersepectiveMode=!1;this.inOrthographicMode=!0};c.CombinedCamera.prototype.setFov=function(a){this.fov=a;this.inPersepectiveMode?this.toPerspective():this.toOrthographic()};c.CombinedCamera.prototype.setLens=function(b,a){a||(a=43.25);var g=2*Math.atan(a/(b*2));g*=180/Math.PI;this.setFov(g);return g};c.CombinedCamera.prototype.setZoom=function(a){this.zoom=a;this.inPersepectiveMode?this.toPerspective():this.toOrthographic()};c.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=!1};c.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0;this.rotation.y=Math.PI;this.rotation.z=0;this.rotationAutoUpdate=!1};c.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0;this.rotation.y=-Math.PI/2;this.rotation.z=0;this.rotationAutoUpdate=!1};c.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0;this.rotation.y=Math.PI/2;this.rotation.z=0;this.rotationAutoUpdate=!1};c.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=!1};c.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=!1};c.FirstPersonControls=function(b,a){function g(e,f){return function(){f.apply(e,arguments)}}this.object=b;this.target=new c.Vector3(0,0,0);this.domElement=a!==void 0?a:document;this.movementSpeed=1;this.lookSpeed=0.005;this.noFly=!1;this.lookVertical=!0;this.autoForward=!1;this.activeLook=!0;this.heightSpeed=!1;this.heightCoef=1;this.heightMin=0;this.constrainVertical=!1;this.verticalMin=0;this.verticalMax=Math.PI;this.theta=this.phi=this.lon=this.lat=this.mouseY=this.mouseX=this.autoSpeedFactor=0;this.mouseDragOn=this.freeze=this.moveRight=this.moveLeft=this.moveBackward=this.moveForward=!1;this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2,this.domElement.setAttribute("tabindex",-1));this.onMouseDown=function(e){this.domElement!==document&&this.domElement.focus();e.preventDefault();e.stopPropagation();if(this.activeLook){switch(e.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}}this.mouseDragOn=!0};this.onMouseUp=function(e){e.preventDefault();e.stopPropagation();if(this.activeLook){switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}}this.mouseDragOn=!1};this.onMouseMove=function(e){this.domElement===document?(this.mouseX=e.pageX-this.viewHalfX,this.mouseY=e.pageY-this.viewHalfY):(this.mouseX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=e.pageY-this.domElement.offsetTop-this.viewHalfY)};this.onKeyDown=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 82:this.moveUp=!0;break;case 70:this.moveDown=!0;break;case 81:this.freeze=!this.freeze}};this.onKeyUp=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1;break;case 82:this.moveUp=!1;break;case 70:this.moveDown=!1}};this.update=function(f){var j=0;if(!this.freeze){if(this.heightSpeed){var e=c.Math.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=f*e*this.heightCoef}else{this.autoSpeedFactor=0}j=f*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(j+this.autoSpeedFactor));this.moveBackward&&this.object.translateZ(j);this.moveLeft&&this.object.translateX(-j);this.moveRight&&this.object.translateX(j);this.moveUp&&this.object.translateY(j);this.moveDown&&this.object.translateY(-j);e=f*this.lookSpeed;this.activeLook||(e=0);this.lon+=this.mouseX*e;this.lookVertical&&(this.lat-=this.mouseY*e);this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=(90-this.lat)*Math.PI/180;this.theta=this.lon*Math.PI/180;f=this.target;j=this.object.position;f.x=j.x+100*Math.sin(this.phi)*Math.cos(this.theta);f.y=j.y+100*Math.cos(this.phi);f.z=j.z+100*Math.sin(this.phi)*Math.sin(this.theta)}f=1;this.constrainVertical&&(f=Math.PI/(this.verticalMax-this.verticalMin));this.lon+=this.mouseX*e;this.lookVertical&&(this.lat-=this.mouseY*e*f);this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=(90-this.lat)*Math.PI/180;this.theta=this.lon*Math.PI/180;if(this.constrainVertical){this.phi=c.Math.mapLinear(this.phi,0,Math.PI,this.verticalMin,this.verticalMax)}f=this.target;j=this.object.position;f.x=j.x+100*Math.sin(this.phi)*Math.cos(this.theta);f.y=j.y+100*Math.cos(this.phi);f.z=j.z+100*Math.sin(this.phi)*Math.sin(this.theta);this.object.lookAt(f)};this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1);this.domElement.addEventListener("mousemove",g(this,this.onMouseMove),!1);this.domElement.addEventListener("mousedown",g(this,this.onMouseDown),!1);this.domElement.addEventListener("mouseup",g(this,this.onMouseUp),!1);this.domElement.addEventListener("keydown",g(this,this.onKeyDown),!1);this.domElement.addEventListener("keyup",g(this,this.onKeyUp),!1)};c.PathControls=function(f,h){function g(i){if((i*=2)<1){return 0.5*i*i}return -0.5*(--i*(i-2)-1)}function q(i,j){return function(){j.apply(i,arguments)}}function b(k,l,m,n){var o={name:m,fps:0.6,length:n,hierarchy:[]},p,t=l.getControlPointsArray(),C=l.getLength(),i=t.length,j=0;p=i-1;l={parent:-1,keys:[]};l.keys[0]={time:0,pos:t[0],rot:[0,0,0,1],scl:[1,1,1]};l.keys[p]={time:n,pos:t[p],rot:[0,0,0,1],scl:[1,1,1]};for(p=1;p<i-1;p++){j=n*C.chunks[p]/C.total,l.keys[p]={time:j,pos:t[p]}}o.hierarchy[0]=l;c.AnimationHandler.add(o);return new c.Animation(k,m,c.AnimationHandler.CATMULLROM_FORWARD,!1)}function a(k,m){var j,l,i=new c.Geometry;for(j=0;j<k.points.length*m;j++){l=j/(k.points.length*m),l=k.getPoint(l),i.vertices[j]=new c.Vertex(new c.Vector3(l.x,l.y,l.z))}return i}this.object=f;this.domElement=h!==void 0?h:document;this.id="PathControls"+c.PathControlsIdCounter++;this.duration=10000;this.waypoints=[];this.useConstantSpeed=!0;this.resamplingCoef=50;this.debugPath=new c.Object3D;this.debugDummy=new c.Object3D;this.animationParent=new c.Object3D;this.lookSpeed=0.005;this.lookHorizontal=this.lookVertical=!0;this.verticalAngleMap={srcRange:[0,2*Math.PI],dstRange:[0,2*Math.PI]};this.horizontalAngleMap={srcRange:[0,2*Math.PI],dstRange:[0,2*Math.PI]};this.target=new c.Object3D;this.theta=this.phi=this.lon=this.lat=this.mouseY=this.mouseX=0;this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2,this.domElement.setAttribute("tabindex",-1));var r=Math.PI*2,e=Math.PI/180;this.update=function(k){var i;this.lookHorizontal&&(this.lon+=this.mouseX*this.lookSpeed*k);this.lookVertical&&(this.lat-=this.mouseY*this.lookSpeed*k);this.lon=Math.max(0,Math.min(360,this.lon));this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=(90-this.lat)*e;this.theta=this.lon*e;k=this.phi%r;this.phi=k>=0?k:k+r;i=this.verticalAngleMap.srcRange;k=this.verticalAngleMap.dstRange;i=c.Math.mapLinear(this.phi,i[0],i[1],k[0],k[1]);var j=k[1]-k[0];this.phi=g((i-k[0])/j)*j+k[0];i=this.horizontalAngleMap.srcRange;k=this.horizontalAngleMap.dstRange;i=c.Math.mapLinear(this.theta,i[0],i[1],k[0],k[1]);j=k[1]-k[0];this.theta=g((i-k[0])/j)*j+k[0];k=this.target.position;k.x=100*Math.sin(this.phi)*Math.cos(this.theta);k.y=100*Math.cos(this.phi);k.z=100*Math.sin(this.phi)*Math.sin(this.theta);this.object.lookAt(this.target.position)};this.onMouseMove=function(i){this.domElement===document?(this.mouseX=i.pageX-this.viewHalfX,this.mouseY=i.pageY-this.viewHalfY):(this.mouseX=i.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=i.pageY-this.domElement.offsetTop-this.viewHalfY)};this.init=function(){this.spline=new c.Spline;this.spline.initFromArray(this.waypoints);this.useConstantSpeed&&this.spline.reparametrizeByArcLength(this.resamplingCoef);if(this.createDebugDummy){var k=new c.MeshLambertMaterial({color:30719}),m=new c.MeshLambertMaterial({color:65280}),i=new c.CubeGeometry(10,10,20),j=new c.CubeGeometry(2,2,10);this.animationParent=new c.Mesh(i,k);k=new c.Mesh(j,m);k.position.set(0,10,0);this.animation=b(this.animationParent,this.spline,this.id,this.duration);this.animationParent.add(this.object);this.animationParent.add(this.target);this.animationParent.add(k)}else{this.animation=b(this.animationParent,this.spline,this.id,this.duration),this.animationParent.add(this.target),this.animationParent.add(this.object)}if(this.createDebugPath){var k=this.debugPath,m=this.spline,j=a(m,10),i=a(m,10),l=new c.LineBasicMaterial({color:16711680,linewidth:3}),j=new c.Line(j,l),i=new c.ParticleSystem(i,new c.ParticleBasicMaterial({color:16755200,size:3}));j.scale.set(1,1,1);k.add(j);i.scale.set(1,1,1);k.add(i);for(var j=new c.SphereGeometry(1,16,8),l=new c.MeshBasicMaterial({color:65280}),n=0;n<m.points.length;n++){i=new c.Mesh(j,l),i.position.copy(m.points[n]),k.add(i)}}this.domElement.addEventListener("mousemove",q(this,this.onMouseMove),!1)}};c.PathControlsIdCounter=0;c.FlyControls=function(b,a){function g(e,f){return function(){f.apply(e,arguments)}}this.object=b;this.domElement=a!==void 0?a:document;a&&this.domElement.setAttribute("tabindex",-1);this.movementSpeed=1;this.rollSpeed=0.005;this.autoForward=this.dragToLook=!1;this.object.useQuaternion=!0;this.tmpQuaternion=new c.Quaternion;this.mouseStatus=0;this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0};this.moveVector=new c.Vector3(0,0,0);this.rotationVector=new c.Vector3(0,0,0);this.handleEvent=function(e){if(typeof this[e.type]=="function"){this[e.type](e)}};this.keydown=function(e){if(!e.altKey){switch(e.keyCode){case 16:this.movementSpeedMultiplier=0.1;break;case 87:this.moveState.forward=1;break;case 83:this.moveState.back=1;break;case 65:this.moveState.left=1;break;case 68:this.moveState.right=1;break;case 82:this.moveState.up=1;break;case 70:this.moveState.down=1;break;case 38:this.moveState.pitchUp=1;break;case 40:this.moveState.pitchDown=1;break;case 37:this.moveState.yawLeft=1;break;case 39:this.moveState.yawRight=1;break;case 81:this.moveState.rollLeft=1;break;case 69:this.moveState.rollRight=1}this.updateMovementVector();this.updateRotationVector()}};this.keyup=function(e){switch(e.keyCode){case 16:this.movementSpeedMultiplier=1;break;case 87:this.moveState.forward=0;break;case 83:this.moveState.back=0;break;case 65:this.moveState.left=0;break;case 68:this.moveState.right=0;break;case 82:this.moveState.up=0;break;case 70:this.moveState.down=0;break;case 38:this.moveState.pitchUp=0;break;case 40:this.moveState.pitchDown=0;break;case 37:this.moveState.yawLeft=0;break;case 39:this.moveState.yawRight=0;break;case 81:this.moveState.rollLeft=0;break;case 69:this.moveState.rollRight=0}this.updateMovementVector();this.updateRotationVector()};this.mousedown=function(e){this.domElement!==document&&this.domElement.focus();e.preventDefault();e.stopPropagation();if(this.dragToLook){this.mouseStatus++}else{switch(e.button){case 0:this.object.moveForward=!0;break;case 2:this.object.moveBackward=!0}}};this.mousemove=function(k){if(!this.dragToLook||this.mouseStatus>0){var l=this.getContainerDimensions(),e=l.size[0]/2,f=l.size[1]/2;this.moveState.yawLeft=-(k.pageX-l.offset[0]-e)/e;this.moveState.pitchDown=(k.pageY-l.offset[1]-f)/f;this.updateRotationVector()}};this.mouseup=function(e){e.preventDefault();e.stopPropagation();if(this.dragToLook){this.mouseStatus--,this.moveState.yawLeft=this.moveState.pitchDown=0}else{switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}}this.updateRotationVector()};this.update=function(e){var f=e*this.movementSpeed;e*=this.rollSpeed;this.object.translateX(this.moveVector.x*f);this.object.translateY(this.moveVector.y*f);this.object.translateZ(this.moveVector.z*f);this.tmpQuaternion.set(this.rotationVector.x*e,this.rotationVector.y*e,this.rotationVector.z*e,1).normalize();this.object.quaternion.multiplySelf(this.tmpQuaternion);this.object.matrix.setPosition(this.object.position);this.object.matrix.setRotationFromQuaternion(this.object.quaternion);this.object.matrixWorldNeedsUpdate=!0};this.updateMovementVector=function(){var e=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right;this.moveVector.y=-this.moveState.down+this.moveState.up;this.moveVector.z=-e+this.moveState.back};this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp;this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft;this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft};this.getContainerDimensions=function(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}};this.domElement.addEventListener("mousemove",g(this,this.mousemove),!1);this.domElement.addEventListener("mousedown",g(this,this.mousedown),!1);this.domElement.addEventListener("mouseup",g(this,this.mouseup),!1);this.domElement.addEventListener("keydown",g(this,this.keydown),!1);this.domElement.addEventListener("keyup",g(this,this.keyup),!1);this.updateMovementVector();this.updateRotationVector()};c.RollControls=function(a,f){this.object=a;this.domElement=f!==void 0?f:document;this.mouseLook=!0;this.autoForward=!1;this.rollSpeed=this.movementSpeed=this.lookSpeed=1;this.constrainVertical=[-0.9,0.9];this.object.matrixAutoUpdate=!1;this.forward=new c.Vector3(0,0,1);this.roll=0;var e=new c.Vector3,g=new c.Vector3,m=new c.Vector3,l=new c.Matrix4,k=!1,o=1,p=0,E=0,r=0,b=0,h=0,F=window.innerWidth/2,i=window.innerHeight/2;this.update=function(n){if(this.mouseLook){var j=n*this.lookSpeed;this.rotateHorizontally(j*b);this.rotateVertically(j*h)}j=n*this.movementSpeed;this.object.translateZ(-j*(p>0||this.autoForward&&!(p<0)?1:p));this.object.translateX(j*E);this.object.translateY(j*r);k&&(this.roll+=this.rollSpeed*n*o);if(this.forward.y>this.constrainVertical[1]){this.forward.y=this.constrainVertical[1],this.forward.normalize()}else{if(this.forward.y<this.constrainVertical[0]){this.forward.y=this.constrainVertical[0],this.forward.normalize()}}m.copy(this.forward);g.set(0,1,0);e.cross(g,m).normalize();g.cross(m,e).normalize();this.object.matrix.n11=e.x;this.object.matrix.n12=g.x;this.object.matrix.n13=m.x;this.object.matrix.n21=e.y;this.object.matrix.n22=g.y;this.object.matrix.n23=m.y;this.object.matrix.n31=e.z;this.object.matrix.n32=g.z;this.object.matrix.n33=m.z;l.identity();l.n11=Math.cos(this.roll);l.n12=-Math.sin(this.roll);l.n21=Math.sin(this.roll);l.n22=Math.cos(this.roll);this.object.matrix.multiplySelf(l);this.object.matrixWorldNeedsUpdate=!0;this.object.matrix.n14=this.object.position.x;this.object.matrix.n24=this.object.position.y;this.object.matrix.n34=this.object.position.z};this.translateX=function(j){this.object.position.x+=this.object.matrix.n11*j;this.object.position.y+=this.object.matrix.n21*j;this.object.position.z+=this.object.matrix.n31*j};this.translateY=function(j){this.object.position.x+=this.object.matrix.n12*j;this.object.position.y+=this.object.matrix.n22*j;this.object.position.z+=this.object.matrix.n32*j};this.translateZ=function(j){this.object.position.x-=this.object.matrix.n13*j;this.object.position.y-=this.object.matrix.n23*j;this.object.position.z-=this.object.matrix.n33*j};this.rotateHorizontally=function(j){e.set(this.object.matrix.n11,this.object.matrix.n21,this.object.matrix.n31);e.multiplyScalar(j);this.forward.subSelf(e);this.forward.normalize()};this.rotateVertically=function(j){g.set(this.object.matrix.n12,this.object.matrix.n22,this.object.matrix.n32);g.multiplyScalar(j);this.forward.addSelf(g);this.forward.normalize()};this.domElement.addEventListener("contextmenu",function(j){j.preventDefault()},!1);this.domElement.addEventListener("mousemove",function(j){b=(j.clientX-F)/window.innerWidth;h=(j.clientY-i)/window.innerHeight},!1);this.domElement.addEventListener("mousedown",function(j){j.preventDefault();j.stopPropagation();switch(j.button){case 0:p=1;break;case 2:p=-1}},!1);this.domElement.addEventListener("mouseup",function(j){j.preventDefault();j.stopPropagation();switch(j.button){case 0:p=0;break;case 2:p=0}},!1);this.domElement.addEventListener("keydown",function(j){switch(j.keyCode){case 38:case 87:p=1;break;case 37:case 65:E=-1;break;case 40:case 83:p=-1;break;case 39:case 68:E=1;break;case 81:k=!0;o=1;break;case 69:k=!0;o=-1;break;case 82:r=1;break;case 70:r=-1}},!1);this.domElement.addEventListener("keyup",function(j){switch(j.keyCode){case 38:case 87:p=0;break;case 37:case 65:E=0;break;case 40:case 83:p=0;break;case 39:case 68:E=0;break;case 81:k=!1;break;case 69:k=!1;break;case 82:r=0;break;case 70:r=0}},!1)};c.TrackballControls=function(h,k){var i=this,l={NONE:-1,ROTATE:0,ZOOM:1,PAN:2};this.object=h;this.domElement=k!==void 0?k:document;this.enabled=!0;this.screen={width:window.innerWidth,height:window.innerHeight,offsetLeft:0,offsetTop:0};this.radius=(this.screen.width+this.screen.height)/4;this.rotateSpeed=1;this.zoomSpeed=1.2;this.panSpeed=0.3;this.staticMoving=this.noPan=this.noZoom=this.noRotate=!1;this.dynamicDampingFactor=0.2;this.minDistance=0;this.maxDistance=Infinity;this.keys=[65,83,68];this.target=new c.Vector3(0,0,0);var A=!1,p=l.NONE,o=new c.Vector3,B=new c.Vector3,a=new c.Vector3,e=new c.Vector2,b=new c.Vector2,f=new c.Vector2,g=new c.Vector2;this.handleEvent=function(j){if(typeof this[j.type]=="function"){this[j.type](j)}};this.getMouseOnScreen=function(m,j){return new c.Vector2((m-i.screen.offsetLeft)/i.radius*0.5,(j-i.screen.offsetTop)/i.radius*0.5)};this.getMouseProjectionOnBall=function(q,j){var m=new c.Vector3((q-i.screen.width*0.5-i.screen.offsetLeft)/i.radius,(i.screen.height*0.5+i.screen.offsetTop-j)/i.radius,0),n=m.length();n>1?m.normalize():m.z=Math.sqrt(1-n*n);o.copy(i.object.position).subSelf(i.target);n=i.object.up.clone().setLength(m.y);n.addSelf(i.object.up.clone().crossSelf(o).setLength(m.x));n.addSelf(o.setLength(m.z));return n};this.rotateCamera=function(){var n=Math.acos(B.dot(a)/B.length()/a.length());if(n){var j=(new c.Vector3).cross(B,a).normalize(),m=new c.Quaternion;n*=i.rotateSpeed;m.setFromAxisAngle(j,-n);m.multiplyVector3(o);m.multiplyVector3(i.object.up);m.multiplyVector3(a);i.staticMoving?B=a:(m.setFromAxisAngle(j,n*(i.dynamicDampingFactor-1)),m.multiplyVector3(B))}};this.zoomCamera=function(){var j=1+(b.y-e.y)*i.zoomSpeed;j!==1&&j>0&&(o.multiplyScalar(j),i.staticMoving?e=b:e.y+=(b.y-e.y)*this.dynamicDampingFactor)};this.panCamera=function(){var m=g.clone().subSelf(f);if(m.lengthSq()){m.multiplyScalar(o.length()*i.panSpeed);var j=o.clone().crossSelf(i.object.up).setLength(m.x);j.addSelf(i.object.up.clone().setLength(m.y));i.object.position.addSelf(j);i.target.addSelf(j);i.staticMoving?f=g:f.addSelf(m.sub(g,f).multiplyScalar(i.dynamicDampingFactor))}};this.checkDistances=function(){if(!i.noZoom||!i.noPan){i.object.position.lengthSq()>i.maxDistance*i.maxDistance&&i.object.position.setLength(i.maxDistance),o.lengthSq()<i.minDistance*i.minDistance&&i.object.position.add(i.target,o.setLength(i.minDistance))}};this.update=function(){o.copy(i.object.position).subSelf(this.target);i.noRotate||i.rotateCamera();i.noZoom||i.zoomCamera();i.noPan||i.panCamera();i.object.position.add(i.target,o);i.checkDistances();i.object.lookAt(i.target)};this.domElement.addEventListener("contextmenu",function(j){j.preventDefault()},!1);this.domElement.addEventListener("mousemove",function(j){i.enabled&&(A&&(B=a=i.getMouseProjectionOnBall(j.clientX,j.clientY),e=b=i.getMouseOnScreen(j.clientX,j.clientY),f=g=i.getMouseOnScreen(j.clientX,j.clientY),A=!1),p!==l.NONE&&(p===l.ROTATE&&!i.noRotate?a=i.getMouseProjectionOnBall(j.clientX,j.clientY):p===l.ZOOM&&!i.noZoom?b=i.getMouseOnScreen(j.clientX,j.clientY):p===l.PAN&&!i.noPan&&(g=i.getMouseOnScreen(j.clientX,j.clientY))))},!1);this.domElement.addEventListener("mousedown",function(j){if(i.enabled&&(j.preventDefault(),j.stopPropagation(),p===l.NONE)){p=j.button,p===l.ROTATE&&!i.noRotate?B=a=i.getMouseProjectionOnBall(j.clientX,j.clientY):p===l.ZOOM&&!i.noZoom?e=b=i.getMouseOnScreen(j.clientX,j.clientY):this.noPan||(f=g=i.getMouseOnScreen(j.clientX,j.clientY))}},!1);this.domElement.addEventListener("mouseup",function(j){if(i.enabled){j.preventDefault(),j.stopPropagation(),p=l.NONE}},!1);window.addEventListener("keydown",function(j){if(i.enabled&&p===l.NONE){if(j.keyCode===i.keys[l.ROTATE]&&!i.noRotate){p=l.ROTATE}else{if(j.keyCode===i.keys[l.ZOOM]&&!i.noZoom){p=l.ZOOM}else{if(j.keyCode===i.keys[l.PAN]&&!i.noPan){p=l.PAN}}}p!==l.NONE&&(A=!0)}},!1);window.addEventListener("keyup",function(){if(i.enabled&&p!==l.NONE){p=l.NONE}},!1)};c.CubeGeometry=function(a,e,b,f,m,k,h,o){function p(J,K,L,M,N,j,s,v){var x,y=f||1,z=m||1,A=N/2,B=j/2,C=t.vertices.length;if(J==="x"&&K==="y"||J==="y"&&K==="x"){x="z"}else{if(J==="x"&&K==="z"||J==="z"&&K==="x"){x="y",z=k||1}else{if(J==="z"&&K==="y"||J==="y"&&K==="z"){x="x",y=k||1}}}var D=y+1,F=z+1,E=N/y,G=j/z,H=new c.Vector3;H[x]=s>0?1:-1;for(N=0;N<F;N++){for(j=0;j<D;j++){var I=new c.Vector3;I[J]=(j*E-A)*L;I[K]=(N*G-B)*M;I[x]=s;t.vertices.push(new c.Vertex(I))}}for(N=0;N<z;N++){for(j=0;j<y;j++){J=new c.Face4(j+D*N+C,j+D*(N+1)+C,j+1+D*(N+1)+C,j+1+D*N+C),J.normal.copy(H),J.vertexNormals.push(H.clone(),H.clone(),H.clone(),H.clone()),J.materialIndex=v,t.faces.push(J),t.faceVertexUvs[0].push([new c.UV(j/y,N/z),new c.UV(j/y,(N+1)/z),new c.UV((j+1)/y,(N+1)/z),new c.UV((j+1)/y,N/z)])}}}c.Geometry.call(this);var t=this,q=a/2,O=e/2,g=b/2,u,l,w,i,n,P;if(h!==void 0){if(h instanceof Array){this.materials=h}else{this.materials=[];for(u=0;u<6;u++){this.materials.push(h)}}u=0;i=1;l=2;n=3;w=4;P=5}else{this.materials=[]}this.sides={px:!0,nx:!0,py:!0,ny:!0,pz:!0,nz:!0};if(o!=void 0){for(var r in o){this.sides[r]!=void 0&&(this.sides[r]=o[r])}}this.sides.px&&p("z","y",-1,-1,b,e,q,u);this.sides.nx&&p("z","y",1,-1,b,e,-q,i);this.sides.py&&p("x","z",1,1,a,b,O,l);this.sides.ny&&p("x","z",1,-1,a,b,-O,n);this.sides.pz&&p("x","y",1,-1,a,e,g,w);this.sides.nz&&p("x","y",-1,-1,a,e,-g,P);this.computeCentroids();this.mergeVertices()};c.CubeGeometry.prototype=new c.Geometry;c.CubeGeometry.prototype.constructor=c.CubeGeometry;c.CylinderGeometry=function(a,e,b,f,i,h){c.Geometry.call(this);var a=a!=null?a:20,e=e!=null?e:20,b=b||100,g=b/2,f=f||8,i=i||1,l,m,q=[],p=[];for(m=0;m<=i;m++){var B=[],F=[],t=m/i,n=t*(e-a)+a;for(l=0;l<=f;l++){var u=l/f;this.vertices.push(new c.Vertex(new c.Vector3(n*Math.sin(u*Math.PI*2),-t*b+g,n*Math.cos(u*Math.PI*2))));B.push(this.vertices.length-1);F.push(new c.UV(u,t))}q.push(B);p.push(F)}for(m=0;m<i;m++){for(l=0;l<f;l++){var b=q[m][l],B=q[m+1][l],F=q[m+1][l+1],t=q[m][l+1],n=this.vertices[b].position.clone().setY(0).normalize(),u=this.vertices[B].position.clone().setY(0).normalize(),S=this.vertices[F].position.clone().setY(0).normalize(),o=this.vertices[t].position.clone().setY(0).normalize(),T=p[m][l].clone(),r=p[m+1][l].clone(),k=p[m+1][l+1].clone(),w=p[m][l+1].clone();this.faces.push(new c.Face4(b,B,F,t,[n,u,S,o]));this.faceVertexUvs[0].push([T,r,k,w])}}if(!h&&a>0){this.vertices.push(new c.Vertex(new c.Vector3(0,g,0)));for(l=0;l<f;l++){b=q[0][l],B=q[0][l+1],F=this.vertices.length-1,n=new c.Vector3(0,1,0),u=new c.Vector3(0,1,0),S=new c.Vector3(0,1,0),T=p[0][l].clone(),r=p[0][l+1].clone(),k=new c.UV(r.u,0),this.faces.push(new c.Face3(b,B,F,[n,u,S])),this.faceVertexUvs[0].push([T,r,k])}}if(!h&&e>0){this.vertices.push(new c.Vertex(new c.Vector3(0,-g,0)));for(l=0;l<f;l++){b=q[m][l+1],B=q[m][l],F=this.vertices.length-1,n=new c.Vector3(0,-1,0),u=new c.Vector3(0,-1,0),S=new c.Vector3(0,-1,0),T=p[m][l+1].clone(),r=p[m][l].clone(),k=new c.UV(r.u,1),this.faces.push(new c.Face3(b,B,F,[n,u,S])),this.faceVertexUvs[0].push([T,r,k])}}this.computeCentroids();this.computeFaceNormals()};c.CylinderGeometry.prototype=new c.Geometry;c.CylinderGeometry.prototype.constructor=c.CylinderGeometry;c.ExtrudeGeometry=function(k,a){if(typeof k!=="undefined"){c.Geometry.call(this);var k=k instanceof Array?k:[k],l,b=k.length,g;this.shapebb=k[b-1].getBoundingBox();for(l=0;l<b;l++){g=k[l],this.addShape(g,a)}this.computeCentroids();this.computeFaceNormals()}};c.ExtrudeGeometry.prototype=new c.Geometry;c.ExtrudeGeometry.prototype.constructor=c.ExtrudeGeometry;c.ExtrudeGeometry.prototype.addShape=function(S,W){function U(z,C,j){C||console.log("die");return C.clone().multiplyScalar(j).addSelf(z)}function aa(V,j,z){var C=c.ExtrudeGeometry.__v1,D=c.ExtrudeGeometry.__v2,L=c.ExtrudeGeometry.__v3,N=c.ExtrudeGeometry.__v4,Q=c.ExtrudeGeometry.__v5,T=c.ExtrudeGeometry.__v6;C.set(V.x-j.x,V.y-j.y);D.set(V.x-z.x,V.y-z.y);C=C.normalize();D=D.normalize();L.set(-C.y,C.x);N.set(D.y,-D.x);Q.copy(V).addSelf(L);T.copy(V).addSelf(N);if(Q.equals(T)){return N.clone()}Q.copy(j).addSelf(L);T.copy(z).addSelf(N);L=C.dot(N);N=T.subSelf(Q).dot(N);L===0&&(console.log("Either infinite or no solutions!"),N===0?console.log("Its finite solutions."):console.log("Too bad, no solutions."));N/=L;if(N<0){return j=Math.atan2(j.y-V.y,j.x-V.x),V=Math.atan2(z.y-V.y,z.x-V.x),j>V&&(V+=Math.PI*2),V=(j+V)/2,new c.Vector2(-Math.cos(V),-Math.sin(V))}return C.multiplyScalar(N).addSelf(Q).subSelf(V).clone()}function g(V){for(w=V.length;--w>=0;){K=w;R=w-1;R<0&&(R=V.length-1);for(var j=0,z=o+l*2,j=0;j<z;j++){var C=u*j,D=u*(j+1),L=ad+K+C,N=ad+K+D,Q=L,C=ad+R+C,D=ad+R+D,T=N;Q+=k;C+=k;D+=k;T+=k;B.faces.push(new c.Face4(Q,C,D,T,null,null,M));M&&(Q=j/z,C=(j+1)/z,D=h+i*2,L=(B.vertices[L].position.z+i)/D,N=(B.vertices[N].position.z+i)/D,B.faceVertexUvs[0].push([new c.UV(L,Q),new c.UV(N,Q),new c.UV(N,C),new c.UV(L,C)]))}}}function e(z,C,j){B.vertices.push(new c.Vertex(new c.Vector3(z,C,j)))}function ab(D,L,N){D+=k;L+=k;N+=k;B.faces.push(new c.Face3(D,L,N,null,null,A));if(A){var Q=P.maxY,j=P.maxX,z=B.vertices[L].position.x,L=B.vertices[L].position.y,C=B.vertices[N].position.x,N=B.vertices[N].position.y;B.faceVertexUvs[0].push([new c.UV(B.vertices[D].position.x/j,B.vertices[D].position.y/Q),new c.UV(z/j,L/Q),new c.UV(C/j,N/Q)])}}var h=W.amount!==void 0?W.amount:100,i=W.bevelThickness!==void 0?W.bevelThickness:6,m=W.bevelSize!==void 0?W.bevelSize:i-2,l=W.bevelSegments!==void 0?W.bevelSegments:3,r=W.bevelEnabled!==void 0?W.bevelEnabled:!0,s=W.curveSegments!==void 0?W.curveSegments:12,o=W.steps!==void 0?W.steps:1,v=W.bendPath,q=W.extrudePath,t,y=!1,E=W.useSpacedPoints!==void 0?W.useSpacedPoints:!1,A=W.material,M=W.extrudeMaterial,P=this.shapebb;if(q){t=q.getPoints(s),o=t.length,y=!0,r=!1}r||(m=i=l=0);var I,F,G,B=this,k=this.vertices.length;v&&S.addWrapPath(v);s=E?S.extractAllSpacedPoints(s):S.extractAllPoints(s);v=s.shape;s=s.holes;if(q=!c.Shape.Utils.isClockWise(v)){v=v.reverse();F=0;for(G=s.length;F<G;F++){I=s[F],c.Shape.Utils.isClockWise(I)&&(s[F]=I.reverse())}q=!1}q=c.Shape.Utils.triangulateShape(v,s);E=v;F=0;for(G=s.length;F<G;F++){I=s[F],v=v.concat(I)}var w,O,J,ac,n,x,u=v.length,H=q.length,b=[];w=0;O=E.length;K=O-1;for(R=w+1;w<O;w++,K++,R++){K===O&&(K=0),R===O&&(R=0),b[w]=aa(E[w],E[K],E[R])}var a=[],f,p=b.concat();F=0;for(G=s.length;F<G;F++){I=s[F];f=[];w=0;O=I.length;K=O-1;for(R=w+1;w<O;w++,K++,R++){K===O&&(K=0),R===O&&(R=0),f[w]=aa(I[w],I[K],I[R])}a.push(f);p=p.concat(f)}for(J=0;J<l;J++){ac=J/l;n=i*(1-ac);ac=m*Math.sin(ac*Math.PI/2);w=0;for(O=E.length;w<O;w++){x=U(E[w],b[w],ac),e(x.x,x.y,-n)}F=0;for(G=s.length;F<G;F++){I=s[F];f=a[F];w=0;for(O=I.length;w<O;w++){x=U(I[w],f[w],ac),e(x.x,x.y,-n)}}}ac=m;for(w=0;w<u;w++){x=r?U(v[w],p[w],ac):v[w],y?e(x.x,x.y+t[0].y,t[0].x):e(x.x,x.y,0)}for(J=1;J<=o;J++){for(w=0;w<u;w++){x=r?U(v[w],p[w],ac):v[w],y?e(x.x,x.y+t[J-1].y,t[J-1].x):e(x.x,x.y,h/o*J)}}for(J=l-1;J>=0;J--){ac=J/l;n=i*(1-ac);ac=m*Math.sin(ac*Math.PI/2);w=0;for(O=E.length;w<O;w++){x=U(E[w],b[w],ac),e(x.x,x.y,h+n)}F=0;for(G=s.length;F<G;F++){I=s[F];f=a[F];w=0;for(O=I.length;w<O;w++){x=U(I[w],f[w],ac),y?e(x.x,x.y+t[o-1].y,t[o-1].x+n):e(x.x,x.y,h+n)}}}if(r){r=u*0;for(w=0;w<H;w++){m=q[w],ab(m[2]+r,m[1]+r,m[0]+r)}r=u*(o+l*2);for(w=0;w<H;w++){m=q[w],ab(m[0]+r,m[1]+r,m[2]+r)}}else{for(w=0;w<H;w++){m=q[w],ab(m[2],m[1],m[0])}for(w=0;w<H;w++){m=q[w],ab(m[0]+u*o,m[1]+u*o,m[2]+u*o)}}var K,R,ad=0;g(E);ad+=E.length;F=0;for(G=s.length;F<G;F++){I=s[F],g(I),ad+=I.length}};c.ExtrudeGeometry.__v1=new c.Vector2;c.ExtrudeGeometry.__v2=new c.Vector2;c.ExtrudeGeometry.__v3=new c.Vector2;c.ExtrudeGeometry.__v4=new c.Vector2;c.ExtrudeGeometry.__v5=new c.Vector2;c.ExtrudeGeometry.__v6=new c.Vector2;c.IcosahedronGeometry=function(k){function w(n,o,j){var m=Math.sqrt(n*n+o*o+j*j);return e.vertices.push(new c.Vertex(new c.Vector3(n/m,o/m,j/m)))-1}function l(p,q,r,j){var n=e.vertices[p].position,m=e.vertices[q].position,o=e.vertices[r].position,p=new c.Face3(p,q,r);p.vertexNormals.push(n.clone().normalize(),m.clone().normalize(),o.clone().normalize());j.faces.push(p);j.faceVertexUvs[0].push([new c.UV(1-(Math.atan2(n.z,n.x)+Math.PI)%Math.PI/Math.PI*0.5,0.5-n.y/2),new c.UV(1-(Math.atan2(m.z,m.x)+Math.PI)%Math.PI/Math.PI*0.5,0.5-m.y/2),new c.UV(1-(Math.atan2(o.z,o.x)+Math.PI)%Math.PI/Math.PI*0.5,0.5-o.y/2)])}function x(n,o){var j=e.vertices[n].position,m=e.vertices[o].position;return w((j.x+m.x)/2,(j.y+m.y)/2,(j.z+m.z)/2)}var e=this,b=new c.Geometry;this.subdivisions=k||0;c.Geometry.call(this);k=(1+Math.sqrt(5))/2;w(-1,k,0);w(1,k,0);w(-1,-k,0);w(1,-k,0);w(0,-1,k);w(0,1,k);w(0,-1,-k);w(0,1,-k);w(k,0,-1);w(k,0,1);w(-k,0,-1);w(-k,0,1);l(0,11,5,b);l(0,5,1,b);l(0,1,7,b);l(0,7,10,b);l(0,10,11,b);l(1,5,9,b);l(5,11,4,b);l(11,10,2,b);l(10,7,6,b);l(7,1,8,b);l(3,9,4,b);l(3,4,2,b);l(3,2,6,b);l(3,6,8,b);l(3,8,9,b);l(4,9,5,b);l(2,4,11,b);l(6,2,10,b);l(8,6,7,b);l(9,8,1,b);for(var a=0;a<this.subdivisions;a++){var k=new c.Geometry,f;for(f in b.faces){var g=x(b.faces[f].a,b.faces[f].b),i=x(b.faces[f].b,b.faces[f].c),h=x(b.faces[f].c,b.faces[f].a);l(b.faces[f].a,g,h,k);l(b.faces[f].b,i,g,k);l(b.faces[f].c,h,i,k);l(g,i,h,k)}b.faces=k.faces;b.faceVertexUvs[0]=k.faceVertexUvs[0]}e.faces=b.faces;e.faceVertexUvs[0]=b.faceVertexUvs[0];this.computeCentroids();this.computeFaceNormals()};c.IcosahedronGeometry.prototype=new c.Geometry;c.IcosahedronGeometry.prototype.constructor=c.IcosahedronGeometry;c.LatheGeometry=function(a,e,b){c.Geometry.call(this);this.steps=e||12;this.angle=b||2*Math.PI;for(var e=this.angle/this.steps,b=[],f=[],i=[],h=[],g=(new c.Matrix4).setRotationZ(e),s=0;s<a.length;s++){this.vertices.push(new c.Vertex(a[s])),b[s]=a[s].clone(),f[s]=this.vertices.length-1}for(var t=0;t<=this.angle+0.001;t+=e){for(s=0;s<b.length;s++){t<this.angle?(b[s]=g.multiplyVector3(b[s].clone()),this.vertices.push(new c.Vertex(b[s])),i[s]=this.vertices.length-1):i=h}t==0&&(h=f);for(s=0;s<f.length-1;s++){this.faces.push(new c.Face4(i[s],i[s+1],f[s+1],f[s])),this.faceVertexUvs[0].push([new c.UV(1-t/this.angle,s/a.length),new c.UV(1-t/this.angle,(s+1)/a.length),new c.UV(1-(t-e)/this.angle,(s+1)/a.length),new c.UV(1-(t-e)/this.angle,s/a.length)])}f=i;i=[]}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};c.LatheGeometry.prototype=new c.Geometry;c.LatheGeometry.prototype.constructor=c.LatheGeometry;c.OctahedronGeometry=function(a,e){function b(k){var j=k.clone().normalize(),j=new c.Vertex(j.clone().multiplyScalar(a));j.index=g.vertices.push(j)-1;j.uv=new c.UV(Math.atan2(k.z,-k.x)/2/Math.PI+0.5,Math.atan2(-k.y,Math.sqrt(k.x*k.x+k.z*k.z))/Math.PI+0.5);return j}function f(l,m,j,k){k<1?(k=new c.Face3(l.index,m.index,j.index,[l.position,m.position,j.position]),k.centroid.addSelf(l.position).addSelf(m.position).addSelf(j.position).divideScalar(3),k.normal=k.centroid.clone().normalize(),g.faces.push(k),k=Math.atan2(k.centroid.z,-k.centroid.x),g.faceVertexUvs[0].push([h(l.uv,l.position,k),h(m.uv,m.position,k),h(j.uv,j.position,k)])):(k-=1,f(l,i(l,m),i(l,j),k),f(i(l,m),m,i(m,j),k),f(i(l,j),i(m,j),j,k),f(i(l,m),i(m,j),i(l,j),k))}function i(l,j){s[l.index]||(s[l.index]=[]);s[j.index]||(s[j.index]=[]);var k=s[l.index][j.index];k===void 0&&(s[l.index][j.index]=s[j.index][l.index]=k=b((new c.Vector3).add(l.position,j.position).divideScalar(2)));return k}function h(k,l,j){j<0&&k.u===1&&(k=new c.UV(k.u-1,k.v));l.x===0&&l.z===0&&(k=new c.UV(j/2/Math.PI+0.5,k.v));return k}c.Geometry.call(this);var e=e||0,g=this;b(new c.Vector3(1,0,0));b(new c.Vector3(-1,0,0));b(new c.Vector3(0,1,0));b(new c.Vector3(0,-1,0));b(new c.Vector3(0,0,1));b(new c.Vector3(0,0,-1));var s=[],t=this.vertices;f(t[0],t[2],t[4],e);f(t[0],t[4],t[3],e);f(t[0],t[3],t[5],e);f(t[0],t[5],t[2],e);f(t[1],t[2],t[5],e);f(t[1],t[5],t[3],e);f(t[1],t[3],t[4],e);f(t[1],t[4],t[2],e);this.boundingSphere={radius:a}};c.OctahedronGeometry.prototype=new c.Geometry;c.OctahedronGeometry.prototype.constructor=c.OctahedronGeometry;c.PlaneGeometry=function(k,w,l,x){c.Geometry.call(this);for(var e=k/2,b=w/2,l=l||1,x=x||1,a=l+1,f=x+1,g=k/l,i=w/x,h=new c.Vector3(0,0,1),k=0;k<f;k++){for(w=0;w<a;w++){this.vertices.push(new c.Vertex(new c.Vector3(w*g-e,-(k*i-b),0)))}}for(k=0;k<x;k++){for(w=0;w<l;w++){e=new c.Face4(w+a*k,w+a*(k+1),w+1+a*(k+1),w+1+a*k),e.normal.copy(h),e.vertexNormals.push(h.clone(),h.clone(),h.clone(),h.clone()),this.faces.push(e),this.faceVertexUvs[0].push([new c.UV(w/l,k/x),new c.UV(w/l,(k+1)/x),new c.UV((w+1)/l,(k+1)/x),new c.UV((w+1)/l,k/x)])}}this.computeCentroids()};c.PlaneGeometry.prototype=new c.Geometry;c.PlaneGeometry.prototype.constructor=c.PlaneGeometry;c.SphereGeometry=function(a,f,b,h,n,l,k){c.Geometry.call(this);var a=a||50,f=Math.max(3,Math.floor(f)||8),b=Math.max(2,Math.floor(b)||6),h=h!=void 0?h:0,n=n!=void 0?n:Math.PI*2,l=l!=void 0?l:0,k=k!=void 0?k:Math.PI,p,r,w=[],t=[];for(r=0;r<=b;r++){var g=[],i=[];for(p=0;p<=f;p++){var M=p/f,o=r/b;this.vertices.push(new c.Vertex(new c.Vector3(-a*Math.cos(h+M*n)*Math.sin(l+o*k),a*Math.cos(l+o*k),a*Math.sin(h+M*n)*Math.sin(l+o*k))));g.push(this.vertices.length-1);i.push(new c.UV(M,o))}w.push(g);t.push(i)}for(r=0;r<b;r++){for(p=0;p<f;p++){var h=w[r][p+1],n=w[r][p],l=w[r+1][p],k=w[r+1][p+1],g=this.vertices[h].position.clone().normalize(),i=this.vertices[n].position.clone().normalize(),M=this.vertices[l].position.clone().normalize(),o=this.vertices[k].position.clone().normalize(),e=t[r][p+1].clone(),m=t[r][p].clone(),q=t[r+1][p].clone(),N=t[r+1][p+1].clone();Math.abs(this.vertices[h].position.y)==a?(this.faces.push(new c.Face3(h,l,k,[g,M,o])),this.faceVertexUvs[0].push([e,q,N])):Math.abs(this.vertices[l].position.y)==a?(this.faces.push(new c.Face3(h,n,l,[g,i,M])),this.faceVertexUvs[0].push([e,m,q])):(this.faces.push(new c.Face4(h,n,l,k,[g,i,M,o])),this.faceVertexUvs[0].push([e,m,q,N]))}}this.computeCentroids();this.computeFaceNormals();this.boundingSphere={radius:a}};c.SphereGeometry.prototype=new c.Geometry;c.SphereGeometry.prototype.constructor=c.SphereGeometry;c.TextGeometry=function(i,a){var j=(new c.TextPath(i,a)).toShapes();a.amount=a.height!==void 0?a.height:50;if(a.bevelThickness===void 0){a.bevelThickness=10}if(a.bevelSize===void 0){a.bevelSize=8}if(a.bevelEnabled===void 0){a.bevelEnabled=!1}if(a.bend){var b=j[j.length-1].getBoundingBox().maxX;a.bendPath=new c.QuadraticBezierCurve(new c.Vector2(0,0),new c.Vector2(b/2,120),new c.Vector2(b,0))}c.ExtrudeGeometry.call(this,j,a)};c.TextGeometry.prototype=new c.ExtrudeGeometry;c.TextGeometry.prototype.constructor=c.TextGeometry;c.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(b){var a=b.familyName.toLowerCase();this.faces[a]=this.faces[a]||{};this.faces[a][b.cssFontWeight]=this.faces[a][b.cssFontWeight]||{};this.faces[a][b.cssFontWeight][b.cssFontStyle]=b;return this.faces[a][b.cssFontWeight][b.cssFontStyle]=b},drawText:function(f){for(var h=this.getFace(),g=this.size/h.resolution,q=0,b=String(f).split(""),a=b.length,r=[],f=0;f<a;f++){var e=new c.Path,e=this.extractGlyphPoints(b[f],h,g,q,e);q+=e.offset;r.push(e.path)}return{paths:r,offset:q/2}},extractGlyphPoints:function(a,e,b,f,m){var k=[],h,o,p,t,q,O,g,u,l,w,i,n=e.glyphs[a]||e.glyphs["?"];if(n){if(n.o){e=n._cachedOutline||(n._cachedOutline=n.o.split(" "));t=e.length;for(a=0;a<t;){switch(p=e[a++],p){case"m":p=e[a++]*b+f;q=e[a++]*b;k.push(new c.Vector2(p,q));m.moveTo(p,q);break;case"l":p=e[a++]*b+f;q=e[a++]*b;k.push(new c.Vector2(p,q));m.lineTo(p,q);break;case"q":p=e[a++]*b+f;q=e[a++]*b;u=e[a++]*b+f;l=e[a++]*b;m.quadraticCurveTo(u,l,p,q);if(h=k[k.length-1]){O=h.x;g=h.y;h=1;for(o=this.divisions;h<=o;h++){var P=h/o,r=c.Shape.Utils.b2(P,O,u,p),P=c.Shape.Utils.b2(P,g,l,q);k.push(new c.Vector2(r,P))}}break;case"b":if(p=e[a++]*b+f,q=e[a++]*b,u=e[a++]*b+f,l=e[a++]*-b,w=e[a++]*b+f,i=e[a++]*-b,m.bezierCurveTo(p,q,u,l,w,i),h=k[k.length-1]){O=h.x;g=h.y;h=1;for(o=this.divisions;h<=o;h++){P=h/o,r=c.Shape.Utils.b3(P,O,u,w,p),P=c.Shape.Utils.b3(P,g,l,i,q),k.push(new c.Vector2(r,P))}}}}}return{offset:n.ha*b,points:k,path:m}}}};(function(b){var a=function(n){for(var e=n.length,m=0,g=e-1,f=0;f<e;g=f++){m+=n[g].x*n[f].y-n[f].x*n[g].y}return m*0.5};b.Triangulate=function(i,l){var r=i.length;if(r<3){return null}var o=[],m=[],s=[],t,w,u;if(a(i)>0){for(w=0;w<r;w++){m[w]=w}}else{for(w=0;w<r;w++){m[w]=r-1-w}}var B=2*r;for(w=r-1;r>2;){if(B--<=0){console.log("Warning, unable to triangulate polygon!");if(l){return s}return o}t=w;r<=t&&(t=0);w=t+1;r<=w&&(w=0);u=w+1;r<=u&&(u=0);var E;i:{E=i;var x=t,G=w,A=u,F=r,I=m,P=void 0,K=void 0,g=void 0,k=void 0,f=void 0,R=void 0,U=void 0,M=void 0,v=void 0,K=E[I[x]].x,g=E[I[x]].y,k=E[I[G]].x,f=E[I[G]].y,R=E[I[A]].x,U=E[I[A]].y;if(1e-10>(k-K)*(U-g)-(f-g)*(R-K)){E=!1}else{for(P=0;P<F;P++){if(!(P==x||P==G||P==A)){var M=E[I[P]].x,v=E[I[P]].y,H=void 0,h=void 0,ab=void 0,ac=void 0,y=void 0,aa=void 0,O=void 0,e=void 0,p=void 0,n=void 0,q=void 0,J=void 0,H=ab=y=void 0,H=R-k,h=U-f,ab=K-R,ac=g-U,y=k-K,aa=f-g,O=M-K,e=v-g,p=M-k,n=v-f,q=M-R,J=v-U,H=H*n-h*p,y=y*e-aa*O,ab=ab*J-ac*q;if(H>=0&&ab>=0&&y>=0){E=!1;break i}}}E=!0}}if(E){o.push([i[m[t]],i[m[w]],i[m[u]]]);s.push([m[t],m[w],m[u]]);t=w;for(u=w+1;u<r;t++,u++){m[t]=m[u]}r--;B=2*r}}if(l){return s}return o};b.Triangulate.area=a;return b})(c.FontUtils);d._typeface_js={faces:c.FontUtils.faces,loadFace:c.FontUtils.loadFace};c.TorusGeometry=function(a,e,b,f,i){c.Geometry.call(this);this.radius=a||100;this.tube=e||40;this.segmentsR=b||8;this.segmentsT=f||6;this.arc=i||Math.PI*2;i=new c.Vector3;a=[];e=[];for(b=0;b<=this.segmentsR;b++){for(f=0;f<=this.segmentsT;f++){var h=f/this.segmentsT*this.arc,g=b/this.segmentsR*Math.PI*2;i.x=this.radius*Math.cos(h);i.y=this.radius*Math.sin(h);var s=new c.Vector3;s.x=(this.radius+this.tube*Math.cos(g))*Math.cos(h);s.y=(this.radius+this.tube*Math.cos(g))*Math.sin(h);s.z=this.tube*Math.sin(g);this.vertices.push(new c.Vertex(s));a.push(new c.UV(f/this.segmentsT,1-b/this.segmentsR));e.push(s.clone().subSelf(i).normalize())}}for(b=1;b<=this.segmentsR;b++){for(f=1;f<=this.segmentsT;f++){var i=(this.segmentsT+1)*b+f-1,h=(this.segmentsT+1)*(b-1)+f-1,g=(this.segmentsT+1)*(b-1)+f,s=(this.segmentsT+1)*b+f,t=new c.Face4(i,h,g,s,[e[i],e[h],e[g],e[s]]);t.normal.addSelf(e[i]);t.normal.addSelf(e[h]);t.normal.addSelf(e[g]);t.normal.addSelf(e[s]);t.normal.normalize();this.faces.push(t);this.faceVertexUvs[0].push([a[i].clone(),a[h].clone(),a[g].clone(),a[s].clone()])}}this.computeCentroids()};c.TorusGeometry.prototype=new c.Geometry;c.TorusGeometry.prototype.constructor=c.TorusGeometry;c.TorusKnotGeometry=function(k,w,l,x,e,b,a){function f(p,q,m,j,n,o){q=m/j*p;m=Math.cos(q);return new c.Vector3(n*(2+m)*0.5*Math.cos(p),n*(2+m)*Math.sin(p)*0.5,o*n*Math.sin(q)*0.5)}c.Geometry.call(this);this.radius=k||200;this.tube=w||40;this.segmentsR=l||64;this.segmentsT=x||8;this.p=e||2;this.q=b||3;this.heightScale=a||1;this.grid=Array(this.segmentsR);l=new c.Vector3;x=new c.Vector3;b=new c.Vector3;for(k=0;k<this.segmentsR;++k){this.grid[k]=Array(this.segmentsT);for(w=0;w<this.segmentsT;++w){var g=k/this.segmentsR*2*this.p*Math.PI,a=w/this.segmentsT*2*Math.PI,e=f(g,a,this.q,this.p,this.radius,this.heightScale),g=f(g+0.01,a,this.q,this.p,this.radius,this.heightScale);l.x=g.x-e.x;l.y=g.y-e.y;l.z=g.z-e.z;x.x=g.x+e.x;x.y=g.y+e.y;x.z=g.z+e.z;b.cross(l,x);x.cross(b,l);b.normalize();x.normalize();g=-this.tube*Math.cos(a);a=this.tube*Math.sin(a);e.x+=g*x.x+a*b.x;e.y+=g*x.y+a*b.y;e.z+=g*x.z+a*b.z;this.grid[k][w]=this.vertices.push(new c.Vertex(new c.Vector3(e.x,e.y,e.z)))-1}}for(k=0;k<this.segmentsR;++k){for(w=0;w<this.segmentsT;++w){var x=(k+1)%this.segmentsR,b=(w+1)%this.segmentsT,e=this.grid[k][w],l=this.grid[x][w],x=this.grid[x][b],b=this.grid[k][b],a=new c.UV(k/this.segmentsR,w/this.segmentsT),g=new c.UV((k+1)/this.segmentsR,w/this.segmentsT),i=new c.UV((k+1)/this.segmentsR,(w+1)/this.segmentsT),h=new c.UV(k/this.segmentsR,(w+1)/this.segmentsT);this.faces.push(new c.Face4(e,l,x,b));this.faceVertexUvs[0].push([a,g,i,h])}}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};c.TorusKnotGeometry.prototype=new c.Geometry;c.TorusKnotGeometry.prototype.constructor=c.TorusKnotGeometry;c.SubdivisionModifier=function(a){this.subdivisions=a===void 0?1:a;this.useOldVertexColors=!1;this.supportUVs=!0};c.SubdivisionModifier.prototype.constructor=c.SubdivisionModifier;c.SubdivisionModifier.prototype.modify=function(b){for(var a=this.subdivisions;a-->0;){this.smooth(b)}};c.SubdivisionModifier.prototype.smooth=function(w){function A(I,L,M,N,O,P){var z=new c.Face4(I,L,M,N,null,O.color,O.material);if(E.useOldVertexColors){z.vertexColors=[];for(var C,D,G,j=0;j<4;j++){G=P[j];C=new c.Color;C.setRGB(0,0,0);for(var H=0;H<G.length;H++){D=O.vertexColors[G[H]-1],C.r+=D.r,C.g+=D.g,C.b+=D.b}C.r/=G.length;C.g/=G.length;C.b/=G.length;z.vertexColors[j]=C}}J.push(z);(!E.supportUVs||e.length!=0)&&F.push([e[I],e[L],e[M],e[N]])}function y(j,z){return Math.min(j,z)+"_"+Math.max(j,z)}var B=[],J=[],F=[],E=this,K=w.vertices,B=w.faces,R=K.concat(),ac=[],U={},b={},e=[],ad,i,a,g,l,r=w.faceVertexUvs[0];ad=0;for(i=r.length;ad<i;ad++){a=0;for(g=r[ad].length;a<g;a++){l=B[ad]["abcd".charAt(a)],e[l]||(e[l]=r[ad][a])}}var n;ad=0;for(i=B.length;ad<i;ad++){if(l=B[ad],ac.push(l.centroid),R.push(new c.Vertex(l.centroid)),E.supportUVs&&e.length!=0){n=new c.UV;if(l instanceof c.Face3){n.u=e[l.a].u+e[l.b].u+e[l.c].u,n.v=e[l.a].v+e[l.b].v+e[l.c].v,n.u/=3,n.v/=3}else{if(l instanceof c.Face4){n.u=e[l.a].u+e[l.b].u+e[l.c].u+e[l.d].u,n.v=e[l.a].v+e[l.b].v+e[l.c].v+e[l.d].v,n.u/=4,n.v/=4}}e.push(n)}}i=function(D){function G(M,N,L){M[N]===void 0&&(M[N]=[]);M[N].push(L)}var H,I,j,z,C={};H=0;for(I=D.faces.length;H<I;H++){j=D.faces[H],j instanceof c.Face3?(z=y(j.a,j.b),G(C,z,H),z=y(j.b,j.c),G(C,z,H),z=y(j.c,j.a),G(C,z,H)):j instanceof c.Face4&&(z=y(j.a,j.b),G(C,z,H),z=y(j.b,j.c),G(C,z,H),z=y(j.c,j.d),G(C,z,H),z=y(j.d,j.a),G(C,z,H))}return C}(w);var h=0,r=K.length,o,f,s={},t={},p=function(j,z){s[j]===void 0&&(s[j]=[]);s[j].push(z)},u=function(j,z){t[j]===void 0&&(t[j]={});t[j][z]=null};for(ad in i){n=i[ad];o=ad.split("_");f=o[0];o=o[1];p(f,[f,o]);p(o,[f,o]);a=0;for(g=n.length;a<g;a++){l=n[a],u(f,l,ad),u(o,l,ad)}n.length<2&&(b[ad]=!0)}for(ad in i){if(n=i[ad],l=n[0],n=n[1],o=ad.split("_"),f=o[0],o=o[1],g=new c.Vector3,b[ad]?(g.addSelf(K[f].position),g.addSelf(K[o].position),g.multiplyScalar(0.5)):(g.addSelf(ac[l]),g.addSelf(ac[n]),g.addSelf(K[f].position),g.addSelf(K[o].position),g.multiplyScalar(0.25)),U[ad]=r+B.length+h,R.push(new c.Vertex(g)),h++,E.supportUVs&&e.length!=0){n=new c.UV,n.u=e[f].u+e[o].u,n.v=e[f].v+e[o].v,n.u/=2,n.v/=2,e.push(n)}}var k,m;o=["123","12","2","23"];g=["123","23","3","31"];var p=["123","31","1","12"],u=["1234","12","2","23"],q=["1234","23","3","34"],x=["1234","34","4","41"],v=["1234","41","1","12"];ad=0;for(i=ac.length;ad<i;ad++){l=B[ad],n=r+ad,l instanceof c.Face3?(h=y(l.a,l.b),f=y(l.b,l.c),k=y(l.c,l.a),A(n,U[h],l.b,U[f],l,o),A(n,U[f],l.c,U[k],l,g),A(n,U[k],l.a,U[h],l,p)):l instanceof c.Face4?(h=y(l.a,l.b),f=y(l.b,l.c),k=y(l.c,l.d),m=y(l.d,l.a),A(n,U[h],l.b,U[f],l,u),A(n,U[f],l.c,U[k],l,q),A(n,U[k],l.d,U[m],l,x),A(n,U[m],l.a,U[h],l,v)):console.log("face should be a face!",l)}B=R;R=new c.Vector3;U=new c.Vector3;ad=0;for(i=K.length;ad<i;ad++){if(s[ad]!==void 0){R.set(0,0,0);U.set(0,0,0);l=new c.Vector3(0,0,0);n=0;for(a in t[ad]){R.addSelf(ac[a]),n++}h=0;r=s[ad].length;for(a=0;a<r;a++){b[y(s[ad][a][0],s[ad][a][1])]&&h++}if(h!=2){R.divideScalar(n);for(a=0;a<r;a++){n=s[ad][a],n=K[n[0]].position.clone().addSelf(K[n[1]].position).divideScalar(2),U.addSelf(n)}U.divideScalar(r);l.addSelf(K[ad].position);l.multiplyScalar(r-3);l.addSelf(R);l.addSelf(U.multiplyScalar(2));l.divideScalar(r);B[ad].position=l}}}w.vertices=B;w.faces=J;w.faceVertexUvs[0]=F;delete w.__tmpVertices;w.computeCentroids();w.computeFaceNormals();w.computeVertexNormals()};c.Loader=function(a){this.statusDomElement=(this.showStatus=a)?c.Loader.prototype.addStatusElement():null;this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}};c.Loader.prototype={constructor:c.Loader,addStatusElement:function(){var a=document.createElement("div");a.style.position="absolute";a.style.right="0px";a.style.top="0px";a.style.fontSize="0.8em";a.style.textAlign="left";a.style.background="rgba(0,0,0,0.25)";a.style.color="#fff";a.style.width="120px";a.style.padding="0.5em 0.5em 0.5em 0.5em";a.style.zIndex=1000;a.innerHTML="Loading ...";return a},updateProgress:function(b){var a="Loaded ";a+=b.total?(100*b.loaded/b.total).toFixed(0)+"%":(b.loaded/1000).toFixed(2)+" KB";this.statusDomElement.innerHTML=a},extractUrlbase:function(a){a=a.split("/");a.pop();return a.length<1?"":a.join("/")+"/"},initMaterials:function(i,a,j){i.materials=[];for(var b=0;b<a.length;++b){i.materials[b]=c.Loader.prototype.createMaterial(a[b],j)}},hasNormals:function(i){var a,j,b=i.materials.length;for(j=0;j<b;j++){if(a=i.materials[j],a instanceof c.ShaderMaterial){return !0}}return !1},createMaterial:function(h,k){function i(j){j=Math.log(j)/Math.LN2;return Math.floor(j)==j}function l(n,j){var m=new Image;m.onload=function(){if(!i(this.width)||!i(this.height)){var q=Math.pow(2,Math.round(Math.log(this.width)/Math.LN2)),r=Math.pow(2,Math.round(Math.log(this.height)/Math.LN2));n.image.width=q;n.image.height=r;n.image.getContext("2d").drawImage(this,0,0,q,r)}else{n.image=this}n.needsUpdate=!0};m.src=j}function A(s,t,j,q,r,m){var n=document.createElement("canvas");s[t]=new c.Texture(n);s[t].sourceFile=j;if(q){s[t].repeat.set(q[0],q[1]);if(q[0]!=1){s[t].wrapS=c.RepeatWrapping}if(q[1]!=1){s[t].wrapT=c.RepeatWrapping}}r&&s[t].offset.set(r[0],r[1]);if(m){q={repeat:c.RepeatWrapping,mirror:c.MirroredRepeatWrapping};if(q[m[0]]!==void 0){s[t].wrapS=q[m[0]]}if(q[m[1]]!==void 0){s[t].wrapT=q[m[1]]}}l(s[t],k+"/"+j)}function p(j){return(j[0]*255<<16)+(j[1]*255<<8)+j[2]*255}var o,B,a;B="MeshLambertMaterial";o={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,wireframe:h.wireframe};h.shading&&(h.shading=="Phong"?B="MeshPhongMaterial":h.shading=="Basic"&&(B="MeshBasicMaterial"));if(h.blending){if(h.blending=="Additive"){o.blending=c.AdditiveBlending}else{if(h.blending=="Subtractive"){o.blending=c.SubtractiveBlending}else{if(h.blending=="Multiply"){o.blending=c.MultiplyBlending}}}}if(h.transparent!==void 0||h.opacity<1){o.transparent=h.transparent}if(h.depthTest!==void 0){o.depthTest=h.depthTest}if(h.vertexColors!==void 0){if(h.vertexColors=="face"){o.vertexColors=c.FaceColors}else{if(h.vertexColors){o.vertexColors=c.VertexColors}}}if(h.colorDiffuse){o.color=p(h.colorDiffuse)}else{if(h.DbgColor){o.color=h.DbgColor}}if(h.colorSpecular){o.specular=p(h.colorSpecular)}if(h.colorAmbient){o.ambient=p(h.colorAmbient)}if(h.transparency){o.opacity=h.transparency}if(h.specularCoef){o.shininess=h.specularCoef}h.mapDiffuse&&k&&A(o,"map",h.mapDiffuse,h.mapDiffuseRepeat,h.mapDiffuseOffset,h.mapDiffuseWrap);h.mapLight&&k&&A(o,"lightMap",h.mapLight,h.mapLightRepeat,h.mapLightOffset,h.mapLightWrap);h.mapNormal&&k&&A(o,"normalMap",h.mapNormal,h.mapNormalRepeat,h.mapNormalOffset,h.mapNormalWrap);h.mapSpecular&&k&&A(o,"specularMap",h.mapSpecular,h.mapSpecularRepeat,h.mapSpecularOffset,h.mapSpecularWrap);if(h.mapNormal){var e=c.ShaderUtils.lib.normal,b=c.UniformsUtils.clone(e.uniforms),f=o.color;B=o.specular;a=o.ambient;var g=o.shininess;b.tNormal.texture=o.normalMap;if(h.mapNormalFactor){b.uNormalScale.value=h.mapNormalFactor}if(o.map){b.tDiffuse.texture=o.map,b.enableDiffuse.value=!0}if(o.specularMap){b.tSpecular.texture=o.specularMap,b.enableSpecular.value=!0}if(o.lightMap){b.tAO.texture=o.lightMap,b.enableAO.value=!0}b.uDiffuseColor.value.setHex(f);b.uSpecularColor.value.setHex(B);b.uAmbientColor.value.setHex(a);b.uShininess.value=g;if(o.opacity){b.uOpacity.value=o.opacity}o=new c.ShaderMaterial({fragmentShader:e.fragmentShader,vertexShader:e.vertexShader,uniforms:b,lights:!0,fog:!0})}else{o=new c[B](o)}return o}};c.BinaryLoader=function(a){c.Loader.call(this,a)};c.BinaryLoader.prototype=new c.Loader;c.BinaryLoader.prototype.constructor=c.BinaryLoader;c.BinaryLoader.prototype.supr=c.Loader.prototype;c.BinaryLoader.prototype.load=function(k,a,l,b){if(k instanceof Object){console.warn("DEPRECATED: BinaryLoader( parameters ) is now BinaryLoader( url, callback, texturePath, binaryPath )."),b=k,k=b.model,a=b.callback,l=b.texture_path,b=b.bin_path}var l=l?l:this.extractUrlbase(k),b=b?b:this.extractUrlbase(k),g=this.showProgress?c.Loader.prototype.updateProgress:null;this.onLoadStart();this.loadAjaxJSON(this,k,a,l,b,g)};c.BinaryLoader.prototype.loadAjaxJSON=function(g,p,o,a,f,e){var b=new XMLHttpRequest;b.onreadystatechange=function(){if(b.readyState==4){if(b.status==200||b.status==0){try{var h=JSON.parse(b.responseText);h.metadata===void 0||h.metadata.formatVersion===void 0||h.metadata.formatVersion!==3?console.error("Deprecated file format."):g.loadAjaxBuffers(h,o,f,a,e)}catch(i){console.error(i),console.warn("DEPRECATED: ["+p+"] seems to be using old model format")}}else{console.error("Couldn't load ["+p+"] ["+b.status+"]")}}};b.open("GET",p,!0);b.overrideMimeType("text/plain; charset=x-user-defined");b.setRequestHeader("Content-Type","text/plain");b.send(null)};c.BinaryLoader.prototype.loadAjaxBuffers=function(f,h,g,q,b){var a=new XMLHttpRequest,r=g+"/"+f.buffers,e=0;a.onreadystatechange=function(){a.readyState==4?a.status==200||a.status==0?c.BinaryLoader.prototype.createBinModel(a.response,h,q,f.materials):console.error("Couldn't load ["+r+"] ["+a.status+"]"):a.readyState==3?b&&(e==0&&(e=a.getResponseHeader("Content-Length")),b({total:e,loaded:a.responseText.length})):a.readyState==2&&(e=a.getResponseHeader("Content-Length"))};a.open("GET",r,!0);a.responseType="arraybuffer";a.send(null)};c.BinaryLoader.prototype.createBinModel=function(k,a,l,b){var g=function(e){function f(s){return s%4?4-s%4:0}function h(s,z){return(new Uint8Array(s,z,1))[0]}function i(s,z){return(new Uint32Array(s,z,1))[0]}function m(D,E){var H,I,J,K,L,M,s,z,C=new Uint32Array(k,E,3*D);for(H=0;H<D;H++){I=C[H*3];J=C[H*3+1];K=C[H*3+2];L=y[I*2];I=y[I*2+1];M=y[J*2];s=y[J*2+1];J=y[K*2];z=y[K*2+1];K=o.faceVertexUvs[0];var G=[];G.push(new c.UV(L,I));G.push(new c.UV(M,s));G.push(new c.UV(J,z));K.push(G)}}function j(C,G){var H,O,z,D,I,J,K,L,M,N,s=new Uint32Array(k,G,4*C);for(H=0;H<C;H++){O=s[H*4];z=s[H*4+1];D=s[H*4+2];I=s[H*4+3];J=y[O*2];O=y[O*2+1];K=y[z*2];M=y[z*2+1];L=y[D*2];N=y[D*2+1];D=y[I*2];z=y[I*2+1];I=o.faceVertexUvs[0];var E=[];E.push(new c.UV(J,O));E.push(new c.UV(K,M));E.push(new c.UV(L,N));E.push(new c.UV(D,z));I.push(E)}}function p(C,D,E){for(var G,H,I,s,D=new Uint32Array(k,D,3*C),z=new Uint16Array(k,E,C),E=0;E<C;E++){G=D[E*3],H=D[E*3+1],I=D[E*3+2],s=z[E],o.faces.push(new c.Face3(G,H,I,null,null,s))}}function q(I,J,s){for(var z,C,D,E,G,J=new Uint32Array(k,J,4*I),H=new Uint16Array(k,s,I),s=0;s<I;s++){z=J[s*4],C=J[s*4+1],D=J[s*4+2],E=J[s*4+3],G=H[s],o.faces.push(new c.Face4(z,C,D,E,null,null,G))}}function n(s,z,D,G){for(var I,J,P,C,E,K,L,z=new Uint32Array(k,z,3*s),D=new Uint32Array(k,D,3*s),M=new Uint16Array(k,G,s),G=0;G<s;G++){I=z[G*3];J=z[G*3+1];P=z[G*3+2];E=D[G*3];K=D[G*3+1];L=D[G*3+2];C=M[G];var N=t[K*3],O=t[K*3+1];K=t[K*3+2];var H=t[L*3],Q=t[L*3+1];L=t[L*3+2];o.faces.push(new c.Face3(I,J,P,[new c.Vector3(t[E*3],t[E*3+1],t[E*3+2]),new c.Vector3(N,O,K),new c.Vector3(H,Q,L)],null,C))}}function w(M,N,O,P){for(var Q,R,S,T,s,z,C,D,E,N=new Uint32Array(k,N,4*M),O=new Uint32Array(k,O,4*M),I=new Uint16Array(k,P,M),P=0;P<M;P++){Q=N[P*4];R=N[P*4+1];S=N[P*4+2];T=N[P*4+3];z=O[P*4];C=O[P*4+1];D=O[P*4+2];E=O[P*4+3];s=I[P];var J=t[C*3],K=t[C*3+1];C=t[C*3+2];var U=t[D*3],G=t[D*3+1];D=t[D*3+2];var H=t[E*3],L=t[E*3+1];E=t[E*3+2];o.faces.push(new c.Face4(Q,R,S,T,[new c.Vector3(t[z*3],t[z*3+1],t[z*3+2]),new c.Vector3(J,K,C),new c.Vector3(U,G,D),new c.Vector3(H,L,E)],null,s))}}var o=this,u=0,x,t=[],y=[],v,B,r,A,V,F;c.Geometry.call(this);c.Loader.prototype.initMaterials(o,b,e);x={signature:function(C,D,E){for(var C=new Uint8Array(C,D,E),s="",z=0;z<E;z++){s+=String.fromCharCode(C[D+z])}return s}(k,u,12),header_bytes:h(k,u+12),vertex_coordinate_bytes:h(k,u+13),normal_coordinate_bytes:h(k,u+14),uv_coordinate_bytes:h(k,u+15),vertex_index_bytes:h(k,u+16),normal_index_bytes:h(k,u+17),uv_index_bytes:h(k,u+18),material_index_bytes:h(k,u+19),nvertices:i(k,u+20),nnormals:i(k,u+20+4),nuvs:i(k,u+20+8),ntri_flat:i(k,u+20+12),ntri_smooth:i(k,u+20+16),ntri_flat_uv:i(k,u+20+20),ntri_smooth_uv:i(k,u+20+24),nquad_flat:i(k,u+20+28),nquad_smooth:i(k,u+20+32),nquad_flat_uv:i(k,u+20+36),nquad_smooth_uv:i(k,u+20+40)};x.signature!=="Three.js 003"&&console.warn("DEPRECATED: binary model seems to be using old format");u+=x.header_bytes;e=x.vertex_index_bytes*3+x.material_index_bytes;F=x.vertex_index_bytes*4+x.material_index_bytes;v=x.ntri_flat*e;B=x.ntri_smooth*(e+x.normal_index_bytes*3);r=x.ntri_flat_uv*(e+x.uv_index_bytes*3);A=x.ntri_smooth_uv*(e+x.normal_index_bytes*3+x.uv_index_bytes*3);V=x.nquad_flat*F;e=x.nquad_smooth*(F+x.normal_index_bytes*4);F=x.nquad_flat_uv*(F+x.uv_index_bytes*4);u+=function(C){var D=x.nvertices,C=new Float32Array(k,C,D*3),E,G,s,z;for(E=0;E<D;E++){G=C[E*3],s=C[E*3+1],z=C[E*3+2],o.vertices.push(new c.Vertex(new c.Vector3(G,s,z)))}return D*3*Float32Array.BYTES_PER_ELEMENT}(u);u+=function(C){var D=x.nnormals;if(D){var C=new Int8Array(k,C,D*3),E,G,s,z;for(E=0;E<D;E++){G=C[E*3],s=C[E*3+1],z=C[E*3+2],t.push(G/127,s/127,z/127)}}return D*3*Int8Array.BYTES_PER_ELEMENT}(u);u+=f(x.nnormals*3);u+=function(D){var E=x.nuvs;if(E){var D=new Float32Array(k,D,E*2),s,z,C;for(s=0;s<E;s++){z=D[s*2],C=D[s*2+1],y.push(z,C)}}return E*2*Float32Array.BYTES_PER_ELEMENT}(u);v=u+v+f(x.ntri_flat*2);B=v+B+f(x.ntri_smooth*2);r=B+r+f(x.ntri_flat_uv*2);A=r+A+f(x.ntri_smooth_uv*2);V=A+V+f(x.nquad_flat*2);e=V+e+f(x.nquad_smooth*2);F=e+F+f(x.nquad_flat_uv*2);(function(z){var C=x.ntri_flat_uv;if(C){var s=z+C*Uint32Array.BYTES_PER_ELEMENT*3;p(C,z,s+C*Uint32Array.BYTES_PER_ELEMENT*3);m(C,s)}})(B);(function(C){var D=x.ntri_smooth_uv;if(D){var s=C+D*Uint32Array.BYTES_PER_ELEMENT*3,z=s+D*Uint32Array.BYTES_PER_ELEMENT*3;n(D,C,s,z+D*Uint32Array.BYTES_PER_ELEMENT*3);m(D,z)}})(r);(function(z){var C=x.nquad_flat_uv;if(C){var s=z+C*Uint32Array.BYTES_PER_ELEMENT*4;q(C,z,s+C*Uint32Array.BYTES_PER_ELEMENT*4);j(C,s)}})(e);(function(C){var D=x.nquad_smooth_uv;if(D){var s=C+D*Uint32Array.BYTES_PER_ELEMENT*4,z=s+D*Uint32Array.BYTES_PER_ELEMENT*4;w(D,C,s,z+D*Uint32Array.BYTES_PER_ELEMENT*4);j(D,z)}})(F);(function(s){var z=x.ntri_flat;z&&p(z,s,s+z*Uint32Array.BYTES_PER_ELEMENT*3)})(u);(function(z){var C=x.ntri_smooth;if(C){var s=z+C*Uint32Array.BYTES_PER_ELEMENT*3;n(C,z,s,s+C*Uint32Array.BYTES_PER_ELEMENT*3)}})(v);(function(s){var z=x.nquad_flat;z&&q(z,s,s+z*Uint32Array.BYTES_PER_ELEMENT*4)})(A);(function(z){var C=x.nquad_smooth;if(C){var s=z+C*Uint32Array.BYTES_PER_ELEMENT*4;w(C,z,s,s+C*Uint32Array.BYTES_PER_ELEMENT*4)}})(V);this.computeCentroids();this.computeFaceNormals();c.Loader.prototype.hasNormals(this)&&this.computeTangents()};g.prototype=new c.Geometry;g.prototype.constructor=g;a(new g(l))};c.ColladaLoader=function(){function O(L,z,C){ab=L;z=z||r;C!==void 0&&(L=C.split("/"),L.pop(),am=L.length<1?"":L.join("/")+"/");l=R("//dae:library_images/dae:image",U,"image");H=R("//dae:library_materials/dae:material",k,"material");g=R("//dae:library_effects/dae:effect",e,"effect");q=R("//dae:library_geometries/dae:geometry",ai,"geometry");ao=R("//dae:library_controllers/dae:controller",X,"controller");ak=R("//dae:library_animations/dae:animation",G,"animation");o=R(".//dae:library_visual_scenes/dae:visual_scene",ac,"visual_scene");K=[];b=[];(L=ab.evaluate(".//dae:scene/dae:instance_visual_scene",ab,A,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null).iterateNext())?(L=L.getAttribute("url").replace(/^#/,""),t=o[L]):t=null;aq=new c.Object3D;for(L=0;L<t.nodes.length;L++){aq.add(V(t.nodes[L]))}P();for(var D in ak){}D={scene:aq,morphs:K,skins:b,dae:{images:l,materials:H,effects:g,geometries:q,controllers:ao,animations:ak,visualScenes:o,scene:t}};z&&z(D);return D}function R(N,Q,z){for(var N=ab.evaluate(N,ab,A,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null),C={},D=N.iterateNext(),L=0;D;){D=(new Q).parse(D);if(D.id.length==0){D.id=z+L++}C[D.id]=D;D=N.iterateNext()}return C}function P(){var N=1000000,Q=-N,T=0,z;for(z in ak){for(var C=ak[z],D=0;D<C.sampler.length;D++){var L=C.sampler[D];L.create();N=Math.min(N,L.startTime);Q=Math.max(Q,L.endTime);T=Math.max(T,L.input.length)}}return{start:N,end:Q,frames:T}}function S(L,N,z,C){L.world=L.world||new c.Matrix4;L.world.copy(L.matrix);if(L.channels&&L.channels.length){var D=L.channels[0].sampler.output[z];D instanceof c.Matrix4&&L.world.copy(D)}C&&L.world.multiply(C,L.world);N.push(L);for(C=0;C<L.nodes.length;C++){S(L.nodes[C],N,z,L.world)}}function W(Q,Y,ar){var au=ao[Y.url];if(!au||!au.skin){console.log("ColladaLoader: Could not find skin controller.")}else{if(!Y.skeleton||!Y.skeleton.length){console.log("ColladaLoader: Could not find the skeleton for the skin. ")}else{var aw=P(),Y=t.getChildById(Y.skeleton[0],!0)||t.getChildBySid(Y.skeleton[0],!0),ay,z,C,L,N=new c.Vector3,T;for(ay=0;ay<Q.vertices.length;ay++){au.skin.bindShapeMatrix.multiplyVector3(Q.vertices[ay].position)}for(ar=0;ar<aw.frames;ar++){var Z=[],at=[];for(ay=0;ay<Q.vertices.length;ay++){at.push(new c.Vertex(new c.Vector3))}S(Y,Z,ar);ay=Z;z=au.skin;for(L=0;L<ay.length;L++){if(C=ay[L],T=-1,C.type=="JOINT"){for(var av=0;av<z.joints.length;av++){if(C.sid==z.joints[av]){T=av;break}}if(T>=0){av=z.invBindMatrices[T];C.invBindMatrix=av;C.skinningMatrix=new c.Matrix4;C.skinningMatrix.multiply(C.world,av);C.weights=[];for(av=0;av<z.weights.length;av++){for(var ax=0;ax<z.weights[av].length;ax++){var D=z.weights[av][ax];D.joint==T&&C.weights.push(D)}}}else{throw"ColladaLoader: Could not find joint '"+C.sid+"'."}}}for(ay=0;ay<Z.length;ay++){if(Z[ay].type=="JOINT"){for(z=0;z<Z[ay].weights.length;z++){C=Z[ay].weights[z],L=C.index,C=C.weight,T=Q.vertices[L],L=at[L],N.x=T.position.x,N.y=T.position.y,N.z=T.position.z,Z[ay].skinningMatrix.multiplyVector3(N),L.position.x+=N.x*C,L.position.y+=N.y*C,L.position.z+=N.z*C}}}Q.morphTargets.push({name:"target_"+ar,vertices:at})}}}}function V(T){var Y=new c.Object3D,Z,ar,at,au;for(at=0;at<T.controllers.length;at++){var z=ao[T.controllers[at].url];switch(z.type){case"skin":if(q[z.skin.source]){var C=new af;C.url=z.skin.source;C.instance_material=T.controllers[at].instance_material;T.geometries.push(C);Z=T.controllers[at]}else{if(ao[z.skin.source]&&(ar=z=ao[z.skin.source],z.morph&&q[z.morph.source])){C=new af,C.url=z.morph.source,C.instance_material=T.controllers[at].instance_material,T.geometries.push(C)}}break;case"morph":if(q[z.morph.source]){C=new af,C.url=z.morph.source,C.instance_material=T.controllers[at].instance_material,T.geometries.push(C),ar=T.controllers[at]}console.log("ColladaLoader: Morph-controller partially supported.")}}for(at=0;at<T.geometries.length;at++){var z=T.geometries[at],C=z.instance_material,z=q[z.url],D={},L=0,N;if(z&&z.mesh&&z.mesh.primitives){if(Y.name.length==0){Y.name=z.id}if(C){for(au=0;au<C.length;au++){N=C[au];var Q=g[H[N.target].instance_effect.url].shader;Q.material.opacity=!Q.material.opacity?1:Q.material.opacity;N=D[N.symbol]=Q.material;L++}}C=N||new c.MeshLambertMaterial({color:14540253,shading:c.FlatShading});z=z.mesh.geometry3js;if(L>1){C=new c.MeshFaceMaterial;for(au=0;au<z.faces.length;au++){L=z.faces[au],L.materials=[D[L.daeMaterial]]}}if(Z!==void 0){W(z,Z),C.morphTargets=!0,C=new c.SkinnedMesh(z,C),C.skeleton=Z.skeleton,C.skinController=ao[Z.url],C.skinInstanceController=Z,C.name="skin_"+b.length,b.push(C)}else{if(ar!==void 0){au=z;D=ar instanceof ae?ao[ar.url]:ar;if(!D||!D.morph){console.log("could not find morph controller!")}else{D=D.morph;for(L=0;L<D.targets.length;L++){if(Q=q[D.targets[L]],Q.mesh&&Q.mesh.primitives&&Q.mesh.primitives.length){Q=Q.mesh.primitives[0].geometry,Q.vertices.length===au.vertices.length&&au.morphTargets.push({name:"target_1",vertices:Q.vertices})}}au.morphTargets.push({name:"target_Z",vertices:au.vertices})}C.morphTargets=!0;C=new c.Mesh(z,C);C.name="morph_"+K.length;K.push(C)}else{C=new c.Mesh(z,C)}}T.geometries.length>1?Y.add(C):Y=C}}Y.name=T.id||"";T.matrix.decompose(Y.position,Y.rotation,Y.scale);for(at=0;at<T.nodes.length;at++){Y.add(V(T.nodes[at],T))}return Y}function U(){this.init_from=this.id=""}function X(){this.type=this.name=this.id="";this.morph=this.skin=null}function aa(){this.weights=this.targets=this.source=this.method=null}function ad(){this.source="";this.bindShapeMatrix=null;this.invBindMatrices=[];this.joints=[];this.weights=[]}function ac(){this.name=this.id="";this.nodes=[];this.scene=new c.Object3D}function ag(){this.sid=this.name=this.id="";this.nodes=[];this.controllers=[];this.transforms=[];this.geometries=[];this.channels=[];this.matrix=new c.Matrix4}function ah(){this.type=this.sid="";this.data=[];this.matrix=new c.Matrix4}function ae(){this.url="";this.skeleton=[];this.instance_material=[]}function aj(){this.target=this.symbol=""}function af(){this.url="";this.instance_material=[]}function ai(){this.id="";this.mesh=null}function an(z){this.geometry=z.id;this.primitives=[];this.geometry3js=this.vertices=null}function h(){}function ap(){this.material="";this.count=0;this.inputs=[];this.vcount=null;this.p=[];this.geometry=new c.Geometry}function v(){this.source="";this.stride=this.count=0;this.params=[]}function x(){this.input={}}function u(){this.semantic="";this.offset=0;this.source="";this.set=0}function i(z){this.id=z;this.type=null}function k(){this.name=this.id="";this.instance_effect=null}function f(){this.color=new c.Color(0);this.color.setRGB(Math.random(),Math.random(),Math.random());this.color.a=1;this.texcoord=this.texture=null}function E(z,C){this.type=z;this.effect=C;this.material=null}function al(z){this.effect=z;this.format=this.init_from=null}function w(z){this.effect=z;this.mipfilter=this.magfilter=this.minfilter=this.wrap_t=this.wrap_s=this.source=null}function e(){this.name=this.id="";this.sampler=this.surface=this.shader=null}function n(){this.url=""}function G(){this.name=this.id="";this.source={};this.sampler=[];this.channel=[]}function a(z){this.animation=z;this.target=this.source="";this.member=this.arrIndices=this.arrSyntax=this.dotSyntax=this.sid=null}function J(z){this.id="";this.animation=z;this.inputs=[];this.endTime=this.startTime=this.interpolation=this.output=this.input=null;this.duration=0}function s(z){var C=z.getAttribute("id");if(p[C]!=void 0){return p[C]}p[C]=(new i(C)).parse(z);return p[C]}function A(z){if(z=="dae"){return"http://www.collada.org/2005/11/COLLADASchema"}return null}function y(C){for(var C=I(C),D=[],z=0;z<C.length;z++){D.push(parseFloat(C[z]))}return D}function B(C){for(var C=I(C),D=[],z=0;z<C.length;z++){D.push(parseInt(C[z],10))}return D}function I(z){return z.replace(/^\s+/,"").replace(/\s+$/,"").split(/\s+/)}function j(C,D,z){return C.hasAttribute(D)?parseInt(C.getAttribute(D),10):z}function M(C,D){if(C===void 0){for(var z="0.";z.length<D+2;){z+="0"}return z}D=D||2;z=C.toString().split(".");for(z[1]=z.length>1?z[1].substr(0,D):"0";z[1].length<D;){z[1]+="0"}return z.join(".")}function F(C,D){var z="";z+=M(C.x,D)+",";z+=M(C.y,D)+",";z+=M(C.z,D);return z}var ab=null,aq=null,t,r=null,p={},l={},ak={},ao={},q={},H={},g={},o,am,K,b,m=c.SmoothShading;U.prototype.parse=function(C){this.id=C.getAttribute("id");for(var D=0;D<C.childNodes.length;D++){var z=C.childNodes[D];if(z.nodeName=="init_from"){this.init_from=z.textContent}}return this};X.prototype.parse=function(C){this.id=C.getAttribute("id");this.name=C.getAttribute("name");this.type="none";for(var D=0;D<C.childNodes.length;D++){var z=C.childNodes[D];switch(z.nodeName){case"skin":this.skin=(new ad).parse(z);this.type=z.nodeName;break;case"morph":this.morph=(new aa).parse(z),this.type=z.nodeName}}return this};aa.prototype.parse=function(L){var N={},z=[],C;this.method=L.getAttribute("method");this.source=L.getAttribute("source").replace(/^#/,"");for(C=0;C<L.childNodes.length;C++){var D=L.childNodes[C];if(D.nodeType==1){switch(D.nodeName){case"source":D=(new i).parse(D);N[D.id]=D;break;case"targets":z=this.parseInputs(D);break;default:console.log(D.nodeName)}}}for(C=0;C<z.length;C++){switch(L=z[C],D=N[L.source],L.semantic){case"MORPH_TARGET":this.targets=D.read();break;case"MORPH_WEIGHT":this.weights=D.read()}}return this};aa.prototype.parseInputs=function(D){for(var L=[],z=0;z<D.childNodes.length;z++){var C=D.childNodes[z];if(C.nodeType==1){switch(C.nodeName){case"input":L.push((new u).parse(C))}}}return L};ad.prototype.parse=function(N){var Q={},z,C;this.source=N.getAttribute("source").replace(/^#/,"");this.invBindMatrices=[];this.joints=[];this.weights=[];for(var D=0;D<N.childNodes.length;D++){var L=N.childNodes[D];if(L.nodeType==1){switch(L.nodeName){case"bind_shape_matrix":L=y(L.textContent);this.bindShapeMatrix=new c.Matrix4;this.bindShapeMatrix.set(L[0],L[1],L[2],L[3],L[4],L[5],L[6],L[7],L[8],L[9],L[10],L[11],L[12],L[13],L[14],L[15]);break;case"source":L=(new i).parse(L);Q[L.id]=L;break;case"joints":z=L;break;case"vertex_weights":C=L;break;default:console.log(L.nodeName)}}}this.parseJoints(z,Q);this.parseWeights(C,Q);return this};ad.prototype.parseJoints=function(L,N){for(var z=0;z<L.childNodes.length;z++){var C=L.childNodes[z];if(C.nodeType==1){switch(C.nodeName){case"input":var C=(new u).parse(C),D=N[C.source];if(C.semantic=="JOINT"){this.joints=D.read()}else{if(C.semantic=="INV_BIND_MATRIX"){this.invBindMatrices=D.read()}}}}}};ad.prototype.parseWeights=function(aw,L){for(var Q,T,Y=[],Z=0;Z<aw.childNodes.length;Z++){var ar=aw.childNodes[Z];if(ar.nodeType==1){switch(ar.nodeName){case"input":Y.push((new u).parse(ar));break;case"v":Q=B(ar.textContent);break;case"vcount":T=B(ar.textContent)}}}for(Z=ar=0;Z<T.length;Z++){for(var at=T[Z],au=[],av=0;av<at;av++){for(var z={},C=0;C<Y.length;C++){var D=Y[C],N=Q[ar+D.offset];switch(D.semantic){case"JOINT":z.joint=N;break;case"WEIGHT":z.weight=L[D.source].data[N]}}au.push(z);ar+=Y.length}for(av=0;av<au.length;av++){au[av].index=Z}this.weights.push(au)}};ac.prototype.getChildById=function(D,L){for(var z=0;z<this.nodes.length;z++){var C=this.nodes[z].getChildById(D,L);if(C){return C}}return null};ac.prototype.getChildBySid=function(D,L){for(var z=0;z<this.nodes.length;z++){var C=this.nodes[z].getChildBySid(D,L);if(C){return C}}return null};ac.prototype.parse=function(C){this.id=C.getAttribute("id");this.name=C.getAttribute("name");this.nodes=[];for(var D=0;D<C.childNodes.length;D++){var z=C.childNodes[D];if(z.nodeType==1){switch(z.nodeName){case"node":this.nodes.push((new ag).parse(z))}}}return this};ag.prototype.getChannelForTransform=function(L){for(var N=0;N<this.channels.length;N++){var Q=this.channels[N],T=Q.target.split("/");T.shift();var Y=T.shift(),z=Y.indexOf(".")>=0,C=Y.indexOf("(")>=0,D;if(z){T=Y.split("."),Y=T.shift(),T.shift()}else{if(C){D=Y.split("(");Y=D.shift();for(T=0;T<D.length;T++){D[T]=parseInt(D[T].replace(/\)/,""))}}}if(Y==L){return Q.info={sid:Y,dotSyntax:z,arrSyntax:C,arrIndices:D},Q}}return null};ag.prototype.getChildById=function(D,L){if(this.id==D){return this}if(L){for(var z=0;z<this.nodes.length;z++){var C=this.nodes[z].getChildById(D,L);if(C){return C}}}return null};ag.prototype.getChildBySid=function(D,L){if(this.sid==D){return this}if(L){for(var z=0;z<this.nodes.length;z++){var C=this.nodes[z].getChildBySid(D,L);if(C){return C}}}return null};ag.prototype.getTransformBySid=function(z){for(var C=0;C<this.transforms.length;C++){if(this.transforms[C].sid==z){return this.transforms[C]}}return null};ag.prototype.parse=function(Y){var Z;this.id=Y.getAttribute("id");this.sid=Y.getAttribute("sid");this.name=Y.getAttribute("name");this.type=Y.getAttribute("type");this.type=this.type=="JOINT"?this.type:"NODE";this.nodes=[];this.transforms=[];this.geometries=[];this.controllers=[];this.matrix=new c.Matrix4;for(var ar=0;ar<Y.childNodes.length;ar++){if(Z=Y.childNodes[ar],Z.nodeType==1){switch(Z.nodeName){case"node":this.nodes.push((new ag).parse(Z));break;case"instance_camera":break;case"instance_controller":this.controllers.push((new ae).parse(Z));break;case"instance_geometry":this.geometries.push((new af).parse(Z));break;case"instance_light":break;case"instance_node":Z=Z.getAttribute("url").replace(/^#/,"");(Z=ab.evaluate(".//dae:library_nodes//dae:node[@id='"+Z+"']",ab,A,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null).iterateNext())&&this.nodes.push((new ag).parse(Z));break;case"rotate":case"translate":case"scale":case"matrix":case"lookat":case"skew":this.transforms.push((new ah).parse(Z));break;case"extra":break;default:console.log(Z.nodeName)}}}Y=[];ar=1000000;Z=-1000000;for(var at in ak){for(var z=ak[at],C=0;C<z.channel.length;C++){var D=z.channel[C],L=z.sampler[C];at=D.target.split("/")[0];if(at==this.id){L.create(),D.sampler=L,ar=Math.min(ar,L.startTime),Z=Math.max(Z,L.endTime),Y.push(D)}}}if(Y.length){this.startTime=ar,this.endTime=Z}if((this.channels=Y)&&this.channels.length){at=10000000;for(Y=0;Y<this.channels.length;Y++){ar=this.channels[Y].sampler;for(Z=0;Z<ar.input.length-1;Z++){at=Math.min(at,ar.input[Z+1]-ar.input[Z])}}ar=[];for(Y=this.startTime;Y<this.endTime;Y+=at){Z=Y;for(var z={},N=C=void 0,C=0;C<this.channels.length;C++){N=this.channels[C],z[N.sid]=N}D=new c.Matrix4;for(C=0;C<this.transforms.length;C++){if(L=this.transforms[C],N=z[L.sid],N!==void 0){for(var Q=N.sampler,T,N=0;N<Q.input.length-1;N++){if(Q.input[N+1]>Z){T=Q.output[N];break}}D=T!==void 0?T instanceof c.Matrix4?D.multiply(D,T):D.multiply(D,L.matrix):D.multiply(D,L.matrix)}else{D=D.multiply(D,L.matrix)}}Z=D;ar.push({time:Y,pos:[Z.n14,Z.n24,Z.n34],rotq:[0,0,0,1],scl:[1,1,1]})}this.keys=ar}this.updateMatrix();return this};ag.prototype.updateMatrix=function(){this.matrix.identity();for(var z=0;z<this.transforms.length;z++){this.matrix.multiply(this.matrix,this.transforms[z].matrix)}};ah.prototype.parse=function(z){this.sid=z.getAttribute("sid");this.type=z.nodeName;this.data=y(z.textContent);this.updateMatrix();return this};ah.prototype.updateMatrix=function(){var z=0;this.matrix.identity();switch(this.type){case"matrix":this.matrix.set(this.data[0],this.data[1],this.data[2],this.data[3],this.data[4],this.data[5],this.data[6],this.data[7],this.data[8],this.data[9],this.data[10],this.data[11],this.data[12],this.data[13],this.data[14],this.data[15]);break;case"translate":this.matrix.setTranslation(this.data[0],this.data[1],this.data[2]);break;case"rotate":z=this.data[3]*(Math.PI/180);this.matrix.setRotationAxis(new c.Vector3(this.data[0],this.data[1],this.data[2]),z);break;case"scale":this.matrix.setScale(this.data[0],this.data[1],this.data[2])}return this.matrix};ae.prototype.parse=function(D){this.url=D.getAttribute("url").replace(/^#/,"");this.skeleton=[];this.instance_material=[];for(var L=0;L<D.childNodes.length;L++){var z=D.childNodes[L];if(z.nodeType==1){switch(z.nodeName){case"skeleton":this.skeleton.push(z.textContent.replace(/^#/,""));break;case"bind_material":if(z=ab.evaluate(".//dae:instance_material",z,A,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null)){for(var C=z.iterateNext();C;){this.instance_material.push((new aj).parse(C)),C=z.iterateNext()}}}}}return this};aj.prototype.parse=function(z){this.symbol=z.getAttribute("symbol");this.target=z.getAttribute("target").replace(/^#/,"");return this};af.prototype.parse=function(C){this.url=C.getAttribute("url").replace(/^#/,"");this.instance_material=[];for(var D=0;D<C.childNodes.length;D++){var z=C.childNodes[D];if(z.nodeType==1&&z.nodeName=="bind_material"){if(C=ab.evaluate(".//dae:instance_material",z,A,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null)){for(D=C.iterateNext();D;){this.instance_material.push((new aj).parse(D)),D=C.iterateNext()}}break}}return this};ai.prototype.parse=function(C){this.id=C.getAttribute("id");for(var D=0;D<C.childNodes.length;D++){var z=C.childNodes[D];switch(z.nodeName){case"mesh":this.mesh=(new an(this)).parse(z)}}return this};an.prototype.parse=function(N){function Q(Z,T){var Y=F(Z.position);D[Y]===void 0&&(D[Y]={v:Z,index:T});return D[Y]}this.primitives=[];var z;for(z=0;z<N.childNodes.length;z++){var C=N.childNodes[z];switch(C.nodeName){case"source":s(C);break;case"vertices":this.vertices=(new x).parse(C);break;case"triangles":this.primitives.push((new ap).parse(C));break;case"polygons":console.warn("polygon holes not yet supported!");case"polylist":this.primitives.push((new h).parse(C))}}var D={};this.geometry3js=new c.Geometry;C=p[this.vertices.input.POSITION.source].data;for(N=z=0;z<C.length;z+=3,N++){var L=new c.Vertex(new c.Vector3(C[z],C[z+1],C[z+2]));Q(L,N);this.geometry3js.vertices.push(L)}for(z=0;z<this.primitives.length;z++){N=this.primitives[z],N.setVertices(this.vertices),this.handlePrimitive(N,this.geometry3js,D)}this.geometry3js.computeCentroids();this.geometry3js.computeFaceNormals();this.geometry3js.computeVertexNormals();this.geometry3js.computeBoundingBox();return this};an.prototype.handlePrimitive=function(z,C,D){var L=0,N,Q,T=z.p,Y=z.inputs,ar,av,ax,az,aA=0,aB=3,aC=[];for(N=0;N<Y.length;N++){switch(ar=Y[N],ar.semantic){case"TEXCOORD":aC.push(ar.set)}}for(;L<T.length;){var Z=[],at=[],au={},ay=[];z.vcount&&(aB=z.vcount[aA++]);for(N=0;N<aB;N++){for(Q=0;Q<Y.length;Q++){switch(ar=Y[Q],az=p[ar.source],av=T[L+N*Y.length+ar.offset],ax=az.accessor.params.length,ax*=av,ar.semantic){case"VERTEX":ar=F(C.vertices[av].position);Z.push(D[ar].index);break;case"NORMAL":at.push(new c.Vector3(az.data[ax],az.data[ax+1],az.data[ax+2]));break;case"TEXCOORD":au[ar.set]===void 0&&(au[ar.set]=[]);au[ar.set].push(new c.UV(az.data[ax],az.data[ax+1]));break;case"COLOR":ay.push((new c.Color).setRGB(az.data[ax],az.data[ax+1],az.data[ax+2]))}}}var aw;aB==3?aw=new c.Face3(Z[0],Z[1],Z[2],[at[0],at[1],at[2]],ay.length?ay:new c.Color):aB==4&&(aw=new c.Face4(Z[0],Z[1],Z[2],Z[3],[at[0],at[1],at[2],at[3]],ay.length?ay:new c.Color));aw.daeMaterial=z.material;C.faces.push(aw);for(Q=0;Q<aC.length;Q++){N=au[aC[Q]],C.faceVertexUvs[Q].push([N[0],N[1],N[2]])}L+=Y.length*aB}};h.prototype=new ap;h.prototype.constructor=h;ap.prototype.setVertices=function(z){for(var C=0;C<this.inputs.length;C++){if(this.inputs[C].source==z.id){this.inputs[C].source=z.input.POSITION.source}}};ap.prototype.parse=function(C){this.inputs=[];this.material=C.getAttribute("material");this.count=j(C,"count",0);for(var D=0;D<C.childNodes.length;D++){var z=C.childNodes[D];switch(z.nodeName){case"input":this.inputs.push((new u).parse(C.childNodes[D]));break;case"vcount":this.vcount=B(z.textContent);break;case"p":this.p=B(z.textContent)}}return this};v.prototype.parse=function(D){this.params=[];this.source=D.getAttribute("source");this.count=j(D,"count",0);this.stride=j(D,"stride",0);for(var L=0;L<D.childNodes.length;L++){var z=D.childNodes[L];if(z.nodeName=="param"){var C={};C.name=z.getAttribute("name");C.type=z.getAttribute("type");this.params.push(C)}}return this};x.prototype.parse=function(C){this.id=C.getAttribute("id");for(var D=0;D<C.childNodes.length;D++){if(C.childNodes[D].nodeName=="input"){var z=(new u).parse(C.childNodes[D]);this.input[z.semantic]=z}}return this};u.prototype.parse=function(z){this.semantic=z.getAttribute("semantic");this.source=z.getAttribute("source").replace(/^#/,"");this.set=j(z,"set",-1);this.offset=j(z,"offset",0);if(this.semantic=="TEXCOORD"&&this.set<0){this.set=0}return this};i.prototype.parse=function(N){this.id=N.getAttribute("id");for(var Q=0;Q<N.childNodes.length;Q++){var z=N.childNodes[Q];switch(z.nodeName){case"bool_array":for(var C=I(z.textContent),D=[],L=0;L<C.length;L++){D.push(C[L]=="true"||C[L]=="1"?!0:!1)}this.data=D;this.type=z.nodeName;break;case"float_array":this.data=y(z.textContent);this.type=z.nodeName;break;case"int_array":this.data=B(z.textContent);this.type=z.nodeName;break;case"IDREF_array":case"Name_array":this.data=I(z.textContent);this.type=z.nodeName;break;case"technique_common":for(C=0;C<z.childNodes.length;C++){if(z.childNodes[C].nodeName=="accessor"){this.accessor=(new v).parse(z.childNodes[C]);break}}}}return this};i.prototype.read=function(){var D=[],L=this.accessor.params[0];switch(L.type){case"IDREF":case"Name":case"name":case"float":return this.data;case"float4x4":for(L=0;L<this.data.length;L+=16){var z=this.data.slice(L,L+16),C=new c.Matrix4;C.set(z[0],z[1],z[2],z[3],z[4],z[5],z[6],z[7],z[8],z[9],z[10],z[11],z[12],z[13],z[14],z[15]);D.push(C)}break;default:console.log("ColladaLoader: Source: Read dont know how to read "+L.type+".")}return D};k.prototype.parse=function(z){this.id=z.getAttribute("id");this.name=z.getAttribute("name");for(var C=0;C<z.childNodes.length;C++){if(z.childNodes[C].nodeName=="instance_effect"){this.instance_effect=(new n).parse(z.childNodes[C]);break}}return this};f.prototype.isColor=function(){return this.texture==null};f.prototype.isTexture=function(){return this.texture!=null};f.prototype.parse=function(C){for(var D=0;D<C.childNodes.length;D++){var z=C.childNodes[D];if(z.nodeType==1){switch(z.nodeName){case"color":z=y(z.textContent);this.color=new c.Color(0);this.color.setRGB(z[0],z[1],z[2]);this.color.a=z[3];break;case"texture":this.texture=z.getAttribute("texture"),this.texcoord=z.getAttribute("texcoord")}}}return this};E.prototype.parse=function(N){for(var Q=0;Q<N.childNodes.length;Q++){var z=N.childNodes[Q];if(z.nodeType==1){switch(z.nodeName){case"ambient":case"emission":case"diffuse":case"specular":case"transparent":this[z.nodeName]=(new f).parse(z);break;case"shininess":case"reflectivity":case"transparency":var C;C=ab.evaluate(".//dae:float",z,A,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);for(var D=C.iterateNext(),L=[];D;){L.push(D),D=C.iterateNext()}C=L;C.length>0&&(this[z.nodeName]=parseFloat(C[0].textContent))}}}this.create();return this};E.prototype.create=function(){var D={},L=this.transparency!==void 0&&this.transparency<1,z;for(z in this){switch(z){case"ambient":case"emission":case"diffuse":case"specular":var C=this[z];if(C instanceof f){if(C.isTexture()){if(this.effect.sampler&&this.effect.surface&&this.effect.sampler.source==this.effect.surface.sid&&(C=l[this.effect.surface.init_from])){D.map=c.ImageUtils.loadTexture(am+C.init_from),D.map.wrapS=c.RepeatWrapping,D.map.wrapT=c.RepeatWrapping,D.map.repeat.x=1,D.map.repeat.y=-1}}else{z=="diffuse"?D.color=C.color.getHex():L||(D[z]=C.color.getHex())}}break;case"shininess":case"reflectivity":D[z]=this[z];break;case"transparency":if(L){D.transparent=!0,D.opacity=this[z],L=!0}}}D.shading=m;return this.material=new c.MeshLambertMaterial(D)};al.prototype.parse=function(C){for(var D=0;D<C.childNodes.length;D++){var z=C.childNodes[D];if(z.nodeType==1){switch(z.nodeName){case"init_from":this.init_from=z.textContent;break;case"format":this.format=z.textContent;break;default:console.log("unhandled Surface prop: "+z.nodeName)}}}return this};w.prototype.parse=function(C){for(var D=0;D<C.childNodes.length;D++){var z=C.childNodes[D];if(z.nodeType==1){switch(z.nodeName){case"source":this.source=z.textContent;break;case"minfilter":this.minfilter=z.textContent;break;case"magfilter":this.magfilter=z.textContent;break;case"mipfilter":this.mipfilter=z.textContent;break;case"wrap_s":this.wrap_s=z.textContent;break;case"wrap_t":this.wrap_t=z.textContent;break;default:console.log("unhandled Sampler2D prop: "+z.nodeName)}}}return this};e.prototype.create=function(){if(this.shader==null){return null}};e.prototype.parse=function(C){this.id=C.getAttribute("id");this.name=C.getAttribute("name");this.shader=null;for(var D=0;D<C.childNodes.length;D++){var z=C.childNodes[D];if(z.nodeType==1){switch(z.nodeName){case"profile_COMMON":this.parseTechnique(this.parseProfileCOMMON(z))}}}return this};e.prototype.parseNewparam=function(D){for(var L=D.getAttribute("sid"),z=0;z<D.childNodes.length;z++){var C=D.childNodes[z];if(C.nodeType==1){switch(C.nodeName){case"surface":this.surface=(new al(this)).parse(C);this.surface.sid=L;break;case"sampler2D":this.sampler=(new w(this)).parse(C);this.sampler.sid=L;break;case"extra":break;default:console.log(C.nodeName)}}}};e.prototype.parseProfileCOMMON=function(D){for(var L,z=0;z<D.childNodes.length;z++){var C=D.childNodes[z];if(C.nodeType==1){switch(C.nodeName){case"profile_COMMON":this.parseProfileCOMMON(C);break;case"technique":L=C;break;case"newparam":this.parseNewparam(C);break;case"extra":break;default:console.log(C.nodeName)}}}return L};e.prototype.parseTechnique=function(C){for(var D=0;D<C.childNodes.length;D++){var z=C.childNodes[D];if(z.nodeType==1){switch(z.nodeName){case"lambert":case"blinn":case"phong":this.shader=(new E(z.nodeName,this)).parse(z)}}}};n.prototype.parse=function(z){this.url=z.getAttribute("url").replace(/^#/,"");return this};G.prototype.parse=function(C){this.id=C.getAttribute("id");this.name=C.getAttribute("name");this.source={};for(var D=0;D<C.childNodes.length;D++){var z=C.childNodes[D];if(z.nodeType==1){switch(z.nodeName){case"source":z=(new i).parse(z);this.source[z.id]=z;break;case"sampler":this.sampler.push((new J(this)).parse(z));break;case"channel":this.channel.push((new a(this)).parse(z))}}}return this};a.prototype.parse=function(N){this.source=N.getAttribute("source").replace(/^#/,"");this.target=N.getAttribute("target");var Q=this.target.split("/");Q.shift();var N=Q.shift(),z=N.indexOf(".")>=0,C=N.indexOf("(")>=0,D,L;if(z){Q=N.split("."),N=Q.shift(),L=Q.shift()}else{if(C){D=N.split("(");N=D.shift();for(Q=0;Q<D.length;Q++){D[Q]=parseInt(D[Q].replace(/\)/,""))}}}this.sid=N;this.dotSyntax=z;this.arrSyntax=C;this.arrIndices=D;this.member=L;return this};J.prototype.parse=function(C){this.id=C.getAttribute("id");this.inputs=[];for(var D=0;D<C.childNodes.length;D++){var z=C.childNodes[D];if(z.nodeType==1){switch(z.nodeName){case"input":this.inputs.push((new u).parse(z))}}}return this};J.prototype.create=function(){for(var C=0;C<this.inputs.length;C++){var D=this.inputs[C],z=this.animation.source[D.source];switch(D.semantic){case"INPUT":this.input=z.read();break;case"OUTPUT":this.output=z.read();break;case"INTERPOLATION":this.interpolation=z.read();break;case"IN_TANGENT":break;case"OUT_TANGENT":break;default:console.log(D.semantic)}}this.duration=this.endTime=this.startTime=0;if(this.input.length){this.startTime=100000000;this.endTime=-100000000;for(C=0;C<this.input.length;C++){this.startTime=Math.min(this.startTime,this.input[C]),this.endTime=Math.max(this.endTime,this.input[C])}this.duration=this.endTime-this.startTime}};return{load:function(D,z){if(document.implementation&&document.implementation.createDocument){document.implementation.createDocument("http://www.collada.org/2005/11/COLLADASchema","COLLADA",null);D+="?rnd="+Math.random();var C=new XMLHttpRequest;C.overrideMimeType&&C.overrideMimeType("text/xml");C.onreadystatechange=function(){if(C.readyState==4&&(C.status==0||C.status==200)){r=z,O(C.responseXML,void 0,D)}};C.open("GET",D,!0);C.send(null)}else{alert("Don't know how to parse XML!")}},parse:O,setPreferredShading:function(z){m=z},applySkin:W,geometries:q}};c.JSONLoader=function(a){c.Loader.call(this,a)};c.JSONLoader.prototype=new c.Loader;c.JSONLoader.prototype.constructor=c.JSONLoader;c.JSONLoader.prototype.supr=c.Loader.prototype;c.JSONLoader.prototype.load=function(b,a,g){if(b instanceof Object){console.warn("DEPRECATED: JSONLoader( parameters ) is now JSONLoader( url, callback, texturePath )."),g=b,b=g.model,a=g.callback,g=g.texture_path}g=g?g:this.extractUrlbase(b);this.onLoadStart();this.loadAjaxJSON(this,b,a,g)};c.JSONLoader.prototype.loadAjaxJSON=function(g,p,o,a,f){var e=new XMLHttpRequest,b=0;e.onreadystatechange=function(){if(e.readyState==4){if(e.status==200||e.status==0){try{var h=JSON.parse(e.responseText);g.createModel(h,o,a);g.onLoadComplete()}catch(i){console.error(i),console.warn("DEPRECATED: ["+p+"] seems to be using old model format")}}else{console.error("Couldn't load ["+p+"] ["+e.status+"]")}}else{e.readyState==3?f&&(b==0&&(b=e.getResponseHeader("Content-Length")),f({total:b,loaded:e.responseText.length})):e.readyState==2&&(b=e.getResponseHeader("Content-Length"))}};e.open("GET",p,!0);e.overrideMimeType("text/plain; charset=x-user-defined");e.setRequestHeader("Content-Type","text/plain");e.send(null)};c.JSONLoader.prototype.createModel=function(k,a,l){var b=new c.Geometry,g=k.scale!==void 0?1/k.scale:1;this.initMaterials(b,k.materials,l);(function(e){if(k.metadata===void 0||k.metadata.formatVersion===void 0||k.metadata.formatVersion!==3){console.error("Deprecated file format.")}else{var f,h,i,m,j,r,t,n,F,p,x,o,A,q,B=k.faces;r=k.vertices;var w=k.normals,u=k.colors,R=0;for(f=0;f<k.uvs.length;f++){k.uvs[f].length&&R++}for(f=0;f<R;f++){b.faceUvs[f]=[],b.faceVertexUvs[f]=[]}m=0;for(j=r.length;m<j;){t=new c.Vertex,t.position.x=r[m++]*e,t.position.y=r[m++]*e,t.position.z=r[m++]*e,b.vertices.push(t)}m=0;for(j=B.length;m<j;){e=B[m++];r=e&1;i=e&2;f=e&4;h=e&8;n=e&16;t=e&32;p=e&64;e&=128;r?(x=new c.Face4,x.a=B[m++],x.b=B[m++],x.c=B[m++],x.d=B[m++],r=4):(x=new c.Face3,x.a=B[m++],x.b=B[m++],x.c=B[m++],r=3);if(i){i=B[m++],x.materialIndex=i}i=b.faces.length;if(f){for(f=0;f<R;f++){o=k.uvs[f],F=B[m++],q=o[F*2],F=o[F*2+1],b.faceUvs[f][i]=new c.UV(q,F)}}if(h){for(f=0;f<R;f++){o=k.uvs[f];A=[];for(h=0;h<r;h++){F=B[m++],q=o[F*2],F=o[F*2+1],A[h]=new c.UV(q,F)}b.faceVertexUvs[f][i]=A}}if(n){n=B[m++]*3,h=new c.Vector3,h.x=w[n++],h.y=w[n++],h.z=w[n],x.normal=h}if(t){for(f=0;f<r;f++){n=B[m++]*3,h=new c.Vector3,h.x=w[n++],h.y=w[n++],h.z=w[n],x.vertexNormals.push(h)}}if(p){t=B[m++],t=new c.Color(u[t]),x.color=t}if(e){for(f=0;f<r;f++){t=B[m++],t=new c.Color(u[t]),x.vertexColors.push(t)}}b.faces.push(x)}}})(g);(function(){var i,e,f,h;if(k.skinWeights){i=0;for(e=k.skinWeights.length;i<e;i+=2){f=k.skinWeights[i],h=k.skinWeights[i+1],b.skinWeights.push(new c.Vector4(f,h,0,0))}}if(k.skinIndices){i=0;for(e=k.skinIndices.length;i<e;i+=2){f=k.skinIndices[i],h=k.skinIndices[i+1],b.skinIndices.push(new c.Vector4(f,h,0,0))}}b.bones=k.bones;b.animation=k.animation})();(function(i){if(k.morphTargets!==void 0){var j,m,o,r,p,e,f,z,h;j=0;for(m=k.morphTargets.length;j<m;j++){b.morphTargets[j]={};b.morphTargets[j].name=k.morphTargets[j].name;b.morphTargets[j].vertices=[];z=b.morphTargets[j].vertices;h=k.morphTargets[j].vertices;o=0;for(r=h.length;o<r;o+=3){p=h[o]*i,e=h[o+1]*i,f=h[o+2]*i,z.push(new c.Vertex(new c.Vector3(p,e,f)))}}}if(k.morphColors!==void 0){j=0;for(m=k.morphColors.length;j<m;j++){b.morphColors[j]={};b.morphColors[j].name=k.morphColors[j].name;b.morphColors[j].colors=[];r=b.morphColors[j].colors;p=k.morphColors[j].colors;i=0;for(o=p.length;i<o;i+=3){e=new c.Color(16755200),e.setRGB(p[i],p[i+1],p[i+2]),r.push(e)}}}})(g);b.computeCentroids();b.computeFaceNormals();this.hasNormals(b)&&b.computeTangents();a(b)};c.SceneLoader=function(){this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){};this.callbackSync=function(){};this.callbackProgress=function(){}};c.SceneLoader.prototype.constructor=c.SceneLoader;c.SceneLoader.prototype.load=function(i,a){var j=this,b=new XMLHttpRequest;b.onreadystatechange=function(){if(b.readyState==4){if(b.status==200||b.status==0){try{var f=JSON.parse(b.responseText);f.metadata===void 0||f.metadata.formatVersion===void 0||f.metadata.formatVersion!==3?console.error("Deprecated file format."):j.createScene(f,a,i)}catch(e){console.error(e),console.warn("DEPRECATED: ["+i+"] seems to be using old model format")}}else{console.error("Couldn't load ["+i+"] ["+b.status+"]")}}};b.open("GET",i,!0);b.overrideMimeType("text/plain; charset=x-user-defined");b.setRequestHeader("Content-Type","text/plain");b.send(null)};c.SceneLoader.prototype.createScene=function(f,k,h){function l(j,z){return z=="relativeToHTML"?j:x+"/"+j}function r(){var j;for(F in ac.objects){if(!p.objects[F]){if(J=ac.objects[F],J.geometry!==void 0){if(R=p.geometries[J.geometry]){j=!1;for(t=0;t<J.materials.length;t++){i=p.materials[J.materials[t]],j=i instanceof c.ShaderMaterial}j&&R.computeTangents();g=J.position;m=J.rotation;e=J.quaternion;ab=J.scale;e=0;i.length==0&&(i=new c.MeshFaceMaterial);i.length>1&&(i=new c.MeshFaceMaterial);j=new c.Mesh(R,i);j.name=F;j.position.set(g[0],g[1],g[2]);e?(j.quaternion.set(e[0],e[1],e[2],e[3]),j.useQuaternion=!0):j.rotation.set(m[0],m[1],m[2]);j.scale.set(ab[0],ab[1],ab[2]);j.visible=J.visible;p.scene.add(j);p.objects[F]=j;if(J.meshCollider){var z=c.CollisionUtils.MeshColliderWBox(j);p.scene.collisions.colliders.push(z)}if(J.castsShadow){z=new c.ShadowVolume(R),p.scene.add(z),z.position=j.position,z.rotation=j.rotation,z.scale=j.scale}J.trigger&&J.trigger.toLowerCase()!="none"&&(z={type:J.trigger,object:J},p.triggers[j.name]=z)}}else{g=J.position,m=J.rotation,e=J.quaternion,ab=J.scale,e=0,j=new c.Object3D,j.name=F,j.position.set(g[0],g[1],g[2]),e?(j.quaternion.set(e[0],e[1],e[2],e[3]),j.useQuaternion=!0):j.rotation.set(m[0],m[1],m[2]),j.scale.set(ab[0],ab[1],ab[2]),j.visible=J.visible!==void 0?J.visible:!1,p.scene.add(j),p.objects[F]=j,p.empties[F]=j,J.trigger&&J.trigger.toLowerCase()!="none"&&(z={type:J.trigger,object:J},p.triggers[j.name]=z)}}}}function q(j){return function(z){p.geometries[j]=z;r();y-=1;u.onLoadComplete();s()}}function o(j){return function(z){p.geometries[j]=z}}function s(){u.callbackProgress({totalModels:K,totalTextures:b,loadedModels:K-y,loadedTextures:b-P},p);u.onLoadProgress();y==0&&P==0&&k(p)}var u=this,x=c.Loader.prototype.extractUrlbase(h),v,E,F,A,H,B,G,J,U,O,g,m,e,ab,a,R,w,I,i,ac,ad,y,P,K,b,p;ac=f;h=new c.BinaryLoader;ad=new c.JSONLoader;P=y=0;p={scene:new c.Scene,geometries:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},triggers:{},empties:{}};f=!1;for(F in ac.objects){if(J=ac.objects[F],J.meshCollider){f=!0;break}}if(f){p.scene.collisions=new c.CollisionSystem}if(ac.transform){f=ac.transform.position;U=ac.transform.rotation;var n=ac.transform.scale;f&&p.scene.position.set(f[0],f[1],f[2]);U&&p.scene.rotation.set(U[0],U[1],U[2]);n&&p.scene.scale.set(n[0],n[1],n[2]);(f||U||n)&&p.scene.updateMatrix()}f=function(){P-=1;s();u.onLoadComplete()};for(H in ac.cameras){U=ac.cameras[H],U.type=="perspective"?w=new c.PerspectiveCamera(U.fov,U.aspect,U.near,U.far):U.type=="ortho"&&(w=new c.OrthographicCamera(U.left,U.right,U.top,U.bottom,U.near,U.far)),g=U.position,U=U.target,w.position.set(g[0],g[1],g[2]),w.target=new c.Vector3(U[0],U[1],U[2]),p.cameras[H]=w}for(A in ac.lights){U=ac.lights[A],H=U.color!==void 0?U.color:16777215,w=U.intensity!==void 0?U.intensity:1,U.type=="directional"?(g=U.direction,O=new c.DirectionalLight(H,w),O.position.set(g[0],g[1],g[2]),O.position.normalize()):U.type=="point"?(g=U.position,O=U.distance,O=new c.PointLight(H,w,O),O.position.set(g[0],g[1],g[2])):U.type=="ambient"&&(O=new c.AmbientLight(H)),p.scene.add(O),p.lights[A]=O}for(B in ac.fogs){A=ac.fogs[B],A.type=="linear"?I=new c.Fog(0,A.near,A.far):A.type=="exp2"&&(I=new c.FogExp2(0,A.density)),U=A.color,I.color.setRGB(U[0],U[1],U[2]),p.fogs[B]=I}if(p.cameras&&ac.defaults.camera){p.currentCamera=p.cameras[ac.defaults.camera]}if(p.fogs&&ac.defaults.fog){p.scene.fog=p.fogs[ac.defaults.fog]}U=ac.defaults.bgcolor;p.bgColor=new c.Color;p.bgColor.setRGB(U[0],U[1],U[2]);p.bgColorAlpha=ac.defaults.bgalpha;for(v in ac.geometries){if(B=ac.geometries[v],B.type=="bin_mesh"||B.type=="ascii_mesh"){y+=1,u.onLoadStart()}}K=y;for(v in ac.geometries){B=ac.geometries[v],B.type=="cube"?(R=new c.CubeGeometry(B.width,B.height,B.depth,B.segmentsWidth,B.segmentsHeight,B.segmentsDepth,null,B.flipped,B.sides),p.geometries[v]=R):B.type=="plane"?(R=new c.PlaneGeometry(B.width,B.height,B.segmentsWidth,B.segmentsHeight),p.geometries[v]=R):B.type=="sphere"?(R=new c.SphereGeometry(B.radius,B.segmentsWidth,B.segmentsHeight),p.geometries[v]=R):B.type=="cylinder"?(R=new c.CylinderGeometry(B.topRad,B.botRad,B.height,B.radSegs,B.heightSegs),p.geometries[v]=R):B.type=="torus"?(R=new c.TorusGeometry(B.radius,B.tube,B.segmentsR,B.segmentsT),p.geometries[v]=R):B.type=="icosahedron"?(R=new c.IcosahedronGeometry(B.subdivisions),p.geometries[v]=R):B.type=="bin_mesh"?h.load(l(B.url,ac.urlBaseType),q(v)):B.type=="ascii_mesh"?ad.load(l(B.url,ac.urlBaseType),q(v)):B.type=="embedded_mesh"&&(B=ac.embeds[B.id])&&ad.createModel(B,o(v),"")}for(G in ac.textures){if(v=ac.textures[G],v.url instanceof Array){P+=v.url.length;for(B=0;B<v.url.length;B++){u.onLoadStart()}}else{P+=1,u.onLoadStart()}}b=P;for(G in ac.textures){v=ac.textures[G];if(v.mapping!=void 0&&c[v.mapping]!=void 0){v.mapping=new c[v.mapping]}if(v.url instanceof Array){B=[];for(var t=0;t<v.url.length;t++){B[t]=l(v.url[t],ac.urlBaseType)}B=c.ImageUtils.loadTextureCube(B,v.mapping,f)}else{B=c.ImageUtils.loadTexture(l(v.url,ac.urlBaseType),v.mapping,f);if(c[v.minFilter]!=void 0){B.minFilter=c[v.minFilter]}if(c[v.magFilter]!=void 0){B.magFilter=c[v.magFilter]}if(v.repeat){B.repeat.set(v.repeat[0],v.repeat[1]);if(v.repeat[0]!=1){B.wrapS=c.RepeatWrapping}if(v.repeat[1]!=1){B.wrapT=c.RepeatWrapping}}v.offset&&B.offset.set(v.offset[0],v.offset[1]);if(v.wrap){I={repeat:c.RepeatWrapping,mirror:c.MirroredRepeatWrapping};if(I[v.wrap[0]]!==void 0){B.wrapS=I[v.wrap[0]]}if(I[v.wrap[1]]!==void 0){B.wrapT=I[v.wrap[1]]}}}p.textures[G]=B}for(E in ac.materials){G=ac.materials[E];for(a in G.parameters){if(a=="envMap"||a=="map"||a=="lightMap"){G.parameters[a]=p.textures[G.parameters[a]]}else{if(a=="shading"){G.parameters[a]=G.parameters[a]=="flat"?c.FlatShading:c.SmoothShading}else{if(a=="blending"){G.parameters[a]=c[G.parameters[a]]?c[G.parameters[a]]:c.NormalBlending}else{if(a=="combine"){G.parameters[a]=G.parameters[a]=="MixOperation"?c.MixOperation:c.MultiplyOperation}else{if(a=="vertexColors"){if(G.parameters[a]=="face"){G.parameters[a]=c.FaceColors}else{if(G.parameters[a]){G.parameters[a]=c.VertexColors}}}}}}}}if(G.parameters.opacity!==void 0&&G.parameters.opacity<1){G.parameters.transparent=!0}if(G.parameters.normalMap){v=c.ShaderUtils.lib.normal;f=c.UniformsUtils.clone(v.uniforms);B=G.parameters.color;I=G.parameters.specular;h=G.parameters.ambient;ad=G.parameters.shininess;f.tNormal.texture=p.textures[G.parameters.normalMap];if(G.parameters.normalMapFactor){f.uNormalScale.value=G.parameters.normalMapFactor}if(G.parameters.map){f.tDiffuse.texture=G.parameters.map,f.enableDiffuse.value=!0}if(G.parameters.lightMap){f.tAO.texture=G.parameters.lightMap,f.enableAO.value=!0}if(G.parameters.specularMap){f.tSpecular.texture=p.textures[G.parameters.specularMap],f.enableSpecular.value=!0}f.uDiffuseColor.value.setHex(B);f.uSpecularColor.value.setHex(I);f.uAmbientColor.value.setHex(h);f.uShininess.value=ad;if(G.parameters.opacity){f.uOpacity.value=G.parameters.opacity}G=new c.ShaderMaterial({fragmentShader:v.fragmentShader,vertexShader:v.vertexShader,uniforms:f,lights:!0,fog:!0})}else{G=new c[G.type](G.parameters)}p.materials[E]=G}r();u.callbackSync(p);s()};c.UTF8Loader=function(){};c.UTF8Loader.prototype=new c.UTF8Loader;c.UTF8Loader.prototype.constructor=c.UTF8Loader;c.UTF8Loader.prototype.load=function(f,h,g){if(f instanceof Object){console.warn("DEPRECATED: UTF8Loader( parameters ) is now UTF8Loader( url, callback, metaData )."),g=f,f=g.model,h=g.callback,g={scale:g.scale,offsetX:g.offsetX,offsetY:g.offsetY,offsetZ:g.offsetZ}}var q=new XMLHttpRequest,b=g.scale!==void 0?g.scale:1,a=g.offsetX!==void 0?g.offsetX:0,r=g.offsetY!==void 0?g.offsetY:0,e=g.offsetZ!==void 0?g.offsetZ:0;q.onreadystatechange=function(){q.readyState==4?q.status==200||q.status==0?c.UTF8Loader.prototype.createModel(q.responseText,h,b,a,r,e):alert("Couldn't load ["+f+"] ["+q.status+"]"):q.readyState!=3&&q.readyState==2&&q.getResponseHeader("Content-Length")};q.open("GET",f,!0);q.send(null)};c.UTF8Loader.prototype.decompressMesh=function(f){var h=f.charCodeAt(0);h>=57344&&(h-=2048);h++;for(var g=new Float32Array(8*h),q=1,b=0;b<8;b++){for(var a=0,r=0;r<h;++r){var e=f.charCodeAt(r+q);a+=e>>1^-(e&1);g[8*r+b]=a}q+=h}h=f.length-q;a=new Uint16Array(h);for(b=r=0;b<h;b++){e=f.charCodeAt(b+q),a[b]=r-e,e==0&&r++}return[g,a]};c.UTF8Loader.prototype.createModel=function(g,p,o,a,f,e){var b=function(){var k=this;k.materials=[];c.Geometry.call(this);var h=c.UTF8Loader.prototype.decompressMesh(g),j=[],i=[];(function(x,l,n){for(var t,y,m,q=x.length;n<q;n+=l){t=x[n],y=x[n+1],m=x[n+2],t=t/16383*o,y=y/16383*o,m=m/16383*o,t+=a,y+=f,m+=e,k.vertices.push(new c.Vertex(new c.Vector3(t,y,m)))}})(h[0],8,0);(function(w,x,l){for(var m,n,v=w.length;l<v;l+=x){m=w[l],n=w[l+1],m/=1023,n/=1023,i.push(m,1-n)}})(h[0],8,3);(function(y,z,l){for(var m,n,w,x=y.length;l<x;l+=z){m=y[l],n=y[l+1],w=y[l+2],m=(m-512)/511,n=(n-512)/511,w=(w-512)/511,j.push(m,n,w)}})(h[0],8,5);(function(l){var m,n,s,u,v,w,R,J,A,x=l.length;for(m=0;m<x;m+=3){n=l[m];s=l[m+1];u=l[m+2];v=k;J=n;A=s;w=u;R=n;var y=s,S=u,T=v.materials[0],E=j[y*3],U=j[y*3+1],y=j[y*3+2],B=j[S*3],F=j[S*3+1],S=j[S*3+2];R=new c.Vector3(j[R*3],j[R*3+1],j[R*3+2]);y=new c.Vector3(E,U,y);S=new c.Vector3(B,F,S);v.faces.push(new c.Face3(J,A,w,[R,y,S],null,T));v=i[n*2];n=i[n*2+1];w=i[s*2];R=i[s*2+1];J=i[u*2];A=i[u*2+1];u=k.faceVertexUvs[0];s=w;w=R;R=[];R.push(new c.UV(v,n));R.push(new c.UV(s,w));R.push(new c.UV(J,A));u.push(R)}})(h[1]);this.computeCentroids();this.computeFaceNormals()};b.prototype=new c.Geometry;b.prototype.constructor=b;p(new b)};c.Axes=function(){c.Object3D.call(this);var b=new c.Geometry;b.vertices.push(new c.Vertex);b.vertices.push(new c.Vertex(new c.Vector3(0,100,0)));var a=new c.CylinderGeometry(0,5,25,5,1),g=new c.Line(b,new c.LineBasicMaterial({color:16711680}));g.rotation.z=-Math.PI/2;this.add(g);g=new c.Mesh(a,new c.MeshBasicMaterial({color:16711680}));g.position.x=100;g.rotation.z=-Math.PI/2;this.add(g);g=new c.Line(b,new c.LineBasicMaterial({color:65280}));this.add(g);g=new c.Mesh(a,new c.MeshBasicMaterial({color:65280}));g.position.y=100;this.add(g);g=new c.Line(b,new c.LineBasicMaterial({color:255}));g.rotation.x=Math.PI/2;this.add(g);g=new c.Mesh(a,new c.MeshBasicMaterial({color:255}));g.position.z=100;g.rotation.x=Math.PI/2;this.add(g)};c.Axes.prototype=new c.Object3D;c.Axes.prototype.constructor=c.Axes;c.MarchingCubes=function(b,a){c.Object3D.call(this);this.material=a;this.init=function(e){this.resolution=e;this.isolation=80;this.size=e;this.size2=this.size*this.size;this.size3=this.size2*this.size;this.halfsize=this.size/2;this.delta=2/this.size;this.yd=this.size;this.zd=this.size2;this.field=new Float32Array(this.size3);this.normal_cache=new Float32Array(this.size3*3);this.vlist=new Float32Array(36);this.nlist=new Float32Array(36);this.firstDraw=!0;this.maxCount=4096;this.count=0;this.hasNormal=this.hasPos=!1;this.positionArray=new Float32Array(this.maxCount*3);this.normalArray=new Float32Array(this.maxCount*3)};this.lerp=function(j,e,g){return j+(e-j)*g};this.VIntX=function(l,o,e,x,w,f,g,i,h,k){w=(w-h)/(k-h);h=this.normal_cache;o[x]=f+w*this.delta;o[x+1]=g;o[x+2]=i;e[x]=this.lerp(h[l],h[l+3],w);e[x+1]=this.lerp(h[l+1],h[l+4],w);e[x+2]=this.lerp(h[l+2],h[l+5],w)};this.VIntY=function(l,o,e,x,w,f,g,i,h,k){w=(w-h)/(k-h);h=this.normal_cache;o[x]=f;o[x+1]=g+w*this.delta;o[x+2]=i;o=l+this.yd*3;e[x]=this.lerp(h[l],h[o],w);e[x+1]=this.lerp(h[l+1],h[o+1],w);e[x+2]=this.lerp(h[l+2],h[o+2],w)};this.VIntZ=function(l,o,e,x,w,f,g,i,h,k){w=(w-h)/(k-h);h=this.normal_cache;o[x]=f;o[x+1]=g;o[x+2]=i+w*this.delta;o=l+this.zd*3;e[x]=this.lerp(h[l],h[o],w);e[x+1]=this.lerp(h[l+1],h[o+1],w);e[x+2]=this.lerp(h[l+2],h[o+2],w)};this.compNorm=function(h){var e=h*3;this.normal_cache[e]===0&&(this.normal_cache[e]=this.field[h-1]-this.field[h+1],this.normal_cache[e+1]=this.field[h-this.yd]-this.field[h+this.yd],this.normal_cache[e+2]=this.field[h-this.zd]-this.field[h+this.zd])};this.polygonize=function(ac,ad,g,f,e,h){var i=f+1,l=f+this.yd,k=f+this.zd,o=i+this.yd,p=i+this.zd,m=f+this.yd+this.zd,t=i+this.yd+this.zd,n=0,r=this.field[f],w=this.field[i],B=this.field[l],x=this.field[o],s=this.field[k],y=this.field[p],q=this.field[m],F=this.field[t];r<e&&(n|=1);w<e&&(n|=2);B<e&&(n|=8);x<e&&(n|=4);s<e&&(n|=16);y<e&&(n|=32);q<e&&(n|=128);F<e&&(n|=64);var v=c.edgeTable[n];if(v===0){return 0}var A=this.delta,J=ac+A,u=ad+A,A=g+A;v&1&&(this.compNorm(f),this.compNorm(i),this.VIntX(f*3,this.vlist,this.nlist,0,e,ac,ad,g,r,w));v&2&&(this.compNorm(i),this.compNorm(o),this.VIntY(i*3,this.vlist,this.nlist,3,e,J,ad,g,w,x));v&4&&(this.compNorm(l),this.compNorm(o),this.VIntX(l*3,this.vlist,this.nlist,6,e,ac,u,g,B,x));v&8&&(this.compNorm(f),this.compNorm(l),this.VIntY(f*3,this.vlist,this.nlist,9,e,ac,ad,g,r,B));v&16&&(this.compNorm(k),this.compNorm(p),this.VIntX(k*3,this.vlist,this.nlist,12,e,ac,ad,A,s,y));v&32&&(this.compNorm(p),this.compNorm(t),this.VIntY(p*3,this.vlist,this.nlist,15,e,J,ad,A,y,F));v&64&&(this.compNorm(m),this.compNorm(t),this.VIntX(m*3,this.vlist,this.nlist,18,e,ac,u,A,q,F));v&128&&(this.compNorm(k),this.compNorm(m),this.VIntY(k*3,this.vlist,this.nlist,21,e,ac,ad,A,s,q));v&256&&(this.compNorm(f),this.compNorm(k),this.VIntZ(f*3,this.vlist,this.nlist,24,e,ac,ad,g,r,s));v&512&&(this.compNorm(i),this.compNorm(p),this.VIntZ(i*3,this.vlist,this.nlist,27,e,J,ad,g,w,y));v&1024&&(this.compNorm(o),this.compNorm(t),this.VIntZ(o*3,this.vlist,this.nlist,30,e,J,u,g,x,F));v&2048&&(this.compNorm(l),this.compNorm(m),this.VIntZ(l*3,this.vlist,this.nlist,33,e,ac,u,g,B,q));n<<=4;for(e=f=0;c.triTable[n+e]!=-1;){ac=n+e,ad=ac+1,g=ac+2,this.posnormtriv(this.vlist,this.nlist,3*c.triTable[ac],3*c.triTable[ad],3*c.triTable[g],h),e+=3,f++}return f};this.posnormtriv=function(h,i,e,r,q,f){var g=this.count*3;this.positionArray[g]=h[e];this.positionArray[g+1]=h[e+1];this.positionArray[g+2]=h[e+2];this.positionArray[g+3]=h[r];this.positionArray[g+4]=h[r+1];this.positionArray[g+5]=h[r+2];this.positionArray[g+6]=h[q];this.positionArray[g+7]=h[q+1];this.positionArray[g+8]=h[q+2];this.normalArray[g]=i[e];this.normalArray[g+1]=i[e+1];this.normalArray[g+2]=i[e+2];this.normalArray[g+3]=i[r];this.normalArray[g+4]=i[r+1];this.normalArray[g+5]=i[r+2];this.normalArray[g+6]=i[q];this.normalArray[g+7]=i[q+1];this.normalArray[g+8]=i[q+2];this.hasNormal=this.hasPos=!0;this.count+=3;this.count>=this.maxCount-3&&f(this)};this.begin=function(){this.count=0;this.hasNormal=this.hasPos=!1};this.end=function(h){if(this.count!==0){for(var e=this.count*3;e<this.positionArray.length;e++){this.positionArray[e]=0}h(this)}};this.addBall=function(e,f,m,k,h){var n=this.size*Math.sqrt(k/h),p=m*this.size,t=f*this.size,q=e*this.size,M=Math.floor(p-n);M<1&&(M=1);p=Math.floor(p+n);p>this.size-1&&(p=this.size-1);var g=Math.floor(t-n);g<1&&(g=1);t=Math.floor(t+n);t>this.size-1&&(t=this.size-1);var u=Math.floor(q-n);u<1&&(u=1);n=Math.floor(q+n);n>this.size-1&&(n=this.size-1);for(var l,w,i,o,N,r;M<p;M++){q=this.size2*M;w=M/this.size-m;N=w*w;for(w=g;w<t;w++){i=q+this.size*w;l=w/this.size-f;r=l*l;for(l=u;l<n;l++){o=l/this.size-e,o=k/(0.000001+o*o+r+N)-h,o>0&&(this.field[i+l]+=o)}}}};this.addPlaneX=function(i,k){var o,m,l,p,A,e=this.size,B=this.yd,g=this.zd,h=this.field,f=e*Math.sqrt(i/k);f>e&&(f=e);for(o=0;o<f;o++){if(m=o/e,m*=m,p=i/(0.0001+m)-k,p>0){for(m=0;m<e;m++){A=o+m*B;for(l=0;l<e;l++){h[g*l+A]+=p}}}}};this.addPlaneY=function(f,g){var m,l,k,o,p,C,r=this.size,e=this.yd,h=this.zd,D=this.field,i=r*Math.sqrt(f/g);i>r&&(i=r);for(l=0;l<i;l++){if(m=l/r,m*=m,o=f/(0.0001+m)-g,o>0){p=l*e;for(m=0;m<r;m++){C=p+m;for(k=0;k<r;k++){D[h*k+C]+=o}}}}};this.addPlaneZ=function(f,g){var m,l,k,o,p,C,r=this.size,e=this.yd,h=this.zd,D=this.field,i=r*Math.sqrt(f/g);i>r&&(i=r);for(k=0;k<i;k++){if(m=k/r,m*=m,o=f/(0.0001+m)-g,o>0){p=h*k;for(l=0;l<r;l++){C=p+l*e;for(m=0;m<r;m++){D[C+m]+=o}}}}};this.reset=function(){var e;for(e=0;e<this.size3;e++){this.normal_cache[e*3]=0,this.field[e]=0}};this.render=function(k){this.begin();var l,y,p,o,z,e,g,f,h,i=this.size-2;for(o=1;o<i;o++){h=this.size2*o;g=(o-this.halfsize)/this.halfsize;for(p=1;p<i;p++){f=h+this.size*p;e=(p-this.halfsize)/this.halfsize;for(y=1;y<i;y++){z=(y-this.halfsize)/this.halfsize,l=f+y,this.polygonize(z,e,g,l,this.isolation,k)}}}this.end(k)};this.generateGeometry=function(){var j=0,e=new c.Geometry,g=[];this.render(function(p){var o,v,f,i,h,l,m,k;for(o=0;o<p.count;o++){m=o*3,h=m+1,k=m+2,v=p.positionArray[m],f=p.positionArray[h],i=p.positionArray[k],l=new c.Vector3(v,f,i),v=p.normalArray[m],f=p.normalArray[h],i=p.normalArray[k],m=new c.Vector3(v,f,i),m.normalize(),h=new c.Vertex(l),e.vertices.push(h),g.push(m)}l=p.count/3;for(o=0;o<l;o++){m=(j+o)*3,h=m+1,k=m+2,v=g[m],f=g[h],i=g[k],m=new c.Face3(m,h,k,[v,f,i]),e.faces.push(m)}j+=l;p.count=0});return e};this.init(b)};c.MarchingCubes.prototype=new c.Object3D;c.MarchingCubes.prototype.constructor=c.MarchingCubes;c.edgeTable=new Int32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]);c.triTable=new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]);if(c.WebGLRenderer){c.AnaglyphWebGLRenderer=function(r){c.WebGLRenderer.call(this,r);this.autoUpdateScene=!1;var a=this,H=this.setSize,e=this.render,i=new c.PerspectiveCamera,g=new c.PerspectiveCamera,f=new c.Matrix4,k=new c.Matrix4,l,n,m,G;i.matrixAutoUpdate=g.matrixAutoUpdate=!1;var r={minFilter:c.LinearFilter,magFilter:c.NearestFilter,format:c.RGBAFormat},b=new c.WebGLRenderTarget(512,512,r),o=new c.WebGLRenderTarget(512,512,r),h=new c.PerspectiveCamera(53,1,1,10000);h.position.z=2;var r=new c.ShaderMaterial({uniforms:{mapLeft:{type:"t",value:0,texture:b},mapRight:{type:"t",value:1,texture:o}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D mapLeft;\nuniform sampler2D mapRight;\nvarying vec2 vUv;\nvoid main() {\nvec4 colorL, colorR;\nvec2 uv = vUv;\ncolorL = texture2D( mapLeft, uv );\ncolorR = texture2D( mapRight, uv );\ngl_FragColor = vec4( colorL.g * 0.7 + colorL.b * 0.3, colorR.g, colorR.b, colorL.a + colorR.a ) * 1.1;\n}"}),p=new c.Scene;p.add(new c.Mesh(new c.PlaneGeometry(2,2),r));p.add(h);this.setSize=function(q,j){H.call(a,q,j);b.width=q;b.height=j;o.width=q;o.height=j};this.render=function(t,v){t.updateMatrixWorld();if(l!==v.aspect||n!==v.near||m!==v.far||G!==v.fov){l=v.aspect;n=v.near;m=v.far;G=v.fov;var u=v.projectionMatrix.clone(),s=125/30*0.5,j=s*n/125,q=n*Math.tan(G*Math.PI/360),w;f.n14=s;k.n14=-s;s=-q*l+j;w=q*l+j;u.n11=2*n/(w-s);u.n13=(w+s)/(w-s);i.projectionMatrix.copy(u);s=-q*l-j;w=q*l-j;u.n11=2*n/(w-s);u.n13=(w+s)/(w-s);g.projectionMatrix.copy(u)}i.matrixWorld.copy(v.matrixWorld).multiplySelf(k);i.position.copy(v.position);i.near=v.near;i.far=v.far;e.call(a,t,i,b,!0);g.matrixWorld.copy(v.matrixWorld).multiplySelf(f);g.position.copy(v.position);g.near=v.near;g.far=v.far;e.call(a,t,g,o,!0);p.updateMatrixWorld();e.call(a,p,h)}}}if(c.WebGLRenderer){c.CrosseyedWebGLRenderer=function(f){c.WebGLRenderer.call(this,f);this.autoClear=!1;var h=this,g=this.setSize,q=this.render,b,a,r=new c.PerspectiveCamera;r.target=new c.Vector3(0,0,0);var e=new c.PerspectiveCamera;e.target=new c.Vector3(0,0,0);h.separation=10;if(f&&f.separation!==void 0){h.separation=f.separation}this.setSize=function(j,i){g.call(h,j,i);b=j/2;a=i};this.render=function(i,j){this.clear();r.fov=j.fov;r.aspect=0.5*j.aspect;r.near=j.near;r.far=j.far;r.updateProjectionMatrix();r.position.copy(j.position);r.target.copy(j.target);r.translateX(h.separation);r.lookAt(r.target);e.projectionMatrix=r.projectionMatrix;e.position.copy(j.position);e.target.copy(j.target);e.translateX(-h.separation);e.lookAt(e.target);this.setViewport(0,0,b,a);q.call(h,i,r);this.setViewport(b,0,b,a);q.call(h,i,e,!1)}}}return c});