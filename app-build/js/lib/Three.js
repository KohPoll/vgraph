define(function(){var a=window;var b=b||{};if(!a.Int32Array){a.Int32Array=Array,a.Float32Array=Array}b.Clock=function(c){this.autoStart=c!==void 0?c:!0;this.elapsedTime=this.oldTime=this.startTime=0;this.running=!1};b.Clock.prototype.start=function(){this.oldTime=this.startTime=Date.now();this.running=!0};b.Clock.prototype.stop=function(){this.getElapsedTime();this.running=!1};b.Clock.prototype.getElapsedTime=function(){this.elapsedTime+=this.getDelta();return this.elapsedTime};b.Clock.prototype.getDelta=function(){var d=0;this.autoStart&&!this.running&&this.start();if(this.running){var e=Date.now(),d=0.001*(e-this.oldTime);this.oldTime=e;this.elapsedTime+=d}return d};b.Color=function(c){c!==void 0&&this.setHex(c);return this};b.Color.prototype={constructor:b.Color,r:1,g:1,b:1,copy:function(c){this.r=c.r;this.g=c.g;this.b=c.b;return this},copyGammaToLinear:function(c){this.r=c.r*c.r;this.g=c.g*c.g;this.b=c.b*c.b;return this},copyLinearToGamma:function(c){this.r=Math.sqrt(c.r);this.g=Math.sqrt(c.g);this.b=Math.sqrt(c.b);return this},setRGB:function(e,f,d){this.r=e;this.g=f;this.b=d;return this},setHSV:function(h,l,e){var k,i,j;if(e===0){this.r=this.g=this.b=0}else{switch(k=Math.floor(h*6),i=h*6-k,h=e*(1-l),j=e*(1-l*i),l=e*(1-l*(1-i)),k){case 1:this.r=j;this.g=e;this.b=h;break;case 2:this.r=h;this.g=e;this.b=l;break;case 3:this.r=h;this.g=j;this.b=e;break;case 4:this.r=l;this.g=h;this.b=e;break;case 5:this.r=e;this.g=h;this.b=j;break;case 6:case 0:this.r=e,this.g=l,this.b=h}}return this},setHex:function(c){c=Math.floor(c);this.r=(c>>16&255)/255;this.g=(c>>8&255)/255;this.b=(c&255)/255;return this},getHex:function(){return ~~(this.r*255)<<16^~~(this.g*255)<<8^~~(this.b*255)},getContextStyle:function(){return"rgb("+Math.floor(this.r*255)+","+Math.floor(this.g*255)+","+Math.floor(this.b*255)+")"},clone:function(){return(new b.Color).setRGB(this.r,this.g,this.b)}};b.Vector2=function(d,e){this.x=d||0;this.y=e||0};b.Vector2.prototype={constructor:b.Vector2,set:function(d,e){this.x=d;this.y=e;return this},copy:function(c){this.x=c.x;this.y=c.y;return this},clone:function(){return new b.Vector2(this.x,this.y)},add:function(d,e){this.x=d.x+e.x;this.y=d.y+e.y;return this},addSelf:function(c){this.x+=c.x;this.y+=c.y;return this},sub:function(d,e){this.x=d.x-e.x;this.y=d.y-e.y;return this},subSelf:function(c){this.x-=c.x;this.y-=c.y;return this},multiplyScalar:function(c){this.x*=c;this.y*=c;return this},divideScalar:function(c){c?(this.x/=c,this.y/=c):this.set(0,0);return this},negate:function(){return this.multiplyScalar(-1)},dot:function(c){return this.x*c.x+this.y*c.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(c){return Math.sqrt(this.distanceToSquared(c))},distanceToSquared:function(d){var e=this.x-d.x,d=this.y-d.y;return e*e+d*d},setLength:function(c){return this.normalize().multiplyScalar(c)},equals:function(c){return c.x===this.x&&c.y===this.y}};b.Vector3=function(e,f,d){this.x=e||0;this.y=f||0;this.z=d||0};b.Vector3.prototype={constructor:b.Vector3,set:function(e,f,d){this.x=e;this.y=f;this.z=d;return this},setX:function(c){this.x=c;return this},setY:function(c){this.y=c;return this},setZ:function(c){this.z=c;return this},copy:function(c){this.x=c.x;this.y=c.y;this.z=c.z;return this},clone:function(){return new b.Vector3(this.x,this.y,this.z)},add:function(d,e){this.x=d.x+e.x;this.y=d.y+e.y;this.z=d.z+e.z;return this},addSelf:function(c){this.x+=c.x;this.y+=c.y;this.z+=c.z;return this},addScalar:function(c){this.x+=c;this.y+=c;this.z+=c;return this},sub:function(d,e){this.x=d.x-e.x;this.y=d.y-e.y;this.z=d.z-e.z;return this},subSelf:function(c){this.x-=c.x;this.y-=c.y;this.z-=c.z;return this},multiply:function(d,e){this.x=d.x*e.x;this.y=d.y*e.y;this.z=d.z*e.z;return this},multiplySelf:function(c){this.x*=c.x;this.y*=c.y;this.z*=c.z;return this},multiplyScalar:function(c){this.x*=c;this.y*=c;this.z*=c;return this},divideSelf:function(c){this.x/=c.x;this.y/=c.y;this.z/=c.z;return this},divideScalar:function(c){c?(this.x/=c,this.y/=c,this.z/=c):this.z=this.y=this.x=0;return this},negate:function(){return this.multiplyScalar(-1)},dot:function(c){return this.x*c.x+this.y*c.y+this.z*c.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.lengthSq())},lengthManhattan:function(){return this.x+this.y+this.z},normalize:function(){return this.divideScalar(this.length())},setLength:function(c){return this.normalize().multiplyScalar(c)},cross:function(d,e){this.x=d.y*e.z-d.z*e.y;this.y=d.z*e.x-d.x*e.z;this.z=d.x*e.y-d.y*e.x;return this},crossSelf:function(f){var h=this.x,e=this.y,g=this.z;this.x=e*f.z-g*f.y;this.y=g*f.x-h*f.z;this.z=h*f.y-e*f.x;return this},distanceTo:function(c){return Math.sqrt(this.distanceToSquared(c))},distanceToSquared:function(c){return(new b.Vector3).sub(this,c).lengthSq()},setPositionFromMatrix:function(c){this.x=c.n14;this.y=c.n24;this.z=c.n34},setRotationFromMatrix:function(d){var e=Math.cos(this.y);this.y=Math.asin(d.n13);Math.abs(e)>0.00001?(this.x=Math.atan2(-d.n23/e,d.n33/e),this.z=Math.atan2(-d.n12/e,d.n11/e)):(this.x=0,this.z=Math.atan2(d.n21,d.n22))},isZero:function(){return this.lengthSq()<0.0001}};b.Vector4=function(f,h,e,g){this.x=f||0;this.y=h||0;this.z=e||0;this.w=g!==void 0?g:1};b.Vector4.prototype={constructor:b.Vector4,set:function(f,h,e,g){this.x=f;this.y=h;this.z=e;this.w=g;return this},copy:function(c){this.x=c.x;this.y=c.y;this.z=c.z;this.w=c.w!==void 0?c.w:1},clone:function(){return new b.Vector4(this.x,this.y,this.z,this.w)},add:function(d,e){this.x=d.x+e.x;this.y=d.y+e.y;this.z=d.z+e.z;this.w=d.w+e.w;return this},addSelf:function(c){this.x+=c.x;this.y+=c.y;this.z+=c.z;this.w+=c.w;return this},sub:function(d,e){this.x=d.x-e.x;this.y=d.y-e.y;this.z=d.z-e.z;this.w=d.w-e.w;return this},subSelf:function(c){this.x-=c.x;this.y-=c.y;this.z-=c.z;this.w-=c.w;return this},multiplyScalar:function(c){this.x*=c;this.y*=c;this.z*=c;this.w*=c;return this},divideScalar:function(c){c?(this.x/=c,this.y/=c,this.z/=c,this.w/=c):(this.z=this.y=this.x=0,this.w=1);return this},negate:function(){return this.multiplyScalar(-1)},dot:function(c){return this.x*c.x+this.y*c.y+this.z*c.z+this.w*c.w},lengthSq:function(){return this.dot(this)},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},setLength:function(c){return this.normalize().multiplyScalar(c)},lerpSelf:function(d,e){this.x+=(d.x-this.x)*e;this.y+=(d.y-this.y)*e;this.z+=(d.z-this.z)*e;this.w+=(d.w-this.w)*e;return this}};b.Ray=function(X,V){function W(e,d,f){K.sub(f,e);E=K.dot(d);if(E<=0){return null}L=J.add(e,M.copy(d).multiplyScalar(E));return H=f.distanceTo(L)}function U(f,e,h,g){K.sub(g,e);J.sub(h,e);M.sub(f,e);D=K.dot(K);v=K.dot(J);C=K.dot(M);G=J.dot(J);z=J.dot(M);I=1/(D*G-v*v);s=(G*C-v*z)*I;j=(D*z-v*C)*I;return s>=0&&j>=0&&s+j<1}this.origin=X||new b.Vector3;this.direction=V||new b.Vector3;this.intersectScene=function(c){return this.intersectObjects(c.children)};this.intersectObjects=function(f){var e,h,g=[];e=0;for(h=f.length;e<h;e++){Array.prototype.push.apply(g,this.intersectObject(f[e]))}g.sort(function(d,c){return d.distance-c.distance});return g};var R=new b.Vector3,S=new b.Vector3,T=new b.Vector3,Q=new b.Vector3,X=new b.Vector3,V=new b.Vector3,P=new b.Vector3,N=new b.Vector3,O=new b.Vector3;this.intersectObject=function(h){for(var g,f=[],e=0,c=h.children.length;e<c;e++){Array.prototype.push.apply(f,this.intersectObject(h.children[e]))}if(h instanceof b.Particle){e=W(this.origin,this.direction,h.matrixWorld.getPosition());if(e===null||e>h.scale.x){return[]}g={distance:e,point:h.position,face:null,object:h};f.push(g)}else{if(h instanceof b.Mesh){e=W(this.origin,this.direction,h.matrixWorld.getPosition());if(e===null||e>h.geometry.boundingSphere.radius*Math.max(h.scale.x,Math.max(h.scale.y,h.scale.z))){return f}var d,l=h.geometry,i=l.vertices,k;h.matrixRotationWorld.extractRotation(h.matrixWorld);e=0;for(c=l.faces.length;e<c;e++){if(g=l.faces[e],X.copy(this.origin),V.copy(this.direction),k=h.matrixWorld,P=k.multiplyVector3(P.copy(g.centroid)).subSelf(X),d=P.dot(V),!(d<=0)&&(R=k.multiplyVector3(R.copy(i[g.a].position)),S=k.multiplyVector3(S.copy(i[g.b].position)),T=k.multiplyVector3(T.copy(i[g.c].position)),g instanceof b.Face4&&(Q=k.multiplyVector3(Q.copy(i[g.d].position))),N=h.matrixRotationWorld.multiplyVector3(N.copy(g.normal)),d=V.dot(N),h.doubleSided||(h.flipSided?d>0:d<0))){if(d=N.dot(P.sub(R,X))/d,O.add(X,V.multiplyScalar(d)),g instanceof b.Face3){U(O,R,S,T)&&(g={distance:X.distanceTo(O),point:O.clone(),face:g,object:h},f.push(g))}else{if(g instanceof b.Face4&&(U(O,R,S,Q)||U(O,S,T,Q))){g={distance:X.distanceTo(O),point:O.clone(),face:g,object:h},f.push(g)}}}}}}return f};var K=new b.Vector3,J=new b.Vector3,M=new b.Vector3,E,L,H,D,v,C,G,z,I,s,j};b.Rectangle=function(){function j(){m=o-p;n=l-i}var p,i,o,l,m,n,k=!0;this.getX=function(){return p};this.getY=function(){return i};this.getWidth=function(){return m};this.getHeight=function(){return n};this.getLeft=function(){return p};this.getTop=function(){return i};this.getRight=function(){return o};this.getBottom=function(){return l};this.set=function(d,g,c,h){k=!1;p=d;i=g;o=c;l=h;j()};this.addPoint=function(c,d){k?(k=!1,p=c,i=d,o=c,l=d):(p=p<c?p:c,i=i<d?i:d,o=o>c?o:c,l=l>d?l:d);j()};this.add3Points=function(g,q,d,r,h,c){k?(k=!1,p=g<d?g<h?g:h:d<h?d:h,i=q<r?q<c?q:c:r<c?r:c,o=g>d?g>h?g:h:d>h?d:h,l=q>r?q>c?q:c:r>c?r:c):(p=g<d?g<h?g<p?g:p:h<p?h:p:d<h?d<p?d:p:h<p?h:p,i=q<r?q<c?q<i?q:i:c<i?c:i:r<c?r<i?r:i:c<i?c:i,o=g>d?g>h?g>o?g:o:h>o?h:o:d>h?d>o?d:o:h>o?h:o,l=q>r?q>c?q>l?q:l:c>l?c:l:r>c?r>l?r:l:c>l?c:l);j()};this.addRectangle=function(c){k?(k=!1,p=c.getLeft(),i=c.getTop(),o=c.getRight(),l=c.getBottom()):(p=p<c.getLeft()?p:c.getLeft(),i=i<c.getTop()?i:c.getTop(),o=o>c.getRight()?o:c.getRight(),l=l>c.getBottom()?l:c.getBottom());j()};this.inflate=function(c){p-=c;i-=c;o+=c;l+=c;j()};this.minSelf=function(c){p=p>c.getLeft()?p:c.getLeft();i=i>c.getTop()?i:c.getTop();o=o<c.getRight()?o:c.getRight();l=l<c.getBottom()?l:c.getBottom();j()};this.intersects=function(c){return Math.min(o,c.getRight())-Math.max(p,c.getLeft())>=0&&Math.min(l,c.getBottom())-Math.max(i,c.getTop())>=0};this.empty=function(){k=!0;l=o=i=p=0;j()};this.isEmpty=function(){return k}};b.Math={clamp:function(e,f,d){return e<f?f:e>d?d:e},clampBottom:function(d,e){return d<e?e:d},mapLinear:function(f,j,e,i,h){return i+(f-j)*(h-i)/(e-j)},random16:function(){return(65280*Math.random()+255*Math.random())/65535}};b.Matrix3=function(){this.m=[]};b.Matrix3.prototype={constructor:b.Matrix3,transpose:function(){var d,e=this.m;d=e[1];e[1]=e[3];e[3]=d;d=e[2];e[2]=e[6];e[6]=d;d=e[5];e[5]=e[7];e[7]=d;return this},transposeIntoArray:function(d){var e=this.m;d[0]=e[0];d[1]=e[3];d[2]=e[6];d[3]=e[1];d[4]=e[4];d[5]=e[7];d[6]=e[2];d[7]=e[5];d[8]=e[8];return this}};b.Matrix4=function(F,D,E,C,z,A,B,y,x,v,w,s,q,u,j,t){this.set(F!==void 0?F:1,D||0,E||0,C||0,z||0,A!==void 0?A:1,B||0,y||0,x||0,v||0,w!==void 0?w:1,s||0,q||0,u||0,j||0,t!==void 0?t:1);this.flat=Array(16);this.m33=new b.Matrix3};b.Matrix4.prototype={constructor:b.Matrix4,set:function(F,D,E,C,z,A,B,y,x,v,w,s,q,u,j,t){this.n11=F;this.n12=D;this.n13=E;this.n14=C;this.n21=z;this.n22=A;this.n23=B;this.n24=y;this.n31=x;this.n32=v;this.n33=w;this.n34=s;this.n41=q;this.n42=u;this.n43=j;this.n44=t;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},copy:function(c){this.set(c.n11,c.n12,c.n13,c.n14,c.n21,c.n22,c.n23,c.n24,c.n31,c.n32,c.n33,c.n34,c.n41,c.n42,c.n43,c.n44);return this},lookAt:function(h,l,e){var k=b.Matrix4.__v1,i=b.Matrix4.__v2,j=b.Matrix4.__v3;j.sub(h,l).normalize();if(j.length()===0){j.z=1}k.cross(e,j).normalize();k.length()===0&&(j.x+=0.0001,k.cross(e,j).normalize());i.cross(j,k).normalize();this.n11=k.x;this.n12=i.x;this.n13=j.x;this.n21=k.y;this.n22=i.y;this.n23=j.y;this.n31=k.z;this.n32=i.z;this.n33=j.z;return this},multiply:function(ap,an){var ao=ap.n11,am=ap.n12,aj=ap.n13,ak=ap.n14,al=ap.n21,ai=ap.n22,ah=ap.n23,af=ap.n24,ag=ap.n31,ac=ap.n32,ab=ap.n33,ae=ap.n34,X=ap.n41,ad=ap.n42,Z=ap.n43,V=ap.n44,M=an.n11,S=an.n12,Y=an.n13,Q=an.n14,aa=an.n21,L=an.n22,I=an.n23,N=an.n24,H=an.n31,W=an.n32,T=an.n33,z=an.n34,j=an.n41,G=an.n42,C=an.n43,D=an.n44;this.n11=ao*M+am*aa+aj*H+ak*j;this.n12=ao*S+am*L+aj*W+ak*G;this.n13=ao*Y+am*I+aj*T+ak*C;this.n14=ao*Q+am*N+aj*z+ak*D;this.n21=al*M+ai*aa+ah*H+af*j;this.n22=al*S+ai*L+ah*W+af*G;this.n23=al*Y+ai*I+ah*T+af*C;this.n24=al*Q+ai*N+ah*z+af*D;this.n31=ag*M+ac*aa+ab*H+ae*j;this.n32=ag*S+ac*L+ab*W+ae*G;this.n33=ag*Y+ac*I+ab*T+ae*C;this.n34=ag*Q+ac*N+ab*z+ae*D;this.n41=X*M+ad*aa+Z*H+V*j;this.n42=X*S+ad*L+Z*W+V*G;this.n43=X*Y+ad*I+Z*T+V*C;this.n44=X*Q+ad*N+Z*z+V*D;return this},multiplySelf:function(c){return this.multiply(this,c)},multiplyToArray:function(e,f,d){this.multiply(e,f);d[0]=this.n11;d[1]=this.n21;d[2]=this.n31;d[3]=this.n41;d[4]=this.n12;d[5]=this.n22;d[6]=this.n32;d[7]=this.n42;d[8]=this.n13;d[9]=this.n23;d[10]=this.n33;d[11]=this.n43;d[12]=this.n14;d[13]=this.n24;d[14]=this.n34;d[15]=this.n44;return this},multiplyScalar:function(c){this.n11*=c;this.n12*=c;this.n13*=c;this.n14*=c;this.n21*=c;this.n22*=c;this.n23*=c;this.n24*=c;this.n31*=c;this.n32*=c;this.n33*=c;this.n34*=c;this.n41*=c;this.n42*=c;this.n43*=c;this.n44*=c;return this},multiplyVector3:function(f){var j=f.x,e=f.y,i=f.z,h=1/(this.n41*j+this.n42*e+this.n43*i+this.n44);f.x=(this.n11*j+this.n12*e+this.n13*i+this.n14)*h;f.y=(this.n21*j+this.n22*e+this.n23*i+this.n24)*h;f.z=(this.n31*j+this.n32*e+this.n33*i+this.n34)*h;return f},multiplyVector4:function(f){var j=f.x,e=f.y,i=f.z,h=f.w;f.x=this.n11*j+this.n12*e+this.n13*i+this.n14*h;f.y=this.n21*j+this.n22*e+this.n23*i+this.n24*h;f.z=this.n31*j+this.n32*e+this.n33*i+this.n34*h;f.w=this.n41*j+this.n42*e+this.n43*i+this.n44*h;return f},rotateAxis:function(f){var h=f.x,e=f.y,g=f.z;f.x=h*this.n11+e*this.n12+g*this.n13;f.y=h*this.n21+e*this.n22+g*this.n23;f.z=h*this.n31+e*this.n32+g*this.n33;f.normalize();return f},crossVector:function(d){var e=new b.Vector4;e.x=this.n11*d.x+this.n12*d.y+this.n13*d.z+this.n14*d.w;e.y=this.n21*d.x+this.n22*d.y+this.n23*d.z+this.n24*d.w;e.z=this.n31*d.x+this.n32*d.y+this.n33*d.z+this.n34*d.w;e.w=d.w?this.n41*d.x+this.n42*d.y+this.n43*d.z+this.n44*d.w:1;return e},determinant:function(){var F=this.n11,D=this.n12,E=this.n13,C=this.n14,z=this.n21,A=this.n22,B=this.n23,y=this.n24,x=this.n31,v=this.n32,w=this.n33,s=this.n34,q=this.n41,u=this.n42,j=this.n43,t=this.n44;return C*B*v*q-E*y*v*q-C*A*w*q+D*y*w*q+E*A*s*q-D*B*s*q-C*B*x*u+E*y*x*u+C*z*w*u-F*y*w*u-E*z*s*u+F*B*s*u+C*A*x*j-D*y*x*j-C*z*v*j+F*y*v*j+D*z*s*j-F*A*s*j-E*A*x*t+D*B*x*t+E*z*v*t-F*B*v*t-D*z*w*t+F*A*w*t},transpose:function(){var c;c=this.n21;this.n21=this.n12;this.n12=c;c=this.n31;this.n31=this.n13;this.n13=c;c=this.n32;this.n32=this.n23;this.n23=c;c=this.n41;this.n41=this.n14;this.n14=c;c=this.n42;this.n42=this.n24;this.n24=c;c=this.n43;this.n43=this.n34;this.n43=c;return this},clone:function(){var c=new b.Matrix4;c.n11=this.n11;c.n12=this.n12;c.n13=this.n13;c.n14=this.n14;c.n21=this.n21;c.n22=this.n22;c.n23=this.n23;c.n24=this.n24;c.n31=this.n31;c.n32=this.n32;c.n33=this.n33;c.n34=this.n34;c.n41=this.n41;c.n42=this.n42;c.n43=this.n43;c.n44=this.n44;return c},flatten:function(){this.flat[0]=this.n11;this.flat[1]=this.n21;this.flat[2]=this.n31;this.flat[3]=this.n41;this.flat[4]=this.n12;this.flat[5]=this.n22;this.flat[6]=this.n32;this.flat[7]=this.n42;this.flat[8]=this.n13;this.flat[9]=this.n23;this.flat[10]=this.n33;this.flat[11]=this.n43;this.flat[12]=this.n14;this.flat[13]=this.n24;this.flat[14]=this.n34;this.flat[15]=this.n44;return this.flat},flattenToArray:function(c){c[0]=this.n11;c[1]=this.n21;c[2]=this.n31;c[3]=this.n41;c[4]=this.n12;c[5]=this.n22;c[6]=this.n32;c[7]=this.n42;c[8]=this.n13;c[9]=this.n23;c[10]=this.n33;c[11]=this.n43;c[12]=this.n14;c[13]=this.n24;c[14]=this.n34;c[15]=this.n44;return c},flattenToArrayOffset:function(d,e){d[e]=this.n11;d[e+1]=this.n21;d[e+2]=this.n31;d[e+3]=this.n41;d[e+4]=this.n12;d[e+5]=this.n22;d[e+6]=this.n32;d[e+7]=this.n42;d[e+8]=this.n13;d[e+9]=this.n23;d[e+10]=this.n33;d[e+11]=this.n43;d[e+12]=this.n14;d[e+13]=this.n24;d[e+14]=this.n34;d[e+15]=this.n44;return d},setTranslation:function(e,f,d){this.set(1,0,0,e,0,1,0,f,0,0,1,d,0,0,0,1);return this},setScale:function(e,f,d){this.set(e,0,0,0,0,f,0,0,0,0,d,0,0,0,0,1);return this},setRotationX:function(d){var e=Math.cos(d),d=Math.sin(d);this.set(1,0,0,0,0,e,-d,0,0,d,e,0,0,0,0,1);return this},setRotationY:function(d){var e=Math.cos(d),d=Math.sin(d);this.set(e,0,d,0,0,1,0,0,-d,0,e,0,0,0,0,1);return this},setRotationZ:function(d){var e=Math.cos(d),d=Math.sin(d);this.set(e,-d,0,0,d,e,0,0,0,0,1,0,0,0,0,1);return this},setRotationAxis:function(t,r){var s=Math.cos(r),q=Math.sin(r),n=1-s,o=t.x,p=t.y,m=t.z,k=n*o,j=n*p;this.set(k*o+s,k*p-q*m,k*m+q*p,0,k*p+q*m,j*p+s,j*m-q*o,0,k*m-q*p,j*m+q*o,n*m*m+s,0,0,0,0,1);return this},setPosition:function(c){this.n14=c.x;this.n24=c.y;this.n34=c.z;return this},getPosition:function(){return b.Matrix4.__v1.set(this.n14,this.n24,this.n34)},getColumnX:function(){return b.Matrix4.__v1.set(this.n11,this.n21,this.n31)},getColumnY:function(){return b.Matrix4.__v1.set(this.n12,this.n22,this.n32)},getColumnZ:function(){return b.Matrix4.__v1.set(this.n13,this.n23,this.n33)},getInverse:function(H){var F=H.n11,G=H.n12,E=H.n13,B=H.n14,C=H.n21,D=H.n22,A=H.n23,z=H.n24,x=H.n31,y=H.n32,u=H.n33,t=H.n34,w=H.n41,j=H.n42,v=H.n43,s=H.n44;this.n11=A*t*j-z*u*j+z*y*v-D*t*v-A*y*s+D*u*s;this.n12=B*u*j-E*t*j-B*y*v+G*t*v+E*y*s-G*u*s;this.n13=E*z*j-B*A*j+B*D*v-G*z*v-E*D*s+G*A*s;this.n14=B*A*y-E*z*y-B*D*u+G*z*u+E*D*t-G*A*t;this.n21=z*u*w-A*t*w-z*x*v+C*t*v+A*x*s-C*u*s;this.n22=E*t*w-B*u*w+B*x*v-F*t*v-E*x*s+F*u*s;this.n23=B*A*w-E*z*w-B*C*v+F*z*v+E*C*s-F*A*s;this.n24=E*z*x-B*A*x+B*C*u-F*z*u-E*C*t+F*A*t;this.n31=D*t*w-z*y*w+z*x*j-C*t*j-D*x*s+C*y*s;this.n32=B*y*w-G*t*w-B*x*j+F*t*j+G*x*s-F*y*s;this.n33=E*z*w-B*D*w+B*C*j-F*z*j-G*C*s+F*D*s;this.n34=B*D*x-G*z*x-B*C*y+F*z*y+G*C*t-F*D*t;this.n41=A*y*w-D*u*w-A*x*j+C*u*j+D*x*v-C*y*v;this.n42=G*u*w-E*y*w+E*x*j-F*u*j-G*x*v+F*y*v;this.n43=E*D*w-G*A*w-E*C*j+F*A*j+G*C*v-F*D*v;this.n44=G*A*x-E*D*x+E*C*y-F*A*y-G*C*u+F*D*u;this.multiplyScalar(1/H.determinant());return this},setRotationFromEuler:function(x,v){var w=x.x,u=x.y,r=x.z,s=Math.cos(w),w=Math.sin(w),t=Math.cos(u),u=Math.sin(u),q=Math.cos(r),r=Math.sin(r);switch(v){case"YXZ":var p=t*q,m=t*r,n=u*q,j=u*r;this.n11=p+j*w;this.n12=n*w-m;this.n13=s*u;this.n21=s*r;this.n22=s*q;this.n23=-w;this.n31=m*w-n;this.n32=j+p*w;this.n33=s*t;break;case"ZXY":p=t*q;m=t*r;n=u*q;j=u*r;this.n11=p-j*w;this.n12=-s*r;this.n13=n+m*w;this.n21=m+n*w;this.n22=s*q;this.n23=j-p*w;this.n31=-s*u;this.n32=w;this.n33=s*t;break;case"ZYX":p=s*q;m=s*r;n=w*q;j=w*r;this.n11=t*q;this.n12=n*u-m;this.n13=p*u+j;this.n21=t*r;this.n22=j*u+p;this.n23=m*u-n;this.n31=-u;this.n32=w*t;this.n33=s*t;break;case"YZX":p=s*t;m=s*u;n=w*t;j=w*u;this.n11=t*q;this.n12=j-p*r;this.n13=n*r+m;this.n21=r;this.n22=s*q;this.n23=-w*q;this.n31=-u*q;this.n32=m*r+n;this.n33=p-j*r;break;case"XZY":p=s*t;m=s*u;n=w*t;j=w*u;this.n11=t*q;this.n12=-r;this.n13=u*q;this.n21=p*r+j;this.n22=s*q;this.n23=m*r-n;this.n31=n*r-m;this.n32=w*q;this.n33=j*r+p;break;default:p=s*q,m=s*r,n=w*q,j=w*r,this.n11=t*q,this.n12=-t*r,this.n13=u,this.n21=m+n*u,this.n22=p-j*u,this.n23=-w*t,this.n31=j-p*u,this.n32=n+m*u,this.n33=s*t}return this},setRotationFromQuaternion:function(t){var r=t.x,s=t.y,q=t.z,n=t.w,o=r+r,p=s+s,m=q+q,t=r*o,k=r*p;r*=m;var j=s*p;s*=m;q*=m;o*=n;p*=n;n*=m;this.n11=1-(j+q);this.n12=k-n;this.n13=r+p;this.n21=k+n;this.n22=1-(t+q);this.n23=s-o;this.n31=r-p;this.n32=s+o;this.n33=1-(t+j);return this},scale:function(e){var f=e.x,d=e.y,e=e.z;this.n11*=f;this.n12*=d;this.n13*=e;this.n21*=f;this.n22*=d;this.n23*=e;this.n31*=f;this.n32*=d;this.n33*=e;this.n41*=f;this.n42*=d;this.n43*=e;return this},compose:function(f,j,e){var i=b.Matrix4.__m1,h=b.Matrix4.__m2;i.identity();i.setRotationFromQuaternion(j);h.setScale(e.x,e.y,e.z);this.multiply(i,h);this.n14=f.x;this.n24=f.y;this.n34=f.z;return this},decompose:function(h,l,e){var k=b.Matrix4.__v1,i=b.Matrix4.__v2,j=b.Matrix4.__v3;k.set(this.n11,this.n21,this.n31);i.set(this.n12,this.n22,this.n32);j.set(this.n13,this.n23,this.n33);h=h instanceof b.Vector3?h:new b.Vector3;l=l instanceof b.Quaternion?l:new b.Quaternion;e=e instanceof b.Vector3?e:new b.Vector3;e.x=k.length();e.y=i.length();e.z=j.length();h.x=this.n14;h.y=this.n24;h.z=this.n34;k=b.Matrix4.__m1;k.copy(this);k.n11/=e.x;k.n21/=e.x;k.n31/=e.x;k.n12/=e.y;k.n22/=e.y;k.n32/=e.y;k.n13/=e.z;k.n23/=e.z;k.n33/=e.z;l.setFromRotationMatrix(k);return[h,l,e]},extractPosition:function(c){this.n14=c.n14;this.n24=c.n24;this.n34=c.n34;return this},extractRotation:function(f){var h=b.Matrix4.__v1,e=1/h.set(f.n11,f.n21,f.n31).length(),g=1/h.set(f.n12,f.n22,f.n32).length(),h=1/h.set(f.n13,f.n23,f.n33).length();this.n11=f.n11*e;this.n21=f.n21*e;this.n31=f.n31*e;this.n12=f.n12*g;this.n22=f.n22*g;this.n32=f.n32*g;this.n13=f.n13*h;this.n23=f.n23*h;this.n33=f.n33*h;return this}};b.Matrix4.makeInvert3x3=function(x){var v=x.m33,w=v.m,u=x.n33*x.n22-x.n32*x.n23,r=-x.n33*x.n21+x.n31*x.n23,s=x.n32*x.n21-x.n31*x.n22,t=-x.n33*x.n12+x.n32*x.n13,q=x.n33*x.n11-x.n31*x.n13,p=-x.n32*x.n11+x.n31*x.n12,m=x.n23*x.n12-x.n22*x.n13,n=-x.n23*x.n11+x.n21*x.n13,j=x.n22*x.n11-x.n21*x.n12,x=x.n11*u+x.n21*t+x.n31*m;x===0&&console.error("THREE.Matrix4.makeInvert3x3: Matrix not invertible.");x=1/x;w[0]=x*u;w[1]=x*r;w[2]=x*s;w[3]=x*t;w[4]=x*q;w[5]=x*p;w[6]=x*m;w[7]=x*n;w[8]=x*j;return v};b.Matrix4.makeFrustum=function(i,n,h,m,j,k){var l;l=new b.Matrix4;l.n11=2*j/(n-i);l.n12=0;l.n13=(n+i)/(n-i);l.n14=0;l.n21=0;l.n22=2*j/(m-h);l.n23=(m+h)/(m-h);l.n24=0;l.n31=0;l.n32=0;l.n33=-(k+j)/(k-j);l.n34=-2*k*j/(k-j);l.n41=0;l.n42=0;l.n43=-1;l.n44=0;return l};b.Matrix4.makePerspective=function(f,j,e,i){var h,f=e*Math.tan(f*Math.PI/360);h=-f;return b.Matrix4.makeFrustum(h*j,f*j,h,f,e,i)};b.Matrix4.makeOrtho=function(t,r,s,q,n,o){var p,m,k,j;p=new b.Matrix4;m=r-t;k=s-q;j=o-n;p.n11=2/m;p.n12=0;p.n13=0;p.n14=-((r+t)/m);p.n21=0;p.n22=2/k;p.n23=0;p.n24=-((s+q)/k);p.n31=0;p.n32=0;p.n33=-2/j;p.n34=-((o+n)/j);p.n41=0;p.n42=0;p.n43=0;p.n44=1;return p};b.Matrix4.__v1=new b.Vector3;b.Matrix4.__v2=new b.Vector3;b.Matrix4.__v3=new b.Vector3;b.Matrix4.__m1=new b.Matrix4;b.Matrix4.__m2=new b.Matrix4;b.Object3D=function(){this.name="";this.id=b.Object3DCount++;this.parent=void 0;this.children=[];this.up=new b.Vector3(0,1,0);this.position=new b.Vector3;this.rotation=new b.Vector3;this.eulerOrder="XYZ";this.scale=new b.Vector3(1,1,1);this.flipSided=this.doubleSided=this.dynamic=!1;this.renderDepth=null;this.rotationAutoUpdate=!0;this.matrix=new b.Matrix4;this.matrixWorld=new b.Matrix4;this.matrixRotationWorld=new b.Matrix4;this.matrixWorldNeedsUpdate=this.matrixAutoUpdate=!0;this.quaternion=new b.Quaternion;this.useQuaternion=!1;this.boundRadius=0;this.boundRadiusScale=1;this.visible=!0;this.receiveShadow=this.castShadow=!1;this.frustumCulled=!0;this._vector=new b.Vector3};b.Object3D.prototype={constructor:b.Object3D,translate:function(d,e){this.matrix.rotateAxis(e);this.position.addSelf(e.multiplyScalar(d))},translateX:function(c){this.translate(c,this._vector.set(1,0,0))},translateY:function(c){this.translate(c,this._vector.set(0,1,0))},translateZ:function(c){this.translate(c,this._vector.set(0,0,1))},lookAt:function(c){this.matrix.lookAt(c,this.position,this.up);this.rotationAutoUpdate&&this.rotation.setRotationFromMatrix(this.matrix)},add:function(d){if(this.children.indexOf(d)===-1){d.parent!==void 0&&d.parent.remove(d);d.parent=this;this.children.push(d);for(var e=this;e.parent!==void 0;){e=e.parent}e!==void 0&&e instanceof b.Scene&&e.addObject(d)}},remove:function(d){var e=this.children.indexOf(d);if(e!==-1){d.parent=void 0;this.children.splice(e,1);for(e=this;e.parent!==void 0;){e=e.parent}e!==void 0&&e instanceof b.Scene&&e.removeObject(d)}},getChildByName:function(f,j){var e,i,h;e=0;for(i=this.children.length;e<i;e++){h=this.children[e];if(h.name===f){return h}if(j&&(h=h.getChildByName(f,j),h!==void 0)){return h}}},updateMatrix:function(){this.matrix.setPosition(this.position);this.useQuaternion?this.matrix.setRotationFromQuaternion(this.quaternion):this.matrix.setRotationFromEuler(this.rotation,this.eulerOrder);if(this.scale.x!==1||this.scale.y!==1||this.scale.z!==1){this.matrix.scale(this.scale),this.boundRadiusScale=Math.max(this.scale.x,Math.max(this.scale.y,this.scale.z))}this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||e){this.parent?this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0}for(var f=0,d=this.children.length;f<d;f++){this.children[f].updateMatrixWorld(e)}}};b.Object3DCount=0;b.Projector=function(){function af(){var c=ab[aa]=ab[aa]||new b.RenderableObject;aa++;return c}function ad(){var c=V[X]=V[X]||new b.RenderableVertex;X++;return c}function ae(d,c){return c.z-d.z}function ac(k,i){var q=0,p=1,m=k.z+k.w,n=i.z+i.w,o=-k.z+k.w,l=-i.z+i.w;return m>=0&&n>=0&&o>=0&&l>=0?!0:m<0&&n<0||o<0&&l<0?!1:(m<0?q=Math.max(q,m/(m-n)):n<0&&(p=Math.min(p,m/(m-n))),o<0?q=Math.max(q,o/(o-l)):l<0&&(p=Math.min(p,o/(o-l))),p<q?!1:(k.lerpSelf(i,q),i.lerpSelf(k,1-p),!0))}var Z,aa,ab=[],Y,X,V=[],W,S,R=[],U,N=[],T,P,L=[],D,I,O=[],H={objects:[],sprites:[],lights:[],elements:[]},Q=new b.Vector3,C=new b.Vector4,z=new b.Matrix4,G=new b.Matrix4,j=[new b.Vector4,new b.Vector4,new b.Vector4,new b.Vector4,new b.Vector4,new b.Vector4],M=new b.Vector4,K=new b.Vector4;this.computeFrustum=function(d){j[0].set(d.n41-d.n11,d.n42-d.n12,d.n43-d.n13,d.n44-d.n14);j[1].set(d.n41+d.n11,d.n42+d.n12,d.n43+d.n13,d.n44+d.n14);j[2].set(d.n41+d.n21,d.n42+d.n22,d.n43+d.n23,d.n44+d.n24);j[3].set(d.n41-d.n21,d.n42-d.n22,d.n43-d.n23,d.n44-d.n24);j[4].set(d.n41-d.n31,d.n42-d.n32,d.n43-d.n33,d.n44-d.n34);j[5].set(d.n41+d.n31,d.n42+d.n32,d.n43+d.n33,d.n44+d.n34);for(d=0;d<6;d++){var c=j[d];c.divideScalar(Math.sqrt(c.x*c.x+c.y*c.y+c.z*c.z))}};this.projectVector=function(d,c){c.matrixWorldInverse.getInverse(c.matrixWorld);z.multiply(c.projectionMatrix,c.matrixWorldInverse);z.multiplyVector3(d);return d};this.unprojectVector=function(d,c){c.projectionMatrixInverse.getInverse(c.projectionMatrix);z.multiply(c.matrixWorld,c.projectionMatrixInverse);z.multiplyVector3(d);return d};this.pickingRay=function(e,d){var f;e.z=-1;f=new b.Vector3(e.x,e.y,1);this.unprojectVector(e,d);this.unprojectVector(f,d);f.subSelf(e).normalize();return new b.Ray(e,f)};this.projectGraph=function(h,g){aa=0;H.objects.length=0;H.sprites.length=0;H.lights.length=0;var f=function(e){if(e.visible!==!1){var m;if(m=e instanceof b.Mesh||e instanceof b.Line){if(!(m=e.frustumCulled===!1)){af:{for(var l=e.matrixWorld,k=-e.geometry.boundingSphere.radius*Math.max(e.scale.x,Math.max(e.scale.y,e.scale.z)),i=0;i<6;i++){if(m=j[i].x*l.n14+j[i].y*l.n24+j[i].z*l.n34+j[i].w,m<=k){m=!1;break af}}m=!0}}}m?(z.multiplyVector3(Q.copy(e.position)),Z=af(),Z.object=e,Z.z=Q.z,H.objects.push(Z)):e instanceof b.Sprite||e instanceof b.Particle?(z.multiplyVector3(Q.copy(e.position)),Z=af(),Z.object=e,Z.z=Q.z,H.sprites.push(Z)):e instanceof b.Light&&H.lights.push(e);m=0;for(l=e.children.length;m<l;m++){f(e.children[m])}}};f(h);g&&H.objects.sort(ae);return H};this.projectScene=function(y,v,w){var x=v.near,n=v.far,r,p,q,o,m,k,l,d,t,c,h,B,E,i,u,s;I=P=U=S=0;H.elements.length=0;v.parent===void 0&&(console.warn("DEPRECATED: Camera hasn't been added to a Scene. Adding it..."),y.add(v));y.updateMatrixWorld();v.matrixWorldInverse.getInverse(v.matrixWorld);z.multiply(v.projectionMatrix,v.matrixWorldInverse);this.computeFrustum(z);H=this.projectGraph(y,!1);y=0;for(r=H.objects.length;y<r;y++){if(t=H.objects[y].object,c=t.matrixWorld,B=t.material,X=0,t instanceof b.Mesh){h=t.geometry;E=t.geometry.materials;o=h.vertices;i=h.faces;u=h.faceVertexUvs;h=t.matrixRotationWorld.extractRotation(c);p=0;for(q=o.length;p<q;p++){Y=ad(),Y.positionWorld.copy(o[p].position),c.multiplyVector3(Y.positionWorld),Y.positionScreen.copy(Y.positionWorld),z.multiplyVector4(Y.positionScreen),Y.positionScreen.x/=Y.positionScreen.w,Y.positionScreen.y/=Y.positionScreen.w,Y.visible=Y.positionScreen.z>x&&Y.positionScreen.z<n}o=0;for(p=i.length;o<p;o++){q=i[o];if(q instanceof b.Face3){if(m=V[q.a],k=V[q.b],l=V[q.c],m.visible&&k.visible&&l.visible&&(t.doubleSided||t.flipSided!=(l.positionScreen.x-m.positionScreen.x)*(k.positionScreen.y-m.positionScreen.y)-(l.positionScreen.y-m.positionScreen.y)*(k.positionScreen.x-m.positionScreen.x)<0)){d=R[S]=R[S]||new b.RenderableFace3,S++,W=d,W.v1.copy(m),W.v2.copy(k),W.v3.copy(l)}else{continue}}else{if(q instanceof b.Face4){if(m=V[q.a],k=V[q.b],l=V[q.c],d=V[q.d],m.visible&&k.visible&&l.visible&&d.visible&&(t.doubleSided||t.flipSided!=((d.positionScreen.x-m.positionScreen.x)*(k.positionScreen.y-m.positionScreen.y)-(d.positionScreen.y-m.positionScreen.y)*(k.positionScreen.x-m.positionScreen.x)<0||(k.positionScreen.x-l.positionScreen.x)*(d.positionScreen.y-l.positionScreen.y)-(k.positionScreen.y-l.positionScreen.y)*(d.positionScreen.x-l.positionScreen.x)<0))){s=N[U]=N[U]||new b.RenderableFace4,U++,W=s,W.v1.copy(m),W.v2.copy(k),W.v3.copy(l),W.v4.copy(d)}else{continue}}}W.normalWorld.copy(q.normal);h.multiplyVector3(W.normalWorld);W.centroidWorld.copy(q.centroid);c.multiplyVector3(W.centroidWorld);W.centroidScreen.copy(W.centroidWorld);z.multiplyVector3(W.centroidScreen);l=q.vertexNormals;m=0;for(k=l.length;m<k;m++){d=W.vertexNormalsWorld[m],d.copy(l[m]),h.multiplyVector3(d)}m=0;for(k=u.length;m<k;m++){if(s=u[m][o]){l=0;for(d=s.length;l<d;l++){W.uvs[m][l]=s[l]}}}W.material=B;W.faceMaterial=q.materialIndex!==null?E[q.materialIndex]:null;W.z=W.centroidScreen.z;H.elements.push(W)}}else{if(t instanceof b.Line){G.multiply(z,c);o=t.geometry.vertices;m=ad();m.positionScreen.copy(o[0].position);G.multiplyVector4(m.positionScreen);p=1;for(q=o.length;p<q;p++){if(m=ad(),m.positionScreen.copy(o[p].position),G.multiplyVector4(m.positionScreen),k=V[X-2],M.copy(m.positionScreen),K.copy(k.positionScreen),ac(M,K)){M.multiplyScalar(1/M.w),K.multiplyScalar(1/K.w),t=L[P]=L[P]||new b.RenderableLine,P++,T=t,T.v1.positionScreen.copy(M),T.v2.positionScreen.copy(K),T.z=Math.max(M.z,K.z),T.material=B,H.elements.push(T)}}}}}y=0;for(r=H.sprites.length;y<r;y++){if(t=H.sprites[y].object,c=t.matrixWorld,t instanceof b.Particle&&(C.set(c.n14,c.n24,c.n34,1),z.multiplyVector4(C),C.z/=C.w,C.z>0&&C.z<1)){x=O[I]=O[I]||new b.RenderableParticle,I++,D=x,D.x=C.x/C.w,D.y=C.y/C.w,D.z=C.z,D.rotation=t.rotation.z,D.scale.x=t.scale.x*Math.abs(D.x-(C.x+v.projectionMatrix.n11)/(C.w+v.projectionMatrix.n14)),D.scale.y=t.scale.y*Math.abs(D.y-(C.y+v.projectionMatrix.n22)/(C.w+v.projectionMatrix.n24)),D.material=t.material,H.elements.push(D)}}w&&H.elements.sort(ae);return H}};b.Quaternion=function(f,h,e,g){this.set(f||0,h||0,e||0,g!==void 0?g:1)};b.Quaternion.prototype={constructor:b.Quaternion,set:function(f,h,e,g){this.x=f;this.y=h;this.z=e;this.w=g;return this},copy:function(c){this.x=c.x;this.y=c.y;this.z=c.z;this.w=c.w;return this},setFromEuler:function(j){var p=Math.PI/360,i=j.x*p,o=j.y*p,l=j.z*p,j=Math.cos(o),o=Math.sin(o),p=Math.cos(-l),l=Math.sin(-l),m=Math.cos(i),i=Math.sin(i),n=j*p,k=o*l;this.w=n*m-k*i;this.x=n*i+k*m;this.y=o*p*m+j*l*i;this.z=j*l*m-o*p*i;return this},setFromAxisAngle:function(f,h){var e=h/2,g=Math.sin(e);this.x=f.x*g;this.y=f.y*g;this.z=f.z*g;this.w=Math.cos(e);return this},setFromRotationMatrix:function(d){var e=Math.pow(d.determinant(),1/3);this.w=Math.sqrt(Math.max(0,e+d.n11+d.n22+d.n33))/2;this.x=Math.sqrt(Math.max(0,e+d.n11-d.n22-d.n33))/2;this.y=Math.sqrt(Math.max(0,e-d.n11+d.n22-d.n33))/2;this.z=Math.sqrt(Math.max(0,e-d.n11-d.n22+d.n33))/2;this.x=d.n32-d.n23<0?-Math.abs(this.x):Math.abs(this.x);this.y=d.n13-d.n31<0?-Math.abs(this.y):Math.abs(this.y);this.z=d.n21-d.n12<0?-Math.abs(this.z):Math.abs(this.z);this.normalize();return this},calculateW:function(){this.w=-Math.sqrt(Math.abs(1-this.x*this.x-this.y*this.y-this.z*this.z));return this},inverse:function(){this.x*=-1;this.y*=-1;this.z*=-1;return this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var c=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);c===0?this.w=this.z=this.y=this.x=0:(c=1/c,this.x*=c,this.y*=c,this.z*=c,this.w*=c);return this},multiplySelf:function(j){var p=this.x,i=this.y,o=this.z,l=this.w,m=j.x,n=j.y,k=j.z,j=j.w;this.x=p*j+l*m+i*k-o*n;this.y=i*j+l*n+o*m-p*k;this.z=o*j+l*k+p*n-i*m;this.w=l*j-p*m-i*n-o*k;return this},multiply:function(d,e){this.x=d.x*e.w+d.y*e.z-d.z*e.y+d.w*e.x;this.y=-d.x*e.z+d.y*e.w+d.z*e.x+d.w*e.y;this.z=d.x*e.y-d.y*e.x+d.z*e.w+d.w*e.z;this.w=-d.x*e.x-d.y*e.y-d.z*e.z+d.w*e.w;return this},multiplyVector3:function(x,v){v||(v=x);var w=x.x,u=x.y,r=x.z,s=this.x,t=this.y,q=this.z,p=this.w,m=p*w+t*r-q*u,n=p*u+q*w-s*r,j=p*r+s*u-t*w,w=-s*w-t*u-q*r;v.x=m*p+w*-s+n*-q-j*-t;v.y=n*p+w*-t+j*-s-m*-q;v.z=j*p+w*-q+m*-t-n*-s;return v}};b.Quaternion.slerp=function(h,l,e,k){var i=h.w*l.w+h.x*l.x+h.y*l.y+h.z*l.z;i<0?(e.w=-l.w,e.x=-l.x,e.y=-l.y,e.z=-l.z,i=-i):e.copy(l);if(Math.abs(i)>=1){return e.w=h.w,e.x=h.x,e.y=h.y,e.z=h.z,e}var j=Math.acos(i),i=Math.sqrt(1-i*i);if(Math.abs(i)<0.001){return e.w=0.5*(h.w+l.w),e.x=0.5*(h.x+l.x),e.y=0.5*(h.y+l.y),e.z=0.5*(h.z+l.z),e}l=Math.sin((1-k)*j)/i;k=Math.sin(k*j)/i;e.w=h.w*l+e.w*k;e.x=h.x*l+e.x*k;e.y=h.y*l+e.y*k;e.z=h.z*l+e.z*k;return e};b.Vertex=function(c){this.position=c||new b.Vector3};b.Face3=function(h,l,e,k,i,j){this.a=h;this.b=l;this.c=e;this.normal=k instanceof b.Vector3?k:new b.Vector3;this.vertexNormals=k instanceof Array?k:[];this.color=i instanceof b.Color?i:new b.Color;this.vertexColors=i instanceof Array?i:[];this.vertexTangents=[];this.materialIndex=j;this.centroid=new b.Vector3};b.Face4=function(i,n,h,m,j,k,l){this.a=i;this.b=n;this.c=h;this.d=m;this.normal=j instanceof b.Vector3?j:new b.Vector3;this.vertexNormals=j instanceof Array?j:[];this.color=k instanceof b.Color?k:new b.Color;this.vertexColors=k instanceof Array?k:[];this.vertexTangents=[];this.materialIndex=l;this.centroid=new b.Vector3};b.UV=function(d,e){this.u=d||0;this.v=e||0};b.UV.prototype={constructor:b.UV,set:function(d,e){this.u=d;this.v=e;return this},copy:function(c){this.u=c.u;this.v=c.v;return this},clone:function(){return new b.UV(this.u,this.v)}};b.Geometry=function(){this.id=b.GeometryCount++;this.vertices=[];this.colors=[];this.materials=[];this.faces=[];this.faceUvs=[[]];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphColors=[];this.skinWeights=[];this.skinIndices=[];this.boundingSphere=this.boundingBox=null;this.dynamic=this.hasTangents=!1};b.Geometry.prototype={constructor:b.Geometry,applyMatrix:function(i){var n=new b.Matrix4;n.extractRotation(i,new b.Vector3(1,1,1));for(var h=0,m=this.vertices.length;h<m;h++){i.multiplyVector3(this.vertices[h].position)}h=0;for(m=this.faces.length;h<m;h++){var j=this.faces[h];n.multiplyVector3(j.normal);for(var k=0,l=j.vertexNormals.length;k<l;k++){n.multiplyVector3(j.vertexNormals[k])}i.multiplyVector3(j.centroid)}},computeCentroids:function(){var e,f,d;e=0;for(f=this.faces.length;e<f;e++){d=this.faces[e],d.centroid.set(0,0,0),d instanceof b.Face3?(d.centroid.addSelf(this.vertices[d.a].position),d.centroid.addSelf(this.vertices[d.b].position),d.centroid.addSelf(this.vertices[d.c].position),d.centroid.divideScalar(3)):d instanceof b.Face4&&(d.centroid.addSelf(this.vertices[d.a].position),d.centroid.addSelf(this.vertices[d.b].position),d.centroid.addSelf(this.vertices[d.c].position),d.centroid.addSelf(this.vertices[d.d].position),d.centroid.divideScalar(4))}},computeFaceNormals:function(){var j,p,i,o,l,m,n=new b.Vector3,k=new b.Vector3;j=0;for(p=this.faces.length;j<p;j++){i=this.faces[j],o=this.vertices[i.a],l=this.vertices[i.b],m=this.vertices[i.c],n.sub(m.position,l.position),k.sub(o.position,l.position),n.crossSelf(k),n.isZero()||n.normalize(),i.normal.copy(n)}},computeVertexNormals:function(){var f,h,e,g;if(this.__tmpVertices===void 0){g=this.__tmpVertices=Array(this.vertices.length);f=0;for(h=this.vertices.length;f<h;f++){g[f]=new b.Vector3}f=0;for(h=this.faces.length;f<h;f++){if(e=this.faces[f],e instanceof b.Face3){e.vertexNormals=[new b.Vector3,new b.Vector3,new b.Vector3]}else{if(e instanceof b.Face4){e.vertexNormals=[new b.Vector3,new b.Vector3,new b.Vector3,new b.Vector3]}}}}else{g=this.__tmpVertices;f=0;for(h=this.vertices.length;f<h;f++){g[f].set(0,0,0)}}f=0;for(h=this.faces.length;f<h;f++){e=this.faces[f],e instanceof b.Face3?(g[e.a].addSelf(e.normal),g[e.b].addSelf(e.normal),g[e.c].addSelf(e.normal)):e instanceof b.Face4&&(g[e.a].addSelf(e.normal),g[e.b].addSelf(e.normal),g[e.c].addSelf(e.normal),g[e.d].addSelf(e.normal))}f=0;for(h=this.vertices.length;f<h;f++){g[f].normalize()}f=0;for(h=this.faces.length;f<h;f++){e=this.faces[f],e instanceof b.Face3?(e.vertexNormals[0].copy(g[e.a]),e.vertexNormals[1].copy(g[e.b]),e.vertexNormals[2].copy(g[e.c])):e instanceof b.Face4&&(e.vertexNormals[0].copy(g[e.a]),e.vertexNormals[1].copy(g[e.b]),e.vertexNormals[2].copy(g[e.c]),e.vertexNormals[3].copy(g[e.d]))}},computeTangents:function(){function an(h,e,n,m,k,l,i){ag=h.vertices[e].position;af=h.vertices[n].position;ad=h.vertices[m].position;ae=aj[k];aa=aj[l];Z=aj[i];ac=af.x-ag.x;V=ad.x-ag.x;ab=af.y-ag.y;X=ad.y-ag.y;S=af.z-ag.z;L=ad.z-ag.z;O=aa.u-ae.u;W=Z.u-ae.u;N=aa.v-ae.v;Y=Z.v-ae.v;I=1/(O*Y-W*N);T.set((Y*ac-N*V)*I,(Y*ab-N*X)*I,(Y*S-N*L)*I);Q.set((O*V-W*ac)*I,(O*X-W*ab)*I,(O*L-W*S)*I);M[e].addSelf(T);M[n].addSelf(T);M[m].addSelf(T);G[e].addSelf(Q);G[n].addSelf(Q);G[m].addSelf(Q)}var al,am,ak,ah,ai,aj,ag,af,ad,ae,aa,Z,ac,V,ab,X,S,L,O,W,N,Y,I,H,M=[],G=[],T=new b.Vector3,Q=new b.Vector3,z=new b.Vector3,j=new b.Vector3,D=new b.Vector3;al=0;for(am=this.vertices.length;al<am;al++){M[al]=new b.Vector3,G[al]=new b.Vector3}al=0;for(am=this.faces.length;al<am;al++){ai=this.faces[al],aj=this.faceVertexUvs[0][al],ai instanceof b.Face3?an(this,ai.a,ai.b,ai.c,0,1,2):ai instanceof b.Face4&&(an(this,ai.a,ai.b,ai.c,0,1,2),an(this,ai.a,ai.b,ai.d,0,1,3))}var C=["a","b","c","d"];al=0;for(am=this.faces.length;al<am;al++){ai=this.faces[al];for(ak=0;ak<ai.vertexNormals.length;ak++){D.copy(ai.vertexNormals[ak]),ah=ai[C[ak]],H=M[ah],z.copy(H),z.subSelf(D.multiplyScalar(D.dot(H))).normalize(),j.cross(ai.vertexNormals[ak],H),ah=j.dot(G[ah]),ah=ah<0?-1:1,ai.vertexTangents[ak]=new b.Vector4(z.x,z.y,z.z,ah)}}this.hasTangents=!0},computeBoundingBox:function(){var e;if(this.vertices.length>0){this.boundingBox={x:[this.vertices[0].position.x,this.vertices[0].position.x],y:[this.vertices[0].position.y,this.vertices[0].position.y],z:[this.vertices[0].position.z,this.vertices[0].position.z]};for(var f=1,d=this.vertices.length;f<d;f++){e=this.vertices[f];if(e.position.x<this.boundingBox.x[0]){this.boundingBox.x[0]=e.position.x}else{if(e.position.x>this.boundingBox.x[1]){this.boundingBox.x[1]=e.position.x}}if(e.position.y<this.boundingBox.y[0]){this.boundingBox.y[0]=e.position.y}else{if(e.position.y>this.boundingBox.y[1]){this.boundingBox.y[1]=e.position.y}}if(e.position.z<this.boundingBox.z[0]){this.boundingBox.z[0]=e.position.z}else{if(e.position.z>this.boundingBox.z[1]){this.boundingBox.z[1]=e.position.z}}}}},computeBoundingSphere:function(){for(var e=0,f=0,d=this.vertices.length;f<d;f++){e=Math.max(e,this.vertices[f].position.length())}this.boundingSphere={radius:e}},mergeVertices:function(){var i={},n=[],h=[],m,j=Math.pow(10,4),k,l;k=0;for(l=this.vertices.length;k<l;k++){m=this.vertices[k].position,m=[Math.round(m.x*j),Math.round(m.y*j),Math.round(m.z*j)].join("_"),i[m]===void 0?(i[m]=k,n.push(this.vertices[k]),h[k]=n.length-1):h[k]=h[i[m]]}k=0;for(l=this.faces.length;k<l;k++){if(i=this.faces[k],i instanceof b.Face3){i.a=h[i.a],i.b=h[i.b],i.c=h[i.c]}else{if(i instanceof b.Face4){i.a=h[i.a],i.b=h[i.b],i.c=h[i.c],i.d=h[i.d]}}}this.vertices=n}};b.GeometryCount=0;b.Spline=function(z){function x(i,h,A,p,k,l,o){i=(A-i)*0.5;p=(p-h)*0.5;return(2*(h-A)+i+p)*o+(-3*(h-A)-2*i-p)*l+i*k+h}this.points=z;var y=[],w={x:0,y:0,z:0},t,u,v,s,r,n,q,m,j;this.initFromArray=function(d){this.points=[];for(var c=0;c<d.length;c++){this.points[c]={x:d[c][0],y:d[c][1],z:d[c][2]}}};this.getPoint=function(c){t=(this.points.length-1)*c;u=Math.floor(t);v=t-u;y[0]=u===0?u:u-1;y[1]=u;y[2]=u>this.points.length-2?u:u+1;y[3]=u>this.points.length-3?u:u+2;n=this.points[y[0]];q=this.points[y[1]];m=this.points[y[2]];j=this.points[y[3]];s=v*v;r=v*s;w.x=x(n.x,q.x,m.x,j.x,v,s,r);w.y=x(n.y,q.y,m.y,j.y,v,s,r);w.z=x(n.z,q.z,m.z,j.z,v,s,r);return w};this.getControlPointsArray=function(){var f,e,h=this.points.length,g=[];for(f=0;f<h;f++){e=this.points[f],g[f]=[e.x,e.y,e.z]}return g};this.getLength=function(E){var D,C,B,o=D=D=0,p=new b.Vector3,A=new b.Vector3,l=[],k=0;l[0]=0;E||(E=100);C=this.points.length*E;p.copy(this.points[0]);for(E=1;E<C;E++){D=E/C,B=this.getPoint(D),A.copy(B),k+=A.distanceTo(p),p.copy(B),D*=this.points.length-1,D=Math.floor(D),D!=o&&(l[D]=k,o=D)}l[l.length]=k;return{chunks:l,total:k}};this.reparametrizeByArcLength=function(G){var F,E,D,A,B,C,p=[],o=new b.Vector3,l=this.getLength();p.push(o.copy(this.points[0]).clone());for(F=1;F<this.points.length;F++){E=l.chunks[F]-l.chunks[F-1];C=Math.ceil(G*E/l.total);A=(F-1)/(this.points.length-1);B=F/(this.points.length-1);for(E=1;E<C-1;E++){D=A+E*(1/C)*(B-A),D=this.getPoint(D),p.push(o.copy(D).clone())}p.push(o.copy(this.points[F]).clone())}this.points=p}};b.Edge=function(f,h,e,g){this.vertices=[f,h];this.vertexIndices=[e,g];this.faces=[];this.faceIndices=[]};b.Camera=function(){if(arguments.length){return console.warn("DEPRECATED: Camera() is now PerspectiveCamera() or OrthographicCamera()."),new b.PerspectiveCamera(arguments[0],arguments[1],arguments[2],arguments[3])}b.Object3D.call(this);this.matrixWorldInverse=new b.Matrix4;this.projectionMatrix=new b.Matrix4;this.projectionMatrixInverse=new b.Matrix4};b.Camera.prototype=new b.Object3D;b.Camera.prototype.constructor=b.Camera;b.Camera.prototype.lookAt=function(c){this.matrix.lookAt(this.position,c,this.up);this.rotationAutoUpdate&&this.rotation.setRotationFromMatrix(this.matrix)};b.OrthographicCamera=function(h,l,e,k,i,j){b.Camera.call(this);this.left=h;this.right=l;this.top=e;this.bottom=k;this.near=i!==void 0?i:0.1;this.far=j!==void 0?j:2000;this.updateProjectionMatrix()};b.OrthographicCamera.prototype=new b.Camera;b.OrthographicCamera.prototype.constructor=b.OrthographicCamera;b.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix=b.Matrix4.makeOrtho(this.left,this.right,this.top,this.bottom,this.near,this.far)};b.PerspectiveCamera=function(f,h,e,g){b.Camera.call(this);this.fov=f!==void 0?f:50;this.aspect=h!==void 0?h:1;this.near=e!==void 0?e:0.1;this.far=g!==void 0?g:2000;this.updateProjectionMatrix()};b.PerspectiveCamera.prototype=new b.Camera;b.PerspectiveCamera.prototype.constructor=b.PerspectiveCamera;b.PerspectiveCamera.prototype.setLens=function(d,e){this.fov=2*Math.atan((e!==void 0?e:43.25)/(d*2));this.fov*=180/Math.PI;this.updateProjectionMatrix()};b.PerspectiveCamera.prototype.setViewOffset=function(h,l,e,k,i,j){this.fullWidth=h;this.fullHeight=l;this.x=e;this.y=k;this.width=i;this.height=j;this.updateProjectionMatrix()};b.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var f=this.fullWidth/this.fullHeight,h=Math.tan(this.fov*Math.PI/360)*this.near,e=-h,g=f*e,f=Math.abs(f*h-g),e=Math.abs(h-e);this.projectionMatrix=b.Matrix4.makeFrustum(g+this.x*f/this.fullWidth,g+(this.x+this.width)*f/this.fullWidth,h-(this.y+this.height)*e/this.fullHeight,h-this.y*e/this.fullHeight,this.near,this.far)}else{this.projectionMatrix=b.Matrix4.makePerspective(this.fov,this.aspect,this.near,this.far)}};b.Light=function(c){b.Object3D.call(this);this.color=new b.Color(c)};b.Light.prototype=new b.Object3D;b.Light.prototype.constructor=b.Light;b.Light.prototype.supr=b.Object3D.prototype;b.AmbientLight=function(c){b.Light.call(this,c)};b.AmbientLight.prototype=new b.Light;b.AmbientLight.prototype.constructor=b.AmbientLight;b.DirectionalLight=function(e,f,d){b.Light.call(this,e);this.position=new b.Vector3(0,1,0);this.intensity=f!==void 0?f:1;this.distance=d!==void 0?d:0};b.DirectionalLight.prototype=new b.Light;b.DirectionalLight.prototype.constructor=b.DirectionalLight;b.PointLight=function(e,f,d){b.Light.call(this,e);this.position=new b.Vector3(0,0,0);this.intensity=f!==void 0?f:1;this.distance=d!==void 0?d:0};b.PointLight.prototype=new b.Light;b.PointLight.prototype.constructor=b.PointLight;b.SpotLight=function(f,h,e,g){b.Light.call(this,f);this.position=new b.Vector3(0,1,0);this.target=new b.Object3D;this.intensity=h!==void 0?h:1;this.distance=e!==void 0?e:0;this.castShadow=g!==void 0?g:!1};b.SpotLight.prototype=new b.Light;b.SpotLight.prototype.constructor=b.SpotLight;b.Material=function(c){this.name="";this.id=b.MaterialCount++;c=c||{};this.opacity=c.opacity!==void 0?c.opacity:1;this.transparent=c.transparent!==void 0?c.transparent:!1;this.blending=c.blending!==void 0?c.blending:b.NormalBlending;this.depthTest=c.depthTest!==void 0?c.depthTest:!0;this.depthWrite=c.depthWrite!==void 0?c.depthWrite:!0;this.polygonOffset=c.polygonOffset!==void 0?c.polygonOffset:!1;this.polygonOffsetFactor=c.polygonOffsetFactor!==void 0?c.polygonOffsetFactor:0;this.polygonOffsetUnits=c.polygonOffsetUnits!==void 0?c.polygonOffsetUnits:0;this.alphaTest=c.alphaTest!==void 0?c.alphaTest:0;this.overdraw=c.overdraw!==void 0?c.overdraw:!1};b.MaterialCount=0;b.NoShading=0;b.FlatShading=1;b.SmoothShading=2;b.NoColors=0;b.FaceColors=1;b.VertexColors=2;b.NormalBlending=0;b.AdditiveBlending=1;b.SubtractiveBlending=2;b.MultiplyBlending=3;b.AdditiveAlphaBlending=4;b.LineBasicMaterial=function(c){b.Material.call(this,c);c=c||{};this.color=c.color!==void 0?new b.Color(c.color):new b.Color(16777215);this.linewidth=c.linewidth!==void 0?c.linewidth:1;this.linecap=c.linecap!==void 0?c.linecap:"round";this.linejoin=c.linejoin!==void 0?c.linejoin:"round";this.vertexColors=c.vertexColors?c.vertexColors:!1;this.fog=c.fog!==void 0?c.fog:!0};b.LineBasicMaterial.prototype=new b.Material;b.LineBasicMaterial.prototype.constructor=b.LineBasicMaterial;b.MeshBasicMaterial=function(c){b.Material.call(this,c);c=c||{};this.color=c.color!==void 0?new b.Color(c.color):new b.Color(16777215);this.map=c.map!==void 0?c.map:null;this.lightMap=c.lightMap!==void 0?c.lightMap:null;this.envMap=c.envMap!==void 0?c.envMap:null;this.combine=c.combine!==void 0?c.combine:b.MultiplyOperation;this.reflectivity=c.reflectivity!==void 0?c.reflectivity:1;this.refractionRatio=c.refractionRatio!==void 0?c.refractionRatio:0.98;this.fog=c.fog!==void 0?c.fog:!0;this.shading=c.shading!==void 0?c.shading:b.SmoothShading;this.wireframe=c.wireframe!==void 0?c.wireframe:!1;this.wireframeLinewidth=c.wireframeLinewidth!==void 0?c.wireframeLinewidth:1;this.wireframeLinecap=c.wireframeLinecap!==void 0?c.wireframeLinecap:"round";this.wireframeLinejoin=c.wireframeLinejoin!==void 0?c.wireframeLinejoin:"round";this.vertexColors=c.vertexColors!==void 0?c.vertexColors:!1;this.skinning=c.skinning!==void 0?c.skinning:!1;this.morphTargets=c.morphTargets!==void 0?c.morphTargets:!1};b.MeshBasicMaterial.prototype=new b.Material;b.MeshBasicMaterial.prototype.constructor=b.MeshBasicMaterial;b.MeshLambertMaterial=function(c){b.Material.call(this,c);c=c||{};this.color=c.color!==void 0?new b.Color(c.color):new b.Color(16777215);this.ambient=c.ambient!==void 0?new b.Color(c.ambient):new b.Color(328965);this.map=c.map!==void 0?c.map:null;this.lightMap=c.lightMap!==void 0?c.lightMap:null;this.envMap=c.envMap!==void 0?c.envMap:null;this.combine=c.combine!==void 0?c.combine:b.MultiplyOperation;this.reflectivity=c.reflectivity!==void 0?c.reflectivity:1;this.refractionRatio=c.refractionRatio!==void 0?c.refractionRatio:0.98;this.fog=c.fog!==void 0?c.fog:!0;this.shading=c.shading!==void 0?c.shading:b.SmoothShading;this.wireframe=c.wireframe!==void 0?c.wireframe:!1;this.wireframeLinewidth=c.wireframeLinewidth!==void 0?c.wireframeLinewidth:1;this.wireframeLinecap=c.wireframeLinecap!==void 0?c.wireframeLinecap:"round";this.wireframeLinejoin=c.wireframeLinejoin!==void 0?c.wireframeLinejoin:"round";this.vertexColors=c.vertexColors!==void 0?c.vertexColors:!1;this.skinning=c.skinning!==void 0?c.skinning:!1;this.morphTargets=c.morphTargets!==void 0?c.morphTargets:!1};b.MeshLambertMaterial.prototype=new b.Material;b.MeshLambertMaterial.prototype.constructor=b.MeshLambertMaterial;b.MeshPhongMaterial=function(c){b.Material.call(this,c);c=c||{};this.color=c.color!==void 0?new b.Color(c.color):new b.Color(16777215);this.ambient=c.ambient!==void 0?new b.Color(c.ambient):new b.Color(328965);this.specular=c.specular!==void 0?new b.Color(c.specular):new b.Color(1118481);this.shininess=c.shininess!==void 0?c.shininess:30;this.metal=c.metal!==void 0?c.metal:!1;this.perPixel=c.perPixel!==void 0?c.perPixel:!1;this.map=c.map!==void 0?c.map:null;this.lightMap=c.lightMap!==void 0?c.lightMap:null;this.envMap=c.envMap!==void 0?c.envMap:null;this.combine=c.combine!==void 0?c.combine:b.MultiplyOperation;this.reflectivity=c.reflectivity!==void 0?c.reflectivity:1;this.refractionRatio=c.refractionRatio!==void 0?c.refractionRatio:0.98;this.fog=c.fog!==void 0?c.fog:!0;this.shading=c.shading!==void 0?c.shading:b.SmoothShading;this.wireframe=c.wireframe!==void 0?c.wireframe:!1;this.wireframeLinewidth=c.wireframeLinewidth!==void 0?c.wireframeLinewidth:1;this.wireframeLinecap=c.wireframeLinecap!==void 0?c.wireframeLinecap:"round";this.wireframeLinejoin=c.wireframeLinejoin!==void 0?c.wireframeLinejoin:"round";this.vertexColors=c.vertexColors!==void 0?c.vertexColors:!1;this.skinning=c.skinning!==void 0?c.skinning:!1;this.morphTargets=c.morphTargets!==void 0?c.morphTargets:!1};b.MeshPhongMaterial.prototype=new b.Material;b.MeshPhongMaterial.prototype.constructor=b.MeshPhongMaterial;b.MeshDepthMaterial=function(c){b.Material.call(this,c);c=c||{};this.shading=c.shading!==void 0?c.shading:b.SmoothShading;this.wireframe=c.wireframe!==void 0?c.wireframe:!1;this.wireframeLinewidth=c.wireframeLinewidth!==void 0?c.wireframeLinewidth:1};b.MeshDepthMaterial.prototype=new b.Material;b.MeshDepthMaterial.prototype.constructor=b.MeshDepthMaterial;b.MeshNormalMaterial=function(c){b.Material.call(this,c);c=c||{};this.shading=c.shading?c.shading:b.FlatShading;this.wireframe=c.wireframe?c.wireframe:!1;this.wireframeLinewidth=c.wireframeLinewidth?c.wireframeLinewidth:1};b.MeshNormalMaterial.prototype=new b.Material;b.MeshNormalMaterial.prototype.constructor=b.MeshNormalMaterial;b.MeshFaceMaterial=function(){};b.MeshShaderMaterial=function(c){console.warn("DEPRECATED: MeshShaderMaterial() is now ShaderMaterial().");return new b.ShaderMaterial(c)};b.ParticleBasicMaterial=function(c){b.Material.call(this,c);c=c||{};this.color=c.color!==void 0?new b.Color(c.color):new b.Color(16777215);this.map=c.map!==void 0?c.map:null;this.size=c.size!==void 0?c.size:1;this.sizeAttenuation=c.sizeAttenuation!==void 0?c.sizeAttenuation:!0;this.vertexColors=c.vertexColors!==void 0?c.vertexColors:!1;this.fog=c.fog!==void 0?c.fog:!0};b.ParticleBasicMaterial.prototype=new b.Material;b.ParticleBasicMaterial.prototype.constructor=b.ParticleBasicMaterial;b.ParticleCanvasMaterial=function(c){b.Material.call(this,c);c=c||{};this.color=c.color!==void 0?new b.Color(c.color):new b.Color(16777215);this.program=c.program!==void 0?c.program:function(){}};b.ParticleCanvasMaterial.prototype=new b.Material;b.ParticleCanvasMaterial.prototype.constructor=b.ParticleCanvasMaterial;b.ParticleDOMMaterial=function(c){b.Material.call(this);this.domElement=c};b.ShaderMaterial=function(c){b.Material.call(this,c);c=c||{};this.fragmentShader=c.fragmentShader!==void 0?c.fragmentShader:"void main() {}";this.vertexShader=c.vertexShader!==void 0?c.vertexShader:"void main() {}";this.uniforms=c.uniforms!==void 0?c.uniforms:{};this.attributes=c.attributes;this.shading=c.shading!==void 0?c.shading:b.SmoothShading;this.wireframe=c.wireframe!==void 0?c.wireframe:!1;this.wireframeLinewidth=c.wireframeLinewidth!==void 0?c.wireframeLinewidth:1;this.fog=c.fog!==void 0?c.fog:!1;this.lights=c.lights!==void 0?c.lights:!1;this.vertexColors=c.vertexColors!==void 0?c.vertexColors:!1;this.skinning=c.skinning!==void 0?c.skinning:!1;this.morphTargets=c.morphTargets!==void 0?c.morphTargets:!1};b.ShaderMaterial.prototype=new b.Material;b.ShaderMaterial.prototype.constructor=b.ShaderMaterial;b.Texture=function(h,l,e,k,i,j){this.id=b.TextureCount++;this.image=h;this.mapping=l!==void 0?l:new b.UVMapping;this.wrapS=e!==void 0?e:b.ClampToEdgeWrapping;this.wrapT=k!==void 0?k:b.ClampToEdgeWrapping;this.magFilter=i!==void 0?i:b.LinearFilter;this.minFilter=j!==void 0?j:b.LinearMipMapLinearFilter;this.offset=new b.Vector2(0,0);this.repeat=new b.Vector2(1,1);this.needsUpdate=!1;this.onUpdate=null};b.Texture.prototype={constructor:b.Texture,clone:function(){var c=new b.Texture(this.image,this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter);c.offset.copy(this.offset);c.repeat.copy(this.repeat);return c}};b.TextureCount=0;b.MultiplyOperation=0;b.MixOperation=1;b.CubeReflectionMapping=function(){};b.CubeRefractionMapping=function(){};b.LatitudeReflectionMapping=function(){};b.LatitudeRefractionMapping=function(){};b.SphericalReflectionMapping=function(){};b.SphericalRefractionMapping=function(){};b.UVMapping=function(){};b.RepeatWrapping=0;b.ClampToEdgeWrapping=1;b.MirroredRepeatWrapping=2;b.NearestFilter=3;b.NearestMipMapNearestFilter=4;b.NearestMipMapLinearFilter=5;b.LinearFilter=6;b.LinearMipMapNearestFilter=7;b.LinearMipMapLinearFilter=8;b.ByteType=9;b.UnsignedByteType=10;b.ShortType=11;b.UnsignedShortType=12;b.IntType=13;b.UnsignedIntType=14;b.FloatType=15;b.AlphaFormat=16;b.RGBFormat=17;b.RGBAFormat=18;b.LuminanceFormat=19;b.LuminanceAlphaFormat=20;b.DataTexture=function(r,p,q,o,l,m,n,k,j){b.Texture.call(this,null,l,m,n,k,j);this.image={data:r,width:p,height:q};this.format=o!==void 0?o:b.RGBAFormat};b.DataTexture.prototype=new b.Texture;b.DataTexture.prototype.constructor=b.DataTexture;b.DataTexture.prototype.clone=function(){var c=new b.DataTexture(this.data.slice(0),this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter);c.offset.copy(this.offset);c.repeat.copy(this.repeat);return c};b.Particle=function(c){b.Object3D.call(this);this.material=c};b.Particle.prototype=new b.Object3D;b.Particle.prototype.constructor=b.Particle;b.ParticleSystem=function(d,e){b.Object3D.call(this);this.geometry=d;this.material=e;this.sortParticles=!1};b.ParticleSystem.prototype=new b.Object3D;b.ParticleSystem.prototype.constructor=b.ParticleSystem;b.Line=function(e,f,d){b.Object3D.call(this);this.geometry=e;this.material=f;this.type=d!==void 0?d:b.LineStrip;this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere())};b.LineStrip=0;b.LinePieces=1;b.Line.prototype=new b.Object3D;b.Line.prototype.constructor=b.Line;b.Mesh=function(e,f){b.Object3D.call(this);this.geometry=e;this.material=f;if(f instanceof Array){console.warn("DEPRECATED: Mesh material can no longer be an Array. Using material at index 0..."),this.material=f[0]}if(this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere(),this.boundRadius=e.boundingSphere.radius,this.geometry.morphTargets.length)){this.morphTargetBase=-1;this.morphTargetForcedOrder=[];this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var d=0;d<this.geometry.morphTargets.length;d++){this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[d].name]=d}}};b.Mesh.prototype=new b.Object3D;b.Mesh.prototype.constructor=b.Mesh;b.Mesh.prototype.supr=b.Object3D.prototype;b.Mesh.prototype.getMorphTargetIndexByName=function(c){if(this.morphTargetDictionary[c]!==void 0){return this.morphTargetDictionary[c]}console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+c+" does not exist. Returning 0.");return 0};b.Bone=function(c){b.Object3D.call(this);this.skin=c;this.skinMatrix=new b.Matrix4};b.Bone.prototype=new b.Object3D;b.Bone.prototype.constructor=b.Bone;b.Bone.prototype.supr=b.Object3D.prototype;b.Bone.prototype.update=function(f,h){this.matrixAutoUpdate&&(h|=this.updateMatrix());if(h||this.matrixWorldNeedsUpdate){f?this.skinMatrix.multiply(f,this.matrix):this.skinMatrix.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,h=!0}var e,g=this.children.length;for(e=0;e<g;e++){this.children[e].update(this.skinMatrix,h)}};b.SkinnedMesh=function(j,p){b.Mesh.call(this,j,p);this.identityMatrix=new b.Matrix4;this.bones=[];this.boneMatrices=[];var i,o,l,m,n,k;if(this.geometry.bones!==void 0){for(i=0;i<this.geometry.bones.length;i++){l=this.geometry.bones[i],m=l.pos,n=l.rotq,k=l.scl,o=this.addBone(),o.name=l.name,o.position.set(m[0],m[1],m[2]),o.quaternion.set(n[0],n[1],n[2],n[3]),o.useQuaternion=!0,k!==void 0?o.scale.set(k[0],k[1],k[2]):o.scale.set(1,1,1)}for(i=0;i<this.bones.length;i++){l=this.geometry.bones[i],o=this.bones[i],l.parent===-1?this.add(o):this.bones[l.parent].add(o)}this.boneMatrices=new Float32Array(16*this.bones.length);this.pose()}};b.SkinnedMesh.prototype=new b.Mesh;b.SkinnedMesh.prototype.constructor=b.SkinnedMesh;b.SkinnedMesh.prototype.addBone=function(c){c===void 0&&(c=new b.Bone(this));this.bones.push(c);return c};b.SkinnedMesh.prototype.updateMatrixWorld=function(f){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||f){this.parent?this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1}for(var f=0,h=this.children.length;f<h;f++){var e=this.children[f];e instanceof b.Bone?e.update(this.identityMatrix,!1):e.updateMatrixWorld(!0)}for(var h=this.bones.length,e=this.bones,g=this.boneMatrices,f=0;f<h;f++){e[f].skinMatrix.flattenToArrayOffset(g,f*16)}};b.SkinnedMesh.prototype.pose=function(){this.updateMatrixWorld(!0);for(var h,l=[],e=0;e<this.bones.length;e++){h=this.bones[e];var k=new b.Matrix4;k.getInverse(h.skinMatrix);l.push(k);h.skinMatrix.flattenToArrayOffset(this.boneMatrices,e*16)}if(this.geometry.skinVerticesA===void 0){this.geometry.skinVerticesA=[];this.geometry.skinVerticesB=[];for(h=0;h<this.geometry.skinIndices.length;h++){var e=this.geometry.vertices[h].position,i=this.geometry.skinIndices[h].x,j=this.geometry.skinIndices[h].y,k=new b.Vector3(e.x,e.y,e.z);this.geometry.skinVerticesA.push(l[i].multiplyVector3(k));k=new b.Vector3(e.x,e.y,e.z);this.geometry.skinVerticesB.push(l[j].multiplyVector3(k));this.geometry.skinWeights[h].x+this.geometry.skinWeights[h].y!==1&&(e=(1-(this.geometry.skinWeights[h].x+this.geometry.skinWeights[h].y))*0.5,this.geometry.skinWeights[h].x+=e,this.geometry.skinWeights[h].y+=e)}}};b.MorphAnimMesh=function(d,e){b.Mesh.call(this,d,e);this.duration=1000;this.mirroredLoop=!1;this.currentKeyframe=this.lastKeyframe=this.time=0;this.direction=1;this.directionBackwards=!1};b.MorphAnimMesh.prototype=new b.Mesh;b.MorphAnimMesh.prototype.constructor=b.MorphAnimMesh;b.MorphAnimMesh.prototype.updateAnimation=function(d){var e=this.duration/(this.geometry.morphTargets.length-1);this.time+=this.direction*d;if(this.mirroredLoop){if(this.time>this.duration||this.time<0){this.direction*=-1;if(this.time>this.duration){this.time=this.duration,this.directionBackwards=!0}if(this.time<0){this.time=0,this.directionBackwards=!1}}}else{this.time%=this.duration}d=b.Math.clamp(Math.floor(this.time/e),0,this.geometry.morphTargets.length-1);if(d!=this.currentKeyframe){this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[d]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=d}e=this.time%e/e;this.directionBackwards&&(e=1-e);this.morphTargetInfluences[this.currentKeyframe]=e;this.morphTargetInfluences[this.lastKeyframe]=1-e};b.Ribbon=function(d,e){b.Object3D.call(this);this.geometry=d;this.material=e};b.Ribbon.prototype=new b.Object3D;b.Ribbon.prototype.constructor=b.Ribbon;b.LOD=function(){b.Object3D.call(this);this.LODs=[]};b.LOD.prototype=new b.Object3D;b.LOD.prototype.constructor=b.LOD;b.LOD.prototype.supr=b.Object3D.prototype;b.LOD.prototype.addLevel=function(e,f){f===void 0&&(f=0);for(var f=Math.abs(f),d=0;d<this.LODs.length;d++){if(f<this.LODs[d].visibleAtDistance){break}}this.LODs.splice(d,0,{visibleAtDistance:f,object3D:e});this.add(e)};b.LOD.prototype.update=function(d){if(this.LODs.length>1){d.matrixWorldInverse.getInverse(d.matrixWorld);d=d.matrixWorldInverse;d=-(d.n31*this.position.x+d.n32*this.position.y+d.n33*this.position.z+d.n34);this.LODs[0].object3D.visible=!0;for(var e=1;e<this.LODs.length;e++){if(d>=this.LODs[e].visibleAtDistance){this.LODs[e-1].object3D.visible=!1,this.LODs[e].object3D.visible=!0}else{break}}for(;e<this.LODs.length;e++){this.LODs[e].object3D.visible=!1}}};b.Sprite=function(c){b.Object3D.call(this);this.color=c.color!==void 0?new b.Color(c.color):new b.Color(16777215);this.map=c.map instanceof b.Texture?c.map:b.ImageUtils.loadTexture(c.map);this.blending=c.blending!==void 0?c.blending:b.NormalBlending;this.useScreenCoordinates=c.useScreenCoordinates!==void 0?c.useScreenCoordinates:!0;this.mergeWith3D=c.mergeWith3D!==void 0?c.mergeWith3D:!this.useScreenCoordinates;this.affectedByDistance=c.affectedByDistance!==void 0?c.affectedByDistance:!this.useScreenCoordinates;this.scaleByViewport=c.scaleByViewport!==void 0?c.scaleByViewport:!this.affectedByDistance;this.alignment=c.alignment instanceof b.Vector2?c.alignment:b.SpriteAlignment.center;this.rotation3d=this.rotation;this.rotation=0;this.opacity=1;this.uvOffset=new b.Vector2(0,0);this.uvScale=new b.Vector2(1,1)};b.Sprite.prototype=new b.Object3D;b.Sprite.prototype.constructor=b.Sprite;b.Sprite.prototype.updateMatrix=function(){this.matrix.setPosition(this.position);this.rotation3d.set(0,0,this.rotation);this.matrix.setRotationFromEuler(this.rotation3d);if(this.scale.x!==1||this.scale.y!==1){this.matrix.scale(this.scale),this.boundRadiusScale=Math.max(this.scale.x,this.scale.y)}this.matrixWorldNeedsUpdate=!0};b.SpriteAlignment={};b.SpriteAlignment.topLeft=new b.Vector2(1,-1);b.SpriteAlignment.topCenter=new b.Vector2(0,-1);b.SpriteAlignment.topRight=new b.Vector2(-1,-1);b.SpriteAlignment.centerLeft=new b.Vector2(1,0);b.SpriteAlignment.center=new b.Vector2(0,0);b.SpriteAlignment.centerRight=new b.Vector2(-1,0);b.SpriteAlignment.bottomLeft=new b.Vector2(1,1);b.SpriteAlignment.bottomCenter=new b.Vector2(0,1);b.SpriteAlignment.bottomRight=new b.Vector2(-1,1);b.Scene=function(){b.Object3D.call(this);this.overrideMaterial=this.fog=null;this.matrixAutoUpdate=!1;this.objects=[];this.lights=[];this.__objectsAdded=[];this.__objectsRemoved=[]};b.Scene.prototype=new b.Object3D;b.Scene.prototype.constructor=b.Scene;b.Scene.prototype.addObject=function(d){if(d instanceof b.Light){this.lights.indexOf(d)===-1&&this.lights.push(d)}else{if(!(d instanceof b.Camera||d instanceof b.Bone)&&this.objects.indexOf(d)===-1){this.objects.push(d);this.__objectsAdded.push(d);var e=this.__objectsRemoved.indexOf(d);e!==-1&&this.__objectsRemoved.splice(e,1)}}for(e=0;e<d.children.length;e++){this.addObject(d.children[e])}};b.Scene.prototype.removeObject=function(d){if(d instanceof b.Light){var e=this.lights.indexOf(d);e!==-1&&this.lights.splice(e,1)}else{d instanceof b.Camera||(e=this.objects.indexOf(d),e!==-1&&(this.objects.splice(e,1),this.__objectsRemoved.push(d),e=this.__objectsAdded.indexOf(d),e!==-1&&this.__objectsAdded.splice(e,1)))}for(e=0;e<d.children.length;e++){this.removeObject(d.children[e])}};b.Fog=function(e,f,d){this.color=new b.Color(e);this.near=f!==void 0?f:1;this.far=d!==void 0?d:1000};b.FogExp2=function(d,e){this.color=new b.Color(d);this.density=e!==void 0?e:0.00025};b.DOMRenderer=function(){b.Renderer.call(this);var h=null,l=new b.Projector,e,k,i,j;this.domElement=document.createElement("div");this.setSize=function(d,f){e=d;k=f;i=e/2;j=k/2};this.render=function(x,w){var v,t,u,g,f,s,c,q;h=l.projectScene(x,w);v=0;for(t=h.length;v<t;v++){if(f=h[v],f instanceof b.RenderableParticle){c=f.x*i+i;q=f.y*j+j;u=0;for(g=f.material.length;u<g;u++){if(s=f.material[u],s instanceof b.ParticleDOMMaterial){s=s.domElement,s.style.left=c+"px",s.style.top=q+"px"}}}}}};b.CanvasRenderer=function(aH){function aF(c){if(ah!=c){aq.globalAlpha=ah=c}}function aG(c){if(aj!=c){switch(c){case b.NormalBlending:aq.globalCompositeOperation="source-over";break;case b.AdditiveBlending:aq.globalCompositeOperation="lighter";break;case b.SubtractiveBlending:aq.globalCompositeOperation="darker"}aj=c}}function aD(c){if(a8!=c){aq.strokeStyle=a8=c}}function aA(c){if(a5!=c){aq.fillStyle=a5=c}}var aB=this,aC,ay,ax,au=new b.Projector,aH=aH||{},av=aH.canvas!==void 0?aH.canvas:document.createElement("canvas"),ap,ao,at,am,aq=av.getContext("2d"),an=new b.Color(0),ak=0,ah=1,aj=0,a8=null,a5=null,a9=null,ag=null,af=null,ai,a0,al,a6,aR=new b.RenderableVertex,aO=new b.RenderableVertex,aZ,aT,aV,bd,a3,a4,a2,aX,aQ,aU,aM,aw,aL=new b.Color,aN=new b.Color,ac=new b.Color,be=new b.Color,bh=new b.Color,aI=[],bl=[],D,a7,aE,ad,az,bc,bj,bf,aY,aJ,aS=new b.Rectangle,C=new b.Rectangle,a1=new b.Rectangle,aW=!1,ar=new b.Color,bk=new b.Color,bg=new b.Color,bi=new b.Vector3,aK,z,ae,bb,aP,ab,aH=16;aK=document.createElement("canvas");aK.width=aK.height=2;z=aK.getContext("2d");z.fillStyle="rgba(0,0,0,1)";z.fillRect(0,0,2,2);ae=z.getImageData(0,0,2,2);bb=ae.data;aP=document.createElement("canvas");aP.width=aP.height=aH;ab=aP.getContext("2d");ab.translate(-aH/2,-aH/2);ab.scale(aH,aH);aH--;this.domElement=av;this.sortElements=this.sortObjects=this.autoClear=!0;this.info={render:{vertices:0,faces:0}};this.setSize=function(d,c){ap=d;ao=c;at=Math.floor(ap/2);am=Math.floor(ao/2);av.width=ap;av.height=ao;aS.set(-at,-am,at,am);C.set(-at,-am,at,am);ah=1;aj=0;af=ag=a9=a5=a8=null};this.setClearColor=function(d,c){an.copy(d);ak=c;C.set(-at,-am,at,am)};this.setClearColorHex=function(d,c){an.setHex(d);ak=c;C.set(-at,-am,at,am)};this.clear=function(){aq.setTransform(1,0,0,-1,at,am);C.isEmpty()||(C.minSelf(aS),C.inflate(2),ak<1&&aq.clearRect(Math.floor(C.getX()),Math.floor(C.getY()),Math.floor(C.getWidth()),Math.floor(C.getHeight())),ak>0&&(aG(b.NormalBlending),aF(1),aA("rgba("+Math.floor(an.r*255)+","+Math.floor(an.g*255)+","+Math.floor(an.b*255)+","+ak+")"),aq.fillRect(Math.floor(C.getX()),Math.floor(C.getY()),Math.floor(C.getWidth()),Math.floor(C.getHeight()))),C.empty())};this.render=function(J,A){function x(o){var k,t,q,p;ar.setRGB(0,0,0);bk.setRGB(0,0,0);bg.setRGB(0,0,0);k=0;for(t=o.length;k<t;k++){q=o[k],p=q.color,q instanceof b.AmbientLight?(ar.r+=p.r,ar.g+=p.g,ar.b+=p.b):q instanceof b.DirectionalLight?(bk.r+=p.r,bk.g+=p.g,bk.b+=p.b):q instanceof b.PointLight&&(bg.r+=p.r,bg.g+=p.g,bg.b+=p.b)}}function y(K,F,B,w){var q,t,u,k,p,o;q=0;for(t=K.length;q<t;q++){u=K[q],k=u.color,u instanceof b.DirectionalLight?(p=u.matrixWorld.getPosition(),o=B.dot(p),o<=0||(o*=u.intensity,w.r+=k.r*o,w.g+=k.g*o,w.b+=k.b*o)):u instanceof b.PointLight&&(p=u.matrixWorld.getPosition(),o=B.dot(bi.sub(p,F).normalize()),o<=0||(o*=u.distance==0?1:1-Math.min(F.distanceTo(p)/u.distance,1),o!=0&&(o*=u.intensity,w.r+=k.r*o,w.g+=k.g*o,w.b+=k.b*o)))}}function v(K,B,F){aF(F.opacity);aG(F.blending);var t,w,u,q,p,o;if(F instanceof b.ParticleBasicMaterial){if(F.map){q=F.map.image,p=q.width>>1,o=q.height>>1,F=B.scale.x*at,u=B.scale.y*am,t=F*p,w=u*o,a1.set(K.x-t,K.y-w,K.x+t,K.y+w),aS.intersects(a1)&&(aq.save(),aq.translate(K.x,K.y),aq.rotate(-B.rotation),aq.scale(F,-u),aq.translate(-p,-o),aq.drawImage(q,0,0),aq.restore())}}else{F instanceof b.ParticleCanvasMaterial&&(t=B.scale.x*at,w=B.scale.y*am,a1.set(K.x-t,K.y-w,K.x+t,K.y+w),aS.intersects(a1)&&(aD(F.color.getContextStyle()),aA(F.color.getContextStyle()),aq.save(),aq.translate(K.x,K.y),aq.rotate(-B.rotation),aq.scale(t,w),F.program(aq),aq.restore()))}}function n(k,o,p,q){aF(q.opacity);aG(q.blending);aq.beginPath();aq.moveTo(k.positionScreen.x,k.positionScreen.y);aq.lineTo(o.positionScreen.x,o.positionScreen.y);aq.closePath();if(q instanceof b.LineBasicMaterial){k=q.linewidth;if(a9!=k){aq.lineWidth=a9=k}k=q.linecap;if(ag!=k){aq.lineCap=ag=k}k=q.linejoin;if(af!=k){aq.lineJoin=af=k}aD(q.color.getContextStyle());aq.stroke();a1.inflate(q.linewidth*2)}}function i(o,w,t,u,p,q,k,B){aB.info.render.vertices+=3;aB.info.render.faces++;aF(B.opacity);aG(B.blending);aZ=o.positionScreen.x;aT=o.positionScreen.y;aV=w.positionScreen.x;bd=w.positionScreen.y;a3=t.positionScreen.x;a4=t.positionScreen.y;d(aZ,aT,aV,bd,a3,a4);if(B instanceof b.MeshBasicMaterial){if(B.map){B.map.mapping instanceof b.UVMapping&&(ad=k.uvs[0],j(aZ,aT,aV,bd,a3,a4,ad[u].u,ad[u].v,ad[p].u,ad[p].v,ad[q].u,ad[q].v,B.map))}else{if(B.envMap){if(B.envMap.mapping instanceof b.SphericalReflectionMapping){o=A.matrixWorldInverse,bi.copy(k.vertexNormalsWorld[u]),az=(bi.x*o.n11+bi.y*o.n12+bi.z*o.n13)*0.5+0.5,bc=-(bi.x*o.n21+bi.y*o.n22+bi.z*o.n23)*0.5+0.5,bi.copy(k.vertexNormalsWorld[p]),bj=(bi.x*o.n11+bi.y*o.n12+bi.z*o.n13)*0.5+0.5,bf=-(bi.x*o.n21+bi.y*o.n22+bi.z*o.n23)*0.5+0.5,bi.copy(k.vertexNormalsWorld[q]),aY=(bi.x*o.n11+bi.y*o.n12+bi.z*o.n13)*0.5+0.5,aJ=-(bi.x*o.n21+bi.y*o.n22+bi.z*o.n23)*0.5+0.5,j(aZ,aT,aV,bd,a3,a4,az,bc,bj,bf,aY,aJ,B.envMap)}}else{B.wireframe?m(B.color,B.wireframeLinewidth,B.wireframeLinecap,B.wireframeLinejoin):E(B.color)}}}else{if(B instanceof b.MeshLambertMaterial){B.map&&!B.wireframe&&(B.map.mapping instanceof b.UVMapping&&(ad=k.uvs[0],j(aZ,aT,aV,bd,a3,a4,ad[u].u,ad[u].v,ad[p].u,ad[p].v,ad[q].u,ad[q].v,B.map)),aG(b.SubtractiveBlending)),aW?!B.wireframe&&B.shading==b.SmoothShading&&k.vertexNormalsWorld.length==3?(aN.r=ac.r=be.r=ar.r,aN.g=ac.g=be.g=ar.g,aN.b=ac.b=be.b=ar.b,y(ax,k.v1.positionWorld,k.vertexNormalsWorld[0],aN),y(ax,k.v2.positionWorld,k.vertexNormalsWorld[1],ac),y(ax,k.v3.positionWorld,k.vertexNormalsWorld[2],be),aN.r=Math.max(0,Math.min(B.color.r*aN.r,1)),aN.g=Math.max(0,Math.min(B.color.g*aN.g,1)),aN.b=Math.max(0,Math.min(B.color.b*aN.b,1)),ac.r=Math.max(0,Math.min(B.color.r*ac.r,1)),ac.g=Math.max(0,Math.min(B.color.g*ac.g,1)),ac.b=Math.max(0,Math.min(B.color.b*ac.b,1)),be.r=Math.max(0,Math.min(B.color.r*be.r,1)),be.g=Math.max(0,Math.min(B.color.g*be.g,1)),be.b=Math.max(0,Math.min(B.color.b*be.b,1)),bh.r=(ac.r+be.r)*0.5,bh.g=(ac.g+be.g)*0.5,bh.b=(ac.b+be.b)*0.5,aE=h(aN,ac,be,bh),G(aZ,aT,aV,bd,a3,a4,0,0,1,0,0,1,aE)):(aL.r=ar.r,aL.g=ar.g,aL.b=ar.b,y(ax,k.centroidWorld,k.normalWorld,aL),aL.r=Math.max(0,Math.min(B.color.r*aL.r,1)),aL.g=Math.max(0,Math.min(B.color.g*aL.g,1)),aL.b=Math.max(0,Math.min(B.color.b*aL.b,1)),B.wireframe?m(aL,B.wireframeLinewidth,B.wireframeLinecap,B.wireframeLinejoin):E(aL)):B.wireframe?m(B.color,B.wireframeLinewidth,B.wireframeLinecap,B.wireframeLinejoin):E(B.color)}else{if(B instanceof b.MeshDepthMaterial){D=A.near,a7=A.far,aN.r=aN.g=aN.b=1-s(o.positionScreen.z,D,a7),ac.r=ac.g=ac.b=1-s(w.positionScreen.z,D,a7),be.r=be.g=be.b=1-s(t.positionScreen.z,D,a7),bh.r=(ac.r+be.r)*0.5,bh.g=(ac.g+be.g)*0.5,bh.b=(ac.b+be.b)*0.5,aE=h(aN,ac,be,bh),G(aZ,aT,aV,bd,a3,a4,0,0,1,0,0,1,aE)}else{if(B instanceof b.MeshNormalMaterial){aL.r=l(k.normalWorld.x),aL.g=l(k.normalWorld.y),aL.b=l(k.normalWorld.z),B.wireframe?m(aL,B.wireframeLinewidth,B.wireframeLinecap,B.wireframeLinejoin):E(aL)}}}}}function f(K,F,w,B,u,o,q,t,k){aB.info.render.vertices+=4;aB.info.render.faces++;aF(t.opacity);aG(t.blending);if(t.map||t.envMap){i(K,F,B,0,1,3,q,t,k),i(u,w,o,1,2,3,q,t,k)}else{if(aZ=K.positionScreen.x,aT=K.positionScreen.y,aV=F.positionScreen.x,bd=F.positionScreen.y,a3=w.positionScreen.x,a4=w.positionScreen.y,a2=B.positionScreen.x,aX=B.positionScreen.y,aQ=u.positionScreen.x,aU=u.positionScreen.y,aM=o.positionScreen.x,aw=o.positionScreen.y,t instanceof b.MeshBasicMaterial){H(aZ,aT,aV,bd,a3,a4,a2,aX),t.wireframe?m(t.color,t.wireframeLinewidth,t.wireframeLinecap,t.wireframeLinejoin):E(t.color)}else{if(t instanceof b.MeshLambertMaterial){aW?!t.wireframe&&t.shading==b.SmoothShading&&q.vertexNormalsWorld.length==4?(aN.r=ac.r=be.r=bh.r=ar.r,aN.g=ac.g=be.g=bh.g=ar.g,aN.b=ac.b=be.b=bh.b=ar.b,y(ax,q.v1.positionWorld,q.vertexNormalsWorld[0],aN),y(ax,q.v2.positionWorld,q.vertexNormalsWorld[1],ac),y(ax,q.v4.positionWorld,q.vertexNormalsWorld[3],be),y(ax,q.v3.positionWorld,q.vertexNormalsWorld[2],bh),aN.r=Math.max(0,Math.min(t.color.r*aN.r,1)),aN.g=Math.max(0,Math.min(t.color.g*aN.g,1)),aN.b=Math.max(0,Math.min(t.color.b*aN.b,1)),ac.r=Math.max(0,Math.min(t.color.r*ac.r,1)),ac.g=Math.max(0,Math.min(t.color.g*ac.g,1)),ac.b=Math.max(0,Math.min(t.color.b*ac.b,1)),be.r=Math.max(0,Math.min(t.color.r*be.r,1)),be.g=Math.max(0,Math.min(t.color.g*be.g,1)),be.b=Math.max(0,Math.min(t.color.b*be.b,1)),bh.r=Math.max(0,Math.min(t.color.r*bh.r,1)),bh.g=Math.max(0,Math.min(t.color.g*bh.g,1)),bh.b=Math.max(0,Math.min(t.color.b*bh.b,1)),aE=h(aN,ac,be,bh),d(aZ,aT,aV,bd,a2,aX),G(aZ,aT,aV,bd,a2,aX,0,0,1,0,0,1,aE),d(aQ,aU,a3,a4,aM,aw),G(aQ,aU,a3,a4,aM,aw,1,0,1,1,0,1,aE)):(aL.r=ar.r,aL.g=ar.g,aL.b=ar.b,y(ax,q.centroidWorld,q.normalWorld,aL),aL.r=Math.max(0,Math.min(t.color.r*aL.r,1)),aL.g=Math.max(0,Math.min(t.color.g*aL.g,1)),aL.b=Math.max(0,Math.min(t.color.b*aL.b,1)),H(aZ,aT,aV,bd,a3,a4,a2,aX),t.wireframe?m(aL,t.wireframeLinewidth,t.wireframeLinecap,t.wireframeLinejoin):E(aL)):(H(aZ,aT,aV,bd,a3,a4,a2,aX),t.wireframe?m(t.color,t.wireframeLinewidth,t.wireframeLinecap,t.wireframeLinejoin):E(t.color))}else{if(t instanceof b.MeshNormalMaterial){aL.r=l(q.normalWorld.x),aL.g=l(q.normalWorld.y),aL.b=l(q.normalWorld.z),H(aZ,aT,aV,bd,a3,a4,a2,aX),t.wireframe?m(aL,t.wireframeLinewidth,t.wireframeLinecap,t.wireframeLinejoin):E(aL)}else{if(t instanceof b.MeshDepthMaterial){D=A.near,a7=A.far,aN.r=aN.g=aN.b=1-s(K.positionScreen.z,D,a7),ac.r=ac.g=ac.b=1-s(F.positionScreen.z,D,a7),be.r=be.g=be.b=1-s(B.positionScreen.z,D,a7),bh.r=bh.g=bh.b=1-s(w.positionScreen.z,D,a7),aE=h(aN,ac,be,bh),d(aZ,aT,aV,bd,a2,aX),G(aZ,aT,aV,bd,a2,aX,0,0,1,0,0,1,aE),d(aQ,aU,a3,a4,aM,aw),G(aQ,aU,a3,a4,aM,aw,1,0,1,1,0,1,aE)}}}}}}function d(o,k,u,t,p,q){aq.beginPath();aq.moveTo(o,k);aq.lineTo(u,t);aq.lineTo(p,q);aq.lineTo(o,k);aq.closePath()}function H(o,k,B,w,q,u,t,p){aq.beginPath();aq.moveTo(o,k);aq.lineTo(B,w);aq.lineTo(q,u);aq.lineTo(t,p);aq.lineTo(o,k);aq.closePath()}function m(o,k,q,p){if(a9!=k){aq.lineWidth=a9=k}if(ag!=q){aq.lineCap=ag=q}if(af!=p){aq.lineJoin=af=p}aD(o.getContextStyle());aq.stroke();a1.inflate(k*2)}function E(k){aA(k.getContextStyle());aq.fill()}function j(W,V,U,S,R,Q,N,P,O,F,M,K,B){if(B.image.width!=0){if(B.needsUpdate==!0||aI[B.id]==void 0){var w=B.wrapS==b.RepeatWrapping,u=B.wrapT==b.RepeatWrapping;aI[B.id]=aq.createPattern(B.image,w&&u?"repeat":w&&!u?"repeat-x":!w&&u?"repeat-y":"no-repeat");B.needsUpdate=!1}aA(aI[B.id]);var w=B.offset.x/B.repeat.x,u=B.offset.y/B.repeat.y,T=B.image.width*B.repeat.x,t=B.image.height*B.repeat.y,N=(N+w)*T,P=(P+u)*t,O=(O+w)*T,F=(F+u)*t,M=(M+w)*T,K=(K+u)*t;U-=W;S-=V;R-=W;Q-=V;O-=N;F-=P;M-=N;K-=P;w=O*K-M*F;if(w==0){if(bl[B.id]==void 0){V=document.createElement("canvas"),V.width=B.image.width,V.height=B.image.height,W=V.getContext("2d"),W.drawImage(B.image,0,0),bl[B.id]=W.getImageData(0,0,B.image.width,B.image.height).data,delete V}V=bl[B.id];N=(Math.floor(N)+Math.floor(P)*B.image.width)*4;aL.setRGB(V[N]/255,V[N+1]/255,V[N+2]/255);E(aL)}else{w=1/w,B=(K*U-F*R)*w,F=(K*S-F*Q)*w,U=(O*R-M*U)*w,S=(O*Q-M*S)*w,W=W-B*N-U*P,N=V-F*N-S*P,aq.save(),aq.transform(B,F,U,S,W,N),aq.fill(),aq.restore()}}}function G(R,Q,P,O,L,N,M,B,K,F,t,w,u){var q,p;q=u.width-1;p=u.height-1;M*=q;B*=p;K*=q;F*=p;t*=q;w*=p;P-=R;O-=Q;L-=R;N-=Q;K-=M;F-=B;t-=M;w-=B;p=1/(K*w-t*F);q=(w*P-F*L)*p;F=(w*O-F*N)*p;P=(K*L-t*P)*p;O=(K*N-t*O)*p;R=R-q*M-P*B;Q=Q-F*M-O*B;aq.save();aq.transform(q,F,P,O,R,Q);aq.clip();aq.drawImage(u,0,0);aq.restore()}function h(N,M,L,K){var w=~~(N.r*255),F=~~(N.g*255),N=~~(N.b*255),B=~~(M.r*255),q=~~(M.g*255),M=~~(M.b*255),u=~~(L.r*255),t=~~(L.g*255),L=~~(L.b*255),o=~~(K.r*255),p=~~(K.g*255),K=~~(K.b*255);bb[0]=w<0?0:w>255?255:w;bb[1]=F<0?0:F>255?255:F;bb[2]=N<0?0:N>255?255:N;bb[4]=B<0?0:B>255?255:B;bb[5]=q<0?0:q>255?255:q;bb[6]=M<0?0:M>255?255:M;bb[8]=u<0?0:u>255?255:u;bb[9]=t<0?0:t>255?255:t;bb[10]=L<0?0:L>255?255:L;bb[12]=o<0?0:o>255?255:o;bb[13]=p<0?0:p>255?255:p;bb[14]=K<0?0:K>255?255:K;z.putImageData(ae,0,0);ab.drawImage(aK,0,0);return aP}function s(o,k,p){o=(o-k)/(p-k);return o*o*(3-2*o)}function l(k){k=(k+1)*0.5;return k<0?0:k>1?1:k}function g(o,k){var t=k.x-o.x,q=k.y-o.y,p=t*t+q*q;p!=0&&(p=1/Math.sqrt(p),t*=p,q*=p,k.x+=t,k.y+=q,o.x-=t,o.y-=q)}var e,I,c,r;this.autoClear?this.clear():aq.setTransform(1,0,0,-1,at,am);aB.info.render.vertices=0;aB.info.render.faces=0;aC=au.projectScene(J,A,this.sortElements);ay=aC.elements;ax=aC.lights;(aW=ax.length>0)&&x(ax);e=0;for(I=ay.length;e<I;e++){if(c=ay[e],r=c.material,r=r instanceof b.MeshFaceMaterial?c.faceMaterial:r,!(r==null||r.opacity==0)){a1.empty();if(c instanceof b.RenderableParticle){ai=c,ai.x*=at,ai.y*=am,v(ai,c,r,J)}else{if(c instanceof b.RenderableLine){ai=c.v1,a0=c.v2,ai.positionScreen.x*=at,ai.positionScreen.y*=am,a0.positionScreen.x*=at,a0.positionScreen.y*=am,a1.addPoint(ai.positionScreen.x,ai.positionScreen.y),a1.addPoint(a0.positionScreen.x,a0.positionScreen.y),aS.intersects(a1)&&n(ai,a0,c,r,J)}else{if(c instanceof b.RenderableFace3){ai=c.v1,a0=c.v2,al=c.v3,ai.positionScreen.x*=at,ai.positionScreen.y*=am,a0.positionScreen.x*=at,a0.positionScreen.y*=am,al.positionScreen.x*=at,al.positionScreen.y*=am,r.overdraw&&(g(ai.positionScreen,a0.positionScreen),g(a0.positionScreen,al.positionScreen),g(al.positionScreen,ai.positionScreen)),a1.add3Points(ai.positionScreen.x,ai.positionScreen.y,a0.positionScreen.x,a0.positionScreen.y,al.positionScreen.x,al.positionScreen.y),aS.intersects(a1)&&i(ai,a0,al,0,1,2,c,r,J)}else{if(c instanceof b.RenderableFace4){ai=c.v1,a0=c.v2,al=c.v3,a6=c.v4,ai.positionScreen.x*=at,ai.positionScreen.y*=am,a0.positionScreen.x*=at,a0.positionScreen.y*=am,al.positionScreen.x*=at,al.positionScreen.y*=am,a6.positionScreen.x*=at,a6.positionScreen.y*=am,aR.positionScreen.copy(a0.positionScreen),aO.positionScreen.copy(a6.positionScreen),r.overdraw&&(g(ai.positionScreen,a0.positionScreen),g(a0.positionScreen,a6.positionScreen),g(a6.positionScreen,ai.positionScreen),g(al.positionScreen,aR.positionScreen),g(al.positionScreen,aO.positionScreen)),a1.addPoint(ai.positionScreen.x,ai.positionScreen.y),a1.addPoint(a0.positionScreen.x,a0.positionScreen.y),a1.addPoint(al.positionScreen.x,al.positionScreen.y),a1.addPoint(a6.positionScreen.x,a6.positionScreen.y),aS.intersects(a1)&&f(ai,a0,al,a6,aR,aO,c,r,J)}}}}C.addRectangle(a1)}}aq.setTransform(1,0,0,1,0,0)}};b.SVGRenderer=function(){function al(u,t,s,r){var o,q,p,n,l,k;o=0;for(q=u.length;o<q;o++){p=u[o],n=p.color,p instanceof b.DirectionalLight?(l=p.matrixWorld.getPosition(),k=s.dot(l),k<=0||(k*=p.intensity,r.r+=n.r*k,r.g+=n.g*k,r.b+=n.b*k)):p instanceof b.PointLight&&(l=p.matrixWorld.getPosition(),k=s.dot(L.sub(l,t).normalize()),k<=0||(k*=p.distance==0?1:1-Math.min(t.distanceTo(l)/p.distance,1),k!=0&&(k*=p.intensity,r.r+=n.r*k,r.g+=n.g*k,r.b+=n.b*k)))}}function aj(c){D[c]==null&&(D[c]=document.createElementNS("http://www.w3.org/2000/svg","path"),C==0&&D[c].setAttribute("shape-rendering","crispEdges"));return D[c]}function ak(c){c=(c+1)*0.5;return c<0?0:c>1?1:c}var ai=this,af,ag,ah,ae=new b.Projector,ad=document.createElementNS("http://www.w3.org/2000/svg","svg"),ab,ac,Y,X,aa,S,Z,V,P=new b.Rectangle,I=new b.Rectangle,N=!1,T=new b.Color,M=new b.Color,W=new b.Color,H=new b.Color,G,L=new b.Vector3,D=[],Q=[],O,z,j,C=1;this.domElement=ad;this.sortElements=this.sortObjects=this.autoClear=!0;this.info={render:{vertices:0,faces:0}};this.setQuality=function(c){switch(c){case"high":C=1;break;case"low":C=0}};this.setSize=function(d,c){ab=d;ac=c;Y=ab/2;X=ac/2;ad.setAttribute("viewBox",-Y+" "+-X+" "+ab+" "+ac);ad.setAttribute("width",ab);ad.setAttribute("height",ac);P.set(-Y,-X,Y,X)};this.clear=function(){for(;ad.childNodes.length>0;){ad.removeChild(ad.childNodes[0])}};this.render=function(e,d){var i,n,o,m;this.autoClear&&this.clear();ai.info.render.vertices=0;ai.info.render.faces=0;af=ae.projectScene(e,d,this.sortElements);ag=af.elements;ah=af.lights;j=z=0;if(N=ah.length>0){M.setRGB(0,0,0);W.setRGB(0,0,0);H.setRGB(0,0,0);i=0;for(n=ah.length;i<n;i++){m=ah[i],o=m.color,m instanceof b.AmbientLight?(M.r+=o.r,M.g+=o.g,M.b+=o.b):m instanceof b.DirectionalLight?(W.r+=o.r,W.g+=o.g,W.b+=o.b):m instanceof b.PointLight&&(H.r+=o.r,H.g+=o.g,H.b+=o.b)}}i=0;for(n=ag.length;i<n;i++){if(o=ag[i],m=o.material,m=m instanceof b.MeshFaceMaterial?o.faceMaterial:m,!(m==null||m.opacity==0)){if(I.empty(),o instanceof b.RenderableParticle){aa=o,aa.x*=Y,aa.y*=-X}else{if(o instanceof b.RenderableLine){if(aa=o.v1,S=o.v2,aa.positionScreen.x*=Y,aa.positionScreen.y*=-X,S.positionScreen.x*=Y,S.positionScreen.y*=-X,I.addPoint(aa.positionScreen.x,aa.positionScreen.y),I.addPoint(S.positionScreen.x,S.positionScreen.y),P.intersects(I)){o=aa;var g=S,f=j++;Q[f]==null&&(Q[f]=document.createElementNS("http://www.w3.org/2000/svg","line"),C==0&&Q[f].setAttribute("shape-rendering","crispEdges"));O=Q[f];O.setAttribute("x1",o.positionScreen.x);O.setAttribute("y1",o.positionScreen.y);O.setAttribute("x2",g.positionScreen.x);O.setAttribute("y2",g.positionScreen.y);m instanceof b.LineBasicMaterial&&(O.setAttribute("style","fill: none; stroke: "+m.color.getContextStyle()+"; stroke-width: "+m.linewidth+"; stroke-opacity: "+m.opacity+"; stroke-linecap: "+m.linecap+"; stroke-linejoin: "+m.linejoin),ad.appendChild(O))}}else{if(o instanceof b.RenderableFace3){if(aa=o.v1,S=o.v2,Z=o.v3,aa.positionScreen.x*=Y,aa.positionScreen.y*=-X,S.positionScreen.x*=Y,S.positionScreen.y*=-X,Z.positionScreen.x*=Y,Z.positionScreen.y*=-X,I.addPoint(aa.positionScreen.x,aa.positionScreen.y),I.addPoint(S.positionScreen.x,S.positionScreen.y),I.addPoint(Z.positionScreen.x,Z.positionScreen.y),P.intersects(I)){var g=aa,f=S,h=Z;ai.info.render.vertices+=3;ai.info.render.faces++;O=aj(z++);O.setAttribute("d","M "+g.positionScreen.x+" "+g.positionScreen.y+" L "+f.positionScreen.x+" "+f.positionScreen.y+" L "+h.positionScreen.x+","+h.positionScreen.y+"z");m instanceof b.MeshBasicMaterial?T.copy(m.color):m instanceof b.MeshLambertMaterial?N?(T.r=M.r,T.g=M.g,T.b=M.b,al(ah,o.centroidWorld,o.normalWorld,T),T.r=Math.max(0,Math.min(m.color.r*T.r,1)),T.g=Math.max(0,Math.min(m.color.g*T.g,1)),T.b=Math.max(0,Math.min(m.color.b*T.b,1))):T.copy(m.color):m instanceof b.MeshDepthMaterial?(G=1-m.__2near/(m.__farPlusNear-o.z*m.__farMinusNear),T.setRGB(G,G,G)):m instanceof b.MeshNormalMaterial&&T.setRGB(ak(o.normalWorld.x),ak(o.normalWorld.y),ak(o.normalWorld.z));m.wireframe?O.setAttribute("style","fill: none; stroke: "+T.getContextStyle()+"; stroke-width: "+m.wireframeLinewidth+"; stroke-opacity: "+m.opacity+"; stroke-linecap: "+m.wireframeLinecap+"; stroke-linejoin: "+m.wireframeLinejoin):O.setAttribute("style","fill: "+T.getContextStyle()+"; fill-opacity: "+m.opacity);ad.appendChild(O)}}else{if(o instanceof b.RenderableFace4&&(aa=o.v1,S=o.v2,Z=o.v3,V=o.v4,aa.positionScreen.x*=Y,aa.positionScreen.y*=-X,S.positionScreen.x*=Y,S.positionScreen.y*=-X,Z.positionScreen.x*=Y,Z.positionScreen.y*=-X,V.positionScreen.x*=Y,V.positionScreen.y*=-X,I.addPoint(aa.positionScreen.x,aa.positionScreen.y),I.addPoint(S.positionScreen.x,S.positionScreen.y),I.addPoint(Z.positionScreen.x,Z.positionScreen.y),I.addPoint(V.positionScreen.x,V.positionScreen.y),P.intersects(I))){var g=aa,f=S,h=Z,c=V;ai.info.render.vertices+=4;ai.info.render.faces++;O=aj(z++);O.setAttribute("d","M "+g.positionScreen.x+" "+g.positionScreen.y+" L "+f.positionScreen.x+" "+f.positionScreen.y+" L "+h.positionScreen.x+","+h.positionScreen.y+" L "+c.positionScreen.x+","+c.positionScreen.y+"z");m instanceof b.MeshBasicMaterial?T.copy(m.color):m instanceof b.MeshLambertMaterial?N?(T.r=M.r,T.g=M.g,T.b=M.b,al(ah,o.centroidWorld,o.normalWorld,T),T.r=Math.max(0,Math.min(m.color.r*T.r,1)),T.g=Math.max(0,Math.min(m.color.g*T.g,1)),T.b=Math.max(0,Math.min(m.color.b*T.b,1))):T.copy(m.color):m instanceof b.MeshDepthMaterial?(G=1-m.__2near/(m.__farPlusNear-o.z*m.__farMinusNear),T.setRGB(G,G,G)):m instanceof b.MeshNormalMaterial&&T.setRGB(ak(o.normalWorld.x),ak(o.normalWorld.y),ak(o.normalWorld.z));m.wireframe?O.setAttribute("style","fill: none; stroke: "+T.getContextStyle()+"; stroke-width: "+m.wireframeLinewidth+"; stroke-opacity: "+m.opacity+"; stroke-linecap: "+m.wireframeLinecap+"; stroke-linejoin: "+m.wireframeLinejoin):O.setAttribute("style","fill: "+T.getContextStyle()+"; fill-opacity: "+m.opacity);ad.appendChild(O)}}}}}}}};b.ShaderChunk={fog_pars_fragment:"#ifdef USE_FOG\nuniform vec3 fogColor;\n#ifdef FOG_EXP2\nuniform float fogDensity;\n#else\nuniform float fogNear;\nuniform float fogFar;\n#endif\n#endif",fog_fragment:"#ifdef USE_FOG\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n#ifdef FOG_EXP2\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n#else\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n#endif\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float reflectivity;\nuniform samplerCube envMap;\nuniform float flipEnvMap;\nuniform int combine;\n#endif",envmap_fragment:"#ifdef USE_ENVMAP\nvec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * vReflect.x, vReflect.yz ) );\n#ifdef GAMMA_INPUT\ncubeColor.xyz *= cubeColor.xyz;\n#endif\nif ( combine == 1 ) {\ngl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, reflectivity );\n} else {\ngl_FragColor.xyz = gl_FragColor.xyz * cubeColor.xyz;\n}\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float refractionRatio;\nuniform bool useRefract;\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = mat3( objectMatrix[ 0 ].xyz, objectMatrix[ 1 ].xyz, objectMatrix[ 2 ].xyz ) * normal;\nif ( useRefract ) {\nvReflect = refract( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ), refractionRatio );\n} else {\nvReflect = reflect( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ) );\n}\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\nuniform sampler2D map;\n#endif",map_particle_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, gl_PointCoord );\n#endif",map_pars_vertex:"#ifdef USE_MAP\nvarying vec2 vUv;\nuniform vec4 offsetRepeat;\n#endif",map_pars_fragment:"#ifdef USE_MAP\nvarying vec2 vUv;\nuniform sampler2D map;\n#endif",map_vertex:"#ifdef USE_MAP\nvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",map_fragment:"#ifdef USE_MAP\n#ifdef GAMMA_INPUT\nvec4 texelColor = texture2D( map, vUv );\ntexelColor.xyz *= texelColor.xyz;\ngl_FragColor = gl_FragColor * texelColor;\n#else\ngl_FragColor = gl_FragColor * texture2D( map, vUv );\n#endif\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\nuniform sampler2D lightMap;\n#endif",lightmap_pars_vertex:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\ngl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n#endif",lightmap_vertex:"#ifdef USE_LIGHTMAP\nvUv2 = uv2;\n#endif",lights_lambert_pars_vertex:"uniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif",lights_lambert_vertex:"vLightWeighting = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nfloat directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ i ] * directionalLightWeighting;\n}\n#endif\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat pointLightWeighting = max( dot( transformedNormal, lVector ), 0.0 );\nvLightWeighting += pointLightColor[ i ] * pointLightWeighting * lDistance;\n}\n#endif\nvLightWeighting = vLightWeighting * diffuse + ambient * ambientLightColor;",lights_phong_pars_vertex:"#if MAX_POINT_LIGHTS > 0\n#ifndef PHONG_PER_PIXEL\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#endif",lights_phong_vertex:"#if MAX_POINT_LIGHTS > 0\n#ifndef PHONG_PER_PIXEL\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nvPointLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#endif",lights_phong_pars_fragment:"uniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n#ifdef PHONG_PER_PIXEL\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#else\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#endif\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",lights_phong_fragment:"vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse  = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n#ifdef PHONG_PER_PIXEL\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz + vViewPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\n#else\nvec3 lVector = normalize( vPointLight[ i ].xyz );\nfloat lDistance = vPointLight[ i ].w;\n#endif\nvec3 pointHalfVector = normalize( lVector + viewPosition );\nfloat pointDistance = lDistance;\nfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\nfloat pointDiffuseWeight = max( dot( normal, lVector ), 0.0 );\nfloat pointSpecularWeight = pow( pointDotNormalHalf, shininess );\n#ifdef PHYSICALLY_BASED_SHADING\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( dot( lVector, pointHalfVector ), 5.0 );\npointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance;\n#else\npointSpecular += specular * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance;\n#endif\npointDiffuse  += diffuse * pointLightColor[ i ] * pointDiffuseWeight * pointDistance;\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse  = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nvec3 dirHalfVector = normalize( lDirection.xyz + viewPosition );\nfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\nfloat dirSpecularWeight = pow( dirDotNormalHalf, shininess );\n#ifdef PHYSICALLY_BASED_SHADING\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( dot( dirVector, dirHalfVector ), 5.0 );\ndirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;\n#else\ndirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;\n#endif\ndirDiffuse  += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;\n}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\n#ifdef METAL\ngl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient + totalSpecular );\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_fragment:"#ifdef USE_COLOR\ngl_FragColor = gl_FragColor * vec4( vColor, opacity );\n#endif",color_pars_vertex:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n#ifdef GAMMA_INPUT\nvColor = color * color;\n#else\nvColor = color;\n#endif\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\nuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n#endif",skinning_vertex:"#ifdef USE_SKINNING\ngl_Position  = ( boneGlobalMatrices[ int( skinIndex.x ) ] * skinVertexA ) * skinWeight.x;\ngl_Position += ( boneGlobalMatrices[ int( skinIndex.y ) ] * skinVertexB ) * skinWeight.y;\ngl_Position  = projectionMatrix * viewMatrix * objectMatrix * gl_Position;\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\nuniform float morphTargetInfluences[ 8 ];\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\nvec3 morphed = vec3( 0.0, 0.0, 0.0 );\nmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\nmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\nmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\nmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\nmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\nmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\nmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\nmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\nmorphed += position;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( morphed, 1.0 );\n#endif",default_vertex:"#ifndef USE_MORPHTARGETS\n#ifndef USE_SKINNING\ngl_Position = projectionMatrix * mvPosition;\n#endif\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\nuniform sampler2D shadowMap[ MAX_SHADOWS ];\nuniform float shadowDarkness;\nuniform float shadowBias;\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nfloat unpackDepth( const in vec4 rgba_depth ) {\nconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\nfloat depth = dot( rgba_depth, bit_shift );\nreturn depth;\n}\n#endif",shadowmap_fragment:"#ifdef USE_SHADOWMAP\n#ifdef SHADOWMAP_SOFT\nconst float xPixelOffset = 1.0 / SHADOWMAP_WIDTH;\nconst float yPixelOffset = 1.0 / SHADOWMAP_HEIGHT;\n#endif\nvec3 shadowColor = vec3( 1.0 );\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\nshadowCoord.z += shadowBias;\nif ( shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0 ) {\n#ifdef SHADOWMAP_SOFT\nfloat shadow = 0.0;\nfor ( float y = -1.25; y <= 1.25; y += 1.25 )\nfor ( float x = -1.25; x <= 1.25; x += 1.25 ) {\nvec4 rgbaDepth = texture2D( shadowMap[ i ], vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy );\nfloat fDepth = unpackDepth( rgbaDepth );\nif ( fDepth < shadowCoord.z )\nshadow += 1.0;\n}\nshadow /= 9.0;\nshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness * shadow ) );\n#else\nvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\nfloat fDepth = unpackDepth( rgbaDepth );\nif ( fDepth < shadowCoord.z )\nshadowColor = shadowColor * vec3( shadowDarkness );\n#endif\n}\n}\n#ifdef GAMMA_OUTPUT\nshadowColor *= shadowColor;\n#endif\ngl_FragColor.xyz = gl_FragColor.xyz * shadowColor;\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nuniform mat4 shadowMatrix[ MAX_SHADOWS ];\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvShadowCoord[ i ] = shadowMatrix[ i ] * objectMatrix * vec4( position, 1.0 );\n}\n#endif",alphatest_fragment:"#ifdef ALPHATEST\nif ( gl_FragColor.a < ALPHATEST ) discard;\n#endif",linear_to_gamma_fragment:"#ifdef GAMMA_OUTPUT\ngl_FragColor.xyz = sqrt( gl_FragColor.xyz );\n#endif"};b.UniformsUtils={merge:function(f){var j,e,i,h={};for(j=0;j<f.length;j++){for(e in i=this.clone(f[j]),i){h[e]=i[e]}}return h},clone:function(f){var j,e,i,h={};for(j in f){for(e in h[j]={},f[j]){i=f[j][e],h[j][e]=i instanceof b.Color||i instanceof b.Vector2||i instanceof b.Vector3||i instanceof b.Vector4||i instanceof b.Matrix4||i instanceof b.Texture?i.clone():i instanceof Array?i.slice():i}}return h}};b.UniformsLib={common:{diffuse:{type:"c",value:new b.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:0,texture:null},offsetRepeat:{type:"v4",value:new b.Vector4(0,0,1,1)},lightMap:{type:"t",value:2,texture:null},envMap:{type:"t",value:1,texture:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:0.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},fog:{fogDensity:{type:"f",value:0.00025},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2000},fogColor:{type:"c",value:new b.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new b.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:0,texture:null},fogDensity:{type:"f",value:0.00025},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2000},fogColor:{type:"c",value:new b.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:6,texture:[]},shadowMatrix:{type:"m4v",value:[]},shadowBias:{type:"f",value:0.0039},shadowDarkness:{type:"f",value:0.2}}};b.ShaderLib={sprite:{vertexShader:"uniform int useScreenCoordinates;\nuniform int affectedByDistance;\nuniform vec3 screenPosition;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 alignment;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position + alignment;\nvec2 rotatedPosition;\nrotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;\nrotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;\nvec4 finalPosition;\nif( useScreenCoordinates != 0 ) {\nfinalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );\n} else {\nfinalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition * ( affectedByDistance == 1 ? 1.0 : finalPosition.z );\n}\ngl_Position = finalPosition;\n}",fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nvarying vec2 vUV;\nvoid main() {\nvec4 texture = texture2D( map, vUV );\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\n}"},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2000},opacity:{type:"f",value:1}},vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float mNear;\nuniform float mFar;\nuniform float opacity;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat color = 1.0 - smoothstep( mNear, mFar, depth );\ngl_FragColor = vec4( vec3( color ), opacity );\n}"},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:"varying vec3 vNormal;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvNormal = normalize( normalMatrix * normal );\ngl_Position = projectionMatrix * mvPosition;\n}",fragmentShader:"uniform float opacity;\nvarying vec3 vNormal;\nvoid main() {\ngl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\n}"},basic:{uniforms:b.UniformsUtils.merge([b.UniformsLib.common,b.UniformsLib.fog,b.UniformsLib.shadowmap]),vertexShader:[b.ShaderChunk.map_pars_vertex,b.ShaderChunk.lightmap_pars_vertex,b.ShaderChunk.envmap_pars_vertex,b.ShaderChunk.color_pars_vertex,b.ShaderChunk.skinning_pars_vertex,b.ShaderChunk.morphtarget_pars_vertex,b.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",b.ShaderChunk.map_vertex,b.ShaderChunk.lightmap_vertex,b.ShaderChunk.envmap_vertex,b.ShaderChunk.color_vertex,b.ShaderChunk.skinning_vertex,b.ShaderChunk.morphtarget_vertex,b.ShaderChunk.default_vertex,b.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",b.ShaderChunk.color_pars_fragment,b.ShaderChunk.map_pars_fragment,b.ShaderChunk.lightmap_pars_fragment,b.ShaderChunk.envmap_pars_fragment,b.ShaderChunk.fog_pars_fragment,b.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );",b.ShaderChunk.map_fragment,b.ShaderChunk.alphatest_fragment,b.ShaderChunk.lightmap_fragment,b.ShaderChunk.color_fragment,b.ShaderChunk.envmap_fragment,b.ShaderChunk.shadowmap_fragment,b.ShaderChunk.linear_to_gamma_fragment,b.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:b.UniformsUtils.merge([b.UniformsLib.common,b.UniformsLib.fog,b.UniformsLib.lights,b.UniformsLib.shadowmap,{ambient:{type:"c",value:new b.Color(328965)}}]),vertexShader:["varying vec3 vLightWeighting;",b.ShaderChunk.map_pars_vertex,b.ShaderChunk.lightmap_pars_vertex,b.ShaderChunk.envmap_pars_vertex,b.ShaderChunk.lights_lambert_pars_vertex,b.ShaderChunk.color_pars_vertex,b.ShaderChunk.skinning_pars_vertex,b.ShaderChunk.morphtarget_pars_vertex,b.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",b.ShaderChunk.map_vertex,b.ShaderChunk.lightmap_vertex,b.ShaderChunk.envmap_vertex,b.ShaderChunk.color_vertex,"vec3 transformedNormal = normalize( normalMatrix * normal );",b.ShaderChunk.lights_lambert_vertex,b.ShaderChunk.skinning_vertex,b.ShaderChunk.morphtarget_vertex,b.ShaderChunk.default_vertex,b.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;\nvarying vec3 vLightWeighting;",b.ShaderChunk.color_pars_fragment,b.ShaderChunk.map_pars_fragment,b.ShaderChunk.lightmap_pars_fragment,b.ShaderChunk.envmap_pars_fragment,b.ShaderChunk.fog_pars_fragment,b.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );",b.ShaderChunk.map_fragment,b.ShaderChunk.alphatest_fragment,"gl_FragColor.xyz = gl_FragColor.xyz * vLightWeighting;",b.ShaderChunk.lightmap_fragment,b.ShaderChunk.color_fragment,b.ShaderChunk.envmap_fragment,b.ShaderChunk.shadowmap_fragment,b.ShaderChunk.linear_to_gamma_fragment,b.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:b.UniformsUtils.merge([b.UniformsLib.common,b.UniformsLib.fog,b.UniformsLib.lights,b.UniformsLib.shadowmap,{ambient:{type:"c",value:new b.Color(328965)},specular:{type:"c",value:new b.Color(1118481)},shininess:{type:"f",value:30}}]),vertexShader:["varying vec3 vViewPosition;\nvarying vec3 vNormal;",b.ShaderChunk.map_pars_vertex,b.ShaderChunk.lightmap_pars_vertex,b.ShaderChunk.envmap_pars_vertex,b.ShaderChunk.lights_phong_pars_vertex,b.ShaderChunk.color_pars_vertex,b.ShaderChunk.skinning_pars_vertex,b.ShaderChunk.morphtarget_pars_vertex,b.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",b.ShaderChunk.map_vertex,b.ShaderChunk.lightmap_vertex,b.ShaderChunk.envmap_vertex,b.ShaderChunk.color_vertex,"#ifndef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\n#endif\nvViewPosition = -mvPosition.xyz;\nvec3 transformedNormal = normalMatrix * normal;\nvNormal = transformedNormal;",b.ShaderChunk.lights_phong_vertex,b.ShaderChunk.skinning_vertex,b.ShaderChunk.morphtarget_vertex,b.ShaderChunk.default_vertex,b.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform vec3 ambient;\nuniform vec3 specular;\nuniform float shininess;",b.ShaderChunk.color_pars_fragment,b.ShaderChunk.map_pars_fragment,b.ShaderChunk.lightmap_pars_fragment,b.ShaderChunk.envmap_pars_fragment,b.ShaderChunk.fog_pars_fragment,b.ShaderChunk.lights_phong_pars_fragment,b.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );",b.ShaderChunk.map_fragment,b.ShaderChunk.alphatest_fragment,b.ShaderChunk.lights_phong_fragment,b.ShaderChunk.lightmap_fragment,b.ShaderChunk.color_fragment,b.ShaderChunk.envmap_fragment,b.ShaderChunk.shadowmap_fragment,b.ShaderChunk.linear_to_gamma_fragment,b.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:b.UniformsUtils.merge([b.UniformsLib.particle,b.UniformsLib.shadowmap]),vertexShader:["uniform float size;\nuniform float scale;",b.ShaderChunk.color_pars_vertex,b.ShaderChunk.shadowmap_pars_vertex,"void main() {",b.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n#ifdef USE_SIZEATTENUATION\ngl_PointSize = size * ( scale / length( mvPosition.xyz ) );\n#else\ngl_PointSize = size;\n#endif\ngl_Position = projectionMatrix * mvPosition;",b.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;\nuniform float opacity;",b.ShaderChunk.color_pars_fragment,b.ShaderChunk.map_particle_pars_fragment,b.ShaderChunk.fog_pars_fragment,b.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( psColor, opacity );",b.ShaderChunk.map_particle_fragment,b.ShaderChunk.alphatest_fragment,b.ShaderChunk.color_fragment,b.ShaderChunk.shadowmap_fragment,b.ShaderChunk.fog_fragment,"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[b.ShaderChunk.morphtarget_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",b.ShaderChunk.morphtarget_vertex,b.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:"vec4 pack_depth( const in float depth ) {\nconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\nconst vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\nvec4 res = fract( depth * bit_shift );\nres -= res.xxyz * bit_mask;\nreturn res;\n}\nvoid main() {\ngl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );\n}"}};b.WebGLRenderer=function(aH){function aF(i,h){var n=i.vertices.length,m=h.material;if(m.attributes){if(i.__webglCustomAttributesList===void 0){i.__webglCustomAttributesList=[]}for(var j in m.attributes){var k=m.attributes[j];if(!k.__webglInitialized||k.createUniqueBuffers){k.__webglInitialized=!0;var l=1;k.type==="v2"?l=2:k.type==="v3"?l=3:k.type==="v4"?l=4:k.type==="c"&&(l=3);k.size=l;k.array=new Float32Array(n*l);k.buffer=aw.createBuffer();k.buffer.belongsToAttribute=j;k.needsUpdate=!0}i.__webglCustomAttributesList.push(k)}}}function aG(d,c){if(d.material&&!(d.material instanceof b.MeshFaceMaterial)){return d.material}else{if(c.materialIndex>=0){return d.geometry.materials[c.materialIndex]}}}function aD(c){if(c instanceof b.MeshBasicMaterial&&!c.envMap||c instanceof b.MeshDepthMaterial){return !1}return c&&c.shading!==void 0&&c.shading===b.SmoothShading?b.SmoothShading:b.FlatShading}function aA(c){if(c.vertexColors){return c.vertexColors}return !1}function aB(c){if(c.map||c.lightMap||c instanceof b.ShaderMaterial){return !0}return !1}function aC(H,G,F){var B,x,y,A,w=H.vertices;A=w.length;var v=H.colors,s=v.length,u=H.__vertexArray,r=H.__colorArray,t=H.__sortArray,q=H.__dirtyVertices,j=H.__dirtyColors,E=H.__webglCustomAttributesList;if(F.sortParticles){aW.multiplySelf(F.matrixWorld);for(B=0;B<A;B++){x=w[B].position,bg.copy(x),aW.multiplyVector3(bg),t[B]=[bg.z,B]}t.sort(function(d,c){return c[0]-d[0]});for(B=0;B<A;B++){x=w[t[B][1]].position,y=B*3,u[y]=x.x,u[y+1]=x.y,u[y+2]=x.z}for(B=0;B<s;B++){y=B*3,x=v[t[B][1]],r[y]=x.r,r[y+1]=x.g,r[y+2]=x.b}if(E){v=0;for(s=E.length;v<s;v++){if(w=E[v],w.boundTo===void 0||w.boundTo==="vertices"){if(y=0,x=w.value.length,w.size===1){for(B=0;B<x;B++){A=t[B][1],w.array[B]=w.value[A]}}else{if(w.size===2){for(B=0;B<x;B++){A=t[B][1],A=w.value[A],w.array[y]=A.x,w.array[y+1]=A.y,y+=2}}else{if(w.size===3){if(w.type==="c"){for(B=0;B<x;B++){A=t[B][1],A=w.value[A],w.array[y]=A.r,w.array[y+1]=A.g,w.array[y+2]=A.b,y+=3}}else{for(B=0;B<x;B++){A=t[B][1],A=w.value[A],w.array[y]=A.x,w.array[y+1]=A.y,w.array[y+2]=A.z,y+=3}}}else{if(w.size===4){for(B=0;B<x;B++){A=t[B][1],A=w.value[A],w.array[y]=A.x,w.array[y+1]=A.y,w.array[y+2]=A.z,w.array[y+3]=A.w,y+=4}}}}}}}}}else{if(q){for(B=0;B<A;B++){x=w[B].position,y=B*3,u[y]=x.x,u[y+1]=x.y,u[y+2]=x.z}}if(j){for(B=0;B<s;B++){x=v[B],y=B*3,r[y]=x.r,r[y+1]=x.g,r[y+2]=x.b}}if(E){v=0;for(s=E.length;v<s;v++){if(w=E[v],w.needsUpdate&&(w.boundTo===void 0||w.boundTo==="vertices")){if(x=w.value.length,y=0,w.size===1){for(B=0;B<x;B++){w.array[B]=w.value[B]}}else{if(w.size===2){for(B=0;B<x;B++){A=w.value[B],w.array[y]=A.x,w.array[y+1]=A.y,y+=2}}else{if(w.size===3){if(w.type==="c"){for(B=0;B<x;B++){A=w.value[B],w.array[y]=A.r,w.array[y+1]=A.g,w.array[y+2]=A.b,y+=3}}else{for(B=0;B<x;B++){A=w.value[B],w.array[y]=A.x,w.array[y+1]=A.y,w.array[y+2]=A.z,y+=3}}}else{if(w.size===4){for(B=0;B<x;B++){A=w.value[B],w.array[y]=A.x,w.array[y+1]=A.y,w.array[y+2]=A.z,w.array[y+3]=A.w,y+=4}}}}}}}}}if(q||F.sortParticles){aw.bindBuffer(aw.ARRAY_BUFFER,H.__webglVertexBuffer),aw.bufferData(aw.ARRAY_BUFFER,u,G)}if(j||F.sortParticles){aw.bindBuffer(aw.ARRAY_BUFFER,H.__webglColorBuffer),aw.bufferData(aw.ARRAY_BUFFER,r,G)}if(E){v=0;for(s=E.length;v<s;v++){if(w=E[v],w.needsUpdate||F.sortParticles){aw.bindBuffer(aw.ARRAY_BUFFER,w.buffer),aw.bufferData(aw.ARRAY_BUFFER,w.array,G)}}}}function ay(E,B,A){if(!E.__webglVertexBuffer){E.__webglVertexBuffer=aw.createBuffer()}if(!E.__webglNormalBuffer){E.__webglNormalBuffer=aw.createBuffer()}E.hasPos&&(aw.bindBuffer(aw.ARRAY_BUFFER,E.__webglVertexBuffer),aw.bufferData(aw.ARRAY_BUFFER,E.positionArray,aw.DYNAMIC_DRAW),aw.enableVertexAttribArray(B.attributes.position),aw.vertexAttribPointer(B.attributes.position,3,aw.FLOAT,!1,0,0));if(E.hasNormal){aw.bindBuffer(aw.ARRAY_BUFFER,E.__webglNormalBuffer);if(A===b.FlatShading){var y,v,w,x,u,t,q,s,p,r,j=E.count*3;for(r=0;r<j;r+=9){A=E.normalArray,y=A[r],v=A[r+1],w=A[r+2],x=A[r+3],t=A[r+4],s=A[r+5],u=A[r+6],q=A[r+7],p=A[r+8],y=(y+x+u)/3,v=(v+t+q)/3,w=(w+s+p)/3,A[r]=y,A[r+1]=v,A[r+2]=w,A[r+3]=y,A[r+4]=v,A[r+5]=w,A[r+6]=y,A[r+7]=v,A[r+8]=w}}aw.bufferData(aw.ARRAY_BUFFER,E.normalArray,aw.DYNAMIC_DRAW);aw.enableVertexAttribArray(B.attributes.normal);aw.vertexAttribPointer(B.attributes.normal,3,aw.FLOAT,!1,0,0)}aw.drawArrays(aw.TRIANGLES,0,E.count);E.count=0}function ax(A,y,x,w,t,u){if(w.opacity!==0){var v,s,x=aj(A,y,x,w,u),y=x.attributes,A=!1,x=t.id*16777215+x.id*2+(w.wireframe?1:0);x!==bh&&(bh=x,A=!0);if(!w.morphTargets&&y.position>=0){A&&(aw.bindBuffer(aw.ARRAY_BUFFER,t.__webglVertexBuffer),aw.vertexAttribPointer(y.position,3,aw.FLOAT,!1,0,0))}else{if(u.morphTargetBase){x=w.program.attributes;u.morphTargetBase!==-1?(aw.bindBuffer(aw.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[u.morphTargetBase]),aw.vertexAttribPointer(x.position,3,aw.FLOAT,!1,0,0)):x.position>=0&&(aw.bindBuffer(aw.ARRAY_BUFFER,t.__webglVertexBuffer),aw.vertexAttribPointer(x.position,3,aw.FLOAT,!1,0,0));if(u.morphTargetForcedOrder.length){v=0;var r=u.morphTargetForcedOrder;for(s=u.morphTargetInfluences;v<w.numSupportedMorphTargets&&v<r.length;){aw.bindBuffer(aw.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[r[v]]),aw.vertexAttribPointer(x["morphTarget"+v],3,aw.FLOAT,!1,0,0),u.__webglMorphTargetInfluences[v]=s[r[v]],v++}}else{var r=[],o=-1,p=0;s=u.morphTargetInfluences;var q,j=s.length;v=0;for(u.morphTargetBase!==-1&&(r[u.morphTargetBase]=!0);v<w.numSupportedMorphTargets;){for(q=0;q<j;q++){!r[q]&&s[q]>o&&(p=q,o=s[p])}aw.bindBuffer(aw.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[p]);aw.vertexAttribPointer(x["morphTarget"+v],3,aw.FLOAT,!1,0,0);u.__webglMorphTargetInfluences[v]=o;r[p]=1;o=-1;v++}}w.program.uniforms.morphTargetInfluences!==null&&aw.uniform1fv(w.program.uniforms.morphTargetInfluences,u.__webglMorphTargetInfluences)}}if(A){if(t.__webglCustomAttributesList){v=0;for(s=t.__webglCustomAttributesList.length;v<s;v++){x=t.__webglCustomAttributesList[v],y[x.buffer.belongsToAttribute]>=0&&(aw.bindBuffer(aw.ARRAY_BUFFER,x.buffer),aw.vertexAttribPointer(y[x.buffer.belongsToAttribute],x.size,aw.FLOAT,!1,0,0))}}y.color>=0&&(aw.bindBuffer(aw.ARRAY_BUFFER,t.__webglColorBuffer),aw.vertexAttribPointer(y.color,3,aw.FLOAT,!1,0,0));y.normal>=0&&(aw.bindBuffer(aw.ARRAY_BUFFER,t.__webglNormalBuffer),aw.vertexAttribPointer(y.normal,3,aw.FLOAT,!1,0,0));y.tangent>=0&&(aw.bindBuffer(aw.ARRAY_BUFFER,t.__webglTangentBuffer),aw.vertexAttribPointer(y.tangent,4,aw.FLOAT,!1,0,0));y.uv>=0&&(t.__webglUVBuffer?(aw.bindBuffer(aw.ARRAY_BUFFER,t.__webglUVBuffer),aw.vertexAttribPointer(y.uv,2,aw.FLOAT,!1,0,0),aw.enableVertexAttribArray(y.uv)):aw.disableVertexAttribArray(y.uv));y.uv2>=0&&(t.__webglUV2Buffer?(aw.bindBuffer(aw.ARRAY_BUFFER,t.__webglUV2Buffer),aw.vertexAttribPointer(y.uv2,2,aw.FLOAT,!1,0,0),aw.enableVertexAttribArray(y.uv2)):aw.disableVertexAttribArray(y.uv2));w.skinning&&y.skinVertexA>=0&&y.skinVertexB>=0&&y.skinIndex>=0&&y.skinWeight>=0&&(aw.bindBuffer(aw.ARRAY_BUFFER,t.__webglSkinVertexABuffer),aw.vertexAttribPointer(y.skinVertexA,4,aw.FLOAT,!1,0,0),aw.bindBuffer(aw.ARRAY_BUFFER,t.__webglSkinVertexBBuffer),aw.vertexAttribPointer(y.skinVertexB,4,aw.FLOAT,!1,0,0),aw.bindBuffer(aw.ARRAY_BUFFER,t.__webglSkinIndicesBuffer),aw.vertexAttribPointer(y.skinIndex,4,aw.FLOAT,!1,0,0),aw.bindBuffer(aw.ARRAY_BUFFER,t.__webglSkinWeightsBuffer),aw.vertexAttribPointer(y.skinWeight,4,aw.FLOAT,!1,0,0))}u instanceof b.Mesh?(w.wireframe?(w=w.wireframeLinewidth,w!==bf&&(aw.lineWidth(w),bf=w),A&&aw.bindBuffer(aw.ELEMENT_ARRAY_BUFFER,t.__webglLineBuffer),aw.drawElements(aw.LINES,t.__webglLineCount,aw.UNSIGNED_SHORT,0)):(A&&aw.bindBuffer(aw.ELEMENT_ARRAY_BUFFER,t.__webglFaceBuffer),aw.drawElements(aw.TRIANGLES,t.__webglFaceCount,aw.UNSIGNED_SHORT,0)),aM.info.render.calls++,aM.info.render.vertices+=t.__webglFaceCount,aM.info.render.faces+=t.__webglFaceCount/3):u instanceof b.Line?(u=u.type===b.LineStrip?aw.LINE_STRIP:aw.LINES,w=w.linewidth,w!==bf&&(aw.lineWidth(w),bf=w),aw.drawArrays(u,0,t.__webglLineCount),aM.info.render.calls++):u instanceof b.ParticleSystem?(aw.drawArrays(aw.POINTS,0,t.__webglParticleCount),aM.info.render.calls++):u instanceof b.Ribbon&&(aw.drawArrays(aw.TRIANGLE_STRIP,0,t.__webglVertexCount),aM.info.render.calls++)}}function au(d){a1[0].set(d.n41-d.n11,d.n42-d.n12,d.n43-d.n13,d.n44-d.n14);a1[1].set(d.n41+d.n11,d.n42+d.n12,d.n43+d.n13,d.n44+d.n14);a1[2].set(d.n41+d.n21,d.n42+d.n22,d.n43+d.n23,d.n44+d.n24);a1[3].set(d.n41-d.n21,d.n42-d.n22,d.n43-d.n23,d.n44-d.n24);a1[4].set(d.n41-d.n31,d.n42-d.n32,d.n43-d.n33,d.n44-d.n34);a1[5].set(d.n41+d.n31,d.n42+d.n32,d.n43+d.n33,d.n44+d.n34);for(var c,d=0;d<6;d++){c=a1[d],c.divideScalar(Math.sqrt(c.x*c.x+c.y*c.y+c.z*c.z))}}function av(f){for(var e=f.matrixWorld,h=-f.geometry.boundingSphere.radius*Math.max(f.scale.x,Math.max(f.scale.y,f.scale.z)),g=0;g<6;g++){if(f=a1[g].x*e.n14+a1[g].y*e.n24+a1[g].z*e.n34+a1[g].w,f<=h){return !1}}return !0}function ap(d,c){return c.z-d.z}function ao(v){var u,t,s,l,q,r,k,j,i=0,h=v.lights;aK||(aK=new b.PerspectiveCamera(aM.shadowCameraFov,aM.shadowMapWidth/aM.shadowMapHeight,aM.shadowCameraNear,aM.shadowCameraFar));u=0;for(t=h.length;u<t;u++){if(j=h[u],j.castShadow&&j instanceof b.SpotLight){be=-1;aM.shadowMap[i]||(aM.shadowMap[i]=new b.WebGLRenderTarget(aM.shadowMapWidth,aM.shadowMapHeight,{minFilter:b.LinearFilter,magFilter:b.LinearFilter,format:b.RGBAFormat}),z[i]=new b.Matrix4);s=aM.shadowMap[i];l=z[i];aK.position.copy(j.position);aK.lookAt(j.target.position);aK.parent==null&&(console.warn("Camera is not on the Scene. Adding it..."),v.add(aK),this.autoUpdateScene&&v.updateMatrixWorld());aK.matrixWorldInverse.getInverse(aK.matrixWorld);l.set(0.5,0,0,0.5,0,0.5,0,0.5,0,0,0.5,0.5,0,0,0,1);l.multiplySelf(aK.projectionMatrix);l.multiplySelf(aK.matrixWorldInverse);aK.matrixWorldInverse.flattenToArray(bl);aK.projectionMatrix.flattenToArray(ar);aW.multiply(aK.projectionMatrix,aK.matrixWorldInverse);au(aW);aO(s);aw.clearColor(1,1,1,1);aM.clear();aw.clearColor(aX.r,aX.g,aX.b,aQ);l=v.__webglObjects.length;for(s=0;s<l;s++){if(r=v.__webglObjects[s],j=r.object,r.render=!1,j.visible&&j.castShadow&&(!(j instanceof b.Mesh)||!j.frustumCulled||av(j))){j.matrixWorld.flattenToArray(j._objectMatrixArray),a8(j,aK,!1),r.render=!0}}a9(!0);ai(b.NormalBlending);for(s=0;s<l;s++){if(r=v.__webglObjects[s],r.render){j=r.object,r=r.buffer,a5(j),k=j.customDepthMaterial?j.customDepthMaterial:j.geometry.morphTargets.length?bb:ae,ax(aK,h,null,k,r,j)}}l=v.__webglObjectsImmediate.length;for(s=0;s<l;s++){r=v.__webglObjectsImmediate[s],j=r.object,j.visible&&j.castShadow&&(j.matrixAutoUpdate&&j.matrixWorld.flattenToArray(j._objectMatrixArray),bh=-1,a8(j,aK,!1),a5(j),q=aj(aK,h,null,ae,j),j.immediateRenderCallback?j.immediateRenderCallback(q,aw,a1):j.render(function(c){ay(c,q,ae.shading)}))}i++}}}function at(A,y,x,w,t,u,v,s){var r,o,i,p;y?(o=A.length-1,p=y=-1):(o=0,y=A.length,p=1);for(var q=o;q!==y;q+=p){if(r=A[q],r.render){o=r.object;i=r.buffer;if(s){r=s}else{r=r[x];if(!r){continue}v&&ai(r.blending);a9(r.depthTest);ag(r.depthWrite);af(r.polygonOffset,r.polygonOffsetFactor,r.polygonOffsetUnits)}a5(o);ax(w,t,u,r,i,o)}}}function am(A,y,x,w,t,u,v){for(var s,p,j,q,r=0,h=A.length;r<h;r++){if(s=A[r],p=s.object,p.visible){bh=-1;if(v){j=v}else{j=s[y];if(!j){continue}u&&ai(j.blending);a9(j.depthTest);ag(j.depthWrite);af(j.polygonOffset,j.polygonOffsetFactor,j.polygonOffsetUnits)}a5(p);q=aj(x,w,t,j,p);p.immediateRenderCallback?p.immediateRenderCallback(q,aw,a1):p.render(function(c){ay(c,q,j.shading)})}}}function aq(e,d,f){e.push({buffer:d,object:f,opaque:null,transparent:null})}function an(d){for(var c in d.attributes){if(d.attributes[c].needsUpdate){return !0}}return !1}function ak(d){for(var c in d.attributes){d.attributes[c].needsUpdate=!1}}function ah(e,d){for(var f=e.length-1;f>=0;f--){e[f].object===d&&e.splice(f,1)}}function aj(Y,X,W,V,S){V.program||aM.initMaterial(V,X,W,S);if(V.morphTargets&&!S.__webglMorphTargetInfluences){S.__webglMorphTargetInfluences=new Float32Array(aM.maxMorphTargets);for(var T=0,U=aM.maxMorphTargets;T<U;T++){S.__webglMorphTargetInfluences[T]=0}}var R=!1,T=V.program,U=T.uniforms,P=V.uniforms;T!==aN&&(aw.useProgram(T),aN=T,R=!0);if(V.id!==be){be=V.id,R=!0}if(R){aw.uniformMatrix4fv(U.projectionMatrix,!1,ar);if(W&&V.fog){if(P.fogColor.value=W.color,W instanceof b.Fog){P.fogNear.value=W.near,P.fogFar.value=W.far}else{if(W instanceof b.FogExp2){P.fogDensity.value=W.density}}}if(V instanceof b.MeshPhongMaterial||V instanceof b.MeshLambertMaterial||V.lights){for(var M,K,N=0,O=0,I=0,H,x,G,F=bj,E=F.directional.colors,s=F.directional.positions,j=F.point.colors,A=F.point.positions,B=F.point.distances,y=0,v=0,W=M=G=0,R=X.length;W<R;W++){if(M=X[W],K=M.color,H=M.position,x=M.intensity,G=M.distance,M instanceof b.AmbientLight){aM.gammaInput?(N+=K.r*K.r,O+=K.g*K.g,I+=K.b*K.b):(N+=K.r,O+=K.g,I+=K.b)}else{if(M instanceof b.DirectionalLight){G=y*3,aM.gammaInput?(E[G]=K.r*K.r*x*x,E[G+1]=K.g*K.g*x*x,E[G+2]=K.b*K.b*x*x):(E[G]=K.r*x,E[G+1]=K.g*x,E[G+2]=K.b*x),s[G]=H.x,s[G+1]=H.y,s[G+2]=H.z,y+=1}else{if(M instanceof b.SpotLight){G=y*3,aM.gammaInput?(E[G]=K.r*K.r*x*x,E[G+1]=K.g*K.g*x*x,E[G+2]=K.b*K.b*x*x):(E[G]=K.r*x,E[G+1]=K.g*x,E[G+2]=K.b*x),K=1/H.length(),s[G]=H.x*K,s[G+1]=H.y*K,s[G+2]=H.z*K,y+=1}else{if(M instanceof b.PointLight){M=v*3,aM.gammaInput?(j[M]=K.r*K.r*x*x,j[M+1]=K.g*K.g*x*x,j[M+2]=K.b*K.b*x*x):(j[M]=K.r*x,j[M+1]=K.g*x,j[M+2]=K.b*x),A[M]=H.x,A[M+1]=H.y,A[M+2]=H.z,B[v]=G,v+=1}}}}}W=y*3;for(R=E.length;W<R;W++){E[W]=0}W=v*3;for(R=j.length;W<R;W++){j[W]=0}F.point.length=v;F.directional.length=y;F.ambient[0]=N;F.ambient[1]=O;F.ambient[2]=I;X=bj;P.ambientLightColor.value=X.ambient;P.directionalLightColor.value=X.directional.colors;P.directionalLightDirection.value=X.directional.positions;P.pointLightColor.value=X.point.colors;P.pointLightPosition.value=X.point.positions;P.pointLightDistance.value=X.point.distances}if(V instanceof b.MeshBasicMaterial||V instanceof b.MeshLambertMaterial||V instanceof b.MeshPhongMaterial){P.opacity.value=V.opacity,aM.gammaInput?P.diffuse.value.copyGammaToLinear(V.color):P.diffuse.value=V.color,(P.map.texture=V.map)&&P.offsetRepeat.value.set(V.map.offset.x,V.map.offset.y,V.map.repeat.x,V.map.repeat.y),P.lightMap.texture=V.lightMap,P.envMap.texture=V.envMap,P.flipEnvMap.value=V.envMap instanceof b.WebGLRenderTargetCube?1:-1,P.reflectivity.value=V.reflectivity,P.refractionRatio.value=V.refractionRatio,P.combine.value=V.combine,P.useRefract.value=V.envMap&&V.envMap.mapping instanceof b.CubeRefractionMapping}if(V instanceof b.LineBasicMaterial){P.diffuse.value=V.color,P.opacity.value=V.opacity}else{if(V instanceof b.ParticleBasicMaterial){P.psColor.value=V.color,P.opacity.value=V.opacity,P.size.value=V.size,P.scale.value=aV.height/2,P.map.texture=V.map}else{if(V instanceof b.MeshPhongMaterial){P.shininess.value=V.shininess,aM.gammaInput?(P.ambient.value.copyGammaToLinear(V.ambient),P.specular.value.copyGammaToLinear(V.specular)):(P.ambient.value=V.ambient,P.specular.value=V.specular)}else{if(V instanceof b.MeshLambertMaterial){aM.gammaInput?P.ambient.value.copyGammaToLinear(V.ambient):P.ambient.value=V.ambient}else{if(V instanceof b.MeshDepthMaterial){P.mNear.value=Y.near,P.mFar.value=Y.far,P.opacity.value=V.opacity}else{if(V instanceof b.MeshNormalMaterial){P.opacity.value=V.opacity}}}}}}if(S.receiveShadow&&!V._shadowPass&&P.shadowMatrix){for(X=0;X<z.length;X++){P.shadowMatrix.value[X]=z[X],P.shadowMap.texture[X]=aM.shadowMap[X]}P.shadowDarkness.value=aM.shadowMapDarkness;P.shadowBias.value=aM.shadowMapBias}X=V.uniformsList;P=0;for(W=X.length;P<W;P++){if(O=T.uniforms[X[P][1]]){if(N=X[P][0],I=N.type,R=N.value,I==="i"){aw.uniform1i(O,R)}else{if(I==="f"){aw.uniform1f(O,R)}else{if(I==="v2"){aw.uniform2f(O,R.x,R.y)}else{if(I==="v3"){aw.uniform3f(O,R.x,R.y,R.z)}else{if(I==="v4"){aw.uniform4f(O,R.x,R.y,R.z,R.w)}else{if(I==="c"){aw.uniform3f(O,R.r,R.g,R.b)}else{if(I==="fv1"){aw.uniform1fv(O,R)}else{if(I==="fv"){aw.uniform3fv(O,R)}else{if(I==="v3v"){if(!N._array){N._array=new Float32Array(3*R.length)}I=0;for(H=R.length;I<H;I++){F=I*3,N._array[F]=R[I].x,N._array[F+1]=R[I].y,N._array[F+2]=R[I].z}aw.uniform3fv(O,N._array)}else{if(I==="m4"){if(!N._array){N._array=new Float32Array(16)}R.flattenToArray(N._array);aw.uniformMatrix4fv(O,!1,N._array)}else{if(I==="m4v"){if(!N._array){N._array=new Float32Array(16*R.length)}I=0;for(H=R.length;I<H;I++){R[I].flattenToArrayOffset(N._array,I*16)}aw.uniformMatrix4fv(O,!1,N._array)}else{if(I==="t"){if(aw.uniform1i(O,R),O=N.texture){if(O.image instanceof Array&&O.image.length===6){if(N=O,N.image.length===6){if(N.needsUpdate){if(!N.image.__webglTextureCube){N.image.__webglTextureCube=aw.createTexture()}aw.activeTexture(aw.TEXTURE0+R);aw.bindTexture(aw.TEXTURE_CUBE_MAP,N.image.__webglTextureCube);R=al(aw.TEXTURE_CUBE_MAP,N,N.image[0]);for(O=0;O<6;O++){aw.texImage2D(aw.TEXTURE_CUBE_MAP_POSITIVE_X+O,0,aw.RGBA,aw.RGBA,aw.UNSIGNED_BYTE,N.image[O])}R&&aw.generateMipmap(aw.TEXTURE_CUBE_MAP);N.needsUpdate=!1}else{aw.activeTexture(aw.TEXTURE0+R),aw.bindTexture(aw.TEXTURE_CUBE_MAP,N.image.__webglTextureCube)}}}else{O instanceof b.WebGLRenderTargetCube?(N=O,aw.activeTexture(aw.TEXTURE0+R),aw.bindTexture(aw.TEXTURE_CUBE_MAP,N.__webglTexture)):a6(O,R)}}}else{if(I==="tv"){if(!N._array){N._array=[];I=0;for(H=N.texture.length;I<H;I++){N._array[I]=R+I}}aw.uniform1iv(O,N._array);I=0;for(H=N.texture.length;I<H;I++){(O=N.texture[I])&&a6(O,N._array[I])}}}}}}}}}}}}}}}}(V instanceof b.ShaderMaterial||V instanceof b.MeshPhongMaterial||V.envMap)&&U.cameraPosition!==null&&aw.uniform3f(U.cameraPosition,Y.position.x,Y.position.y,Y.position.z);(V instanceof b.MeshPhongMaterial||V instanceof b.MeshLambertMaterial||V instanceof b.ShaderMaterial||V.skinning)&&U.viewMatrix!==null&&aw.uniformMatrix4fv(U.viewMatrix,!1,bl);V.skinning&&(aw.uniformMatrix4fv(U.cameraInverseMatrix,!1,bl),aw.uniformMatrix4fv(U.boneGlobalMatrices,!1,S.boneMatrices))}aw.uniformMatrix4fv(U.modelViewMatrix,!1,S._modelViewMatrixArray);U.normalMatrix&&aw.uniformMatrix3fv(U.normalMatrix,!1,S._normalMatrixArray);(V instanceof b.ShaderMaterial||V.envMap||V.skinning||S.receiveShadow)&&U.objectMatrix!==null&&aw.uniformMatrix4fv(U.objectMatrix,!1,S._objectMatrixArray);return T}function a8(e,d,f){e._modelViewMatrix.multiplyToArray(d.matrixWorldInverse,e.matrixWorld,e._modelViewMatrixArray);f&&b.Matrix4.makeInvert3x3(e._modelViewMatrix).transposeIntoArray(e._normalMatrixArray)}function a5(c){if(bm!==c.doubleSided){c.doubleSided?aw.disable(aw.CULL_FACE):aw.enable(aw.CULL_FACE),bm=c.doubleSided}if(D!==c.flipSided){c.flipSided?aw.frontFace(aw.CW):aw.frontFace(aw.CCW),D=c.flipSided}}function a9(c){aE!==c&&(c?aw.enable(aw.DEPTH_TEST):aw.disable(aw.DEPTH_TEST),aE=c)}function ag(c){ad!==c&&(aw.depthMask(c),ad=c)}function af(e,d,f){az!==e&&(e?aw.enable(aw.POLYGON_OFFSET_FILL):aw.disable(aw.POLYGON_OFFSET_FILL),az=e);if(e&&(bc!==d||bk!==f)){aw.polygonOffset(d,f),bc=d,bk=f}}function ai(c){if(c!==a7){switch(c){case b.AdditiveBlending:aw.blendEquation(aw.FUNC_ADD);aw.blendFunc(aw.SRC_ALPHA,aw.ONE);break;case b.SubtractiveBlending:aw.blendEquation(aw.FUNC_ADD);aw.blendFunc(aw.ZERO,aw.ONE_MINUS_SRC_COLOR);break;case b.MultiplyBlending:aw.blendEquation(aw.FUNC_ADD);aw.blendFunc(aw.ZERO,aw.SRC_COLOR);break;default:aw.blendEquationSeparate(aw.FUNC_ADD,aw.FUNC_ADD),aw.blendFuncSeparate(aw.SRC_ALPHA,aw.ONE_MINUS_SRC_ALPHA,aw.ONE,aw.ONE_MINUS_SRC_ALPHA)}a7=c}}function a0(e,d){var f;e==="fragment"?f=aw.createShader(aw.FRAGMENT_SHADER):e==="vertex"&&(f=aw.createShader(aw.VERTEX_SHADER));aw.shaderSource(f,d);aw.compileShader(f);if(!aw.getShaderParameter(f,aw.COMPILE_STATUS)){return console.error(aw.getShaderInfoLog(f)),console.error(d),null}return f}function al(e,d,f){return(f.width&f.width-1)===0&&(f.height&f.height-1)===0?(aw.texParameteri(e,aw.TEXTURE_WRAP_S,aT(d.wrapS)),aw.texParameteri(e,aw.TEXTURE_WRAP_T,aT(d.wrapT)),aw.texParameteri(e,aw.TEXTURE_MAG_FILTER,aT(d.magFilter)),aw.texParameteri(e,aw.TEXTURE_MIN_FILTER,aT(d.minFilter)),!0):(aw.texParameteri(e,aw.TEXTURE_WRAP_S,aw.CLAMP_TO_EDGE),aw.texParameteri(e,aw.TEXTURE_WRAP_T,aw.CLAMP_TO_EDGE),aw.texParameteri(e,aw.TEXTURE_MAG_FILTER,aZ(d.magFilter)),aw.texParameteri(e,aw.TEXTURE_MIN_FILTER,aZ(d.minFilter)),!1)}function a6(e,d){if(e.needsUpdate){if(!e.__webglInit){e.__webglInit=!0,e.__webglTexture=aw.createTexture(),aM.info.memory.textures++}aw.activeTexture(aw.TEXTURE0+d);aw.bindTexture(aw.TEXTURE_2D,e.__webglTexture);var f=al(aw.TEXTURE_2D,e,e.image);e instanceof b.DataTexture?aw.texImage2D(aw.TEXTURE_2D,0,aT(e.format),e.image.width,e.image.height,0,aT(e.format),aw.UNSIGNED_BYTE,e.image.data):aw.texImage2D(aw.TEXTURE_2D,0,aw.RGBA,aw.RGBA,aw.UNSIGNED_BYTE,e.image);f&&aw.generateMipmap(aw.TEXTURE_2D);e.needsUpdate=!1;if(e.onUpdated){e.onUpdated()}}else{aw.activeTexture(aw.TEXTURE0+d),aw.bindTexture(aw.TEXTURE_2D,e.__webglTexture)}}function aR(d,c){aw.bindRenderbuffer(aw.RENDERBUFFER,d);c.depthBuffer&&!c.stencilBuffer?(aw.renderbufferStorage(aw.RENDERBUFFER,aw.DEPTH_COMPONENT16,c.width,c.height),aw.framebufferRenderbuffer(aw.FRAMEBUFFER,aw.DEPTH_ATTACHMENT,aw.RENDERBUFFER,d)):c.depthBuffer&&c.stencilBuffer?(aw.renderbufferStorage(aw.RENDERBUFFER,aw.DEPTH_STENCIL,c.width,c.height),aw.framebufferRenderbuffer(aw.FRAMEBUFFER,aw.DEPTH_STENCIL_ATTACHMENT,aw.RENDERBUFFER,d)):aw.renderbufferStorage(aw.RENDERBUFFER,aw.RGBA4,c.width,c.height)}function aO(f){var e=f instanceof b.WebGLRenderTargetCube;if(f&&!f.__webglFramebuffer){if(f.depthBuffer===void 0){f.depthBuffer=!0}if(f.stencilBuffer===void 0){f.stencilBuffer=!0}f.__webglTexture=aw.createTexture();if(e){f.__webglFramebuffer=[];f.__webglRenderbuffer=[];aw.bindTexture(aw.TEXTURE_CUBE_MAP,f.__webglTexture);al(aw.TEXTURE_CUBE_MAP,f,f);for(var j=0;j<6;j++){f.__webglFramebuffer[j]=aw.createFramebuffer();f.__webglRenderbuffer[j]=aw.createRenderbuffer();aw.texImage2D(aw.TEXTURE_CUBE_MAP_POSITIVE_X+j,0,aT(f.format),f.width,f.height,0,aT(f.format),aT(f.type),null);var i=f,h=aw.TEXTURE_CUBE_MAP_POSITIVE_X+j;aw.bindFramebuffer(aw.FRAMEBUFFER,f.__webglFramebuffer[j]);aw.framebufferTexture2D(aw.FRAMEBUFFER,aw.COLOR_ATTACHMENT0,h,i.__webglTexture,0);aR(f.__webglRenderbuffer[j],f)}}else{f.__webglFramebuffer=aw.createFramebuffer(),f.__webglRenderbuffer=aw.createRenderbuffer(),aw.bindTexture(aw.TEXTURE_2D,f.__webglTexture),al(aw.TEXTURE_2D,f,f),aw.texImage2D(aw.TEXTURE_2D,0,aT(f.format),f.width,f.height,0,aT(f.format),aT(f.type),null),j=aw.TEXTURE_2D,aw.bindFramebuffer(aw.FRAMEBUFFER,f.__webglFramebuffer),aw.framebufferTexture2D(aw.FRAMEBUFFER,aw.COLOR_ATTACHMENT0,j,f.__webglTexture,0),aR(f.__webglRenderbuffer,f)}e?aw.bindTexture(aw.TEXTURE_CUBE_MAP,null):aw.bindTexture(aw.TEXTURE_2D,null);aw.bindRenderbuffer(aw.RENDERBUFFER,null);aw.bindFramebuffer(aw.FRAMEBUFFER,null)}f?(e=e?f.__webglFramebuffer[f.activeCubeFace]:f.__webglFramebuffer,j=f.width,f=f.height,h=i=0):(e=null,j=aS,f=C,i=aY,h=aJ);e!==ac&&(aw.bindFramebuffer(aw.FRAMEBUFFER,e),aw.viewport(i,h,j,f),ac=e)}function aZ(c){switch(c){case b.NearestFilter:case b.NearestMipMapNearestFilter:case b.NearestMipMapLinearFilter:return aw.NEAREST;default:return aw.LINEAR}}function aT(c){switch(c){case b.RepeatWrapping:return aw.REPEAT;case b.ClampToEdgeWrapping:return aw.CLAMP_TO_EDGE;case b.MirroredRepeatWrapping:return aw.MIRRORED_REPEAT;case b.NearestFilter:return aw.NEAREST;case b.NearestMipMapNearestFilter:return aw.NEAREST_MIPMAP_NEAREST;case b.NearestMipMapLinearFilter:return aw.NEAREST_MIPMAP_LINEAR;case b.LinearFilter:return aw.LINEAR;case b.LinearMipMapNearestFilter:return aw.LINEAR_MIPMAP_NEAREST;case b.LinearMipMapLinearFilter:return aw.LINEAR_MIPMAP_LINEAR;case b.ByteType:return aw.BYTE;case b.UnsignedByteType:return aw.UNSIGNED_BYTE;case b.ShortType:return aw.SHORT;case b.UnsignedShortType:return aw.UNSIGNED_SHORT;case b.IntType:return aw.INT;case b.UnsignedShortType:return aw.UNSIGNED_INT;case b.FloatType:return aw.FLOAT;case b.AlphaFormat:return aw.ALPHA;case b.RGBFormat:return aw.RGB;case b.RGBAFormat:return aw.RGBA;case b.LuminanceFormat:return aw.LUMINANCE;case b.LuminanceAlphaFormat:return aw.LUMINANCE_ALPHA}return 0}var aH=aH||{},aV=aH.canvas!==void 0?aH.canvas:document.createElement("canvas"),bd=aH.precision!==void 0?aH.precision:"highp",a3=aH.antialias!==void 0?aH.antialias:!1,a4=aH.stencil!==void 0?aH.stencil:!0,a2=aH.preserveDrawingBuffer!==void 0?aH.preserveDrawingBuffer:!1,aX=aH.clearColor!==void 0?new b.Color(aH.clearColor):new b.Color(0),aQ=aH.clearAlpha!==void 0?aH.clearAlpha:0,aU=aH.maxLights!==void 0?aH.maxLights:4;this.domElement=aV;this.context=null;this.autoUpdateScene=this.autoUpdateObjects=this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0;this.physicallyBasedShading=this.gammaOutput=this.gammaInput=!1;this.shadowMapBias=0.0039;this.shadowMapDarkness=0.5;this.shadowMapHeight=this.shadowMapWidth=512;this.shadowCameraNear=1;this.shadowCameraFar=5000;this.shadowCameraFov=50;this.shadowMap=[];this.shadowMapEnabled=!1;this.shadowMapSoft=this.shadowMapAutoUpdate=!0;this.maxMorphTargets=8;this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0}};var aM=this,aw,aL=[],aN=null,ac=null,be=-1,bh=null,aI=0,bm=null,D=null,a7=null,aE=null,ad=null,az=null,bc=null,bk=null,bf=null,aY=0,aJ=0,aS=0,C=0,a1=[new b.Vector4,new b.Vector4,new b.Vector4,new b.Vector4,new b.Vector4,new b.Vector4],aW=new b.Matrix4,ar=new Float32Array(16),bl=new Float32Array(16),bg=new b.Vector4,bj={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]}},aK,z=[],ae,bb,aP={},ab=!1;aw=function(){var d;try{if(!(d=aV.getContext("experimental-webgl",{antialias:a3,stencil:a4,preserveDrawingBuffer:a2}))){throw"Error creating WebGL context."}console.log(navigator.userAgent+" | "+d.getParameter(d.VERSION)+" | "+d.getParameter(d.VENDOR)+" | "+d.getParameter(d.RENDERER)+" | "+d.getParameter(d.SHADING_LANGUAGE_VERSION))}catch(c){console.error(c)}return d}();aw.clearColor(0,0,0,1);aw.clearDepth(1);aw.clearStencil(0);aw.enable(aw.DEPTH_TEST);aw.depthFunc(aw.LEQUAL);aw.frontFace(aw.CCW);aw.cullFace(aw.BACK);aw.enable(aw.CULL_FACE);aw.enable(aw.BLEND);aw.blendEquation(aw.FUNC_ADD);aw.blendFunc(aw.SRC_ALPHA,aw.ONE_MINUS_SRC_ALPHA);aw.clearColor(aX.r,aX.g,aX.b,aQ);(function(){aP.vertices=new Float32Array(16);aP.faces=new Uint16Array(6);var c=0;aP.vertices[c++]=-1;aP.vertices[c++]=-1;aP.vertices[c++]=0;aP.vertices[c++]=1;aP.vertices[c++]=1;aP.vertices[c++]=-1;aP.vertices[c++]=1;aP.vertices[c++]=1;aP.vertices[c++]=1;aP.vertices[c++]=1;aP.vertices[c++]=1;aP.vertices[c++]=0;aP.vertices[c++]=-1;aP.vertices[c++]=1;aP.vertices[c++]=0;c=aP.vertices[c++]=0;aP.faces[c++]=0;aP.faces[c++]=1;aP.faces[c++]=2;aP.faces[c++]=0;aP.faces[c++]=2;aP.faces[c++]=3;aP.vertexBuffer=aw.createBuffer();aP.elementBuffer=aw.createBuffer();aw.bindBuffer(aw.ARRAY_BUFFER,aP.vertexBuffer);aw.bufferData(aw.ARRAY_BUFFER,aP.vertices,aw.STATIC_DRAW);aw.bindBuffer(aw.ELEMENT_ARRAY_BUFFER,aP.elementBuffer);aw.bufferData(aw.ELEMENT_ARRAY_BUFFER,aP.faces,aw.STATIC_DRAW);aP.program=aw.createProgram();aw.attachShader(aP.program,a0("fragment",b.ShaderLib.sprite.fragmentShader));aw.attachShader(aP.program,a0("vertex",b.ShaderLib.sprite.vertexShader));aw.linkProgram(aP.program);aP.attributes={};aP.uniforms={};aP.attributes.position=aw.getAttribLocation(aP.program,"position");aP.attributes.uv=aw.getAttribLocation(aP.program,"uv");aP.uniforms.uvOffset=aw.getUniformLocation(aP.program,"uvOffset");aP.uniforms.uvScale=aw.getUniformLocation(aP.program,"uvScale");aP.uniforms.rotation=aw.getUniformLocation(aP.program,"rotation");aP.uniforms.scale=aw.getUniformLocation(aP.program,"scale");aP.uniforms.alignment=aw.getUniformLocation(aP.program,"alignment");aP.uniforms.color=aw.getUniformLocation(aP.program,"color");aP.uniforms.map=aw.getUniformLocation(aP.program,"map");aP.uniforms.opacity=aw.getUniformLocation(aP.program,"opacity");aP.uniforms.useScreenCoordinates=aw.getUniformLocation(aP.program,"useScreenCoordinates");aP.uniforms.affectedByDistance=aw.getUniformLocation(aP.program,"affectedByDistance");aP.uniforms.screenPosition=aw.getUniformLocation(aP.program,"screenPosition");aP.uniforms.modelViewMatrix=aw.getUniformLocation(aP.program,"modelViewMatrix");aP.uniforms.projectionMatrix=aw.getUniformLocation(aP.program,"projectionMatrix")})();(function(){var d=b.ShaderLib.depthRGBA,c=b.UniformsUtils.clone(d.uniforms);ae=new b.ShaderMaterial({fragmentShader:d.fragmentShader,vertexShader:d.vertexShader,uniforms:c});bb=new b.ShaderMaterial({fragmentShader:d.fragmentShader,vertexShader:d.vertexShader,uniforms:c,morphTargets:!0});ae._shadowPass=!0;bb._shadowPass=!0})();this.context=aw;var bi=aw.getParameter(aw.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;this.getContext=function(){return aw};this.supportsVertexTextures=function(){return bi};this.setSize=function(d,c){aV.width=d;aV.height=c;this.setViewport(0,0,aV.width,aV.height)};this.setViewport=function(f,e,h,g){aY=f;aJ=e;aS=h;C=g;aw.viewport(aY,aJ,aS,C)};this.setScissor=function(f,e,h,g){aw.scissor(f,e,h,g)};this.enableScissorTest=function(c){c?aw.enable(aw.SCISSOR_TEST):aw.disable(aw.SCISSOR_TEST)};this.setClearColorHex=function(d,c){aX.setHex(d);aQ=c;aw.clearColor(aX.r,aX.g,aX.b,aQ)};this.setClearColor=function(d,c){aX.copy(d);aQ=c;aw.clearColor(aX.r,aX.g,aX.b,aQ)};this.getClearColor=function(){return aX};this.getClearAlpha=function(){return aQ};this.clear=function(f,e,h){var g=0;if(f===void 0||f){g|=aw.COLOR_BUFFER_BIT}if(e===void 0||e){g|=aw.DEPTH_BUFFER_BIT}if(h===void 0||h){g|=aw.STENCIL_BUFFER_BIT}aw.clear(g)};this.clearTarget=function(f,e,h,g){aO(f);this.clear(e,h,g)};this.deallocateObject=function(f){if(f.__webglInit){if(f.__webglInit=!1,delete f._modelViewMatrix,delete f._normalMatrixArray,delete f._modelViewMatrixArray,delete f._objectMatrixArray,f instanceof b.Mesh){for(var e in f.geometry.geometryGroups){var j=f.geometry.geometryGroups[e];aw.deleteBuffer(j.__webglVertexBuffer);aw.deleteBuffer(j.__webglNormalBuffer);aw.deleteBuffer(j.__webglTangentBuffer);aw.deleteBuffer(j.__webglColorBuffer);aw.deleteBuffer(j.__webglUVBuffer);aw.deleteBuffer(j.__webglUV2Buffer);aw.deleteBuffer(j.__webglSkinVertexABuffer);aw.deleteBuffer(j.__webglSkinVertexBBuffer);aw.deleteBuffer(j.__webglSkinIndicesBuffer);aw.deleteBuffer(j.__webglSkinWeightsBuffer);aw.deleteBuffer(j.__webglFaceBuffer);aw.deleteBuffer(j.__webglLineBuffer);if(j.numMorphTargets){for(var i=0,h=j.numMorphTargets;i<h;i++){aw.deleteBuffer(j.__webglMorphTargetsBuffers[i])}}if(j.__webglCustomAttributesList){for(i in i=void 0,j.__webglCustomAttributesList){aw.deleteBuffer(j.__webglCustomAttributesList[i].buffer)}}aM.info.memory.geometries--}}else{if(f instanceof b.Ribbon){f=f.geometry,aw.deleteBuffer(f.__webglVertexBuffer),aw.deleteBuffer(f.__webglColorBuffer),aM.info.memory.geometries--}else{if(f instanceof b.Line){f=f.geometry,aw.deleteBuffer(f.__webglVertexBuffer),aw.deleteBuffer(f.__webglColorBuffer),aM.info.memory.geometries--}else{if(f instanceof b.ParticleSystem){f=f.geometry,aw.deleteBuffer(f.__webglVertexBuffer),aw.deleteBuffer(f.__webglColorBuffer),aM.info.memory.geometries--}}}}}};this.deallocateTexture=function(c){if(c.__webglInit){c.__webglInit=!1,aw.deleteTexture(c.__webglTexture),aM.info.memory.textures--}};this.updateShadowMap=function(d,c){ao(d,c)};this.render=function(y,x,w,u){var p,r,s,o,m=y.lights,l=y.fog;be=-1;this.autoUpdateObjects&&this.initWebGLObjects(y);x.parent===void 0&&(console.warn("DEPRECATED: Camera hasn't been added to a Scene. Adding it..."),y.add(x));this.autoUpdateScene&&y.updateMatrixWorld();this.shadowMapEnabled&&this.shadowMapAutoUpdate&&ao(y,x);aM.info.render.calls=0;aM.info.render.vertices=0;aM.info.render.faces=0;x.matrixWorldInverse.getInverse(x.matrixWorld);x.matrixWorldInverse.flattenToArray(bl);x.projectionMatrix.flattenToArray(ar);aW.multiply(x.projectionMatrix,x.matrixWorldInverse);au(aW);aO(w);(this.autoClear||u)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);o=y.__webglObjects;u=0;for(p=o.length;u<p;u++){if(r=o[u],s=r.object,r.render=!1,s.visible&&(!(s instanceof b.Mesh)||!s.frustumCulled||av(s))){s.matrixWorld.flattenToArray(s._objectMatrixArray);a8(s,x,!0);var v=r,k=v.object,A=v.buffer,j=void 0,j=j=void 0,j=k.material;if(j instanceof b.MeshFaceMaterial){if(j=A.materialIndex,j>=0){j=k.geometry.materials[j],j.transparent?(v.transparent=j,v.opaque=null):(v.opaque=j,v.transparent=null)}}else{if(j){j.transparent?(v.transparent=j,v.opaque=null):(v.opaque=j,v.transparent=null)}}r.render=!0;if(this.sortObjects){s.renderDepth?r.z=s.renderDepth:(bg.copy(s.position),aW.multiplyVector3(bg),r.z=bg.z)}}}this.sortObjects&&o.sort(ap);o=y.__webglObjectsImmediate;u=0;for(p=o.length;u<p;u++){if(r=o[u],s=r.object,s.visible){s.matrixAutoUpdate&&s.matrixWorld.flattenToArray(s._objectMatrixArray),a8(s,x,!0),s=r.object.material,s.transparent?(r.transparent=s,r.opaque=null):(r.opaque=s,r.transparent=null)}}y.overrideMaterial?(ai(y.overrideMaterial.blending),a9(y.overrideMaterial.depthTest),ag(y.overrideMaterial.depthWrite),af(y.overrideMaterial.polygonOffset,y.overrideMaterial.polygonOffsetFactor,y.overrideMaterial.polygonOffsetUnits),at(y.__webglObjects,!1,"",x,m,l,!0,y.overrideMaterial),am(y.__webglObjectsImmediate,"",x,m,l,!1,y.overrideMaterial)):(ai(b.NormalBlending),at(y.__webglObjects,!0,"opaque",x,m,l,!1),am(y.__webglObjectsImmediate,"opaque",x,m,l,!1),at(y.__webglObjects,!1,"transparent",x,m,l,!0),am(y.__webglObjectsImmediate,"transparent",x,m,l,!0));if(y.__webglSprites.length){s=aP.attributes;m=aP.uniforms;l=C/aS;u=[];p=aS*0.5;o=C*0.5;r=!0;aw.useProgram(aP.program);aN=aP.program;bh=aE=a7=-1;ab||(aw.enableVertexAttribArray(aP.attributes.position),aw.enableVertexAttribArray(aP.attributes.uv),ab=!0);aw.disable(aw.CULL_FACE);aw.enable(aw.BLEND);aw.depthMask(!0);aw.bindBuffer(aw.ARRAY_BUFFER,aP.vertexBuffer);aw.vertexAttribPointer(s.position,2,aw.FLOAT,!1,16,0);aw.vertexAttribPointer(s.uv,2,aw.FLOAT,!1,16,8);aw.bindBuffer(aw.ELEMENT_ARRAY_BUFFER,aP.elementBuffer);aw.uniformMatrix4fv(m.projectionMatrix,!1,ar);aw.activeTexture(aw.TEXTURE0);aw.uniform1i(m.map,0);s=0;for(v=y.__webglSprites.length;s<v;s++){if(k=y.__webglSprites[s],k.visible&&k.opacity!==0){k.useScreenCoordinates?k.z=-k.position.z:(k._modelViewMatrix.multiplyToArray(x.matrixWorldInverse,k.matrixWorld,k._modelViewMatrixArray),k.z=-k._modelViewMatrix.n34)}}y.__webglSprites.sort(ap);s=0;for(v=y.__webglSprites.length;s<v;s++){k=y.__webglSprites[s],k.visible&&k.opacity!==0&&k.map&&k.map.image&&k.map.image.width&&(k.useScreenCoordinates?(aw.uniform1i(m.useScreenCoordinates,1),aw.uniform3f(m.screenPosition,(k.position.x-p)/p,(o-k.position.y)/o,Math.max(0,Math.min(1,k.position.z)))):(aw.uniform1i(m.useScreenCoordinates,0),aw.uniform1i(m.affectedByDistance,k.affectedByDistance?1:0),aw.uniformMatrix4fv(m.modelViewMatrix,!1,k._modelViewMatrixArray)),x=k.map.image.width/(k.scaleByViewport?C:1),u[0]=x*l*k.scale.x,u[1]=x*k.scale.y,aw.uniform2f(m.uvScale,k.uvScale.x,k.uvScale.y),aw.uniform2f(m.uvOffset,k.uvOffset.x,k.uvOffset.y),aw.uniform2f(m.alignment,k.alignment.x,k.alignment.y),aw.uniform1f(m.opacity,k.opacity),aw.uniform3f(m.color,k.color.r,k.color.g,k.color.b),aw.uniform1f(m.rotation,k.rotation),aw.uniform2fv(m.scale,u),k.mergeWith3D&&!r?(aw.enable(aw.DEPTH_TEST),r=!0):!k.mergeWith3D&&r&&(aw.disable(aw.DEPTH_TEST),r=!1),ai(k.blending),a6(k.map,0),aw.drawElements(aw.TRIANGLES,6,aw.UNSIGNED_SHORT,0))}aw.enable(aw.CULL_FACE);aw.enable(aw.DEPTH_TEST);aw.depthMask(ad)}w&&w.minFilter!==b.NearestFilter&&w.minFilter!==b.LinearFilter&&(w instanceof b.WebGLRenderTargetCube?(aw.bindTexture(aw.TEXTURE_CUBE_MAP,w.__webglTexture),aw.generateMipmap(aw.TEXTURE_CUBE_MAP),aw.bindTexture(aw.TEXTURE_CUBE_MAP,null)):(aw.bindTexture(aw.TEXTURE_2D,w.__webglTexture),aw.generateMipmap(aw.TEXTURE_2D),aw.bindTexture(aw.TEXTURE_2D,null)))};this.initWebGLObjects=function(cc){if(!cc.__webglObjects){cc.__webglObjects=[],cc.__webglObjectsImmediate=[],cc.__webglSprites=[]}for(;cc.__objectsAdded.length;){var cb=cc.__objectsAdded[0],b9=cc,b6=void 0,b7=void 0,b8=void 0;if(!cb.__webglInit){if(cb.__webglInit=!0,cb._modelViewMatrix=new b.Matrix4,cb._normalMatrixArray=new Float32Array(9),cb._modelViewMatrixArray=new Float32Array(16),cb._objectMatrixArray=new Float32Array(16),cb.matrixWorld.flattenToArray(cb._objectMatrixArray),cb instanceof b.Mesh){b7=cb.geometry;if(b7.geometryGroups===void 0){var b8=b7,b5=void 0,b4=void 0,bw=void 0,b2=void 0,br=void 0,e=void 0,b1=void 0,bZ={},by=b8.morphTargets.length;b8.geometryGroups={};b5=0;for(b4=b8.faces.length;b5<b4;b5++){bw=b8.faces[b5],b2=bw.materialIndex,e=b2!==void 0?b2:-1,bZ[e]===void 0&&(bZ[e]={hash:e,counter:0}),b1=bZ[e].hash+"_"+bZ[e].counter,b8.geometryGroups[b1]===void 0&&(b8.geometryGroups[b1]={faces3:[],faces4:[],materialIndex:b2,vertices:0,numMorphTargets:by}),br=bw instanceof b.Face3?3:4,b8.geometryGroups[b1].vertices+br>65535&&(bZ[e].counter+=1,b1=bZ[e].hash+"_"+bZ[e].counter,b8.geometryGroups[b1]===void 0&&(b8.geometryGroups[b1]={faces3:[],faces4:[],materialIndex:b2,vertices:0,numMorphTargets:by})),bw instanceof b.Face3?b8.geometryGroups[b1].faces3.push(b5):b8.geometryGroups[b1].faces4.push(b5),b8.geometryGroups[b1].vertices+=br}b8.geometryGroupsList=[];b5=void 0;for(b5 in b8.geometryGroups){b8.geometryGroups[b5].id=aI++,b8.geometryGroupsList.push(b8.geometryGroups[b5])}}for(b6 in b7.geometryGroups){if(b8=b7.geometryGroups[b6],!b8.__webglVertexBuffer){b5=b8;b5.__webglVertexBuffer=aw.createBuffer();b5.__webglNormalBuffer=aw.createBuffer();b5.__webglTangentBuffer=aw.createBuffer();b5.__webglColorBuffer=aw.createBuffer();b5.__webglUVBuffer=aw.createBuffer();b5.__webglUV2Buffer=aw.createBuffer();b5.__webglSkinVertexABuffer=aw.createBuffer();b5.__webglSkinVertexBBuffer=aw.createBuffer();b5.__webglSkinIndicesBuffer=aw.createBuffer();b5.__webglSkinWeightsBuffer=aw.createBuffer();b5.__webglFaceBuffer=aw.createBuffer();b5.__webglLineBuffer=aw.createBuffer();if(b5.numMorphTargets){bw=b4=void 0;b5.__webglMorphTargetsBuffers=[];b4=0;for(bw=b5.numMorphTargets;b4<bw;b4++){b5.__webglMorphTargetsBuffers.push(aw.createBuffer())}}aM.info.memory.geometries++;b2=cb;br=b2.geometry;b4=b8.faces3;e=b8.faces4;b5=b4.length*3+e.length*4;bw=b4.length*1+e.length*2;e=b4.length*3+e.length*4;b4=aG(b2,b8);b1=aB(b4);bZ=aD(b4);by=aA(b4);b8.__vertexArray=new Float32Array(b5*3);if(bZ){b8.__normalArray=new Float32Array(b5*3)}if(br.hasTangents){b8.__tangentArray=new Float32Array(b5*4)}if(by){b8.__colorArray=new Float32Array(b5*3)}if(b1){if(br.faceUvs.length>0||br.faceVertexUvs.length>0){b8.__uvArray=new Float32Array(b5*2)}if(br.faceUvs.length>1||br.faceVertexUvs.length>1){b8.__uv2Array=new Float32Array(b5*2)}}if(b2.geometry.skinWeights.length&&b2.geometry.skinIndices.length){b8.__skinVertexAArray=new Float32Array(b5*4),b8.__skinVertexBArray=new Float32Array(b5*4),b8.__skinIndexArray=new Float32Array(b5*4),b8.__skinWeightArray=new Float32Array(b5*4)}b8.__faceArray=new Uint16Array(bw*3);b8.__lineArray=new Uint16Array(e*2);if(b8.numMorphTargets){b8.__morphTargetsArrays=[];b2=0;for(br=b8.numMorphTargets;b2<br;b2++){b8.__morphTargetsArrays.push(new Float32Array(b5*3))}}b8.__webglFaceCount=bw*3;b8.__webglLineCount=e*2;if(b4.attributes){if(b8.__webglCustomAttributesList===void 0){b8.__webglCustomAttributesList=[]}bw=void 0;for(bw in b4.attributes){var b2=b4.attributes[bw],br={},c;for(c in b2){br[c]=b2[c]}if(!br.__webglInitialized||br.createUniqueBuffers){br.__webglInitialized=!0,e=1,br.type==="v2"?e=2:br.type==="v3"?e=3:br.type==="v4"?e=4:br.type==="c"&&(e=3),br.size=e,br.array=new Float32Array(b5*e),br.buffer=aw.createBuffer(),br.buffer.belongsToAttribute=bw,b2.needsUpdate=!0,br.__original=b2}b8.__webglCustomAttributesList.push(br)}}b8.__inittedArrays=!0;b7.__dirtyVertices=!0;b7.__dirtyMorphTargets=!0;b7.__dirtyElements=!0;b7.__dirtyUvs=!0;b7.__dirtyNormals=!0;b7.__dirtyTangents=!0;b7.__dirtyColors=!0}}}else{if(cb instanceof b.Ribbon){if(b7=cb.geometry,!b7.__webglVertexBuffer){b8=b7,b8.__webglVertexBuffer=aw.createBuffer(),b8.__webglColorBuffer=aw.createBuffer(),aM.info.memory.geometries++,b8=b7,b5=b8.vertices.length,b8.__vertexArray=new Float32Array(b5*3),b8.__colorArray=new Float32Array(b5*3),b8.__webglVertexCount=b5,b7.__dirtyVertices=!0,b7.__dirtyColors=!0}}else{if(cb instanceof b.Line){if(b7=cb.geometry,!b7.__webglVertexBuffer){b8=b7,b8.__webglVertexBuffer=aw.createBuffer(),b8.__webglColorBuffer=aw.createBuffer(),aM.info.memory.geometries++,b8=b7,b5=cb,b4=b8.vertices.length,b8.__vertexArray=new Float32Array(b4*3),b8.__colorArray=new Float32Array(b4*3),b8.__webglLineCount=b4,aF(b8,b5),b7.__dirtyVertices=!0,b7.__dirtyColors=!0}}else{if(cb instanceof b.ParticleSystem&&(b7=cb.geometry,!b7.__webglVertexBuffer)){b8=b7,b8.__webglVertexBuffer=aw.createBuffer(),b8.__webglColorBuffer=aw.createBuffer(),aM.info.geometries++,b8=b7,b5=cb,b4=b8.vertices.length,b8.__vertexArray=new Float32Array(b4*3),b8.__colorArray=new Float32Array(b4*3),b8.__sortArray=[],b8.__webglParticleCount=b4,aF(b8,b5),b7.__dirtyVertices=!0,b7.__dirtyColors=!0}}}}}if(!cb.__webglActive){if(cb instanceof b.Mesh){for(b6 in b7=cb.geometry,b7.geometryGroups){b8=b7.geometryGroups[b6],aq(b9.__webglObjects,b8,cb)}}else{cb instanceof b.Ribbon||cb instanceof b.Line||cb instanceof b.ParticleSystem?(b7=cb.geometry,aq(b9.__webglObjects,b7,cb)):b.MarchingCubes!==void 0&&cb instanceof b.MarchingCubes||cb.immediateRenderCallback?b9.__webglObjectsImmediate.push({object:cb,opaque:null,transparent:null}):cb instanceof b.Sprite&&b9.__webglSprites.push(cb)}cb.__webglActive=!0}cc.__objectsAdded.splice(0,1)}for(;cc.__objectsRemoved.length;){cb=cc.__objectsRemoved[0];b9=cc;if(cb instanceof b.Mesh||cb instanceof b.ParticleSystem||cb instanceof b.Ribbon||cb instanceof b.Line){ah(b9.__webglObjects,cb)}else{if(cb instanceof b.Sprite){b9=b9.__webglSprites;b6=cb;for(b7=b9.length-1;b7>=0;b7--){b9[b7]===b6&&b9.splice(b7,1)}}else{(cb instanceof b.MarchingCubes||cb.immediateRenderCallback)&&ah(b9.__webglObjectsImmediate,cb)}}cb.__webglActive=!1;cc.__objectsRemoved.splice(0,1)}cb=0;for(b9=cc.__webglObjects.length;cb<b9;cb++){if(c=cc.__webglObjects[cb].object,b6=c.geometry,b7=bw=b4=void 0,c instanceof b.Mesh){b8=0;for(b5=b6.geometryGroupsList.length;b8<b5;b8++){if(b4=b6.geometryGroupsList[b8],b7=aG(c,b4),bw=b7.attributes&&an(b7),b6.__dirtyVertices||b6.__dirtyMorphTargets||b6.__dirtyElements||b6.__dirtyUvs||b6.__dirtyNormals||b6.__dirtyColors||b6.__dirtyTangents||bw){var bD=c,bw=aw.DYNAMIC_DRAW,b2=!b6.dynamic,b1=b7;if(b4.__inittedArrays){var br=aD(b1),e=aA(b1),bG=aB(b1),bp=br===b.SmoothShading,bv=bZ=b1=void 0,bE=void 0,bB=void 0,bz=void 0,bY=void 0,bH=void 0,d=void 0,bC=bv=void 0,bU=void 0,bW=void 0,bu=void 0,bA=bE=void 0,bs=void 0,bo=void 0,bR=bE=d=void 0,w=void 0,j=bu=bW=bU=bY=void 0,bx=bE=bu=bW=bU=j=bu=bW=bU=j=bu=bW=bU=void 0,bt=void 0,bV=bz=void 0,W=void 0,q=void 0,bK=void 0,bI=void 0,cd=bC=q=bt=0,bJ=0,bM=bx=bv=0,g=bY=bA=0,bF=0,bS=void 0,g=b4.__vertexArray,W=b4.__uvArray,bF=b4.__uv2Array,bV=b4.__normalArray,bB=b4.__tangentArray,bs=b4.__colorArray,bR=b4.__skinVertexAArray,w=b4.__skinVertexBArray,bH=b4.__skinIndexArray,bQ=b4.__skinWeightArray,j=b4.__morphTargetsArrays,by=b4.__webglCustomAttributesList,bT=void 0,bT=b4.__faceArray,bS=b4.__lineArray,bo=bD.geometry,b3=bo.__dirtyElements,bn=bo.__dirtyUvs,bz=bo.__dirtyNormals,d=bo.__dirtyTangents,b0=bo.__dirtyColors,bK=bo.__dirtyMorphTargets,bI=bo.vertices,bD=b4.faces3,bL=b4.faces4,f=bo.faces,t=bo.faceVertexUvs[0],bN=bo.faceVertexUvs[1],bO=bo.skinVerticesA,bq=bo.skinVerticesB,bX=bo.skinIndices,n=bo.skinWeights,bP=bo.morphTargets;if(bo.__dirtyVertices){b1=0;for(bZ=bD.length;b1<bZ;b1++){bE=f[bD[b1]],bU=bI[bE.a].position,bW=bI[bE.b].position,bu=bI[bE.c].position,g[q]=bU.x,g[q+1]=bU.y,g[q+2]=bU.z,g[q+3]=bW.x,g[q+4]=bW.y,g[q+5]=bW.z,g[q+6]=bu.x,g[q+7]=bu.y,g[q+8]=bu.z,q+=9}b1=0;for(bZ=bL.length;b1<bZ;b1++){bE=f[bL[b1]],bU=bI[bE.a].position,bW=bI[bE.b].position,bu=bI[bE.c].position,bE=bI[bE.d].position,g[q]=bU.x,g[q+1]=bU.y,g[q+2]=bU.z,g[q+3]=bW.x,g[q+4]=bW.y,g[q+5]=bW.z,g[q+6]=bu.x,g[q+7]=bu.y,g[q+8]=bu.z,g[q+9]=bE.x,g[q+10]=bE.y,g[q+11]=bE.z,q+=12}aw.bindBuffer(aw.ARRAY_BUFFER,b4.__webglVertexBuffer);aw.bufferData(aw.ARRAY_BUFFER,g,bw)}if(bK){q=0;for(bK=bP.length;q<bK;q++){b1=g=0;for(bZ=bD.length;b1<bZ;b1++){bE=f[bD[b1]],bU=bP[q].vertices[bE.a].position,bW=bP[q].vertices[bE.b].position,bu=bP[q].vertices[bE.c].position,bI=j[q],bI[g]=bU.x,bI[g+1]=bU.y,bI[g+2]=bU.z,bI[g+3]=bW.x,bI[g+4]=bW.y,bI[g+5]=bW.z,bI[g+6]=bu.x,bI[g+7]=bu.y,bI[g+8]=bu.z,g+=9}b1=0;for(bZ=bL.length;b1<bZ;b1++){bE=f[bL[b1]],bU=bP[q].vertices[bE.a].position,bW=bP[q].vertices[bE.b].position,bu=bP[q].vertices[bE.c].position,bE=bP[q].vertices[bE.d].position,bI=j[q],bI[g]=bU.x,bI[g+1]=bU.y,bI[g+2]=bU.z,bI[g+3]=bW.x,bI[g+4]=bW.y,bI[g+5]=bW.z,bI[g+6]=bu.x,bI[g+7]=bu.y,bI[g+8]=bu.z,bI[g+9]=bE.x,bI[g+10]=bE.y,bI[g+11]=bE.z,g+=12}aw.bindBuffer(aw.ARRAY_BUFFER,b4.__webglMorphTargetsBuffers[q]);aw.bufferData(aw.ARRAY_BUFFER,j[q],bw)}}if(n.length){b1=0;for(bZ=bD.length;b1<bZ;b1++){bE=f[bD[b1]],bU=n[bE.a],bW=n[bE.b],bu=n[bE.c],bQ[bY]=bU.x,bQ[bY+1]=bU.y,bQ[bY+2]=bU.z,bQ[bY+3]=bU.w,bQ[bY+4]=bW.x,bQ[bY+5]=bW.y,bQ[bY+6]=bW.z,bQ[bY+7]=bW.w,bQ[bY+8]=bu.x,bQ[bY+9]=bu.y,bQ[bY+10]=bu.z,bQ[bY+11]=bu.w,bU=bX[bE.a],bW=bX[bE.b],bu=bX[bE.c],bH[bY]=bU.x,bH[bY+1]=bU.y,bH[bY+2]=bU.z,bH[bY+3]=bU.w,bH[bY+4]=bW.x,bH[bY+5]=bW.y,bH[bY+6]=bW.z,bH[bY+7]=bW.w,bH[bY+8]=bu.x,bH[bY+9]=bu.y,bH[bY+10]=bu.z,bH[bY+11]=bu.w,bU=bO[bE.a],bW=bO[bE.b],bu=bO[bE.c],bR[bY]=bU.x,bR[bY+1]=bU.y,bR[bY+2]=bU.z,bR[bY+3]=1,bR[bY+4]=bW.x,bR[bY+5]=bW.y,bR[bY+6]=bW.z,bR[bY+7]=1,bR[bY+8]=bu.x,bR[bY+9]=bu.y,bR[bY+10]=bu.z,bR[bY+11]=1,bU=bq[bE.a],bW=bq[bE.b],bu=bq[bE.c],w[bY]=bU.x,w[bY+1]=bU.y,w[bY+2]=bU.z,w[bY+3]=1,w[bY+4]=bW.x,w[bY+5]=bW.y,w[bY+6]=bW.z,w[bY+7]=1,w[bY+8]=bu.x,w[bY+9]=bu.y,w[bY+10]=bu.z,w[bY+11]=1,bY+=12}b1=0;for(bZ=bL.length;b1<bZ;b1++){bE=f[bL[b1]],bU=n[bE.a],bW=n[bE.b],bu=n[bE.c],j=n[bE.d],bQ[bY]=bU.x,bQ[bY+1]=bU.y,bQ[bY+2]=bU.z,bQ[bY+3]=bU.w,bQ[bY+4]=bW.x,bQ[bY+5]=bW.y,bQ[bY+6]=bW.z,bQ[bY+7]=bW.w,bQ[bY+8]=bu.x,bQ[bY+9]=bu.y,bQ[bY+10]=bu.z,bQ[bY+11]=bu.w,bQ[bY+12]=j.x,bQ[bY+13]=j.y,bQ[bY+14]=j.z,bQ[bY+15]=j.w,bU=bX[bE.a],bW=bX[bE.b],bu=bX[bE.c],j=bX[bE.d],bH[bY]=bU.x,bH[bY+1]=bU.y,bH[bY+2]=bU.z,bH[bY+3]=bU.w,bH[bY+4]=bW.x,bH[bY+5]=bW.y,bH[bY+6]=bW.z,bH[bY+7]=bW.w,bH[bY+8]=bu.x,bH[bY+9]=bu.y,bH[bY+10]=bu.z,bH[bY+11]=bu.w,bH[bY+12]=j.x,bH[bY+13]=j.y,bH[bY+14]=j.z,bH[bY+15]=j.w,bU=bO[bE.a],bW=bO[bE.b],bu=bO[bE.c],j=bO[bE.d],bR[bY]=bU.x,bR[bY+1]=bU.y,bR[bY+2]=bU.z,bR[bY+3]=1,bR[bY+4]=bW.x,bR[bY+5]=bW.y,bR[bY+6]=bW.z,bR[bY+7]=1,bR[bY+8]=bu.x,bR[bY+9]=bu.y,bR[bY+10]=bu.z,bR[bY+11]=1,bR[bY+12]=j.x,bR[bY+13]=j.y,bR[bY+14]=j.z,bR[bY+15]=1,bU=bq[bE.a],bW=bq[bE.b],bu=bq[bE.c],bE=bq[bE.d],w[bY]=bU.x,w[bY+1]=bU.y,w[bY+2]=bU.z,w[bY+3]=1,w[bY+4]=bW.x,w[bY+5]=bW.y,w[bY+6]=bW.z,w[bY+7]=1,w[bY+8]=bu.x,w[bY+9]=bu.y,w[bY+10]=bu.z,w[bY+11]=1,w[bY+12]=bE.x,w[bY+13]=bE.y,w[bY+14]=bE.z,w[bY+15]=1,bY+=16}bY>0&&(aw.bindBuffer(aw.ARRAY_BUFFER,b4.__webglSkinVertexABuffer),aw.bufferData(aw.ARRAY_BUFFER,bR,bw),aw.bindBuffer(aw.ARRAY_BUFFER,b4.__webglSkinVertexBBuffer),aw.bufferData(aw.ARRAY_BUFFER,w,bw),aw.bindBuffer(aw.ARRAY_BUFFER,b4.__webglSkinIndicesBuffer),aw.bufferData(aw.ARRAY_BUFFER,bH,bw),aw.bindBuffer(aw.ARRAY_BUFFER,b4.__webglSkinWeightsBuffer),aw.bufferData(aw.ARRAY_BUFFER,bQ,bw))}if(b0&&e){b1=0;for(bZ=bD.length;b1<bZ;b1++){bE=f[bD[b1]],bY=bE.vertexColors,bH=bE.color,bY.length===3&&e===b.VertexColors?(bE=bY[0],bR=bY[1],w=bY[2]):w=bR=bE=bH,bs[bA]=bE.r,bs[bA+1]=bE.g,bs[bA+2]=bE.b,bs[bA+3]=bR.r,bs[bA+4]=bR.g,bs[bA+5]=bR.b,bs[bA+6]=w.r,bs[bA+7]=w.g,bs[bA+8]=w.b,bA+=9}b1=0;for(bZ=bL.length;b1<bZ;b1++){bE=f[bL[b1]],bY=bE.vertexColors,bH=bE.color,bY.length===4&&e===b.VertexColors?(bE=bY[0],bR=bY[1],w=bY[2],bY=bY[3]):bY=w=bR=bE=bH,bs[bA]=bE.r,bs[bA+1]=bE.g,bs[bA+2]=bE.b,bs[bA+3]=bR.r,bs[bA+4]=bR.g,bs[bA+5]=bR.b,bs[bA+6]=w.r,bs[bA+7]=w.g,bs[bA+8]=w.b,bs[bA+9]=bY.r,bs[bA+10]=bY.g,bs[bA+11]=bY.b,bA+=12}bA>0&&(aw.bindBuffer(aw.ARRAY_BUFFER,b4.__webglColorBuffer),aw.bufferData(aw.ARRAY_BUFFER,bs,bw))}if(d&&bo.hasTangents){b1=0;for(bZ=bD.length;b1<bZ;b1++){bE=f[bD[b1]],d=bE.vertexTangents,bA=d[0],bs=d[1],bo=d[2],bB[bx]=bA.x,bB[bx+1]=bA.y,bB[bx+2]=bA.z,bB[bx+3]=bA.w,bB[bx+4]=bs.x,bB[bx+5]=bs.y,bB[bx+6]=bs.z,bB[bx+7]=bs.w,bB[bx+8]=bo.x,bB[bx+9]=bo.y,bB[bx+10]=bo.z,bB[bx+11]=bo.w,bx+=12}b1=0;for(bZ=bL.length;b1<bZ;b1++){bE=f[bL[b1]],d=bE.vertexTangents,bA=d[0],bs=d[1],bo=d[2],d=d[3],bB[bx]=bA.x,bB[bx+1]=bA.y,bB[bx+2]=bA.z,bB[bx+3]=bA.w,bB[bx+4]=bs.x,bB[bx+5]=bs.y,bB[bx+6]=bs.z,bB[bx+7]=bs.w,bB[bx+8]=bo.x,bB[bx+9]=bo.y,bB[bx+10]=bo.z,bB[bx+11]=bo.w,bB[bx+12]=d.x,bB[bx+13]=d.y,bB[bx+14]=d.z,bB[bx+15]=d.w,bx+=16}aw.bindBuffer(aw.ARRAY_BUFFER,b4.__webglTangentBuffer);aw.bufferData(aw.ARRAY_BUFFER,bB,bw)}if(bz&&br){b1=0;for(bZ=bD.length;b1<bZ;b1++){if(bE=f[bD[b1]],bB=bE.vertexNormals,bz=bE.normal,bB.length===3&&bp){for(bx=0;bx<3;bx++){bz=bB[bx],bV[bv]=bz.x,bV[bv+1]=bz.y,bV[bv+2]=bz.z,bv+=3}}else{for(bx=0;bx<3;bx++){bV[bv]=bz.x,bV[bv+1]=bz.y,bV[bv+2]=bz.z,bv+=3}}}b1=0;for(bZ=bL.length;b1<bZ;b1++){if(bE=f[bL[b1]],bB=bE.vertexNormals,bz=bE.normal,bB.length===4&&bp){for(bx=0;bx<4;bx++){bz=bB[bx],bV[bv]=bz.x,bV[bv+1]=bz.y,bV[bv+2]=bz.z,bv+=3}}else{for(bx=0;bx<4;bx++){bV[bv]=bz.x,bV[bv+1]=bz.y,bV[bv+2]=bz.z,bv+=3}}}aw.bindBuffer(aw.ARRAY_BUFFER,b4.__webglNormalBuffer);aw.bufferData(aw.ARRAY_BUFFER,bV,bw)}if(bn&&t&&bG){b1=0;for(bZ=bD.length;b1<bZ;b1++){if(bv=bD[b1],bv=t[bv],bv!==void 0){for(bx=0;bx<3;bx++){bV=bv[bx],W[bC]=bV.u,W[bC+1]=bV.v,bC+=2}}}b1=0;for(bZ=bL.length;b1<bZ;b1++){if(bv=bL[b1],bv=t[bv],bv!==void 0){for(bx=0;bx<4;bx++){bV=bv[bx],W[bC]=bV.u,W[bC+1]=bV.v,bC+=2}}}bC>0&&(aw.bindBuffer(aw.ARRAY_BUFFER,b4.__webglUVBuffer),aw.bufferData(aw.ARRAY_BUFFER,W,bw))}if(bn&&bN&&bG){b1=0;for(bZ=bD.length;b1<bZ;b1++){if(bv=bD[b1],bC=bN[bv],bC!==void 0){for(bx=0;bx<3;bx++){W=bC[bx],bF[cd]=W.u,bF[cd+1]=W.v,cd+=2}}}b1=0;for(bZ=bL.length;b1<bZ;b1++){if(bv=bL[b1],bC=bN[bv],bC!==void 0){for(bx=0;bx<4;bx++){W=bC[bx],bF[cd]=W.u,bF[cd+1]=W.v,cd+=2}}}cd>0&&(aw.bindBuffer(aw.ARRAY_BUFFER,b4.__webglUV2Buffer),aw.bufferData(aw.ARRAY_BUFFER,bF,bw))}if(b3){b1=0;for(bZ=bD.length;b1<bZ;b1++){bT[bJ]=bt,bT[bJ+1]=bt+1,bT[bJ+2]=bt+2,bJ+=3,bS[bM]=bt,bS[bM+1]=bt+1,bS[bM+2]=bt,bS[bM+3]=bt+2,bS[bM+4]=bt+1,bS[bM+5]=bt+2,bM+=6,bt+=3}b1=0;for(bZ=bL.length;b1<bZ;b1++){bT[bJ]=bt,bT[bJ+1]=bt+1,bT[bJ+2]=bt+3,bT[bJ+3]=bt+1,bT[bJ+4]=bt+2,bT[bJ+5]=bt+3,bJ+=6,bS[bM]=bt,bS[bM+1]=bt+1,bS[bM+2]=bt,bS[bM+3]=bt+3,bS[bM+4]=bt+1,bS[bM+5]=bt+2,bS[bM+6]=bt+2,bS[bM+7]=bt+3,bM+=8,bt+=4}aw.bindBuffer(aw.ELEMENT_ARRAY_BUFFER,b4.__webglFaceBuffer);aw.bufferData(aw.ELEMENT_ARRAY_BUFFER,bT,bw);aw.bindBuffer(aw.ELEMENT_ARRAY_BUFFER,b4.__webglLineBuffer);aw.bufferData(aw.ELEMENT_ARRAY_BUFFER,bS,bw)}if(by){bx=0;for(bt=by.length;bx<bt;bx++){if(bT=by[bx],bT.__original.needsUpdate){bF=0;if(bT.size===1){if(bT.boundTo===void 0||bT.boundTo==="vertices"){b1=0;for(bZ=bD.length;b1<bZ;b1++){bE=f[bD[b1]],bT.array[bF]=bT.value[bE.a],bT.array[bF+1]=bT.value[bE.b],bT.array[bF+2]=bT.value[bE.c],bF+=3}b1=0;for(bZ=bL.length;b1<bZ;b1++){bE=f[bL[b1]],bT.array[bF]=bT.value[bE.a],bT.array[bF+1]=bT.value[bE.b],bT.array[bF+2]=bT.value[bE.c],bT.array[bF+3]=bT.value[bE.d],bF+=4}}else{if(bT.boundTo==="faces"){b1=0;for(bZ=bD.length;b1<bZ;b1++){bS=bT.value[bD[b1]],bT.array[bF]=bS,bT.array[bF+1]=bS,bT.array[bF+2]=bS,bF+=3}b1=0;for(bZ=bL.length;b1<bZ;b1++){bS=bT.value[bL[b1]],bT.array[bF]=bS,bT.array[bF+1]=bS,bT.array[bF+2]=bS,bT.array[bF+3]=bS,bF+=4}}}}else{if(bT.size===2){if(bT.boundTo===void 0||bT.boundTo==="vertices"){b1=0;for(bZ=bD.length;b1<bZ;b1++){bE=f[bD[b1]],bU=bT.value[bE.a],bW=bT.value[bE.b],bu=bT.value[bE.c],bT.array[bF]=bU.x,bT.array[bF+1]=bU.y,bT.array[bF+2]=bW.x,bT.array[bF+3]=bW.y,bT.array[bF+4]=bu.x,bT.array[bF+5]=bu.y,bF+=6}b1=0;for(bZ=bL.length;b1<bZ;b1++){bE=f[bL[b1]],bU=bT.value[bE.a],bW=bT.value[bE.b],bu=bT.value[bE.c],bE=bT.value[bE.d],bT.array[bF]=bU.x,bT.array[bF+1]=bU.y,bT.array[bF+2]=bW.x,bT.array[bF+3]=bW.y,bT.array[bF+4]=bu.x,bT.array[bF+5]=bu.y,bT.array[bF+6]=bE.x,bT.array[bF+7]=bE.y,bF+=8}}else{if(bT.boundTo==="faces"){b1=0;for(bZ=bD.length;b1<bZ;b1++){bu=bW=bU=bS=bT.value[bD[b1]],bT.array[bF]=bU.x,bT.array[bF+1]=bU.y,bT.array[bF+2]=bW.x,bT.array[bF+3]=bW.y,bT.array[bF+4]=bu.x,bT.array[bF+5]=bu.y,bF+=6}b1=0;for(bZ=bL.length;b1<bZ;b1++){bE=bu=bW=bU=bS=bT.value[bL[b1]],bT.array[bF]=bU.x,bT.array[bF+1]=bU.y,bT.array[bF+2]=bW.x,bT.array[bF+3]=bW.y,bT.array[bF+4]=bu.x,bT.array[bF+5]=bu.y,bT.array[bF+6]=bE.x,bT.array[bF+7]=bE.y,bF+=8}}}}else{if(bT.size===3){if(br=bT.type==="c"?["r","g","b"]:["x","y","z"],bT.boundTo===void 0||bT.boundTo==="vertices"){b1=0;for(bZ=bD.length;b1<bZ;b1++){bE=f[bD[b1]],bU=bT.value[bE.a],bW=bT.value[bE.b],bu=bT.value[bE.c],bT.array[bF]=bU[br[0]],bT.array[bF+1]=bU[br[1]],bT.array[bF+2]=bU[br[2]],bT.array[bF+3]=bW[br[0]],bT.array[bF+4]=bW[br[1]],bT.array[bF+5]=bW[br[2]],bT.array[bF+6]=bu[br[0]],bT.array[bF+7]=bu[br[1]],bT.array[bF+8]=bu[br[2]],bF+=9}b1=0;for(bZ=bL.length;b1<bZ;b1++){bE=f[bL[b1]],bU=bT.value[bE.a],bW=bT.value[bE.b],bu=bT.value[bE.c],bE=bT.value[bE.d],bT.array[bF]=bU[br[0]],bT.array[bF+1]=bU[br[1]],bT.array[bF+2]=bU[br[2]],bT.array[bF+3]=bW[br[0]],bT.array[bF+4]=bW[br[1]],bT.array[bF+5]=bW[br[2]],bT.array[bF+6]=bu[br[0]],bT.array[bF+7]=bu[br[1]],bT.array[bF+8]=bu[br[2]],bT.array[bF+9]=bE[br[0]],bT.array[bF+10]=bE[br[1]],bT.array[bF+11]=bE[br[2]],bF+=12}}else{if(bT.boundTo==="faces"){b1=0;for(bZ=bD.length;b1<bZ;b1++){bu=bW=bU=bS=bT.value[bD[b1]],bT.array[bF]=bU[br[0]],bT.array[bF+1]=bU[br[1]],bT.array[bF+2]=bU[br[2]],bT.array[bF+3]=bW[br[0]],bT.array[bF+4]=bW[br[1]],bT.array[bF+5]=bW[br[2]],bT.array[bF+6]=bu[br[0]],bT.array[bF+7]=bu[br[1]],bT.array[bF+8]=bu[br[2]],bF+=9}b1=0;for(bZ=bL.length;b1<bZ;b1++){bE=bu=bW=bU=bS=bT.value[bL[b1]],bT.array[bF]=bU[br[0]],bT.array[bF+1]=bU[br[1]],bT.array[bF+2]=bU[br[2]],bT.array[bF+3]=bW[br[0]],bT.array[bF+4]=bW[br[1]],bT.array[bF+5]=bW[br[2]],bT.array[bF+6]=bu[br[0]],bT.array[bF+7]=bu[br[1]],bT.array[bF+8]=bu[br[2]],bT.array[bF+9]=bE[br[0]],bT.array[bF+10]=bE[br[1]],bT.array[bF+11]=bE[br[2]],bF+=12}}}}else{if(bT.size===4){if(bT.boundTo===void 0||bT.boundTo==="vertices"){b1=0;for(bZ=bD.length;b1<bZ;b1++){bE=f[bD[b1]],bU=bT.value[bE.a],bW=bT.value[bE.b],bu=bT.value[bE.c],bT.array[bF]=bU.x,bT.array[bF+1]=bU.y,bT.array[bF+2]=bU.z,bT.array[bF+3]=bU.w,bT.array[bF+4]=bW.x,bT.array[bF+5]=bW.y,bT.array[bF+6]=bW.z,bT.array[bF+7]=bW.w,bT.array[bF+8]=bu.x,bT.array[bF+9]=bu.y,bT.array[bF+10]=bu.z,bT.array[bF+11]=bu.w,bF+=12}b1=0;for(bZ=bL.length;b1<bZ;b1++){bE=f[bL[b1]],bU=bT.value[bE.a],bW=bT.value[bE.b],bu=bT.value[bE.c],bE=bT.value[bE.d],bT.array[bF]=bU.x,bT.array[bF+1]=bU.y,bT.array[bF+2]=bU.z,bT.array[bF+3]=bU.w,bT.array[bF+4]=bW.x,bT.array[bF+5]=bW.y,bT.array[bF+6]=bW.z,bT.array[bF+7]=bW.w,bT.array[bF+8]=bu.x,bT.array[bF+9]=bu.y,bT.array[bF+10]=bu.z,bT.array[bF+11]=bu.w,bT.array[bF+12]=bE.x,bT.array[bF+13]=bE.y,bT.array[bF+14]=bE.z,bT.array[bF+15]=bE.w,bF+=16}}else{if(bT.boundTo==="faces"){b1=0;for(bZ=bD.length;b1<bZ;b1++){bu=bW=bU=bS=bT.value[bD[b1]],bT.array[bF]=bU.x,bT.array[bF+1]=bU.y,bT.array[bF+2]=bU.z,bT.array[bF+3]=bU.w,bT.array[bF+4]=bW.x,bT.array[bF+5]=bW.y,bT.array[bF+6]=bW.z,bT.array[bF+7]=bW.w,bT.array[bF+8]=bu.x,bT.array[bF+9]=bu.y,bT.array[bF+10]=bu.z,bT.array[bF+11]=bu.w,bF+=12}b1=0;for(bZ=bL.length;b1<bZ;b1++){bE=bu=bW=bU=bS=bT.value[bL[b1]],bT.array[bF]=bU.x,bT.array[bF+1]=bU.y,bT.array[bF+2]=bU.z,bT.array[bF+3]=bU.w,bT.array[bF+4]=bW.x,bT.array[bF+5]=bW.y,bT.array[bF+6]=bW.z,bT.array[bF+7]=bW.w,bT.array[bF+8]=bu.x,bT.array[bF+9]=bu.y,bT.array[bF+10]=bu.z,bT.array[bF+11]=bu.w,bT.array[bF+12]=bE.x,bT.array[bF+13]=bE.y,bT.array[bF+14]=bE.z,bT.array[bF+15]=bE.w,bF+=16}}}}}}}aw.bindBuffer(aw.ARRAY_BUFFER,bT.buffer);aw.bufferData(aw.ARRAY_BUFFER,bT.array,bw)}}}b2&&(delete b4.__inittedArrays,delete b4.__colorArray,delete b4.__normalArray,delete b4.__tangentArray,delete b4.__uvArray,delete b4.__uv2Array,delete b4.__faceArray,delete b4.__vertexArray,delete b4.__lineArray,delete b4.__skinVertexAArray,delete b4.__skinVertexBArray,delete b4.__skinIndexArray,delete b4.__skinWeightArray)}}}b6.__dirtyVertices=!1;b6.__dirtyMorphTargets=!1;b6.__dirtyElements=!1;b6.__dirtyUvs=!1;b6.__dirtyNormals=!1;b6.__dirtyColors=!1;b6.__dirtyTangents=!1;b7.attributes&&ak(b7)}else{if(c instanceof b.Ribbon){if(b6.__dirtyVertices||b6.__dirtyColors){b7=b6;c=aw.DYNAMIC_DRAW;br=b8=br=b2=b2=void 0;e=b7.vertices;b5=b7.colors;b1=e.length;b4=b5.length;bZ=b7.__vertexArray;bw=b7.__colorArray;by=b7.__dirtyColors;if(b7.__dirtyVertices){for(b2=0;b2<b1;b2++){br=e[b2].position,b8=b2*3,bZ[b8]=br.x,bZ[b8+1]=br.y,bZ[b8+2]=br.z}aw.bindBuffer(aw.ARRAY_BUFFER,b7.__webglVertexBuffer);aw.bufferData(aw.ARRAY_BUFFER,bZ,c)}if(by){for(b2=0;b2<b4;b2++){br=b5[b2],b8=b2*3,bw[b8]=br.r,bw[b8+1]=br.g,bw[b8+2]=br.b}aw.bindBuffer(aw.ARRAY_BUFFER,b7.__webglColorBuffer);aw.bufferData(aw.ARRAY_BUFFER,bw,c)}}b6.__dirtyVertices=!1;b6.__dirtyColors=!1}else{if(c instanceof b.Line){b7=aG(c,b4);bw=b7.attributes&&an(b7);if(b6.__dirtyVertices||b6.__dirtyColors||bw){c=b6;b8=aw.DYNAMIC_DRAW;b1=b5=bp=e=bG=void 0;e=c.vertices;b4=c.colors;b1=e.length;bw=b4.length;bZ=c.__vertexArray;b2=c.__colorArray;by=c.__dirtyColors;br=c.__webglCustomAttributesList;bt=f=bL=bD=bp=bG=void 0;if(c.__dirtyVertices){for(bG=0;bG<b1;bG++){bp=e[bG].position,b5=bG*3,bZ[b5]=bp.x,bZ[b5+1]=bp.y,bZ[b5+2]=bp.z}aw.bindBuffer(aw.ARRAY_BUFFER,c.__webglVertexBuffer);aw.bufferData(aw.ARRAY_BUFFER,bZ,b8)}if(by){for(e=0;e<bw;e++){b1=b4[e],b5=e*3,b2[b5]=b1.r,b2[b5+1]=b1.g,b2[b5+2]=b1.b}aw.bindBuffer(aw.ARRAY_BUFFER,c.__webglColorBuffer);aw.bufferData(aw.ARRAY_BUFFER,b2,b8)}if(br){bG=0;for(bp=br.length;bG<bp;bG++){if(bt=br[bG],bt.needsUpdate&&(bt.boundTo===void 0||bt.boundTo==="vertices")){b5=0;bL=bt.value.length;if(bt.size===1){for(bD=0;bD<bL;bD++){bt.array[bD]=bt.value[bD]}}else{if(bt.size===2){for(bD=0;bD<bL;bD++){f=bt.value[bD],bt.array[b5]=f.x,bt.array[b5+1]=f.y,b5+=2}}else{if(bt.size===3){if(bt.type==="c"){for(bD=0;bD<bL;bD++){f=bt.value[bD],bt.array[b5]=f.r,bt.array[b5+1]=f.g,bt.array[b5+2]=f.b,b5+=3}}else{for(bD=0;bD<bL;bD++){f=bt.value[bD],bt.array[b5]=f.x,bt.array[b5+1]=f.y,bt.array[b5+2]=f.z,b5+=3}}}else{if(bt.size===4){for(bD=0;bD<bL;bD++){f=bt.value[bD],bt.array[b5]=f.x,bt.array[b5+1]=f.y,bt.array[b5+2]=f.z,bt.array[b5+3]=f.w,b5+=4}}}}}aw.bindBuffer(aw.ARRAY_BUFFER,bt.buffer);aw.bufferData(aw.ARRAY_BUFFER,bt.array,b8)}}}}b6.__dirtyVertices=!1;b6.__dirtyColors=!1;b7.attributes&&ak(b7)}else{if(c instanceof b.ParticleSystem){b7=aG(c,b4),bw=b7.attributes&&an(b7),(b6.__dirtyVertices||b6.__dirtyColors||c.sortParticles||bw)&&aC(b6,aw.DYNAMIC_DRAW,c),b6.__dirtyVertices=!1,b6.__dirtyColors=!1,b7.attributes&&ak(b7)}}}}}};this.initMaterial=function(H,G,F,B){var x,A,y,w;H instanceof b.MeshDepthMaterial?w="depth":H instanceof b.MeshNormalMaterial?w="normal":H instanceof b.MeshBasicMaterial?w="basic":H instanceof b.MeshLambertMaterial?w="lambert":H instanceof b.MeshPhongMaterial?w="phong":H instanceof b.LineBasicMaterial?w="basic":H instanceof b.ParticleBasicMaterial&&(w="particle_basic");if(w){var v=b.ShaderLib[w];H.uniforms=b.UniformsUtils.clone(v.uniforms);H.vertexShader=v.vertexShader;H.fragmentShader=v.fragmentShader}var u,t,s;u=s=v=0;for(t=G.length;u<t;u++){y=G[u],y instanceof b.SpotLight&&s++,y instanceof b.DirectionalLight&&s++,y instanceof b.PointLight&&v++}v+s<=aU?u=s:(u=Math.ceil(aU*s/(v+s)),v=aU-u);y={directional:u,point:v};v=s=0;for(u=G.length;v<u;v++){t=G[v],t instanceof b.SpotLight&&t.castShadow&&s++}var r=50;if(B!==void 0&&B instanceof b.SkinnedMesh){r=B.bones.length}var q;H:{u=H.fragmentShader;t=H.vertexShader;var v=H.uniforms,G=H.attributes,F={map:!!H.map,envMap:!!H.envMap,lightMap:!!H.lightMap,vertexColors:H.vertexColors,fog:F,useFog:H.fog,sizeAttenuation:H.sizeAttenuation,skinning:H.skinning,morphTargets:H.morphTargets,maxMorphTargets:this.maxMorphTargets,maxDirLights:y.directional,maxPointLights:y.point,maxBones:r,shadowMapEnabled:this.shadowMapEnabled&&B.receiveShadow,shadowMapSoft:this.shadowMapSoft,shadowMapWidth:this.shadowMapWidth,shadowMapHeight:this.shadowMapHeight,maxShadows:s,alphaTest:H.alphaTest,metal:H.metal,perPixel:H.perPixel},j,B=[];w?B.push(w):(B.push(u),B.push(t));for(j in F){B.push(j),B.push(F[j])}w=B.join();j=0;for(B=aL.length;j<B;j++){if(aL[j].code===w){q=aL[j].program;break H}}j=aw.createProgram();B=[bi?"#define VERTEX_TEXTURES":"",aM.gammaInput?"#define GAMMA_INPUT":"",aM.gammaOutput?"#define GAMMA_OUTPUT":"",aM.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"","#define MAX_DIR_LIGHTS "+F.maxDirLights,"#define MAX_POINT_LIGHTS "+F.maxPointLights,"#define MAX_SHADOWS "+F.maxShadows,"#define MAX_BONES "+F.maxBones,F.map?"#define USE_MAP":"",F.envMap?"#define USE_ENVMAP":"",F.lightMap?"#define USE_LIGHTMAP":"",F.vertexColors?"#define USE_COLOR":"",F.skinning?"#define USE_SKINNING":"",F.morphTargets?"#define USE_MORPHTARGETS":"",F.perPixel?"#define PHONG_PER_PIXEL":"",F.shadowMapEnabled?"#define USE_SHADOWMAP":"",F.shadowMapSoft?"#define SHADOWMAP_SOFT":"",F.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 objectMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nuniform mat4 cameraInverseMatrix;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n#ifdef USE_COLOR\nattribute vec3 color;\n#endif\n#ifdef USE_MORPHTARGETS\nattribute vec3 morphTarget0;\nattribute vec3 morphTarget1;\nattribute vec3 morphTarget2;\nattribute vec3 morphTarget3;\nattribute vec3 morphTarget4;\nattribute vec3 morphTarget5;\nattribute vec3 morphTarget6;\nattribute vec3 morphTarget7;\n#endif\n#ifdef USE_SKINNING\nattribute vec4 skinVertexA;\nattribute vec4 skinVertexB;\nattribute vec4 skinIndex;\nattribute vec4 skinWeight;\n#endif\n"].join("\n");y=["#ifdef GL_ES","precision "+bd+" float;","#endif","#define MAX_DIR_LIGHTS "+F.maxDirLights,"#define MAX_POINT_LIGHTS "+F.maxPointLights,"#define MAX_SHADOWS "+F.maxShadows,F.alphaTest?"#define ALPHATEST "+F.alphaTest:"",aM.gammaInput?"#define GAMMA_INPUT":"",aM.gammaOutput?"#define GAMMA_OUTPUT":"",aM.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"",F.useFog&&F.fog?"#define USE_FOG":"",F.useFog&&F.fog instanceof b.FogExp2?"#define FOG_EXP2":"",F.map?"#define USE_MAP":"",F.envMap?"#define USE_ENVMAP":"",F.lightMap?"#define USE_LIGHTMAP":"",F.vertexColors?"#define USE_COLOR":"",F.metal?"#define METAL":"",F.perPixel?"#define PHONG_PER_PIXEL":"",F.shadowMapEnabled?"#define USE_SHADOWMAP":"",F.shadowMapSoft?"#define SHADOWMAP_SOFT":"",F.shadowMapSoft?"#define SHADOWMAP_WIDTH "+F.shadowMapWidth.toFixed(1):"",F.shadowMapSoft?"#define SHADOWMAP_HEIGHT "+F.shadowMapHeight.toFixed(1):"","uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n");aw.attachShader(j,a0("fragment",y+u));aw.attachShader(j,a0("vertex",B+t));aw.linkProgram(j);aw.getProgramParameter(j,aw.LINK_STATUS)||console.error("Could not initialise shader\nVALIDATE_STATUS: "+aw.getProgramParameter(j,aw.VALIDATE_STATUS)+", gl error ["+aw.getError()+"]");j.uniforms={};j.attributes={};var E,B=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","objectMatrix","cameraPosition","cameraInverseMatrix","boneGlobalMatrices","morphTargetInfluences"];for(E in v){B.push(E)}E=B;B=0;for(v=E.length;B<v;B++){u=E[B],j.uniforms[u]=aw.getUniformLocation(j,u)}B=["position","normal","uv","uv2","tangent","color","skinVertexA","skinVertexB","skinIndex","skinWeight"];for(E=0;E<F.maxMorphTargets;E++){B.push("morphTarget"+E)}for(q in G){B.push(q)}q=B;E=0;for(G=q.length;E<G;E++){F=q[E],j.attributes[F]=aw.getAttribLocation(j,F)}j.id=aL.length;aL.push({program:j,code:w});aM.info.memory.programs=aL.length;q=j}H.program=q;q=H.program.attributes;q.position>=0&&aw.enableVertexAttribArray(q.position);q.color>=0&&aw.enableVertexAttribArray(q.color);q.normal>=0&&aw.enableVertexAttribArray(q.normal);q.tangent>=0&&aw.enableVertexAttribArray(q.tangent);H.skinning&&q.skinVertexA>=0&&q.skinVertexB>=0&&q.skinIndex>=0&&q.skinWeight>=0&&(aw.enableVertexAttribArray(q.skinVertexA),aw.enableVertexAttribArray(q.skinVertexB),aw.enableVertexAttribArray(q.skinIndex),aw.enableVertexAttribArray(q.skinWeight));if(H.attributes){for(A in H.attributes){q[A]!==void 0&&q[A]>=0&&aw.enableVertexAttribArray(q[A])}}if(H.morphTargets){for(A=H.numSupportedMorphTargets=0;A<this.maxMorphTargets;A++){E="morphTarget"+A,q[E]>=0&&(aw.enableVertexAttribArray(q[E]),H.numSupportedMorphTargets++)}}H.uniformsList=[];for(x in H.uniforms){H.uniformsList.push([H.uniforms[x],x])}};this.setFaceCulling=function(d,c){d?(!c||c==="ccw"?aw.frontFace(aw.CCW):aw.frontFace(aw.CW),d==="back"?aw.cullFace(aw.BACK):d==="front"?aw.cullFace(aw.FRONT):aw.cullFace(aw.FRONT_AND_BACK),aw.enable(aw.CULL_FACE)):aw.disable(aw.CULL_FACE)}};b.WebGLRenderTarget=function(e,f,d){this.width=e;this.height=f;d=d||{};this.wrapS=d.wrapS!==void 0?d.wrapS:b.ClampToEdgeWrapping;this.wrapT=d.wrapT!==void 0?d.wrapT:b.ClampToEdgeWrapping;this.magFilter=d.magFilter!==void 0?d.magFilter:b.LinearFilter;this.minFilter=d.minFilter!==void 0?d.minFilter:b.LinearMipMapLinearFilter;this.offset=new b.Vector2(0,0);this.repeat=new b.Vector2(1,1);this.format=d.format!==void 0?d.format:b.RGBAFormat;this.type=d.type!==void 0?d.type:b.UnsignedByteType;this.depthBuffer=d.depthBuffer!==void 0?d.depthBuffer:!0;this.stencilBuffer=d.stencilBuffer!==void 0?d.stencilBuffer:!0};b.WebGLRenderTarget.prototype.clone=function(){var c=new b.WebGLRenderTarget(this.width,this.height);c.wrapS=this.wrapS;c.wrapT=this.wrapT;c.magFilter=this.magFilter;c.minFilter=this.minFilter;c.offset.copy(this.offset);c.repeat.copy(this.repeat);c.format=this.format;c.type=this.type;c.depthBuffer=this.depthBuffer;c.stencilBuffer=this.stencilBuffer;return c};b.WebGLRenderTargetCube=function(e,f,d){b.WebGLRenderTarget.call(this,e,f,d);this.activeCubeFace=0};b.WebGLRenderTargetCube.prototype=new b.WebGLRenderTarget;b.WebGLRenderTargetCube.prototype.constructor=b.WebGLRenderTargetCube;b.RenderableVertex=function(){this.positionWorld=new b.Vector3;this.positionScreen=new b.Vector4;this.visible=!0};b.RenderableVertex.prototype.copy=function(c){this.positionWorld.copy(c.positionWorld);this.positionScreen.copy(c.positionScreen)};b.RenderableFace3=function(){this.v1=new b.RenderableVertex;this.v2=new b.RenderableVertex;this.v3=new b.RenderableVertex;this.centroidWorld=new b.Vector3;this.centroidScreen=new b.Vector3;this.normalWorld=new b.Vector3;this.vertexNormalsWorld=[new b.Vector3,new b.Vector3,new b.Vector3];this.faceMaterial=this.material=null;this.uvs=[[]];this.z=null};b.RenderableFace4=function(){this.v1=new b.RenderableVertex;this.v2=new b.RenderableVertex;this.v3=new b.RenderableVertex;this.v4=new b.RenderableVertex;this.centroidWorld=new b.Vector3;this.centroidScreen=new b.Vector3;this.normalWorld=new b.Vector3;this.vertexNormalsWorld=[new b.Vector3,new b.Vector3,new b.Vector3,new b.Vector3];this.faceMaterial=this.material=null;this.uvs=[[]];this.z=null};b.RenderableObject=function(){this.z=this.object=null};b.RenderableParticle=function(){this.rotation=this.z=this.y=this.x=null;this.scale=new b.Vector2;this.material=null};b.RenderableLine=function(){this.z=null;this.v1=new b.RenderableVertex;this.v2=new b.RenderableVertex;this.material=null};b.ColorUtils={adjustHSV:function(f,j,e,i){var h=b.ColorUtils.__hsv;b.ColorUtils.rgbToHsv(f,h);h.h=b.Math.clamp(h.h+j,0,1);h.s=b.Math.clamp(h.s+e,0,1);h.v=b.Math.clamp(h.v+i,0,1);f.setHSV(h.h,h.s,h.v)},rgbToHsv:function(j,p){var i=j.r,o=j.g,l=j.b,m=Math.max(Math.max(i,o),l),n=Math.min(Math.min(i,o),l);if(n===m){n=i=0}else{var k=m-n,n=k/m,i=i===m?(o-l)/k:o===m?2+(l-i)/k:4+(i-o)/k;i/=6;i<0&&(i+=1);i>1&&(i-=1)}p===void 0&&(p={h:0,s:0,v:0});p.h=i;p.s=n;p.v=m;return p}};b.ColorUtils.__hsv={h:0,s:0,v:0};b.GeometryUtils={merge:function(N,L){for(var M,K,H=N.vertices.length,I=L instanceof b.Mesh?L.geometry:L,J=N.vertices,G=I.vertices,F=N.faces,D=I.faces,E=N.faceVertexUvs[0],A=I.faceVertexUvs[0],z={},C=0;C<N.materials.length;C++){z[N.materials[C].id]=C}if(L instanceof b.Mesh){L.matrixAutoUpdate&&L.updateMatrix(),M=L.matrix,K=new b.Matrix4,K.extractRotation(M,L.scale)}for(var C=0,x=G.length;C<x;C++){var B=new b.Vertex(G[C].position.clone());M&&M.multiplyVector3(B.position);J.push(B)}C=0;for(x=D.length;C<x;C++){var J=D[C],y,v,j=J.vertexNormals,s=J.vertexColors;J instanceof b.Face3?y=new b.Face3(J.a+H,J.b+H,J.c+H):J instanceof b.Face4&&(y=new b.Face4(J.a+H,J.b+H,J.c+H,J.d+H));y.normal.copy(J.normal);K&&K.multiplyVector3(y.normal);G=0;for(B=j.length;G<B;G++){v=j[G].clone(),K&&K.multiplyVector3(v),y.vertexNormals.push(v)}y.color.copy(J.color);G=0;for(B=s.length;G<B;G++){v=s[G],y.vertexColors.push(v.clone())}if(J.materialIndex!==void 0){G=I.materials[J.materialIndex];B=z[G.id];if(B===void 0){B=N.materials.length,N.materials.push(G)}y.materialIndex=B}y.centroid.copy(J.centroid);M&&M.multiplyVector3(y.centroid);F.push(y)}C=0;for(x=A.length;C<x;C++){M=A[C];K=[];G=0;for(B=M.length;G<B;G++){K.push(new b.UV(M[G].u,M[G].v))}E.push(K)}},clone:function(x){var v=new b.Geometry,w,u=x.vertices,r=x.faces,s=x.faceVertexUvs[0];if(x.materials){v.materials=x.materials.slice()}x=0;for(w=u.length;x<w;x++){var t=new b.Vertex(u[x].position.clone());v.vertices.push(t)}x=0;for(w=r.length;x<w;x++){var q=r[x],p,m,n=q.vertexNormals,j=q.vertexColors;q instanceof b.Face3?p=new b.Face3(q.a,q.b,q.c):q instanceof b.Face4&&(p=new b.Face4(q.a,q.b,q.c,q.d));p.normal.copy(q.normal);u=0;for(t=n.length;u<t;u++){m=n[u],p.vertexNormals.push(m.clone())}p.color.copy(q.color);u=0;for(t=j.length;u<t;u++){m=j[u],p.vertexColors.push(m.clone())}p.materialIndex=q.materialIndex;p.centroid.copy(q.centroid);v.faces.push(p)}x=0;for(w=s.length;x<w;x++){r=s[x];p=[];u=0;for(t=r.length;u<t;u++){p.push(new b.UV(r[u].u,r[u].v))}v.faceVertexUvs[0].push(p)}return v},randomPointInTriangle:function(j,p,i){var o,l,m,n=new b.Vector3,k=b.GeometryUtils.__v1;o=b.GeometryUtils.random();l=b.GeometryUtils.random();o+l>1&&(o=1-o,l=1-l);m=1-o-l;n.copy(j);n.multiplyScalar(o);k.copy(p);k.multiplyScalar(l);n.addSelf(k);k.copy(i);k.multiplyScalar(m);n.addSelf(k);return n},randomPointInFace:function(i,n,h){var m,j,k;if(i instanceof b.Face3){return m=n.vertices[i.a].position,j=n.vertices[i.b].position,k=n.vertices[i.c].position,b.GeometryUtils.randomPointInTriangle(m,j,k)}else{if(i instanceof b.Face4){m=n.vertices[i.a].position;j=n.vertices[i.b].position;k=n.vertices[i.c].position;var n=n.vertices[i.d].position,l;h?i._area1&&i._area2?(h=i._area1,l=i._area2):(h=b.GeometryUtils.triangleArea(m,j,n),l=b.GeometryUtils.triangleArea(j,k,n),i._area1=h,i._area2=l):(h=b.GeometryUtils.triangleArea(m,j,n),l=b.GeometryUtils.triangleArea(j,k,n));return b.GeometryUtils.random()*(h+l)<h?b.GeometryUtils.randomPointInTriangle(m,j,n):b.GeometryUtils.randomPointInTriangle(j,k,n)}}},randomPointsInGeometry:function(B,z){function A(d){function c(h,g){if(g<h){return h}var f=h+Math.floor((g-h)/2);return r[f]>d?c(h,f-1):r[f]<d?c(f+1,g):f}return c(0,r.length-1)}var y,v,w=B.faces,x=B.vertices,u=w.length,t=0,r=[],s,n,j,q;for(v=0;v<u;v++){y=w[v];if(y instanceof b.Face3){s=x[y.a].position,n=x[y.b].position,j=x[y.c].position,y._area=b.GeometryUtils.triangleArea(s,n,j)}else{if(y instanceof b.Face4){s=x[y.a].position,n=x[y.b].position,j=x[y.c].position,q=x[y.d].position,y._area1=b.GeometryUtils.triangleArea(s,n,q),y._area2=b.GeometryUtils.triangleArea(n,j,q),y._area=y._area1+y._area2}}t+=y._area;r[v]=t}y=[];x={};for(v=0;v<z;v++){u=b.GeometryUtils.random()*t,u=A(u),y[v]=b.GeometryUtils.randomPointInFace(w[u],B,!0),x[u]?x[u]+=1:x[u]=1}return y},triangleArea:function(f,j,e){var i,h=b.GeometryUtils.__v1;h.sub(f,j);i=h.length();h.sub(f,e);f=h.length();h.sub(j,e);e=h.length();j=0.5*(i+f+e);return Math.sqrt(j*(j-i)*(j-f)*(j-e))},center:function(d){d.computeBoundingBox();var e=new b.Matrix4;e.setTranslation(-0.5*(d.boundingBox.x[1]+d.boundingBox.x[0]),-0.5*(d.boundingBox.y[1]+d.boundingBox.y[0]),-0.5*(d.boundingBox.z[1]+d.boundingBox.z[0]));d.applyMatrix(e);d.computeBoundingBox()}};b.GeometryUtils.random=b.Math.random16;b.GeometryUtils.__v1=new b.Vector3;b.ImageUtils={loadTexture:function(f,j,e){var i=new Image,h=new b.Texture(i,j);i.onload=function(){h.needsUpdate=!0;e&&e(this)};i.crossOrigin="";i.src=f;return h},loadTextureCube:function(h,l,e){var k,i=[],j=new b.Texture(i,l),l=i.loadCount=0;for(k=h.length;l<k;++l){i[l]=new Image,i[l].onload=function(){i.loadCount+=1;if(i.loadCount===6){j.needsUpdate=!0}e&&e(this)},i[l].crossOrigin="",i[l].src=h[l]}return j},getNormalMap:function(L,J){var K=function(d){var c=Math.sqrt(d[0]*d[0]+d[1]*d[1]+d[2]*d[2]);return[d[0]/c,d[1]/c,d[2]/c]};J|=1;var I=L.width,F=L.height,G=document.createElement("canvas");G.width=I;G.height=F;var H=G.getContext("2d");H.drawImage(L,0,0);for(var E=H.getImageData(0,0,I,F).data,D=H.createImageData(I,F),B=D.data,C=0;C<I;C++){for(var y=1;y<F;y++){var x=y-1<0?F-1:y-1,A=(y+1)%F,u=C-1<0?I-1:C-1,z=(C+1)%I,v=[],s=[0,0,E[(y*I+C)*4]/255*J];v.push([-1,0,E[(y*I+u)*4]/255*J]);v.push([-1,-1,E[(x*I+u)*4]/255*J]);v.push([0,-1,E[(x*I+C)*4]/255*J]);v.push([1,-1,E[(x*I+z)*4]/255*J]);v.push([1,0,E[(y*I+z)*4]/255*J]);v.push([1,1,E[(A*I+z)*4]/255*J]);v.push([0,1,E[(A*I+C)*4]/255*J]);v.push([-1,1,E[(A*I+u)*4]/255*J]);x=[];u=v.length;for(A=0;A<u;A++){var z=v[A],j=v[(A+1)%u],z=[z[0]-s[0],z[1]-s[1],z[2]-s[2]],j=[j[0]-s[0],j[1]-s[1],j[2]-s[2]];x.push(K([z[1]*j[2]-z[2]*j[1],z[2]*j[0]-z[0]*j[2],z[0]*j[1]-z[1]*j[0]]))}v=[0,0,0];for(A=0;A<x.length;A++){v[0]+=x[A][0],v[1]+=x[A][1],v[2]+=x[A][2]}v[0]/=x.length;v[1]/=x.length;v[2]/=x.length;s=(y*I+C)*4;B[s]=(v[0]+1)/2*255|0;B[s+1]=(v[1]+0.5)*255|0;B[s+2]=v[2]*255|0;B[s+3]=255}}H.putImageData(D,0,0);return G}};b.SceneUtils={showHierarchy:function(d,e){b.SceneUtils.traverseHierarchy(d,function(c){c.visible=e})},traverseHierarchy:function(f,j){var e,i,h=f.children.length;for(i=0;i<h;i++){e=f.children[i],j(e),b.SceneUtils.traverseHierarchy(e,j)}},createMultiMaterialObject:function(h,l){var e,k=l.length,i=new b.Object3D;for(e=0;e<k;e++){var j=new b.Mesh(h,l[e]);i.add(j)}return i},cloneObject:function(f){var h;f instanceof b.MorphAnimMesh?(h=new b.MorphAnimMesh(f.geometry,f.material),h.duration=f.duration,h.mirroredLoop=f.mirroredLoop,h.time=f.time,h.lastKeyframe=f.lastKeyframe,h.currentKeyframe=f.currentKeyframe,h.direction=f.direction,h.directionBackwards=f.directionBackwards):f instanceof b.SkinnedMesh?h=new b.SkinnedMesh(f.geometry,f.material):f instanceof b.Mesh?h=new b.Mesh(f.geometry,f.material):f instanceof b.Line?h=new b.Line(f.geometry,f.material,f.type):f instanceof b.Ribbon?h=new b.Ribbon(f.geometry,f.material):f instanceof b.ParticleSystem?(h=new b.ParticleSystem(f.geometry,f.material),h.sortParticles=f.sortParticles):f instanceof b.Particle?h=new b.Particle(f.material):f instanceof b.Sprite?(h=new b.Sprite({}),h.color.copy(f.color),h.map=f.map,h.blending=f.blending,h.useScreenCoordinates=f.useScreenCoordinates,h.mergeWith3D=f.mergeWith3D,h.affectedByDistance=f.affectedByDistance,h.scaleByViewport=f.scaleByViewport,h.alignment=f.alignment,h.rotation3d.copy(f.rotation3d),h.rotation=f.rotation,h.opacity=f.opacity,h.uvOffset.copy(f.uvOffset),h.uvScale.copy(f.uvScale)):f instanceof b.LOD?h=new b.LOD:f instanceof b.MarchingCubes?(h=new b.MarchingCubes(f.resolution,f.material),h.field.set(f.field),h.isolation=f.isolation):f instanceof b.Object3D&&(h=new b.Object3D);h.parent=f.parent;h.up.copy(f.up);h.position.copy(f.position);h.rotation instanceof b.Vector3&&h.rotation.copy(f.rotation);h.eulerOrder=f.eulerOrder;h.scale.copy(f.scale);h.dynamic=f.dynamic;h.doubleSided=f.doubleSided;h.flipSided=f.flipSided;h.renderDepth=f.renderDepth;h.rotationAutoUpdate=f.rotationAutoUpdate;h.matrix.copy(f.matrix);h.matrixWorld.copy(f.matrixWorld);h.matrixRotationWorld.copy(f.matrixRotationWorld);h.matrixAutoUpdate=f.matrixAutoUpdate;h.matrixWorldNeedsUpdate=f.matrixWorldNeedsUpdate;h.quaternion.copy(f.quaternion);h.useQuaternion=f.useQuaternion;h.boundRadius=f.boundRadius;h.boundRadiusScale=f.boundRadiusScale;h.visible=f.visible;h.castShadow=f.castShadow;h.receiveShadow=f.receiveShadow;h.frustumCulled=f.frustumCulled;for(var e=0;e<f.children.length;e++){var g=b.SceneUtils.cloneObject(f.children[e]);h.children[e]=g;g.parent=h}if(f instanceof b.LOD){for(e=0;e<f.LODs.length;e++){h.LODs[e]={visibleAtDistance:f.LODs[e].visibleAtDistance,object3D:h.children[e]}}}return h}};if(b.WebGLRenderer){b.ShaderUtils={lib:{fresnel:{uniforms:{mRefractionRatio:{type:"f",value:1.02},mFresnelBias:{type:"f",value:0.1},mFresnelPower:{type:"f",value:2},mFresnelScale:{type:"f",value:1},tCube:{type:"t",value:1,texture:null}},fragmentShader:"uniform samplerCube tCube;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\nvec4 refractedColor = vec4( 1.0, 1.0, 1.0, 1.0 );\nrefractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;\nrefractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;\nrefractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;\nrefractedColor.a = 1.0;\ngl_FragColor = mix( refractedColor, reflectedColor, clamp( vReflectionFactor, 0.0, 1.0 ) );\n}",vertexShader:"uniform float mRefractionRatio;\nuniform float mFresnelBias;\nuniform float mFresnelScale;\nuniform float mFresnelPower;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = normalize ( mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal );\nvec3 I = mPosition.xyz - cameraPosition;\nvReflect = reflect( I, nWorld );\nvRefract[0] = refract( normalize( I ), nWorld, mRefractionRatio );\nvRefract[1] = refract( normalize( I ), nWorld, mRefractionRatio * 0.99 );\nvRefract[2] = refract( normalize( I ), nWorld, mRefractionRatio * 0.98 );\nvReflectionFactor = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( I ), nWorld ), mFresnelPower );\ngl_Position = projectionMatrix * mvPosition;\n}"},normal:{uniforms:b.UniformsUtils.merge([b.UniformsLib.fog,b.UniformsLib.lights,b.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},tDiffuse:{type:"t",value:0,texture:null},tCube:{type:"t",value:1,texture:null},tNormal:{type:"t",value:2,texture:null},tSpecular:{type:"t",value:3,texture:null},tAO:{type:"t",value:4,texture:null},tDisplacement:{type:"t",value:5,texture:null},uNormalScale:{type:"f",value:1},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new b.Color(15658734)},uSpecularColor:{type:"c",value:new b.Color(1118481)},uAmbientColor:{type:"c",value:new b.Color(328965)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1},uReflectivity:{type:"f",value:0.5},uOffset:{type:"v2",value:new b.Vector2(0,0)},uRepeat:{type:"v2",value:new b.Vector2(1,1)}}]),fragmentShader:["uniform vec3 uAmbientColor;\nuniform vec3 uDiffuseColor;\nuniform vec3 uSpecularColor;\nuniform float uShininess;\nuniform float uOpacity;\nuniform bool enableDiffuse;\nuniform bool enableSpecular;\nuniform bool enableAO;\nuniform bool enableReflection;\nuniform sampler2D tDiffuse;\nuniform sampler2D tNormal;\nuniform sampler2D tSpecular;\nuniform sampler2D tAO;\nuniform samplerCube tCube;\nuniform float uNormalScale;\nuniform float uReflectivity;\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\nvarying vec3 vViewPosition;",b.ShaderChunk.shadowmap_pars_fragment,b.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3( 1.0 ), uOpacity );\nvec3 specularTex = vec3( 1.0 );\nvec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;\nnormalTex.xy *= uNormalScale;\nnormalTex = normalize( normalTex );\nif( enableDiffuse )\ngl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );\nif( enableAO )\ngl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;\nif( enableSpecular )\nspecularTex = texture2D( tSpecular, vUv ).xyz;\nmat3 tsb = mat3( vTangent, vBinormal, vNormal );\nvec3 finalNormal = tsb * normalTex;\nvec3 normal = normalize( finalNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec3 pointVector = normalize( vPointLight[ i ].xyz );\nvec3 pointHalfVector = normalize( vPointLight[ i ].xyz + viewPosition );\nfloat pointDistance = vPointLight[ i ].w;\nfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\nfloat pointSpecularWeight = specularTex.r * pow( pointDotNormalHalf, uShininess );\npointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;\npointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nvec3 dirHalfVector = normalize( lDirection.xyz + viewPosition );\nfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\nfloat dirSpecularWeight = specularTex.r * pow( dirDotNormalHalf, uShininess );\ndirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;\ndirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;\n}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\ngl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor) + totalSpecular;\nif ( enableReflection ) {\nvec3 wPos = cameraPosition - vViewPosition;\nvec3 vReflect = reflect( normalize( wPos ), normal );\nvec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\ngl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, uReflectivity );\n}",b.ShaderChunk.shadowmap_fragment,b.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;\nuniform vec2 uOffset;\nuniform vec2 uRepeat;\n#ifdef VERTEX_TEXTURES\nuniform sampler2D tDisplacement;\nuniform float uDisplacementScale;\nuniform float uDisplacementBias;\n#endif\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\nvarying vec3 vViewPosition;",b.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvViewPosition = -mvPosition.xyz;\nvNormal = normalize( normalMatrix * normal );\nvTangent = normalize( normalMatrix * tangent.xyz );\nvBinormal = cross( vNormal, vTangent ) * tangent.w;\nvBinormal = normalize( vBinormal );\nvUv = uv * uRepeat + uOffset;\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nvPointLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#ifdef VERTEX_TEXTURES\nvec3 dv = texture2D( tDisplacement, uv ).xyz;\nfloat df = uDisplacementScale * dv.x + uDisplacementBias;\nvec4 displacedPosition = vec4( vNormal.xyz * df, 0.0 ) + mvPosition;\ngl_Position = projectionMatrix * displacedPosition;\n#else\ngl_Position = projectionMatrix * mvPosition;\n#endif",b.ShaderChunk.shadowmap_vertex,"}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:1,texture:null},tFlip:{type:"f",value:-1}},vertexShader:"varying vec3 vViewPosition;\nvoid main() {\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvViewPosition = cameraPosition - mPosition.xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform samplerCube tCube;\nuniform float tFlip;\nvarying vec3 vViewPosition;\nvoid main() {\nvec3 wPos = cameraPosition - vViewPosition;\ngl_FragColor = textureCube( tCube, vec3( tFlip * wPos.x, wPos.yz ) );\n}"}}}}b.Curve=function(){};b.Curve.prototype.getPoint=function(){console.log("Warning, getPoint() not implemented!");return null};b.Curve.prototype.getPointAt=function(c){return this.getPoint(this.getUtoTmapping(c))};b.Curve.prototype.getPoints=function(e){e||(e=5);var f,d=[];for(f=0;f<=e;f++){d.push(this.getPoint(f/e))}return d};b.Curve.prototype.getSpacedPoints=function(e){e||(e=5);var f,d=[];for(f=0;f<=e;f++){d.push(this.getPointAt(f/e))}return d};b.Curve.prototype.getLength=function(){var c=this.getLengths();return c[c.length-1]};b.Curve.prototype.getLengths=function(h){h||(h=200);if(this.cacheArcLengths&&this.cacheArcLengths.length==h+1){return this.cacheArcLengths}var l=[],e,k=this.getPoint(0),i,j=0;l.push(0);for(i=1;i<=h;i++){e=this.getPoint(i/h),j+=e.distanceTo(k),l.push(j),k=e}return this.cacheArcLengths=l};b.Curve.prototype.getUtoTmapping=function(r,p){var q=this.getLengths(),o=0,l=q.length,m;m=p?p:r*q[l-1];for(var n=0,k=l-1,j;n<=k;){if(o=Math.floor(n+(k-n)/2),j=q[o]-m,j<0){n=o+1}else{if(j>0){k=o-1}else{k=o;break}}}o=k;if(q[o]==m){return o/(l-1)}n=q[o];return q=(o+(m-n)/(q[o+1]-n))/(l-1)};b.Curve.prototype.getNormalVector=function(c){c=this.getTangent(c);return new b.Vector2(-c.y,c.x)};b.Curve.prototype.getTangent=function(d){var e=d-0.0001;d+=0.0001;e<0&&(e=0);d>1&&(d=1);e=this.getPoint(e);d=this.getPoint(d);return e.clone().subSelf(d).normalize()};b.Curve.prototype.getTangentAt=function(c){return this.getTangent(this.getUtoTmapping(c))};b.LineCurve=function(d,e){d instanceof b.Vector2?(this.v1=d,this.v2=e):b.LineCurve.oldConstructor.apply(this,arguments)};b.LineCurve.oldConstructor=function(f,h,e,g){this.constructor(new b.Vector2(f,h),new b.Vector2(e,g))};b.LineCurve.prototype=new b.Curve;b.LineCurve.prototype.constructor=b.LineCurve;b.LineCurve.prototype.getPoint=function(d){var e=new b.Vector2;e.sub(this.v2,this.v1);e.multiplyScalar(d).addSelf(this.v1);return e};b.LineCurve.prototype.getPointAt=function(c){return this.getPoint(c)};b.LineCurve.prototype.getTangent=function(){var c=new b.Vector2;c.sub(this.v2,this.v1);c.normalize();return c};b.QuadraticBezierCurve=function(f,h,e){if(!(h instanceof b.Vector2)){var g=Array.prototype.slice.call(arguments),f=new b.Vector2(g[0],g[1]),h=new b.Vector2(g[2],g[3]),e=new b.Vector2(g[4],g[5])}this.v0=f;this.v1=h;this.v2=e};b.QuadraticBezierCurve.prototype=new b.Curve;b.QuadraticBezierCurve.prototype.constructor=b.QuadraticBezierCurve;b.QuadraticBezierCurve.prototype.getPoint=function(d){var e;e=b.Shape.Utils.b2(d,this.v0.x,this.v1.x,this.v2.x);d=b.Shape.Utils.b2(d,this.v0.y,this.v1.y,this.v2.y);return new b.Vector2(e,d)};b.QuadraticBezierCurve.prototype.getTangent=function(d){var e;e=b.Curve.Utils.tangentQuadraticBezier(d,this.v0.x,this.v1.x,this.v2.x);d=b.Curve.Utils.tangentQuadraticBezier(d,this.v0.y,this.v1.y,this.v2.y);e=new b.Vector2(e,d);e.normalize();return e};b.CubicBezierCurve=function(f,j,e,i){if(!(j instanceof b.Vector2)){var h=Array.prototype.slice.call(arguments),f=new b.Vector2(h[0],h[1]),j=new b.Vector2(h[2],h[3]),e=new b.Vector2(h[4],h[5]),i=new b.Vector2(h[6],h[7])}this.v0=f;this.v1=j;this.v2=e;this.v3=i};b.CubicBezierCurve.prototype=new b.Curve;b.CubicBezierCurve.prototype.constructor=b.CubicBezierCurve;b.CubicBezierCurve.prototype.getPoint=function(d){var e;e=b.Shape.Utils.b3(d,this.v0.x,this.v1.x,this.v2.x,this.v3.x);d=b.Shape.Utils.b3(d,this.v0.y,this.v1.y,this.v2.y,this.v3.y);return new b.Vector2(e,d)};b.CubicBezierCurve.prototype.getTangent=function(d){var e;e=b.Curve.Utils.tangentCubicBezier(d,this.v0.x,this.v1.x,this.v2.x,this.v3.x);d=b.Curve.Utils.tangentCubicBezier(d,this.v0.y,this.v1.y,this.v2.y,this.v3.y);e=new b.Vector2(e,d);e.normalize();return e};b.SplineCurve=function(c){this.points=c==void 0?[]:c};b.SplineCurve.prototype=new b.Curve;b.SplineCurve.prototype.constructor=b.SplineCurve;b.SplineCurve.prototype.getPoint=function(f){var j=new b.Vector2,e=[],i=this.points,h;h=(i.length-1)*f;f=Math.floor(h);h-=f;e[0]=f==0?f:f-1;e[1]=f;e[2]=f>i.length-2?f:f+1;e[3]=f>i.length-3?f:f+2;j.x=b.Curve.Utils.interpolate(i[e[0]].x,i[e[1]].x,i[e[2]].x,i[e[3]].x,h);j.y=b.Curve.Utils.interpolate(i[e[0]].y,i[e[1]].y,i[e[2]].y,i[e[3]].y,h);return j};b.ArcCurve=function(h,l,e,k,i,j){this.aX=h;this.aY=l;this.aRadius=e;this.aStartAngle=k;this.aEndAngle=i;this.aClockwise=j};b.ArcCurve.prototype=new b.Curve;b.ArcCurve.prototype.constructor=b.ArcCurve;b.ArcCurve.prototype.getPoint=function(d){var e=this.aEndAngle-this.aStartAngle;this.aClockwise||(d=1-d);d=this.aStartAngle+d*e;return new b.Vector2(this.aX+this.aRadius*Math.cos(d),this.aY+this.aRadius*Math.sin(d))};b.Curve.Utils={tangentQuadraticBezier:function(f,h,e,g){return 2*(1-f)*(e-h)+2*f*(g-e)},tangentCubicBezier:function(f,j,e,i,h){return -3*j*(1-f)*(1-f)+3*e*(1-f)*(1-f)-6*f*e*(1-f)+6*f*i*(1-f)-3*f*f*i+3*f*f*h},tangentSpline:function(c){return 6*c*c-6*c+(3*c*c-4*c+1)+(-6*c*c+6*c)+(3*c*c-2*c)},interpolate:function(h,l,e,k,i){var h=(e-h)*0.5,k=(k-l)*0.5,j=i*i;return(2*l-2*e+h+k)*i*j+(-3*l+3*e-2*h-k)*j+h*i+l}};b.Curve.create=function(d,e){d.prototype=new b.Curve;d.prototype.constructor=d;d.prototype.getPoint=e;return d};b.LineCurve3=b.Curve.create(function(d,e){this.v1=d;this.v2=e},function(d){var e=new b.Vector3;e.sub(this.v2,this.v1);e.multiplyScalar(d);e.addSelf(this.v1);return e});b.QuadraticBezierCurve3=b.Curve.create(function(e,f,d){this.v0=e;this.v1=f;this.v2=d},function(e){var f,d;f=b.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x);d=b.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y);e=b.Shape.Utils.b2(e,this.v0.z,this.v1.z,this.v2.z);return new b.Vector3(f,d,e)});b.CubicBezierCurve3=b.Curve.create(function(f,h,e,g){this.v0=f;this.v1=h;this.v2=e;this.v3=g},function(e){var f,d;f=b.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x);d=b.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y);e=b.Shape.Utils.b3(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z);return new b.Vector3(f,d,e)});b.SplineCurve3=b.Curve.create(function(c){this.points=c==void 0?[]:c},function(f){var j=new b.Vector3,e=[],i=this.points,h;h=(i.length-1)*f;f=Math.floor(h);h-=f;e[0]=f==0?f:f-1;e[1]=f;e[2]=f>i.length-2?f:f+1;e[3]=f>i.length-3?f:f+2;j.x=b.Curve.Utils.interpolate(i[e[0]].x,i[e[1]].x,i[e[2]].x,i[e[3]].x,h);j.y=b.Curve.Utils.interpolate(i[e[0]].y,i[e[1]].y,i[e[2]].y,i[e[3]].y,h);j.z=b.Curve.Utils.interpolate(i[e[0]].z,i[e[1]].z,i[e[2]].z,i[e[3]].z,h);return j});b.CurvePath=function(){this.curves=[];this.bends=[]};b.CurvePath.prototype=new b.Curve;b.CurvePath.prototype.constructor=b.CurvePath;b.CurvePath.prototype.add=function(c){this.curves.push(c)};b.CurvePath.prototype.checkConnection=function(){};b.CurvePath.prototype.closePath=function(){};b.CurvePath.prototype.getPoint=function(e){for(var f=e*this.getLength(),d=this.getCurveLengths(),e=0;e<d.length;){if(d[e]>=f){return f=d[e]-f,e=this.curves[e],f=1-f/e.getLength(),e.getPointAt(f)}e++}return null};b.CurvePath.prototype.getLength=function(){var c=this.getCurveLengths();return c[c.length-1]};b.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length){return this.cacheLengths}var f=[],h=0,e,g=this.curves.length;for(e=0;e<g;e++){h+=this.curves[e].getLength(),f.push(h)}return this.cacheLengths=f};b.CurvePath.prototype.getBoundingBox=function(){var r=this.getPoints(),p,q,o,l;p=q=Number.NEGATIVE_INFINITY;o=l=Number.POSITIVE_INFINITY;var m,n,k,j;j=new b.Vector2;n=0;for(k=r.length;n<k;n++){m=r[n];if(m.x>p){p=m.x}else{if(m.x<o){o=m.x}}if(m.y>q){q=m.y}else{if(m.y<q){l=m.y}}j.addSelf(m.x,m.y)}return{minX:o,minY:l,maxX:p,maxY:q,centroid:j.divideScalar(k)}};b.CurvePath.prototype.createPointsGeometry=function(c){return this.createGeometry(this.getPoints(c,!0))};b.CurvePath.prototype.createSpacedPointsGeometry=function(c){return this.createGeometry(this.getSpacedPoints(c,!0))};b.CurvePath.prototype.createGeometry=function(e){for(var f=new b.Geometry,d=0;d<e.length;d++){f.vertices.push(new b.Vertex(new b.Vector3(e[d].x,e[d].y,0)))}return f};b.CurvePath.prototype.addWrapPath=function(c){this.bends.push(c)};b.CurvePath.prototype.getTransformedPoints=function(f,j){var e=this.getPoints(f),i,h;if(!j){j=this.bends}i=0;for(h=j.length;i<h;i++){e=this.getWrapPoints(e,j[i])}return e};b.CurvePath.prototype.getTransformedSpacedPoints=function(f,j){var e=this.getSpacedPoints(f),i,h;if(!j){j=this.bends}i=0;for(h=j.length;i<h;i++){e=this.getWrapPoints(e,j[i])}return e};b.CurvePath.prototype.getWrapPoints=function(r,p){var q=this.getBoundingBox(),o,l,m,n,k,j;o=0;for(l=r.length;o<l;o++){m=r[o],n=m.x,k=m.y,j=n/q.maxX,j=p.getUtoTmapping(j,n),n=p.getPoint(j),k=p.getNormalVector(j).multiplyScalar(k),m.x=n.x+k.x,m.y=n.y+k.y}return r};b.Path=function(c){b.CurvePath.call(this);this.actions=[];c&&this.fromPoints(c)};b.Path.prototype=new b.CurvePath;b.Path.prototype.constructor=b.Path;b.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc"};b.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);var f,d=e.length;for(f=1;f<d;f++){this.lineTo(e[f].x,e[f].y)}};b.Path.prototype.moveTo=function(){var c=Array.prototype.slice.call(arguments);this.actions.push({action:b.PathActions.MOVE_TO,args:c})};b.Path.prototype.lineTo=function(f,h){var e=Array.prototype.slice.call(arguments),g=this.actions[this.actions.length-1].args;this.curves.push(new b.LineCurve(new b.Vector2(g[g.length-2],g[g.length-1]),new b.Vector2(f,h)));this.actions.push({action:b.PathActions.LINE_TO,args:e})};b.Path.prototype.quadraticCurveTo=function(h,l,e,k){var i=Array.prototype.slice.call(arguments),j=this.actions[this.actions.length-1].args;this.curves.push(new b.QuadraticBezierCurve(new b.Vector2(j[j.length-2],j[j.length-1]),new b.Vector2(h,l),new b.Vector2(e,k)));this.actions.push({action:b.PathActions.QUADRATIC_CURVE_TO,args:i})};b.Path.prototype.bezierCurveTo=function(j,p,i,o,l,m){var n=Array.prototype.slice.call(arguments),k=this.actions[this.actions.length-1].args;this.curves.push(new b.CubicBezierCurve(new b.Vector2(k[k.length-2],k[k.length-1]),new b.Vector2(j,p),new b.Vector2(i,o),new b.Vector2(l,m)));this.actions.push({action:b.PathActions.BEZIER_CURVE_TO,args:n})};b.Path.prototype.splineThru=function(e){var f=Array.prototype.slice.call(arguments),d=this.actions[this.actions.length-1].args,d=[new b.Vector2(d[d.length-2],d[d.length-1])];Array.prototype.push.apply(d,e);this.curves.push(new b.SplineCurve(d));this.actions.push({action:b.PathActions.CSPLINE_THRU,args:f})};b.Path.prototype.arc=function(i,n,h,m,j,k){var l=Array.prototype.slice.call(arguments);this.curves.push(new b.ArcCurve(i,n,h,m,j,k));this.actions.push({action:b.PathActions.ARC,args:l})};b.Path.prototype.getSpacedPoints=function(e){e||(e=40);for(var f=[],d=0;d<e;d++){f.push(this.getPoint(d/e))}return f};b.Path.prototype.getPoints=function(H,F){var H=H||12,G=[],E,B,C,D,A,z,x,y,u,t,w,j,v;E=0;for(B=this.actions.length;E<B;E++){switch(C=this.actions[E],D=C.action,C=C.args,D){case b.PathActions.LINE_TO:G.push(new b.Vector2(C[0],C[1]));break;case b.PathActions.QUADRATIC_CURVE_TO:A=C[2];z=C[3];u=C[0];t=C[1];G.length>0?(D=G[G.length-1],w=D.x,j=D.y):(D=this.actions[E-1].args,w=D[D.length-2],j=D[D.length-1]);for(D=1;D<=H;D++){v=D/H,C=b.Shape.Utils.b2(v,w,u,A),v=b.Shape.Utils.b2(v,j,t,z),G.push(new b.Vector2(C,v))}break;case b.PathActions.BEZIER_CURVE_TO:A=C[4];z=C[5];u=C[0];t=C[1];x=C[2];y=C[3];G.length>0?(D=G[G.length-1],w=D.x,j=D.y):(D=this.actions[E-1].args,w=D[D.length-2],j=D[D.length-1]);for(D=1;D<=H;D++){v=D/H,C=b.Shape.Utils.b3(v,w,u,x,A),v=b.Shape.Utils.b3(v,j,t,y,z),G.push(new b.Vector2(C,v))}break;case b.PathActions.CSPLINE_THRU:D=this.actions[E-1].args;D=[new b.Vector2(D[D.length-2],D[D.length-1])];v=H*C[0].length;D=D.concat(C[0]);C=new b.SplineCurve(D);for(D=1;D<=v;D++){G.push(C.getPointAt(D/v))}break;case b.PathActions.ARC:D=this.actions[E-1].args;A=C[0];z=C[1];x=C[2];u=C[3];v=C[4];t=!!C[5];y=D[D.length-2];w=D[D.length-1];D.length==0&&(y=w=0);j=v-u;var s=H*2;for(D=1;D<=s;D++){v=D/s,t||(v=1-v),v=u+v*j,C=y+A+x*Math.cos(v),v=w+z+x*Math.sin(v),G.push(new b.Vector2(C,v))}}}F&&G.push(G[0]);return G};b.Path.prototype.transform=function(d,e){this.getBoundingBox();return this.getWrapPoints(this.getPoints(e),d)};b.Path.prototype.nltransform=function(x,v,w,u,r,s){var t=this.getPoints(),q,p,m,n,j;q=0;for(p=t.length;q<p;q++){m=t[q],n=m.x,j=m.y,m.x=x*n+v*j+w,m.y=u*j+r*n+s}return t};b.Path.prototype.debug=function(f){var j=this.getBoundingBox();f||(f=document.createElement("canvas"),f.setAttribute("width",j.maxX+100),f.setAttribute("height",j.maxY+100),document.body.appendChild(f));j=f.getContext("2d");j.fillStyle="white";j.fillRect(0,0,f.width,f.height);j.strokeStyle="black";j.beginPath();var e,i,h,f=0;for(e=this.actions.length;f<e;f++){i=this.actions[f],h=i.args,i=i.action,i!=b.PathActions.CSPLINE_THRU&&j[i].apply(j,h)}j.stroke();j.closePath();j.strokeStyle="red";i=this.getPoints();f=0;for(e=i.length;f<e;f++){h=i[f],j.beginPath(),j.arc(h.x,h.y,1.5,0,Math.PI*2,!1),j.stroke(),j.closePath()}};b.Path.prototype.toShapes=function(){var i,n,h,m,j=[],k=new b.Path;i=0;for(n=this.actions.length;i<n;i++){h=this.actions[i],m=h.args,h=h.action,h==b.PathActions.MOVE_TO&&k.actions.length!=0&&(j.push(k),k=new b.Path),k[h].apply(k,m)}k.actions.length!=0&&j.push(k);if(j.length==0){return[]}var l,k=[];if(b.Shape.Utils.isClockWise(j[0].getPoints())){i=0;for(n=j.length;i<n;i++){m=j[i],b.Shape.Utils.isClockWise(m.getPoints())?(l&&k.push(l),l=new b.Shape,l.actions=m.actions,l.curves=m.curves):l.holes.push(m)}k.push(l)}else{l=new b.Shape;i=0;for(n=j.length;i<n;i++){m=j[i],b.Shape.Utils.isClockWise(m.getPoints())?(l.actions=m.actions,l.curves=m.curves,k.push(l),l=new b.Shape):l.holes.push(m)}}return k};b.Shape=function(){b.Path.apply(this,arguments);this.holes=[]};b.Shape.prototype=new b.Path;b.Shape.prototype.constructor=b.Path;b.Shape.prototype.extrude=function(c){return new b.ExtrudeGeometry(this,c)};b.Shape.prototype.getPointsHoles=function(f){var h,e=this.holes.length,g=[];for(h=0;h<e;h++){g[h]=this.holes[h].getTransformedPoints(f,this.bends)}return g};b.Shape.prototype.getSpacedPointsHoles=function(f){var h,e=this.holes.length,g=[];for(h=0;h<e;h++){g[h]=this.holes[h].getTransformedSpacedPoints(f,this.bends)}return g};b.Shape.prototype.extractAllPoints=function(c){return{shape:this.getTransformedPoints(c),holes:this.getPointsHoles(c)}};b.Shape.prototype.extractAllSpacedPoints=function(c){return{shape:this.getTransformedSpacedPoints(c),holes:this.getSpacedPointsHoles(c)}};b.Shape.Utils={removeHoles:function(H,F){var G=H.concat(),E=G.concat(),B,C,D,A,z,x,y,u,t,w,j=[];for(z=0;z<F.length;z++){x=F[z];Array.prototype.push.apply(E,x);C=Number.POSITIVE_INFINITY;for(B=0;B<x.length;B++){t=x[B];w=[];for(u=0;u<G.length;u++){y=G[u],y=t.distanceToSquared(y),w.push(y),y<C&&(C=y,D=B,A=u)}}B=A-1>=0?A-1:G.length-1;C=D-1>=0?D-1:x.length-1;var v=[x[D],G[A],G[B]];u=b.FontUtils.Triangulate.area(v);var s=[x[D],x[C],G[A]];t=b.FontUtils.Triangulate.area(s);w=A;y=D;A+=1;D+=-1;A<0&&(A+=G.length);A%=G.length;D<0&&(D+=x.length);D%=x.length;B=A-1>=0?A-1:G.length-1;C=D-1>=0?D-1:x.length-1;v=[x[D],G[A],G[B]];v=b.FontUtils.Triangulate.area(v);s=[x[D],x[C],G[A]];s=b.FontUtils.Triangulate.area(s);u+t>v+s&&(A=w,D=y,A<0&&(A+=G.length),A%=G.length,D<0&&(D+=x.length),D%=x.length,B=A-1>=0?A-1:G.length-1,C=D-1>=0?D-1:x.length-1);u=G.slice(0,A);t=G.slice(A);w=x.slice(D);y=x.slice(0,D);C=[x[D],x[C],G[A]];j.push([x[D],G[A],G[B]]);j.push(C);G=u.concat(w).concat(y).concat(t)}return{shape:G,isolatedPts:j,allpoints:E}},triangulateShape:function(t,r){var s=b.Shape.Utils.removeHoles(t,r),q=s.allpoints,n=s.isolatedPts,s=b.FontUtils.Triangulate(s.shape,!1),o,p,m,k,j={};o=0;for(p=q.length;o<p;o++){k=q[o].x+":"+q[o].y,j[k]!==void 0&&console.log("Duplicate point",k),j[k]=o}o=0;for(p=s.length;o<p;o++){m=s[o];for(q=0;q<3;q++){k=m[q].x+":"+m[q].y,k=j[k],k!==void 0&&(m[q]=k)}}o=0;for(p=n.length;o<p;o++){m=n[o];for(q=0;q<3;q++){k=m[q].x+":"+m[q].y,k=j[k],k!==void 0&&(m[q]=k)}}return s.concat(n)},isClockWise:function(c){return b.FontUtils.Triangulate.area(c)<0},b2p0:function(e,f){var d=1-e;return d*d*f},b2p1:function(d,e){return 2*(1-d)*d*e},b2p2:function(d,e){return d*d*e},b2:function(f,h,e,g){return this.b2p0(f,h)+this.b2p1(f,e)+this.b2p2(f,g)},b3p0:function(e,f){var d=1-e;return d*d*d*f},b3p1:function(e,f){var d=1-e;return 3*d*d*e*f},b3p2:function(d,e){return 3*(1-d)*d*d*e},b3p3:function(d,e){return d*d*d*e},b3:function(f,j,e,i,h){return this.b3p0(f,j)+this.b3p1(f,e)+this.b3p2(f,i)+this.b3p3(f,h)}};b.TextPath=function(d,e){b.Path.call(this);this.parameters=e||{};this.set(d)};b.TextPath.prototype.set=function(h,l){this.text=h;var l=l||this.parameters,e=l.curveSegments!==void 0?l.curveSegments:4,k=l.font!==void 0?l.font:"helvetiker",i=l.weight!==void 0?l.weight:"normal",j=l.style!==void 0?l.style:"normal";b.FontUtils.size=l.size!==void 0?l.size:100;b.FontUtils.divisions=e;b.FontUtils.face=k;b.FontUtils.weight=i;b.FontUtils.style=j};b.TextPath.prototype.toShapes=function(){for(var f=b.FontUtils.drawText(this.text).paths,h=[],e=0,g=f.length;e<g;e++){Array.prototype.push.apply(h,f[e].toShapes())}return h};b.AnimationHandler=function(){var f=[],h={},e={update:function(d){for(var i=0;i<f.length;i++){f[i].update(d)}},addToUpdate:function(c){f.indexOf(c)===-1&&f.push(c)},removeFromUpdate:function(c){c=f.indexOf(c);c!==-1&&f.splice(c,1)},add:function(m){h[m.name]!==void 0&&console.log("THREE.AnimationHandler.add: Warning! "+m.name+" already exists in library. Overwriting.");h[m.name]=m;if(m.initialized!==!0){for(var c=0;c<m.hierarchy.length;c++){for(var q=0;q<m.hierarchy[c].keys.length;q++){if(m.hierarchy[c].keys[q].time<0){m.hierarchy[c].keys[q].time=0}if(m.hierarchy[c].keys[q].rot!==void 0&&!(m.hierarchy[c].keys[q].rot instanceof b.Quaternion)){var p=m.hierarchy[c].keys[q].rot;m.hierarchy[c].keys[q].rot=new b.Quaternion(p[0],p[1],p[2],p[3])}}if(m.hierarchy[c].keys[0].morphTargets!==void 0){p={};for(q=0;q<m.hierarchy[c].keys.length;q++){for(var o=0;o<m.hierarchy[c].keys[q].morphTargets.length;o++){var j=m.hierarchy[c].keys[q].morphTargets[o];p[j]=-1}}m.hierarchy[c].usedMorphTargets=p;for(q=0;q<m.hierarchy[c].keys.length;q++){var n={};for(j in p){for(o=0;o<m.hierarchy[c].keys[q].morphTargets.length;o++){if(m.hierarchy[c].keys[q].morphTargets[o]===j){n[j]=m.hierarchy[c].keys[q].morphTargetsInfluences[o];break}}o===m.hierarchy[c].keys[q].morphTargets.length&&(n[j]=0)}m.hierarchy[c].keys[q].morphTargetsInfluences=n}}for(q=1;q<m.hierarchy[c].keys.length;q++){m.hierarchy[c].keys[q].time===m.hierarchy[c].keys[q-1].time&&(m.hierarchy[c].keys.splice(q,1),q--)}for(q=1;q<m.hierarchy[c].keys.length;q++){m.hierarchy[c].keys[q].index=q}}q=parseInt(m.length*m.fps,10);m.JIT={};m.JIT.hierarchy=[];for(c=0;c<m.hierarchy.length;c++){m.JIT.hierarchy.push(Array(q))}m.initialized=!0}},get:function(c){if(typeof c==="string"){return h[c]?h[c]:(console.log("THREE.AnimationHandler.get: Couldn't find animation "+c),null)}},parse:function(i){var d=[];if(i instanceof b.SkinnedMesh){for(var j=0;j<i.bones.length;j++){d.push(i.bones[j])}}else{g(i,d)}return d}},g=function(i,d){d.push(i);for(var j=0;j<i.children.length;j++){g(i.children[j],d)}};e.LINEAR=0;e.CATMULLROM=1;e.CATMULLROM_FORWARD=2;return e}();b.Animation=function(f,h,e,g){this.root=f;this.data=b.AnimationHandler.get(h);this.hierarchy=b.AnimationHandler.parse(f);this.currentTime=0;this.timeScale=1;this.isPlaying=!1;this.loop=this.isPaused=!0;this.interpolationType=e!==void 0?e:b.AnimationHandler.LINEAR;this.JITCompile=g!==void 0?g:!0;this.points=[];this.target=new b.Vector3};b.Animation.prototype.play=function(h,l){if(!this.isPlaying){this.isPlaying=!0;this.loop=h!==void 0?h:!0;this.currentTime=l!==void 0?l:0;var e,k=this.hierarchy.length,i;for(e=0;e<k;e++){i=this.hierarchy[e];if(this.interpolationType!==b.AnimationHandler.CATMULLROM_FORWARD){i.useQuaternion=!0}i.matrixAutoUpdate=!0;if(i.animationCache===void 0){i.animationCache={},i.animationCache.prevKey={pos:0,rot:0,scl:0},i.animationCache.nextKey={pos:0,rot:0,scl:0},i.animationCache.originalMatrix=i instanceof b.Bone?i.skinMatrix:i.matrix}var j=i.animationCache.prevKey;i=i.animationCache.nextKey;j.pos=this.data.hierarchy[e].keys[0];j.rot=this.data.hierarchy[e].keys[0];j.scl=this.data.hierarchy[e].keys[0];i.pos=this.getNextKeyWith("pos",e,1);i.rot=this.getNextKeyWith("rot",e,1);i.scl=this.getNextKeyWith("scl",e,1)}this.update(0)}this.isPaused=!1;b.AnimationHandler.addToUpdate(this)};b.Animation.prototype.pause=function(){this.isPaused?b.AnimationHandler.addToUpdate(this):b.AnimationHandler.removeFromUpdate(this);this.isPaused=!this.isPaused};b.Animation.prototype.stop=function(){this.isPaused=this.isPlaying=!1;b.AnimationHandler.removeFromUpdate(this);for(var c=0;c<this.hierarchy.length;c++){if(this.hierarchy[c].animationCache!==void 0){this.hierarchy[c] instanceof b.Bone?this.hierarchy[c].skinMatrix=this.hierarchy[c].animationCache.originalMatrix:this.hierarchy[c].matrix=this.hierarchy[c].animationCache.originalMatrix,delete this.hierarchy[c].animationCache}}};b.Animation.prototype.update=function(F){if(this.isPlaying){var D=["pos","rot","scl"],E,C,z,A,B,y,x,v,w=this.data.JIT.hierarchy,s,q;this.currentTime+=F*this.timeScale;q=this.currentTime;s=this.currentTime%=this.data.length;v=parseInt(Math.min(s*this.data.fps,this.data.length*this.data.fps),10);for(var u=0,j=this.hierarchy.length;u<j;u++){if(F=this.hierarchy[u],x=F.animationCache,this.JITCompile&&w[u][v]!==void 0){F instanceof b.Bone?(F.skinMatrix=w[u][v],F.matrixAutoUpdate=!1,F.matrixWorldNeedsUpdate=!1):(F.matrix=w[u][v],F.matrixAutoUpdate=!1,F.matrixWorldNeedsUpdate=!0)}else{if(this.JITCompile){F instanceof b.Bone?F.skinMatrix=F.animationCache.originalMatrix:F.matrix=F.animationCache.originalMatrix}for(var t=0;t<3;t++){E=D[t];B=x.prevKey[E];y=x.nextKey[E];if(y.time<=q){if(s<q){if(this.loop){B=this.data.hierarchy[u].keys[0];for(y=this.getNextKeyWith(E,u,1);y.time<s;){B=y,y=this.getNextKeyWith(E,u,y.index+1)}}else{this.stop();return}}else{do{B=y,y=this.getNextKeyWith(E,u,y.index+1)}while(y.time<s)}x.prevKey[E]=B;x.nextKey[E]=y}F.matrixAutoUpdate=!0;F.matrixWorldNeedsUpdate=!0;C=(s-B.time)/(y.time-B.time);z=B[E];A=y[E];if(C<0||C>1){console.log("THREE.Animation.update: Warning! Scale out of bounds:"+C+" on bone "+u),C=C<0?0:1}if(E==="pos"){if(E=F.position,this.interpolationType===b.AnimationHandler.LINEAR){E.x=z[0]+(A[0]-z[0])*C,E.y=z[1]+(A[1]-z[1])*C,E.z=z[2]+(A[2]-z[2])*C}else{if(this.interpolationType===b.AnimationHandler.CATMULLROM||this.interpolationType===b.AnimationHandler.CATMULLROM_FORWARD){if(this.points[0]=this.getPrevKeyWith("pos",u,B.index-1).pos,this.points[1]=z,this.points[2]=A,this.points[3]=this.getNextKeyWith("pos",u,y.index+1).pos,C=C*0.33+0.33,z=this.interpolateCatmullRom(this.points,C),E.x=z[0],E.y=z[1],E.z=z[2],this.interpolationType===b.AnimationHandler.CATMULLROM_FORWARD){C=this.interpolateCatmullRom(this.points,C*1.01),this.target.set(C[0],C[1],C[2]),this.target.subSelf(E),this.target.y=0,this.target.normalize(),C=Math.atan2(this.target.x,this.target.z),F.rotation.set(0,C,0)}}}}else{if(E==="rot"){b.Quaternion.slerp(z,A,F.quaternion,C)}else{if(E==="scl"){E=F.scale,E.x=z[0]+(A[0]-z[0])*C,E.y=z[1]+(A[1]-z[1])*C,E.z=z[2]+(A[2]-z[2])*C}}}}}}if(this.JITCompile&&w[0][v]===void 0){this.hierarchy[0].update(null,!0);for(u=0;u<this.hierarchy.length;u++){w[u][v]=this.hierarchy[u] instanceof b.Bone?this.hierarchy[u].skinMatrix.clone():this.hierarchy[u].matrix.clone()}}}};b.Animation.prototype.interpolateCatmullRom=function(t,r){var s=[],q=[],n,o,p,m,k,j;n=(t.length-1)*r;o=Math.floor(n);n-=o;s[0]=o===0?o:o-1;s[1]=o;s[2]=o>t.length-2?o:o+1;s[3]=o>t.length-3?o:o+2;o=t[s[0]];m=t[s[1]];k=t[s[2]];j=t[s[3]];s=n*n;p=n*s;q[0]=this.interpolate(o[0],m[0],k[0],j[0],n,s,p);q[1]=this.interpolate(o[1],m[1],k[1],j[1],n,s,p);q[2]=this.interpolate(o[2],m[2],k[2],j[2],n,s,p);return q};b.Animation.prototype.interpolate=function(i,n,h,m,j,k,l){i=(h-i)*0.5;m=(m-n)*0.5;return(2*(n-h)+i+m)*l+(-3*(n-h)-2*i-m)*k+i*j+n};b.Animation.prototype.getNextKeyWith=function(f,h,e){var g=this.data.hierarchy[h].keys;for(this.interpolationType===b.AnimationHandler.CATMULLROM||this.interpolationType===b.AnimationHandler.CATMULLROM_FORWARD?e=e<g.length-1?e:g.length-1:e%=g.length;e<g.length;e++){if(g[e][f]!==void 0){return g[e]}}return this.data.hierarchy[h].keys[0]};b.Animation.prototype.getPrevKeyWith=function(f,h,e){for(var g=this.data.hierarchy[h].keys,e=this.interpolationType===b.AnimationHandler.CATMULLROM||this.interpolationType===b.AnimationHandler.CATMULLROM_FORWARD?e>0?e:0:e>=0?e:e+g.length;e>=0;e--){if(g[e][f]!==void 0){return g[e]}}return this.data.hierarchy[h].keys[g.length-1]};b.CubeCamera=function(f,h,e,g){this.heightOffset=e;this.position=new b.Vector3(0,e,0);this.cameraPX=new b.PerspectiveCamera(90,1,f,h);this.cameraNX=new b.PerspectiveCamera(90,1,f,h);this.cameraPY=new b.PerspectiveCamera(90,1,f,h);this.cameraNY=new b.PerspectiveCamera(90,1,f,h);this.cameraPZ=new b.PerspectiveCamera(90,1,f,h);this.cameraNZ=new b.PerspectiveCamera(90,1,f,h);this.cameraPX.position=this.position;this.cameraNX.position=this.position;this.cameraPY.position=this.position;this.cameraNY.position=this.position;this.cameraPZ.position=this.position;this.cameraNZ.position=this.position;this.cameraPX.up.set(0,-1,0);this.cameraNX.up.set(0,-1,0);this.cameraPY.up.set(0,0,1);this.cameraNY.up.set(0,0,-1);this.cameraPZ.up.set(0,-1,0);this.cameraNZ.up.set(0,-1,0);this.targetPX=new b.Vector3(0,0,0);this.targetNX=new b.Vector3(0,0,0);this.targetPY=new b.Vector3(0,0,0);this.targetNY=new b.Vector3(0,0,0);this.targetPZ=new b.Vector3(0,0,0);this.targetNZ=new b.Vector3(0,0,0);this.renderTarget=new b.WebGLRenderTargetCube(g,g,{format:b.RGBFormat,magFilter:b.LinearFilter,minFilter:b.LinearFilter});this.updatePosition=function(c){this.position.copy(c);this.position.y+=this.heightOffset;this.targetPX.copy(this.position);this.targetNX.copy(this.position);this.targetPY.copy(this.position);this.targetNY.copy(this.position);this.targetPZ.copy(this.position);this.targetNZ.copy(this.position);this.targetPX.x+=1;this.targetNX.x-=1;this.targetPY.y+=1;this.targetNY.y-=1;this.targetPZ.z+=1;this.targetNZ.z-=1;this.cameraPX.lookAt(this.targetPX);this.cameraNX.lookAt(this.targetNX);this.cameraPY.lookAt(this.targetPY);this.cameraNY.lookAt(this.targetNY);this.cameraPZ.lookAt(this.targetPZ);this.cameraNZ.lookAt(this.targetNZ)};this.updateCubeMap=function(i,d){var j=this.renderTarget;j.activeCubeFace=0;i.render(d,this.cameraPX,j);j.activeCubeFace=1;i.render(d,this.cameraNX,j);j.activeCubeFace=2;i.render(d,this.cameraPY,j);j.activeCubeFace=3;i.render(d,this.cameraNY,j);j.activeCubeFace=4;i.render(d,this.cameraPZ,j);j.activeCubeFace=5;i.render(d,this.cameraNZ,j)}};b.FirstPersonCamera=function(){console.warn("DEPRECATED: FirstPersonCamera() is FirstPersonControls().")};b.PathCamera=function(){console.warn("DEPRECATED: PathCamera() is PathControls().")};b.FlyCamera=function(){console.warn("DEPRECATED: FlyCamera() is FlyControls().")};b.RollCamera=function(){console.warn("DEPRECATED: RollCamera() is RollControls().")};b.TrackballCamera=function(){console.warn("DEPRECATED: TrackballCamera() is TrackballControls().")};b.CombinedCamera=function(i,n,h,m,j,k,l){b.Camera.call(this);this.fov=h;this.left=-i/2;this.right=i/2;this.top=n/2;this.bottom=-n/2;this.cameraO=new b.OrthographicCamera(i/-2,i/2,n/2,n/-2,k,l);this.cameraP=new b.PerspectiveCamera(h,i/n,m,j);this.zoom=1;this.toPerspective()};b.CombinedCamera.prototype=new b.Camera;b.CombinedCamera.prototype.constructor=b.CoolCamera;b.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near;this.far=this.cameraP.far;this.cameraP.fov=this.fov/this.zoom;this.cameraP.updateProjectionMatrix();this.projectionMatrix=this.cameraP.projectionMatrix;this.inPersepectiveMode=!0;this.inOrthographicMode=!1};b.CombinedCamera.prototype.toOrthographic=function(){var d=Math.tan(this.fov/2)*((this.cameraP.near+this.cameraP.far)/2),e=2*d*this.cameraP.aspect/2;d/=this.zoom;e/=this.zoom;this.cameraO.left=-e;this.cameraO.right=e;this.cameraO.top=d;this.cameraO.bottom=-d;this.cameraO.updateProjectionMatrix();this.near=this.cameraO.near;this.far=this.cameraO.far;this.projectionMatrix=this.cameraO.projectionMatrix;this.inPersepectiveMode=!1;this.inOrthographicMode=!0};b.CombinedCamera.prototype.setFov=function(c){this.fov=c;this.inPersepectiveMode?this.toPerspective():this.toOrthographic()};b.CombinedCamera.prototype.setLens=function(e,f){f||(f=43.25);var d=2*Math.atan(f/(e*2));d*=180/Math.PI;this.setFov(d);return d};b.CombinedCamera.prototype.setZoom=function(c){this.zoom=c;this.inPersepectiveMode?this.toPerspective():this.toOrthographic()};b.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=!1};b.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0;this.rotation.y=Math.PI;this.rotation.z=0;this.rotationAutoUpdate=!1};b.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0;this.rotation.y=-Math.PI/2;this.rotation.z=0;this.rotationAutoUpdate=!1};b.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0;this.rotation.y=Math.PI/2;this.rotation.z=0;this.rotationAutoUpdate=!1};b.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=!1};b.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=!1};b.FirstPersonControls=function(e,f){function d(g,c){return function(){c.apply(g,arguments)}}this.object=e;this.target=new b.Vector3(0,0,0);this.domElement=f!==void 0?f:document;this.movementSpeed=1;this.lookSpeed=0.005;this.noFly=!1;this.lookVertical=!0;this.autoForward=!1;this.activeLook=!0;this.heightSpeed=!1;this.heightCoef=1;this.heightMin=0;this.constrainVertical=!1;this.verticalMin=0;this.verticalMax=Math.PI;this.theta=this.phi=this.lon=this.lat=this.mouseY=this.mouseX=this.autoSpeedFactor=0;this.mouseDragOn=this.freeze=this.moveRight=this.moveLeft=this.moveBackward=this.moveForward=!1;this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2,this.domElement.setAttribute("tabindex",-1));this.onMouseDown=function(c){this.domElement!==document&&this.domElement.focus();c.preventDefault();c.stopPropagation();if(this.activeLook){switch(c.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}}this.mouseDragOn=!0};this.onMouseUp=function(c){c.preventDefault();c.stopPropagation();if(this.activeLook){switch(c.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}}this.mouseDragOn=!1};this.onMouseMove=function(c){this.domElement===document?(this.mouseX=c.pageX-this.viewHalfX,this.mouseY=c.pageY-this.viewHalfY):(this.mouseX=c.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=c.pageY-this.domElement.offsetTop-this.viewHalfY)};this.onKeyDown=function(c){switch(c.keyCode){case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 82:this.moveUp=!0;break;case 70:this.moveDown=!0;break;case 81:this.freeze=!this.freeze}};this.onKeyUp=function(c){switch(c.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1;break;case 82:this.moveUp=!1;break;case 70:this.moveDown=!1}};this.update=function(h){var g=0;if(!this.freeze){if(this.heightSpeed){var i=b.Math.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=h*i*this.heightCoef}else{this.autoSpeedFactor=0}g=h*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(g+this.autoSpeedFactor));this.moveBackward&&this.object.translateZ(g);this.moveLeft&&this.object.translateX(-g);this.moveRight&&this.object.translateX(g);this.moveUp&&this.object.translateY(g);this.moveDown&&this.object.translateY(-g);i=h*this.lookSpeed;this.activeLook||(i=0);this.lon+=this.mouseX*i;this.lookVertical&&(this.lat-=this.mouseY*i);this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=(90-this.lat)*Math.PI/180;this.theta=this.lon*Math.PI/180;h=this.target;g=this.object.position;h.x=g.x+100*Math.sin(this.phi)*Math.cos(this.theta);h.y=g.y+100*Math.cos(this.phi);h.z=g.z+100*Math.sin(this.phi)*Math.sin(this.theta)}h=1;this.constrainVertical&&(h=Math.PI/(this.verticalMax-this.verticalMin));this.lon+=this.mouseX*i;this.lookVertical&&(this.lat-=this.mouseY*i*h);this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=(90-this.lat)*Math.PI/180;this.theta=this.lon*Math.PI/180;if(this.constrainVertical){this.phi=b.Math.mapLinear(this.phi,0,Math.PI,this.verticalMin,this.verticalMax)}h=this.target;g=this.object.position;h.x=g.x+100*Math.sin(this.phi)*Math.cos(this.theta);h.y=g.y+100*Math.cos(this.phi);h.z=g.z+100*Math.sin(this.phi)*Math.sin(this.theta);this.object.lookAt(h)};this.domElement.addEventListener("contextmenu",function(c){c.preventDefault()},!1);this.domElement.addEventListener("mousemove",d(this,this.onMouseMove),!1);this.domElement.addEventListener("mousedown",d(this,this.onMouseDown),!1);this.domElement.addEventListener("mouseup",d(this,this.onMouseUp),!1);this.domElement.addEventListener("keydown",d(this,this.onKeyDown),!1);this.domElement.addEventListener("keyup",d(this,this.onKeyUp),!1)};b.PathControls=function(j,p){function i(c){if((c*=2)<1){return 0.5*c*c}return -0.5*(--c*(c-2)-1)}function o(d,c){return function(){c.apply(d,arguments)}}function l(A,z,y,x){var w={name:y,fps:0.6,length:x,hierarchy:[]},v,u=z.getControlPointsArray(),s=z.getLength(),r=u.length,B=0;v=r-1;z={parent:-1,keys:[]};z.keys[0]={time:0,pos:u[0],rot:[0,0,0,1],scl:[1,1,1]};z.keys[v]={time:x,pos:u[v],rot:[0,0,0,1],scl:[1,1,1]};for(v=1;v<r-1;v++){B=x*s.chunks[v]/s.total,z.keys[v]={time:B,pos:u[v]}}w.hierarchy[0]=z;b.AnimationHandler.add(w);return new b.Animation(A,y,b.AnimationHandler.CATMULLROM_FORWARD,!1)}function m(g,f){var r,q,h=new b.Geometry;for(r=0;r<g.points.length*f;r++){q=r/(g.points.length*f),q=g.getPoint(q),h.vertices[r]=new b.Vertex(new b.Vector3(q.x,q.y,q.z))}return h}this.object=j;this.domElement=p!==void 0?p:document;this.id="PathControls"+b.PathControlsIdCounter++;this.duration=10000;this.waypoints=[];this.useConstantSpeed=!0;this.resamplingCoef=50;this.debugPath=new b.Object3D;this.debugDummy=new b.Object3D;this.animationParent=new b.Object3D;this.lookSpeed=0.005;this.lookHorizontal=this.lookVertical=!0;this.verticalAngleMap={srcRange:[0,2*Math.PI],dstRange:[0,2*Math.PI]};this.horizontalAngleMap={srcRange:[0,2*Math.PI],dstRange:[0,2*Math.PI]};this.target=new b.Object3D;this.theta=this.phi=this.lon=this.lat=this.mouseY=this.mouseX=0;this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2,this.domElement.setAttribute("tabindex",-1));var n=Math.PI*2,k=Math.PI/180;this.update=function(e){var g;this.lookHorizontal&&(this.lon+=this.mouseX*this.lookSpeed*e);this.lookVertical&&(this.lat-=this.mouseY*this.lookSpeed*e);this.lon=Math.max(0,Math.min(360,this.lon));this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=(90-this.lat)*k;this.theta=this.lon*k;e=this.phi%n;this.phi=e>=0?e:e+n;g=this.verticalAngleMap.srcRange;e=this.verticalAngleMap.dstRange;g=b.Math.mapLinear(this.phi,g[0],g[1],e[0],e[1]);var f=e[1]-e[0];this.phi=i((g-e[0])/f)*f+e[0];g=this.horizontalAngleMap.srcRange;e=this.horizontalAngleMap.dstRange;g=b.Math.mapLinear(this.theta,g[0],g[1],e[0],e[1]);f=e[1]-e[0];this.theta=i((g-e[0])/f)*f+e[0];e=this.target.position;e.x=100*Math.sin(this.phi)*Math.cos(this.theta);e.y=100*Math.cos(this.phi);e.z=100*Math.sin(this.phi)*Math.sin(this.theta);this.object.lookAt(this.target.position)};this.onMouseMove=function(c){this.domElement===document?(this.mouseX=c.pageX-this.viewHalfX,this.mouseY=c.pageY-this.viewHalfY):(this.mouseX=c.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=c.pageY-this.domElement.offsetTop-this.viewHalfY)};this.init=function(){this.spline=new b.Spline;this.spline.initFromArray(this.waypoints);this.useConstantSpeed&&this.spline.reparametrizeByArcLength(this.resamplingCoef);if(this.createDebugDummy){var g=new b.MeshLambertMaterial({color:30719}),f=new b.MeshLambertMaterial({color:65280}),s=new b.CubeGeometry(10,10,20),r=new b.CubeGeometry(2,2,10);this.animationParent=new b.Mesh(s,g);g=new b.Mesh(r,f);g.position.set(0,10,0);this.animation=l(this.animationParent,this.spline,this.id,this.duration);this.animationParent.add(this.object);this.animationParent.add(this.target);this.animationParent.add(g)}else{this.animation=l(this.animationParent,this.spline,this.id,this.duration),this.animationParent.add(this.target),this.animationParent.add(this.object)}if(this.createDebugPath){var g=this.debugPath,f=this.spline,r=m(f,10),s=m(f,10),q=new b.LineBasicMaterial({color:16711680,linewidth:3}),r=new b.Line(r,q),s=new b.ParticleSystem(s,new b.ParticleBasicMaterial({color:16755200,size:3}));r.scale.set(1,1,1);g.add(r);s.scale.set(1,1,1);g.add(s);for(var r=new b.SphereGeometry(1,16,8),q=new b.MeshBasicMaterial({color:65280}),d=0;d<f.points.length;d++){s=new b.Mesh(r,q),s.position.copy(f.points[d]),g.add(s)}}this.domElement.addEventListener("mousemove",o(this,this.onMouseMove),!1)}};b.PathControlsIdCounter=0;b.FlyControls=function(e,f){function d(g,c){return function(){c.apply(g,arguments)}}this.object=e;this.domElement=f!==void 0?f:document;f&&this.domElement.setAttribute("tabindex",-1);this.movementSpeed=1;this.rollSpeed=0.005;this.autoForward=this.dragToLook=!1;this.object.useQuaternion=!0;this.tmpQuaternion=new b.Quaternion;this.mouseStatus=0;this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0};this.moveVector=new b.Vector3(0,0,0);this.rotationVector=new b.Vector3(0,0,0);this.handleEvent=function(c){if(typeof this[c.type]=="function"){this[c.type](c)}};this.keydown=function(c){if(!c.altKey){switch(c.keyCode){case 16:this.movementSpeedMultiplier=0.1;break;case 87:this.moveState.forward=1;break;case 83:this.moveState.back=1;break;case 65:this.moveState.left=1;break;case 68:this.moveState.right=1;break;case 82:this.moveState.up=1;break;case 70:this.moveState.down=1;break;case 38:this.moveState.pitchUp=1;break;case 40:this.moveState.pitchDown=1;break;case 37:this.moveState.yawLeft=1;break;case 39:this.moveState.yawRight=1;break;case 81:this.moveState.rollLeft=1;break;case 69:this.moveState.rollRight=1}this.updateMovementVector();this.updateRotationVector()}};this.keyup=function(c){switch(c.keyCode){case 16:this.movementSpeedMultiplier=1;break;case 87:this.moveState.forward=0;break;case 83:this.moveState.back=0;break;case 65:this.moveState.left=0;break;case 68:this.moveState.right=0;break;case 82:this.moveState.up=0;break;case 70:this.moveState.down=0;break;case 38:this.moveState.pitchUp=0;break;case 40:this.moveState.pitchDown=0;break;case 37:this.moveState.yawLeft=0;break;case 39:this.moveState.yawRight=0;break;case 81:this.moveState.rollLeft=0;break;case 69:this.moveState.rollRight=0}this.updateMovementVector();this.updateRotationVector()};this.mousedown=function(c){this.domElement!==document&&this.domElement.focus();c.preventDefault();c.stopPropagation();if(this.dragToLook){this.mouseStatus++}else{switch(c.button){case 0:this.object.moveForward=!0;break;case 2:this.object.moveBackward=!0}}};this.mousemove=function(h){if(!this.dragToLook||this.mouseStatus>0){var g=this.getContainerDimensions(),j=g.size[0]/2,i=g.size[1]/2;this.moveState.yawLeft=-(h.pageX-g.offset[0]-j)/j;this.moveState.pitchDown=(h.pageY-g.offset[1]-i)/i;this.updateRotationVector()}};this.mouseup=function(c){c.preventDefault();c.stopPropagation();if(this.dragToLook){this.mouseStatus--,this.moveState.yawLeft=this.moveState.pitchDown=0}else{switch(c.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}}this.updateRotationVector()};this.update=function(g){var c=g*this.movementSpeed;g*=this.rollSpeed;this.object.translateX(this.moveVector.x*c);this.object.translateY(this.moveVector.y*c);this.object.translateZ(this.moveVector.z*c);this.tmpQuaternion.set(this.rotationVector.x*g,this.rotationVector.y*g,this.rotationVector.z*g,1).normalize();this.object.quaternion.multiplySelf(this.tmpQuaternion);this.object.matrix.setPosition(this.object.position);this.object.matrix.setRotationFromQuaternion(this.object.quaternion);this.object.matrixWorldNeedsUpdate=!0};this.updateMovementVector=function(){var c=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right;this.moveVector.y=-this.moveState.down+this.moveState.up;this.moveVector.z=-c+this.moveState.back};this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp;this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft;this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft};this.getContainerDimensions=function(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}};this.domElement.addEventListener("mousemove",d(this,this.mousemove),!1);this.domElement.addEventListener("mousedown",d(this,this.mousedown),!1);this.domElement.addEventListener("mouseup",d(this,this.mouseup),!1);this.domElement.addEventListener("keydown",d(this,this.keydown),!1);this.domElement.addEventListener("keyup",d(this,this.keyup),!1);this.updateMovementVector();this.updateRotationVector()};b.RollControls=function(D,B){this.object=D;this.domElement=B!==void 0?B:document;this.mouseLook=!0;this.autoForward=!1;this.rollSpeed=this.movementSpeed=this.lookSpeed=1;this.constrainVertical=[-0.9,0.9];this.object.matrixAutoUpdate=!1;this.forward=new b.Vector3(0,0,1);this.roll=0;var C=new b.Vector3,A=new b.Vector3,x=new b.Vector3,y=new b.Matrix4,z=!1,w=1,v=0,t=0,u=0,q=0,n=0,s=window.innerWidth/2,j=window.innerHeight/2;this.update=function(d){if(this.mouseLook){var e=d*this.lookSpeed;this.rotateHorizontally(e*q);this.rotateVertically(e*n)}e=d*this.movementSpeed;this.object.translateZ(-e*(v>0||this.autoForward&&!(v<0)?1:v));this.object.translateX(e*t);this.object.translateY(e*u);z&&(this.roll+=this.rollSpeed*d*w);if(this.forward.y>this.constrainVertical[1]){this.forward.y=this.constrainVertical[1],this.forward.normalize()}else{if(this.forward.y<this.constrainVertical[0]){this.forward.y=this.constrainVertical[0],this.forward.normalize()}}x.copy(this.forward);A.set(0,1,0);C.cross(A,x).normalize();A.cross(x,C).normalize();this.object.matrix.n11=C.x;this.object.matrix.n12=A.x;this.object.matrix.n13=x.x;this.object.matrix.n21=C.y;this.object.matrix.n22=A.y;this.object.matrix.n23=x.y;this.object.matrix.n31=C.z;this.object.matrix.n32=A.z;this.object.matrix.n33=x.z;y.identity();y.n11=Math.cos(this.roll);y.n12=-Math.sin(this.roll);y.n21=Math.sin(this.roll);y.n22=Math.cos(this.roll);this.object.matrix.multiplySelf(y);this.object.matrixWorldNeedsUpdate=!0;this.object.matrix.n14=this.object.position.x;this.object.matrix.n24=this.object.position.y;this.object.matrix.n34=this.object.position.z};this.translateX=function(c){this.object.position.x+=this.object.matrix.n11*c;this.object.position.y+=this.object.matrix.n21*c;this.object.position.z+=this.object.matrix.n31*c};this.translateY=function(c){this.object.position.x+=this.object.matrix.n12*c;this.object.position.y+=this.object.matrix.n22*c;this.object.position.z+=this.object.matrix.n32*c};this.translateZ=function(c){this.object.position.x-=this.object.matrix.n13*c;this.object.position.y-=this.object.matrix.n23*c;this.object.position.z-=this.object.matrix.n33*c};this.rotateHorizontally=function(c){C.set(this.object.matrix.n11,this.object.matrix.n21,this.object.matrix.n31);C.multiplyScalar(c);this.forward.subSelf(C);this.forward.normalize()};this.rotateVertically=function(c){A.set(this.object.matrix.n12,this.object.matrix.n22,this.object.matrix.n32);A.multiplyScalar(c);this.forward.addSelf(A);this.forward.normalize()};this.domElement.addEventListener("contextmenu",function(c){c.preventDefault()},!1);this.domElement.addEventListener("mousemove",function(c){q=(c.clientX-s)/window.innerWidth;n=(c.clientY-j)/window.innerHeight},!1);this.domElement.addEventListener("mousedown",function(c){c.preventDefault();c.stopPropagation();switch(c.button){case 0:v=1;break;case 2:v=-1}},!1);this.domElement.addEventListener("mouseup",function(c){c.preventDefault();c.stopPropagation();switch(c.button){case 0:v=0;break;case 2:v=0}},!1);this.domElement.addEventListener("keydown",function(c){switch(c.keyCode){case 38:case 87:v=1;break;case 37:case 65:t=-1;break;case 40:case 83:v=-1;break;case 39:case 68:t=1;break;case 81:z=!0;w=1;break;case 69:z=!0;w=-1;break;case 82:u=1;break;case 70:u=-1}},!1);this.domElement.addEventListener("keyup",function(c){switch(c.keyCode){case 38:case 87:v=0;break;case 37:case 65:t=0;break;case 40:case 83:v=0;break;case 39:case 68:t=0;break;case 81:z=!1;break;case 69:z=!1;break;case 82:u=0;break;case 70:u=0}},!1)};b.TrackballControls=function(z,x){var y=this,w={NONE:-1,ROTATE:0,ZOOM:1,PAN:2};this.object=z;this.domElement=x!==void 0?x:document;this.enabled=!0;this.screen={width:window.innerWidth,height:window.innerHeight,offsetLeft:0,offsetTop:0};this.radius=(this.screen.width+this.screen.height)/4;this.rotateSpeed=1;this.zoomSpeed=1.2;this.panSpeed=0.3;this.staticMoving=this.noPan=this.noZoom=this.noRotate=!1;this.dynamicDampingFactor=0.2;this.minDistance=0;this.maxDistance=Infinity;this.keys=[65,83,68];this.target=new b.Vector3(0,0,0);var t=!1,u=w.NONE,v=new b.Vector3,s=new b.Vector3,r=new b.Vector3,n=new b.Vector2,q=new b.Vector2,m=new b.Vector2,j=new b.Vector2;this.handleEvent=function(c){if(typeof this[c.type]=="function"){this[c.type](c)}};this.getMouseOnScreen=function(d,e){return new b.Vector2((d-y.screen.offsetLeft)/y.radius*0.5,(e-y.screen.offsetTop)/y.radius*0.5)};this.getMouseProjectionOnBall=function(e,i){var h=new b.Vector3((e-y.screen.width*0.5-y.screen.offsetLeft)/y.radius,(y.screen.height*0.5+y.screen.offsetTop-i)/y.radius,0),g=h.length();g>1?h.normalize():h.z=Math.sqrt(1-g*g);v.copy(y.object.position).subSelf(y.target);g=y.object.up.clone().setLength(h.y);g.addSelf(y.object.up.clone().crossSelf(v).setLength(h.x));g.addSelf(v.setLength(h.z));return g};this.rotateCamera=function(){var e=Math.acos(s.dot(r)/s.length()/r.length());if(e){var g=(new b.Vector3).cross(s,r).normalize(),f=new b.Quaternion;e*=y.rotateSpeed;f.setFromAxisAngle(g,-e);f.multiplyVector3(v);f.multiplyVector3(y.object.up);f.multiplyVector3(r);y.staticMoving?s=r:(f.setFromAxisAngle(g,e*(y.dynamicDampingFactor-1)),f.multiplyVector3(s))}};this.zoomCamera=function(){var c=1+(q.y-n.y)*y.zoomSpeed;c!==1&&c>0&&(v.multiplyScalar(c),y.staticMoving?n=q:n.y+=(q.y-n.y)*this.dynamicDampingFactor)};this.panCamera=function(){var d=j.clone().subSelf(m);if(d.lengthSq()){d.multiplyScalar(v.length()*y.panSpeed);var e=v.clone().crossSelf(y.object.up).setLength(d.x);e.addSelf(y.object.up.clone().setLength(d.y));y.object.position.addSelf(e);y.target.addSelf(e);y.staticMoving?m=j:m.addSelf(d.sub(j,m).multiplyScalar(y.dynamicDampingFactor))}};this.checkDistances=function(){if(!y.noZoom||!y.noPan){y.object.position.lengthSq()>y.maxDistance*y.maxDistance&&y.object.position.setLength(y.maxDistance),v.lengthSq()<y.minDistance*y.minDistance&&y.object.position.add(y.target,v.setLength(y.minDistance))}};this.update=function(){v.copy(y.object.position).subSelf(this.target);y.noRotate||y.rotateCamera();y.noZoom||y.zoomCamera();y.noPan||y.panCamera();y.object.position.add(y.target,v);y.checkDistances();y.object.lookAt(y.target)};this.domElement.addEventListener("contextmenu",function(c){c.preventDefault()},!1);this.domElement.addEventListener("mousemove",function(c){y.enabled&&(t&&(s=r=y.getMouseProjectionOnBall(c.clientX,c.clientY),n=q=y.getMouseOnScreen(c.clientX,c.clientY),m=j=y.getMouseOnScreen(c.clientX,c.clientY),t=!1),u!==w.NONE&&(u===w.ROTATE&&!y.noRotate?r=y.getMouseProjectionOnBall(c.clientX,c.clientY):u===w.ZOOM&&!y.noZoom?q=y.getMouseOnScreen(c.clientX,c.clientY):u===w.PAN&&!y.noPan&&(j=y.getMouseOnScreen(c.clientX,c.clientY))))},!1);this.domElement.addEventListener("mousedown",function(c){if(y.enabled&&(c.preventDefault(),c.stopPropagation(),u===w.NONE)){u=c.button,u===w.ROTATE&&!y.noRotate?s=r=y.getMouseProjectionOnBall(c.clientX,c.clientY):u===w.ZOOM&&!y.noZoom?n=q=y.getMouseOnScreen(c.clientX,c.clientY):this.noPan||(m=j=y.getMouseOnScreen(c.clientX,c.clientY))}},!1);this.domElement.addEventListener("mouseup",function(c){if(y.enabled){c.preventDefault(),c.stopPropagation(),u=w.NONE}},!1);window.addEventListener("keydown",function(c){if(y.enabled&&u===w.NONE){if(c.keyCode===y.keys[w.ROTATE]&&!y.noRotate){u=w.ROTATE}else{if(c.keyCode===y.keys[w.ZOOM]&&!y.noZoom){u=w.ZOOM}else{if(c.keyCode===y.keys[w.PAN]&&!y.noPan){u=w.PAN}}}u!==w.NONE&&(t=!0)}},!1);window.addEventListener("keyup",function(){if(y.enabled&&u!==w.NONE){u=w.NONE}},!1)};b.CubeGeometry=function(N,L,M,K,H,I,J,G){function F(ae,ad,ac,ab,aa,Z,Y,X){var W,V=K||1,U=H||1,T=aa/2,R=Z/2,Q=D.vertices.length;if(ae==="x"&&ad==="y"||ae==="y"&&ad==="x"){W="z"}else{if(ae==="x"&&ad==="z"||ae==="z"&&ad==="x"){W="y",U=I||1}else{if(ae==="z"&&ad==="y"||ae==="y"&&ad==="z"){W="x",V=I||1}}}var P=V+1,l=U+1,O=aa/V,g=Z/U,f=new b.Vector3;f[W]=Y>0?1:-1;for(aa=0;aa<l;aa++){for(Z=0;Z<P;Z++){var d=new b.Vector3;d[ae]=(Z*O-T)*ac;d[ad]=(aa*g-R)*ab;d[W]=Y;D.vertices.push(new b.Vertex(d))}}for(aa=0;aa<U;aa++){for(Z=0;Z<V;Z++){ae=new b.Face4(Z+P*aa+Q,Z+P*(aa+1)+Q,Z+1+P*(aa+1)+Q,Z+1+P*aa+Q),ae.normal.copy(f),ae.vertexNormals.push(f.clone(),f.clone(),f.clone(),f.clone()),ae.materialIndex=X,D.faces.push(ae),D.faceVertexUvs[0].push([new b.UV(Z/V,aa/U),new b.UV(Z/V,(aa+1)/U),new b.UV((Z+1)/V,(aa+1)/U),new b.UV((Z+1)/V,aa/U)])}}}b.Geometry.call(this);var D=this,E=N/2,A=L/2,z=M/2,C,x,B,y,v,j;if(J!==void 0){if(J instanceof Array){this.materials=J}else{this.materials=[];for(C=0;C<6;C++){this.materials.push(J)}}C=0;y=1;x=2;v=3;B=4;j=5}else{this.materials=[]}this.sides={px:!0,nx:!0,py:!0,ny:!0,pz:!0,nz:!0};if(G!=void 0){for(var s in G){this.sides[s]!=void 0&&(this.sides[s]=G[s])}}this.sides.px&&F("z","y",-1,-1,M,L,E,C);this.sides.nx&&F("z","y",1,-1,M,L,-E,y);this.sides.py&&F("x","z",1,1,N,M,A,x);this.sides.ny&&F("x","z",1,-1,N,M,-A,v);this.sides.pz&&F("x","y",1,-1,N,L,z,B);this.sides.nz&&F("x","y",-1,-1,N,L,-z,j);this.computeCentroids();this.mergeVertices()};b.CubeGeometry.prototype=new b.Geometry;b.CubeGeometry.prototype.constructor=b.CubeGeometry;b.CylinderGeometry=function(R,P,Q,O,L,M){b.Geometry.call(this);var R=R!=null?R:20,P=P!=null?P:20,Q=Q||100,N=Q/2,O=O||8,L=L||1,K,J,H=[],I=[];for(J=0;J<=L;J++){var D=[],C=[],G=J/L,y=G*(P-R)+R;for(K=0;K<=O;K++){var E=K/O;this.vertices.push(new b.Vertex(new b.Vector3(y*Math.sin(E*Math.PI*2),-G*Q+N,y*Math.cos(E*Math.PI*2))));D.push(this.vertices.length-1);C.push(new b.UV(E,G))}H.push(D);I.push(C)}for(J=0;J<L;J++){for(K=0;K<O;K++){var Q=H[J][K],D=H[J+1][K],C=H[J+1][K+1],G=H[J][K+1],y=this.vertices[Q].position.clone().setY(0).normalize(),E=this.vertices[D].position.clone().setY(0).normalize(),A=this.vertices[C].position.clone().setY(0).normalize(),x=this.vertices[G].position.clone().setY(0).normalize(),j=I[J][K].clone(),v=I[J+1][K].clone(),z=I[J+1][K+1].clone(),s=I[J][K+1].clone();this.faces.push(new b.Face4(Q,D,C,G,[y,E,A,x]));this.faceVertexUvs[0].push([j,v,z,s])}}if(!M&&R>0){this.vertices.push(new b.Vertex(new b.Vector3(0,N,0)));for(K=0;K<O;K++){Q=H[0][K],D=H[0][K+1],C=this.vertices.length-1,y=new b.Vector3(0,1,0),E=new b.Vector3(0,1,0),A=new b.Vector3(0,1,0),j=I[0][K].clone(),v=I[0][K+1].clone(),z=new b.UV(v.u,0),this.faces.push(new b.Face3(Q,D,C,[y,E,A])),this.faceVertexUvs[0].push([j,v,z])}}if(!M&&P>0){this.vertices.push(new b.Vertex(new b.Vector3(0,-N,0)));for(K=0;K<O;K++){Q=H[J][K+1],D=H[J][K],C=this.vertices.length-1,y=new b.Vector3(0,-1,0),E=new b.Vector3(0,-1,0),A=new b.Vector3(0,-1,0),j=I[J][K+1].clone(),v=I[J][K].clone(),z=new b.UV(v.u,1),this.faces.push(new b.Face3(Q,D,C,[y,E,A])),this.faceVertexUvs[0].push([j,v,z])}}this.computeCentroids();this.computeFaceNormals()};b.CylinderGeometry.prototype=new b.Geometry;b.CylinderGeometry.prototype.constructor=b.CylinderGeometry;b.ExtrudeGeometry=function(f,j){if(typeof f!=="undefined"){b.Geometry.call(this);var f=f instanceof Array?f:[f],e,i=f.length,h;this.shapebb=f[i-1].getBoundingBox();for(e=0;e<i;e++){h=f[e],this.addShape(h,j)}this.computeCentroids();this.computeFaceNormals()}};b.ExtrudeGeometry.prototype=new b.Geometry;b.ExtrudeGeometry.prototype.constructor=b.ExtrudeGeometry;b.ExtrudeGeometry.prototype.addShape=function(aE,aC){function aD(e,d,f){d||console.log("die");return d.clone().multiplyScalar(f).addSelf(e)}function aB(s,r,q){var p=b.ExtrudeGeometry.__v1,o=b.ExtrudeGeometry.__v2,n=b.ExtrudeGeometry.__v3,m=b.ExtrudeGeometry.__v4,l=b.ExtrudeGeometry.__v5,k=b.ExtrudeGeometry.__v6;p.set(s.x-r.x,s.y-r.y);o.set(s.x-q.x,s.y-q.y);p=p.normalize();o=o.normalize();n.set(-p.y,p.x);m.set(o.y,-o.x);l.copy(s).addSelf(n);k.copy(s).addSelf(m);if(l.equals(k)){return m.clone()}l.copy(r).addSelf(n);k.copy(q).addSelf(m);n=p.dot(m);m=k.subSelf(l).dot(m);n===0&&(console.log("Either infinite or no solutions!"),m===0?console.log("Its finite solutions."):console.log("Too bad, no solutions."));m/=n;if(m<0){return r=Math.atan2(r.y-s.y,r.x-s.x),s=Math.atan2(q.y-s.y,q.x-s.x),r>s&&(s+=Math.PI*2),s=(r+s)/2,new b.Vector2(-Math.cos(s),-Math.sin(s))}return p.multiplyScalar(m).addSelf(l).subSelf(s).clone()}function ay(s){for(am=s.length;--am>=0;){C=am;aF=am-1;aF<0&&(aF=s.length-1);for(var r=0,q=at+av*2,r=0;r<q;r++){var p=N*r,o=N*(r+1),m=j+C+p,k=j+C+o,i=m,p=j+aF+p,o=j+aF+o,h=k;i+=V;p+=V;o+=V;h+=V;aj.faces.push(new b.Face4(i,p,o,h,null,null,ad));ad&&(i=r/q,p=(r+1)/q,o=ax+aw*2,m=(aj.vertices[m].position.z+aw)/o,k=(aj.vertices[k].position.z+aw)/o,aj.faceVertexUvs[0].push([new b.UV(m,i),new b.UV(k,i),new b.UV(k,p),new b.UV(m,p)]))}}}function az(e,d,f){aj.vertices.push(new b.Vertex(new b.Vector3(e,d,f)))}function aA(i,h,o){i+=V;h+=V;o+=V;aj.faces.push(new b.Face3(i,h,o,null,null,ak));if(ak){var n=ab.maxY,m=ab.maxX,l=aj.vertices[h].position.x,h=aj.vertices[h].position.y,k=aj.vertices[o].position.x,o=aj.vertices[o].position.y;aj.faceVertexUvs[0].push([new b.UV(aj.vertices[i].position.x/m,aj.vertices[i].position.y/n),new b.UV(l/m,h/n),new b.UV(k/m,o/n)])}}var ax=aC.amount!==void 0?aC.amount:100,aw=aC.bevelThickness!==void 0?aC.bevelThickness:6,au=aC.bevelSize!==void 0?aC.bevelSize:aw-2,av=aC.bevelSegments!==void 0?aC.bevelSegments:3,aq=aC.bevelEnabled!==void 0?aC.bevelEnabled:!0,ap=aC.curveSegments!==void 0?aC.curveSegments:12,at=aC.steps!==void 0?aC.steps:1,an=aC.bendPath,ar=aC.extrudePath,ao,al=!1,ai=aC.useSpacedPoints!==void 0?aC.useSpacedPoints:!1,ak=aC.material,ad=aC.extrudeMaterial,ab=this.shapebb;if(ar){ao=ar.getPoints(ap),at=ao.length,al=!0,aq=!1}aq||(au=aw=av=0);var ae,ah,ag,aj=this,V=this.vertices.length;an&&aE.addWrapPath(an);ap=ai?aE.extractAllSpacedPoints(ap):aE.extractAllPoints(ap);an=ap.shape;ap=ap.holes;if(ar=!b.Shape.Utils.isClockWise(an)){an=an.reverse();ah=0;for(ag=ap.length;ah<ag;ah++){ae=ap[ah],b.Shape.Utils.isClockWise(ae)&&(ap[ah]=ae.reverse())}ar=!1}ar=b.Shape.Utils.triangulateShape(an,ap);ai=an;ah=0;for(ag=ap.length;ah<ag;ah++){ae=ap[ah],an=an.concat(ae)}var am,ac,D,z,T,L,N=an.length,af=ar.length,Y=[];am=0;ac=ai.length;C=ac-1;for(aF=am+1;am<ac;am++,C++,aF++){C===ac&&(C=0),aF===ac&&(aF=0),Y[am]=aB(ai[am],ai[C],ai[aF])}var Z=[],X,Q=Y.concat();ah=0;for(ag=ap.length;ah<ag;ah++){ae=ap[ah];X=[];am=0;ac=ae.length;C=ac-1;for(aF=am+1;am<ac;am++,C++,aF++){C===ac&&(C=0),aF===ac&&(aF=0),X[am]=aB(ae[am],ae[C],ae[aF])}Z.push(X);Q=Q.concat(X)}for(D=0;D<av;D++){z=D/av;T=aw*(1-z);z=au*Math.sin(z*Math.PI/2);am=0;for(ac=ai.length;am<ac;am++){L=aD(ai[am],Y[am],z),az(L.x,L.y,-T)}ah=0;for(ag=ap.length;ah<ag;ah++){ae=ap[ah];X=Z[ah];am=0;for(ac=ae.length;am<ac;am++){L=aD(ae[am],X[am],z),az(L.x,L.y,-T)}}}z=au;for(am=0;am<N;am++){L=aq?aD(an[am],Q[am],z):an[am],al?az(L.x,L.y+ao[0].y,ao[0].x):az(L.x,L.y,0)}for(D=1;D<=at;D++){for(am=0;am<N;am++){L=aq?aD(an[am],Q[am],z):an[am],al?az(L.x,L.y+ao[D-1].y,ao[D-1].x):az(L.x,L.y,ax/at*D)}}for(D=av-1;D>=0;D--){z=D/av;T=aw*(1-z);z=au*Math.sin(z*Math.PI/2);am=0;for(ac=ai.length;am<ac;am++){L=aD(ai[am],Y[am],z),az(L.x,L.y,ax+T)}ah=0;for(ag=ap.length;ah<ag;ah++){ae=ap[ah];X=Z[ah];am=0;for(ac=ae.length;am<ac;am++){L=aD(ae[am],X[am],z),al?az(L.x,L.y+ao[at-1].y,ao[at-1].x+T):az(L.x,L.y,ax+T)}}}if(aq){aq=N*0;for(am=0;am<af;am++){au=ar[am],aA(au[2]+aq,au[1]+aq,au[0]+aq)}aq=N*(at+av*2);for(am=0;am<af;am++){au=ar[am],aA(au[0]+aq,au[1]+aq,au[2]+aq)}}else{for(am=0;am<af;am++){au=ar[am],aA(au[2],au[1],au[0])}for(am=0;am<af;am++){au=ar[am],aA(au[0]+N*at,au[1]+N*at,au[2]+N*at)}}var C,aF,j=0;ay(ai);j+=ai.length;ah=0;for(ag=ap.length;ah<ag;ah++){ae=ap[ah],ay(ae),j+=ae.length}};b.ExtrudeGeometry.__v1=new b.Vector2;b.ExtrudeGeometry.__v2=new b.Vector2;b.ExtrudeGeometry.__v3=new b.Vector2;b.ExtrudeGeometry.__v4=new b.Vector2;b.ExtrudeGeometry.__v5=new b.Vector2;b.ExtrudeGeometry.__v6=new b.Vector2;b.IcosahedronGeometry=function(v){function t(f,e,h){var g=Math.sqrt(f*f+e*e+h*h);return p.vertices.push(new b.Vertex(new b.Vector3(f/g,e/g,h/g)))-1}function u(i,g,y,x){var w=p.vertices[i].position,l=p.vertices[g].position,k=p.vertices[y].position,i=new b.Face3(i,g,y);i.vertexNormals.push(w.clone().normalize(),l.clone().normalize(),k.clone().normalize());x.faces.push(i);x.faceVertexUvs[0].push([new b.UV(1-(Math.atan2(w.z,w.x)+Math.PI)%Math.PI/Math.PI*0.5,0.5-w.y/2),new b.UV(1-(Math.atan2(l.z,l.x)+Math.PI)%Math.PI/Math.PI*0.5,0.5-l.y/2),new b.UV(1-(Math.atan2(k.z,k.x)+Math.PI)%Math.PI/Math.PI*0.5,0.5-k.y/2)])}function s(f,c){var h=p.vertices[f].position,g=p.vertices[c].position;return t((h.x+g.x)/2,(h.y+g.y)/2,(h.z+g.z)/2)}var p=this,q=new b.Geometry;this.subdivisions=v||0;b.Geometry.call(this);v=(1+Math.sqrt(5))/2;t(-1,v,0);t(1,v,0);t(-1,-v,0);t(1,-v,0);t(0,-1,v);t(0,1,v);t(0,-1,-v);t(0,1,-v);t(v,0,-1);t(v,0,1);t(-v,0,-1);t(-v,0,1);u(0,11,5,q);u(0,5,1,q);u(0,1,7,q);u(0,7,10,q);u(0,10,11,q);u(1,5,9,q);u(5,11,4,q);u(11,10,2,q);u(10,7,6,q);u(7,1,8,q);u(3,9,4,q);u(3,4,2,q);u(3,2,6,q);u(3,6,8,q);u(3,8,9,q);u(4,9,5,q);u(2,4,11,q);u(6,2,10,q);u(8,6,7,q);u(9,8,1,q);for(var r=0;r<this.subdivisions;r++){var v=new b.Geometry,o;for(o in q.faces){var n=s(q.faces[o].a,q.faces[o].b),j=s(q.faces[o].b,q.faces[o].c),m=s(q.faces[o].c,q.faces[o].a);u(q.faces[o].a,n,m,v);u(q.faces[o].b,j,n,v);u(q.faces[o].c,m,j,v);u(n,j,m,v)}q.faces=v.faces;q.faceVertexUvs[0]=v.faceVertexUvs[0]}p.faces=q.faces;p.faceVertexUvs[0]=q.faceVertexUvs[0];this.computeCentroids();this.computeFaceNormals()};b.IcosahedronGeometry.prototype=new b.Geometry;b.IcosahedronGeometry.prototype.constructor=b.IcosahedronGeometry;b.LatheGeometry=function(r,p,q){b.Geometry.call(this);this.steps=p||12;this.angle=q||2*Math.PI;for(var p=this.angle/this.steps,q=[],o=[],l=[],m=[],n=(new b.Matrix4).setRotationZ(p),k=0;k<r.length;k++){this.vertices.push(new b.Vertex(r[k])),q[k]=r[k].clone(),o[k]=this.vertices.length-1}for(var j=0;j<=this.angle+0.001;j+=p){for(k=0;k<q.length;k++){j<this.angle?(q[k]=n.multiplyVector3(q[k].clone()),this.vertices.push(new b.Vertex(q[k])),l[k]=this.vertices.length-1):l=m}j==0&&(m=o);for(k=0;k<o.length-1;k++){this.faces.push(new b.Face4(l[k],l[k+1],o[k+1],o[k])),this.faceVertexUvs[0].push([new b.UV(1-j/this.angle,k/r.length),new b.UV(1-j/this.angle,(k+1)/r.length),new b.UV(1-(j-p)/this.angle,(k+1)/r.length),new b.UV(1-(j-p)/this.angle,k/r.length)])}o=l;l=[]}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};b.LatheGeometry.prototype=new b.Geometry;b.LatheGeometry.prototype.constructor=b.LatheGeometry;b.OctahedronGeometry=function(r,p){function q(d){var e=d.clone().normalize(),e=new b.Vertex(e.clone().multiplyScalar(r));e.index=n.vertices.push(e)-1;e.uv=new b.UV(Math.atan2(d.z,-d.x)/2/Math.PI+0.5,Math.atan2(-d.y,Math.sqrt(d.x*d.x+d.z*d.z))/Math.PI+0.5);return e}function o(e,d,g,f){f<1?(f=new b.Face3(e.index,d.index,g.index,[e.position,d.position,g.position]),f.centroid.addSelf(e.position).addSelf(d.position).addSelf(g.position).divideScalar(3),f.normal=f.centroid.clone().normalize(),n.faces.push(f),f=Math.atan2(f.centroid.z,-f.centroid.x),n.faceVertexUvs[0].push([m(e.uv,e.position,f),m(d.uv,d.position,f),m(g.uv,g.position,f)])):(f-=1,o(e,l(e,d),l(e,g),f),o(l(e,d),d,l(d,g),f),o(l(e,g),l(d,g),g,f),o(l(e,d),l(d,g),l(e,g),f))}function l(e,g){k[e.index]||(k[e.index]=[]);k[g.index]||(k[g.index]=[]);var f=k[e.index][g.index];f===void 0&&(k[e.index][g.index]=k[g.index][e.index]=f=q((new b.Vector3).add(e.position,g.position).divideScalar(2)));return f}function m(e,d,f){f<0&&e.u===1&&(e=new b.UV(e.u-1,e.v));d.x===0&&d.z===0&&(e=new b.UV(f/2/Math.PI+0.5,e.v));return e}b.Geometry.call(this);var p=p||0,n=this;q(new b.Vector3(1,0,0));q(new b.Vector3(-1,0,0));q(new b.Vector3(0,1,0));q(new b.Vector3(0,-1,0));q(new b.Vector3(0,0,1));q(new b.Vector3(0,0,-1));var k=[],j=this.vertices;o(j[0],j[2],j[4],p);o(j[0],j[4],j[3],p);o(j[0],j[3],j[5],p);o(j[0],j[5],j[2],p);o(j[1],j[2],j[5],p);o(j[1],j[5],j[3],p);o(j[1],j[3],j[4],p);o(j[1],j[4],j[2],p);this.boundingSphere={radius:r}};b.OctahedronGeometry.prototype=new b.Geometry;b.OctahedronGeometry.prototype.constructor=b.OctahedronGeometry;b.PlaneGeometry=function(v,t,u,s){b.Geometry.call(this);for(var p=v/2,q=t/2,u=u||1,s=s||1,r=u+1,o=s+1,n=v/u,j=t/s,m=new b.Vector3(0,0,1),v=0;v<o;v++){for(t=0;t<r;t++){this.vertices.push(new b.Vertex(new b.Vector3(t*n-p,-(v*j-q),0)))}}for(v=0;v<s;v++){for(t=0;t<u;t++){p=new b.Face4(t+r*v,t+r*(v+1),t+1+r*(v+1),t+1+r*v),p.normal.copy(m),p.vertexNormals.push(m.clone(),m.clone(),m.clone(),m.clone()),this.faces.push(p),this.faceVertexUvs[0].push([new b.UV(t/u,v/s),new b.UV(t/u,(v+1)/s),new b.UV((t+1)/u,(v+1)/s),new b.UV((t+1)/u,v/s)])}}this.computeCentroids()};b.PlaneGeometry.prototype=new b.Geometry;b.PlaneGeometry.prototype.constructor=b.PlaneGeometry;b.SphereGeometry=function(L,J,K,I,F,G,H){b.Geometry.call(this);var L=L||50,J=Math.max(3,Math.floor(J)||8),K=Math.max(2,Math.floor(K)||6),I=I!=void 0?I:0,F=F!=void 0?F:Math.PI*2,G=G!=void 0?G:0,H=H!=void 0?H:Math.PI,E,D,B=[],C=[];for(D=0;D<=K;D++){var y=[],x=[];for(E=0;E<=J;E++){var A=E/J,u=D/K;this.vertices.push(new b.Vertex(new b.Vector3(-L*Math.cos(I+A*F)*Math.sin(G+u*H),L*Math.cos(G+u*H),L*Math.sin(I+A*F)*Math.sin(G+u*H))));y.push(this.vertices.length-1);x.push(new b.UV(A,u))}B.push(y);C.push(x)}for(D=0;D<K;D++){for(E=0;E<J;E++){var I=B[D][E+1],F=B[D][E],G=B[D+1][E],H=B[D+1][E+1],y=this.vertices[I].position.clone().normalize(),x=this.vertices[F].position.clone().normalize(),A=this.vertices[G].position.clone().normalize(),u=this.vertices[H].position.clone().normalize(),z=C[D][E+1].clone(),v=C[D][E].clone(),s=C[D+1][E].clone(),j=C[D+1][E+1].clone();Math.abs(this.vertices[I].position.y)==L?(this.faces.push(new b.Face3(I,G,H,[y,A,u])),this.faceVertexUvs[0].push([z,s,j])):Math.abs(this.vertices[G].position.y)==L?(this.faces.push(new b.Face3(I,F,G,[y,x,A])),this.faceVertexUvs[0].push([z,v,s])):(this.faces.push(new b.Face4(I,F,G,H,[y,x,A,u])),this.faceVertexUvs[0].push([z,v,s,j]))}}this.computeCentroids();this.computeFaceNormals();this.boundingSphere={radius:L}};b.SphereGeometry.prototype=new b.Geometry;b.SphereGeometry.prototype.constructor=b.SphereGeometry;b.TextGeometry=function(f,h){var e=(new b.TextPath(f,h)).toShapes();h.amount=h.height!==void 0?h.height:50;if(h.bevelThickness===void 0){h.bevelThickness=10}if(h.bevelSize===void 0){h.bevelSize=8}if(h.bevelEnabled===void 0){h.bevelEnabled=!1}if(h.bend){var g=e[e.length-1].getBoundingBox().maxX;h.bendPath=new b.QuadraticBezierCurve(new b.Vector2(0,0),new b.Vector2(g/2,120),new b.Vector2(g,0))}b.ExtrudeGeometry.call(this,e,h)};b.TextGeometry.prototype=new b.ExtrudeGeometry;b.TextGeometry.prototype.constructor=b.TextGeometry;b.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(d){var e=d.familyName.toLowerCase();this.faces[e]=this.faces[e]||{};this.faces[e][d.cssFontWeight]=this.faces[e][d.cssFontWeight]||{};this.faces[e][d.cssFontWeight][d.cssFontStyle]=d;return this.faces[e][d.cssFontWeight][d.cssFontStyle]=d},drawText:function(j){for(var p=this.getFace(),i=this.size/p.resolution,o=0,l=String(j).split(""),m=l.length,n=[],j=0;j<m;j++){var k=new b.Path,k=this.extractGlyphPoints(l[j],p,i,o,k);o+=k.offset;n.push(k.path)}return{paths:n,offset:o/2}},extractGlyphPoints:function(N,L,M,K,H){var I=[],J,G,F,D,E,A,z,C,x,B,y,v=L.glyphs[N]||L.glyphs["?"];if(v){if(v.o){L=v._cachedOutline||(v._cachedOutline=v.o.split(" "));D=L.length;for(N=0;N<D;){switch(F=L[N++],F){case"m":F=L[N++]*M+K;E=L[N++]*M;I.push(new b.Vector2(F,E));H.moveTo(F,E);break;case"l":F=L[N++]*M+K;E=L[N++]*M;I.push(new b.Vector2(F,E));H.lineTo(F,E);break;case"q":F=L[N++]*M+K;E=L[N++]*M;C=L[N++]*M+K;x=L[N++]*M;H.quadraticCurveTo(C,x,F,E);if(J=I[I.length-1]){A=J.x;z=J.y;J=1;for(G=this.divisions;J<=G;J++){var j=J/G,s=b.Shape.Utils.b2(j,A,C,F),j=b.Shape.Utils.b2(j,z,x,E);I.push(new b.Vector2(s,j))}}break;case"b":if(F=L[N++]*M+K,E=L[N++]*M,C=L[N++]*M+K,x=L[N++]*-M,B=L[N++]*M+K,y=L[N++]*-M,H.bezierCurveTo(F,E,C,x,B,y),J=I[I.length-1]){A=J.x;z=J.y;J=1;for(G=this.divisions;J<=G;J++){j=J/G,s=b.Shape.Utils.b3(j,A,C,B,F),j=b.Shape.Utils.b3(j,z,x,y,E),I.push(new b.Vector2(s,j))}}}}}return{offset:v.ha*M,points:I,path:H}}}};(function(d){var e=function(h){for(var l=h.length,i=0,j=l-1,k=0;k<l;j=k++){i+=h[j].x*h[k].y-h[k].x*h[j].y}return i*0.5};d.Triangulate=function(aw,av){var ar=aw.length;if(ar<3){return null}var at=[],au=[],aq=[],ap,an,ao;if(e(aw)>0){for(an=0;an<ar;an++){au[an]=an}}else{for(an=0;an<ar;an++){au[an]=ar-1-an}}var ak=2*ar;for(an=ar-1;ar>2;){if(ak--<=0){console.log("Warning, unable to triangulate polygon!");if(av){return aq}return at}ap=an;ar<=ap&&(ap=0);an=ap+1;ar<=an&&(an=0);ao=an+1;ar<=ao&&(ao=0);var aj;aw:{aj=aw;var am=ap,ah=an,al=ao,ai=ar,af=au,ac=void 0,ae=void 0,X=void 0,V=void 0,Y=void 0,ab=void 0,aa=void 0,ad=void 0,N=void 0,ae=aj[af[am]].x,X=aj[af[am]].y,V=aj[af[ah]].x,Y=aj[af[ah]].y,ab=aj[af[al]].x,aa=aj[af[al]].y;if(1e-10>(V-ae)*(aa-X)-(Y-X)*(ab-ae)){aj=!1}else{for(ac=0;ac<ai;ac++){if(!(ac==am||ac==ah||ac==al)){var ad=aj[af[ac]].x,N=aj[af[ac]].y,ag=void 0,W=void 0,j=void 0,c=void 0,L=void 0,z=void 0,C=void 0,Z=void 0,S=void 0,T=void 0,Q=void 0,D=void 0,ag=j=L=void 0,ag=ab-V,W=aa-Y,j=ae-ab,c=X-aa,L=V-ae,z=Y-X,C=ad-ae,Z=N-X,S=ad-V,T=N-Y,Q=ad-ab,D=N-aa,ag=ag*T-W*S,L=L*Z-z*C,j=j*D-c*Q;if(ag>=0&&j>=0&&L>=0){aj=!1;break aw}}}aj=!0}}if(aj){at.push([aw[au[ap]],aw[au[an]],aw[au[ao]]]);aq.push([au[ap],au[an],au[ao]]);ap=an;for(ao=an+1;ao<ar;ap++,ao++){au[ap]=au[ao]}ar--;ak=2*ar}}if(av){return aq}return at};d.Triangulate.area=e;return d})(b.FontUtils);a._typeface_js={faces:b.FontUtils.faces,loadFace:b.FontUtils.loadFace};b.TorusGeometry=function(r,p,q,o,l){b.Geometry.call(this);this.radius=r||100;this.tube=p||40;this.segmentsR=q||8;this.segmentsT=o||6;this.arc=l||Math.PI*2;l=new b.Vector3;r=[];p=[];for(q=0;q<=this.segmentsR;q++){for(o=0;o<=this.segmentsT;o++){var m=o/this.segmentsT*this.arc,n=q/this.segmentsR*Math.PI*2;l.x=this.radius*Math.cos(m);l.y=this.radius*Math.sin(m);var k=new b.Vector3;k.x=(this.radius+this.tube*Math.cos(n))*Math.cos(m);k.y=(this.radius+this.tube*Math.cos(n))*Math.sin(m);k.z=this.tube*Math.sin(n);this.vertices.push(new b.Vertex(k));r.push(new b.UV(o/this.segmentsT,1-q/this.segmentsR));p.push(k.clone().subSelf(l).normalize())}}for(q=1;q<=this.segmentsR;q++){for(o=1;o<=this.segmentsT;o++){var l=(this.segmentsT+1)*q+o-1,m=(this.segmentsT+1)*(q-1)+o-1,n=(this.segmentsT+1)*(q-1)+o,k=(this.segmentsT+1)*q+o,j=new b.Face4(l,m,n,k,[p[l],p[m],p[n],p[k]]);j.normal.addSelf(p[l]);j.normal.addSelf(p[m]);j.normal.addSelf(p[n]);j.normal.addSelf(p[k]);j.normal.normalize();this.faces.push(j);this.faceVertexUvs[0].push([r[l].clone(),r[m].clone(),r[n].clone(),r[k].clone()])}}this.computeCentroids()};b.TorusGeometry.prototype=new b.Geometry;b.TorusGeometry.prototype.constructor=b.TorusGeometry;b.TorusKnotGeometry=function(v,t,u,s,p,q,r){function o(h,g,w,l,k,i){g=w/l*h;w=Math.cos(g);return new b.Vector3(k*(2+w)*0.5*Math.cos(h),k*(2+w)*Math.sin(h)*0.5,i*k*Math.sin(g)*0.5)}b.Geometry.call(this);this.radius=v||200;this.tube=t||40;this.segmentsR=u||64;this.segmentsT=s||8;this.p=p||2;this.q=q||3;this.heightScale=r||1;this.grid=Array(this.segmentsR);u=new b.Vector3;s=new b.Vector3;q=new b.Vector3;for(v=0;v<this.segmentsR;++v){this.grid[v]=Array(this.segmentsT);for(t=0;t<this.segmentsT;++t){var n=v/this.segmentsR*2*this.p*Math.PI,r=t/this.segmentsT*2*Math.PI,p=o(n,r,this.q,this.p,this.radius,this.heightScale),n=o(n+0.01,r,this.q,this.p,this.radius,this.heightScale);u.x=n.x-p.x;u.y=n.y-p.y;u.z=n.z-p.z;s.x=n.x+p.x;s.y=n.y+p.y;s.z=n.z+p.z;q.cross(u,s);s.cross(q,u);q.normalize();s.normalize();n=-this.tube*Math.cos(r);r=this.tube*Math.sin(r);p.x+=n*s.x+r*q.x;p.y+=n*s.y+r*q.y;p.z+=n*s.z+r*q.z;this.grid[v][t]=this.vertices.push(new b.Vertex(new b.Vector3(p.x,p.y,p.z)))-1}}for(v=0;v<this.segmentsR;++v){for(t=0;t<this.segmentsT;++t){var s=(v+1)%this.segmentsR,q=(t+1)%this.segmentsT,p=this.grid[v][t],u=this.grid[s][t],s=this.grid[s][q],q=this.grid[v][q],r=new b.UV(v/this.segmentsR,t/this.segmentsT),n=new b.UV((v+1)/this.segmentsR,t/this.segmentsT),j=new b.UV((v+1)/this.segmentsR,(t+1)/this.segmentsT),m=new b.UV(v/this.segmentsR,(t+1)/this.segmentsT);this.faces.push(new b.Face4(p,u,s,q));this.faceVertexUvs[0].push([r,n,j,m])}}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};b.TorusKnotGeometry.prototype=new b.Geometry;b.TorusKnotGeometry.prototype.constructor=b.TorusKnotGeometry;b.SubdivisionModifier=function(c){this.subdivisions=c===void 0?1:c;this.useOldVertexColors=!1;this.supportUVs=!0};b.SubdivisionModifier.prototype.constructor=b.SubdivisionModifier;b.SubdivisionModifier.prototype.modify=function(d){for(var e=this.subdivisions;e-->0;){this.smooth(d)}};b.SubdivisionModifier.prototype.smooth=function(al){function aj(x,w,v,u,t,s){var q=new b.Face4(x,w,v,u,null,t.color,t.material);if(ah.useOldVertexColors){q.vertexColors=[];for(var p,g,f,r=0;r<4;r++){f=s[r];p=new b.Color;p.setRGB(0,0,0);for(var e=0;e<f.length;e++){g=t.vertexColors[f[e]-1],p.r+=g.r,p.g+=g.g,p.b+=g.b}p.r/=f.length;p.g/=f.length;p.b/=f.length;q.vertexColors[r]=p}}af.push(q);(!ah.supportUVs||X.length!=0)&&ag.push([X[x],X[w],X[v],X[u]])}function ak(d,c){return Math.min(d,c)+"_"+Math.max(d,c)}var ai=[],af=[],ag=[],ah=this,ae=al.vertices,ai=al.faces,ad=ae.concat(),ab=[],ac={},Y={},X=[],aa,S,Z,V,P,I=al.faceVertexUvs[0];aa=0;for(S=I.length;aa<S;aa++){Z=0;for(V=I[aa].length;Z<V;Z++){P=ai[aa]["abcd".charAt(Z)],X[P]||(X[P]=I[aa][Z])}}var N;aa=0;for(S=ai.length;aa<S;aa++){if(P=ai[aa],ab.push(P.centroid),ad.push(new b.Vertex(P.centroid)),ah.supportUVs&&X.length!=0){N=new b.UV;if(P instanceof b.Face3){N.u=X[P.a].u+X[P.b].u+X[P.c].u,N.v=X[P.a].v+X[P.b].v+X[P.c].v,N.u/=3,N.v/=3}else{if(P instanceof b.Face4){N.u=X[P.a].u+X[P.b].u+X[P.c].u+X[P.d].u,N.v=X[P.a].v+X[P.b].v+X[P.c].v+X[P.d].v,N.u/=4,N.v/=4}}X.push(N)}}S=function(i){function p(e,c,f){e[c]===void 0&&(e[c]=[]);e[c].push(f)}var o,n,m,l,k={};o=0;for(n=i.faces.length;o<n;o++){m=i.faces[o],m instanceof b.Face3?(l=ak(m.a,m.b),p(k,l,o),l=ak(m.b,m.c),p(k,l,o),l=ak(m.c,m.a),p(k,l,o)):m instanceof b.Face4&&(l=ak(m.a,m.b),p(k,l,o),l=ak(m.b,m.c),p(k,l,o),l=ak(m.c,m.d),p(k,l,o),l=ak(m.d,m.a),p(k,l,o))}return k}(al);var T=0,I=ae.length,M,W,H={},G={},L=function(d,c){H[d]===void 0&&(H[d]=[]);H[d].push(c)},D=function(d,c){G[d]===void 0&&(G[d]={});G[d][c]=null};for(aa in S){N=S[aa];M=aa.split("_");W=M[0];M=M[1];L(W,[W,M]);L(M,[W,M]);Z=0;for(V=N.length;Z<V;Z++){P=N[Z],D(W,P,aa),D(M,P,aa)}N.length<2&&(Y[aa]=!0)}for(aa in S){if(N=S[aa],P=N[0],N=N[1],M=aa.split("_"),W=M[0],M=M[1],V=new b.Vector3,Y[aa]?(V.addSelf(ae[W].position),V.addSelf(ae[M].position),V.multiplyScalar(0.5)):(V.addSelf(ab[P]),V.addSelf(ab[N]),V.addSelf(ae[W].position),V.addSelf(ae[M].position),V.multiplyScalar(0.25)),ac[aa]=I+ai.length+T,ad.push(new b.Vertex(V)),T++,ah.supportUVs&&X.length!=0){N=new b.UV,N.u=X[W].u+X[M].u,N.v=X[W].v+X[M].v,N.u/=2,N.v/=2,X.push(N)}}var Q,O;M=["123","12","2","23"];V=["123","23","3","31"];var L=["123","31","1","12"],D=["1234","12","2","23"],z=["1234","23","3","34"],j=["1234","34","4","41"],C=["1234","41","1","12"];aa=0;for(S=ab.length;aa<S;aa++){P=ai[aa],N=I+aa,P instanceof b.Face3?(T=ak(P.a,P.b),W=ak(P.b,P.c),Q=ak(P.c,P.a),aj(N,ac[T],P.b,ac[W],P,M),aj(N,ac[W],P.c,ac[Q],P,V),aj(N,ac[Q],P.a,ac[T],P,L)):P instanceof b.Face4?(T=ak(P.a,P.b),W=ak(P.b,P.c),Q=ak(P.c,P.d),O=ak(P.d,P.a),aj(N,ac[T],P.b,ac[W],P,D),aj(N,ac[W],P.c,ac[Q],P,z),aj(N,ac[Q],P.d,ac[O],P,j),aj(N,ac[O],P.a,ac[T],P,C)):console.log("face should be a face!",P)}ai=ad;ad=new b.Vector3;ac=new b.Vector3;aa=0;for(S=ae.length;aa<S;aa++){if(H[aa]!==void 0){ad.set(0,0,0);ac.set(0,0,0);P=new b.Vector3(0,0,0);N=0;for(Z in G[aa]){ad.addSelf(ab[Z]),N++}T=0;I=H[aa].length;for(Z=0;Z<I;Z++){Y[ak(H[aa][Z][0],H[aa][Z][1])]&&T++}if(T!=2){ad.divideScalar(N);for(Z=0;Z<I;Z++){N=H[aa][Z],N=ae[N[0]].position.clone().addSelf(ae[N[1]].position).divideScalar(2),ac.addSelf(N)}ac.divideScalar(I);P.addSelf(ae[aa].position);P.multiplyScalar(I-3);P.addSelf(ad);P.addSelf(ac.multiplyScalar(2));P.divideScalar(I);ai[aa].position=P}}}al.vertices=ai;al.faces=af;al.faceVertexUvs[0]=ag;delete al.__tmpVertices;al.computeCentroids();al.computeFaceNormals();al.computeVertexNormals()};b.Loader=function(c){this.statusDomElement=(this.showStatus=c)?b.Loader.prototype.addStatusElement():null;this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}};b.Loader.prototype={constructor:b.Loader,addStatusElement:function(){var c=document.createElement("div");c.style.position="absolute";c.style.right="0px";c.style.top="0px";c.style.fontSize="0.8em";c.style.textAlign="left";c.style.background="rgba(0,0,0,0.25)";c.style.color="#fff";c.style.width="120px";c.style.padding="0.5em 0.5em 0.5em 0.5em";c.style.zIndex=1000;c.innerHTML="Loading ...";return c},updateProgress:function(d){var e="Loaded ";e+=d.total?(100*d.loaded/d.total).toFixed(0)+"%":(d.loaded/1000).toFixed(2)+" KB";this.statusDomElement.innerHTML=e},extractUrlbase:function(c){c=c.split("/");c.pop();return c.length<1?"":c.join("/")+"/"},initMaterials:function(f,h,e){f.materials=[];for(var g=0;g<h.length;++g){f.materials[g]=b.Loader.prototype.createMaterial(h[g],e)}},hasNormals:function(f){var h,e,g=f.materials.length;for(e=0;e<g;e++){if(h=f.materials[e],h instanceof b.ShaderMaterial){return !0}}return !1},createMaterial:function(z,x){function y(c){c=Math.log(c)/Math.LN2;return Math.floor(c)==c}function w(e,g){var f=new Image;f.onload=function(){if(!y(this.width)||!y(this.height)){var i=Math.pow(2,Math.round(Math.log(this.width)/Math.LN2)),h=Math.pow(2,Math.round(Math.log(this.height)/Math.LN2));e.image.width=i;e.image.height=h;e.image.getContext("2d").drawImage(this,0,0,i,h)}else{e.image=this}e.needsUpdate=!0};f.src=g}function t(d,c,A,p,o,l){var k=document.createElement("canvas");d[c]=new b.Texture(k);d[c].sourceFile=A;if(p){d[c].repeat.set(p[0],p[1]);if(p[0]!=1){d[c].wrapS=b.RepeatWrapping}if(p[1]!=1){d[c].wrapT=b.RepeatWrapping}}o&&d[c].offset.set(o[0],o[1]);if(l){p={repeat:b.RepeatWrapping,mirror:b.MirroredRepeatWrapping};if(p[l[0]]!==void 0){d[c].wrapS=p[l[0]]}if(p[l[1]]!==void 0){d[c].wrapT=p[l[1]]}}w(d[c],x+"/"+A)}function u(c){return(c[0]*255<<16)+(c[1]*255<<8)+c[2]*255}var v,s,r;s="MeshLambertMaterial";v={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,wireframe:z.wireframe};z.shading&&(z.shading=="Phong"?s="MeshPhongMaterial":z.shading=="Basic"&&(s="MeshBasicMaterial"));if(z.blending){if(z.blending=="Additive"){v.blending=b.AdditiveBlending}else{if(z.blending=="Subtractive"){v.blending=b.SubtractiveBlending}else{if(z.blending=="Multiply"){v.blending=b.MultiplyBlending}}}}if(z.transparent!==void 0||z.opacity<1){v.transparent=z.transparent}if(z.depthTest!==void 0){v.depthTest=z.depthTest}if(z.vertexColors!==void 0){if(z.vertexColors=="face"){v.vertexColors=b.FaceColors}else{if(z.vertexColors){v.vertexColors=b.VertexColors}}}if(z.colorDiffuse){v.color=u(z.colorDiffuse)}else{if(z.DbgColor){v.color=z.DbgColor}}if(z.colorSpecular){v.specular=u(z.colorSpecular)}if(z.colorAmbient){v.ambient=u(z.colorAmbient)}if(z.transparency){v.opacity=z.transparency}if(z.specularCoef){v.shininess=z.specularCoef}z.mapDiffuse&&x&&t(v,"map",z.mapDiffuse,z.mapDiffuseRepeat,z.mapDiffuseOffset,z.mapDiffuseWrap);z.mapLight&&x&&t(v,"lightMap",z.mapLight,z.mapLightRepeat,z.mapLightOffset,z.mapLightWrap);z.mapNormal&&x&&t(v,"normalMap",z.mapNormal,z.mapNormalRepeat,z.mapNormalOffset,z.mapNormalWrap);z.mapSpecular&&x&&t(v,"specularMap",z.mapSpecular,z.mapSpecularRepeat,z.mapSpecularOffset,z.mapSpecularWrap);if(z.mapNormal){var n=b.ShaderUtils.lib.normal,q=b.UniformsUtils.clone(n.uniforms),m=v.color;s=v.specular;r=v.ambient;var j=v.shininess;q.tNormal.texture=v.normalMap;if(z.mapNormalFactor){q.uNormalScale.value=z.mapNormalFactor}if(v.map){q.tDiffuse.texture=v.map,q.enableDiffuse.value=!0}if(v.specularMap){q.tSpecular.texture=v.specularMap,q.enableSpecular.value=!0}if(v.lightMap){q.tAO.texture=v.lightMap,q.enableAO.value=!0}q.uDiffuseColor.value.setHex(m);q.uSpecularColor.value.setHex(s);q.uAmbientColor.value.setHex(r);q.uShininess.value=j;if(v.opacity){q.uOpacity.value=v.opacity}v=new b.ShaderMaterial({fragmentShader:n.fragmentShader,vertexShader:n.vertexShader,uniforms:q,lights:!0,fog:!0})}else{v=new b[s](v)}return v}};b.BinaryLoader=function(c){b.Loader.call(this,c)};b.BinaryLoader.prototype=new b.Loader;b.BinaryLoader.prototype.constructor=b.BinaryLoader;b.BinaryLoader.prototype.supr=b.Loader.prototype;b.BinaryLoader.prototype.load=function(f,j,e,i){if(f instanceof Object){console.warn("DEPRECATED: BinaryLoader( parameters ) is now BinaryLoader( url, callback, texturePath, binaryPath )."),i=f,f=i.model,j=i.callback,e=i.texture_path,i=i.bin_path}var e=e?e:this.extractUrlbase(f),i=i?i:this.extractUrlbase(f),h=this.showProgress?b.Loader.prototype.updateProgress:null;this.onLoadStart();this.loadAjaxJSON(this,f,j,e,i,h)};b.BinaryLoader.prototype.loadAjaxJSON=function(i,n,h,m,j,k){var l=new XMLHttpRequest;l.onreadystatechange=function(){if(l.readyState==4){if(l.status==200||l.status==0){try{var d=JSON.parse(l.responseText);d.metadata===void 0||d.metadata.formatVersion===void 0||d.metadata.formatVersion!==3?console.error("Deprecated file format."):i.loadAjaxBuffers(d,h,j,m,k)}catch(c){console.error(c),console.warn("DEPRECATED: ["+n+"] seems to be using old model format")}}else{console.error("Couldn't load ["+n+"] ["+l.status+"]")}}};l.open("GET",n,!0);l.overrideMimeType("text/plain; charset=x-user-defined");l.setRequestHeader("Content-Type","text/plain");l.send(null)};b.BinaryLoader.prototype.loadAjaxBuffers=function(j,p,i,o,l){var m=new XMLHttpRequest,n=i+"/"+j.buffers,k=0;m.onreadystatechange=function(){m.readyState==4?m.status==200||m.status==0?b.BinaryLoader.prototype.createBinModel(m.response,p,o,j.materials):console.error("Couldn't load ["+n+"] ["+m.status+"]"):m.readyState==3?l&&(k==0&&(k=m.getResponseHeader("Content-Length")),l({total:k,loaded:m.responseText.length})):m.readyState==2&&(k=m.getResponseHeader("Content-Length"))};m.open("GET",n,!0);m.responseType="arraybuffer";m.send(null)};b.BinaryLoader.prototype.createBinModel=function(f,j,e,i){var h=function(U){function T(c){return c%4?4-c%4:0}function S(g,c){return(new Uint8Array(g,c,1))[0]}function R(g,c){return(new Uint32Array(g,c,1))[0]}function P(B,A){var y,x,w,v,u,t,r,q,p=new Uint32Array(f,A,3*B);for(y=0;y<B;y++){x=p[y*3];w=p[y*3+1];v=p[y*3+2];u=E[x*2];x=E[x*2+1];t=E[w*2];r=E[w*2+1];w=E[v*2];q=E[v*2+1];v=N.faceVertexUvs[0];var n=[];n.push(new b.UV(u,x));n.push(new b.UV(t,r));n.push(new b.UV(w,q));v.push(n)}}function Q(X,W){var V,F,B,A,y,x,w,v,u,t,r=new Uint32Array(f,W,4*X);for(V=0;V<X;V++){F=r[V*4];B=r[V*4+1];A=r[V*4+2];y=r[V*4+3];x=E[F*2];F=E[F*2+1];w=E[B*2];u=E[B*2+1];v=E[A*2];t=E[A*2+1];A=E[y*2];B=E[y*2+1];y=N.faceVertexUvs[0];var n=[];n.push(new b.UV(x,F));n.push(new b.UV(w,u));n.push(new b.UV(v,t));n.push(new b.UV(A,B));y.push(n)}}function M(k,r,q){for(var p,o,n,m,r=new Uint32Array(f,r,3*k),l=new Uint16Array(f,q,k),q=0;q<k;q++){p=r[q*3],o=r[q*3+1],n=r[q*3+2],m=l[q],N.faces.push(new b.Face3(p,o,n,null,null,m))}}function L(u,t,r){for(var q,p,o,n,m,t=new Uint32Array(f,t,4*u),l=new Uint16Array(f,r,u),r=0;r<u;r++){q=t[r*4],p=t[r*4+1],o=t[r*4+2],n=t[r*4+3],m=l[r],N.faces.push(new b.Face4(q,p,o,n,null,null,m))}}function O(aa,Z,Y,X){for(var W,V,F,B,A,y,x,Z=new Uint32Array(f,Z,3*aa),Y=new Uint32Array(f,Y,3*aa),w=new Uint16Array(f,X,aa),X=0;X<aa;X++){W=Z[X*3];V=Z[X*3+1];F=Z[X*3+2];A=Y[X*3];y=Y[X*3+1];x=Y[X*3+2];B=w[X];var v=z[y*3],u=z[y*3+1];y=z[y*3+2];var n=z[x*3],ab=z[x*3+1];x=z[x*3+2];N.faces.push(new b.Face3(W,V,F,[new b.Vector3(z[A*3],z[A*3+1],z[A*3+2]),new b.Vector3(v,u,y),new b.Vector3(n,ab,x)],null,B))}}function H(ai,ah,ag,af){for(var ae,ad,ac,ab,Z,Y,X,W,V,ah=new Uint32Array(f,ah,4*ai),ag=new Uint32Array(f,ag,4*ai),F=new Uint16Array(f,af,ai),af=0;af<ai;af++){ae=ah[af*4];ad=ah[af*4+1];ac=ah[af*4+2];ab=ah[af*4+3];Y=ag[af*4];X=ag[af*4+1];W=ag[af*4+2];V=ag[af*4+3];Z=F[af];var B=z[X*3],A=z[X*3+1];X=z[X*3+2];var aa=z[W*3],y=z[W*3+1];W=z[W*3+2];var w=z[V*3],n=z[V*3+1];V=z[V*3+2];N.faces.push(new b.Face4(ae,ad,ac,ab,[new b.Vector3(z[Y*3],z[Y*3+1],z[Y*3+2]),new b.Vector3(B,A,X),new b.Vector3(aa,y,W),new b.Vector3(w,n,V)],null,Z))}}var N=this,J=0,G,z=[],E=[],I,D,K,s,d,C;b.Geometry.call(this);b.Loader.prototype.initMaterials(N,i,U);G={signature:function(k,g,n){for(var k=new Uint8Array(k,g,n),m="",l=0;l<n;l++){m+=String.fromCharCode(k[g+l])}return m}(f,J,12),header_bytes:S(f,J+12),vertex_coordinate_bytes:S(f,J+13),normal_coordinate_bytes:S(f,J+14),uv_coordinate_bytes:S(f,J+15),vertex_index_bytes:S(f,J+16),normal_index_bytes:S(f,J+17),uv_index_bytes:S(f,J+18),material_index_bytes:S(f,J+19),nvertices:R(f,J+20),nnormals:R(f,J+20+4),nuvs:R(f,J+20+8),ntri_flat:R(f,J+20+12),ntri_smooth:R(f,J+20+16),ntri_flat_uv:R(f,J+20+20),ntri_smooth_uv:R(f,J+20+24),nquad_flat:R(f,J+20+28),nquad_smooth:R(f,J+20+32),nquad_flat_uv:R(f,J+20+36),nquad_smooth_uv:R(f,J+20+40)};G.signature!=="Three.js 003"&&console.warn("DEPRECATED: binary model seems to be using old format");J+=G.header_bytes;U=G.vertex_index_bytes*3+G.material_index_bytes;C=G.vertex_index_bytes*4+G.material_index_bytes;I=G.ntri_flat*U;D=G.ntri_smooth*(U+G.normal_index_bytes*3);K=G.ntri_flat_uv*(U+G.uv_index_bytes*3);s=G.ntri_smooth_uv*(U+G.normal_index_bytes*3+G.uv_index_bytes*3);d=G.nquad_flat*C;U=G.nquad_smooth*(C+G.normal_index_bytes*4);C=G.nquad_flat_uv*(C+G.uv_index_bytes*4);J+=function(k){var p=G.nvertices,k=new Float32Array(f,k,p*3),o,n,m,l;for(o=0;o<p;o++){n=k[o*3],m=k[o*3+1],l=k[o*3+2],N.vertices.push(new b.Vertex(new b.Vector3(n,m,l)))}return p*3*Float32Array.BYTES_PER_ELEMENT}(J);J+=function(k){var p=G.nnormals;if(p){var k=new Int8Array(f,k,p*3),o,n,m,l;for(o=0;o<p;o++){n=k[o*3],m=k[o*3+1],l=k[o*3+2],z.push(n/127,m/127,l/127)}}return p*3*Int8Array.BYTES_PER_ELEMENT}(J);J+=T(G.nnormals*3);J+=function(g){var n=G.nuvs;if(n){var g=new Float32Array(f,g,n*2),m,l,k;for(m=0;m<n;m++){l=g[m*2],k=g[m*2+1],E.push(l,k)}}return n*2*Float32Array.BYTES_PER_ELEMENT}(J);I=J+I+T(G.ntri_flat*2);D=I+D+T(G.ntri_smooth*2);K=D+K+T(G.ntri_flat_uv*2);s=K+s+T(G.ntri_smooth_uv*2);d=s+d+T(G.nquad_flat*2);U=d+U+T(G.nquad_smooth*2);C=U+C+T(G.nquad_flat_uv*2);(function(k){var g=G.ntri_flat_uv;if(g){var l=k+g*Uint32Array.BYTES_PER_ELEMENT*3;M(g,k,l+g*Uint32Array.BYTES_PER_ELEMENT*3);P(g,l)}})(D);(function(k){var g=G.ntri_smooth_uv;if(g){var m=k+g*Uint32Array.BYTES_PER_ELEMENT*3,l=m+g*Uint32Array.BYTES_PER_ELEMENT*3;O(g,k,m,l+g*Uint32Array.BYTES_PER_ELEMENT*3);P(g,l)}})(K);(function(k){var g=G.nquad_flat_uv;if(g){var l=k+g*Uint32Array.BYTES_PER_ELEMENT*4;L(g,k,l+g*Uint32Array.BYTES_PER_ELEMENT*4);Q(g,l)}})(U);(function(k){var g=G.nquad_smooth_uv;if(g){var m=k+g*Uint32Array.BYTES_PER_ELEMENT*4,l=m+g*Uint32Array.BYTES_PER_ELEMENT*4;H(g,k,m,l+g*Uint32Array.BYTES_PER_ELEMENT*4);Q(g,l)}})(C);(function(g){var c=G.ntri_flat;c&&M(c,g,g+c*Uint32Array.BYTES_PER_ELEMENT*3)})(J);(function(k){var g=G.ntri_smooth;if(g){var l=k+g*Uint32Array.BYTES_PER_ELEMENT*3;O(g,k,l,l+g*Uint32Array.BYTES_PER_ELEMENT*3)}})(I);(function(g){var c=G.nquad_flat;c&&L(c,g,g+c*Uint32Array.BYTES_PER_ELEMENT*4)})(s);(function(k){var g=G.nquad_smooth;if(g){var l=k+g*Uint32Array.BYTES_PER_ELEMENT*4;H(g,k,l,l+g*Uint32Array.BYTES_PER_ELEMENT*4)}})(d);this.computeCentroids();this.computeFaceNormals();b.Loader.prototype.hasNormals(this)&&this.computeTangents()};h.prototype=new b.Geometry;h.prototype.constructor=h;j(new h(e))};b.ColladaLoader=function(){function aX(c,h,f){aO=c;h=h||ao;f!==void 0&&(c=f.split("/"),c.pop(),aD=c.length<1?"":c.join("/")+"/");at=aV("//dae:library_images/dae:image",aT,"image");C=aV("//dae:library_materials/dae:material",au,"material");ax=aV("//dae:library_effects/dae:effect",Y,"effect");N=aV("//dae:library_geometries/dae:geometry",aH,"geometry");aB=aV("//dae:library_controllers/dae:controller",aQ,"controller");aF=aV("//dae:library_animations/dae:animation",ae,"animation");aq=aV(".//dae:library_visual_scenes/dae:visual_scene",aN,"visual_scene");ab=[];az=[];(c=aO.evaluate(".//dae:scene/dae:instance_visual_scene",aO,ah,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null).iterateNext())?(c=c.getAttribute("url").replace(/^#/,""),L=aq[c]):L=null;z=new b.Object3D;for(c=0;c<L.nodes.length;c++){z.add(aS(L.nodes[c]))}aW();for(var e in aF){}e={scene:z,morphs:ab,skins:az,dae:{images:at,materials:C,effects:ax,geometries:N,controllers:aB,animations:aF,visualScenes:aq,scene:L}};h&&h(e);return e}function aV(h,g,l){for(var h=aO.evaluate(h,aO,ah,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null),k={},j=h.iterateNext(),i=0;j;){j=(new g).parse(j);if(j.id.length==0){j.id=l+i++}k[j.id]=j;j=h.iterateNext()}return k}function aW(){var i=1000000,h=-i,n=0,m;for(m in aF){for(var l=aF[m],k=0;k<l.sampler.length;k++){var j=l.sampler[k];j.create();i=Math.min(i,j.startTime);h=Math.max(h,j.endTime);n=Math.max(n,j.input.length)}}return{start:i,end:h,frames:n}}function aU(g,d,j,i){g.world=g.world||new b.Matrix4;g.world.copy(g.matrix);if(g.channels&&g.channels.length){var h=g.channels[0].sampler.output[j];h instanceof b.Matrix4&&g.world.copy(h)}i&&g.world.multiply(i,g.world);d.push(g);for(i=0;i<g.nodes.length;i++){aU(g.nodes[i],d,j,g.world)}}function aR(J,I,H){var G=aB[I.url];if(!G||!G.skin){console.log("ColladaLoader: Could not find skin controller.")}else{if(!I.skeleton||!I.skeleton.length){console.log("ColladaLoader: Could not find the skeleton for the skin. ")}else{var F=aW(),I=L.getChildById(I.skeleton[0],!0)||L.getChildBySid(I.skeleton[0],!0),E,B,A,y,x=new b.Vector3,w;for(E=0;E<J.vertices.length;E++){G.skin.bindShapeMatrix.multiplyVector3(J.vertices[E].position)}for(H=0;H<F.frames;H++){var v=[],u=[];for(E=0;E<J.vertices.length;E++){u.push(new b.Vertex(new b.Vector3))}aU(I,v,H);E=v;B=G.skin;for(y=0;y<E.length;y++){if(A=E[y],w=-1,A.type=="JOINT"){for(var t=0;t<B.joints.length;t++){if(A.sid==B.joints[t]){w=t;break}}if(w>=0){t=B.invBindMatrices[w];A.invBindMatrix=t;A.skinningMatrix=new b.Matrix4;A.skinningMatrix.multiply(A.world,t);A.weights=[];for(t=0;t<B.weights.length;t++){for(var s=0;s<B.weights[t].length;s++){var d=B.weights[t][s];d.joint==w&&A.weights.push(d)}}}else{throw"ColladaLoader: Could not find joint '"+A.sid+"'."}}}for(E=0;E<v.length;E++){if(v[E].type=="JOINT"){for(B=0;B<v[E].weights.length;B++){A=v[E].weights[B],y=A.index,A=A.weight,w=J.vertices[y],y=u[y],x.x=w.position.x,x.y=w.position.y,x.z=w.position.z,v[E].skinningMatrix.multiplyVector3(x),y.position.x+=x.x*A,y.position.y+=x.y*A,y.position.z+=x.z*A}}}J.morphTargets.push({name:"target_"+H,vertices:u})}}}}function aS(x){var w=new b.Object3D,v,u,t,s;for(t=0;t<x.controllers.length;t++){var r=aB[x.controllers[t].url];switch(r.type){case"skin":if(N[r.skin.source]){var q=new aK;q.url=r.skin.source;q.instance_material=x.controllers[t].instance_material;x.geometries.push(q);v=x.controllers[t]}else{if(aB[r.skin.source]&&(u=r=aB[r.skin.source],r.morph&&N[r.morph.source])){q=new aK,q.url=r.morph.source,q.instance_material=x.controllers[t].instance_material,x.geometries.push(q)}}break;case"morph":if(N[r.morph.source]){q=new aK,q.url=r.morph.source,q.instance_material=x.controllers[t].instance_material,x.geometries.push(q),u=x.controllers[t]}console.log("ColladaLoader: Morph-controller partially supported.")}}for(t=0;t<x.geometries.length;t++){var r=x.geometries[t],q=r.instance_material,r=N[r.url],n={},m=0,g;if(r&&r.mesh&&r.mesh.primitives){if(w.name.length==0){w.name=r.id}if(q){for(s=0;s<q.length;s++){g=q[s];var f=ax[C[g.target].instance_effect.url].shader;f.material.opacity=!f.material.opacity?1:f.material.opacity;g=n[g.symbol]=f.material;m++}}q=g||new b.MeshLambertMaterial({color:14540253,shading:b.FlatShading});r=r.mesh.geometry3js;if(m>1){q=new b.MeshFaceMaterial;for(s=0;s<r.faces.length;s++){m=r.faces[s],m.materials=[n[m.daeMaterial]]}}if(v!==void 0){aR(r,v),q.morphTargets=!0,q=new b.SkinnedMesh(r,q),q.skeleton=v.skeleton,q.skinController=aB[v.url],q.skinInstanceController=v,q.name="skin_"+az.length,az.push(q)}else{if(u!==void 0){s=r;n=u instanceof aL?aB[u.url]:u;if(!n||!n.morph){console.log("could not find morph controller!")}else{n=n.morph;for(m=0;m<n.targets.length;m++){if(f=N[n.targets[m]],f.mesh&&f.mesh.primitives&&f.mesh.primitives.length){f=f.mesh.primitives[0].geometry,f.vertices.length===s.vertices.length&&s.morphTargets.push({name:"target_1",vertices:f.vertices})}}s.morphTargets.push({name:"target_Z",vertices:s.vertices})}q.morphTargets=!0;q=new b.Mesh(r,q);q.name="morph_"+ab.length;ab.push(q)}else{q=new b.Mesh(r,q)}}x.geometries.length>1?w.add(q):w=q}}w.name=x.id||"";x.matrix.decompose(w.position,w.rotation,w.scale);for(t=0;t<x.nodes.length;t++){w.add(aS(x.nodes[t],x))}return w}function aT(){this.init_from=this.id=""}function aQ(){this.type=this.name=this.id="";this.morph=this.skin=null}function aP(){this.weights=this.targets=this.source=this.method=null}function aM(){this.source="";this.bindShapeMatrix=null;this.invBindMatrices=[];this.joints=[];this.weights=[]}function aN(){this.name=this.id="";this.nodes=[];this.scene=new b.Object3D}function aJ(){this.sid=this.name=this.id="";this.nodes=[];this.controllers=[];this.transforms=[];this.geometries=[];this.channels=[];this.matrix=new b.Matrix4}function aI(){this.type=this.sid="";this.data=[];this.matrix=new b.Matrix4}function aL(){this.url="";this.skeleton=[];this.instance_material=[]}function aG(){this.target=this.symbol=""}function aK(){this.url="";this.instance_material=[]}function aH(){this.id="";this.mesh=null}function aC(c){this.geometry=c.id;this.primitives=[];this.geometry3js=this.vertices=null}function aw(){}function aA(){this.material="";this.count=0;this.inputs=[];this.vcount=null;this.p=[];this.geometry=new b.Geometry}function al(){this.source="";this.stride=this.count=0;this.params=[]}function aj(){this.input={}}function am(){this.semantic="";this.offset=0;this.source="";this.set=0}function av(c){this.id=c;this.type=null}function au(){this.name=this.id="";this.instance_effect=null}function ay(){this.color=new b.Color(0);this.color.setRGB(Math.random(),Math.random(),Math.random());this.color.a=1;this.texcoord=this.texture=null}function af(d,c){this.type=d;this.effect=c;this.material=null}function aE(c){this.effect=c;this.format=this.init_from=null}function ak(c){this.effect=c;this.mipfilter=this.magfilter=this.minfilter=this.wrap_t=this.wrap_s=this.source=null}function Y(){this.name=this.id="";this.sampler=this.surface=this.shader=null}function Q(){this.url=""}function ae(){this.name=this.id="";this.source={};this.sampler=[];this.channel=[]}function Z(c){this.animation=c;this.target=this.source="";this.member=this.arrIndices=this.arrSyntax=this.dotSyntax=this.sid=null}function ac(c){this.id="";this.animation=c;this.inputs=[];this.endTime=this.startTime=this.interpolation=this.output=this.input=null;this.duration=0}function an(d){var c=d.getAttribute("id");if(ap[c]!=void 0){return ap[c]}ap[c]=(new av(c)).parse(d);return ap[c]}function ah(c){if(c=="dae"){return"http://www.collada.org/2005/11/COLLADASchema"}return null}function ai(e){for(var e=ad(e),d=[],f=0;f<e.length;f++){d.push(parseFloat(e[f]))}return d}function ag(e){for(var e=ad(e),d=[],f=0;f<e.length;f++){d.push(parseInt(e[f],10))}return d}function ad(c){return c.replace(/^\s+/,"").replace(/\s+$/,"").split(/\s+/)}function T(e,d,f){return e.hasAttribute(d)?parseInt(e.getAttribute(d),10):f}function aY(e,d){if(e===void 0){for(var f="0.";f.length<d+2;){f+="0"}return f}d=d||2;f=e.toString().split(".");for(f[1]=f.length>1?f[1].substr(0,d):"0";f[1].length<d;){f[1]+="0"}return f.join(".")}function D(e,d){var f="";f+=aY(e.x,d)+",";f+=aY(e.y,d)+",";f+=aY(e.z,d);return f}var aO=null,z=null,L,ao=null,ap={},at={},aF={},aB={},N={},C={},ax={},aq,aD,ab,az,ar=b.SmoothShading;aT.prototype.parse=function(e){this.id=e.getAttribute("id");for(var d=0;d<e.childNodes.length;d++){var f=e.childNodes[d];if(f.nodeName=="init_from"){this.init_from=f.textContent}}return this};aQ.prototype.parse=function(e){this.id=e.getAttribute("id");this.name=e.getAttribute("name");this.type="none";for(var d=0;d<e.childNodes.length;d++){var f=e.childNodes[d];switch(f.nodeName){case"skin":this.skin=(new aM).parse(f);this.type=f.nodeName;break;case"morph":this.morph=(new aP).parse(f),this.type=f.nodeName}}return this};aP.prototype.parse=function(g){var f={},j=[],i;this.method=g.getAttribute("method");this.source=g.getAttribute("source").replace(/^#/,"");for(i=0;i<g.childNodes.length;i++){var h=g.childNodes[i];if(h.nodeType==1){switch(h.nodeName){case"source":h=(new av).parse(h);f[h.id]=h;break;case"targets":j=this.parseInputs(h);break;default:console.log(h.nodeName)}}}for(i=0;i<j.length;i++){switch(g=j[i],h=f[g.source],g.semantic){case"MORPH_TARGET":this.targets=h.read();break;case"MORPH_WEIGHT":this.weights=h.read()}}return this};aP.prototype.parseInputs=function(f){for(var e=[],h=0;h<f.childNodes.length;h++){var g=f.childNodes[h];if(g.nodeType==1){switch(g.nodeName){case"input":e.push((new am).parse(g))}}}return e};aM.prototype.parse=function(h){var g={},l,k;this.source=h.getAttribute("source").replace(/^#/,"");this.invBindMatrices=[];this.joints=[];this.weights=[];for(var j=0;j<h.childNodes.length;j++){var i=h.childNodes[j];if(i.nodeType==1){switch(i.nodeName){case"bind_shape_matrix":i=ai(i.textContent);this.bindShapeMatrix=new b.Matrix4;this.bindShapeMatrix.set(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8],i[9],i[10],i[11],i[12],i[13],i[14],i[15]);break;case"source":i=(new av).parse(i);g[i.id]=i;break;case"joints":l=i;break;case"vertex_weights":k=i;break;default:console.log(i.nodeName)}}}this.parseJoints(l,g);this.parseWeights(k,g);return this};aM.prototype.parseJoints=function(g,f){for(var j=0;j<g.childNodes.length;j++){var i=g.childNodes[j];if(i.nodeType==1){switch(i.nodeName){case"input":var i=(new am).parse(i),h=f[i.source];if(i.semantic=="JOINT"){this.joints=h.read()}else{if(i.semantic=="INV_BIND_MATRIX"){this.invBindMatrices=h.read()}}}}}};aM.prototype.parseWeights=function(E,B){for(var A,y,x=[],w=0;w<E.childNodes.length;w++){var v=E.childNodes[w];if(v.nodeType==1){switch(v.nodeName){case"input":x.push((new am).parse(v));break;case"v":A=ag(v.textContent);break;case"vcount":y=ag(v.textContent)}}}for(w=v=0;w<y.length;w++){for(var u=y[w],t=[],s=0;s<u;s++){for(var r={},q=0;q<x.length;q++){var p=x[q],o=A[v+p.offset];switch(p.semantic){case"JOINT":r.joint=o;break;case"WEIGHT":r.weight=B[p.source].data[o]}}t.push(r);v+=x.length}for(s=0;s<t.length;s++){t[s].index=w}this.weights.push(t)}};aN.prototype.getChildById=function(f,e){for(var h=0;h<this.nodes.length;h++){var g=this.nodes[h].getChildById(f,e);if(g){return g}}return null};aN.prototype.getChildBySid=function(f,e){for(var h=0;h<this.nodes.length;h++){var g=this.nodes[h].getChildBySid(f,e);if(g){return g}}return null};aN.prototype.parse=function(e){this.id=e.getAttribute("id");this.name=e.getAttribute("name");this.nodes=[];for(var d=0;d<e.childNodes.length;d++){var f=e.childNodes[d];if(f.nodeType==1){switch(f.nodeName){case"node":this.nodes.push((new aJ).parse(f))}}}return this};aJ.prototype.getChannelForTransform=function(j){for(var i=0;i<this.channels.length;i++){var p=this.channels[i],o=p.target.split("/");o.shift();var n=o.shift(),m=n.indexOf(".")>=0,l=n.indexOf("(")>=0,k;if(m){o=n.split("."),n=o.shift(),o.shift()}else{if(l){k=n.split("(");n=k.shift();for(o=0;o<k.length;o++){k[o]=parseInt(k[o].replace(/\)/,""))}}}if(n==j){return p.info={sid:n,dotSyntax:m,arrSyntax:l,arrIndices:k},p}}return null};aJ.prototype.getChildById=function(f,e){if(this.id==f){return this}if(e){for(var h=0;h<this.nodes.length;h++){var g=this.nodes[h].getChildById(f,e);if(g){return g}}}return null};aJ.prototype.getChildBySid=function(f,e){if(this.sid==f){return this}if(e){for(var h=0;h<this.nodes.length;h++){var g=this.nodes[h].getChildBySid(f,e);if(g){return g}}}return null};aJ.prototype.getTransformBySid=function(d){for(var c=0;c<this.transforms.length;c++){if(this.transforms[c].sid==d){return this.transforms[c]}}return null};aJ.prototype.parse=function(v){var u;this.id=v.getAttribute("id");this.sid=v.getAttribute("sid");this.name=v.getAttribute("name");this.type=v.getAttribute("type");this.type=this.type=="JOINT"?this.type:"NODE";this.nodes=[];this.transforms=[];this.geometries=[];this.controllers=[];this.matrix=new b.Matrix4;for(var t=0;t<v.childNodes.length;t++){if(u=v.childNodes[t],u.nodeType==1){switch(u.nodeName){case"node":this.nodes.push((new aJ).parse(u));break;case"instance_camera":break;case"instance_controller":this.controllers.push((new aL).parse(u));break;case"instance_geometry":this.geometries.push((new aK).parse(u));break;case"instance_light":break;case"instance_node":u=u.getAttribute("url").replace(/^#/,"");(u=aO.evaluate(".//dae:library_nodes//dae:node[@id='"+u+"']",aO,ah,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null).iterateNext())&&this.nodes.push((new aJ).parse(u));break;case"rotate":case"translate":case"scale":case"matrix":case"lookat":case"skew":this.transforms.push((new aI).parse(u));break;case"extra":break;default:console.log(u.nodeName)}}}v=[];t=1000000;u=-1000000;for(var s in aF){for(var r=aF[s],q=0;q<r.channel.length;q++){var p=r.channel[q],o=r.sampler[q];s=p.target.split("/")[0];if(s==this.id){o.create(),p.sampler=o,t=Math.min(t,o.startTime),u=Math.max(u,o.endTime),v.push(p)}}}if(v.length){this.startTime=t,this.endTime=u}if((this.channels=v)&&this.channels.length){s=10000000;for(v=0;v<this.channels.length;v++){t=this.channels[v].sampler;for(u=0;u<t.input.length-1;u++){s=Math.min(s,t.input[u+1]-t.input[u])}}t=[];for(v=this.startTime;v<this.endTime;v+=s){u=v;for(var r={},n=q=void 0,q=0;q<this.channels.length;q++){n=this.channels[q],r[n.sid]=n}p=new b.Matrix4;for(q=0;q<this.transforms.length;q++){if(o=this.transforms[q],n=r[o.sid],n!==void 0){for(var m=n.sampler,j,n=0;n<m.input.length-1;n++){if(m.input[n+1]>u){j=m.output[n];break}}p=j!==void 0?j instanceof b.Matrix4?p.multiply(p,j):p.multiply(p,o.matrix):p.multiply(p,o.matrix)}else{p=p.multiply(p,o.matrix)}}u=p;t.push({time:v,pos:[u.n14,u.n24,u.n34],rotq:[0,0,0,1],scl:[1,1,1]})}this.keys=t}this.updateMatrix();return this};aJ.prototype.updateMatrix=function(){this.matrix.identity();for(var c=0;c<this.transforms.length;c++){this.matrix.multiply(this.matrix,this.transforms[c].matrix)}};aI.prototype.parse=function(c){this.sid=c.getAttribute("sid");this.type=c.nodeName;this.data=ai(c.textContent);this.updateMatrix();return this};aI.prototype.updateMatrix=function(){var c=0;this.matrix.identity();switch(this.type){case"matrix":this.matrix.set(this.data[0],this.data[1],this.data[2],this.data[3],this.data[4],this.data[5],this.data[6],this.data[7],this.data[8],this.data[9],this.data[10],this.data[11],this.data[12],this.data[13],this.data[14],this.data[15]);break;case"translate":this.matrix.setTranslation(this.data[0],this.data[1],this.data[2]);break;case"rotate":c=this.data[3]*(Math.PI/180);this.matrix.setRotationAxis(new b.Vector3(this.data[0],this.data[1],this.data[2]),c);break;case"scale":this.matrix.setScale(this.data[0],this.data[1],this.data[2])}return this.matrix};aL.prototype.parse=function(f){this.url=f.getAttribute("url").replace(/^#/,"");this.skeleton=[];this.instance_material=[];for(var e=0;e<f.childNodes.length;e++){var h=f.childNodes[e];if(h.nodeType==1){switch(h.nodeName){case"skeleton":this.skeleton.push(h.textContent.replace(/^#/,""));break;case"bind_material":if(h=aO.evaluate(".//dae:instance_material",h,ah,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null)){for(var g=h.iterateNext();g;){this.instance_material.push((new aG).parse(g)),g=h.iterateNext()}}}}}return this};aG.prototype.parse=function(c){this.symbol=c.getAttribute("symbol");this.target=c.getAttribute("target").replace(/^#/,"");return this};aK.prototype.parse=function(e){this.url=e.getAttribute("url").replace(/^#/,"");this.instance_material=[];for(var d=0;d<e.childNodes.length;d++){var f=e.childNodes[d];if(f.nodeType==1&&f.nodeName=="bind_material"){if(e=aO.evaluate(".//dae:instance_material",f,ah,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null)){for(d=e.iterateNext();d;){this.instance_material.push((new aG).parse(d)),d=e.iterateNext()}}break}}return this};aH.prototype.parse=function(e){this.id=e.getAttribute("id");for(var d=0;d<e.childNodes.length;d++){var f=e.childNodes[d];switch(f.nodeName){case"mesh":this.mesh=(new aC(this)).parse(f)}}return this};aC.prototype.parse=function(h){function g(e,m){var f=D(e.position);j[f]===void 0&&(j[f]={v:e,index:m});return j[f]}this.primitives=[];var l;for(l=0;l<h.childNodes.length;l++){var k=h.childNodes[l];switch(k.nodeName){case"source":an(k);break;case"vertices":this.vertices=(new aj).parse(k);break;case"triangles":this.primitives.push((new aA).parse(k));break;case"polygons":console.warn("polygon holes not yet supported!");case"polylist":this.primitives.push((new aw).parse(k))}}var j={};this.geometry3js=new b.Geometry;k=ap[this.vertices.input.POSITION.source].data;for(h=l=0;l<k.length;l+=3,h++){var i=new b.Vertex(new b.Vector3(k[l],k[l+1],k[l+2]));g(i,h);this.geometry3js.vertices.push(i)}for(l=0;l<this.primitives.length;l++){h=this.primitives[l],h.setVertices(this.vertices),this.handlePrimitive(h,this.geometry3js,j)}this.geometry3js.computeCentroids();this.geometry3js.computeFaceNormals();this.geometry3js.computeVertexNormals();this.geometry3js.computeBoundingBox();return this};aC.prototype.handlePrimitive=function(U,S,R){var P=0,O,M,K=U.p,J=U.inputs,I,H,G,F,E=0,B=3,A=[];for(O=0;O<J.length;O++){switch(I=J[O],I.semantic){case"TEXCOORD":A.push(I.set)}}for(;P<K.length;){var y=[],x=[],w={},u=[];U.vcount&&(B=U.vcount[E++]);for(O=0;O<B;O++){for(M=0;M<J.length;M++){switch(I=J[M],F=ap[I.source],H=K[P+O*J.length+I.offset],G=F.accessor.params.length,G*=H,I.semantic){case"VERTEX":I=D(S.vertices[H].position);y.push(R[I].index);break;case"NORMAL":x.push(new b.Vector3(F.data[G],F.data[G+1],F.data[G+2]));break;case"TEXCOORD":w[I.set]===void 0&&(w[I.set]=[]);w[I.set].push(new b.UV(F.data[G],F.data[G+1]));break;case"COLOR":u.push((new b.Color).setRGB(F.data[G],F.data[G+1],F.data[G+2]))}}}var v;B==3?v=new b.Face3(y[0],y[1],y[2],[x[0],x[1],x[2]],u.length?u:new b.Color):B==4&&(v=new b.Face4(y[0],y[1],y[2],y[3],[x[0],x[1],x[2],x[3]],u.length?u:new b.Color));v.daeMaterial=U.material;S.faces.push(v);for(M=0;M<A.length;M++){O=w[A[M]],S.faceVertexUvs[M].push([O[0],O[1],O[2]])}P+=J.length*B}};aw.prototype=new aA;aw.prototype.constructor=aw;aA.prototype.setVertices=function(d){for(var c=0;c<this.inputs.length;c++){if(this.inputs[c].source==d.id){this.inputs[c].source=d.input.POSITION.source}}};aA.prototype.parse=function(e){this.inputs=[];this.material=e.getAttribute("material");this.count=T(e,"count",0);for(var d=0;d<e.childNodes.length;d++){var f=e.childNodes[d];switch(f.nodeName){case"input":this.inputs.push((new am).parse(e.childNodes[d]));break;case"vcount":this.vcount=ag(f.textContent);break;case"p":this.p=ag(f.textContent)}}return this};al.prototype.parse=function(f){this.params=[];this.source=f.getAttribute("source");this.count=T(f,"count",0);this.stride=T(f,"stride",0);for(var e=0;e<f.childNodes.length;e++){var h=f.childNodes[e];if(h.nodeName=="param"){var g={};g.name=h.getAttribute("name");g.type=h.getAttribute("type");this.params.push(g)}}return this};aj.prototype.parse=function(e){this.id=e.getAttribute("id");for(var d=0;d<e.childNodes.length;d++){if(e.childNodes[d].nodeName=="input"){var f=(new am).parse(e.childNodes[d]);this.input[f.semantic]=f}}return this};am.prototype.parse=function(c){this.semantic=c.getAttribute("semantic");this.source=c.getAttribute("source").replace(/^#/,"");this.set=T(c,"set",-1);this.offset=T(c,"offset",0);if(this.semantic=="TEXCOORD"&&this.set<0){this.set=0}return this};av.prototype.parse=function(h){this.id=h.getAttribute("id");for(var g=0;g<h.childNodes.length;g++){var l=h.childNodes[g];switch(l.nodeName){case"bool_array":for(var k=ad(l.textContent),j=[],i=0;i<k.length;i++){j.push(k[i]=="true"||k[i]=="1"?!0:!1)}this.data=j;this.type=l.nodeName;break;case"float_array":this.data=ai(l.textContent);this.type=l.nodeName;break;case"int_array":this.data=ag(l.textContent);this.type=l.nodeName;break;case"IDREF_array":case"Name_array":this.data=ad(l.textContent);this.type=l.nodeName;break;case"technique_common":for(k=0;k<l.childNodes.length;k++){if(l.childNodes[k].nodeName=="accessor"){this.accessor=(new al).parse(l.childNodes[k]);break}}}}return this};av.prototype.read=function(){var f=[],e=this.accessor.params[0];switch(e.type){case"IDREF":case"Name":case"name":case"float":return this.data;case"float4x4":for(e=0;e<this.data.length;e+=16){var h=this.data.slice(e,e+16),g=new b.Matrix4;g.set(h[0],h[1],h[2],h[3],h[4],h[5],h[6],h[7],h[8],h[9],h[10],h[11],h[12],h[13],h[14],h[15]);f.push(g)}break;default:console.log("ColladaLoader: Source: Read dont know how to read "+e.type+".")}return f};au.prototype.parse=function(d){this.id=d.getAttribute("id");this.name=d.getAttribute("name");for(var c=0;c<d.childNodes.length;c++){if(d.childNodes[c].nodeName=="instance_effect"){this.instance_effect=(new Q).parse(d.childNodes[c]);break}}return this};ay.prototype.isColor=function(){return this.texture==null};ay.prototype.isTexture=function(){return this.texture!=null};ay.prototype.parse=function(e){for(var d=0;d<e.childNodes.length;d++){var f=e.childNodes[d];if(f.nodeType==1){switch(f.nodeName){case"color":f=ai(f.textContent);this.color=new b.Color(0);this.color.setRGB(f[0],f[1],f[2]);this.color.a=f[3];break;case"texture":this.texture=f.getAttribute("texture"),this.texcoord=f.getAttribute("texcoord")}}}return this};af.prototype.parse=function(h){for(var g=0;g<h.childNodes.length;g++){var l=h.childNodes[g];if(l.nodeType==1){switch(l.nodeName){case"ambient":case"emission":case"diffuse":case"specular":case"transparent":this[l.nodeName]=(new ay).parse(l);break;case"shininess":case"reflectivity":case"transparency":var k;k=aO.evaluate(".//dae:float",l,ah,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);for(var j=k.iterateNext(),i=[];j;){i.push(j),j=k.iterateNext()}k=i;k.length>0&&(this[l.nodeName]=parseFloat(k[0].textContent))}}}this.create();return this};af.prototype.create=function(){var f={},e=this.transparency!==void 0&&this.transparency<1,h;for(h in this){switch(h){case"ambient":case"emission":case"diffuse":case"specular":var g=this[h];if(g instanceof ay){if(g.isTexture()){if(this.effect.sampler&&this.effect.surface&&this.effect.sampler.source==this.effect.surface.sid&&(g=at[this.effect.surface.init_from])){f.map=b.ImageUtils.loadTexture(aD+g.init_from),f.map.wrapS=b.RepeatWrapping,f.map.wrapT=b.RepeatWrapping,f.map.repeat.x=1,f.map.repeat.y=-1}}else{h=="diffuse"?f.color=g.color.getHex():e||(f[h]=g.color.getHex())}}break;case"shininess":case"reflectivity":f[h]=this[h];break;case"transparency":if(e){f.transparent=!0,f.opacity=this[h],e=!0}}}f.shading=ar;return this.material=new b.MeshLambertMaterial(f)};aE.prototype.parse=function(e){for(var d=0;d<e.childNodes.length;d++){var f=e.childNodes[d];if(f.nodeType==1){switch(f.nodeName){case"init_from":this.init_from=f.textContent;break;case"format":this.format=f.textContent;break;default:console.log("unhandled Surface prop: "+f.nodeName)}}}return this};ak.prototype.parse=function(e){for(var d=0;d<e.childNodes.length;d++){var f=e.childNodes[d];if(f.nodeType==1){switch(f.nodeName){case"source":this.source=f.textContent;break;case"minfilter":this.minfilter=f.textContent;break;case"magfilter":this.magfilter=f.textContent;break;case"mipfilter":this.mipfilter=f.textContent;break;case"wrap_s":this.wrap_s=f.textContent;break;case"wrap_t":this.wrap_t=f.textContent;break;default:console.log("unhandled Sampler2D prop: "+f.nodeName)}}}return this};Y.prototype.create=function(){if(this.shader==null){return null}};Y.prototype.parse=function(e){this.id=e.getAttribute("id");this.name=e.getAttribute("name");this.shader=null;for(var d=0;d<e.childNodes.length;d++){var f=e.childNodes[d];if(f.nodeType==1){switch(f.nodeName){case"profile_COMMON":this.parseTechnique(this.parseProfileCOMMON(f))}}}return this};Y.prototype.parseNewparam=function(f){for(var e=f.getAttribute("sid"),h=0;h<f.childNodes.length;h++){var g=f.childNodes[h];if(g.nodeType==1){switch(g.nodeName){case"surface":this.surface=(new aE(this)).parse(g);this.surface.sid=e;break;case"sampler2D":this.sampler=(new ak(this)).parse(g);this.sampler.sid=e;break;case"extra":break;default:console.log(g.nodeName)}}}};Y.prototype.parseProfileCOMMON=function(f){for(var e,h=0;h<f.childNodes.length;h++){var g=f.childNodes[h];if(g.nodeType==1){switch(g.nodeName){case"profile_COMMON":this.parseProfileCOMMON(g);break;case"technique":e=g;break;case"newparam":this.parseNewparam(g);break;case"extra":break;default:console.log(g.nodeName)}}}return e};Y.prototype.parseTechnique=function(e){for(var d=0;d<e.childNodes.length;d++){var f=e.childNodes[d];if(f.nodeType==1){switch(f.nodeName){case"lambert":case"blinn":case"phong":this.shader=(new af(f.nodeName,this)).parse(f)}}}};Q.prototype.parse=function(c){this.url=c.getAttribute("url").replace(/^#/,"");return this};ae.prototype.parse=function(e){this.id=e.getAttribute("id");this.name=e.getAttribute("name");this.source={};for(var d=0;d<e.childNodes.length;d++){var f=e.childNodes[d];if(f.nodeType==1){switch(f.nodeName){case"source":f=(new av).parse(f);this.source[f.id]=f;break;case"sampler":this.sampler.push((new ac(this)).parse(f));break;case"channel":this.channel.push((new Z(this)).parse(f))}}}return this};Z.prototype.parse=function(h){this.source=h.getAttribute("source").replace(/^#/,"");this.target=h.getAttribute("target");var g=this.target.split("/");g.shift();var h=g.shift(),l=h.indexOf(".")>=0,k=h.indexOf("(")>=0,j,i;if(l){g=h.split("."),h=g.shift(),i=g.shift()}else{if(k){j=h.split("(");h=j.shift();for(g=0;g<j.length;g++){j[g]=parseInt(j[g].replace(/\)/,""))}}}this.sid=h;this.dotSyntax=l;this.arrSyntax=k;this.arrIndices=j;this.member=i;return this};ac.prototype.parse=function(e){this.id=e.getAttribute("id");this.inputs=[];for(var d=0;d<e.childNodes.length;d++){var f=e.childNodes[d];if(f.nodeType==1){switch(f.nodeName){case"input":this.inputs.push((new am).parse(f))}}}return this};ac.prototype.create=function(){for(var e=0;e<this.inputs.length;e++){var d=this.inputs[e],f=this.animation.source[d.source];switch(d.semantic){case"INPUT":this.input=f.read();break;case"OUTPUT":this.output=f.read();break;case"INTERPOLATION":this.interpolation=f.read();break;case"IN_TANGENT":break;case"OUT_TANGENT":break;default:console.log(d.semantic)}}this.duration=this.endTime=this.startTime=0;if(this.input.length){this.startTime=100000000;this.endTime=-100000000;for(e=0;e<this.input.length;e++){this.startTime=Math.min(this.startTime,this.input[e]),this.endTime=Math.max(this.endTime,this.input[e])}this.duration=this.endTime-this.startTime}};return{load:function(e,g){if(document.implementation&&document.implementation.createDocument){document.implementation.createDocument("http://www.collada.org/2005/11/COLLADASchema","COLLADA",null);e+="?rnd="+Math.random();var f=new XMLHttpRequest;f.overrideMimeType&&f.overrideMimeType("text/xml");f.onreadystatechange=function(){if(f.readyState==4&&(f.status==0||f.status==200)){ao=g,aX(f.responseXML,void 0,e)}};f.open("GET",e,!0);f.send(null)}else{alert("Don't know how to parse XML!")}},parse:aX,setPreferredShading:function(c){ar=c},applySkin:aR,geometries:N}};b.JSONLoader=function(c){b.Loader.call(this,c)};b.JSONLoader.prototype=new b.Loader;b.JSONLoader.prototype.constructor=b.JSONLoader;b.JSONLoader.prototype.supr=b.Loader.prototype;b.JSONLoader.prototype.load=function(e,f,d){if(e instanceof Object){console.warn("DEPRECATED: JSONLoader( parameters ) is now JSONLoader( url, callback, texturePath )."),d=e,e=d.model,f=d.callback,d=d.texture_path}d=d?d:this.extractUrlbase(e);this.onLoadStart();this.loadAjaxJSON(this,e,f,d)};b.JSONLoader.prototype.loadAjaxJSON=function(i,n,h,m,j){var k=new XMLHttpRequest,l=0;k.onreadystatechange=function(){if(k.readyState==4){if(k.status==200||k.status==0){try{var d=JSON.parse(k.responseText);i.createModel(d,h,m);i.onLoadComplete()}catch(c){console.error(c),console.warn("DEPRECATED: ["+n+"] seems to be using old model format")}}else{console.error("Couldn't load ["+n+"] ["+k.status+"]")}}else{k.readyState==3?j&&(l==0&&(l=k.getResponseHeader("Content-Length")),j({total:l,loaded:k.responseText.length})):k.readyState==2&&(l=k.getResponseHeader("Content-Length"))}};k.open("GET",n,!0);k.overrideMimeType("text/plain; charset=x-user-defined");k.setRequestHeader("Content-Type","text/plain");k.send(null)};b.JSONLoader.prototype.createModel=function(f,j,e){var i=new b.Geometry,h=f.scale!==void 0?1/f.scale:1;this.initMaterials(i,f.materials,e);(function(Q){if(f.metadata===void 0||f.metadata.formatVersion===void 0||f.metadata.formatVersion!==3){console.error("Deprecated file format.")}else{var P,O,N,L,M,I,H,K,C,J,E,z,s,y,D=f.faces;I=f.vertices;var v=f.normals,G=f.colors,d=0;for(P=0;P<f.uvs.length;P++){f.uvs[P].length&&d++}for(P=0;P<d;P++){i.faceUvs[P]=[],i.faceVertexUvs[P]=[]}L=0;for(M=I.length;L<M;){H=new b.Vertex,H.position.x=I[L++]*Q,H.position.y=I[L++]*Q,H.position.z=I[L++]*Q,i.vertices.push(H)}L=0;for(M=D.length;L<M;){Q=D[L++];I=Q&1;N=Q&2;P=Q&4;O=Q&8;K=Q&16;H=Q&32;J=Q&64;Q&=128;I?(E=new b.Face4,E.a=D[L++],E.b=D[L++],E.c=D[L++],E.d=D[L++],I=4):(E=new b.Face3,E.a=D[L++],E.b=D[L++],E.c=D[L++],I=3);if(N){N=D[L++],E.materialIndex=N}N=i.faces.length;if(P){for(P=0;P<d;P++){z=f.uvs[P],C=D[L++],y=z[C*2],C=z[C*2+1],i.faceUvs[P][N]=new b.UV(y,C)}}if(O){for(P=0;P<d;P++){z=f.uvs[P];s=[];for(O=0;O<I;O++){C=D[L++],y=z[C*2],C=z[C*2+1],s[O]=new b.UV(y,C)}i.faceVertexUvs[P][N]=s}}if(K){K=D[L++]*3,O=new b.Vector3,O.x=v[K++],O.y=v[K++],O.z=v[K],E.normal=O}if(H){for(P=0;P<I;P++){K=D[L++]*3,O=new b.Vector3,O.x=v[K++],O.y=v[K++],O.z=v[K],E.vertexNormals.push(O)}}if(J){H=D[L++],H=new b.Color(G[H]),E.color=H}if(Q){for(P=0;P<I;P++){H=D[L++],H=new b.Color(G[H]),E.vertexColors.push(H)}}i.faces.push(E)}}})(h);(function(){var d,m,l,k;if(f.skinWeights){d=0;for(m=f.skinWeights.length;d<m;d+=2){l=f.skinWeights[d],k=f.skinWeights[d+1],i.skinWeights.push(new b.Vector4(l,k,0,0))}}if(f.skinIndices){d=0;for(m=f.skinIndices.length;d<m;d+=2){l=f.skinIndices[d],k=f.skinIndices[d+1],i.skinIndices.push(new b.Vector4(l,k,0,0))}}i.bones=f.bones;i.animation=f.animation})();(function(y){if(f.morphTargets!==void 0){var x,w,v,t,u,q,n,s,d;x=0;for(w=f.morphTargets.length;x<w;x++){i.morphTargets[x]={};i.morphTargets[x].name=f.morphTargets[x].name;i.morphTargets[x].vertices=[];s=i.morphTargets[x].vertices;d=f.morphTargets[x].vertices;v=0;for(t=d.length;v<t;v+=3){u=d[v]*y,q=d[v+1]*y,n=d[v+2]*y,s.push(new b.Vertex(new b.Vector3(u,q,n)))}}}if(f.morphColors!==void 0){x=0;for(w=f.morphColors.length;x<w;x++){i.morphColors[x]={};i.morphColors[x].name=f.morphColors[x].name;i.morphColors[x].colors=[];t=i.morphColors[x].colors;u=f.morphColors[x].colors;y=0;for(v=u.length;y<v;y+=3){q=new b.Color(16755200),q.setRGB(u[y],u[y+1],u[y+2]),t.push(q)}}}})(h);i.computeCentroids();i.computeFaceNormals();this.hasNormals(i)&&i.computeTangents();j(i)};b.SceneLoader=function(){this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){};this.callbackSync=function(){};this.callbackProgress=function(){}};b.SceneLoader.prototype.constructor=b.SceneLoader;b.SceneLoader.prototype.load=function(f,h){var e=this,g=new XMLHttpRequest;g.onreadystatechange=function(){if(g.readyState==4){if(g.status==200||g.status==0){try{var c=JSON.parse(g.responseText);c.metadata===void 0||c.metadata.formatVersion===void 0||c.metadata.formatVersion!==3?console.error("Deprecated file format."):e.createScene(c,h,f)}catch(d){console.error(d),console.warn("DEPRECATED: ["+f+"] seems to be using old model format")}}else{console.error("Couldn't load ["+f+"] ["+g.status+"]")}}};g.open("GET",f,!0);g.overrideMimeType("text/plain; charset=x-user-defined");g.setRequestHeader("Content-Type","text/plain");g.send(null)};b.SceneLoader.prototype.createScene=function(ax,av,aw){function au(d,c){return c=="relativeToHTML"?d:am+"/"+d}function aq(){var d;for(ai in z.objects){if(!Q.objects[ai]){if(ae=z.objects[ai],ae.geometry!==void 0){if(ac=Q.geometries[ae.geometry]){d=!1;for(N=0;N<ae.materials.length;N++){V=Q.materials[ae.materials[N]],d=V instanceof b.ShaderMaterial}d&&ac.computeTangents();W=ae.position;T=ae.rotation;X=ae.quaternion;aa=ae.scale;X=0;V.length==0&&(V=new b.MeshFaceMaterial);V.length>1&&(V=new b.MeshFaceMaterial);d=new b.Mesh(ac,V);d.name=ai;d.position.set(W[0],W[1],W[2]);X?(d.quaternion.set(X[0],X[1],X[2],X[3]),d.useQuaternion=!0):d.rotation.set(T[0],T[1],T[2]);d.scale.set(aa[0],aa[1],aa[2]);d.visible=ae.visible;Q.scene.add(d);Q.objects[ai]=d;if(ae.meshCollider){var c=b.CollisionUtils.MeshColliderWBox(d);Q.scene.collisions.colliders.push(c)}if(ae.castsShadow){c=new b.ShadowVolume(ac),Q.scene.add(c),c.position=d.position,c.rotation=d.rotation,c.scale=d.scale}ae.trigger&&ae.trigger.toLowerCase()!="none"&&(c={type:ae.trigger,object:ae},Q.triggers[d.name]=c)}}else{W=ae.position,T=ae.rotation,X=ae.quaternion,aa=ae.scale,X=0,d=new b.Object3D,d.name=ai,d.position.set(W[0],W[1],W[2]),X?(d.quaternion.set(X[0],X[1],X[2],X[3]),d.useQuaternion=!0):d.rotation.set(T[0],T[1],T[2]),d.scale.set(aa[0],aa[1],aa[2]),d.visible=ae.visible!==void 0?ae.visible:!1,Q.scene.add(d),Q.objects[ai]=d,Q.empties[ai]=d,ae.trigger&&ae.trigger.toLowerCase()!="none"&&(c={type:ae.trigger,object:ae},Q.triggers[d.name]=c)}}}}function ar(c){return function(d){Q.geometries[c]=d;aq();L-=1;ao.onLoadComplete();ap()}}function at(c){return function(d){Q.geometries[c]=d}}function ap(){ao.callbackProgress({totalModels:D,totalTextures:Y,loadedModels:D-L,loadedTextures:Y-C},Q);ao.onLoadProgress();L==0&&C==0&&av(Q)}var ao=this,am=b.Loader.prototype.extractUrlbase(aw),an,aj,ai,al,ag,ak,ah,ae,ab,ad,W,T,X,aa,Z,ac,M,af,V,z,j,L,C,D,Y,Q;z=ax;aw=new b.BinaryLoader;j=new b.JSONLoader;C=L=0;Q={scene:new b.Scene,geometries:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},triggers:{},empties:{}};ax=!1;for(ai in z.objects){if(ae=z.objects[ai],ae.meshCollider){ax=!0;break}}if(ax){Q.scene.collisions=new b.CollisionSystem}if(z.transform){ax=z.transform.position;ab=z.transform.rotation;var S=z.transform.scale;ax&&Q.scene.position.set(ax[0],ax[1],ax[2]);ab&&Q.scene.rotation.set(ab[0],ab[1],ab[2]);S&&Q.scene.scale.set(S[0],S[1],S[2]);(ax||ab||S)&&Q.scene.updateMatrix()}ax=function(){C-=1;ap();ao.onLoadComplete()};for(ag in z.cameras){ab=z.cameras[ag],ab.type=="perspective"?M=new b.PerspectiveCamera(ab.fov,ab.aspect,ab.near,ab.far):ab.type=="ortho"&&(M=new b.OrthographicCamera(ab.left,ab.right,ab.top,ab.bottom,ab.near,ab.far)),W=ab.position,ab=ab.target,M.position.set(W[0],W[1],W[2]),M.target=new b.Vector3(ab[0],ab[1],ab[2]),Q.cameras[ag]=M}for(al in z.lights){ab=z.lights[al],ag=ab.color!==void 0?ab.color:16777215,M=ab.intensity!==void 0?ab.intensity:1,ab.type=="directional"?(W=ab.direction,ad=new b.DirectionalLight(ag,M),ad.position.set(W[0],W[1],W[2]),ad.position.normalize()):ab.type=="point"?(W=ab.position,ad=ab.distance,ad=new b.PointLight(ag,M,ad),ad.position.set(W[0],W[1],W[2])):ab.type=="ambient"&&(ad=new b.AmbientLight(ag)),Q.scene.add(ad),Q.lights[al]=ad}for(ak in z.fogs){al=z.fogs[ak],al.type=="linear"?af=new b.Fog(0,al.near,al.far):al.type=="exp2"&&(af=new b.FogExp2(0,al.density)),ab=al.color,af.color.setRGB(ab[0],ab[1],ab[2]),Q.fogs[ak]=af}if(Q.cameras&&z.defaults.camera){Q.currentCamera=Q.cameras[z.defaults.camera]}if(Q.fogs&&z.defaults.fog){Q.scene.fog=Q.fogs[z.defaults.fog]}ab=z.defaults.bgcolor;Q.bgColor=new b.Color;Q.bgColor.setRGB(ab[0],ab[1],ab[2]);Q.bgColorAlpha=z.defaults.bgalpha;for(an in z.geometries){if(ak=z.geometries[an],ak.type=="bin_mesh"||ak.type=="ascii_mesh"){L+=1,ao.onLoadStart()}}D=L;for(an in z.geometries){ak=z.geometries[an],ak.type=="cube"?(ac=new b.CubeGeometry(ak.width,ak.height,ak.depth,ak.segmentsWidth,ak.segmentsHeight,ak.segmentsDepth,null,ak.flipped,ak.sides),Q.geometries[an]=ac):ak.type=="plane"?(ac=new b.PlaneGeometry(ak.width,ak.height,ak.segmentsWidth,ak.segmentsHeight),Q.geometries[an]=ac):ak.type=="sphere"?(ac=new b.SphereGeometry(ak.radius,ak.segmentsWidth,ak.segmentsHeight),Q.geometries[an]=ac):ak.type=="cylinder"?(ac=new b.CylinderGeometry(ak.topRad,ak.botRad,ak.height,ak.radSegs,ak.heightSegs),Q.geometries[an]=ac):ak.type=="torus"?(ac=new b.TorusGeometry(ak.radius,ak.tube,ak.segmentsR,ak.segmentsT),Q.geometries[an]=ac):ak.type=="icosahedron"?(ac=new b.IcosahedronGeometry(ak.subdivisions),Q.geometries[an]=ac):ak.type=="bin_mesh"?aw.load(au(ak.url,z.urlBaseType),ar(an)):ak.type=="ascii_mesh"?j.load(au(ak.url,z.urlBaseType),ar(an)):ak.type=="embedded_mesh"&&(ak=z.embeds[ak.id])&&j.createModel(ak,at(an),"")}for(ah in z.textures){if(an=z.textures[ah],an.url instanceof Array){C+=an.url.length;for(ak=0;ak<an.url.length;ak++){ao.onLoadStart()}}else{C+=1,ao.onLoadStart()}}Y=C;for(ah in z.textures){an=z.textures[ah];if(an.mapping!=void 0&&b[an.mapping]!=void 0){an.mapping=new b[an.mapping]}if(an.url instanceof Array){ak=[];for(var N=0;N<an.url.length;N++){ak[N]=au(an.url[N],z.urlBaseType)}ak=b.ImageUtils.loadTextureCube(ak,an.mapping,ax)}else{ak=b.ImageUtils.loadTexture(au(an.url,z.urlBaseType),an.mapping,ax);if(b[an.minFilter]!=void 0){ak.minFilter=b[an.minFilter]}if(b[an.magFilter]!=void 0){ak.magFilter=b[an.magFilter]}if(an.repeat){ak.repeat.set(an.repeat[0],an.repeat[1]);if(an.repeat[0]!=1){ak.wrapS=b.RepeatWrapping}if(an.repeat[1]!=1){ak.wrapT=b.RepeatWrapping}}an.offset&&ak.offset.set(an.offset[0],an.offset[1]);if(an.wrap){af={repeat:b.RepeatWrapping,mirror:b.MirroredRepeatWrapping};if(af[an.wrap[0]]!==void 0){ak.wrapS=af[an.wrap[0]]}if(af[an.wrap[1]]!==void 0){ak.wrapT=af[an.wrap[1]]}}}Q.textures[ah]=ak}for(aj in z.materials){ah=z.materials[aj];for(Z in ah.parameters){if(Z=="envMap"||Z=="map"||Z=="lightMap"){ah.parameters[Z]=Q.textures[ah.parameters[Z]]}else{if(Z=="shading"){ah.parameters[Z]=ah.parameters[Z]=="flat"?b.FlatShading:b.SmoothShading}else{if(Z=="blending"){ah.parameters[Z]=b[ah.parameters[Z]]?b[ah.parameters[Z]]:b.NormalBlending}else{if(Z=="combine"){ah.parameters[Z]=ah.parameters[Z]=="MixOperation"?b.MixOperation:b.MultiplyOperation}else{if(Z=="vertexColors"){if(ah.parameters[Z]=="face"){ah.parameters[Z]=b.FaceColors}else{if(ah.parameters[Z]){ah.parameters[Z]=b.VertexColors}}}}}}}}if(ah.parameters.opacity!==void 0&&ah.parameters.opacity<1){ah.parameters.transparent=!0}if(ah.parameters.normalMap){an=b.ShaderUtils.lib.normal;ax=b.UniformsUtils.clone(an.uniforms);ak=ah.parameters.color;af=ah.parameters.specular;aw=ah.parameters.ambient;j=ah.parameters.shininess;ax.tNormal.texture=Q.textures[ah.parameters.normalMap];if(ah.parameters.normalMapFactor){ax.uNormalScale.value=ah.parameters.normalMapFactor}if(ah.parameters.map){ax.tDiffuse.texture=ah.parameters.map,ax.enableDiffuse.value=!0}if(ah.parameters.lightMap){ax.tAO.texture=ah.parameters.lightMap,ax.enableAO.value=!0}if(ah.parameters.specularMap){ax.tSpecular.texture=Q.textures[ah.parameters.specularMap],ax.enableSpecular.value=!0}ax.uDiffuseColor.value.setHex(ak);ax.uSpecularColor.value.setHex(af);ax.uAmbientColor.value.setHex(aw);ax.uShininess.value=j;if(ah.parameters.opacity){ax.uOpacity.value=ah.parameters.opacity}ah=new b.ShaderMaterial({fragmentShader:an.fragmentShader,vertexShader:an.vertexShader,uniforms:ax,lights:!0,fog:!0})}else{ah=new b[ah.type](ah.parameters)}Q.materials[aj]=ah}aq();ao.callbackSync(Q);ap()};b.UTF8Loader=function(){};b.UTF8Loader.prototype=new b.UTF8Loader;b.UTF8Loader.prototype.constructor=b.UTF8Loader;b.UTF8Loader.prototype.load=function(j,p,i){if(j instanceof Object){console.warn("DEPRECATED: UTF8Loader( parameters ) is now UTF8Loader( url, callback, metaData )."),i=j,j=i.model,p=i.callback,i={scale:i.scale,offsetX:i.offsetX,offsetY:i.offsetY,offsetZ:i.offsetZ}}var o=new XMLHttpRequest,l=i.scale!==void 0?i.scale:1,m=i.offsetX!==void 0?i.offsetX:0,n=i.offsetY!==void 0?i.offsetY:0,k=i.offsetZ!==void 0?i.offsetZ:0;o.onreadystatechange=function(){o.readyState==4?o.status==200||o.status==0?b.UTF8Loader.prototype.createModel(o.responseText,p,l,m,n,k):alert("Couldn't load ["+j+"] ["+o.status+"]"):o.readyState!=3&&o.readyState==2&&o.getResponseHeader("Content-Length")};o.open("GET",j,!0);o.send(null)};b.UTF8Loader.prototype.decompressMesh=function(j){var p=j.charCodeAt(0);p>=57344&&(p-=2048);p++;for(var i=new Float32Array(8*p),o=1,l=0;l<8;l++){for(var m=0,n=0;n<p;++n){var k=j.charCodeAt(n+o);m+=k>>1^-(k&1);i[8*n+l]=m}o+=p}p=j.length-o;m=new Uint16Array(p);for(l=n=0;l<p;l++){k=j.charCodeAt(l+o),m[l]=n-k,k==0&&n++}return[i,m]};b.UTF8Loader.prototype.createModel=function(i,n,h,m,j,k){var l=function(){var o=this;o.materials=[];b.Geometry.call(this);var g=b.UTF8Loader.prototype.decompressMesh(i),d=[],f=[];(function(p,w,u){for(var r,c,v,s=p.length;u<s;u+=w){r=p[u],c=p[u+1],v=p[u+2],r=r/16383*h,c=c/16383*h,v=v/16383*h,r+=m,c+=j,v+=k,o.vertices.push(new b.Vertex(new b.Vector3(r,c,v)))}})(g[0],8,0);(function(q,p,u){for(var t,s,r=q.length;u<r;u+=p){t=q[u],s=q[u+1],t/=1023,s/=1023,f.push(t,1-s)}})(g[0],8,3);(function(q,p,v){for(var u,t,s,r=q.length;v<r;v+=p){u=q[v],t=q[v+1],s=q[v+2],u=(u-512)/511,t=(t-512)/511,s=(s-512)/511,d.push(u,t,s)}})(g[0],8,5);(function(Q){var P,O,N,M,L,K,r,C,H,z=Q.length;for(P=0;P<z;P+=3){O=Q[P];N=Q[P+1];M=Q[P+2];L=o;C=O;H=N;K=M;r=O;var I=N,q=M,p=L.materials[0],t=d[I*3],c=d[I*3+1],I=d[I*3+2],G=d[q*3],D=d[q*3+1],q=d[q*3+2];r=new b.Vector3(d[r*3],d[r*3+1],d[r*3+2]);I=new b.Vector3(t,c,I);q=new b.Vector3(G,D,q);L.faces.push(new b.Face3(C,H,K,[r,I,q],null,p));L=f[O*2];O=f[O*2+1];K=f[N*2];r=f[N*2+1];C=f[M*2];H=f[M*2+1];M=o.faceVertexUvs[0];N=K;K=r;r=[];r.push(new b.UV(L,O));r.push(new b.UV(N,K));r.push(new b.UV(C,H));M.push(r)}})(g[1]);this.computeCentroids();this.computeFaceNormals()};l.prototype=new b.Geometry;l.prototype.constructor=l;n(new l)};b.Axes=function(){b.Object3D.call(this);var e=new b.Geometry;e.vertices.push(new b.Vertex);e.vertices.push(new b.Vertex(new b.Vector3(0,100,0)));var f=new b.CylinderGeometry(0,5,25,5,1),d=new b.Line(e,new b.LineBasicMaterial({color:16711680}));d.rotation.z=-Math.PI/2;this.add(d);d=new b.Mesh(f,new b.MeshBasicMaterial({color:16711680}));d.position.x=100;d.rotation.z=-Math.PI/2;this.add(d);d=new b.Line(e,new b.LineBasicMaterial({color:65280}));this.add(d);d=new b.Mesh(f,new b.MeshBasicMaterial({color:65280}));d.position.y=100;this.add(d);d=new b.Line(e,new b.LineBasicMaterial({color:255}));d.rotation.x=Math.PI/2;this.add(d);d=new b.Mesh(f,new b.MeshBasicMaterial({color:255}));d.position.z=100;d.rotation.x=Math.PI/2;this.add(d)};b.Axes.prototype=new b.Object3D;b.Axes.prototype.constructor=b.Axes;b.MarchingCubes=function(d,e){b.Object3D.call(this);this.material=e;this.init=function(c){this.resolution=c;this.isolation=80;this.size=c;this.size2=this.size*this.size;this.size3=this.size2*this.size;this.halfsize=this.size/2;this.delta=2/this.size;this.yd=this.size;this.zd=this.size2;this.field=new Float32Array(this.size3);this.normal_cache=new Float32Array(this.size3*3);this.vlist=new Float32Array(36);this.nlist=new Float32Array(36);this.firstDraw=!0;this.maxCount=4096;this.count=0;this.hasNormal=this.hasPos=!1;this.positionArray=new Float32Array(this.maxCount*3);this.normalArray=new Float32Array(this.maxCount*3)};this.lerp=function(f,i,h){return f+(i-f)*h};this.VIntX=function(v,u,r,s,t,q,p,m,n,j){t=(t-n)/(j-n);n=this.normal_cache;u[s]=q+t*this.delta;u[s+1]=p;u[s+2]=m;r[s]=this.lerp(n[v],n[v+3],t);r[s+1]=this.lerp(n[v+1],n[v+4],t);r[s+2]=this.lerp(n[v+2],n[v+5],t)};this.VIntY=function(v,u,r,s,t,q,p,m,n,j){t=(t-n)/(j-n);n=this.normal_cache;u[s]=q;u[s+1]=p+t*this.delta;u[s+2]=m;u=v+this.yd*3;r[s]=this.lerp(n[v],n[u],t);r[s+1]=this.lerp(n[v+1],n[u+1],t);r[s+2]=this.lerp(n[v+2],n[u+2],t)};this.VIntZ=function(v,u,r,s,t,q,p,m,n,j){t=(t-n)/(j-n);n=this.normal_cache;u[s]=q;u[s+1]=p;u[s+2]=m+t*this.delta;u=v+this.zd*3;r[s]=this.lerp(n[v],n[u],t);r[s+1]=this.lerp(n[v+1],n[u+1],t);r[s+2]=this.lerp(n[v+2],n[u+2],t)};this.compNorm=function(f){var g=f*3;this.normal_cache[g]===0&&(this.normal_cache[g]=this.field[f-1]-this.field[f+1],this.normal_cache[g+1]=this.field[f-this.yd]-this.field[f+this.yd],this.normal_cache[g+2]=this.field[f-this.zd]-this.field[f+this.zd])};this.polygonize=function(ab,aa,X,Y,Z,W){var V=Y+1,T=Y+this.yd,U=Y+this.zd,Q=V+this.yd,P=V+this.zd,S=Y+this.yd+this.zd,L=V+this.yd+this.zd,R=0,N=this.field[Y],I=this.field[V],D=this.field[T],H=this.field[Q],M=this.field[U],G=this.field[P],O=this.field[S],C=this.field[L];N<Z&&(R|=1);I<Z&&(R|=2);D<Z&&(R|=8);H<Z&&(R|=4);M<Z&&(R|=16);G<Z&&(R|=32);O<Z&&(R|=128);C<Z&&(R|=64);var z=b.edgeTable[R];if(z===0){return 0}var E=this.delta,j=ab+E,K=aa+E,E=X+E;z&1&&(this.compNorm(Y),this.compNorm(V),this.VIntX(Y*3,this.vlist,this.nlist,0,Z,ab,aa,X,N,I));z&2&&(this.compNorm(V),this.compNorm(Q),this.VIntY(V*3,this.vlist,this.nlist,3,Z,j,aa,X,I,H));z&4&&(this.compNorm(T),this.compNorm(Q),this.VIntX(T*3,this.vlist,this.nlist,6,Z,ab,K,X,D,H));z&8&&(this.compNorm(Y),this.compNorm(T),this.VIntY(Y*3,this.vlist,this.nlist,9,Z,ab,aa,X,N,D));z&16&&(this.compNorm(U),this.compNorm(P),this.VIntX(U*3,this.vlist,this.nlist,12,Z,ab,aa,E,M,G));z&32&&(this.compNorm(P),this.compNorm(L),this.VIntY(P*3,this.vlist,this.nlist,15,Z,j,aa,E,G,C));z&64&&(this.compNorm(S),this.compNorm(L),this.VIntX(S*3,this.vlist,this.nlist,18,Z,ab,K,E,O,C));z&128&&(this.compNorm(U),this.compNorm(S),this.VIntY(U*3,this.vlist,this.nlist,21,Z,ab,aa,E,M,O));z&256&&(this.compNorm(Y),this.compNorm(U),this.VIntZ(Y*3,this.vlist,this.nlist,24,Z,ab,aa,X,N,M));z&512&&(this.compNorm(V),this.compNorm(P),this.VIntZ(V*3,this.vlist,this.nlist,27,Z,j,aa,X,I,G));z&1024&&(this.compNorm(Q),this.compNorm(L),this.VIntZ(Q*3,this.vlist,this.nlist,30,Z,j,K,X,H,C));z&2048&&(this.compNorm(T),this.compNorm(S),this.VIntZ(T*3,this.vlist,this.nlist,33,Z,ab,K,X,D,O));R<<=4;for(Z=Y=0;b.triTable[R+Z]!=-1;){ab=R+Z,aa=ab+1,X=ab+2,this.posnormtriv(this.vlist,this.nlist,3*b.triTable[ab],3*b.triTable[aa],3*b.triTable[X],W),Z+=3,Y++}return Y};this.posnormtriv=function(j,p,m,n,o,l){var k=this.count*3;this.positionArray[k]=j[m];this.positionArray[k+1]=j[m+1];this.positionArray[k+2]=j[m+2];this.positionArray[k+3]=j[n];this.positionArray[k+4]=j[n+1];this.positionArray[k+5]=j[n+2];this.positionArray[k+6]=j[o];this.positionArray[k+7]=j[o+1];this.positionArray[k+8]=j[o+2];this.normalArray[k]=p[m];this.normalArray[k+1]=p[m+1];this.normalArray[k+2]=p[m+2];this.normalArray[k+3]=p[n];this.normalArray[k+4]=p[n+1];this.normalArray[k+5]=p[n+2];this.normalArray[k+6]=p[o];this.normalArray[k+7]=p[o+1];this.normalArray[k+8]=p[o+2];this.hasNormal=this.hasPos=!0;this.count+=3;this.count>=this.maxCount-3&&l(this)};this.begin=function(){this.count=0;this.hasNormal=this.hasPos=!1};this.end=function(f){if(this.count!==0){for(var g=this.count*3;g<this.positionArray.length;g++){this.positionArray[g]=0}f(this)}};this.addBall=function(L,K,H,I,J){var G=this.size*Math.sqrt(I/J),F=H*this.size,D=K*this.size,E=L*this.size,A=Math.floor(F-G);A<1&&(A=1);F=Math.floor(F+G);F>this.size-1&&(F=this.size-1);var z=Math.floor(D-G);z<1&&(z=1);D=Math.floor(D+G);D>this.size-1&&(D=this.size-1);var C=Math.floor(E-G);C<1&&(C=1);G=Math.floor(E+G);G>this.size-1&&(G=this.size-1);for(var x,B,y,v,j,s;A<F;A++){E=this.size2*A;B=A/this.size-H;j=B*B;for(B=z;B<D;B++){y=E+this.size*B;x=B/this.size-K;s=x*x;for(x=C;x<G;x++){v=x/this.size-L,v=I/(0.000001+v*v+s+j)-J,v>0&&(this.field[y+x]+=v)}}}};this.addPlaneX=function(z,y){var v,w,x,u,t,r=this.size,s=this.yd,n=this.zd,j=this.field,q=r*Math.sqrt(z/y);q>r&&(q=r);for(v=0;v<q;v++){if(w=v/r,w*=w,u=z/(0.0001+w)-y,u>0){for(w=0;w<r;w++){t=v+w*s;for(x=0;x<r;x++){j[n*x+t]+=u}}}}};this.addPlaneY=function(B,A){var x,y,z,w,v,t,u=this.size,q=this.yd,n=this.zd,s=this.field,j=u*Math.sqrt(B/A);j>u&&(j=u);for(y=0;y<j;y++){if(x=y/u,x*=x,w=B/(0.0001+x)-A,w>0){v=y*q;for(x=0;x<u;x++){t=v+x;for(z=0;z<u;z++){s[n*z+t]+=w}}}}};this.addPlaneZ=function(B,A){var x,y,z,w,v,t,u=this.size,q=this.yd,n=this.zd,s=this.field,j=u*Math.sqrt(B/A);j>u&&(j=u);for(z=0;z<j;z++){if(x=z/u,x*=x,w=B/(0.0001+x)-A,w>0){v=n*z;for(y=0;y<u;y++){t=v+y*q;for(x=0;x<u;x++){s[t+x]+=w}}}}};this.reset=function(){var c;for(c=0;c<this.size3;c++){this.normal_cache[c*3]=0,this.field[c]=0}};this.render=function(x){this.begin();var w,t,u,v,s,r,n,q,m,j=this.size-2;for(v=1;v<j;v++){m=this.size2*v;n=(v-this.halfsize)/this.halfsize;for(u=1;u<j;u++){q=m+this.size*u;r=(u-this.halfsize)/this.halfsize;for(t=1;t<j;t++){s=(t-this.halfsize)/this.halfsize,w=q+t,this.polygonize(s,r,n,w,this.isolation,x)}}}this.end(x)};this.generateGeometry=function(){var f=0,i=new b.Geometry,h=[];this.render(function(t){var u,s,r,n,q,g,c,j;for(u=0;u<t.count;u++){c=u*3,q=c+1,j=c+2,s=t.positionArray[c],r=t.positionArray[q],n=t.positionArray[j],g=new b.Vector3(s,r,n),s=t.normalArray[c],r=t.normalArray[q],n=t.normalArray[j],c=new b.Vector3(s,r,n),c.normalize(),q=new b.Vertex(g),i.vertices.push(q),h.push(c)}g=t.count/3;for(u=0;u<g;u++){c=(f+u)*3,q=c+1,j=c+2,s=h[c],r=h[q],n=h[j],c=new b.Face3(c,q,j,[s,r,n]),i.faces.push(c)}f+=g;t.count=0});return i};this.init(d)};b.MarchingCubes.prototype=new b.Object3D;b.MarchingCubes.prototype.constructor=b.MarchingCubes;b.edgeTable=new Int32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]);b.triTable=new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]);if(b.WebGLRenderer){b.AnaglyphWebGLRenderer=function(F){b.WebGLRenderer.call(this,F);this.autoUpdateScene=!1;var D=this,E=this.setSize,C=this.render,z=new b.PerspectiveCamera,A=new b.PerspectiveCamera,B=new b.Matrix4,y=new b.Matrix4,x,v,w,s;z.matrixAutoUpdate=A.matrixAutoUpdate=!1;var F={minFilter:b.LinearFilter,magFilter:b.NearestFilter,format:b.RGBAFormat},q=new b.WebGLRenderTarget(512,512,F),u=new b.WebGLRenderTarget(512,512,F),j=new b.PerspectiveCamera(53,1,1,10000);j.position.z=2;var F=new b.ShaderMaterial({uniforms:{mapLeft:{type:"t",value:0,texture:q},mapRight:{type:"t",value:1,texture:u}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D mapLeft;\nuniform sampler2D mapRight;\nvarying vec2 vUv;\nvoid main() {\nvec4 colorL, colorR;\nvec2 uv = vUv;\ncolorL = texture2D( mapLeft, uv );\ncolorR = texture2D( mapRight, uv );\ngl_FragColor = vec4( colorL.g * 0.7 + colorL.b * 0.3, colorR.g, colorR.b, colorL.a + colorR.a ) * 1.1;\n}"}),t=new b.Scene;t.add(new b.Mesh(new b.PlaneGeometry(2,2),F));t.add(j);this.setSize=function(c,e){E.call(D,c,e);q.width=c;q.height=e;u.width=c;u.height=e};this.render=function(f,d){f.updateMatrixWorld();if(x!==d.aspect||v!==d.near||w!==d.far||s!==d.fov){x=d.aspect;v=d.near;w=d.far;s=d.fov;var e=d.projectionMatrix.clone(),g=125/30*0.5,i=g*v/125,h=v*Math.tan(s*Math.PI/360),c;B.n14=g;y.n14=-g;g=-h*x+i;c=h*x+i;e.n11=2*v/(c-g);e.n13=(c+g)/(c-g);z.projectionMatrix.copy(e);g=-h*x-i;c=h*x-i;e.n11=2*v/(c-g);e.n13=(c+g)/(c-g);A.projectionMatrix.copy(e)}z.matrixWorld.copy(d.matrixWorld).multiplySelf(y);z.position.copy(d.position);z.near=d.near;z.far=d.far;C.call(D,f,z,q,!0);A.matrixWorld.copy(d.matrixWorld).multiplySelf(B);A.position.copy(d.position);A.near=d.near;A.far=d.far;C.call(D,f,A,u,!0);t.updateMatrixWorld();C.call(D,t,j)}}}if(b.WebGLRenderer){b.CrosseyedWebGLRenderer=function(j){b.WebGLRenderer.call(this,j);this.autoClear=!1;var p=this,i=this.setSize,o=this.render,l,m,n=new b.PerspectiveCamera;n.target=new b.Vector3(0,0,0);var k=new b.PerspectiveCamera;k.target=new b.Vector3(0,0,0);p.separation=10;if(j&&j.separation!==void 0){p.separation=j.separation}this.setSize=function(c,e){i.call(p,c,e);l=c/2;m=e};this.render=function(d,c){this.clear();n.fov=c.fov;n.aspect=0.5*c.aspect;n.near=c.near;n.far=c.far;n.updateProjectionMatrix();n.position.copy(c.position);n.target.copy(c.target);n.translateX(p.separation);n.lookAt(n.target);k.projectionMatrix=n.projectionMatrix;k.position.copy(c.position);k.target.copy(c.target);k.translateX(-p.separation);k.lookAt(k.target);this.setViewport(0,0,l,m);o.call(p,d,n);this.setViewport(l,0,l,m);o.call(p,d,k,!1)}}}return b});