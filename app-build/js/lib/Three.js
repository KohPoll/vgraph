define(function(){var d=window;var c=c||{};if(!d.Int32Array){d.Int32Array=Array,d.Float32Array=Array}c.Clock=function(a){this.autoStart=a!==void 0?a:!0;this.elapsedTime=this.oldTime=this.startTime=0;this.running=!1};c.Clock.prototype.start=function(){this.oldTime=this.startTime=Date.now();this.running=!0};c.Clock.prototype.stop=function(){this.getElapsedTime();this.running=!1};c.Clock.prototype.getElapsedTime=function(){this.elapsedTime+=this.getDelta();return this.elapsedTime};c.Clock.prototype.getDelta=function(){var b=0;this.autoStart&&!this.running&&this.start();if(this.running){var a=Date.now(),b=0.001*(a-this.oldTime);this.oldTime=a;this.elapsedTime+=b}return b};c.Color=function(a){a!==void 0&&this.setHex(a);return this};c.Color.prototype={constructor:c.Color,r:1,g:1,b:1,copy:function(a){this.r=a.r;this.g=a.g;this.b=a.b;return this},copyGammaToLinear:function(a){this.r=a.r*a.r;this.g=a.g*a.g;this.b=a.b*a.b;return this},copyLinearToGamma:function(a){this.r=Math.sqrt(a.r);this.g=Math.sqrt(a.g);this.b=Math.sqrt(a.b);return this},setRGB:function(f,b,a){this.r=f;this.g=b;this.b=a;return this},setHSV:function(k,g,a){var l,f,b;if(a===0){this.r=this.g=this.b=0}else{switch(l=Math.floor(k*6),f=k*6-l,k=a*(1-g),b=a*(1-g*f),g=a*(1-g*(1-f)),l){case 1:this.r=b;this.g=a;this.b=k;break;case 2:this.r=k;this.g=a;this.b=g;break;case 3:this.r=k;this.g=b;this.b=a;break;case 4:this.r=g;this.g=k;this.b=a;break;case 5:this.r=a;this.g=k;this.b=b;break;case 6:case 0:this.r=a,this.g=g,this.b=k}}return this},setHex:function(a){a=Math.floor(a);this.r=(a>>16&255)/255;this.g=(a>>8&255)/255;this.b=(a&255)/255;return this},getHex:function(){return ~~(this.r*255)<<16^~~(this.g*255)<<8^~~(this.b*255)},getContextStyle:function(){return"rgb("+Math.floor(this.r*255)+","+Math.floor(this.g*255)+","+Math.floor(this.b*255)+")"},clone:function(){return(new c.Color).setRGB(this.r,this.g,this.b)}};c.Vector2=function(b,a){this.x=b||0;this.y=a||0};c.Vector2.prototype={constructor:c.Vector2,set:function(b,a){this.x=b;this.y=a;return this},copy:function(a){this.x=a.x;this.y=a.y;return this},clone:function(){return new c.Vector2(this.x,this.y)},add:function(b,a){this.x=b.x+a.x;this.y=b.y+a.y;return this},addSelf:function(a){this.x+=a.x;this.y+=a.y;return this},sub:function(b,a){this.x=b.x-a.x;this.y=b.y-a.y;return this},subSelf:function(a){this.x-=a.x;this.y-=a.y;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;return this},divideScalar:function(a){a?(this.x/=a,this.y/=a):this.set(0,0);return this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(b){var a=this.x-b.x,b=this.y-b.y;return a*a+b*b},setLength:function(a){return this.normalize().multiplyScalar(a)},equals:function(a){return a.x===this.x&&a.y===this.y}};c.Vector3=function(f,b,a){this.x=f||0;this.y=b||0;this.z=a||0};c.Vector3.prototype={constructor:c.Vector3,set:function(f,b,a){this.x=f;this.y=b;this.z=a;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this},clone:function(){return new c.Vector3(this.x,this.y,this.z)},add:function(b,a){this.x=b.x+a.x;this.y=b.y+a.y;this.z=b.z+a.z;return this},addSelf:function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;return this},sub:function(b,a){this.x=b.x-a.x;this.y=b.y-a.y;this.z=b.z-a.z;return this},subSelf:function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;return this},multiply:function(b,a){this.x=b.x*a.x;this.y=b.y*a.y;this.z=b.z*a.z;return this},multiplySelf:function(a){this.x*=a.x;this.y*=a.y;this.z*=a.z;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;this.z*=a;return this},divideSelf:function(a){this.x/=a.x;this.y/=a.y;this.z/=a.z;return this},divideScalar:function(a){a?(this.x/=a,this.y/=a,this.z/=a):this.z=this.y=this.x=0;return this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.lengthSq())},lengthManhattan:function(){return this.x+this.y+this.z},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){return this.normalize().multiplyScalar(a)},cross:function(b,a){this.x=b.y*a.z-b.z*a.y;this.y=b.z*a.x-b.x*a.z;this.z=b.x*a.y-b.y*a.x;return this},crossSelf:function(a){var g=this.x,b=this.y,h=this.z;this.x=b*a.z-h*a.y;this.y=h*a.x-g*a.z;this.z=g*a.y-b*a.x;return this},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){return(new c.Vector3).sub(this,a).lengthSq()},setPositionFromMatrix:function(a){this.x=a.n14;this.y=a.n24;this.z=a.n34},setRotationFromMatrix:function(b){var a=Math.cos(this.y);this.y=Math.asin(b.n13);Math.abs(a)>0.00001?(this.x=Math.atan2(-b.n23/a,b.n33/a),this.z=Math.atan2(-b.n12/a,b.n11/a)):(this.x=0,this.z=Math.atan2(b.n21,b.n22))},isZero:function(){return this.lengthSq()<0.0001}};c.Vector4=function(a,g,b,h){this.x=a||0;this.y=g||0;this.z=b||0;this.w=h!==void 0?h:1};c.Vector4.prototype={constructor:c.Vector4,set:function(a,g,b,h){this.x=a;this.y=g;this.z=b;this.w=h;return this},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w!==void 0?a.w:1},clone:function(){return new c.Vector4(this.x,this.y,this.z,this.w)},add:function(b,a){this.x=b.x+a.x;this.y=b.y+a.y;this.z=b.z+a.z;this.w=b.w+a.w;return this},addSelf:function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;this.w+=a.w;return this},sub:function(b,a){this.x=b.x-a.x;this.y=b.y-a.y;this.z=b.z-a.z;this.w=b.w-a.w;return this},subSelf:function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;this.w-=a.w;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;this.z*=a;this.w*=a;return this},divideScalar:function(a){a?(this.x/=a,this.y/=a,this.z/=a,this.w/=a):(this.z=this.y=this.x=0,this.w=1);return this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w},lengthSq:function(){return this.dot(this)},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){return this.normalize().multiplyScalar(a)},lerpSelf:function(b,a){this.x+=(b.x-this.x)*a;this.y+=(b.y-this.y)*a;this.z+=(b.z-this.z)*a;this.w+=(b.w-this.w)*a;return this}};c.Ray=function(a,e){function b(j,v,s){x.sub(s,j);r=x.dot(v);if(r<=0){return null}q=A.add(j,p.copy(v).multiplyScalar(r));return w=s.distanceTo(q)}function f(z,j,v,s){x.sub(s,j);A.sub(v,j);p.sub(z,j);B=x.dot(x);F=x.dot(A);W=x.dot(p);y=A.dot(A);t=A.dot(p);o=1/(B*y-F*F);u=(y*W-F*t)*o;X=(B*t-F*W)*o;return u>=0&&X>=0&&u+X<1}this.origin=a||new c.Vector3;this.direction=e||new c.Vector3;this.intersectScene=function(j){return this.intersectObjects(j.children)};this.intersectObjects=function(z){var j,v,s=[];j=0;for(v=z.length;j<v;j++){Array.prototype.push.apply(s,this.intersectObject(z[j]))}s.sort(function(C,D){return C.distance-D.distance});return s};var i=new c.Vector3,h=new c.Vector3,g=new c.Vector3,k=new c.Vector3,a=new c.Vector3,e=new c.Vector3,l=new c.Vector3,n=new c.Vector3,m=new c.Vector3;this.intersectObject=function(D){for(var G,H=[],j=0,C=D.children.length;j<C;j++){Array.prototype.push.apply(H,this.intersectObject(D.children[j]))}if(D instanceof c.Particle){j=b(this.origin,this.direction,D.matrixWorld.getPosition());if(j===null||j>D.scale.x){return[]}G={distance:j,point:D.position,face:null,object:D};H.push(G)}else{if(D instanceof c.Mesh){j=b(this.origin,this.direction,D.matrixWorld.getPosition());if(j===null||j>D.geometry.boundingSphere.radius*Math.max(D.scale.x,Math.max(D.scale.y,D.scale.z))){return H}var v,E=D.geometry,z=E.vertices,s;D.matrixRotationWorld.extractRotation(D.matrixWorld);j=0;for(C=E.faces.length;j<C;j++){if(G=E.faces[j],a.copy(this.origin),e.copy(this.direction),s=D.matrixWorld,l=s.multiplyVector3(l.copy(G.centroid)).subSelf(a),v=l.dot(e),!(v<=0)&&(i=s.multiplyVector3(i.copy(z[G.a].position)),h=s.multiplyVector3(h.copy(z[G.b].position)),g=s.multiplyVector3(g.copy(z[G.c].position)),G instanceof c.Face4&&(k=s.multiplyVector3(k.copy(z[G.d].position))),n=D.matrixRotationWorld.multiplyVector3(n.copy(G.normal)),v=e.dot(n),D.doubleSided||(D.flipSided?v>0:v<0))){if(v=n.dot(l.sub(i,a))/v,m.add(a,e.multiplyScalar(v)),G instanceof c.Face3){f(m,i,h,g)&&(G={distance:a.distanceTo(m),point:m.clone(),face:G,object:D},H.push(G))}else{if(G instanceof c.Face4&&(f(m,i,h,k)||f(m,h,g,k))){G={distance:a.distanceTo(m),point:m.clone(),face:G,object:D},H.push(G)}}}}}}return H};var x=new c.Vector3,A=new c.Vector3,p=new c.Vector3,r,q,w,B,F,W,y,t,o,u,X};c.Rectangle=function(){function a(){h=b-g;f=p-e}var g,e,b,p,h,f,o=!0;this.getX=function(){return g};this.getY=function(){return e};this.getWidth=function(){return h};this.getHeight=function(){return f};this.getLeft=function(){return g};this.getTop=function(){return e};this.getRight=function(){return b};this.getBottom=function(){return p};this.set=function(k,j,l,i){o=!1;g=k;e=j;b=l;p=i;a()};this.addPoint=function(j,i){o?(o=!1,g=j,e=i,b=j,p=i):(g=g<j?g:j,e=e<i?e:i,b=b>j?b:j,p=p>i?p:i);a()};this.add3Points=function(j,k,m,i,n,l){o?(o=!1,g=j<m?j<n?j:n:m<n?m:n,e=k<i?k<l?k:l:i<l?i:l,b=j>m?j>n?j:n:m>n?m:n,p=k>i?k>l?k:l:i>l?i:l):(g=j<m?j<n?j<g?j:g:n<g?n:g:m<n?m<g?m:g:n<g?n:g,e=k<i?k<l?k<e?k:e:l<e?l:e:i<l?i<e?i:e:l<e?l:e,b=j>m?j>n?j>b?j:b:n>b?n:b:m>n?m>b?m:b:n>b?n:b,p=k>i?k>l?k>p?k:p:l>p?l:p:i>l?i>p?i:p:l>p?l:p);a()};this.addRectangle=function(i){o?(o=!1,g=i.getLeft(),e=i.getTop(),b=i.getRight(),p=i.getBottom()):(g=g<i.getLeft()?g:i.getLeft(),e=e<i.getTop()?e:i.getTop(),b=b>i.getRight()?b:i.getRight(),p=p>i.getBottom()?p:i.getBottom());a()};this.inflate=function(i){g-=i;e-=i;b+=i;p+=i;a()};this.minSelf=function(i){g=g>i.getLeft()?g:i.getLeft();e=e>i.getTop()?e:i.getTop();b=b<i.getRight()?b:i.getRight();p=p<i.getBottom()?p:i.getBottom();a()};this.intersects=function(i){return Math.min(b,i.getRight())-Math.max(g,i.getLeft())>=0&&Math.min(p,i.getBottom())-Math.max(e,i.getTop())>=0};this.empty=function(){o=!0;p=b=e=g=0;a()};this.isEmpty=function(){return o}};c.Math={clamp:function(f,b,a){return f<b?b:f>a?a:f},clampBottom:function(b,a){return b<a?a:b},mapLinear:function(b,g,i,j,a){return j+(b-g)*(a-j)/(i-g)},random16:function(){return(65280*Math.random()+255*Math.random())/65535}};c.Matrix3=function(){this.m=[]};c.Matrix3.prototype={constructor:c.Matrix3,transpose:function(){var b,a=this.m;b=a[1];a[1]=a[3];a[3]=b;b=a[2];a[2]=a[6];a[6]=b;b=a[5];a[5]=a[7];a[7]=b;return this},transposeIntoArray:function(b){var a=this.m;b[0]=a[0];b[1]=a[3];b[2]=a[6];b[3]=a[1];b[4]=a[4];b[5]=a[7];b[6]=a[2];b[7]=a[5];b[8]=a[8];return this}};c.Matrix4=function(k,f,e,l,p,n,m,r,E,b,F,a,g,h,o,i){this.set(k!==void 0?k:1,f||0,e||0,l||0,p||0,n!==void 0?n:1,m||0,r||0,E||0,b||0,F!==void 0?F:1,a||0,g||0,h||0,o||0,i!==void 0?i:1);this.flat=Array(16);this.m33=new c.Matrix3};c.Matrix4.prototype={constructor:c.Matrix4,set:function(k,f,e,l,p,n,m,r,E,b,F,a,g,h,o,i){this.n11=k;this.n12=f;this.n13=e;this.n14=l;this.n21=p;this.n22=n;this.n23=m;this.n24=r;this.n31=E;this.n32=b;this.n33=F;this.n34=a;this.n41=g;this.n42=h;this.n43=o;this.n44=i;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},copy:function(a){this.set(a.n11,a.n12,a.n13,a.n14,a.n21,a.n22,a.n23,a.n24,a.n31,a.n32,a.n33,a.n34,a.n41,a.n42,a.n43,a.n44);return this},lookAt:function(k,g,a){var l=c.Matrix4.__v1,f=c.Matrix4.__v2,b=c.Matrix4.__v3;b.sub(k,g).normalize();if(b.length()===0){b.z=1}l.cross(a,b).normalize();l.length()===0&&(b.x+=0.0001,l.cross(a,b).normalize());f.cross(b,l).normalize();this.n11=l.x;this.n12=f.x;this.n13=b.x;this.n21=l.y;this.n22=f.y;this.n23=b.y;this.n31=l.z;this.n32=f.z;this.n33=b.z;return this},multiply:function(l,p){var n=l.n11,q=l.n12,i=l.n13,e=l.n14,r=l.n21,m=l.n22,s=l.n23,o=l.n24,t=l.n31,U=l.n32,v=l.n33,B=l.n34,y=l.n41,R=l.n42,u=l.n43,E=l.n44,P=p.n11,J=p.n12,w=p.n13,K=p.n14,x=p.n21,ac=p.n22,a=p.n23,O=p.n24,f=p.n31,A=p.n32,F=p.n33,ad=p.n34,b=p.n41,g=p.n42,k=p.n43,h=p.n44;this.n11=n*P+q*x+i*f+e*b;this.n12=n*J+q*ac+i*A+e*g;this.n13=n*w+q*a+i*F+e*k;this.n14=n*K+q*O+i*ad+e*h;this.n21=r*P+m*x+s*f+o*b;this.n22=r*J+m*ac+s*A+o*g;this.n23=r*w+m*a+s*F+o*k;this.n24=r*K+m*O+s*ad+o*h;this.n31=t*P+U*x+v*f+B*b;this.n32=t*J+U*ac+v*A+B*g;this.n33=t*w+U*a+v*F+B*k;this.n34=t*K+U*O+v*ad+B*h;this.n41=y*P+R*x+u*f+E*b;this.n42=y*J+R*ac+u*A+E*g;this.n43=y*w+R*a+u*F+E*k;this.n44=y*K+R*O+u*ad+E*h;return this},multiplySelf:function(a){return this.multiply(this,a)},multiplyToArray:function(f,b,a){this.multiply(f,b);a[0]=this.n11;a[1]=this.n21;a[2]=this.n31;a[3]=this.n41;a[4]=this.n12;a[5]=this.n22;a[6]=this.n32;a[7]=this.n42;a[8]=this.n13;a[9]=this.n23;a[10]=this.n33;a[11]=this.n43;a[12]=this.n14;a[13]=this.n24;a[14]=this.n34;a[15]=this.n44;return this},multiplyScalar:function(a){this.n11*=a;this.n12*=a;this.n13*=a;this.n14*=a;this.n21*=a;this.n22*=a;this.n23*=a;this.n24*=a;this.n31*=a;this.n32*=a;this.n33*=a;this.n34*=a;this.n41*=a;this.n42*=a;this.n43*=a;this.n44*=a;return this},multiplyVector3:function(b){var g=b.x,i=b.y,j=b.z,a=1/(this.n41*g+this.n42*i+this.n43*j+this.n44);b.x=(this.n11*g+this.n12*i+this.n13*j+this.n14)*a;b.y=(this.n21*g+this.n22*i+this.n23*j+this.n24)*a;b.z=(this.n31*g+this.n32*i+this.n33*j+this.n34)*a;return b},multiplyVector4:function(b){var g=b.x,i=b.y,j=b.z,a=b.w;b.x=this.n11*g+this.n12*i+this.n13*j+this.n14*a;b.y=this.n21*g+this.n22*i+this.n23*j+this.n24*a;b.z=this.n31*g+this.n32*i+this.n33*j+this.n34*a;b.w=this.n41*g+this.n42*i+this.n43*j+this.n44*a;return b},rotateAxis:function(a){var g=a.x,b=a.y,h=a.z;a.x=g*this.n11+b*this.n12+h*this.n13;a.y=g*this.n21+b*this.n22+h*this.n23;a.z=g*this.n31+b*this.n32+h*this.n33;a.normalize();return a},crossVector:function(b){var a=new c.Vector4;a.x=this.n11*b.x+this.n12*b.y+this.n13*b.z+this.n14*b.w;a.y=this.n21*b.x+this.n22*b.y+this.n23*b.z+this.n24*b.w;a.z=this.n31*b.x+this.n32*b.y+this.n33*b.z+this.n34*b.w;a.w=b.w?this.n41*b.x+this.n42*b.y+this.n43*b.z+this.n44*b.w:1;return a},determinant:function(){var k=this.n11,f=this.n12,e=this.n13,l=this.n14,p=this.n21,n=this.n22,m=this.n23,r=this.n24,E=this.n31,b=this.n32,F=this.n33,a=this.n34,g=this.n41,h=this.n42,o=this.n43,i=this.n44;return l*m*b*g-e*r*b*g-l*n*F*g+f*r*F*g+e*n*a*g-f*m*a*g-l*m*E*h+e*r*E*h+l*p*F*h-k*r*F*h-e*p*a*h+k*m*a*h+l*n*E*o-f*r*E*o-l*p*b*o+k*r*b*o+f*p*a*o-k*n*a*o-e*n*E*i+f*m*E*i+e*p*b*i-k*m*b*i-f*p*F*i+k*n*F*i},transpose:function(){var a;a=this.n21;this.n21=this.n12;this.n12=a;a=this.n31;this.n31=this.n13;this.n13=a;a=this.n32;this.n32=this.n23;this.n23=a;a=this.n41;this.n41=this.n14;this.n14=a;a=this.n42;this.n42=this.n24;this.n24=a;a=this.n43;this.n43=this.n34;this.n43=a;return this},clone:function(){var a=new c.Matrix4;a.n11=this.n11;a.n12=this.n12;a.n13=this.n13;a.n14=this.n14;a.n21=this.n21;a.n22=this.n22;a.n23=this.n23;a.n24=this.n24;a.n31=this.n31;a.n32=this.n32;a.n33=this.n33;a.n34=this.n34;a.n41=this.n41;a.n42=this.n42;a.n43=this.n43;a.n44=this.n44;return a},flatten:function(){this.flat[0]=this.n11;this.flat[1]=this.n21;this.flat[2]=this.n31;this.flat[3]=this.n41;this.flat[4]=this.n12;this.flat[5]=this.n22;this.flat[6]=this.n32;this.flat[7]=this.n42;this.flat[8]=this.n13;this.flat[9]=this.n23;this.flat[10]=this.n33;this.flat[11]=this.n43;this.flat[12]=this.n14;this.flat[13]=this.n24;this.flat[14]=this.n34;this.flat[15]=this.n44;return this.flat},flattenToArray:function(a){a[0]=this.n11;a[1]=this.n21;a[2]=this.n31;a[3]=this.n41;a[4]=this.n12;a[5]=this.n22;a[6]=this.n32;a[7]=this.n42;a[8]=this.n13;a[9]=this.n23;a[10]=this.n33;a[11]=this.n43;a[12]=this.n14;a[13]=this.n24;a[14]=this.n34;a[15]=this.n44;return a},flattenToArrayOffset:function(b,a){b[a]=this.n11;b[a+1]=this.n21;b[a+2]=this.n31;b[a+3]=this.n41;b[a+4]=this.n12;b[a+5]=this.n22;b[a+6]=this.n32;b[a+7]=this.n42;b[a+8]=this.n13;b[a+9]=this.n23;b[a+10]=this.n33;b[a+11]=this.n43;b[a+12]=this.n14;b[a+13]=this.n24;b[a+14]=this.n34;b[a+15]=this.n44;return b},setTranslation:function(f,b,a){this.set(1,0,0,f,0,1,0,b,0,0,1,a,0,0,0,1);return this},setScale:function(f,b,a){this.set(f,0,0,0,0,b,0,0,0,0,a,0,0,0,0,1);return this},setRotationX:function(b){var a=Math.cos(b),b=Math.sin(b);this.set(1,0,0,0,0,a,-b,0,0,b,a,0,0,0,0,1);return this},setRotationY:function(b){var a=Math.cos(b),b=Math.sin(b);this.set(a,0,b,0,0,1,0,0,-b,0,a,0,0,0,0,1);return this},setRotationZ:function(b){var a=Math.cos(b),b=Math.sin(b);this.set(a,-b,0,0,b,a,0,0,0,0,1,0,0,0,0,1);return this},setRotationAxis:function(a,e){var b=Math.cos(e),f=Math.sin(e),i=1-b,h=a.x,g=a.y,l=a.z,s=i*h,t=i*g;this.set(s*h+b,s*g-f*l,s*l+f*g,0,s*g+f*l,t*g+b,t*l-f*h,0,s*l-f*g,t*l+f*h,i*l*l+b,0,0,0,0,1);return this},setPosition:function(a){this.n14=a.x;this.n24=a.y;this.n34=a.z;return this},getPosition:function(){return c.Matrix4.__v1.set(this.n14,this.n24,this.n34)},getColumnX:function(){return c.Matrix4.__v1.set(this.n11,this.n21,this.n31)},getColumnY:function(){return c.Matrix4.__v1.set(this.n12,this.n22,this.n32)},getColumnZ:function(){return c.Matrix4.__v1.set(this.n13,this.n23,this.n33)},getInverse:function(r){var k=r.n11,g=r.n12,a=r.n13,e=r.n14,b=r.n21,H=r.n22,f=r.n23,l=r.n24,n=r.n31,m=r.n32,G=r.n33,h=r.n34,o=r.n41,i=r.n42,p=r.n43,q=r.n44;this.n11=f*h*i-l*G*i+l*m*p-H*h*p-f*m*q+H*G*q;this.n12=e*G*i-a*h*i-e*m*p+g*h*p+a*m*q-g*G*q;this.n13=a*l*i-e*f*i+e*H*p-g*l*p-a*H*q+g*f*q;this.n14=e*f*m-a*l*m-e*H*G+g*l*G+a*H*h-g*f*h;this.n21=l*G*o-f*h*o-l*n*p+b*h*p+f*n*q-b*G*q;this.n22=a*h*o-e*G*o+e*n*p-k*h*p-a*n*q+k*G*q;this.n23=e*f*o-a*l*o-e*b*p+k*l*p+a*b*q-k*f*q;this.n24=a*l*n-e*f*n+e*b*G-k*l*G-a*b*h+k*f*h;this.n31=H*h*o-l*m*o+l*n*i-b*h*i-H*n*q+b*m*q;this.n32=e*m*o-g*h*o-e*n*i+k*h*i+g*n*q-k*m*q;this.n33=a*l*o-e*H*o+e*b*i-k*l*i-g*b*q+k*H*q;this.n34=e*H*n-g*l*n-e*b*m+k*l*m+g*b*h-k*H*h;this.n41=f*m*o-H*G*o-f*n*i+b*G*i+H*n*p-b*m*p;this.n42=g*G*o-a*m*o+a*n*i-k*G*i-g*n*p+k*m*p;this.n43=a*H*o-g*f*o-a*b*i+k*f*i+g*b*p-k*H*p;this.n44=g*f*n-a*H*n+a*b*m-k*f*m-g*b*G+k*H*G;this.multiplyScalar(1/r.determinant());return this},setRotationFromEuler:function(g,i){var h=g.x,k=g.y,l=g.z,x=Math.cos(h),h=Math.sin(h),w=Math.cos(k),k=Math.sin(k),o=Math.cos(l),l=Math.sin(l);switch(i){case"YXZ":var a=w*o,e=w*l,b=k*o,f=k*l;this.n11=a+f*h;this.n12=b*h-e;this.n13=x*k;this.n21=x*l;this.n22=x*o;this.n23=-h;this.n31=e*h-b;this.n32=f+a*h;this.n33=x*w;break;case"ZXY":a=w*o;e=w*l;b=k*o;f=k*l;this.n11=a-f*h;this.n12=-x*l;this.n13=b+e*h;this.n21=e+b*h;this.n22=x*o;this.n23=f-a*h;this.n31=-x*k;this.n32=h;this.n33=x*w;break;case"ZYX":a=x*o;e=x*l;b=h*o;f=h*l;this.n11=w*o;this.n12=b*k-e;this.n13=a*k+f;this.n21=w*l;this.n22=f*k+a;this.n23=e*k-b;this.n31=-k;this.n32=h*w;this.n33=x*w;break;case"YZX":a=x*w;e=x*k;b=h*w;f=h*k;this.n11=w*o;this.n12=f-a*l;this.n13=b*l+e;this.n21=l;this.n22=x*o;this.n23=-h*o;this.n31=-k*o;this.n32=e*l+b;this.n33=a-f*l;break;case"XZY":a=x*w;e=x*k;b=h*w;f=h*k;this.n11=w*o;this.n12=-l;this.n13=k*o;this.n21=a*l+f;this.n22=x*o;this.n23=e*l-b;this.n31=b*l-e;this.n32=h*o;this.n33=f*l+a;break;default:a=x*o,e=x*l,b=h*o,f=h*l,this.n11=w*o,this.n12=-w*l,this.n13=k,this.n21=e+b*k,this.n22=a-f*k,this.n23=-h*w,this.n31=f-a*k,this.n32=b+e*k,this.n33=x*w}return this},setRotationFromQuaternion:function(a){var e=a.x,b=a.y,f=a.z,i=a.w,h=e+e,g=b+b,l=f+f,a=e*h,s=e*g;e*=l;var t=b*g;b*=l;f*=l;h*=i;g*=i;i*=l;this.n11=1-(t+f);this.n12=s-i;this.n13=e+g;this.n21=s+i;this.n22=1-(a+f);this.n23=b-h;this.n31=e-g;this.n32=b+h;this.n33=1-(a+t);return this},scale:function(f){var b=f.x,a=f.y,f=f.z;this.n11*=b;this.n12*=a;this.n13*=f;this.n21*=b;this.n22*=a;this.n23*=f;this.n31*=b;this.n32*=a;this.n33*=f;this.n41*=b;this.n42*=a;this.n43*=f;return this},compose:function(b,g,i){var j=c.Matrix4.__m1,a=c.Matrix4.__m2;j.identity();j.setRotationFromQuaternion(g);a.setScale(i.x,i.y,i.z);this.multiply(j,a);this.n14=b.x;this.n24=b.y;this.n34=b.z;return this},decompose:function(k,g,a){var l=c.Matrix4.__v1,f=c.Matrix4.__v2,b=c.Matrix4.__v3;l.set(this.n11,this.n21,this.n31);f.set(this.n12,this.n22,this.n32);b.set(this.n13,this.n23,this.n33);k=k instanceof c.Vector3?k:new c.Vector3;g=g instanceof c.Quaternion?g:new c.Quaternion;a=a instanceof c.Vector3?a:new c.Vector3;a.x=l.length();a.y=f.length();a.z=b.length();k.x=this.n14;k.y=this.n24;k.z=this.n34;l=c.Matrix4.__m1;l.copy(this);l.n11/=a.x;l.n21/=a.x;l.n31/=a.x;l.n12/=a.y;l.n22/=a.y;l.n32/=a.y;l.n13/=a.z;l.n23/=a.z;l.n33/=a.z;g.setFromRotationMatrix(l);return[k,g,a]},extractPosition:function(a){this.n14=a.n14;this.n24=a.n24;this.n34=a.n34;return this},extractRotation:function(a){var g=c.Matrix4.__v1,b=1/g.set(a.n11,a.n21,a.n31).length(),h=1/g.set(a.n12,a.n22,a.n32).length(),g=1/g.set(a.n13,a.n23,a.n33).length();this.n11=a.n11*b;this.n21=a.n21*b;this.n31=a.n31*b;this.n12=a.n12*h;this.n22=a.n22*h;this.n32=a.n32*h;this.n13=a.n13*g;this.n23=a.n23*g;this.n33=a.n33*g;return this}};c.Matrix4.makeInvert3x3=function(g){var i=g.m33,h=i.m,k=g.n33*g.n22-g.n32*g.n23,l=-g.n33*g.n21+g.n31*g.n23,x=g.n32*g.n21-g.n31*g.n22,w=-g.n33*g.n12+g.n32*g.n13,o=g.n33*g.n11-g.n31*g.n13,a=-g.n32*g.n11+g.n31*g.n12,e=g.n23*g.n12-g.n22*g.n13,b=-g.n23*g.n11+g.n21*g.n13,f=g.n22*g.n11-g.n21*g.n12,g=g.n11*k+g.n21*w+g.n31*e;g===0&&console.error("THREE.Matrix4.makeInvert3x3: Matrix not invertible.");g=1/g;h[0]=g*k;h[1]=g*l;h[2]=g*x;h[3]=g*w;h[4]=g*o;h[5]=g*a;h[6]=g*e;h[7]=g*b;h[8]=g*f;return i};c.Matrix4.makeFrustum=function(g,b,a,m,f,e){var n;n=new c.Matrix4;n.n11=2*f/(b-g);n.n12=0;n.n13=(b+g)/(b-g);n.n14=0;n.n21=0;n.n22=2*f/(m-a);n.n23=(m+a)/(m-a);n.n24=0;n.n31=0;n.n32=0;n.n33=-(e+f)/(e-f);n.n34=-2*e*f/(e-f);n.n41=0;n.n42=0;n.n43=-1;n.n44=0;return n};c.Matrix4.makePerspective=function(b,g,i,j){var a,b=i*Math.tan(b*Math.PI/360);a=-b;return c.Matrix4.makeFrustum(a*g,b*g,a,b,i,j)};c.Matrix4.makeOrtho=function(a,e,b,f,i,h){var g,l,s,t;g=new c.Matrix4;l=e-a;s=b-f;t=h-i;g.n11=2/l;g.n12=0;g.n13=0;g.n14=-((e+a)/l);g.n21=0;g.n22=2/s;g.n23=0;g.n24=-((b+f)/s);g.n31=0;g.n32=0;g.n33=-2/t;g.n34=-((h+i)/t);g.n41=0;g.n42=0;g.n43=0;g.n44=1;return g};c.Matrix4.__v1=new c.Vector3;c.Matrix4.__v2=new c.Vector3;c.Matrix4.__v3=new c.Vector3;c.Matrix4.__m1=new c.Matrix4;c.Matrix4.__m2=new c.Matrix4;c.Object3D=function(){this.name="";this.id=c.Object3DCount++;this.parent=void 0;this.children=[];this.up=new c.Vector3(0,1,0);this.position=new c.Vector3;this.rotation=new c.Vector3;this.eulerOrder="XYZ";this.scale=new c.Vector3(1,1,1);this.flipSided=this.doubleSided=this.dynamic=!1;this.renderDepth=null;this.rotationAutoUpdate=!0;this.matrix=new c.Matrix4;this.matrixWorld=new c.Matrix4;this.matrixRotationWorld=new c.Matrix4;this.matrixWorldNeedsUpdate=this.matrixAutoUpdate=!0;this.quaternion=new c.Quaternion;this.useQuaternion=!1;this.boundRadius=0;this.boundRadiusScale=1;this.visible=!0;this.receiveShadow=this.castShadow=!1;this.frustumCulled=!0;this._vector=new c.Vector3};c.Object3D.prototype={constructor:c.Object3D,translate:function(b,a){this.matrix.rotateAxis(a);this.position.addSelf(a.multiplyScalar(b))},translateX:function(a){this.translate(a,this._vector.set(1,0,0))},translateY:function(a){this.translate(a,this._vector.set(0,1,0))},translateZ:function(a){this.translate(a,this._vector.set(0,0,1))},lookAt:function(a){this.matrix.lookAt(a,this.position,this.up);this.rotationAutoUpdate&&this.rotation.setRotationFromMatrix(this.matrix)},add:function(b){if(this.children.indexOf(b)===-1){b.parent!==void 0&&b.parent.remove(b);b.parent=this;this.children.push(b);for(var a=this;a.parent!==void 0;){a=a.parent}a!==void 0&&a instanceof c.Scene&&a.addObject(b)}},remove:function(b){var a=this.children.indexOf(b);if(a!==-1){b.parent=void 0;this.children.splice(a,1);for(a=this;a.parent!==void 0;){a=a.parent}a!==void 0&&a instanceof c.Scene&&a.removeObject(b)}},getChildByName:function(b,g){var i,j,a;i=0;for(j=this.children.length;i<j;i++){a=this.children[i];if(a.name===b){return a}if(g&&(a=a.getChildByName(b,g),a!==void 0)){return a}}},updateMatrix:function(){this.matrix.setPosition(this.position);this.useQuaternion?this.matrix.setRotationFromQuaternion(this.quaternion):this.matrix.setRotationFromEuler(this.rotation,this.eulerOrder);if(this.scale.x!==1||this.scale.y!==1||this.scale.z!==1){this.matrix.scale(this.scale),this.boundRadiusScale=Math.max(this.scale.x,Math.max(this.scale.y,this.scale.z))}this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(f){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||f){this.parent?this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,f=!0}for(var b=0,a=this.children.length;b<a;b++){this.children[b].updateMatrixWorld(f)}}};c.Object3DCount=0;c.Projector=function(){function p(){var j=ac[ad]=ac[ad]||new c.RenderableObject;ad++;return j}function w(){var j=e[a]=e[a]||new c.RenderableVertex;a++;return j}function u(z,j){return j.z-z.z}function F(j,C){var D=0,G=1,H=j.z+j.w,K=C.z+C.w,I=-j.z+j.w,z=-C.z+C.w;return H>=0&&K>=0&&I>=0&&z>=0?!0:H<0&&K<0||I<0&&z<0?!1:(H<0?D=Math.max(D,H/(H-K)):K<0&&(G=Math.min(G,H/(H-K))),I<0?D=Math.max(D,I/(I-z)):z<0&&(G=Math.min(G,I/(I-z))),G<D?!1:(j.lerpSelf(C,D),C.lerpSelf(j,1-G),!0))}var B,ad,ac=[],E,a,e=[],b,h,i=[],f,n=[],g,l,r=[],A,x,m=[],y={objects:[],sprites:[],lights:[],elements:[]},k=new c.Vector3,J=new c.Vector4,v=new c.Matrix4,t=new c.Matrix4,o=[new c.Vector4,new c.Vector4,new c.Vector4,new c.Vector4,new c.Vector4,new c.Vector4],q=new c.Vector4,s=new c.Vector4;this.computeFrustum=function(z){o[0].set(z.n41-z.n11,z.n42-z.n12,z.n43-z.n13,z.n44-z.n14);o[1].set(z.n41+z.n11,z.n42+z.n12,z.n43+z.n13,z.n44+z.n14);o[2].set(z.n41+z.n21,z.n42+z.n22,z.n43+z.n23,z.n44+z.n24);o[3].set(z.n41-z.n21,z.n42-z.n22,z.n43-z.n23,z.n44-z.n24);o[4].set(z.n41-z.n31,z.n42-z.n32,z.n43-z.n33,z.n44-z.n34);o[5].set(z.n41+z.n31,z.n42+z.n32,z.n43+z.n33,z.n44+z.n34);for(z=0;z<6;z++){var j=o[z];j.divideScalar(Math.sqrt(j.x*j.x+j.y*j.y+j.z*j.z))}};this.projectVector=function(z,j){j.matrixWorldInverse.getInverse(j.matrixWorld);v.multiply(j.projectionMatrix,j.matrixWorldInverse);v.multiplyVector3(z);return z};this.unprojectVector=function(z,j){j.projectionMatrixInverse.getInverse(j.projectionMatrix);v.multiply(j.matrixWorld,j.projectionMatrixInverse);v.multiplyVector3(z);return z};this.pickingRay=function(j,z){var C;j.z=-1;C=new c.Vector3(j.x,j.y,1);this.unprojectVector(j,z);this.unprojectVector(C,z);C.subSelf(j).normalize();return new c.Ray(j,C)};this.projectGraph=function(C,j){ad=0;y.objects.length=0;y.sprites.length=0;y.lights.length=0;var z=function(K){if(K.visible!==!1){var D;if(D=K instanceof c.Mesh||K instanceof c.Line){if(!(D=K.frustumCulled===!1)){p:{for(var G=K.matrixWorld,H=-K.geometry.boundingSphere.radius*Math.max(K.scale.x,Math.max(K.scale.y,K.scale.z)),I=0;I<6;I++){if(D=o[I].x*G.n14+o[I].y*G.n24+o[I].z*G.n34+o[I].w,D<=H){D=!1;break p}}D=!0}}}D?(v.multiplyVector3(k.copy(K.position)),B=p(),B.object=K,B.z=k.z,y.objects.push(B)):K instanceof c.Sprite||K instanceof c.Particle?(v.multiplyVector3(k.copy(K.position)),B=p(),B.object=K,B.z=k.z,y.sprites.push(B)):K instanceof c.Light&&y.lights.push(K);D=0;for(G=K.children.length;D<G;D++){z(K.children[D])}}};z(C);j&&y.objects.sort(u);return y};this.projectScene=function(M,z,j){var H=z.near,Q=z.far,K,O,N,P,R,T,S,W,G,X,V,L,D,U,C,I;x=l=f=h=0;y.elements.length=0;z.parent===void 0&&(console.warn("DEPRECATED: Camera hasn't been added to a Scene. Adding it..."),M.add(z));M.updateMatrixWorld();z.matrixWorldInverse.getInverse(z.matrixWorld);v.multiply(z.projectionMatrix,z.matrixWorldInverse);this.computeFrustum(v);y=this.projectGraph(M,!1);M=0;for(K=y.objects.length;M<K;M++){if(G=y.objects[M].object,X=G.matrixWorld,L=G.material,a=0,G instanceof c.Mesh){V=G.geometry;D=G.geometry.materials;P=V.vertices;U=V.faces;C=V.faceVertexUvs;V=G.matrixRotationWorld.extractRotation(X);O=0;for(N=P.length;O<N;O++){E=w(),E.positionWorld.copy(P[O].position),X.multiplyVector3(E.positionWorld),E.positionScreen.copy(E.positionWorld),v.multiplyVector4(E.positionScreen),E.positionScreen.x/=E.positionScreen.w,E.positionScreen.y/=E.positionScreen.w,E.visible=E.positionScreen.z>H&&E.positionScreen.z<Q}P=0;for(O=U.length;P<O;P++){N=U[P];if(N instanceof c.Face3){if(R=e[N.a],T=e[N.b],S=e[N.c],R.visible&&T.visible&&S.visible&&(G.doubleSided||G.flipSided!=(S.positionScreen.x-R.positionScreen.x)*(T.positionScreen.y-R.positionScreen.y)-(S.positionScreen.y-R.positionScreen.y)*(T.positionScreen.x-R.positionScreen.x)<0)){W=i[h]=i[h]||new c.RenderableFace3,h++,b=W,b.v1.copy(R),b.v2.copy(T),b.v3.copy(S)}else{continue}}else{if(N instanceof c.Face4){if(R=e[N.a],T=e[N.b],S=e[N.c],W=e[N.d],R.visible&&T.visible&&S.visible&&W.visible&&(G.doubleSided||G.flipSided!=((W.positionScreen.x-R.positionScreen.x)*(T.positionScreen.y-R.positionScreen.y)-(W.positionScreen.y-R.positionScreen.y)*(T.positionScreen.x-R.positionScreen.x)<0||(T.positionScreen.x-S.positionScreen.x)*(W.positionScreen.y-S.positionScreen.y)-(T.positionScreen.y-S.positionScreen.y)*(W.positionScreen.x-S.positionScreen.x)<0))){I=n[f]=n[f]||new c.RenderableFace4,f++,b=I,b.v1.copy(R),b.v2.copy(T),b.v3.copy(S),b.v4.copy(W)}else{continue}}}b.normalWorld.copy(N.normal);V.multiplyVector3(b.normalWorld);b.centroidWorld.copy(N.centroid);X.multiplyVector3(b.centroidWorld);b.centroidScreen.copy(b.centroidWorld);v.multiplyVector3(b.centroidScreen);S=N.vertexNormals;R=0;for(T=S.length;R<T;R++){W=b.vertexNormalsWorld[R],W.copy(S[R]),V.multiplyVector3(W)}R=0;for(T=C.length;R<T;R++){if(I=C[R][P]){S=0;for(W=I.length;S<W;S++){b.uvs[R][S]=I[S]}}}b.material=L;b.faceMaterial=N.materialIndex!==null?D[N.materialIndex]:null;b.z=b.centroidScreen.z;y.elements.push(b)}}else{if(G instanceof c.Line){t.multiply(v,X);P=G.geometry.vertices;R=w();R.positionScreen.copy(P[0].position);t.multiplyVector4(R.positionScreen);O=1;for(N=P.length;O<N;O++){if(R=w(),R.positionScreen.copy(P[O].position),t.multiplyVector4(R.positionScreen),T=e[a-2],q.copy(R.positionScreen),s.copy(T.positionScreen),F(q,s)){q.multiplyScalar(1/q.w),s.multiplyScalar(1/s.w),G=r[l]=r[l]||new c.RenderableLine,l++,g=G,g.v1.positionScreen.copy(q),g.v2.positionScreen.copy(s),g.z=Math.max(q.z,s.z),g.material=L,y.elements.push(g)}}}}}M=0;for(K=y.sprites.length;M<K;M++){if(G=y.sprites[M].object,X=G.matrixWorld,G instanceof c.Particle&&(J.set(X.n14,X.n24,X.n34,1),v.multiplyVector4(J),J.z/=J.w,J.z>0&&J.z<1)){H=m[x]=m[x]||new c.RenderableParticle,x++,A=H,A.x=J.x/J.w,A.y=J.y/J.w,A.z=J.z,A.rotation=G.rotation.z,A.scale.x=G.scale.x*Math.abs(A.x-(J.x+z.projectionMatrix.n11)/(J.w+z.projectionMatrix.n14)),A.scale.y=G.scale.y*Math.abs(A.y-(J.y+z.projectionMatrix.n22)/(J.w+z.projectionMatrix.n24)),A.material=G.material,y.elements.push(A)}}j&&y.elements.sort(u);return y}};c.Quaternion=function(a,g,b,h){this.set(a||0,g||0,b||0,h!==void 0?h:1)};c.Quaternion.prototype={constructor:c.Quaternion,set:function(a,g,b,h){this.x=a;this.y=g;this.z=b;this.w=h;return this},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w;return this},setFromEuler:function(a){var g=Math.PI/360,e=a.x*g,b=a.y*g,p=a.z*g,a=Math.cos(b),b=Math.sin(b),g=Math.cos(-p),p=Math.sin(-p),h=Math.cos(e),e=Math.sin(e),f=a*g,o=b*p;this.w=f*h-o*e;this.x=f*e+o*h;this.y=b*g*h+a*p*e;this.z=a*p*h-b*g*e;return this},setFromAxisAngle:function(a,g){var b=g/2,h=Math.sin(b);this.x=a.x*h;this.y=a.y*h;this.z=a.z*h;this.w=Math.cos(b);return this},setFromRotationMatrix:function(b){var a=Math.pow(b.determinant(),1/3);this.w=Math.sqrt(Math.max(0,a+b.n11+b.n22+b.n33))/2;this.x=Math.sqrt(Math.max(0,a+b.n11-b.n22-b.n33))/2;this.y=Math.sqrt(Math.max(0,a-b.n11+b.n22-b.n33))/2;this.z=Math.sqrt(Math.max(0,a-b.n11-b.n22+b.n33))/2;this.x=b.n32-b.n23<0?-Math.abs(this.x):Math.abs(this.x);this.y=b.n13-b.n31<0?-Math.abs(this.y):Math.abs(this.y);this.z=b.n21-b.n12<0?-Math.abs(this.z):Math.abs(this.z);this.normalize();return this},calculateW:function(){this.w=-Math.sqrt(Math.abs(1-this.x*this.x-this.y*this.y-this.z*this.z));return this},inverse:function(){this.x*=-1;this.y*=-1;this.z*=-1;return this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var a=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);a===0?this.w=this.z=this.y=this.x=0:(a=1/a,this.x*=a,this.y*=a,this.z*=a,this.w*=a);return this},multiplySelf:function(a){var g=this.x,e=this.y,b=this.z,p=this.w,h=a.x,f=a.y,o=a.z,a=a.w;this.x=g*a+p*h+e*o-b*f;this.y=e*a+p*f+b*h-g*o;this.z=b*a+p*o+g*f-e*h;this.w=p*a-g*h-e*f-b*o;return this},multiply:function(b,a){this.x=b.x*a.w+b.y*a.z-b.z*a.y+b.w*a.x;this.y=-b.x*a.z+b.y*a.w+b.z*a.x+b.w*a.y;this.z=b.x*a.y-b.y*a.x+b.z*a.w+b.w*a.z;this.w=-b.x*a.x-b.y*a.y-b.z*a.z+b.w*a.w;return this},multiplyVector3:function(g,i){i||(i=g);var h=g.x,k=g.y,l=g.z,x=this.x,w=this.y,o=this.z,a=this.w,e=a*h+w*l-o*k,b=a*k+o*h-x*l,f=a*l+x*k-w*h,h=-x*h-w*k-o*l;i.x=e*a+h*-x+b*-o-f*-w;i.y=b*a+h*-w+f*-x-e*-o;i.z=f*a+h*-o+e*-w-b*-x;return i}};c.Quaternion.slerp=function(k,g,a,l){var f=k.w*g.w+k.x*g.x+k.y*g.y+k.z*g.z;f<0?(a.w=-g.w,a.x=-g.x,a.y=-g.y,a.z=-g.z,f=-f):a.copy(g);if(Math.abs(f)>=1){return a.w=k.w,a.x=k.x,a.y=k.y,a.z=k.z,a}var b=Math.acos(f),f=Math.sqrt(1-f*f);if(Math.abs(f)<0.001){return a.w=0.5*(k.w+g.w),a.x=0.5*(k.x+g.x),a.y=0.5*(k.y+g.y),a.z=0.5*(k.z+g.z),a}g=Math.sin((1-l)*b)/f;l=Math.sin(l*b)/f;a.w=k.w*g+a.w*l;a.x=k.x*g+a.x*l;a.y=k.y*g+a.y*l;a.z=k.z*g+a.z*l;return a};c.Vertex=function(a){this.position=a||new c.Vector3};c.Face3=function(k,g,a,l,f,b){this.a=k;this.b=g;this.c=a;this.normal=l instanceof c.Vector3?l:new c.Vector3;this.vertexNormals=l instanceof Array?l:[];this.color=f instanceof c.Color?f:new c.Color;this.vertexColors=f instanceof Array?f:[];this.vertexTangents=[];this.materialIndex=b;this.centroid=new c.Vector3};c.Face4=function(g,b,a,m,f,e,n){this.a=g;this.b=b;this.c=a;this.d=m;this.normal=f instanceof c.Vector3?f:new c.Vector3;this.vertexNormals=f instanceof Array?f:[];this.color=e instanceof c.Color?e:new c.Color;this.vertexColors=e instanceof Array?e:[];this.vertexTangents=[];this.materialIndex=n;this.centroid=new c.Vector3};c.UV=function(b,a){this.u=b||0;this.v=a||0};c.UV.prototype={constructor:c.UV,set:function(b,a){this.u=b;this.v=a;return this},copy:function(a){this.u=a.u;this.v=a.v;return this},clone:function(){return new c.UV(this.u,this.v)}};c.Geometry=function(){this.id=c.GeometryCount++;this.vertices=[];this.colors=[];this.materials=[];this.faces=[];this.faceUvs=[[]];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphColors=[];this.skinWeights=[];this.skinIndices=[];this.boundingSphere=this.boundingBox=null;this.dynamic=this.hasTangents=!1};c.Geometry.prototype={constructor:c.Geometry,applyMatrix:function(g){var b=new c.Matrix4;b.extractRotation(g,new c.Vector3(1,1,1));for(var a=0,m=this.vertices.length;a<m;a++){g.multiplyVector3(this.vertices[a].position)}a=0;for(m=this.faces.length;a<m;a++){var f=this.faces[a];b.multiplyVector3(f.normal);for(var e=0,n=f.vertexNormals.length;e<n;e++){b.multiplyVector3(f.vertexNormals[e])}g.multiplyVector3(f.centroid)}},computeCentroids:function(){var f,b,a;f=0;for(b=this.faces.length;f<b;f++){a=this.faces[f],a.centroid.set(0,0,0),a instanceof c.Face3?(a.centroid.addSelf(this.vertices[a.a].position),a.centroid.addSelf(this.vertices[a.b].position),a.centroid.addSelf(this.vertices[a.c].position),a.centroid.divideScalar(3)):a instanceof c.Face4&&(a.centroid.addSelf(this.vertices[a.a].position),a.centroid.addSelf(this.vertices[a.b].position),a.centroid.addSelf(this.vertices[a.c].position),a.centroid.addSelf(this.vertices[a.d].position),a.centroid.divideScalar(4))}},computeFaceNormals:function(){var a,g,e,b,p,h,f=new c.Vector3,o=new c.Vector3;a=0;for(g=this.faces.length;a<g;a++){e=this.faces[a],b=this.vertices[e.a],p=this.vertices[e.b],h=this.vertices[e.c],f.sub(h.position,p.position),o.sub(b.position,p.position),f.crossSelf(o),f.isZero()||f.normalize(),e.normal.copy(f)}},computeVertexNormals:function(){var a,g,b,h;if(this.__tmpVertices===void 0){h=this.__tmpVertices=Array(this.vertices.length);a=0;for(g=this.vertices.length;a<g;a++){h[a]=new c.Vector3}a=0;for(g=this.faces.length;a<g;a++){if(b=this.faces[a],b instanceof c.Face3){b.vertexNormals=[new c.Vector3,new c.Vector3,new c.Vector3]}else{if(b instanceof c.Face4){b.vertexNormals=[new c.Vector3,new c.Vector3,new c.Vector3,new c.Vector3]}}}}else{h=this.__tmpVertices;a=0;for(g=this.vertices.length;a<g;a++){h[a].set(0,0,0)}}a=0;for(g=this.faces.length;a<g;a++){b=this.faces[a],b instanceof c.Face3?(h[b.a].addSelf(b.normal),h[b.b].addSelf(b.normal),h[b.c].addSelf(b.normal)):b instanceof c.Face4&&(h[b.a].addSelf(b.normal),h[b.b].addSelf(b.normal),h[b.c].addSelf(b.normal),h[b.d].addSelf(b.normal))}a=0;for(g=this.vertices.length;a<g;a++){h[a].normalize()}a=0;for(g=this.faces.length;a<g;a++){b=this.faces[a],b instanceof c.Face3?(b.vertexNormals[0].copy(h[b.a]),b.vertexNormals[1].copy(h[b.b]),b.vertexNormals[2].copy(h[b.c])):b instanceof c.Face4&&(b.vertexNormals[0].copy(h[b.a]),b.vertexNormals[1].copy(h[b.b]),b.vertexNormals[2].copy(h[b.c]),b.vertexNormals[3].copy(h[b.d]))}},computeTangents:function(){function q(D,G,H,I,j,z,C){t=D.vertices[G].position;p=D.vertices[H].position;R=D.vertices[I].position;A=g[j];y=g[z];v=g[C];U=p.x-t.x;F=R.x-t.x;w=p.y-t.y;B=R.y-t.y;K=p.z-t.z;b=R.z-t.z;ac=y.u-A.u;E=v.u-A.u;ad=y.v-A.v;x=v.v-A.v;h=1/(ac*x-E*ad);J.set((x*U-ad*F)*h,(x*w-ad*B)*h,(x*K-ad*b)*h);P.set((ac*F-E*U)*h,(ac*B-E*w)*h,(ac*b-E*K)*h);a[G].addSelf(J);a[H].addSelf(J);a[I].addSelf(J);k[G].addSelf(P);k[H].addSelf(P);k[I].addSelf(P)}var s,r,e,n,l,g,t,p,R,A,y,v,U,F,w,B,K,b,ac,E,ad,x,h,i,a=[],k=[],J=new c.Vector3,P=new c.Vector3,f=new c.Vector3,u=new c.Vector3,m=new c.Vector3;s=0;for(r=this.vertices.length;s<r;s++){a[s]=new c.Vector3,k[s]=new c.Vector3}s=0;for(r=this.faces.length;s<r;s++){l=this.faces[s],g=this.faceVertexUvs[0][s],l instanceof c.Face3?q(this,l.a,l.b,l.c,0,1,2):l instanceof c.Face4&&(q(this,l.a,l.b,l.c,0,1,2),q(this,l.a,l.b,l.d,0,1,3))}var o=["a","b","c","d"];s=0;for(r=this.faces.length;s<r;s++){l=this.faces[s];for(e=0;e<l.vertexNormals.length;e++){m.copy(l.vertexNormals[e]),n=l[o[e]],i=a[n],f.copy(i),f.subSelf(m.multiplyScalar(m.dot(i))).normalize(),u.cross(l.vertexNormals[e],i),n=u.dot(k[n]),n=n<0?-1:1,l.vertexTangents[e]=new c.Vector4(f.x,f.y,f.z,n)}}this.hasTangents=!0},computeBoundingBox:function(){var f;if(this.vertices.length>0){this.boundingBox={x:[this.vertices[0].position.x,this.vertices[0].position.x],y:[this.vertices[0].position.y,this.vertices[0].position.y],z:[this.vertices[0].position.z,this.vertices[0].position.z]};for(var b=1,a=this.vertices.length;b<a;b++){f=this.vertices[b];if(f.position.x<this.boundingBox.x[0]){this.boundingBox.x[0]=f.position.x}else{if(f.position.x>this.boundingBox.x[1]){this.boundingBox.x[1]=f.position.x}}if(f.position.y<this.boundingBox.y[0]){this.boundingBox.y[0]=f.position.y}else{if(f.position.y>this.boundingBox.y[1]){this.boundingBox.y[1]=f.position.y}}if(f.position.z<this.boundingBox.z[0]){this.boundingBox.z[0]=f.position.z}else{if(f.position.z>this.boundingBox.z[1]){this.boundingBox.z[1]=f.position.z}}}}},computeBoundingSphere:function(){for(var f=0,b=0,a=this.vertices.length;b<a;b++){f=Math.max(f,this.vertices[b].position.length())}this.boundingSphere={radius:f}},mergeVertices:function(){var g={},b=[],a=[],m,f=Math.pow(10,4),e,n;e=0;for(n=this.vertices.length;e<n;e++){m=this.vertices[e].position,m=[Math.round(m.x*f),Math.round(m.y*f),Math.round(m.z*f)].join("_"),g[m]===void 0?(g[m]=e,b.push(this.vertices[e]),a[e]=b.length-1):a[e]=a[g[m]]}e=0;for(n=this.faces.length;e<n;e++){if(g=this.faces[e],g instanceof c.Face3){g.a=a[g.a],g.b=a[g.b],g.c=a[g.c]}else{if(g instanceof c.Face4){g.a=a[g.a],g.b=a[g.b],g.c=a[g.c],g.d=a[g.d]}}}this.vertices=b}};c.GeometryCount=0;c.Spline=function(z){function b(m,n,s,q,j,t,r){m=(s-m)*0.5;q=(q-n)*0.5;return(2*(n-s)+m+q)*r+(-3*(n-s)-2*m-q)*t+m*j+n}this.points=z;var a=[],e={x:0,y:0,z:0},f,h,g,i,k,o,l,p,y;this.initFromArray=function(j){this.points=[];for(var m=0;m<j.length;m++){this.points[m]={x:j[m][0],y:j[m][1],z:j[m][2]}}};this.getPoint=function(j){f=(this.points.length-1)*j;h=Math.floor(f);g=f-h;a[0]=h===0?h:h-1;a[1]=h;a[2]=h>this.points.length-2?h:h+1;a[3]=h>this.points.length-3?h:h+2;o=this.points[a[0]];l=this.points[a[1]];p=this.points[a[2]];y=this.points[a[3]];i=g*g;k=g*i;e.x=b(o.x,l.x,p.x,y.x,g,i,k);e.y=b(o.y,l.y,p.y,y.y,g,i,k);e.z=b(o.z,l.z,p.z,y.z,g,i,k);return e};this.getControlPointsArray=function(){var j,m,n=this.points.length,q=[];for(j=0;j<n;j++){m=this.points[j],q[j]=[m.x,m.y,m.z]}return q};this.getLength=function(q){var r,s,t,v=r=r=0,u=new c.Vector3,j=new c.Vector3,m=[],n=0;m[0]=0;q||(q=100);s=this.points.length*q;u.copy(this.points[0]);for(q=1;q<s;q++){r=q/s,t=this.getPoint(r),j.copy(t),n+=j.distanceTo(u),u.copy(t),r*=this.points.length-1,r=Math.floor(r),r!=v&&(m[r]=n,v=r)}m[m.length]=n;return{chunks:m,total:n}};this.reparametrizeByArcLength=function(m){var n,q,r,w,t,s,u=[],v=new c.Vector3,j=this.getLength();u.push(v.copy(this.points[0]).clone());for(n=1;n<this.points.length;n++){q=j.chunks[n]-j.chunks[n-1];s=Math.ceil(m*q/j.total);w=(n-1)/(this.points.length-1);t=n/(this.points.length-1);for(q=1;q<s-1;q++){r=w+q*(1/s)*(t-w),r=this.getPoint(r),u.push(v.copy(r).clone())}u.push(v.copy(this.points[n]).clone())}this.points=u}};c.Edge=function(a,g,b,h){this.vertices=[a,g];this.vertexIndices=[b,h];this.faces=[];this.faceIndices=[]};c.Camera=function(){if(arguments.length){return console.warn("DEPRECATED: Camera() is now PerspectiveCamera() or OrthographicCamera()."),new c.PerspectiveCamera(arguments[0],arguments[1],arguments[2],arguments[3])}c.Object3D.call(this);this.matrixWorldInverse=new c.Matrix4;this.projectionMatrix=new c.Matrix4;this.projectionMatrixInverse=new c.Matrix4};c.Camera.prototype=new c.Object3D;c.Camera.prototype.constructor=c.Camera;c.Camera.prototype.lookAt=function(a){this.matrix.lookAt(this.position,a,this.up);this.rotationAutoUpdate&&this.rotation.setRotationFromMatrix(this.matrix)};c.OrthographicCamera=function(k,g,a,l,f,b){c.Camera.call(this);this.left=k;this.right=g;this.top=a;this.bottom=l;this.near=f!==void 0?f:0.1;this.far=b!==void 0?b:2000;this.updateProjectionMatrix()};c.OrthographicCamera.prototype=new c.Camera;c.OrthographicCamera.prototype.constructor=c.OrthographicCamera;c.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix=c.Matrix4.makeOrtho(this.left,this.right,this.top,this.bottom,this.near,this.far)};c.PerspectiveCamera=function(a,g,b,h){c.Camera.call(this);this.fov=a!==void 0?a:50;this.aspect=g!==void 0?g:1;this.near=b!==void 0?b:0.1;this.far=h!==void 0?h:2000;this.updateProjectionMatrix()};c.PerspectiveCamera.prototype=new c.Camera;c.PerspectiveCamera.prototype.constructor=c.PerspectiveCamera;c.PerspectiveCamera.prototype.setLens=function(b,a){this.fov=2*Math.atan((a!==void 0?a:43.25)/(b*2));this.fov*=180/Math.PI;this.updateProjectionMatrix()};c.PerspectiveCamera.prototype.setViewOffset=function(k,g,a,l,f,b){this.fullWidth=k;this.fullHeight=g;this.x=a;this.y=l;this.width=f;this.height=b;this.updateProjectionMatrix()};c.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var a=this.fullWidth/this.fullHeight,g=Math.tan(this.fov*Math.PI/360)*this.near,b=-g,h=a*b,a=Math.abs(a*g-h),b=Math.abs(g-b);this.projectionMatrix=c.Matrix4.makeFrustum(h+this.x*a/this.fullWidth,h+(this.x+this.width)*a/this.fullWidth,g-(this.y+this.height)*b/this.fullHeight,g-this.y*b/this.fullHeight,this.near,this.far)}else{this.projectionMatrix=c.Matrix4.makePerspective(this.fov,this.aspect,this.near,this.far)}};c.Light=function(a){c.Object3D.call(this);this.color=new c.Color(a)};c.Light.prototype=new c.Object3D;c.Light.prototype.constructor=c.Light;c.Light.prototype.supr=c.Object3D.prototype;c.AmbientLight=function(a){c.Light.call(this,a)};c.AmbientLight.prototype=new c.Light;c.AmbientLight.prototype.constructor=c.AmbientLight;c.DirectionalLight=function(f,b,a){c.Light.call(this,f);this.position=new c.Vector3(0,1,0);this.intensity=b!==void 0?b:1;this.distance=a!==void 0?a:0};c.DirectionalLight.prototype=new c.Light;c.DirectionalLight.prototype.constructor=c.DirectionalLight;c.PointLight=function(f,b,a){c.Light.call(this,f);this.position=new c.Vector3(0,0,0);this.intensity=b!==void 0?b:1;this.distance=a!==void 0?a:0};c.PointLight.prototype=new c.Light;c.PointLight.prototype.constructor=c.PointLight;c.SpotLight=function(a,g,b,h){c.Light.call(this,a);this.position=new c.Vector3(0,1,0);this.target=new c.Object3D;this.intensity=g!==void 0?g:1;this.distance=b!==void 0?b:0;this.castShadow=h!==void 0?h:!1};c.SpotLight.prototype=new c.Light;c.SpotLight.prototype.constructor=c.SpotLight;c.Material=function(a){this.name="";this.id=c.MaterialCount++;a=a||{};this.opacity=a.opacity!==void 0?a.opacity:1;this.transparent=a.transparent!==void 0?a.transparent:!1;this.blending=a.blending!==void 0?a.blending:c.NormalBlending;this.depthTest=a.depthTest!==void 0?a.depthTest:!0;this.depthWrite=a.depthWrite!==void 0?a.depthWrite:!0;this.polygonOffset=a.polygonOffset!==void 0?a.polygonOffset:!1;this.polygonOffsetFactor=a.polygonOffsetFactor!==void 0?a.polygonOffsetFactor:0;this.polygonOffsetUnits=a.polygonOffsetUnits!==void 0?a.polygonOffsetUnits:0;this.alphaTest=a.alphaTest!==void 0?a.alphaTest:0;this.overdraw=a.overdraw!==void 0?a.overdraw:!1};c.MaterialCount=0;c.NoShading=0;c.FlatShading=1;c.SmoothShading=2;c.NoColors=0;c.FaceColors=1;c.VertexColors=2;c.NormalBlending=0;c.AdditiveBlending=1;c.SubtractiveBlending=2;c.MultiplyBlending=3;c.AdditiveAlphaBlending=4;c.LineBasicMaterial=function(a){c.Material.call(this,a);a=a||{};this.color=a.color!==void 0?new c.Color(a.color):new c.Color(16777215);this.linewidth=a.linewidth!==void 0?a.linewidth:1;this.linecap=a.linecap!==void 0?a.linecap:"round";this.linejoin=a.linejoin!==void 0?a.linejoin:"round";this.vertexColors=a.vertexColors?a.vertexColors:!1;this.fog=a.fog!==void 0?a.fog:!0};c.LineBasicMaterial.prototype=new c.Material;c.LineBasicMaterial.prototype.constructor=c.LineBasicMaterial;c.MeshBasicMaterial=function(a){c.Material.call(this,a);a=a||{};this.color=a.color!==void 0?new c.Color(a.color):new c.Color(16777215);this.map=a.map!==void 0?a.map:null;this.lightMap=a.lightMap!==void 0?a.lightMap:null;this.envMap=a.envMap!==void 0?a.envMap:null;this.combine=a.combine!==void 0?a.combine:c.MultiplyOperation;this.reflectivity=a.reflectivity!==void 0?a.reflectivity:1;this.refractionRatio=a.refractionRatio!==void 0?a.refractionRatio:0.98;this.fog=a.fog!==void 0?a.fog:!0;this.shading=a.shading!==void 0?a.shading:c.SmoothShading;this.wireframe=a.wireframe!==void 0?a.wireframe:!1;this.wireframeLinewidth=a.wireframeLinewidth!==void 0?a.wireframeLinewidth:1;this.wireframeLinecap=a.wireframeLinecap!==void 0?a.wireframeLinecap:"round";this.wireframeLinejoin=a.wireframeLinejoin!==void 0?a.wireframeLinejoin:"round";this.vertexColors=a.vertexColors!==void 0?a.vertexColors:!1;this.skinning=a.skinning!==void 0?a.skinning:!1;this.morphTargets=a.morphTargets!==void 0?a.morphTargets:!1};c.MeshBasicMaterial.prototype=new c.Material;c.MeshBasicMaterial.prototype.constructor=c.MeshBasicMaterial;c.MeshLambertMaterial=function(a){c.Material.call(this,a);a=a||{};this.color=a.color!==void 0?new c.Color(a.color):new c.Color(16777215);this.ambient=a.ambient!==void 0?new c.Color(a.ambient):new c.Color(328965);this.map=a.map!==void 0?a.map:null;this.lightMap=a.lightMap!==void 0?a.lightMap:null;this.envMap=a.envMap!==void 0?a.envMap:null;this.combine=a.combine!==void 0?a.combine:c.MultiplyOperation;this.reflectivity=a.reflectivity!==void 0?a.reflectivity:1;this.refractionRatio=a.refractionRatio!==void 0?a.refractionRatio:0.98;this.fog=a.fog!==void 0?a.fog:!0;this.shading=a.shading!==void 0?a.shading:c.SmoothShading;this.wireframe=a.wireframe!==void 0?a.wireframe:!1;this.wireframeLinewidth=a.wireframeLinewidth!==void 0?a.wireframeLinewidth:1;this.wireframeLinecap=a.wireframeLinecap!==void 0?a.wireframeLinecap:"round";this.wireframeLinejoin=a.wireframeLinejoin!==void 0?a.wireframeLinejoin:"round";this.vertexColors=a.vertexColors!==void 0?a.vertexColors:!1;this.skinning=a.skinning!==void 0?a.skinning:!1;this.morphTargets=a.morphTargets!==void 0?a.morphTargets:!1};c.MeshLambertMaterial.prototype=new c.Material;c.MeshLambertMaterial.prototype.constructor=c.MeshLambertMaterial;c.MeshPhongMaterial=function(a){c.Material.call(this,a);a=a||{};this.color=a.color!==void 0?new c.Color(a.color):new c.Color(16777215);this.ambient=a.ambient!==void 0?new c.Color(a.ambient):new c.Color(328965);this.specular=a.specular!==void 0?new c.Color(a.specular):new c.Color(1118481);this.shininess=a.shininess!==void 0?a.shininess:30;this.metal=a.metal!==void 0?a.metal:!1;this.perPixel=a.perPixel!==void 0?a.perPixel:!1;this.map=a.map!==void 0?a.map:null;this.lightMap=a.lightMap!==void 0?a.lightMap:null;this.envMap=a.envMap!==void 0?a.envMap:null;this.combine=a.combine!==void 0?a.combine:c.MultiplyOperation;this.reflectivity=a.reflectivity!==void 0?a.reflectivity:1;this.refractionRatio=a.refractionRatio!==void 0?a.refractionRatio:0.98;this.fog=a.fog!==void 0?a.fog:!0;this.shading=a.shading!==void 0?a.shading:c.SmoothShading;this.wireframe=a.wireframe!==void 0?a.wireframe:!1;this.wireframeLinewidth=a.wireframeLinewidth!==void 0?a.wireframeLinewidth:1;this.wireframeLinecap=a.wireframeLinecap!==void 0?a.wireframeLinecap:"round";this.wireframeLinejoin=a.wireframeLinejoin!==void 0?a.wireframeLinejoin:"round";this.vertexColors=a.vertexColors!==void 0?a.vertexColors:!1;this.skinning=a.skinning!==void 0?a.skinning:!1;this.morphTargets=a.morphTargets!==void 0?a.morphTargets:!1};c.MeshPhongMaterial.prototype=new c.Material;c.MeshPhongMaterial.prototype.constructor=c.MeshPhongMaterial;c.MeshDepthMaterial=function(a){c.Material.call(this,a);a=a||{};this.shading=a.shading!==void 0?a.shading:c.SmoothShading;this.wireframe=a.wireframe!==void 0?a.wireframe:!1;this.wireframeLinewidth=a.wireframeLinewidth!==void 0?a.wireframeLinewidth:1};c.MeshDepthMaterial.prototype=new c.Material;c.MeshDepthMaterial.prototype.constructor=c.MeshDepthMaterial;c.MeshNormalMaterial=function(a){c.Material.call(this,a);a=a||{};this.shading=a.shading?a.shading:c.FlatShading;this.wireframe=a.wireframe?a.wireframe:!1;this.wireframeLinewidth=a.wireframeLinewidth?a.wireframeLinewidth:1};c.MeshNormalMaterial.prototype=new c.Material;c.MeshNormalMaterial.prototype.constructor=c.MeshNormalMaterial;c.MeshFaceMaterial=function(){};c.MeshShaderMaterial=function(a){console.warn("DEPRECATED: MeshShaderMaterial() is now ShaderMaterial().");return new c.ShaderMaterial(a)};c.ParticleBasicMaterial=function(a){c.Material.call(this,a);a=a||{};this.color=a.color!==void 0?new c.Color(a.color):new c.Color(16777215);this.map=a.map!==void 0?a.map:null;this.size=a.size!==void 0?a.size:1;this.sizeAttenuation=a.sizeAttenuation!==void 0?a.sizeAttenuation:!0;this.vertexColors=a.vertexColors!==void 0?a.vertexColors:!1;this.fog=a.fog!==void 0?a.fog:!0};c.ParticleBasicMaterial.prototype=new c.Material;c.ParticleBasicMaterial.prototype.constructor=c.ParticleBasicMaterial;c.ParticleCanvasMaterial=function(a){c.Material.call(this,a);a=a||{};this.color=a.color!==void 0?new c.Color(a.color):new c.Color(16777215);this.program=a.program!==void 0?a.program:function(){}};c.ParticleCanvasMaterial.prototype=new c.Material;c.ParticleCanvasMaterial.prototype.constructor=c.ParticleCanvasMaterial;c.ParticleDOMMaterial=function(a){c.Material.call(this);this.domElement=a};c.ShaderMaterial=function(a){c.Material.call(this,a);a=a||{};this.fragmentShader=a.fragmentShader!==void 0?a.fragmentShader:"void main() {}";this.vertexShader=a.vertexShader!==void 0?a.vertexShader:"void main() {}";this.uniforms=a.uniforms!==void 0?a.uniforms:{};this.attributes=a.attributes;this.shading=a.shading!==void 0?a.shading:c.SmoothShading;this.wireframe=a.wireframe!==void 0?a.wireframe:!1;this.wireframeLinewidth=a.wireframeLinewidth!==void 0?a.wireframeLinewidth:1;this.fog=a.fog!==void 0?a.fog:!1;this.lights=a.lights!==void 0?a.lights:!1;this.vertexColors=a.vertexColors!==void 0?a.vertexColors:!1;this.skinning=a.skinning!==void 0?a.skinning:!1;this.morphTargets=a.morphTargets!==void 0?a.morphTargets:!1};c.ShaderMaterial.prototype=new c.Material;c.ShaderMaterial.prototype.constructor=c.ShaderMaterial;c.Texture=function(k,g,a,l,f,b){this.id=c.TextureCount++;this.image=k;this.mapping=g!==void 0?g:new c.UVMapping;this.wrapS=a!==void 0?a:c.ClampToEdgeWrapping;this.wrapT=l!==void 0?l:c.ClampToEdgeWrapping;this.magFilter=f!==void 0?f:c.LinearFilter;this.minFilter=b!==void 0?b:c.LinearMipMapLinearFilter;this.offset=new c.Vector2(0,0);this.repeat=new c.Vector2(1,1);this.needsUpdate=!1;this.onUpdate=null};c.Texture.prototype={constructor:c.Texture,clone:function(){var a=new c.Texture(this.image,this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter);a.offset.copy(this.offset);a.repeat.copy(this.repeat);return a}};c.TextureCount=0;c.MultiplyOperation=0;c.MixOperation=1;c.CubeReflectionMapping=function(){};c.CubeRefractionMapping=function(){};c.LatitudeReflectionMapping=function(){};c.LatitudeRefractionMapping=function(){};c.SphericalReflectionMapping=function(){};c.SphericalRefractionMapping=function(){};c.UVMapping=function(){};c.RepeatWrapping=0;c.ClampToEdgeWrapping=1;c.MirroredRepeatWrapping=2;c.NearestFilter=3;c.NearestMipMapNearestFilter=4;c.NearestMipMapLinearFilter=5;c.LinearFilter=6;c.LinearMipMapNearestFilter=7;c.LinearMipMapLinearFilter=8;c.ByteType=9;c.UnsignedByteType=10;c.ShortType=11;c.UnsignedShortType=12;c.IntType=13;c.UnsignedIntType=14;c.FloatType=15;c.AlphaFormat=16;c.RGBFormat=17;c.RGBAFormat=18;c.LuminanceFormat=19;c.LuminanceAlphaFormat=20;c.DataTexture=function(e,g,f,h,r,q,i,a,b){c.Texture.call(this,null,r,q,i,a,b);this.image={data:e,width:g,height:f};this.format=h!==void 0?h:c.RGBAFormat};c.DataTexture.prototype=new c.Texture;c.DataTexture.prototype.constructor=c.DataTexture;c.DataTexture.prototype.clone=function(){var a=new c.DataTexture(this.data.slice(0),this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter);a.offset.copy(this.offset);a.repeat.copy(this.repeat);return a};c.Particle=function(a){c.Object3D.call(this);this.material=a};c.Particle.prototype=new c.Object3D;c.Particle.prototype.constructor=c.Particle;c.ParticleSystem=function(b,a){c.Object3D.call(this);this.geometry=b;this.material=a;this.sortParticles=!1};c.ParticleSystem.prototype=new c.Object3D;c.ParticleSystem.prototype.constructor=c.ParticleSystem;c.Line=function(f,b,a){c.Object3D.call(this);this.geometry=f;this.material=b;this.type=a!==void 0?a:c.LineStrip;this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere())};c.LineStrip=0;c.LinePieces=1;c.Line.prototype=new c.Object3D;c.Line.prototype.constructor=c.Line;c.Mesh=function(f,b){c.Object3D.call(this);this.geometry=f;this.material=b;if(b instanceof Array){console.warn("DEPRECATED: Mesh material can no longer be an Array. Using material at index 0..."),this.material=b[0]}if(this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere(),this.boundRadius=f.boundingSphere.radius,this.geometry.morphTargets.length)){this.morphTargetBase=-1;this.morphTargetForcedOrder=[];this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var a=0;a<this.geometry.morphTargets.length;a++){this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[a].name]=a}}};c.Mesh.prototype=new c.Object3D;c.Mesh.prototype.constructor=c.Mesh;c.Mesh.prototype.supr=c.Object3D.prototype;c.Mesh.prototype.getMorphTargetIndexByName=function(a){if(this.morphTargetDictionary[a]!==void 0){return this.morphTargetDictionary[a]}console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+a+" does not exist. Returning 0.");return 0};c.Bone=function(a){c.Object3D.call(this);this.skin=a;this.skinMatrix=new c.Matrix4};c.Bone.prototype=new c.Object3D;c.Bone.prototype.constructor=c.Bone;c.Bone.prototype.supr=c.Object3D.prototype;c.Bone.prototype.update=function(a,g){this.matrixAutoUpdate&&(g|=this.updateMatrix());if(g||this.matrixWorldNeedsUpdate){a?this.skinMatrix.multiply(a,this.matrix):this.skinMatrix.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,g=!0}var b,h=this.children.length;for(b=0;b<h;b++){this.children[b].update(this.skinMatrix,g)}};c.SkinnedMesh=function(a,g){c.Mesh.call(this,a,g);this.identityMatrix=new c.Matrix4;this.bones=[];this.boneMatrices=[];var e,b,p,h,f,o;if(this.geometry.bones!==void 0){for(e=0;e<this.geometry.bones.length;e++){p=this.geometry.bones[e],h=p.pos,f=p.rotq,o=p.scl,b=this.addBone(),b.name=p.name,b.position.set(h[0],h[1],h[2]),b.quaternion.set(f[0],f[1],f[2],f[3]),b.useQuaternion=!0,o!==void 0?b.scale.set(o[0],o[1],o[2]):b.scale.set(1,1,1)}for(e=0;e<this.bones.length;e++){p=this.geometry.bones[e],b=this.bones[e],p.parent===-1?this.add(b):this.bones[p.parent].add(b)}this.boneMatrices=new Float32Array(16*this.bones.length);this.pose()}};c.SkinnedMesh.prototype=new c.Mesh;c.SkinnedMesh.prototype.constructor=c.SkinnedMesh;c.SkinnedMesh.prototype.addBone=function(a){a===void 0&&(a=new c.Bone(this));this.bones.push(a);return a};c.SkinnedMesh.prototype.updateMatrixWorld=function(a){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||a){this.parent?this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1}for(var a=0,g=this.children.length;a<g;a++){var b=this.children[a];b instanceof c.Bone?b.update(this.identityMatrix,!1):b.updateMatrixWorld(!0)}for(var g=this.bones.length,b=this.bones,h=this.boneMatrices,a=0;a<g;a++){b[a].skinMatrix.flattenToArrayOffset(h,a*16)}};c.SkinnedMesh.prototype.pose=function(){this.updateMatrixWorld(!0);for(var k,g=[],a=0;a<this.bones.length;a++){k=this.bones[a];var l=new c.Matrix4;l.getInverse(k.skinMatrix);g.push(l);k.skinMatrix.flattenToArrayOffset(this.boneMatrices,a*16)}if(this.geometry.skinVerticesA===void 0){this.geometry.skinVerticesA=[];this.geometry.skinVerticesB=[];for(k=0;k<this.geometry.skinIndices.length;k++){var a=this.geometry.vertices[k].position,f=this.geometry.skinIndices[k].x,b=this.geometry.skinIndices[k].y,l=new c.Vector3(a.x,a.y,a.z);this.geometry.skinVerticesA.push(g[f].multiplyVector3(l));l=new c.Vector3(a.x,a.y,a.z);this.geometry.skinVerticesB.push(g[b].multiplyVector3(l));this.geometry.skinWeights[k].x+this.geometry.skinWeights[k].y!==1&&(a=(1-(this.geometry.skinWeights[k].x+this.geometry.skinWeights[k].y))*0.5,this.geometry.skinWeights[k].x+=a,this.geometry.skinWeights[k].y+=a)}}};c.MorphAnimMesh=function(b,a){c.Mesh.call(this,b,a);this.duration=1000;this.mirroredLoop=!1;this.currentKeyframe=this.lastKeyframe=this.time=0;this.direction=1;this.directionBackwards=!1};c.MorphAnimMesh.prototype=new c.Mesh;c.MorphAnimMesh.prototype.constructor=c.MorphAnimMesh;c.MorphAnimMesh.prototype.updateAnimation=function(b){var a=this.duration/(this.geometry.morphTargets.length-1);this.time+=this.direction*b;if(this.mirroredLoop){if(this.time>this.duration||this.time<0){this.direction*=-1;if(this.time>this.duration){this.time=this.duration,this.directionBackwards=!0}if(this.time<0){this.time=0,this.directionBackwards=!1}}}else{this.time%=this.duration}b=c.Math.clamp(Math.floor(this.time/a),0,this.geometry.morphTargets.length-1);if(b!=this.currentKeyframe){this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[b]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=b}a=this.time%a/a;this.directionBackwards&&(a=1-a);this.morphTargetInfluences[this.currentKeyframe]=a;this.morphTargetInfluences[this.lastKeyframe]=1-a};c.Ribbon=function(b,a){c.Object3D.call(this);this.geometry=b;this.material=a};c.Ribbon.prototype=new c.Object3D;c.Ribbon.prototype.constructor=c.Ribbon;c.LOD=function(){c.Object3D.call(this);this.LODs=[]};c.LOD.prototype=new c.Object3D;c.LOD.prototype.constructor=c.LOD;c.LOD.prototype.supr=c.Object3D.prototype;c.LOD.prototype.addLevel=function(f,b){b===void 0&&(b=0);for(var b=Math.abs(b),a=0;a<this.LODs.length;a++){if(b<this.LODs[a].visibleAtDistance){break}}this.LODs.splice(a,0,{visibleAtDistance:b,object3D:f});this.add(f)};c.LOD.prototype.update=function(b){if(this.LODs.length>1){b.matrixWorldInverse.getInverse(b.matrixWorld);b=b.matrixWorldInverse;b=-(b.n31*this.position.x+b.n32*this.position.y+b.n33*this.position.z+b.n34);this.LODs[0].object3D.visible=!0;for(var a=1;a<this.LODs.length;a++){if(b>=this.LODs[a].visibleAtDistance){this.LODs[a-1].object3D.visible=!1,this.LODs[a].object3D.visible=!0}else{break}}for(;a<this.LODs.length;a++){this.LODs[a].object3D.visible=!1}}};c.Sprite=function(a){c.Object3D.call(this);this.color=a.color!==void 0?new c.Color(a.color):new c.Color(16777215);this.map=a.map instanceof c.Texture?a.map:c.ImageUtils.loadTexture(a.map);this.blending=a.blending!==void 0?a.blending:c.NormalBlending;this.useScreenCoordinates=a.useScreenCoordinates!==void 0?a.useScreenCoordinates:!0;this.mergeWith3D=a.mergeWith3D!==void 0?a.mergeWith3D:!this.useScreenCoordinates;this.affectedByDistance=a.affectedByDistance!==void 0?a.affectedByDistance:!this.useScreenCoordinates;this.scaleByViewport=a.scaleByViewport!==void 0?a.scaleByViewport:!this.affectedByDistance;this.alignment=a.alignment instanceof c.Vector2?a.alignment:c.SpriteAlignment.center;this.rotation3d=this.rotation;this.rotation=0;this.opacity=1;this.uvOffset=new c.Vector2(0,0);this.uvScale=new c.Vector2(1,1)};c.Sprite.prototype=new c.Object3D;c.Sprite.prototype.constructor=c.Sprite;c.Sprite.prototype.updateMatrix=function(){this.matrix.setPosition(this.position);this.rotation3d.set(0,0,this.rotation);this.matrix.setRotationFromEuler(this.rotation3d);if(this.scale.x!==1||this.scale.y!==1){this.matrix.scale(this.scale),this.boundRadiusScale=Math.max(this.scale.x,this.scale.y)}this.matrixWorldNeedsUpdate=!0};c.SpriteAlignment={};c.SpriteAlignment.topLeft=new c.Vector2(1,-1);c.SpriteAlignment.topCenter=new c.Vector2(0,-1);c.SpriteAlignment.topRight=new c.Vector2(-1,-1);c.SpriteAlignment.centerLeft=new c.Vector2(1,0);c.SpriteAlignment.center=new c.Vector2(0,0);c.SpriteAlignment.centerRight=new c.Vector2(-1,0);c.SpriteAlignment.bottomLeft=new c.Vector2(1,1);c.SpriteAlignment.bottomCenter=new c.Vector2(0,1);c.SpriteAlignment.bottomRight=new c.Vector2(-1,1);c.Scene=function(){c.Object3D.call(this);this.overrideMaterial=this.fog=null;this.matrixAutoUpdate=!1;this.objects=[];this.lights=[];this.__objectsAdded=[];this.__objectsRemoved=[]};c.Scene.prototype=new c.Object3D;c.Scene.prototype.constructor=c.Scene;c.Scene.prototype.addObject=function(b){if(b instanceof c.Light){this.lights.indexOf(b)===-1&&this.lights.push(b)}else{if(!(b instanceof c.Camera||b instanceof c.Bone)&&this.objects.indexOf(b)===-1){this.objects.push(b);this.__objectsAdded.push(b);var a=this.__objectsRemoved.indexOf(b);a!==-1&&this.__objectsRemoved.splice(a,1)}}for(a=0;a<b.children.length;a++){this.addObject(b.children[a])}};c.Scene.prototype.removeObject=function(b){if(b instanceof c.Light){var a=this.lights.indexOf(b);a!==-1&&this.lights.splice(a,1)}else{b instanceof c.Camera||(a=this.objects.indexOf(b),a!==-1&&(this.objects.splice(a,1),this.__objectsRemoved.push(b),a=this.__objectsAdded.indexOf(b),a!==-1&&this.__objectsAdded.splice(a,1)))}for(a=0;a<b.children.length;a++){this.removeObject(b.children[a])}};c.Fog=function(f,b,a){this.color=new c.Color(f);this.near=b!==void 0?b:1;this.far=a!==void 0?a:1000};c.FogExp2=function(b,a){this.color=new c.Color(b);this.density=a!==void 0?a:0.00025};c.DOMRenderer=function(){c.Renderer.call(this);var k=null,g=new c.Projector,a,l,f,b;this.domElement=document.createElement("div");this.setSize=function(h,e){a=h;l=e;f=a/2;b=l/2};this.render=function(e,h){var i,o,j,x,y,p,z,r;k=g.projectScene(e,h);i=0;for(o=k.length;i<o;i++){if(y=k[i],y instanceof c.RenderableParticle){z=y.x*f+f;r=y.y*b+b;j=0;for(x=y.material.length;j<x;j++){if(p=y.material[j],p instanceof c.ParticleDOMMaterial){p=p.domElement,p.style.left=z+"px",p.style.top=r+"px"}}}}}};c.CanvasRenderer=function(h){function l(z){if(au!=z){r.globalAlpha=au=z}}function j(z){if(I!=z){switch(z){case c.NormalBlending:r.globalCompositeOperation="source-over";break;case c.AdditiveBlending:r.globalCompositeOperation="lighter";break;case c.SubtractiveBlending:r.globalCompositeOperation="darker"}I=z}}function n(z){if(u!=z){r.strokeStyle=u=z}}function q(z){if(A!=z){r.fillStyle=A=z}}var p=this,o,ao,ap,K=new c.Projector,h=h||{},ar=h.canvas!==void 0?h.canvas:document.createElement("canvas"),s,w,i,B,r=ar.getContext("2d"),y=new c.Color(0),H=0,au=1,I=0,u=null,A=null,t=null,av=null,aw=null,at,aa,F,x,N=new c.RenderableVertex,Q=new c.RenderableVertex,aT,Y,W,ak,G,E,L,U,O,X,S,aq,T=new c.Color,R=new c.Color,az=new c.Color,aj=new c.Color,ag=new c.Color,g=[],ac=[],J,v,m,ay,an,al,ae,ai,a,f,Z=new c.Rectangle,b=new c.Rectangle,M=new c.Rectangle,V=!1,k=new c.Color,ad=new c.Color,ah=new c.Color,af=new c.Vector3,e,ab,ax,am,P,aS,h=16;e=document.createElement("canvas");e.width=e.height=2;ab=e.getContext("2d");ab.fillStyle="rgba(0,0,0,1)";ab.fillRect(0,0,2,2);ax=ab.getImageData(0,0,2,2);am=ax.data;P=document.createElement("canvas");P.width=P.height=h;aS=P.getContext("2d");aS.translate(-h/2,-h/2);aS.scale(h,h);h--;this.domElement=ar;this.sortElements=this.sortObjects=this.autoClear=!0;this.info={render:{vertices:0,faces:0}};this.setSize=function(z,C){s=z;w=C;i=Math.floor(s/2);B=Math.floor(w/2);ar.width=s;ar.height=w;Z.set(-i,-B,i,B);b.set(-i,-B,i,B);au=1;I=0;aw=av=t=A=u=null};this.setClearColor=function(z,C){y.copy(z);H=C;b.set(-i,-B,i,B)};this.setClearColorHex=function(z,C){y.setHex(z);H=C;b.set(-i,-B,i,B)};this.clear=function(){r.setTransform(1,0,0,-1,i,B);b.isEmpty()||(b.minSelf(Z),b.inflate(2),H<1&&r.clearRect(Math.floor(b.getX()),Math.floor(b.getY()),Math.floor(b.getWidth()),Math.floor(b.getHeight())),H>0&&(j(c.NormalBlending),l(1),q("rgba("+Math.floor(y.r*255)+","+Math.floor(y.g*255)+","+Math.floor(y.b*255)+","+H+")"),r.fillRect(Math.floor(b.getX()),Math.floor(b.getY()),Math.floor(b.getWidth()),Math.floor(b.getHeight()))),b.empty())};this.render=function(aK,aF){function aG(aZ){var aV,aW,aX,aY;k.setRGB(0,0,0);ad.setRGB(0,0,0);ah.setRGB(0,0,0);aV=0;for(aW=aZ.length;aV<aW;aV++){aX=aZ[aV],aY=aX.color,aX instanceof c.AmbientLight?(k.r+=aY.r,k.g+=aY.g,k.b+=aY.b):aX instanceof c.DirectionalLight?(ad.r+=aY.r,ad.g+=aY.g,ad.b+=aY.b):aX instanceof c.PointLight&&(ah.r+=aY.r,ah.g+=aY.g,ah.b+=aY.b)}}function D(a2,aV,aZ,a3){var aX,aW,a4,a1,aY,a0;aX=0;for(aW=a2.length;aX<aW;aX++){a4=a2[aX],a1=a4.color,a4 instanceof c.DirectionalLight?(aY=a4.matrixWorld.getPosition(),a0=aZ.dot(aY),a0<=0||(a0*=a4.intensity,a3.r+=a1.r*a0,a3.g+=a1.g*a0,a3.b+=a1.b*a0)):a4 instanceof c.PointLight&&(aY=a4.matrixWorld.getPosition(),a0=aZ.dot(af.sub(aY,aV).normalize()),a0<=0||(a0*=a4.distance==0?1:1-Math.min(aV.distanceTo(aY)/a4.distance,1),a0!=0&&(a0*=a4.intensity,a3.r+=a1.r*a0,a3.g+=a1.g*a0,a3.b+=a1.b*a0)))}}function aA(a0,aX,a3){l(a3.opacity);j(a3.blending);var aV,a1,a2,aW,aY,aZ;if(a3 instanceof c.ParticleBasicMaterial){if(a3.map){aW=a3.map.image,aY=aW.width>>1,aZ=aW.height>>1,a3=aX.scale.x*i,a2=aX.scale.y*B,aV=a3*aY,a1=a2*aZ,M.set(a0.x-aV,a0.y-a1,a0.x+aV,a0.y+a1),Z.intersects(M)&&(r.save(),r.translate(a0.x,a0.y),r.rotate(-aX.rotation),r.scale(a3,-a2),r.translate(-aY,-aZ),r.drawImage(aW,0,0),r.restore())}}else{a3 instanceof c.ParticleCanvasMaterial&&(aV=aX.scale.x*i,a1=aX.scale.y*B,M.set(a0.x-aV,a0.y-a1,a0.x+aV,a0.y+a1),Z.intersects(M)&&(n(a3.color.getContextStyle()),q(a3.color.getContextStyle()),r.save(),r.translate(a0.x,a0.y),r.rotate(-aX.rotation),r.scale(aV,a1),a3.program(r),r.restore()))}}function aH(aV,aY,aX,aW){l(aW.opacity);j(aW.blending);r.beginPath();r.moveTo(aV.positionScreen.x,aV.positionScreen.y);r.lineTo(aY.positionScreen.x,aY.positionScreen.y);r.closePath();if(aW instanceof c.LineBasicMaterial){aV=aW.linewidth;if(t!=aV){r.lineWidth=t=aV}aV=aW.linecap;if(av!=aV){r.lineCap=av=aV}aV=aW.linejoin;if(aw!=aV){r.lineJoin=aw=aV}n(aW.color.getContextStyle());r.stroke();M.inflate(aW.linewidth*2)}}function aM(a1,aV,aY,aX,a0,aZ,aW,a2){p.info.render.vertices+=3;p.info.render.faces++;l(a2.opacity);j(a2.blending);aT=a1.positionScreen.x;Y=a1.positionScreen.y;W=aV.positionScreen.x;ak=aV.positionScreen.y;G=aY.positionScreen.x;E=aY.positionScreen.y;aR(aT,Y,W,ak,G,E);if(a2 instanceof c.MeshBasicMaterial){if(a2.map){a2.map.mapping instanceof c.UVMapping&&(ay=aW.uvs[0],aL(aT,Y,W,ak,G,E,ay[aX].u,ay[aX].v,ay[a0].u,ay[a0].v,ay[aZ].u,ay[aZ].v,a2.map))}else{if(a2.envMap){if(a2.envMap.mapping instanceof c.SphericalReflectionMapping){a1=aF.matrixWorldInverse,af.copy(aW.vertexNormalsWorld[aX]),an=(af.x*a1.n11+af.y*a1.n12+af.z*a1.n13)*0.5+0.5,al=-(af.x*a1.n21+af.y*a1.n22+af.z*a1.n23)*0.5+0.5,af.copy(aW.vertexNormalsWorld[a0]),ae=(af.x*a1.n11+af.y*a1.n12+af.z*a1.n13)*0.5+0.5,ai=-(af.x*a1.n21+af.y*a1.n22+af.z*a1.n23)*0.5+0.5,af.copy(aW.vertexNormalsWorld[aZ]),a=(af.x*a1.n11+af.y*a1.n12+af.z*a1.n13)*0.5+0.5,f=-(af.x*a1.n21+af.y*a1.n22+af.z*a1.n23)*0.5+0.5,aL(aT,Y,W,ak,G,E,an,al,ae,ai,a,f,a2.envMap)}}else{a2.wireframe?aI(a2.color,a2.wireframeLinewidth,a2.wireframeLinecap,a2.wireframeLinejoin):aB(a2.color)}}}else{if(a2 instanceof c.MeshLambertMaterial){a2.map&&!a2.wireframe&&(a2.map.mapping instanceof c.UVMapping&&(ay=aW.uvs[0],aL(aT,Y,W,ak,G,E,ay[aX].u,ay[aX].v,ay[a0].u,ay[a0].v,ay[aZ].u,ay[aZ].v,a2.map)),j(c.SubtractiveBlending)),V?!a2.wireframe&&a2.shading==c.SmoothShading&&aW.vertexNormalsWorld.length==3?(R.r=az.r=aj.r=k.r,R.g=az.g=aj.g=k.g,R.b=az.b=aj.b=k.b,D(ap,aW.v1.positionWorld,aW.vertexNormalsWorld[0],R),D(ap,aW.v2.positionWorld,aW.vertexNormalsWorld[1],az),D(ap,aW.v3.positionWorld,aW.vertexNormalsWorld[2],aj),R.r=Math.max(0,Math.min(a2.color.r*R.r,1)),R.g=Math.max(0,Math.min(a2.color.g*R.g,1)),R.b=Math.max(0,Math.min(a2.color.b*R.b,1)),az.r=Math.max(0,Math.min(a2.color.r*az.r,1)),az.g=Math.max(0,Math.min(a2.color.g*az.g,1)),az.b=Math.max(0,Math.min(a2.color.b*az.b,1)),aj.r=Math.max(0,Math.min(a2.color.r*aj.r,1)),aj.g=Math.max(0,Math.min(a2.color.g*aj.g,1)),aj.b=Math.max(0,Math.min(a2.color.b*aj.b,1)),ag.r=(az.r+aj.r)*0.5,ag.g=(az.g+aj.g)*0.5,ag.b=(az.b+aj.b)*0.5,m=aN(R,az,aj,ag),C(aT,Y,W,ak,G,E,0,0,1,0,0,1,m)):(T.r=k.r,T.g=k.g,T.b=k.b,D(ap,aW.centroidWorld,aW.normalWorld,T),T.r=Math.max(0,Math.min(a2.color.r*T.r,1)),T.g=Math.max(0,Math.min(a2.color.g*T.g,1)),T.b=Math.max(0,Math.min(a2.color.b*T.b,1)),a2.wireframe?aI(T,a2.wireframeLinewidth,a2.wireframeLinecap,a2.wireframeLinejoin):aB(T)):a2.wireframe?aI(a2.color,a2.wireframeLinewidth,a2.wireframeLinecap,a2.wireframeLinejoin):aB(a2.color)}else{if(a2 instanceof c.MeshDepthMaterial){J=aF.near,v=aF.far,R.r=R.g=R.b=1-aD(a1.positionScreen.z,J,v),az.r=az.g=az.b=1-aD(aV.positionScreen.z,J,v),aj.r=aj.g=aj.b=1-aD(aY.positionScreen.z,J,v),ag.r=(az.r+aj.r)*0.5,ag.g=(az.g+aj.g)*0.5,ag.b=(az.b+aj.b)*0.5,m=aN(R,az,aj,ag),C(aT,Y,W,ak,G,E,0,0,1,0,0,1,m)}else{if(a2 instanceof c.MeshNormalMaterial){T.r=aJ(aW.normalWorld.x),T.g=aJ(aW.normalWorld.y),T.b=aJ(aW.normalWorld.z),a2.wireframe?aI(T,a2.wireframeLinewidth,a2.wireframeLinecap,a2.wireframeLinejoin):aB(T)}}}}}function aP(a0,a3,a1,aX,a2,aY,aW,aV,aZ){p.info.render.vertices+=4;p.info.render.faces++;l(aV.opacity);j(aV.blending);if(aV.map||aV.envMap){aM(a0,a3,aX,0,1,3,aW,aV,aZ),aM(a2,a1,aY,1,2,3,aW,aV,aZ)}else{if(aT=a0.positionScreen.x,Y=a0.positionScreen.y,W=a3.positionScreen.x,ak=a3.positionScreen.y,G=a1.positionScreen.x,E=a1.positionScreen.y,L=aX.positionScreen.x,U=aX.positionScreen.y,O=a2.positionScreen.x,X=a2.positionScreen.y,S=aY.positionScreen.x,aq=aY.positionScreen.y,aV instanceof c.MeshBasicMaterial){z(aT,Y,W,ak,G,E,L,U),aV.wireframe?aI(aV.color,aV.wireframeLinewidth,aV.wireframeLinecap,aV.wireframeLinejoin):aB(aV.color)}else{if(aV instanceof c.MeshLambertMaterial){V?!aV.wireframe&&aV.shading==c.SmoothShading&&aW.vertexNormalsWorld.length==4?(R.r=az.r=aj.r=ag.r=k.r,R.g=az.g=aj.g=ag.g=k.g,R.b=az.b=aj.b=ag.b=k.b,D(ap,aW.v1.positionWorld,aW.vertexNormalsWorld[0],R),D(ap,aW.v2.positionWorld,aW.vertexNormalsWorld[1],az),D(ap,aW.v4.positionWorld,aW.vertexNormalsWorld[3],aj),D(ap,aW.v3.positionWorld,aW.vertexNormalsWorld[2],ag),R.r=Math.max(0,Math.min(aV.color.r*R.r,1)),R.g=Math.max(0,Math.min(aV.color.g*R.g,1)),R.b=Math.max(0,Math.min(aV.color.b*R.b,1)),az.r=Math.max(0,Math.min(aV.color.r*az.r,1)),az.g=Math.max(0,Math.min(aV.color.g*az.g,1)),az.b=Math.max(0,Math.min(aV.color.b*az.b,1)),aj.r=Math.max(0,Math.min(aV.color.r*aj.r,1)),aj.g=Math.max(0,Math.min(aV.color.g*aj.g,1)),aj.b=Math.max(0,Math.min(aV.color.b*aj.b,1)),ag.r=Math.max(0,Math.min(aV.color.r*ag.r,1)),ag.g=Math.max(0,Math.min(aV.color.g*ag.g,1)),ag.b=Math.max(0,Math.min(aV.color.b*ag.b,1)),m=aN(R,az,aj,ag),aR(aT,Y,W,ak,L,U),C(aT,Y,W,ak,L,U,0,0,1,0,0,1,m),aR(O,X,G,E,S,aq),C(O,X,G,E,S,aq,1,0,1,1,0,1,m)):(T.r=k.r,T.g=k.g,T.b=k.b,D(ap,aW.centroidWorld,aW.normalWorld,T),T.r=Math.max(0,Math.min(aV.color.r*T.r,1)),T.g=Math.max(0,Math.min(aV.color.g*T.g,1)),T.b=Math.max(0,Math.min(aV.color.b*T.b,1)),z(aT,Y,W,ak,G,E,L,U),aV.wireframe?aI(T,aV.wireframeLinewidth,aV.wireframeLinecap,aV.wireframeLinejoin):aB(T)):(z(aT,Y,W,ak,G,E,L,U),aV.wireframe?aI(aV.color,aV.wireframeLinewidth,aV.wireframeLinecap,aV.wireframeLinejoin):aB(aV.color))}else{if(aV instanceof c.MeshNormalMaterial){T.r=aJ(aW.normalWorld.x),T.g=aJ(aW.normalWorld.y),T.b=aJ(aW.normalWorld.z),z(aT,Y,W,ak,G,E,L,U),aV.wireframe?aI(T,aV.wireframeLinewidth,aV.wireframeLinecap,aV.wireframeLinejoin):aB(T)}else{if(aV instanceof c.MeshDepthMaterial){J=aF.near,v=aF.far,R.r=R.g=R.b=1-aD(a0.positionScreen.z,J,v),az.r=az.g=az.b=1-aD(a3.positionScreen.z,J,v),aj.r=aj.g=aj.b=1-aD(aX.positionScreen.z,J,v),ag.r=ag.g=ag.b=1-aD(a1.positionScreen.z,J,v),m=aN(R,az,aj,ag),aR(aT,Y,W,ak,L,U),C(aT,Y,W,ak,L,U,0,0,1,0,0,1,m),aR(O,X,G,E,S,aq),C(O,X,G,E,S,aq,1,0,1,1,0,1,m)}}}}}}function aR(a0,aV,aW,aX,aZ,aY){r.beginPath();r.moveTo(a0,aV);r.lineTo(aW,aX);r.lineTo(aZ,aY);r.lineTo(a0,aV);r.closePath()}function z(a1,aW,a2,aV,aZ,aX,aY,a0){r.beginPath();r.moveTo(a1,aW);r.lineTo(a2,aV);r.lineTo(aZ,aX);r.lineTo(aY,a0);r.lineTo(a1,aW);r.closePath()}function aI(aY,aV,aW,aX){if(t!=aV){r.lineWidth=t=aV}if(av!=aW){r.lineCap=av=aW}if(aw!=aX){r.lineJoin=aw=aX}n(aY.getContextStyle());r.stroke();M.inflate(aV*2)}function aB(aV){q(aV.getContextStyle());r.fill()}function aL(a5,a6,a7,a9,ba,bb,aX,aV,aW,a3,aY,aZ,a4){if(a4.image.width!=0){if(a4.needsUpdate==!0||g[a4.id]==void 0){var a0=a4.wrapS==c.RepeatWrapping,a1=a4.wrapT==c.RepeatWrapping;g[a4.id]=r.createPattern(a4.image,a0&&a1?"repeat":a0&&!a1?"repeat-x":!a0&&a1?"repeat-y":"no-repeat");a4.needsUpdate=!1}q(g[a4.id]);var a0=a4.offset.x/a4.repeat.x,a1=a4.offset.y/a4.repeat.y,a8=a4.image.width*a4.repeat.x,a2=a4.image.height*a4.repeat.y,aX=(aX+a0)*a8,aV=(aV+a1)*a2,aW=(aW+a0)*a8,a3=(a3+a1)*a2,aY=(aY+a0)*a8,aZ=(aZ+a1)*a2;a7-=a5;a9-=a6;ba-=a5;bb-=a6;aW-=aX;a3-=aV;aY-=aX;aZ-=aV;a0=aW*aZ-aY*a3;if(a0==0){if(ac[a4.id]==void 0){a6=document.createElement("canvas"),a6.width=a4.image.width,a6.height=a4.image.height,a5=a6.getContext("2d"),a5.drawImage(a4.image,0,0),ac[a4.id]=a5.getImageData(0,0,a4.image.width,a4.image.height).data,delete a6}a6=ac[a4.id];aX=(Math.floor(aX)+Math.floor(aV)*a4.image.width)*4;T.setRGB(a6[aX]/255,a6[aX+1]/255,a6[aX+2]/255);aB(T)}else{a0=1/a0,a4=(aZ*a7-a3*ba)*a0,a3=(aZ*a9-a3*bb)*a0,a7=(aW*ba-aY*a7)*a0,a9=(aW*bb-aY*a9)*a0,a5=a5-a4*aX-a7*aV,aX=a6-a3*aX-a9*aV,r.save(),r.transform(a4,a3,a7,a9,a5,aX),r.fill(),r.restore()}}}function C(a5,a6,a7,a8,aW,a9,aV,a4,aX,a1,a0,aY,aZ){var a2,a3;a2=aZ.width-1;a3=aZ.height-1;aV*=a2;a4*=a3;aX*=a2;a1*=a3;a0*=a2;aY*=a3;a7-=a5;a8-=a6;aW-=a5;a9-=a6;aX-=aV;a1-=a4;a0-=aV;aY-=a4;a3=1/(aX*aY-a0*a1);a2=(aY*a7-a1*aW)*a3;a1=(aY*a8-a1*a9)*a3;a7=(aX*aW-a0*a7)*a3;a8=(aX*a9-a0*a8)*a3;a5=a5-a2*aV-a7*a4;a6=a6-a1*aV-a8*a4;r.save();r.transform(a2,a1,a7,a8,a5,a6);r.clip();r.drawImage(aZ,0,0);r.restore()}function aN(a3,a4,a5,a6){var aV=~~(a3.r*255),aY=~~(a3.g*255),a3=~~(a3.b*255),a1=~~(a4.r*255),aZ=~~(a4.g*255),a4=~~(a4.b*255),aW=~~(a5.r*255),aX=~~(a5.g*255),a5=~~(a5.b*255),a2=~~(a6.r*255),a0=~~(a6.g*255),a6=~~(a6.b*255);am[0]=aV<0?0:aV>255?255:aV;am[1]=aY<0?0:aY>255?255:aY;am[2]=a3<0?0:a3>255?255:a3;am[4]=a1<0?0:a1>255?255:a1;am[5]=aZ<0?0:aZ>255?255:aZ;am[6]=a4<0?0:a4>255?255:a4;am[8]=aW<0?0:aW>255?255:aW;am[9]=aX<0?0:aX>255?255:aX;am[10]=a5<0?0:a5>255?255:a5;am[12]=a2<0?0:a2>255?255:a2;am[13]=a0<0?0:a0>255?255:a0;am[14]=a6<0?0:a6>255?255:a6;ab.putImageData(ax,0,0);aS.drawImage(e,0,0);return P}function aD(aX,aV,aW){aX=(aX-aV)/(aW-aV);return aX*aX*(3-2*aX)}function aJ(aV){aV=(aV+1)*0.5;return aV<0?0:aV>1?1:aV}function aO(aZ,aV){var aW=aV.x-aZ.x,aX=aV.y-aZ.y,aY=aW*aW+aX*aX;aY!=0&&(aY=1/Math.sqrt(aY),aW*=aY,aX*=aY,aV.x+=aW,aV.y+=aX,aZ.x-=aW,aZ.y-=aX)}var aQ,aC,aU,aE;this.autoClear?this.clear():r.setTransform(1,0,0,-1,i,B);p.info.render.vertices=0;p.info.render.faces=0;o=K.projectScene(aK,aF,this.sortElements);ao=o.elements;ap=o.lights;(V=ap.length>0)&&aG(ap);aQ=0;for(aC=ao.length;aQ<aC;aQ++){if(aU=ao[aQ],aE=aU.material,aE=aE instanceof c.MeshFaceMaterial?aU.faceMaterial:aE,!(aE==null||aE.opacity==0)){M.empty();if(aU instanceof c.RenderableParticle){at=aU,at.x*=i,at.y*=B,aA(at,aU,aE,aK)}else{if(aU instanceof c.RenderableLine){at=aU.v1,aa=aU.v2,at.positionScreen.x*=i,at.positionScreen.y*=B,aa.positionScreen.x*=i,aa.positionScreen.y*=B,M.addPoint(at.positionScreen.x,at.positionScreen.y),M.addPoint(aa.positionScreen.x,aa.positionScreen.y),Z.intersects(M)&&aH(at,aa,aU,aE,aK)}else{if(aU instanceof c.RenderableFace3){at=aU.v1,aa=aU.v2,F=aU.v3,at.positionScreen.x*=i,at.positionScreen.y*=B,aa.positionScreen.x*=i,aa.positionScreen.y*=B,F.positionScreen.x*=i,F.positionScreen.y*=B,aE.overdraw&&(aO(at.positionScreen,aa.positionScreen),aO(aa.positionScreen,F.positionScreen),aO(F.positionScreen,at.positionScreen)),M.add3Points(at.positionScreen.x,at.positionScreen.y,aa.positionScreen.x,aa.positionScreen.y,F.positionScreen.x,F.positionScreen.y),Z.intersects(M)&&aM(at,aa,F,0,1,2,aU,aE,aK)}else{if(aU instanceof c.RenderableFace4){at=aU.v1,aa=aU.v2,F=aU.v3,x=aU.v4,at.positionScreen.x*=i,at.positionScreen.y*=B,aa.positionScreen.x*=i,aa.positionScreen.y*=B,F.positionScreen.x*=i,F.positionScreen.y*=B,x.positionScreen.x*=i,x.positionScreen.y*=B,N.positionScreen.copy(aa.positionScreen),Q.positionScreen.copy(x.positionScreen),aE.overdraw&&(aO(at.positionScreen,aa.positionScreen),aO(aa.positionScreen,x.positionScreen),aO(x.positionScreen,at.positionScreen),aO(F.positionScreen,N.positionScreen),aO(F.positionScreen,Q.positionScreen)),M.addPoint(at.positionScreen.x,at.positionScreen.y),M.addPoint(aa.positionScreen.x,aa.positionScreen.y),M.addPoint(F.positionScreen.x,F.positionScreen.y),M.addPoint(x.positionScreen.x,x.positionScreen.y),Z.intersects(M)&&aP(at,aa,F,x,N,Q,aU,aE,aK)}}}}b.addRectangle(M)}}r.setTransform(1,0,0,1,0,0)}};c.SVGRenderer=function(){function t(D,H,I,L){var N,G,M,j,z,C;N=0;for(G=D.length;N<G;N++){M=D[N],j=M.color,M instanceof c.DirectionalLight?(z=M.matrixWorld.getPosition(),C=I.dot(z),C<=0||(C*=M.intensity,L.r+=j.r*C,L.g+=j.g*C,L.b+=j.b*C)):M instanceof c.PointLight&&(z=M.matrixWorld.getPosition(),C=I.dot(h.sub(z,H).normalize()),C<=0||(C*=M.distance==0?1:1-Math.min(H.distanceTo(z)/M.distance,1),C!=0&&(C*=M.intensity,L.r+=j.r*C,L.g+=j.g*C,L.b+=j.b*C)))}}function g(j){r[j]==null&&(r[j]=document.createElementNS("http://www.w3.org/2000/svg","path"),s==0&&r[j].setAttribute("shape-rendering","crispEdges"));return r[j]}function v(j){j=(j+1)*0.5;return j<0?0:j>1?1:j}var i=this,q,p,n,y=new c.Projector,R=document.createElementNS("http://www.w3.org/2000/svg","svg"),A,U,x,E,B,ac,w,J,a=new c.Rectangle,l=new c.Rectangle,e=!1,K=new c.Color,f=new c.Color,F=new c.Color,m=new c.Color,o,h=new c.Vector3,r=[],ad=[],b,k,u,s=1;this.domElement=R;this.sortElements=this.sortObjects=this.autoClear=!0;this.info={render:{vertices:0,faces:0}};this.setQuality=function(j){switch(j){case"high":s=1;break;case"low":s=0}};this.setSize=function(z,j){A=z;U=j;x=A/2;E=U/2;R.setAttribute("viewBox",-x+" "+-E+" "+A+" "+U);R.setAttribute("width",A);R.setAttribute("height",U);a.set(-x,-E,x,E)};this.clear=function(){for(;R.childNodes.length>0;){R.removeChild(R.childNodes[0])}};this.render=function(D,H){var N,G,L,M;this.autoClear&&this.clear();i.info.render.vertices=0;i.info.render.faces=0;q=y.projectScene(D,H,this.sortElements);p=q.elements;n=q.lights;u=k=0;if(e=n.length>0){f.setRGB(0,0,0);F.setRGB(0,0,0);m.setRGB(0,0,0);N=0;for(G=n.length;N<G;N++){M=n[N],L=M.color,M instanceof c.AmbientLight?(f.r+=L.r,f.g+=L.g,f.b+=L.b):M instanceof c.DirectionalLight?(F.r+=L.r,F.g+=L.g,F.b+=L.b):M instanceof c.PointLight&&(m.r+=L.r,m.g+=L.g,m.b+=L.b)}}N=0;for(G=p.length;N<G;N++){if(L=p[N],M=L.material,M=M instanceof c.MeshFaceMaterial?L.faceMaterial:M,!(M==null||M.opacity==0)){if(l.empty(),L instanceof c.RenderableParticle){B=L,B.x*=x,B.y*=-E}else{if(L instanceof c.RenderableLine){if(B=L.v1,ac=L.v2,B.positionScreen.x*=x,B.positionScreen.y*=-E,ac.positionScreen.x*=x,ac.positionScreen.y*=-E,l.addPoint(B.positionScreen.x,B.positionScreen.y),l.addPoint(ac.positionScreen.x,ac.positionScreen.y),a.intersects(l)){L=B;var z=ac,C=u++;ad[C]==null&&(ad[C]=document.createElementNS("http://www.w3.org/2000/svg","line"),s==0&&ad[C].setAttribute("shape-rendering","crispEdges"));b=ad[C];b.setAttribute("x1",L.positionScreen.x);b.setAttribute("y1",L.positionScreen.y);b.setAttribute("x2",z.positionScreen.x);b.setAttribute("y2",z.positionScreen.y);M instanceof c.LineBasicMaterial&&(b.setAttribute("style","fill: none; stroke: "+M.color.getContextStyle()+"; stroke-width: "+M.linewidth+"; stroke-opacity: "+M.opacity+"; stroke-linecap: "+M.linecap+"; stroke-linejoin: "+M.linejoin),R.appendChild(b))}}else{if(L instanceof c.RenderableFace3){if(B=L.v1,ac=L.v2,w=L.v3,B.positionScreen.x*=x,B.positionScreen.y*=-E,ac.positionScreen.x*=x,ac.positionScreen.y*=-E,w.positionScreen.x*=x,w.positionScreen.y*=-E,l.addPoint(B.positionScreen.x,B.positionScreen.y),l.addPoint(ac.positionScreen.x,ac.positionScreen.y),l.addPoint(w.positionScreen.x,w.positionScreen.y),a.intersects(l)){var z=B,C=ac,j=w;i.info.render.vertices+=3;i.info.render.faces++;b=g(k++);b.setAttribute("d","M "+z.positionScreen.x+" "+z.positionScreen.y+" L "+C.positionScreen.x+" "+C.positionScreen.y+" L "+j.positionScreen.x+","+j.positionScreen.y+"z");M instanceof c.MeshBasicMaterial?K.copy(M.color):M instanceof c.MeshLambertMaterial?e?(K.r=f.r,K.g=f.g,K.b=f.b,t(n,L.centroidWorld,L.normalWorld,K),K.r=Math.max(0,Math.min(M.color.r*K.r,1)),K.g=Math.max(0,Math.min(M.color.g*K.g,1)),K.b=Math.max(0,Math.min(M.color.b*K.b,1))):K.copy(M.color):M instanceof c.MeshDepthMaterial?(o=1-M.__2near/(M.__farPlusNear-L.z*M.__farMinusNear),K.setRGB(o,o,o)):M instanceof c.MeshNormalMaterial&&K.setRGB(v(L.normalWorld.x),v(L.normalWorld.y),v(L.normalWorld.z));M.wireframe?b.setAttribute("style","fill: none; stroke: "+K.getContextStyle()+"; stroke-width: "+M.wireframeLinewidth+"; stroke-opacity: "+M.opacity+"; stroke-linecap: "+M.wireframeLinecap+"; stroke-linejoin: "+M.wireframeLinejoin):b.setAttribute("style","fill: "+K.getContextStyle()+"; fill-opacity: "+M.opacity);R.appendChild(b)}}else{if(L instanceof c.RenderableFace4&&(B=L.v1,ac=L.v2,w=L.v3,J=L.v4,B.positionScreen.x*=x,B.positionScreen.y*=-E,ac.positionScreen.x*=x,ac.positionScreen.y*=-E,w.positionScreen.x*=x,w.positionScreen.y*=-E,J.positionScreen.x*=x,J.positionScreen.y*=-E,l.addPoint(B.positionScreen.x,B.positionScreen.y),l.addPoint(ac.positionScreen.x,ac.positionScreen.y),l.addPoint(w.positionScreen.x,w.positionScreen.y),l.addPoint(J.positionScreen.x,J.positionScreen.y),a.intersects(l))){var z=B,C=ac,j=w,I=J;i.info.render.vertices+=4;i.info.render.faces++;b=g(k++);b.setAttribute("d","M "+z.positionScreen.x+" "+z.positionScreen.y+" L "+C.positionScreen.x+" "+C.positionScreen.y+" L "+j.positionScreen.x+","+j.positionScreen.y+" L "+I.positionScreen.x+","+I.positionScreen.y+"z");M instanceof c.MeshBasicMaterial?K.copy(M.color):M instanceof c.MeshLambertMaterial?e?(K.r=f.r,K.g=f.g,K.b=f.b,t(n,L.centroidWorld,L.normalWorld,K),K.r=Math.max(0,Math.min(M.color.r*K.r,1)),K.g=Math.max(0,Math.min(M.color.g*K.g,1)),K.b=Math.max(0,Math.min(M.color.b*K.b,1))):K.copy(M.color):M instanceof c.MeshDepthMaterial?(o=1-M.__2near/(M.__farPlusNear-L.z*M.__farMinusNear),K.setRGB(o,o,o)):M instanceof c.MeshNormalMaterial&&K.setRGB(v(L.normalWorld.x),v(L.normalWorld.y),v(L.normalWorld.z));M.wireframe?b.setAttribute("style","fill: none; stroke: "+K.getContextStyle()+"; stroke-width: "+M.wireframeLinewidth+"; stroke-opacity: "+M.opacity+"; stroke-linecap: "+M.wireframeLinecap+"; stroke-linejoin: "+M.wireframeLinejoin):b.setAttribute("style","fill: "+K.getContextStyle()+"; fill-opacity: "+M.opacity);R.appendChild(b)}}}}}}}};c.ShaderChunk={fog_pars_fragment:"#ifdef USE_FOG\nuniform vec3 fogColor;\n#ifdef FOG_EXP2\nuniform float fogDensity;\n#else\nuniform float fogNear;\nuniform float fogFar;\n#endif\n#endif",fog_fragment:"#ifdef USE_FOG\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n#ifdef FOG_EXP2\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n#else\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n#endif\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float reflectivity;\nuniform samplerCube envMap;\nuniform float flipEnvMap;\nuniform int combine;\n#endif",envmap_fragment:"#ifdef USE_ENVMAP\nvec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * vReflect.x, vReflect.yz ) );\n#ifdef GAMMA_INPUT\ncubeColor.xyz *= cubeColor.xyz;\n#endif\nif ( combine == 1 ) {\ngl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, reflectivity );\n} else {\ngl_FragColor.xyz = gl_FragColor.xyz * cubeColor.xyz;\n}\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float refractionRatio;\nuniform bool useRefract;\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = mat3( objectMatrix[ 0 ].xyz, objectMatrix[ 1 ].xyz, objectMatrix[ 2 ].xyz ) * normal;\nif ( useRefract ) {\nvReflect = refract( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ), refractionRatio );\n} else {\nvReflect = reflect( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ) );\n}\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\nuniform sampler2D map;\n#endif",map_particle_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, gl_PointCoord );\n#endif",map_pars_vertex:"#ifdef USE_MAP\nvarying vec2 vUv;\nuniform vec4 offsetRepeat;\n#endif",map_pars_fragment:"#ifdef USE_MAP\nvarying vec2 vUv;\nuniform sampler2D map;\n#endif",map_vertex:"#ifdef USE_MAP\nvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",map_fragment:"#ifdef USE_MAP\n#ifdef GAMMA_INPUT\nvec4 texelColor = texture2D( map, vUv );\ntexelColor.xyz *= texelColor.xyz;\ngl_FragColor = gl_FragColor * texelColor;\n#else\ngl_FragColor = gl_FragColor * texture2D( map, vUv );\n#endif\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\nuniform sampler2D lightMap;\n#endif",lightmap_pars_vertex:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\ngl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n#endif",lightmap_vertex:"#ifdef USE_LIGHTMAP\nvUv2 = uv2;\n#endif",lights_lambert_pars_vertex:"uniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif",lights_lambert_vertex:"vLightWeighting = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nfloat directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ i ] * directionalLightWeighting;\n}\n#endif\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat pointLightWeighting = max( dot( transformedNormal, lVector ), 0.0 );\nvLightWeighting += pointLightColor[ i ] * pointLightWeighting * lDistance;\n}\n#endif\nvLightWeighting = vLightWeighting * diffuse + ambient * ambientLightColor;",lights_phong_pars_vertex:"#if MAX_POINT_LIGHTS > 0\n#ifndef PHONG_PER_PIXEL\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#endif",lights_phong_vertex:"#if MAX_POINT_LIGHTS > 0\n#ifndef PHONG_PER_PIXEL\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nvPointLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#endif",lights_phong_pars_fragment:"uniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n#ifdef PHONG_PER_PIXEL\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#else\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#endif\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",lights_phong_fragment:"vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse  = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n#ifdef PHONG_PER_PIXEL\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz + vViewPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\n#else\nvec3 lVector = normalize( vPointLight[ i ].xyz );\nfloat lDistance = vPointLight[ i ].w;\n#endif\nvec3 pointHalfVector = normalize( lVector + viewPosition );\nfloat pointDistance = lDistance;\nfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\nfloat pointDiffuseWeight = max( dot( normal, lVector ), 0.0 );\nfloat pointSpecularWeight = pow( pointDotNormalHalf, shininess );\n#ifdef PHYSICALLY_BASED_SHADING\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( dot( lVector, pointHalfVector ), 5.0 );\npointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance;\n#else\npointSpecular += specular * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance;\n#endif\npointDiffuse  += diffuse * pointLightColor[ i ] * pointDiffuseWeight * pointDistance;\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse  = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nvec3 dirHalfVector = normalize( lDirection.xyz + viewPosition );\nfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\nfloat dirSpecularWeight = pow( dirDotNormalHalf, shininess );\n#ifdef PHYSICALLY_BASED_SHADING\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( dot( dirVector, dirHalfVector ), 5.0 );\ndirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;\n#else\ndirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;\n#endif\ndirDiffuse  += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;\n}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\n#ifdef METAL\ngl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient + totalSpecular );\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_fragment:"#ifdef USE_COLOR\ngl_FragColor = gl_FragColor * vec4( vColor, opacity );\n#endif",color_pars_vertex:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n#ifdef GAMMA_INPUT\nvColor = color * color;\n#else\nvColor = color;\n#endif\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\nuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n#endif",skinning_vertex:"#ifdef USE_SKINNING\ngl_Position  = ( boneGlobalMatrices[ int( skinIndex.x ) ] * skinVertexA ) * skinWeight.x;\ngl_Position += ( boneGlobalMatrices[ int( skinIndex.y ) ] * skinVertexB ) * skinWeight.y;\ngl_Position  = projectionMatrix * viewMatrix * objectMatrix * gl_Position;\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\nuniform float morphTargetInfluences[ 8 ];\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\nvec3 morphed = vec3( 0.0, 0.0, 0.0 );\nmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\nmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\nmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\nmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\nmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\nmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\nmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\nmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\nmorphed += position;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( morphed, 1.0 );\n#endif",default_vertex:"#ifndef USE_MORPHTARGETS\n#ifndef USE_SKINNING\ngl_Position = projectionMatrix * mvPosition;\n#endif\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\nuniform sampler2D shadowMap[ MAX_SHADOWS ];\nuniform float shadowDarkness;\nuniform float shadowBias;\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nfloat unpackDepth( const in vec4 rgba_depth ) {\nconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\nfloat depth = dot( rgba_depth, bit_shift );\nreturn depth;\n}\n#endif",shadowmap_fragment:"#ifdef USE_SHADOWMAP\n#ifdef SHADOWMAP_SOFT\nconst float xPixelOffset = 1.0 / SHADOWMAP_WIDTH;\nconst float yPixelOffset = 1.0 / SHADOWMAP_HEIGHT;\n#endif\nvec3 shadowColor = vec3( 1.0 );\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\nshadowCoord.z += shadowBias;\nif ( shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0 ) {\n#ifdef SHADOWMAP_SOFT\nfloat shadow = 0.0;\nfor ( float y = -1.25; y <= 1.25; y += 1.25 )\nfor ( float x = -1.25; x <= 1.25; x += 1.25 ) {\nvec4 rgbaDepth = texture2D( shadowMap[ i ], vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy );\nfloat fDepth = unpackDepth( rgbaDepth );\nif ( fDepth < shadowCoord.z )\nshadow += 1.0;\n}\nshadow /= 9.0;\nshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness * shadow ) );\n#else\nvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\nfloat fDepth = unpackDepth( rgbaDepth );\nif ( fDepth < shadowCoord.z )\nshadowColor = shadowColor * vec3( shadowDarkness );\n#endif\n}\n}\n#ifdef GAMMA_OUTPUT\nshadowColor *= shadowColor;\n#endif\ngl_FragColor.xyz = gl_FragColor.xyz * shadowColor;\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nuniform mat4 shadowMatrix[ MAX_SHADOWS ];\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvShadowCoord[ i ] = shadowMatrix[ i ] * objectMatrix * vec4( position, 1.0 );\n}\n#endif",alphatest_fragment:"#ifdef ALPHATEST\nif ( gl_FragColor.a < ALPHATEST ) discard;\n#endif",linear_to_gamma_fragment:"#ifdef GAMMA_OUTPUT\ngl_FragColor.xyz = sqrt( gl_FragColor.xyz );\n#endif"};c.UniformsUtils={merge:function(b){var g,i,j,a={};for(g=0;g<b.length;g++){for(i in j=this.clone(b[g]),j){a[i]=j[i]}}return a},clone:function(b){var g,i,j,a={};for(g in b){for(i in a[g]={},b[g]){j=b[g][i],a[g][i]=j instanceof c.Color||j instanceof c.Vector2||j instanceof c.Vector3||j instanceof c.Vector4||j instanceof c.Matrix4||j instanceof c.Texture?j.clone():j instanceof Array?j.slice():j}}return a}};c.UniformsLib={common:{diffuse:{type:"c",value:new c.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:0,texture:null},offsetRepeat:{type:"v4",value:new c.Vector4(0,0,1,1)},lightMap:{type:"t",value:2,texture:null},envMap:{type:"t",value:1,texture:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:0.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},fog:{fogDensity:{type:"f",value:0.00025},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2000},fogColor:{type:"c",value:new c.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new c.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:0,texture:null},fogDensity:{type:"f",value:0.00025},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2000},fogColor:{type:"c",value:new c.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:6,texture:[]},shadowMatrix:{type:"m4v",value:[]},shadowBias:{type:"f",value:0.0039},shadowDarkness:{type:"f",value:0.2}}};c.ShaderLib={sprite:{vertexShader:"uniform int useScreenCoordinates;\nuniform int affectedByDistance;\nuniform vec3 screenPosition;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 alignment;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position + alignment;\nvec2 rotatedPosition;\nrotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;\nrotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;\nvec4 finalPosition;\nif( useScreenCoordinates != 0 ) {\nfinalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );\n} else {\nfinalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition * ( affectedByDistance == 1 ? 1.0 : finalPosition.z );\n}\ngl_Position = finalPosition;\n}",fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nvarying vec2 vUV;\nvoid main() {\nvec4 texture = texture2D( map, vUV );\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\n}"},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2000},opacity:{type:"f",value:1}},vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float mNear;\nuniform float mFar;\nuniform float opacity;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat color = 1.0 - smoothstep( mNear, mFar, depth );\ngl_FragColor = vec4( vec3( color ), opacity );\n}"},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:"varying vec3 vNormal;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvNormal = normalize( normalMatrix * normal );\ngl_Position = projectionMatrix * mvPosition;\n}",fragmentShader:"uniform float opacity;\nvarying vec3 vNormal;\nvoid main() {\ngl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\n}"},basic:{uniforms:c.UniformsUtils.merge([c.UniformsLib.common,c.UniformsLib.fog,c.UniformsLib.shadowmap]),vertexShader:[c.ShaderChunk.map_pars_vertex,c.ShaderChunk.lightmap_pars_vertex,c.ShaderChunk.envmap_pars_vertex,c.ShaderChunk.color_pars_vertex,c.ShaderChunk.skinning_pars_vertex,c.ShaderChunk.morphtarget_pars_vertex,c.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",c.ShaderChunk.map_vertex,c.ShaderChunk.lightmap_vertex,c.ShaderChunk.envmap_vertex,c.ShaderChunk.color_vertex,c.ShaderChunk.skinning_vertex,c.ShaderChunk.morphtarget_vertex,c.ShaderChunk.default_vertex,c.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",c.ShaderChunk.color_pars_fragment,c.ShaderChunk.map_pars_fragment,c.ShaderChunk.lightmap_pars_fragment,c.ShaderChunk.envmap_pars_fragment,c.ShaderChunk.fog_pars_fragment,c.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );",c.ShaderChunk.map_fragment,c.ShaderChunk.alphatest_fragment,c.ShaderChunk.lightmap_fragment,c.ShaderChunk.color_fragment,c.ShaderChunk.envmap_fragment,c.ShaderChunk.shadowmap_fragment,c.ShaderChunk.linear_to_gamma_fragment,c.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:c.UniformsUtils.merge([c.UniformsLib.common,c.UniformsLib.fog,c.UniformsLib.lights,c.UniformsLib.shadowmap,{ambient:{type:"c",value:new c.Color(328965)}}]),vertexShader:["varying vec3 vLightWeighting;",c.ShaderChunk.map_pars_vertex,c.ShaderChunk.lightmap_pars_vertex,c.ShaderChunk.envmap_pars_vertex,c.ShaderChunk.lights_lambert_pars_vertex,c.ShaderChunk.color_pars_vertex,c.ShaderChunk.skinning_pars_vertex,c.ShaderChunk.morphtarget_pars_vertex,c.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",c.ShaderChunk.map_vertex,c.ShaderChunk.lightmap_vertex,c.ShaderChunk.envmap_vertex,c.ShaderChunk.color_vertex,"vec3 transformedNormal = normalize( normalMatrix * normal );",c.ShaderChunk.lights_lambert_vertex,c.ShaderChunk.skinning_vertex,c.ShaderChunk.morphtarget_vertex,c.ShaderChunk.default_vertex,c.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;\nvarying vec3 vLightWeighting;",c.ShaderChunk.color_pars_fragment,c.ShaderChunk.map_pars_fragment,c.ShaderChunk.lightmap_pars_fragment,c.ShaderChunk.envmap_pars_fragment,c.ShaderChunk.fog_pars_fragment,c.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );",c.ShaderChunk.map_fragment,c.ShaderChunk.alphatest_fragment,"gl_FragColor.xyz = gl_FragColor.xyz * vLightWeighting;",c.ShaderChunk.lightmap_fragment,c.ShaderChunk.color_fragment,c.ShaderChunk.envmap_fragment,c.ShaderChunk.shadowmap_fragment,c.ShaderChunk.linear_to_gamma_fragment,c.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:c.UniformsUtils.merge([c.UniformsLib.common,c.UniformsLib.fog,c.UniformsLib.lights,c.UniformsLib.shadowmap,{ambient:{type:"c",value:new c.Color(328965)},specular:{type:"c",value:new c.Color(1118481)},shininess:{type:"f",value:30}}]),vertexShader:["varying vec3 vViewPosition;\nvarying vec3 vNormal;",c.ShaderChunk.map_pars_vertex,c.ShaderChunk.lightmap_pars_vertex,c.ShaderChunk.envmap_pars_vertex,c.ShaderChunk.lights_phong_pars_vertex,c.ShaderChunk.color_pars_vertex,c.ShaderChunk.skinning_pars_vertex,c.ShaderChunk.morphtarget_pars_vertex,c.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",c.ShaderChunk.map_vertex,c.ShaderChunk.lightmap_vertex,c.ShaderChunk.envmap_vertex,c.ShaderChunk.color_vertex,"#ifndef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\n#endif\nvViewPosition = -mvPosition.xyz;\nvec3 transformedNormal = normalMatrix * normal;\nvNormal = transformedNormal;",c.ShaderChunk.lights_phong_vertex,c.ShaderChunk.skinning_vertex,c.ShaderChunk.morphtarget_vertex,c.ShaderChunk.default_vertex,c.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform vec3 ambient;\nuniform vec3 specular;\nuniform float shininess;",c.ShaderChunk.color_pars_fragment,c.ShaderChunk.map_pars_fragment,c.ShaderChunk.lightmap_pars_fragment,c.ShaderChunk.envmap_pars_fragment,c.ShaderChunk.fog_pars_fragment,c.ShaderChunk.lights_phong_pars_fragment,c.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );",c.ShaderChunk.map_fragment,c.ShaderChunk.alphatest_fragment,c.ShaderChunk.lights_phong_fragment,c.ShaderChunk.lightmap_fragment,c.ShaderChunk.color_fragment,c.ShaderChunk.envmap_fragment,c.ShaderChunk.shadowmap_fragment,c.ShaderChunk.linear_to_gamma_fragment,c.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:c.UniformsUtils.merge([c.UniformsLib.particle,c.UniformsLib.shadowmap]),vertexShader:["uniform float size;\nuniform float scale;",c.ShaderChunk.color_pars_vertex,c.ShaderChunk.shadowmap_pars_vertex,"void main() {",c.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n#ifdef USE_SIZEATTENUATION\ngl_PointSize = size * ( scale / length( mvPosition.xyz ) );\n#else\ngl_PointSize = size;\n#endif\ngl_Position = projectionMatrix * mvPosition;",c.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;\nuniform float opacity;",c.ShaderChunk.color_pars_fragment,c.ShaderChunk.map_particle_pars_fragment,c.ShaderChunk.fog_pars_fragment,c.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( psColor, opacity );",c.ShaderChunk.map_particle_fragment,c.ShaderChunk.alphatest_fragment,c.ShaderChunk.color_fragment,c.ShaderChunk.shadowmap_fragment,c.ShaderChunk.fog_fragment,"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[c.ShaderChunk.morphtarget_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",c.ShaderChunk.morphtarget_vertex,c.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:"vec4 pack_depth( const in float depth ) {\nconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\nconst vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\nvec4 res = fract( depth * bit_shift );\nres -= res.xxyz * bit_mask;\nreturn res;\n}\nvoid main() {\ngl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );\n}"}};c.WebGLRenderer=function(h){function l(aB,aC){var aD=aB.vertices.length,z=aC.material;if(z.attributes){if(aB.__webglCustomAttributesList===void 0){aB.__webglCustomAttributesList=[]}for(var aA in z.attributes){var D=z.attributes[aA];if(!D.__webglInitialized||D.createUniqueBuffers){D.__webglInitialized=!0;var C=1;D.type==="v2"?C=2:D.type==="v3"?C=3:D.type==="v4"?C=4:D.type==="c"&&(C=3);D.size=C;D.array=new Float32Array(aD*C);D.buffer=at.createBuffer();D.buffer.belongsToAttribute=aA;D.needsUpdate=!0}aB.__webglCustomAttributesList.push(D)}}}function j(z,C){if(z.material&&!(z.material instanceof c.MeshFaceMaterial)){return z.material}else{if(C.materialIndex>=0){return z.geometry.materials[C.materialIndex]}}}function n(z){if(z instanceof c.MeshBasicMaterial&&!z.envMap||z instanceof c.MeshDepthMaterial){return !1}return z&&z.shading!==void 0&&z.shading===c.SmoothShading?c.SmoothShading:c.FlatShading}function s(z){if(z.vertexColors){return z.vertexColors}return !1}function p(z){if(z.map||z.lightMap||z instanceof c.ShaderMaterial){return !0}return !1}function o(aF,aH,aL){var aJ,aC,aB,D,aD=aF.vertices;D=aD.length;var aE=aF.colors,z=aE.length,aG=aF.__vertexArray,C=aF.__colorArray,aK=aF.__sortArray,aI=aF.__dirtyVertices,aA=aF.__dirtyColors,aM=aF.__webglCustomAttributesList;if(aL.sortParticles){X.multiplySelf(aL.matrixWorld);for(aJ=0;aJ<D;aJ++){aC=aD[aJ].position,aj.copy(aC),X.multiplyVector3(aj),aK[aJ]=[aj.z,aJ]}aK.sort(function(aN,aO){return aO[0]-aN[0]});for(aJ=0;aJ<D;aJ++){aC=aD[aK[aJ][1]].position,aB=aJ*3,aG[aB]=aC.x,aG[aB+1]=aC.y,aG[aB+2]=aC.z}for(aJ=0;aJ<z;aJ++){aB=aJ*3,aC=aE[aK[aJ][1]],C[aB]=aC.r,C[aB+1]=aC.g,C[aB+2]=aC.b}if(aM){aE=0;for(z=aM.length;aE<z;aE++){if(aD=aM[aE],aD.boundTo===void 0||aD.boundTo==="vertices"){if(aB=0,aC=aD.value.length,aD.size===1){for(aJ=0;aJ<aC;aJ++){D=aK[aJ][1],aD.array[aJ]=aD.value[D]}}else{if(aD.size===2){for(aJ=0;aJ<aC;aJ++){D=aK[aJ][1],D=aD.value[D],aD.array[aB]=D.x,aD.array[aB+1]=D.y,aB+=2}}else{if(aD.size===3){if(aD.type==="c"){for(aJ=0;aJ<aC;aJ++){D=aK[aJ][1],D=aD.value[D],aD.array[aB]=D.r,aD.array[aB+1]=D.g,aD.array[aB+2]=D.b,aB+=3}}else{for(aJ=0;aJ<aC;aJ++){D=aK[aJ][1],D=aD.value[D],aD.array[aB]=D.x,aD.array[aB+1]=D.y,aD.array[aB+2]=D.z,aB+=3}}}else{if(aD.size===4){for(aJ=0;aJ<aC;aJ++){D=aK[aJ][1],D=aD.value[D],aD.array[aB]=D.x,aD.array[aB+1]=D.y,aD.array[aB+2]=D.z,aD.array[aB+3]=D.w,aB+=4}}}}}}}}}else{if(aI){for(aJ=0;aJ<D;aJ++){aC=aD[aJ].position,aB=aJ*3,aG[aB]=aC.x,aG[aB+1]=aC.y,aG[aB+2]=aC.z}}if(aA){for(aJ=0;aJ<z;aJ++){aC=aE[aJ],aB=aJ*3,C[aB]=aC.r,C[aB+1]=aC.g,C[aB+2]=aC.b}}if(aM){aE=0;for(z=aM.length;aE<z;aE++){if(aD=aM[aE],aD.needsUpdate&&(aD.boundTo===void 0||aD.boundTo==="vertices")){if(aC=aD.value.length,aB=0,aD.size===1){for(aJ=0;aJ<aC;aJ++){aD.array[aJ]=aD.value[aJ]}}else{if(aD.size===2){for(aJ=0;aJ<aC;aJ++){D=aD.value[aJ],aD.array[aB]=D.x,aD.array[aB+1]=D.y,aB+=2}}else{if(aD.size===3){if(aD.type==="c"){for(aJ=0;aJ<aC;aJ++){D=aD.value[aJ],aD.array[aB]=D.r,aD.array[aB+1]=D.g,aD.array[aB+2]=D.b,aB+=3}}else{for(aJ=0;aJ<aC;aJ++){D=aD.value[aJ],aD.array[aB]=D.x,aD.array[aB+1]=D.y,aD.array[aB+2]=D.z,aB+=3}}}else{if(aD.size===4){for(aJ=0;aJ<aC;aJ++){D=aD.value[aJ],aD.array[aB]=D.x,aD.array[aB+1]=D.y,aD.array[aB+2]=D.z,aD.array[aB+3]=D.w,aB+=4}}}}}}}}}if(aI||aL.sortParticles){at.bindBuffer(at.ARRAY_BUFFER,aF.__webglVertexBuffer),at.bufferData(at.ARRAY_BUFFER,aG,aH)}if(aA||aL.sortParticles){at.bindBuffer(at.ARRAY_BUFFER,aF.__webglColorBuffer),at.bufferData(at.ARRAY_BUFFER,C,aH)}if(aM){aE=0;for(z=aM.length;aE<z;aE++){if(aD=aM[aE],aD.needsUpdate||aL.sortParticles){at.bindBuffer(at.ARRAY_BUFFER,aD.buffer),at.bufferData(at.ARRAY_BUFFER,aD.array,aH)}}}}function aq(z,D,aA){if(!z.__webglVertexBuffer){z.__webglVertexBuffer=at.createBuffer()}if(!z.__webglNormalBuffer){z.__webglNormalBuffer=at.createBuffer()}z.hasPos&&(at.bindBuffer(at.ARRAY_BUFFER,z.__webglVertexBuffer),at.bufferData(at.ARRAY_BUFFER,z.positionArray,at.DYNAMIC_DRAW),at.enableVertexAttribArray(D.attributes.position),at.vertexAttribPointer(D.attributes.position,3,at.FLOAT,!1,0,0));if(z.hasNormal){at.bindBuffer(at.ARRAY_BUFFER,z.__webglNormalBuffer);if(aA===c.FlatShading){var aC,aF,aE,aD,aG,aH,aI,aJ,aK,C,aB=z.count*3;for(C=0;C<aB;C+=9){aA=z.normalArray,aC=aA[C],aF=aA[C+1],aE=aA[C+2],aD=aA[C+3],aH=aA[C+4],aJ=aA[C+5],aG=aA[C+6],aI=aA[C+7],aK=aA[C+8],aC=(aC+aD+aG)/3,aF=(aF+aH+aI)/3,aE=(aE+aJ+aK)/3,aA[C]=aC,aA[C+1]=aF,aA[C+2]=aE,aA[C+3]=aC,aA[C+4]=aF,aA[C+5]=aE,aA[C+6]=aC,aA[C+7]=aF,aA[C+8]=aE}}at.bufferData(at.ARRAY_BUFFER,z.normalArray,at.DYNAMIC_DRAW);at.enableVertexAttribArray(D.attributes.normal);at.vertexAttribPointer(D.attributes.normal,3,at.FLOAT,!1,0,0)}at.drawArrays(at.TRIANGLES,0,z.count);z.count=0}function ar(D,aB,aC,aD,aG,aF){if(aD.opacity!==0){var aE,aI,aC=I(D,aB,aC,aD,aF),aB=aC.attributes,D=!1,aC=aG.id*16777215+aC.id*2+(aD.wireframe?1:0);aC!==ai&&(ai=aC,D=!0);if(!aD.morphTargets&&aB.position>=0){D&&(at.bindBuffer(at.ARRAY_BUFFER,aG.__webglVertexBuffer),at.vertexAttribPointer(aB.position,3,at.FLOAT,!1,0,0))}else{if(aF.morphTargetBase){aC=aD.program.attributes;aF.morphTargetBase!==-1?(at.bindBuffer(at.ARRAY_BUFFER,aG.__webglMorphTargetsBuffers[aF.morphTargetBase]),at.vertexAttribPointer(aC.position,3,at.FLOAT,!1,0,0)):aC.position>=0&&(at.bindBuffer(at.ARRAY_BUFFER,aG.__webglVertexBuffer),at.vertexAttribPointer(aC.position,3,at.FLOAT,!1,0,0));if(aF.morphTargetForcedOrder.length){aE=0;var z=aF.morphTargetForcedOrder;for(aI=aF.morphTargetInfluences;aE<aD.numSupportedMorphTargets&&aE<z.length;){at.bindBuffer(at.ARRAY_BUFFER,aG.__webglMorphTargetsBuffers[z[aE]]),at.vertexAttribPointer(aC["morphTarget"+aE],3,at.FLOAT,!1,0,0),aF.__webglMorphTargetInfluences[aE]=aI[z[aE]],aE++}}else{var z=[],C=-1,aJ=0;aI=aF.morphTargetInfluences;var aH,aA=aI.length;aE=0;for(aF.morphTargetBase!==-1&&(z[aF.morphTargetBase]=!0);aE<aD.numSupportedMorphTargets;){for(aH=0;aH<aA;aH++){!z[aH]&&aI[aH]>C&&(aJ=aH,C=aI[aJ])}at.bindBuffer(at.ARRAY_BUFFER,aG.__webglMorphTargetsBuffers[aJ]);at.vertexAttribPointer(aC["morphTarget"+aE],3,at.FLOAT,!1,0,0);aF.__webglMorphTargetInfluences[aE]=C;z[aJ]=1;C=-1;aE++}}aD.program.uniforms.morphTargetInfluences!==null&&at.uniform1fv(aD.program.uniforms.morphTargetInfluences,aF.__webglMorphTargetInfluences)}}if(D){if(aG.__webglCustomAttributesList){aE=0;for(aI=aG.__webglCustomAttributesList.length;aE<aI;aE++){aC=aG.__webglCustomAttributesList[aE],aB[aC.buffer.belongsToAttribute]>=0&&(at.bindBuffer(at.ARRAY_BUFFER,aC.buffer),at.vertexAttribPointer(aB[aC.buffer.belongsToAttribute],aC.size,at.FLOAT,!1,0,0))}}aB.color>=0&&(at.bindBuffer(at.ARRAY_BUFFER,aG.__webglColorBuffer),at.vertexAttribPointer(aB.color,3,at.FLOAT,!1,0,0));aB.normal>=0&&(at.bindBuffer(at.ARRAY_BUFFER,aG.__webglNormalBuffer),at.vertexAttribPointer(aB.normal,3,at.FLOAT,!1,0,0));aB.tangent>=0&&(at.bindBuffer(at.ARRAY_BUFFER,aG.__webglTangentBuffer),at.vertexAttribPointer(aB.tangent,4,at.FLOAT,!1,0,0));aB.uv>=0&&(aG.__webglUVBuffer?(at.bindBuffer(at.ARRAY_BUFFER,aG.__webglUVBuffer),at.vertexAttribPointer(aB.uv,2,at.FLOAT,!1,0,0),at.enableVertexAttribArray(aB.uv)):at.disableVertexAttribArray(aB.uv));aB.uv2>=0&&(aG.__webglUV2Buffer?(at.bindBuffer(at.ARRAY_BUFFER,aG.__webglUV2Buffer),at.vertexAttribPointer(aB.uv2,2,at.FLOAT,!1,0,0),at.enableVertexAttribArray(aB.uv2)):at.disableVertexAttribArray(aB.uv2));aD.skinning&&aB.skinVertexA>=0&&aB.skinVertexB>=0&&aB.skinIndex>=0&&aB.skinWeight>=0&&(at.bindBuffer(at.ARRAY_BUFFER,aG.__webglSkinVertexABuffer),at.vertexAttribPointer(aB.skinVertexA,4,at.FLOAT,!1,0,0),at.bindBuffer(at.ARRAY_BUFFER,aG.__webglSkinVertexBBuffer),at.vertexAttribPointer(aB.skinVertexB,4,at.FLOAT,!1,0,0),at.bindBuffer(at.ARRAY_BUFFER,aG.__webglSkinIndicesBuffer),at.vertexAttribPointer(aB.skinIndex,4,at.FLOAT,!1,0,0),at.bindBuffer(at.ARRAY_BUFFER,aG.__webglSkinWeightsBuffer),at.vertexAttribPointer(aB.skinWeight,4,at.FLOAT,!1,0,0))}aF instanceof c.Mesh?(aD.wireframe?(aD=aD.wireframeLinewidth,aD!==ak&&(at.lineWidth(aD),ak=aD),D&&at.bindBuffer(at.ELEMENT_ARRAY_BUFFER,aG.__webglLineBuffer),at.drawElements(at.LINES,aG.__webglLineCount,at.UNSIGNED_SHORT,0)):(D&&at.bindBuffer(at.ELEMENT_ARRAY_BUFFER,aG.__webglFaceBuffer),at.drawElements(at.TRIANGLES,aG.__webglFaceCount,at.UNSIGNED_SHORT,0)),U.info.render.calls++,U.info.render.vertices+=aG.__webglFaceCount,U.info.render.faces+=aG.__webglFaceCount/3):aF instanceof c.Line?(aF=aF.type===c.LineStrip?at.LINE_STRIP:at.LINES,aD=aD.linewidth,aD!==ak&&(at.lineWidth(aD),ak=aD),at.drawArrays(aF,0,aG.__webglLineCount),U.info.render.calls++):aF instanceof c.ParticleSystem?(at.drawArrays(at.POINTS,0,aG.__webglParticleCount),U.info.render.calls++):aF instanceof c.Ribbon&&(at.drawArrays(at.TRIANGLE_STRIP,0,aG.__webglVertexCount),U.info.render.calls++)}}function b(z){N[0].set(z.n41-z.n11,z.n42-z.n12,z.n43-z.n13,z.n44-z.n14);N[1].set(z.n41+z.n11,z.n42+z.n12,z.n43+z.n13,z.n44+z.n14);N[2].set(z.n41+z.n21,z.n42+z.n22,z.n43+z.n23,z.n44+z.n24);N[3].set(z.n41-z.n21,z.n42-z.n22,z.n43-z.n23,z.n44-z.n24);N[4].set(z.n41-z.n31,z.n42-z.n32,z.n43-z.n33,z.n44-z.n34);N[5].set(z.n41+z.n31,z.n42+z.n32,z.n43+z.n33,z.n44+z.n34);for(var C,z=0;z<6;z++){C=N[z],C.divideScalar(Math.sqrt(C.x*C.x+C.y*C.y+C.z*C.z))}}function J(D){for(var aA=D.matrixWorld,z=-D.geometry.boundingSphere.radius*Math.max(D.scale.x,Math.max(D.scale.y,D.scale.z)),C=0;C<6;C++){if(D=N[C].x*aA.n14+N[C].y*aA.n24+N[C].z*aA.n34+N[C].w,D<=z){return !1}}return !0}function v(z,C){return C.z-z.z}function x(aC){var aD,aE,aF,aH,aG,z,C,D,aA=0,aB=aC.lights;e||(e=new c.PerspectiveCamera(U.shadowCameraFov,U.shadowMapWidth/U.shadowMapHeight,U.shadowCameraNear,U.shadowCameraFar));aD=0;for(aE=aB.length;aD<aE;aD++){if(D=aB[aD],D.castShadow&&D instanceof c.SpotLight){al=-1;U.shadowMap[aA]||(U.shadowMap[aA]=new c.WebGLRenderTarget(U.shadowMapWidth,U.shadowMapHeight,{minFilter:c.LinearFilter,magFilter:c.LinearFilter,format:c.RGBAFormat}),ac[aA]=new c.Matrix4);aF=U.shadowMap[aA];aH=ac[aA];e.position.copy(D.position);e.lookAt(D.target.position);e.parent==null&&(console.warn("Camera is not on the Scene. Adding it..."),aC.add(e),this.autoUpdateScene&&aC.updateMatrixWorld());e.matrixWorldInverse.getInverse(e.matrixWorld);aH.set(0.5,0,0,0.5,0,0.5,0,0.5,0,0,0.5,0.5,0,0,0,1);aH.multiplySelf(e.projectionMatrix);aH.multiplySelf(e.matrixWorldInverse);e.matrixWorldInverse.flattenToArray(ae);e.projectionMatrix.flattenToArray(q);X.multiply(e.projectionMatrix,e.matrixWorldInverse);b(X);S(aF);at.clearColor(1,1,1,1);U.clear();at.clearColor(W.r,W.g,W.b,Q);aH=aC.__webglObjects.length;for(aF=0;aF<aH;aF++){if(z=aC.__webglObjects[aF],D=z.object,z.render=!1,D.visible&&D.castShadow&&(!(D instanceof c.Mesh)||!D.frustumCulled||J(D))){D.matrixWorld.flattenToArray(D._objectMatrixArray),u(D,e,!1),z.render=!0}}t(!0);au(c.NormalBlending);for(aF=0;aF<aH;aF++){if(z=aC.__webglObjects[aF],z.render){D=z.object,z=z.buffer,B(D),C=D.customDepthMaterial?D.customDepthMaterial:D.geometry.morphTargets.length?ao:ay,ar(e,aB,null,C,z,D)}}aH=aC.__webglObjectsImmediate.length;for(aF=0;aF<aH;aF++){z=aC.__webglObjectsImmediate[aF],D=z.object,D.visible&&D.castShadow&&(D.matrixAutoUpdate&&D.matrixWorld.flattenToArray(D._objectMatrixArray),ai=-1,u(D,e,!1),B(D),aG=I(e,aB,null,ay,D),D.immediateRenderCallback?D.immediateRenderCallback(aG,at,N):D.render(function(aI){aq(aI,aG,ay.shading)}))}aA++}}}function k(D,aB,aC,aD,aG,aF,aE,aI){var z,C,aA,aJ;aB?(C=D.length-1,aJ=aB=-1):(C=0,aB=D.length,aJ=1);for(var aH=C;aH!==aB;aH+=aJ){if(z=D[aH],z.render){C=z.object;aA=z.buffer;if(aI){z=aI}else{z=z[aC];if(!z){continue}aE&&au(z.blending);t(z.depthTest);aw(z.depthWrite);ax(z.polygonOffset,z.polygonOffsetFactor,z.polygonOffsetUnits)}B(C);ar(aD,aG,aF,z,aA,C)}}}function E(C,aB,aC,aD,aG,aF,aE){for(var aI,aJ,D,aH,z=0,aA=C.length;z<aA;z++){if(aI=C[z],aJ=aI.object,aJ.visible){ai=-1;if(aE){D=aE}else{D=aI[aB];if(!D){continue}aF&&au(D.blending);t(D.depthTest);aw(D.depthWrite);ax(D.polygonOffset,D.polygonOffsetFactor,D.polygonOffsetUnits)}B(aJ);aH=I(aC,aD,aG,D,aJ);aJ.immediateRenderCallback?aJ.immediateRenderCallback(aH,at,N):aJ.render(function(aK){aq(aK,aH,D.shading)})}}}function r(z,D,C){z.push({buffer:D,object:C,opaque:null,transparent:null})}function A(z){for(var C in z.attributes){if(z.attributes[C].needsUpdate){return !0}}return !1}function H(z){for(var C in z.attributes){z.attributes[C].needsUpdate=!1}}function av(z,D){for(var C=z.length-1;C>=0;C--){z[C].object===D&&z.splice(C,1)}}function I(aK,aJ,C,aB,z){aB.program||U.initMaterial(aB,aJ,C,z);if(aB.morphTargets&&!z.__webglMorphTargetInfluences){z.__webglMorphTargetInfluences=new Float32Array(U.maxMorphTargets);for(var aI=0,aD=U.maxMorphTargets;aI<aD;aI++){z.__webglMorphTargetInfluences[aI]=0}}var D=!1,aI=aB.program,aD=aI.uniforms,aA=aB.uniforms;aI!==T&&(at.useProgram(aI),T=aI,D=!0);if(aB.id!==al){al=aB.id,D=!0}if(D){at.uniformMatrix4fv(aD.projectionMatrix,!1,q);if(C&&aB.fog){if(aA.fogColor.value=C.color,C instanceof c.Fog){aA.fogNear.value=C.near,aA.fogFar.value=C.far}else{if(C instanceof c.FogExp2){aA.fogDensity.value=C.density}}}if(aB instanceof c.MeshPhongMaterial||aB instanceof c.MeshLambertMaterial||aB.lights){for(var aF,aG,aE=0,aC=0,aL=0,aN,aM,aP,aQ=ag,aR=aQ.directional.colors,aS=aQ.directional.positions,aY=aQ.point.colors,aX=aQ.point.positions,aW=aQ.point.distances,aH=0,aO=0,C=aF=aP=0,D=aJ.length;C<D;C++){if(aF=aJ[C],aG=aF.color,aN=aF.position,aM=aF.intensity,aP=aF.distance,aF instanceof c.AmbientLight){U.gammaInput?(aE+=aG.r*aG.r,aC+=aG.g*aG.g,aL+=aG.b*aG.b):(aE+=aG.r,aC+=aG.g,aL+=aG.b)}else{if(aF instanceof c.DirectionalLight){aP=aH*3,U.gammaInput?(aR[aP]=aG.r*aG.r*aM*aM,aR[aP+1]=aG.g*aG.g*aM*aM,aR[aP+2]=aG.b*aG.b*aM*aM):(aR[aP]=aG.r*aM,aR[aP+1]=aG.g*aM,aR[aP+2]=aG.b*aM),aS[aP]=aN.x,aS[aP+1]=aN.y,aS[aP+2]=aN.z,aH+=1}else{if(aF instanceof c.SpotLight){aP=aH*3,U.gammaInput?(aR[aP]=aG.r*aG.r*aM*aM,aR[aP+1]=aG.g*aG.g*aM*aM,aR[aP+2]=aG.b*aG.b*aM*aM):(aR[aP]=aG.r*aM,aR[aP+1]=aG.g*aM,aR[aP+2]=aG.b*aM),aG=1/aN.length(),aS[aP]=aN.x*aG,aS[aP+1]=aN.y*aG,aS[aP+2]=aN.z*aG,aH+=1}else{if(aF instanceof c.PointLight){aF=aO*3,U.gammaInput?(aY[aF]=aG.r*aG.r*aM*aM,aY[aF+1]=aG.g*aG.g*aM*aM,aY[aF+2]=aG.b*aG.b*aM*aM):(aY[aF]=aG.r*aM,aY[aF+1]=aG.g*aM,aY[aF+2]=aG.b*aM),aX[aF]=aN.x,aX[aF+1]=aN.y,aX[aF+2]=aN.z,aW[aO]=aP,aO+=1}}}}}C=aH*3;for(D=aR.length;C<D;C++){aR[C]=0}C=aO*3;for(D=aY.length;C<D;C++){aY[C]=0}aQ.point.length=aO;aQ.directional.length=aH;aQ.ambient[0]=aE;aQ.ambient[1]=aC;aQ.ambient[2]=aL;aJ=ag;aA.ambientLightColor.value=aJ.ambient;aA.directionalLightColor.value=aJ.directional.colors;aA.directionalLightDirection.value=aJ.directional.positions;aA.pointLightColor.value=aJ.point.colors;aA.pointLightPosition.value=aJ.point.positions;aA.pointLightDistance.value=aJ.point.distances}if(aB instanceof c.MeshBasicMaterial||aB instanceof c.MeshLambertMaterial||aB instanceof c.MeshPhongMaterial){aA.opacity.value=aB.opacity,U.gammaInput?aA.diffuse.value.copyGammaToLinear(aB.color):aA.diffuse.value=aB.color,(aA.map.texture=aB.map)&&aA.offsetRepeat.value.set(aB.map.offset.x,aB.map.offset.y,aB.map.repeat.x,aB.map.repeat.y),aA.lightMap.texture=aB.lightMap,aA.envMap.texture=aB.envMap,aA.flipEnvMap.value=aB.envMap instanceof c.WebGLRenderTargetCube?1:-1,aA.reflectivity.value=aB.reflectivity,aA.refractionRatio.value=aB.refractionRatio,aA.combine.value=aB.combine,aA.useRefract.value=aB.envMap&&aB.envMap.mapping instanceof c.CubeRefractionMapping}if(aB instanceof c.LineBasicMaterial){aA.diffuse.value=aB.color,aA.opacity.value=aB.opacity}else{if(aB instanceof c.ParticleBasicMaterial){aA.psColor.value=aB.color,aA.opacity.value=aB.opacity,aA.size.value=aB.size,aA.scale.value=Y.height/2,aA.map.texture=aB.map}else{if(aB instanceof c.MeshPhongMaterial){aA.shininess.value=aB.shininess,U.gammaInput?(aA.ambient.value.copyGammaToLinear(aB.ambient),aA.specular.value.copyGammaToLinear(aB.specular)):(aA.ambient.value=aB.ambient,aA.specular.value=aB.specular)}else{if(aB instanceof c.MeshLambertMaterial){U.gammaInput?aA.ambient.value.copyGammaToLinear(aB.ambient):aA.ambient.value=aB.ambient}else{if(aB instanceof c.MeshDepthMaterial){aA.mNear.value=aK.near,aA.mFar.value=aK.far,aA.opacity.value=aB.opacity}else{if(aB instanceof c.MeshNormalMaterial){aA.opacity.value=aB.opacity}}}}}}if(z.receiveShadow&&!aB._shadowPass&&aA.shadowMatrix){for(aJ=0;aJ<ac.length;aJ++){aA.shadowMatrix.value[aJ]=ac[aJ],aA.shadowMap.texture[aJ]=U.shadowMap[aJ]}aA.shadowDarkness.value=U.shadowMapDarkness;aA.shadowBias.value=U.shadowMapBias}aJ=aB.uniformsList;aA=0;for(C=aJ.length;aA<C;aA++){if(aC=aI.uniforms[aJ[aA][1]]){if(aE=aJ[aA][0],aL=aE.type,D=aE.value,aL==="i"){at.uniform1i(aC,D)}else{if(aL==="f"){at.uniform1f(aC,D)}else{if(aL==="v2"){at.uniform2f(aC,D.x,D.y)}else{if(aL==="v3"){at.uniform3f(aC,D.x,D.y,D.z)}else{if(aL==="v4"){at.uniform4f(aC,D.x,D.y,D.z,D.w)}else{if(aL==="c"){at.uniform3f(aC,D.r,D.g,D.b)}else{if(aL==="fv1"){at.uniform1fv(aC,D)}else{if(aL==="fv"){at.uniform3fv(aC,D)}else{if(aL==="v3v"){if(!aE._array){aE._array=new Float32Array(3*D.length)}aL=0;for(aN=D.length;aL<aN;aL++){aQ=aL*3,aE._array[aQ]=D[aL].x,aE._array[aQ+1]=D[aL].y,aE._array[aQ+2]=D[aL].z}at.uniform3fv(aC,aE._array)}else{if(aL==="m4"){if(!aE._array){aE._array=new Float32Array(16)}D.flattenToArray(aE._array);at.uniformMatrix4fv(aC,!1,aE._array)}else{if(aL==="m4v"){if(!aE._array){aE._array=new Float32Array(16*D.length)}aL=0;for(aN=D.length;aL<aN;aL++){D[aL].flattenToArrayOffset(aE._array,aL*16)}at.uniformMatrix4fv(aC,!1,aE._array)}else{if(aL==="t"){if(at.uniform1i(aC,D),aC=aE.texture){if(aC.image instanceof Array&&aC.image.length===6){if(aE=aC,aE.image.length===6){if(aE.needsUpdate){if(!aE.image.__webglTextureCube){aE.image.__webglTextureCube=at.createTexture()}at.activeTexture(at.TEXTURE0+D);at.bindTexture(at.TEXTURE_CUBE_MAP,aE.image.__webglTextureCube);D=G(at.TEXTURE_CUBE_MAP,aE,aE.image[0]);for(aC=0;aC<6;aC++){at.texImage2D(at.TEXTURE_CUBE_MAP_POSITIVE_X+aC,0,at.RGBA,at.RGBA,at.UNSIGNED_BYTE,aE.image[aC])}D&&at.generateMipmap(at.TEXTURE_CUBE_MAP);aE.needsUpdate=!1}else{at.activeTexture(at.TEXTURE0+D),at.bindTexture(at.TEXTURE_CUBE_MAP,aE.image.__webglTextureCube)}}}else{aC instanceof c.WebGLRenderTargetCube?(aE=aC,at.activeTexture(at.TEXTURE0+D),at.bindTexture(at.TEXTURE_CUBE_MAP,aE.__webglTexture)):y(aC,D)}}}else{if(aL==="tv"){if(!aE._array){aE._array=[];aL=0;for(aN=aE.texture.length;aL<aN;aL++){aE._array[aL]=D+aL}}at.uniform1iv(aC,aE._array);aL=0;for(aN=aE.texture.length;aL<aN;aL++){(aC=aE.texture[aL])&&y(aC,aE._array[aL])}}}}}}}}}}}}}}}}(aB instanceof c.ShaderMaterial||aB instanceof c.MeshPhongMaterial||aB.envMap)&&aD.cameraPosition!==null&&at.uniform3f(aD.cameraPosition,aK.position.x,aK.position.y,aK.position.z);(aB instanceof c.MeshPhongMaterial||aB instanceof c.MeshLambertMaterial||aB instanceof c.ShaderMaterial||aB.skinning)&&aD.viewMatrix!==null&&at.uniformMatrix4fv(aD.viewMatrix,!1,ae);aB.skinning&&(at.uniformMatrix4fv(aD.cameraInverseMatrix,!1,ae),at.uniformMatrix4fv(aD.boneGlobalMatrices,!1,z.boneMatrices))}at.uniformMatrix4fv(aD.modelViewMatrix,!1,z._modelViewMatrixArray);aD.normalMatrix&&at.uniformMatrix3fv(aD.normalMatrix,!1,z._normalMatrixArray);(aB instanceof c.ShaderMaterial||aB.envMap||aB.skinning||z.receiveShadow)&&aD.objectMatrix!==null&&at.uniformMatrix4fv(aD.objectMatrix,!1,z._objectMatrixArray);return aI}function u(z,D,C){z._modelViewMatrix.multiplyToArray(D.matrixWorldInverse,z.matrixWorld,z._modelViewMatrixArray);C&&c.Matrix4.makeInvert3x3(z._modelViewMatrix).transposeIntoArray(z._normalMatrixArray)}function B(z){if(ad!==z.doubleSided){z.doubleSided?at.disable(at.CULL_FACE):at.enable(at.CULL_FACE),ad=z.doubleSided}if(K!==z.flipSided){z.flipSided?at.frontFace(at.CW):at.frontFace(at.CCW),K=z.flipSided}}function t(z){m!==z&&(z?at.enable(at.DEPTH_TEST):at.disable(at.DEPTH_TEST),m=z)}function aw(z){az!==z&&(at.depthMask(z),az=z)}function ax(z,D,C){ap!==z&&(z?at.enable(at.POLYGON_OFFSET_FILL):at.disable(at.POLYGON_OFFSET_FILL),ap=z);if(z&&(an!==D||af!==C)){at.polygonOffset(D,C),an=D,af=C}}function au(z){if(z!==w){switch(z){case c.AdditiveBlending:at.blendEquation(at.FUNC_ADD);at.blendFunc(at.SRC_ALPHA,at.ONE);break;case c.SubtractiveBlending:at.blendEquation(at.FUNC_ADD);at.blendFunc(at.ZERO,at.ONE_MINUS_SRC_COLOR);break;case c.MultiplyBlending:at.blendEquation(at.FUNC_ADD);at.blendFunc(at.ZERO,at.SRC_COLOR);break;default:at.blendEquationSeparate(at.FUNC_ADD,at.FUNC_ADD),at.blendFuncSeparate(at.SRC_ALPHA,at.ONE_MINUS_SRC_ALPHA,at.ONE,at.ONE_MINUS_SRC_ALPHA)}w=z}}function ab(z,D){var C;z==="fragment"?C=at.createShader(at.FRAGMENT_SHADER):z==="vertex"&&(C=at.createShader(at.VERTEX_SHADER));at.shaderSource(C,D);at.compileShader(C);if(!at.getShaderParameter(C,at.COMPILE_STATUS)){return console.error(at.getShaderInfoLog(C)),console.error(D),null}return C}function G(z,D,C){return(C.width&C.width-1)===0&&(C.height&C.height-1)===0?(at.texParameteri(z,at.TEXTURE_WRAP_S,aa(D.wrapS)),at.texParameteri(z,at.TEXTURE_WRAP_T,aa(D.wrapT)),at.texParameteri(z,at.TEXTURE_MAG_FILTER,aa(D.magFilter)),at.texParameteri(z,at.TEXTURE_MIN_FILTER,aa(D.minFilter)),!0):(at.texParameteri(z,at.TEXTURE_WRAP_S,at.CLAMP_TO_EDGE),at.texParameteri(z,at.TEXTURE_WRAP_T,at.CLAMP_TO_EDGE),at.texParameteri(z,at.TEXTURE_MAG_FILTER,aV(D.magFilter)),at.texParameteri(z,at.TEXTURE_MIN_FILTER,aV(D.minFilter)),!1)}function y(z,D){if(z.needsUpdate){if(!z.__webglInit){z.__webglInit=!0,z.__webglTexture=at.createTexture(),U.info.memory.textures++}at.activeTexture(at.TEXTURE0+D);at.bindTexture(at.TEXTURE_2D,z.__webglTexture);var C=G(at.TEXTURE_2D,z,z.image);z instanceof c.DataTexture?at.texImage2D(at.TEXTURE_2D,0,aa(z.format),z.image.width,z.image.height,0,aa(z.format),at.UNSIGNED_BYTE,z.image.data):at.texImage2D(at.TEXTURE_2D,0,at.RGBA,at.RGBA,at.UNSIGNED_BYTE,z.image);C&&at.generateMipmap(at.TEXTURE_2D);z.needsUpdate=!1;if(z.onUpdated){z.onUpdated()}}else{at.activeTexture(at.TEXTURE0+D),at.bindTexture(at.TEXTURE_2D,z.__webglTexture)}}function P(z,C){at.bindRenderbuffer(at.RENDERBUFFER,z);C.depthBuffer&&!C.stencilBuffer?(at.renderbufferStorage(at.RENDERBUFFER,at.DEPTH_COMPONENT16,C.width,C.height),at.framebufferRenderbuffer(at.FRAMEBUFFER,at.DEPTH_ATTACHMENT,at.RENDERBUFFER,z)):C.depthBuffer&&C.stencilBuffer?(at.renderbufferStorage(at.RENDERBUFFER,at.DEPTH_STENCIL,C.width,C.height),at.framebufferRenderbuffer(at.FRAMEBUFFER,at.DEPTH_STENCIL_ATTACHMENT,at.RENDERBUFFER,z)):at.renderbufferStorage(at.RENDERBUFFER,at.RGBA4,C.width,C.height)}function S(aA){var aB=aA instanceof c.WebGLRenderTargetCube;if(aA&&!aA.__webglFramebuffer){if(aA.depthBuffer===void 0){aA.depthBuffer=!0}if(aA.stencilBuffer===void 0){aA.stencilBuffer=!0}aA.__webglTexture=at.createTexture();if(aB){aA.__webglFramebuffer=[];aA.__webglRenderbuffer=[];at.bindTexture(at.TEXTURE_CUBE_MAP,aA.__webglTexture);G(at.TEXTURE_CUBE_MAP,aA,aA);for(var z=0;z<6;z++){aA.__webglFramebuffer[z]=at.createFramebuffer();aA.__webglRenderbuffer[z]=at.createRenderbuffer();at.texImage2D(at.TEXTURE_CUBE_MAP_POSITIVE_X+z,0,aa(aA.format),aA.width,aA.height,0,aa(aA.format),aa(aA.type),null);var C=aA,D=at.TEXTURE_CUBE_MAP_POSITIVE_X+z;at.bindFramebuffer(at.FRAMEBUFFER,aA.__webglFramebuffer[z]);at.framebufferTexture2D(at.FRAMEBUFFER,at.COLOR_ATTACHMENT0,D,C.__webglTexture,0);P(aA.__webglRenderbuffer[z],aA)}}else{aA.__webglFramebuffer=at.createFramebuffer(),aA.__webglRenderbuffer=at.createRenderbuffer(),at.bindTexture(at.TEXTURE_2D,aA.__webglTexture),G(at.TEXTURE_2D,aA,aA),at.texImage2D(at.TEXTURE_2D,0,aa(aA.format),aA.width,aA.height,0,aa(aA.format),aa(aA.type),null),z=at.TEXTURE_2D,at.bindFramebuffer(at.FRAMEBUFFER,aA.__webglFramebuffer),at.framebufferTexture2D(at.FRAMEBUFFER,at.COLOR_ATTACHMENT0,z,aA.__webglTexture,0),P(aA.__webglRenderbuffer,aA)}aB?at.bindTexture(at.TEXTURE_CUBE_MAP,null):at.bindTexture(at.TEXTURE_2D,null);at.bindRenderbuffer(at.RENDERBUFFER,null);at.bindFramebuffer(at.FRAMEBUFFER,null)}aA?(aB=aB?aA.__webglFramebuffer[aA.activeCubeFace]:aA.__webglFramebuffer,z=aA.width,aA=aA.height,D=C=0):(aB=null,z=O,aA=i,C=a,D=f);aB!==aT&&(at.bindFramebuffer(at.FRAMEBUFFER,aB),at.viewport(C,D,z,aA),aT=aB)}function aV(z){switch(z){case c.NearestFilter:case c.NearestMipMapNearestFilter:case c.NearestMipMapLinearFilter:return at.NEAREST;default:return at.LINEAR}}function aa(z){switch(z){case c.RepeatWrapping:return at.REPEAT;case c.ClampToEdgeWrapping:return at.CLAMP_TO_EDGE;case c.MirroredRepeatWrapping:return at.MIRRORED_REPEAT;case c.NearestFilter:return at.NEAREST;case c.NearestMipMapNearestFilter:return at.NEAREST_MIPMAP_NEAREST;case c.NearestMipMapLinearFilter:return at.NEAREST_MIPMAP_LINEAR;case c.LinearFilter:return at.LINEAR;case c.LinearMipMapNearestFilter:return at.LINEAR_MIPMAP_NEAREST;case c.LinearMipMapLinearFilter:return at.LINEAR_MIPMAP_LINEAR;case c.ByteType:return at.BYTE;case c.UnsignedByteType:return at.UNSIGNED_BYTE;case c.ShortType:return at.SHORT;case c.UnsignedShortType:return at.UNSIGNED_SHORT;case c.IntType:return at.INT;case c.UnsignedShortType:return at.UNSIGNED_INT;case c.FloatType:return at.FLOAT;case c.AlphaFormat:return at.ALPHA;case c.RGBFormat:return at.RGB;case c.RGBAFormat:return at.RGBA;case c.LuminanceFormat:return at.LUMINANCE;case c.LuminanceAlphaFormat:return at.LUMINANCE_ALPHA}return 0}var h=h||{},Y=h.canvas!==void 0?h.canvas:document.createElement("canvas"),am=h.precision!==void 0?h.precision:"highp",L=h.antialias!==void 0?h.antialias:!1,F=h.stencil!==void 0?h.stencil:!0,M=h.preserveDrawingBuffer!==void 0?h.preserveDrawingBuffer:!1,W=h.clearColor!==void 0?new c.Color(h.clearColor):new c.Color(0),Q=h.clearAlpha!==void 0?h.clearAlpha:0,Z=h.maxLights!==void 0?h.maxLights:4;this.domElement=Y;this.context=null;this.autoUpdateScene=this.autoUpdateObjects=this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0;this.physicallyBasedShading=this.gammaOutput=this.gammaInput=!1;this.shadowMapBias=0.0039;this.shadowMapDarkness=0.5;this.shadowMapHeight=this.shadowMapWidth=512;this.shadowCameraNear=1;this.shadowCameraFar=5000;this.shadowCameraFov=50;this.shadowMap=[];this.shadowMapEnabled=!1;this.shadowMapSoft=this.shadowMapAutoUpdate=!0;this.maxMorphTargets=8;this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0}};var U=this,at,V=[],T=null,aT=null,al=-1,ai=null,g=0,ad=null,K=null,w=null,m=null,az=null,ap=null,an=null,af=null,ak=null,a=0,f=0,O=0,i=0,N=[new c.Vector4,new c.Vector4,new c.Vector4,new c.Vector4,new c.Vector4,new c.Vector4],X=new c.Matrix4,q=new Float32Array(16),ae=new Float32Array(16),aj=new c.Vector4,ag={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]}},e,ac=[],ay,ao,R={},aU=!1;at=function(){var z;try{if(!(z=Y.getContext("experimental-webgl",{antialias:L,stencil:F,preserveDrawingBuffer:M}))){throw"Error creating WebGL context."}console.log(navigator.userAgent+" | "+z.getParameter(z.VERSION)+" | "+z.getParameter(z.VENDOR)+" | "+z.getParameter(z.RENDERER)+" | "+z.getParameter(z.SHADING_LANGUAGE_VERSION))}catch(C){console.error(C)}return z}();at.clearColor(0,0,0,1);at.clearDepth(1);at.clearStencil(0);at.enable(at.DEPTH_TEST);at.depthFunc(at.LEQUAL);at.frontFace(at.CCW);at.cullFace(at.BACK);at.enable(at.CULL_FACE);at.enable(at.BLEND);at.blendEquation(at.FUNC_ADD);at.blendFunc(at.SRC_ALPHA,at.ONE_MINUS_SRC_ALPHA);at.clearColor(W.r,W.g,W.b,Q);(function(){R.vertices=new Float32Array(16);R.faces=new Uint16Array(6);var z=0;R.vertices[z++]=-1;R.vertices[z++]=-1;R.vertices[z++]=0;R.vertices[z++]=1;R.vertices[z++]=1;R.vertices[z++]=-1;R.vertices[z++]=1;R.vertices[z++]=1;R.vertices[z++]=1;R.vertices[z++]=1;R.vertices[z++]=1;R.vertices[z++]=0;R.vertices[z++]=-1;R.vertices[z++]=1;R.vertices[z++]=0;z=R.vertices[z++]=0;R.faces[z++]=0;R.faces[z++]=1;R.faces[z++]=2;R.faces[z++]=0;R.faces[z++]=2;R.faces[z++]=3;R.vertexBuffer=at.createBuffer();R.elementBuffer=at.createBuffer();at.bindBuffer(at.ARRAY_BUFFER,R.vertexBuffer);at.bufferData(at.ARRAY_BUFFER,R.vertices,at.STATIC_DRAW);at.bindBuffer(at.ELEMENT_ARRAY_BUFFER,R.elementBuffer);at.bufferData(at.ELEMENT_ARRAY_BUFFER,R.faces,at.STATIC_DRAW);R.program=at.createProgram();at.attachShader(R.program,ab("fragment",c.ShaderLib.sprite.fragmentShader));at.attachShader(R.program,ab("vertex",c.ShaderLib.sprite.vertexShader));at.linkProgram(R.program);R.attributes={};R.uniforms={};R.attributes.position=at.getAttribLocation(R.program,"position");R.attributes.uv=at.getAttribLocation(R.program,"uv");R.uniforms.uvOffset=at.getUniformLocation(R.program,"uvOffset");R.uniforms.uvScale=at.getUniformLocation(R.program,"uvScale");R.uniforms.rotation=at.getUniformLocation(R.program,"rotation");R.uniforms.scale=at.getUniformLocation(R.program,"scale");R.uniforms.alignment=at.getUniformLocation(R.program,"alignment");R.uniforms.color=at.getUniformLocation(R.program,"color");R.uniforms.map=at.getUniformLocation(R.program,"map");R.uniforms.opacity=at.getUniformLocation(R.program,"opacity");R.uniforms.useScreenCoordinates=at.getUniformLocation(R.program,"useScreenCoordinates");R.uniforms.affectedByDistance=at.getUniformLocation(R.program,"affectedByDistance");R.uniforms.screenPosition=at.getUniformLocation(R.program,"screenPosition");R.uniforms.modelViewMatrix=at.getUniformLocation(R.program,"modelViewMatrix");R.uniforms.projectionMatrix=at.getUniformLocation(R.program,"projectionMatrix")})();(function(){var z=c.ShaderLib.depthRGBA,C=c.UniformsUtils.clone(z.uniforms);ay=new c.ShaderMaterial({fragmentShader:z.fragmentShader,vertexShader:z.vertexShader,uniforms:C});ao=new c.ShaderMaterial({fragmentShader:z.fragmentShader,vertexShader:z.vertexShader,uniforms:C,morphTargets:!0});ay._shadowPass=!0;ao._shadowPass=!0})();this.context=at;var ah=at.getParameter(at.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;this.getContext=function(){return at};this.supportsVertexTextures=function(){return ah};this.setSize=function(z,C){Y.width=z;Y.height=C;this.setViewport(0,0,Y.width,Y.height)};this.setViewport=function(D,aA,z,C){a=D;f=aA;O=z;i=C;at.viewport(a,f,O,i)};this.setScissor=function(D,aA,z,C){at.scissor(D,aA,z,C)};this.enableScissorTest=function(z){z?at.enable(at.SCISSOR_TEST):at.disable(at.SCISSOR_TEST)};this.setClearColorHex=function(z,C){W.setHex(z);Q=C;at.clearColor(W.r,W.g,W.b,Q)};this.setClearColor=function(z,C){W.copy(z);Q=C;at.clearColor(W.r,W.g,W.b,Q)};this.getClearColor=function(){return W};this.getClearAlpha=function(){return Q};this.clear=function(D,aA,z){var C=0;if(D===void 0||D){C|=at.COLOR_BUFFER_BIT}if(aA===void 0||aA){C|=at.DEPTH_BUFFER_BIT}if(z===void 0||z){C|=at.STENCIL_BUFFER_BIT}at.clear(C)};this.clearTarget=function(D,aA,z,C){S(D);this.clear(aA,z,C)};this.deallocateObject=function(aA){if(aA.__webglInit){if(aA.__webglInit=!1,delete aA._modelViewMatrix,delete aA._normalMatrixArray,delete aA._modelViewMatrixArray,delete aA._objectMatrixArray,aA instanceof c.Mesh){for(var aB in aA.geometry.geometryGroups){var z=aA.geometry.geometryGroups[aB];at.deleteBuffer(z.__webglVertexBuffer);at.deleteBuffer(z.__webglNormalBuffer);at.deleteBuffer(z.__webglTangentBuffer);at.deleteBuffer(z.__webglColorBuffer);at.deleteBuffer(z.__webglUVBuffer);at.deleteBuffer(z.__webglUV2Buffer);at.deleteBuffer(z.__webglSkinVertexABuffer);at.deleteBuffer(z.__webglSkinVertexBBuffer);at.deleteBuffer(z.__webglSkinIndicesBuffer);at.deleteBuffer(z.__webglSkinWeightsBuffer);at.deleteBuffer(z.__webglFaceBuffer);at.deleteBuffer(z.__webglLineBuffer);if(z.numMorphTargets){for(var C=0,D=z.numMorphTargets;C<D;C++){at.deleteBuffer(z.__webglMorphTargetsBuffers[C])}}if(z.__webglCustomAttributesList){for(C in C=void 0,z.__webglCustomAttributesList){at.deleteBuffer(z.__webglCustomAttributesList[C].buffer)}}U.info.memory.geometries--}}else{if(aA instanceof c.Ribbon){aA=aA.geometry,at.deleteBuffer(aA.__webglVertexBuffer),at.deleteBuffer(aA.__webglColorBuffer),U.info.memory.geometries--}else{if(aA instanceof c.Line){aA=aA.geometry,at.deleteBuffer(aA.__webglVertexBuffer),at.deleteBuffer(aA.__webglColorBuffer),U.info.memory.geometries--}else{if(aA instanceof c.ParticleSystem){aA=aA.geometry,at.deleteBuffer(aA.__webglVertexBuffer),at.deleteBuffer(aA.__webglColorBuffer),U.info.memory.geometries--}}}}}};this.deallocateTexture=function(z){if(z.__webglInit){z.__webglInit=!1,at.deleteTexture(z.__webglTexture),U.info.memory.textures--}};this.updateShadowMap=function(z,C){x(z,C)};this.render=function(aE,aF,aG,aJ){var aH,C,z,D,aA=aE.lights,aB=aE.fog;al=-1;this.autoUpdateObjects&&this.initWebGLObjects(aE);aF.parent===void 0&&(console.warn("DEPRECATED: Camera hasn't been added to a Scene. Adding it..."),aE.add(aF));this.autoUpdateScene&&aE.updateMatrixWorld();this.shadowMapEnabled&&this.shadowMapAutoUpdate&&x(aE,aF);U.info.render.calls=0;U.info.render.vertices=0;U.info.render.faces=0;aF.matrixWorldInverse.getInverse(aF.matrixWorld);aF.matrixWorldInverse.flattenToArray(ae);aF.projectionMatrix.flattenToArray(q);X.multiply(aF.projectionMatrix,aF.matrixWorldInverse);b(X);S(aG);(this.autoClear||aJ)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);D=aE.__webglObjects;aJ=0;for(aH=D.length;aJ<aH;aJ++){if(C=D[aJ],z=C.object,C.render=!1,z.visible&&(!(z instanceof c.Mesh)||!z.frustumCulled||J(z))){z.matrixWorld.flattenToArray(z._objectMatrixArray);u(z,aF,!0);var aI=C,aC=aI.object,aK=aI.buffer,aD=void 0,aD=aD=void 0,aD=aC.material;if(aD instanceof c.MeshFaceMaterial){if(aD=aK.materialIndex,aD>=0){aD=aC.geometry.materials[aD],aD.transparent?(aI.transparent=aD,aI.opaque=null):(aI.opaque=aD,aI.transparent=null)}}else{if(aD){aD.transparent?(aI.transparent=aD,aI.opaque=null):(aI.opaque=aD,aI.transparent=null)}}C.render=!0;if(this.sortObjects){z.renderDepth?C.z=z.renderDepth:(aj.copy(z.position),X.multiplyVector3(aj),C.z=aj.z)}}}this.sortObjects&&D.sort(v);D=aE.__webglObjectsImmediate;aJ=0;for(aH=D.length;aJ<aH;aJ++){if(C=D[aJ],z=C.object,z.visible){z.matrixAutoUpdate&&z.matrixWorld.flattenToArray(z._objectMatrixArray),u(z,aF,!0),z=C.object.material,z.transparent?(C.transparent=z,C.opaque=null):(C.opaque=z,C.transparent=null)}}aE.overrideMaterial?(au(aE.overrideMaterial.blending),t(aE.overrideMaterial.depthTest),aw(aE.overrideMaterial.depthWrite),ax(aE.overrideMaterial.polygonOffset,aE.overrideMaterial.polygonOffsetFactor,aE.overrideMaterial.polygonOffsetUnits),k(aE.__webglObjects,!1,"",aF,aA,aB,!0,aE.overrideMaterial),E(aE.__webglObjectsImmediate,"",aF,aA,aB,!1,aE.overrideMaterial)):(au(c.NormalBlending),k(aE.__webglObjects,!0,"opaque",aF,aA,aB,!1),E(aE.__webglObjectsImmediate,"opaque",aF,aA,aB,!1),k(aE.__webglObjects,!1,"transparent",aF,aA,aB,!0),E(aE.__webglObjectsImmediate,"transparent",aF,aA,aB,!0));if(aE.__webglSprites.length){z=R.attributes;aA=R.uniforms;aB=i/O;aJ=[];aH=O*0.5;D=i*0.5;C=!0;at.useProgram(R.program);T=R.program;ai=m=w=-1;aU||(at.enableVertexAttribArray(R.attributes.position),at.enableVertexAttribArray(R.attributes.uv),aU=!0);at.disable(at.CULL_FACE);at.enable(at.BLEND);at.depthMask(!0);at.bindBuffer(at.ARRAY_BUFFER,R.vertexBuffer);at.vertexAttribPointer(z.position,2,at.FLOAT,!1,16,0);at.vertexAttribPointer(z.uv,2,at.FLOAT,!1,16,8);at.bindBuffer(at.ELEMENT_ARRAY_BUFFER,R.elementBuffer);at.uniformMatrix4fv(aA.projectionMatrix,!1,q);at.activeTexture(at.TEXTURE0);at.uniform1i(aA.map,0);z=0;for(aI=aE.__webglSprites.length;z<aI;z++){if(aC=aE.__webglSprites[z],aC.visible&&aC.opacity!==0){aC.useScreenCoordinates?aC.z=-aC.position.z:(aC._modelViewMatrix.multiplyToArray(aF.matrixWorldInverse,aC.matrixWorld,aC._modelViewMatrixArray),aC.z=-aC._modelViewMatrix.n34)}}aE.__webglSprites.sort(v);z=0;for(aI=aE.__webglSprites.length;z<aI;z++){aC=aE.__webglSprites[z],aC.visible&&aC.opacity!==0&&aC.map&&aC.map.image&&aC.map.image.width&&(aC.useScreenCoordinates?(at.uniform1i(aA.useScreenCoordinates,1),at.uniform3f(aA.screenPosition,(aC.position.x-aH)/aH,(D-aC.position.y)/D,Math.max(0,Math.min(1,aC.position.z)))):(at.uniform1i(aA.useScreenCoordinates,0),at.uniform1i(aA.affectedByDistance,aC.affectedByDistance?1:0),at.uniformMatrix4fv(aA.modelViewMatrix,!1,aC._modelViewMatrixArray)),aF=aC.map.image.width/(aC.scaleByViewport?i:1),aJ[0]=aF*aB*aC.scale.x,aJ[1]=aF*aC.scale.y,at.uniform2f(aA.uvScale,aC.uvScale.x,aC.uvScale.y),at.uniform2f(aA.uvOffset,aC.uvOffset.x,aC.uvOffset.y),at.uniform2f(aA.alignment,aC.alignment.x,aC.alignment.y),at.uniform1f(aA.opacity,aC.opacity),at.uniform3f(aA.color,aC.color.r,aC.color.g,aC.color.b),at.uniform1f(aA.rotation,aC.rotation),at.uniform2fv(aA.scale,aJ),aC.mergeWith3D&&!C?(at.enable(at.DEPTH_TEST),C=!0):!aC.mergeWith3D&&C&&(at.disable(at.DEPTH_TEST),C=!1),au(aC.blending),y(aC.map,0),at.drawElements(at.TRIANGLES,6,at.UNSIGNED_SHORT,0))}at.enable(at.CULL_FACE);at.enable(at.DEPTH_TEST);at.depthMask(az)}aG&&aG.minFilter!==c.NearestFilter&&aG.minFilter!==c.LinearFilter&&(aG instanceof c.WebGLRenderTargetCube?(at.bindTexture(at.TEXTURE_CUBE_MAP,aG.__webglTexture),at.generateMipmap(at.TEXTURE_CUBE_MAP),at.bindTexture(at.TEXTURE_CUBE_MAP,null)):(at.bindTexture(at.TEXTURE_2D,aG.__webglTexture),at.generateMipmap(at.TEXTURE_2D),at.bindTexture(at.TEXTURE_2D,null)))};this.initWebGLObjects=function(aL){if(!aL.__webglObjects){aL.__webglObjects=[],aL.__webglObjectsImmediate=[],aL.__webglSprites=[]}for(;aL.__objectsAdded.length;){var aN=aL.__objectsAdded[0],ba=aL,bf=void 0,be=void 0,bc=void 0;if(!aN.__webglInit){if(aN.__webglInit=!0,aN._modelViewMatrix=new c.Matrix4,aN._normalMatrixArray=new Float32Array(9),aN._modelViewMatrixArray=new Float32Array(16),aN._objectMatrixArray=new Float32Array(16),aN.matrixWorld.flattenToArray(aN._objectMatrixArray),aN instanceof c.Mesh){be=aN.geometry;if(be.geometryGroups===void 0){var bc=be,z=void 0,C=void 0,aZ=void 0,aA=void 0,aD=void 0,bi=void 0,aB=void 0,aC={},aQ=bc.morphTargets.length;bc.geometryGroups={};z=0;for(C=bc.faces.length;z<C;z++){aZ=bc.faces[z],aA=aZ.materialIndex,bi=aA!==void 0?aA:-1,aC[bi]===void 0&&(aC[bi]={hash:bi,counter:0}),aB=aC[bi].hash+"_"+aC[bi].counter,bc.geometryGroups[aB]===void 0&&(bc.geometryGroups[aB]={faces3:[],faces4:[],materialIndex:aA,vertices:0,numMorphTargets:aQ}),aD=aZ instanceof c.Face3?3:4,bc.geometryGroups[aB].vertices+aD>65535&&(aC[bi].counter+=1,aB=aC[bi].hash+"_"+aC[bi].counter,bc.geometryGroups[aB]===void 0&&(bc.geometryGroups[aB]={faces3:[],faces4:[],materialIndex:aA,vertices:0,numMorphTargets:aQ})),aZ instanceof c.Face3?bc.geometryGroups[aB].faces3.push(z):bc.geometryGroups[aB].faces4.push(z),bc.geometryGroups[aB].vertices+=aD}bc.geometryGroupsList=[];z=void 0;for(z in bc.geometryGroups){bc.geometryGroups[z].id=g++,bc.geometryGroupsList.push(bc.geometryGroups[z])}}for(bf in be.geometryGroups){if(bc=be.geometryGroups[bf],!bc.__webglVertexBuffer){z=bc;z.__webglVertexBuffer=at.createBuffer();z.__webglNormalBuffer=at.createBuffer();z.__webglTangentBuffer=at.createBuffer();z.__webglColorBuffer=at.createBuffer();z.__webglUVBuffer=at.createBuffer();z.__webglUV2Buffer=at.createBuffer();z.__webglSkinVertexABuffer=at.createBuffer();z.__webglSkinVertexBBuffer=at.createBuffer();z.__webglSkinIndicesBuffer=at.createBuffer();z.__webglSkinWeightsBuffer=at.createBuffer();z.__webglFaceBuffer=at.createBuffer();z.__webglLineBuffer=at.createBuffer();if(z.numMorphTargets){aZ=C=void 0;z.__webglMorphTargetsBuffers=[];C=0;for(aZ=z.numMorphTargets;C<aZ;C++){z.__webglMorphTargetsBuffers.push(at.createBuffer())}}U.info.memory.geometries++;aA=aN;aD=aA.geometry;C=bc.faces3;bi=bc.faces4;z=C.length*3+bi.length*4;aZ=C.length*1+bi.length*2;bi=C.length*3+bi.length*4;C=j(aA,bc);aB=p(C);aC=n(C);aQ=s(C);bc.__vertexArray=new Float32Array(z*3);if(aC){bc.__normalArray=new Float32Array(z*3)}if(aD.hasTangents){bc.__tangentArray=new Float32Array(z*4)}if(aQ){bc.__colorArray=new Float32Array(z*3)}if(aB){if(aD.faceUvs.length>0||aD.faceVertexUvs.length>0){bc.__uvArray=new Float32Array(z*2)}if(aD.faceUvs.length>1||aD.faceVertexUvs.length>1){bc.__uv2Array=new Float32Array(z*2)}}if(aA.geometry.skinWeights.length&&aA.geometry.skinIndices.length){bc.__skinVertexAArray=new Float32Array(z*4),bc.__skinVertexBArray=new Float32Array(z*4),bc.__skinIndexArray=new Float32Array(z*4),bc.__skinWeightArray=new Float32Array(z*4)}bc.__faceArray=new Uint16Array(aZ*3);bc.__lineArray=new Uint16Array(bi*2);if(bc.numMorphTargets){bc.__morphTargetsArrays=[];aA=0;for(aD=bc.numMorphTargets;aA<aD;aA++){bc.__morphTargetsArrays.push(new Float32Array(z*3))}}bc.__webglFaceCount=aZ*3;bc.__webglLineCount=bi*2;if(C.attributes){if(bc.__webglCustomAttributesList===void 0){bc.__webglCustomAttributesList=[]}aZ=void 0;for(aZ in C.attributes){var aA=C.attributes[aZ],aD={},bm;for(bm in aA){aD[bm]=aA[bm]}if(!aD.__webglInitialized||aD.createUniqueBuffers){aD.__webglInitialized=!0,bi=1,aD.type==="v2"?bi=2:aD.type==="v3"?bi=3:aD.type==="v4"?bi=4:aD.type==="c"&&(bi=3),aD.size=bi,aD.array=new Float32Array(z*bi),aD.buffer=at.createBuffer(),aD.buffer.belongsToAttribute=aZ,aA.needsUpdate=!0,aD.__original=aA}bc.__webglCustomAttributesList.push(aD)}}bc.__inittedArrays=!0;be.__dirtyVertices=!0;be.__dirtyMorphTargets=!0;be.__dirtyElements=!0;be.__dirtyUvs=!0;be.__dirtyNormals=!0;be.__dirtyTangents=!0;be.__dirtyColors=!0}}}else{if(aN instanceof c.Ribbon){if(be=aN.geometry,!be.__webglVertexBuffer){bc=be,bc.__webglVertexBuffer=at.createBuffer(),bc.__webglColorBuffer=at.createBuffer(),U.info.memory.geometries++,bc=be,z=bc.vertices.length,bc.__vertexArray=new Float32Array(z*3),bc.__colorArray=new Float32Array(z*3),bc.__webglVertexCount=z,be.__dirtyVertices=!0,be.__dirtyColors=!0}}else{if(aN instanceof c.Line){if(be=aN.geometry,!be.__webglVertexBuffer){bc=be,bc.__webglVertexBuffer=at.createBuffer(),bc.__webglColorBuffer=at.createBuffer(),U.info.memory.geometries++,bc=be,z=aN,C=bc.vertices.length,bc.__vertexArray=new Float32Array(C*3),bc.__colorArray=new Float32Array(C*3),bc.__webglLineCount=C,l(bc,z),be.__dirtyVertices=!0,be.__dirtyColors=!0}}else{if(aN instanceof c.ParticleSystem&&(be=aN.geometry,!be.__webglVertexBuffer)){bc=be,bc.__webglVertexBuffer=at.createBuffer(),bc.__webglColorBuffer=at.createBuffer(),U.info.geometries++,bc=be,z=aN,C=bc.vertices.length,bc.__vertexArray=new Float32Array(C*3),bc.__colorArray=new Float32Array(C*3),bc.__sortArray=[],bc.__webglParticleCount=C,l(bc,z),be.__dirtyVertices=!0,be.__dirtyColors=!0}}}}}if(!aN.__webglActive){if(aN instanceof c.Mesh){for(bf in be=aN.geometry,be.geometryGroups){bc=be.geometryGroups[bf],r(ba.__webglObjects,bc,aN)}}else{aN instanceof c.Ribbon||aN instanceof c.Line||aN instanceof c.ParticleSystem?(be=aN.geometry,r(ba.__webglObjects,be,aN)):c.MarchingCubes!==void 0&&aN instanceof c.MarchingCubes||aN.immediateRenderCallback?ba.__webglObjectsImmediate.push({object:aN,opaque:null,transparent:null}):aN instanceof c.Sprite&&ba.__webglSprites.push(aN)}aN.__webglActive=!0}aL.__objectsAdded.splice(0,1)}for(;aL.__objectsRemoved.length;){aN=aL.__objectsRemoved[0];ba=aL;if(aN instanceof c.Mesh||aN instanceof c.ParticleSystem||aN instanceof c.Ribbon||aN instanceof c.Line){av(ba.__webglObjects,aN)}else{if(aN instanceof c.Sprite){ba=ba.__webglSprites;bf=aN;for(be=ba.length-1;be>=0;be--){ba[be]===bf&&ba.splice(be,1)}}else{(aN instanceof c.MarchingCubes||aN.immediateRenderCallback)&&av(ba.__webglObjectsImmediate,aN)}}aN.__webglActive=!1;aL.__objectsRemoved.splice(0,1)}aN=0;for(ba=aL.__webglObjects.length;aN<ba;aN++){if(bm=aL.__webglObjects[aN].object,bf=bm.geometry,be=aZ=C=void 0,bm instanceof c.Mesh){bc=0;for(z=bf.geometryGroupsList.length;bc<z;bc++){if(C=bf.geometryGroupsList[bc],be=j(bm,C),aZ=be.attributes&&A(be),bf.__dirtyVertices||bf.__dirtyMorphTargets||bf.__dirtyElements||bf.__dirtyUvs||bf.__dirtyNormals||bf.__dirtyColors||bf.__dirtyTangents||aZ){var bu=bm,aZ=at.DYNAMIC_DRAW,aA=!bf.dynamic,aB=be;if(C.__inittedArrays){var aD=n(aB),bi=s(aB),br=p(aB),aR=aD===c.SmoothShading,a4=aC=aB=void 0,bt=void 0,bw=void 0,aP=void 0,by=void 0,bq=void 0,bk=void 0,bv=a4=void 0,aJ=void 0,aF=void 0,a6=void 0,a9=bt=void 0,bA=void 0,aY=void 0,a0=bt=bk=void 0,aW=void 0,a5=a6=aF=aJ=by=void 0,aX=bt=a6=aF=aJ=a5=a6=aF=aJ=a5=a6=aF=aJ=void 0,a8=void 0,aH=aP=void 0,bx=void 0,bz=void 0,bn=void 0,bp=void 0,aI=bv=bz=a8=0,bo=0,bj=aX=a4=0,bb=by=a9=0,bs=0,aS=void 0,bb=C.__vertexArray,bx=C.__uvArray,bs=C.__uv2Array,aH=C.__normalArray,bw=C.__tangentArray,bA=C.__colorArray,a0=C.__skinVertexAArray,aW=C.__skinVertexBArray,bq=C.__skinIndexArray,a2=C.__skinWeightArray,a5=C.__morphTargetsArrays,aQ=C.__webglCustomAttributesList,aM=void 0,aM=C.__faceArray,aS=C.__lineArray,aY=bu.geometry,D=aY.__dirtyElements,a3=aY.__dirtyUvs,aP=aY.__dirtyNormals,bk=aY.__dirtyTangents,aG=aY.__dirtyColors,bn=aY.__dirtyMorphTargets,bp=aY.vertices,bu=C.faces3,bl=C.faces4,bg=aY.faces,a1=aY.faceVertexUvs[0],bh=aY.faceVertexUvs[1],bd=aY.skinVerticesA,aK=aY.skinVerticesB,aE=aY.skinIndices,aO=aY.skinWeights,a7=aY.morphTargets;if(aY.__dirtyVertices){aB=0;for(aC=bu.length;aB<aC;aB++){bt=bg[bu[aB]],aJ=bp[bt.a].position,aF=bp[bt.b].position,a6=bp[bt.c].position,bb[bz]=aJ.x,bb[bz+1]=aJ.y,bb[bz+2]=aJ.z,bb[bz+3]=aF.x,bb[bz+4]=aF.y,bb[bz+5]=aF.z,bb[bz+6]=a6.x,bb[bz+7]=a6.y,bb[bz+8]=a6.z,bz+=9}aB=0;for(aC=bl.length;aB<aC;aB++){bt=bg[bl[aB]],aJ=bp[bt.a].position,aF=bp[bt.b].position,a6=bp[bt.c].position,bt=bp[bt.d].position,bb[bz]=aJ.x,bb[bz+1]=aJ.y,bb[bz+2]=aJ.z,bb[bz+3]=aF.x,bb[bz+4]=aF.y,bb[bz+5]=aF.z,bb[bz+6]=a6.x,bb[bz+7]=a6.y,bb[bz+8]=a6.z,bb[bz+9]=bt.x,bb[bz+10]=bt.y,bb[bz+11]=bt.z,bz+=12}at.bindBuffer(at.ARRAY_BUFFER,C.__webglVertexBuffer);at.bufferData(at.ARRAY_BUFFER,bb,aZ)}if(bn){bz=0;for(bn=a7.length;bz<bn;bz++){aB=bb=0;for(aC=bu.length;aB<aC;aB++){bt=bg[bu[aB]],aJ=a7[bz].vertices[bt.a].position,aF=a7[bz].vertices[bt.b].position,a6=a7[bz].vertices[bt.c].position,bp=a5[bz],bp[bb]=aJ.x,bp[bb+1]=aJ.y,bp[bb+2]=aJ.z,bp[bb+3]=aF.x,bp[bb+4]=aF.y,bp[bb+5]=aF.z,bp[bb+6]=a6.x,bp[bb+7]=a6.y,bp[bb+8]=a6.z,bb+=9}aB=0;for(aC=bl.length;aB<aC;aB++){bt=bg[bl[aB]],aJ=a7[bz].vertices[bt.a].position,aF=a7[bz].vertices[bt.b].position,a6=a7[bz].vertices[bt.c].position,bt=a7[bz].vertices[bt.d].position,bp=a5[bz],bp[bb]=aJ.x,bp[bb+1]=aJ.y,bp[bb+2]=aJ.z,bp[bb+3]=aF.x,bp[bb+4]=aF.y,bp[bb+5]=aF.z,bp[bb+6]=a6.x,bp[bb+7]=a6.y,bp[bb+8]=a6.z,bp[bb+9]=bt.x,bp[bb+10]=bt.y,bp[bb+11]=bt.z,bb+=12}at.bindBuffer(at.ARRAY_BUFFER,C.__webglMorphTargetsBuffers[bz]);at.bufferData(at.ARRAY_BUFFER,a5[bz],aZ)}}if(aO.length){aB=0;for(aC=bu.length;aB<aC;aB++){bt=bg[bu[aB]],aJ=aO[bt.a],aF=aO[bt.b],a6=aO[bt.c],a2[by]=aJ.x,a2[by+1]=aJ.y,a2[by+2]=aJ.z,a2[by+3]=aJ.w,a2[by+4]=aF.x,a2[by+5]=aF.y,a2[by+6]=aF.z,a2[by+7]=aF.w,a2[by+8]=a6.x,a2[by+9]=a6.y,a2[by+10]=a6.z,a2[by+11]=a6.w,aJ=aE[bt.a],aF=aE[bt.b],a6=aE[bt.c],bq[by]=aJ.x,bq[by+1]=aJ.y,bq[by+2]=aJ.z,bq[by+3]=aJ.w,bq[by+4]=aF.x,bq[by+5]=aF.y,bq[by+6]=aF.z,bq[by+7]=aF.w,bq[by+8]=a6.x,bq[by+9]=a6.y,bq[by+10]=a6.z,bq[by+11]=a6.w,aJ=bd[bt.a],aF=bd[bt.b],a6=bd[bt.c],a0[by]=aJ.x,a0[by+1]=aJ.y,a0[by+2]=aJ.z,a0[by+3]=1,a0[by+4]=aF.x,a0[by+5]=aF.y,a0[by+6]=aF.z,a0[by+7]=1,a0[by+8]=a6.x,a0[by+9]=a6.y,a0[by+10]=a6.z,a0[by+11]=1,aJ=aK[bt.a],aF=aK[bt.b],a6=aK[bt.c],aW[by]=aJ.x,aW[by+1]=aJ.y,aW[by+2]=aJ.z,aW[by+3]=1,aW[by+4]=aF.x,aW[by+5]=aF.y,aW[by+6]=aF.z,aW[by+7]=1,aW[by+8]=a6.x,aW[by+9]=a6.y,aW[by+10]=a6.z,aW[by+11]=1,by+=12}aB=0;for(aC=bl.length;aB<aC;aB++){bt=bg[bl[aB]],aJ=aO[bt.a],aF=aO[bt.b],a6=aO[bt.c],a5=aO[bt.d],a2[by]=aJ.x,a2[by+1]=aJ.y,a2[by+2]=aJ.z,a2[by+3]=aJ.w,a2[by+4]=aF.x,a2[by+5]=aF.y,a2[by+6]=aF.z,a2[by+7]=aF.w,a2[by+8]=a6.x,a2[by+9]=a6.y,a2[by+10]=a6.z,a2[by+11]=a6.w,a2[by+12]=a5.x,a2[by+13]=a5.y,a2[by+14]=a5.z,a2[by+15]=a5.w,aJ=aE[bt.a],aF=aE[bt.b],a6=aE[bt.c],a5=aE[bt.d],bq[by]=aJ.x,bq[by+1]=aJ.y,bq[by+2]=aJ.z,bq[by+3]=aJ.w,bq[by+4]=aF.x,bq[by+5]=aF.y,bq[by+6]=aF.z,bq[by+7]=aF.w,bq[by+8]=a6.x,bq[by+9]=a6.y,bq[by+10]=a6.z,bq[by+11]=a6.w,bq[by+12]=a5.x,bq[by+13]=a5.y,bq[by+14]=a5.z,bq[by+15]=a5.w,aJ=bd[bt.a],aF=bd[bt.b],a6=bd[bt.c],a5=bd[bt.d],a0[by]=aJ.x,a0[by+1]=aJ.y,a0[by+2]=aJ.z,a0[by+3]=1,a0[by+4]=aF.x,a0[by+5]=aF.y,a0[by+6]=aF.z,a0[by+7]=1,a0[by+8]=a6.x,a0[by+9]=a6.y,a0[by+10]=a6.z,a0[by+11]=1,a0[by+12]=a5.x,a0[by+13]=a5.y,a0[by+14]=a5.z,a0[by+15]=1,aJ=aK[bt.a],aF=aK[bt.b],a6=aK[bt.c],bt=aK[bt.d],aW[by]=aJ.x,aW[by+1]=aJ.y,aW[by+2]=aJ.z,aW[by+3]=1,aW[by+4]=aF.x,aW[by+5]=aF.y,aW[by+6]=aF.z,aW[by+7]=1,aW[by+8]=a6.x,aW[by+9]=a6.y,aW[by+10]=a6.z,aW[by+11]=1,aW[by+12]=bt.x,aW[by+13]=bt.y,aW[by+14]=bt.z,aW[by+15]=1,by+=16}by>0&&(at.bindBuffer(at.ARRAY_BUFFER,C.__webglSkinVertexABuffer),at.bufferData(at.ARRAY_BUFFER,a0,aZ),at.bindBuffer(at.ARRAY_BUFFER,C.__webglSkinVertexBBuffer),at.bufferData(at.ARRAY_BUFFER,aW,aZ),at.bindBuffer(at.ARRAY_BUFFER,C.__webglSkinIndicesBuffer),at.bufferData(at.ARRAY_BUFFER,bq,aZ),at.bindBuffer(at.ARRAY_BUFFER,C.__webglSkinWeightsBuffer),at.bufferData(at.ARRAY_BUFFER,a2,aZ))}if(aG&&bi){aB=0;for(aC=bu.length;aB<aC;aB++){bt=bg[bu[aB]],by=bt.vertexColors,bq=bt.color,by.length===3&&bi===c.VertexColors?(bt=by[0],a0=by[1],aW=by[2]):aW=a0=bt=bq,bA[a9]=bt.r,bA[a9+1]=bt.g,bA[a9+2]=bt.b,bA[a9+3]=a0.r,bA[a9+4]=a0.g,bA[a9+5]=a0.b,bA[a9+6]=aW.r,bA[a9+7]=aW.g,bA[a9+8]=aW.b,a9+=9}aB=0;for(aC=bl.length;aB<aC;aB++){bt=bg[bl[aB]],by=bt.vertexColors,bq=bt.color,by.length===4&&bi===c.VertexColors?(bt=by[0],a0=by[1],aW=by[2],by=by[3]):by=aW=a0=bt=bq,bA[a9]=bt.r,bA[a9+1]=bt.g,bA[a9+2]=bt.b,bA[a9+3]=a0.r,bA[a9+4]=a0.g,bA[a9+5]=a0.b,bA[a9+6]=aW.r,bA[a9+7]=aW.g,bA[a9+8]=aW.b,bA[a9+9]=by.r,bA[a9+10]=by.g,bA[a9+11]=by.b,a9+=12}a9>0&&(at.bindBuffer(at.ARRAY_BUFFER,C.__webglColorBuffer),at.bufferData(at.ARRAY_BUFFER,bA,aZ))}if(bk&&aY.hasTangents){aB=0;for(aC=bu.length;aB<aC;aB++){bt=bg[bu[aB]],bk=bt.vertexTangents,a9=bk[0],bA=bk[1],aY=bk[2],bw[aX]=a9.x,bw[aX+1]=a9.y,bw[aX+2]=a9.z,bw[aX+3]=a9.w,bw[aX+4]=bA.x,bw[aX+5]=bA.y,bw[aX+6]=bA.z,bw[aX+7]=bA.w,bw[aX+8]=aY.x,bw[aX+9]=aY.y,bw[aX+10]=aY.z,bw[aX+11]=aY.w,aX+=12}aB=0;for(aC=bl.length;aB<aC;aB++){bt=bg[bl[aB]],bk=bt.vertexTangents,a9=bk[0],bA=bk[1],aY=bk[2],bk=bk[3],bw[aX]=a9.x,bw[aX+1]=a9.y,bw[aX+2]=a9.z,bw[aX+3]=a9.w,bw[aX+4]=bA.x,bw[aX+5]=bA.y,bw[aX+6]=bA.z,bw[aX+7]=bA.w,bw[aX+8]=aY.x,bw[aX+9]=aY.y,bw[aX+10]=aY.z,bw[aX+11]=aY.w,bw[aX+12]=bk.x,bw[aX+13]=bk.y,bw[aX+14]=bk.z,bw[aX+15]=bk.w,aX+=16}at.bindBuffer(at.ARRAY_BUFFER,C.__webglTangentBuffer);at.bufferData(at.ARRAY_BUFFER,bw,aZ)}if(aP&&aD){aB=0;for(aC=bu.length;aB<aC;aB++){if(bt=bg[bu[aB]],bw=bt.vertexNormals,aP=bt.normal,bw.length===3&&aR){for(aX=0;aX<3;aX++){aP=bw[aX],aH[a4]=aP.x,aH[a4+1]=aP.y,aH[a4+2]=aP.z,a4+=3}}else{for(aX=0;aX<3;aX++){aH[a4]=aP.x,aH[a4+1]=aP.y,aH[a4+2]=aP.z,a4+=3}}}aB=0;for(aC=bl.length;aB<aC;aB++){if(bt=bg[bl[aB]],bw=bt.vertexNormals,aP=bt.normal,bw.length===4&&aR){for(aX=0;aX<4;aX++){aP=bw[aX],aH[a4]=aP.x,aH[a4+1]=aP.y,aH[a4+2]=aP.z,a4+=3}}else{for(aX=0;aX<4;aX++){aH[a4]=aP.x,aH[a4+1]=aP.y,aH[a4+2]=aP.z,a4+=3}}}at.bindBuffer(at.ARRAY_BUFFER,C.__webglNormalBuffer);at.bufferData(at.ARRAY_BUFFER,aH,aZ)}if(a3&&a1&&br){aB=0;for(aC=bu.length;aB<aC;aB++){if(a4=bu[aB],a4=a1[a4],a4!==void 0){for(aX=0;aX<3;aX++){aH=a4[aX],bx[bv]=aH.u,bx[bv+1]=aH.v,bv+=2}}}aB=0;for(aC=bl.length;aB<aC;aB++){if(a4=bl[aB],a4=a1[a4],a4!==void 0){for(aX=0;aX<4;aX++){aH=a4[aX],bx[bv]=aH.u,bx[bv+1]=aH.v,bv+=2}}}bv>0&&(at.bindBuffer(at.ARRAY_BUFFER,C.__webglUVBuffer),at.bufferData(at.ARRAY_BUFFER,bx,aZ))}if(a3&&bh&&br){aB=0;for(aC=bu.length;aB<aC;aB++){if(a4=bu[aB],bv=bh[a4],bv!==void 0){for(aX=0;aX<3;aX++){bx=bv[aX],bs[aI]=bx.u,bs[aI+1]=bx.v,aI+=2}}}aB=0;for(aC=bl.length;aB<aC;aB++){if(a4=bl[aB],bv=bh[a4],bv!==void 0){for(aX=0;aX<4;aX++){bx=bv[aX],bs[aI]=bx.u,bs[aI+1]=bx.v,aI+=2}}}aI>0&&(at.bindBuffer(at.ARRAY_BUFFER,C.__webglUV2Buffer),at.bufferData(at.ARRAY_BUFFER,bs,aZ))}if(D){aB=0;for(aC=bu.length;aB<aC;aB++){aM[bo]=a8,aM[bo+1]=a8+1,aM[bo+2]=a8+2,bo+=3,aS[bj]=a8,aS[bj+1]=a8+1,aS[bj+2]=a8,aS[bj+3]=a8+2,aS[bj+4]=a8+1,aS[bj+5]=a8+2,bj+=6,a8+=3}aB=0;for(aC=bl.length;aB<aC;aB++){aM[bo]=a8,aM[bo+1]=a8+1,aM[bo+2]=a8+3,aM[bo+3]=a8+1,aM[bo+4]=a8+2,aM[bo+5]=a8+3,bo+=6,aS[bj]=a8,aS[bj+1]=a8+1,aS[bj+2]=a8,aS[bj+3]=a8+3,aS[bj+4]=a8+1,aS[bj+5]=a8+2,aS[bj+6]=a8+2,aS[bj+7]=a8+3,bj+=8,a8+=4}at.bindBuffer(at.ELEMENT_ARRAY_BUFFER,C.__webglFaceBuffer);at.bufferData(at.ELEMENT_ARRAY_BUFFER,aM,aZ);at.bindBuffer(at.ELEMENT_ARRAY_BUFFER,C.__webglLineBuffer);at.bufferData(at.ELEMENT_ARRAY_BUFFER,aS,aZ)}if(aQ){aX=0;for(a8=aQ.length;aX<a8;aX++){if(aM=aQ[aX],aM.__original.needsUpdate){bs=0;if(aM.size===1){if(aM.boundTo===void 0||aM.boundTo==="vertices"){aB=0;for(aC=bu.length;aB<aC;aB++){bt=bg[bu[aB]],aM.array[bs]=aM.value[bt.a],aM.array[bs+1]=aM.value[bt.b],aM.array[bs+2]=aM.value[bt.c],bs+=3}aB=0;for(aC=bl.length;aB<aC;aB++){bt=bg[bl[aB]],aM.array[bs]=aM.value[bt.a],aM.array[bs+1]=aM.value[bt.b],aM.array[bs+2]=aM.value[bt.c],aM.array[bs+3]=aM.value[bt.d],bs+=4}}else{if(aM.boundTo==="faces"){aB=0;for(aC=bu.length;aB<aC;aB++){aS=aM.value[bu[aB]],aM.array[bs]=aS,aM.array[bs+1]=aS,aM.array[bs+2]=aS,bs+=3}aB=0;for(aC=bl.length;aB<aC;aB++){aS=aM.value[bl[aB]],aM.array[bs]=aS,aM.array[bs+1]=aS,aM.array[bs+2]=aS,aM.array[bs+3]=aS,bs+=4}}}}else{if(aM.size===2){if(aM.boundTo===void 0||aM.boundTo==="vertices"){aB=0;for(aC=bu.length;aB<aC;aB++){bt=bg[bu[aB]],aJ=aM.value[bt.a],aF=aM.value[bt.b],a6=aM.value[bt.c],aM.array[bs]=aJ.x,aM.array[bs+1]=aJ.y,aM.array[bs+2]=aF.x,aM.array[bs+3]=aF.y,aM.array[bs+4]=a6.x,aM.array[bs+5]=a6.y,bs+=6}aB=0;for(aC=bl.length;aB<aC;aB++){bt=bg[bl[aB]],aJ=aM.value[bt.a],aF=aM.value[bt.b],a6=aM.value[bt.c],bt=aM.value[bt.d],aM.array[bs]=aJ.x,aM.array[bs+1]=aJ.y,aM.array[bs+2]=aF.x,aM.array[bs+3]=aF.y,aM.array[bs+4]=a6.x,aM.array[bs+5]=a6.y,aM.array[bs+6]=bt.x,aM.array[bs+7]=bt.y,bs+=8}}else{if(aM.boundTo==="faces"){aB=0;for(aC=bu.length;aB<aC;aB++){a6=aF=aJ=aS=aM.value[bu[aB]],aM.array[bs]=aJ.x,aM.array[bs+1]=aJ.y,aM.array[bs+2]=aF.x,aM.array[bs+3]=aF.y,aM.array[bs+4]=a6.x,aM.array[bs+5]=a6.y,bs+=6}aB=0;for(aC=bl.length;aB<aC;aB++){bt=a6=aF=aJ=aS=aM.value[bl[aB]],aM.array[bs]=aJ.x,aM.array[bs+1]=aJ.y,aM.array[bs+2]=aF.x,aM.array[bs+3]=aF.y,aM.array[bs+4]=a6.x,aM.array[bs+5]=a6.y,aM.array[bs+6]=bt.x,aM.array[bs+7]=bt.y,bs+=8}}}}else{if(aM.size===3){if(aD=aM.type==="c"?["r","g","b"]:["x","y","z"],aM.boundTo===void 0||aM.boundTo==="vertices"){aB=0;for(aC=bu.length;aB<aC;aB++){bt=bg[bu[aB]],aJ=aM.value[bt.a],aF=aM.value[bt.b],a6=aM.value[bt.c],aM.array[bs]=aJ[aD[0]],aM.array[bs+1]=aJ[aD[1]],aM.array[bs+2]=aJ[aD[2]],aM.array[bs+3]=aF[aD[0]],aM.array[bs+4]=aF[aD[1]],aM.array[bs+5]=aF[aD[2]],aM.array[bs+6]=a6[aD[0]],aM.array[bs+7]=a6[aD[1]],aM.array[bs+8]=a6[aD[2]],bs+=9}aB=0;for(aC=bl.length;aB<aC;aB++){bt=bg[bl[aB]],aJ=aM.value[bt.a],aF=aM.value[bt.b],a6=aM.value[bt.c],bt=aM.value[bt.d],aM.array[bs]=aJ[aD[0]],aM.array[bs+1]=aJ[aD[1]],aM.array[bs+2]=aJ[aD[2]],aM.array[bs+3]=aF[aD[0]],aM.array[bs+4]=aF[aD[1]],aM.array[bs+5]=aF[aD[2]],aM.array[bs+6]=a6[aD[0]],aM.array[bs+7]=a6[aD[1]],aM.array[bs+8]=a6[aD[2]],aM.array[bs+9]=bt[aD[0]],aM.array[bs+10]=bt[aD[1]],aM.array[bs+11]=bt[aD[2]],bs+=12}}else{if(aM.boundTo==="faces"){aB=0;for(aC=bu.length;aB<aC;aB++){a6=aF=aJ=aS=aM.value[bu[aB]],aM.array[bs]=aJ[aD[0]],aM.array[bs+1]=aJ[aD[1]],aM.array[bs+2]=aJ[aD[2]],aM.array[bs+3]=aF[aD[0]],aM.array[bs+4]=aF[aD[1]],aM.array[bs+5]=aF[aD[2]],aM.array[bs+6]=a6[aD[0]],aM.array[bs+7]=a6[aD[1]],aM.array[bs+8]=a6[aD[2]],bs+=9}aB=0;for(aC=bl.length;aB<aC;aB++){bt=a6=aF=aJ=aS=aM.value[bl[aB]],aM.array[bs]=aJ[aD[0]],aM.array[bs+1]=aJ[aD[1]],aM.array[bs+2]=aJ[aD[2]],aM.array[bs+3]=aF[aD[0]],aM.array[bs+4]=aF[aD[1]],aM.array[bs+5]=aF[aD[2]],aM.array[bs+6]=a6[aD[0]],aM.array[bs+7]=a6[aD[1]],aM.array[bs+8]=a6[aD[2]],aM.array[bs+9]=bt[aD[0]],aM.array[bs+10]=bt[aD[1]],aM.array[bs+11]=bt[aD[2]],bs+=12}}}}else{if(aM.size===4){if(aM.boundTo===void 0||aM.boundTo==="vertices"){aB=0;for(aC=bu.length;aB<aC;aB++){bt=bg[bu[aB]],aJ=aM.value[bt.a],aF=aM.value[bt.b],a6=aM.value[bt.c],aM.array[bs]=aJ.x,aM.array[bs+1]=aJ.y,aM.array[bs+2]=aJ.z,aM.array[bs+3]=aJ.w,aM.array[bs+4]=aF.x,aM.array[bs+5]=aF.y,aM.array[bs+6]=aF.z,aM.array[bs+7]=aF.w,aM.array[bs+8]=a6.x,aM.array[bs+9]=a6.y,aM.array[bs+10]=a6.z,aM.array[bs+11]=a6.w,bs+=12}aB=0;for(aC=bl.length;aB<aC;aB++){bt=bg[bl[aB]],aJ=aM.value[bt.a],aF=aM.value[bt.b],a6=aM.value[bt.c],bt=aM.value[bt.d],aM.array[bs]=aJ.x,aM.array[bs+1]=aJ.y,aM.array[bs+2]=aJ.z,aM.array[bs+3]=aJ.w,aM.array[bs+4]=aF.x,aM.array[bs+5]=aF.y,aM.array[bs+6]=aF.z,aM.array[bs+7]=aF.w,aM.array[bs+8]=a6.x,aM.array[bs+9]=a6.y,aM.array[bs+10]=a6.z,aM.array[bs+11]=a6.w,aM.array[bs+12]=bt.x,aM.array[bs+13]=bt.y,aM.array[bs+14]=bt.z,aM.array[bs+15]=bt.w,bs+=16}}else{if(aM.boundTo==="faces"){aB=0;for(aC=bu.length;aB<aC;aB++){a6=aF=aJ=aS=aM.value[bu[aB]],aM.array[bs]=aJ.x,aM.array[bs+1]=aJ.y,aM.array[bs+2]=aJ.z,aM.array[bs+3]=aJ.w,aM.array[bs+4]=aF.x,aM.array[bs+5]=aF.y,aM.array[bs+6]=aF.z,aM.array[bs+7]=aF.w,aM.array[bs+8]=a6.x,aM.array[bs+9]=a6.y,aM.array[bs+10]=a6.z,aM.array[bs+11]=a6.w,bs+=12}aB=0;for(aC=bl.length;aB<aC;aB++){bt=a6=aF=aJ=aS=aM.value[bl[aB]],aM.array[bs]=aJ.x,aM.array[bs+1]=aJ.y,aM.array[bs+2]=aJ.z,aM.array[bs+3]=aJ.w,aM.array[bs+4]=aF.x,aM.array[bs+5]=aF.y,aM.array[bs+6]=aF.z,aM.array[bs+7]=aF.w,aM.array[bs+8]=a6.x,aM.array[bs+9]=a6.y,aM.array[bs+10]=a6.z,aM.array[bs+11]=a6.w,aM.array[bs+12]=bt.x,aM.array[bs+13]=bt.y,aM.array[bs+14]=bt.z,aM.array[bs+15]=bt.w,bs+=16}}}}}}}at.bindBuffer(at.ARRAY_BUFFER,aM.buffer);at.bufferData(at.ARRAY_BUFFER,aM.array,aZ)}}}aA&&(delete C.__inittedArrays,delete C.__colorArray,delete C.__normalArray,delete C.__tangentArray,delete C.__uvArray,delete C.__uv2Array,delete C.__faceArray,delete C.__vertexArray,delete C.__lineArray,delete C.__skinVertexAArray,delete C.__skinVertexBArray,delete C.__skinIndexArray,delete C.__skinWeightArray)}}}bf.__dirtyVertices=!1;bf.__dirtyMorphTargets=!1;bf.__dirtyElements=!1;bf.__dirtyUvs=!1;bf.__dirtyNormals=!1;bf.__dirtyColors=!1;bf.__dirtyTangents=!1;be.attributes&&H(be)}else{if(bm instanceof c.Ribbon){if(bf.__dirtyVertices||bf.__dirtyColors){be=bf;bm=at.DYNAMIC_DRAW;aD=bc=aD=aA=aA=void 0;bi=be.vertices;z=be.colors;aB=bi.length;C=z.length;aC=be.__vertexArray;aZ=be.__colorArray;aQ=be.__dirtyColors;if(be.__dirtyVertices){for(aA=0;aA<aB;aA++){aD=bi[aA].position,bc=aA*3,aC[bc]=aD.x,aC[bc+1]=aD.y,aC[bc+2]=aD.z}at.bindBuffer(at.ARRAY_BUFFER,be.__webglVertexBuffer);at.bufferData(at.ARRAY_BUFFER,aC,bm)}if(aQ){for(aA=0;aA<C;aA++){aD=z[aA],bc=aA*3,aZ[bc]=aD.r,aZ[bc+1]=aD.g,aZ[bc+2]=aD.b}at.bindBuffer(at.ARRAY_BUFFER,be.__webglColorBuffer);at.bufferData(at.ARRAY_BUFFER,aZ,bm)}}bf.__dirtyVertices=!1;bf.__dirtyColors=!1}else{if(bm instanceof c.Line){be=j(bm,C);aZ=be.attributes&&A(be);if(bf.__dirtyVertices||bf.__dirtyColors||aZ){bm=bf;bc=at.DYNAMIC_DRAW;aB=z=aR=bi=br=void 0;bi=bm.vertices;C=bm.colors;aB=bi.length;aZ=C.length;aC=bm.__vertexArray;aA=bm.__colorArray;aQ=bm.__dirtyColors;aD=bm.__webglCustomAttributesList;a8=bg=bl=bu=aR=br=void 0;if(bm.__dirtyVertices){for(br=0;br<aB;br++){aR=bi[br].position,z=br*3,aC[z]=aR.x,aC[z+1]=aR.y,aC[z+2]=aR.z}at.bindBuffer(at.ARRAY_BUFFER,bm.__webglVertexBuffer);at.bufferData(at.ARRAY_BUFFER,aC,bc)}if(aQ){for(bi=0;bi<aZ;bi++){aB=C[bi],z=bi*3,aA[z]=aB.r,aA[z+1]=aB.g,aA[z+2]=aB.b}at.bindBuffer(at.ARRAY_BUFFER,bm.__webglColorBuffer);at.bufferData(at.ARRAY_BUFFER,aA,bc)}if(aD){br=0;for(aR=aD.length;br<aR;br++){if(a8=aD[br],a8.needsUpdate&&(a8.boundTo===void 0||a8.boundTo==="vertices")){z=0;bl=a8.value.length;if(a8.size===1){for(bu=0;bu<bl;bu++){a8.array[bu]=a8.value[bu]}}else{if(a8.size===2){for(bu=0;bu<bl;bu++){bg=a8.value[bu],a8.array[z]=bg.x,a8.array[z+1]=bg.y,z+=2}}else{if(a8.size===3){if(a8.type==="c"){for(bu=0;bu<bl;bu++){bg=a8.value[bu],a8.array[z]=bg.r,a8.array[z+1]=bg.g,a8.array[z+2]=bg.b,z+=3}}else{for(bu=0;bu<bl;bu++){bg=a8.value[bu],a8.array[z]=bg.x,a8.array[z+1]=bg.y,a8.array[z+2]=bg.z,z+=3}}}else{if(a8.size===4){for(bu=0;bu<bl;bu++){bg=a8.value[bu],a8.array[z]=bg.x,a8.array[z+1]=bg.y,a8.array[z+2]=bg.z,a8.array[z+3]=bg.w,z+=4}}}}}at.bindBuffer(at.ARRAY_BUFFER,a8.buffer);at.bufferData(at.ARRAY_BUFFER,a8.array,bc)}}}}bf.__dirtyVertices=!1;bf.__dirtyColors=!1;be.attributes&&H(be)}else{if(bm instanceof c.ParticleSystem){be=j(bm,C),aZ=be.attributes&&A(be),(bf.__dirtyVertices||bf.__dirtyColors||bm.sortParticles||aZ)&&o(bf,at.DYNAMIC_DRAW,bm),bf.__dirtyVertices=!1,bf.__dirtyColors=!1,be.attributes&&H(be)}}}}}};this.initMaterial=function(aF,aH,aL,aJ){var aC,D,aB,aD;aF instanceof c.MeshDepthMaterial?aD="depth":aF instanceof c.MeshNormalMaterial?aD="normal":aF instanceof c.MeshBasicMaterial?aD="basic":aF instanceof c.MeshLambertMaterial?aD="lambert":aF instanceof c.MeshPhongMaterial?aD="phong":aF instanceof c.LineBasicMaterial?aD="basic":aF instanceof c.ParticleBasicMaterial&&(aD="particle_basic");if(aD){var aE=c.ShaderLib[aD];aF.uniforms=c.UniformsUtils.clone(aE.uniforms);aF.vertexShader=aE.vertexShader;aF.fragmentShader=aE.fragmentShader}var aG,aK,z;aG=z=aE=0;for(aK=aH.length;aG<aK;aG++){aB=aH[aG],aB instanceof c.SpotLight&&z++,aB instanceof c.DirectionalLight&&z++,aB instanceof c.PointLight&&aE++}aE+z<=Z?aG=z:(aG=Math.ceil(Z*z/(aE+z)),aE=Z-aG);aB={directional:aG,point:aE};aE=z=0;for(aG=aH.length;aE<aG;aE++){aK=aH[aE],aK instanceof c.SpotLight&&aK.castShadow&&z++}var C=50;if(aJ!==void 0&&aJ instanceof c.SkinnedMesh){C=aJ.bones.length}var aI;aF:{aG=aF.fragmentShader;aK=aF.vertexShader;var aE=aF.uniforms,aH=aF.attributes,aL={map:!!aF.map,envMap:!!aF.envMap,lightMap:!!aF.lightMap,vertexColors:aF.vertexColors,fog:aL,useFog:aF.fog,sizeAttenuation:aF.sizeAttenuation,skinning:aF.skinning,morphTargets:aF.morphTargets,maxMorphTargets:this.maxMorphTargets,maxDirLights:aB.directional,maxPointLights:aB.point,maxBones:C,shadowMapEnabled:this.shadowMapEnabled&&aJ.receiveShadow,shadowMapSoft:this.shadowMapSoft,shadowMapWidth:this.shadowMapWidth,shadowMapHeight:this.shadowMapHeight,maxShadows:z,alphaTest:aF.alphaTest,metal:aF.metal,perPixel:aF.perPixel},aA,aJ=[];aD?aJ.push(aD):(aJ.push(aG),aJ.push(aK));for(aA in aL){aJ.push(aA),aJ.push(aL[aA])}aD=aJ.join();aA=0;for(aJ=V.length;aA<aJ;aA++){if(V[aA].code===aD){aI=V[aA].program;break aF}}aA=at.createProgram();aJ=[ah?"#define VERTEX_TEXTURES":"",U.gammaInput?"#define GAMMA_INPUT":"",U.gammaOutput?"#define GAMMA_OUTPUT":"",U.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"","#define MAX_DIR_LIGHTS "+aL.maxDirLights,"#define MAX_POINT_LIGHTS "+aL.maxPointLights,"#define MAX_SHADOWS "+aL.maxShadows,"#define MAX_BONES "+aL.maxBones,aL.map?"#define USE_MAP":"",aL.envMap?"#define USE_ENVMAP":"",aL.lightMap?"#define USE_LIGHTMAP":"",aL.vertexColors?"#define USE_COLOR":"",aL.skinning?"#define USE_SKINNING":"",aL.morphTargets?"#define USE_MORPHTARGETS":"",aL.perPixel?"#define PHONG_PER_PIXEL":"",aL.shadowMapEnabled?"#define USE_SHADOWMAP":"",aL.shadowMapSoft?"#define SHADOWMAP_SOFT":"",aL.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 objectMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nuniform mat4 cameraInverseMatrix;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n#ifdef USE_COLOR\nattribute vec3 color;\n#endif\n#ifdef USE_MORPHTARGETS\nattribute vec3 morphTarget0;\nattribute vec3 morphTarget1;\nattribute vec3 morphTarget2;\nattribute vec3 morphTarget3;\nattribute vec3 morphTarget4;\nattribute vec3 morphTarget5;\nattribute vec3 morphTarget6;\nattribute vec3 morphTarget7;\n#endif\n#ifdef USE_SKINNING\nattribute vec4 skinVertexA;\nattribute vec4 skinVertexB;\nattribute vec4 skinIndex;\nattribute vec4 skinWeight;\n#endif\n"].join("\n");aB=["#ifdef GL_ES","precision "+am+" float;","#endif","#define MAX_DIR_LIGHTS "+aL.maxDirLights,"#define MAX_POINT_LIGHTS "+aL.maxPointLights,"#define MAX_SHADOWS "+aL.maxShadows,aL.alphaTest?"#define ALPHATEST "+aL.alphaTest:"",U.gammaInput?"#define GAMMA_INPUT":"",U.gammaOutput?"#define GAMMA_OUTPUT":"",U.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"",aL.useFog&&aL.fog?"#define USE_FOG":"",aL.useFog&&aL.fog instanceof c.FogExp2?"#define FOG_EXP2":"",aL.map?"#define USE_MAP":"",aL.envMap?"#define USE_ENVMAP":"",aL.lightMap?"#define USE_LIGHTMAP":"",aL.vertexColors?"#define USE_COLOR":"",aL.metal?"#define METAL":"",aL.perPixel?"#define PHONG_PER_PIXEL":"",aL.shadowMapEnabled?"#define USE_SHADOWMAP":"",aL.shadowMapSoft?"#define SHADOWMAP_SOFT":"",aL.shadowMapSoft?"#define SHADOWMAP_WIDTH "+aL.shadowMapWidth.toFixed(1):"",aL.shadowMapSoft?"#define SHADOWMAP_HEIGHT "+aL.shadowMapHeight.toFixed(1):"","uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n");at.attachShader(aA,ab("fragment",aB+aG));at.attachShader(aA,ab("vertex",aJ+aK));at.linkProgram(aA);at.getProgramParameter(aA,at.LINK_STATUS)||console.error("Could not initialise shader\nVALIDATE_STATUS: "+at.getProgramParameter(aA,at.VALIDATE_STATUS)+", gl error ["+at.getError()+"]");aA.uniforms={};aA.attributes={};var aM,aJ=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","objectMatrix","cameraPosition","cameraInverseMatrix","boneGlobalMatrices","morphTargetInfluences"];for(aM in aE){aJ.push(aM)}aM=aJ;aJ=0;for(aE=aM.length;aJ<aE;aJ++){aG=aM[aJ],aA.uniforms[aG]=at.getUniformLocation(aA,aG)}aJ=["position","normal","uv","uv2","tangent","color","skinVertexA","skinVertexB","skinIndex","skinWeight"];for(aM=0;aM<aL.maxMorphTargets;aM++){aJ.push("morphTarget"+aM)}for(aI in aH){aJ.push(aI)}aI=aJ;aM=0;for(aH=aI.length;aM<aH;aM++){aL=aI[aM],aA.attributes[aL]=at.getAttribLocation(aA,aL)}aA.id=V.length;V.push({program:aA,code:aD});U.info.memory.programs=V.length;aI=aA}aF.program=aI;aI=aF.program.attributes;aI.position>=0&&at.enableVertexAttribArray(aI.position);aI.color>=0&&at.enableVertexAttribArray(aI.color);aI.normal>=0&&at.enableVertexAttribArray(aI.normal);aI.tangent>=0&&at.enableVertexAttribArray(aI.tangent);aF.skinning&&aI.skinVertexA>=0&&aI.skinVertexB>=0&&aI.skinIndex>=0&&aI.skinWeight>=0&&(at.enableVertexAttribArray(aI.skinVertexA),at.enableVertexAttribArray(aI.skinVertexB),at.enableVertexAttribArray(aI.skinIndex),at.enableVertexAttribArray(aI.skinWeight));if(aF.attributes){for(D in aF.attributes){aI[D]!==void 0&&aI[D]>=0&&at.enableVertexAttribArray(aI[D])}}if(aF.morphTargets){for(D=aF.numSupportedMorphTargets=0;D<this.maxMorphTargets;D++){aM="morphTarget"+D,aI[aM]>=0&&(at.enableVertexAttribArray(aI[aM]),aF.numSupportedMorphTargets++)}}aF.uniformsList=[];for(aC in aF.uniforms){aF.uniformsList.push([aF.uniforms[aC],aC])}};this.setFaceCulling=function(z,C){z?(!C||C==="ccw"?at.frontFace(at.CCW):at.frontFace(at.CW),z==="back"?at.cullFace(at.BACK):z==="front"?at.cullFace(at.FRONT):at.cullFace(at.FRONT_AND_BACK),at.enable(at.CULL_FACE)):at.disable(at.CULL_FACE)}};c.WebGLRenderTarget=function(f,b,a){this.width=f;this.height=b;a=a||{};this.wrapS=a.wrapS!==void 0?a.wrapS:c.ClampToEdgeWrapping;this.wrapT=a.wrapT!==void 0?a.wrapT:c.ClampToEdgeWrapping;this.magFilter=a.magFilter!==void 0?a.magFilter:c.LinearFilter;this.minFilter=a.minFilter!==void 0?a.minFilter:c.LinearMipMapLinearFilter;this.offset=new c.Vector2(0,0);this.repeat=new c.Vector2(1,1);this.format=a.format!==void 0?a.format:c.RGBAFormat;this.type=a.type!==void 0?a.type:c.UnsignedByteType;this.depthBuffer=a.depthBuffer!==void 0?a.depthBuffer:!0;this.stencilBuffer=a.stencilBuffer!==void 0?a.stencilBuffer:!0};c.WebGLRenderTarget.prototype.clone=function(){var a=new c.WebGLRenderTarget(this.width,this.height);a.wrapS=this.wrapS;a.wrapT=this.wrapT;a.magFilter=this.magFilter;a.minFilter=this.minFilter;a.offset.copy(this.offset);a.repeat.copy(this.repeat);a.format=this.format;a.type=this.type;a.depthBuffer=this.depthBuffer;a.stencilBuffer=this.stencilBuffer;return a};c.WebGLRenderTargetCube=function(f,b,a){c.WebGLRenderTarget.call(this,f,b,a);this.activeCubeFace=0};c.WebGLRenderTargetCube.prototype=new c.WebGLRenderTarget;c.WebGLRenderTargetCube.prototype.constructor=c.WebGLRenderTargetCube;c.RenderableVertex=function(){this.positionWorld=new c.Vector3;this.positionScreen=new c.Vector4;this.visible=!0};c.RenderableVertex.prototype.copy=function(a){this.positionWorld.copy(a.positionWorld);this.positionScreen.copy(a.positionScreen)};c.RenderableFace3=function(){this.v1=new c.RenderableVertex;this.v2=new c.RenderableVertex;this.v3=new c.RenderableVertex;this.centroidWorld=new c.Vector3;this.centroidScreen=new c.Vector3;this.normalWorld=new c.Vector3;this.vertexNormalsWorld=[new c.Vector3,new c.Vector3,new c.Vector3];this.faceMaterial=this.material=null;this.uvs=[[]];this.z=null};c.RenderableFace4=function(){this.v1=new c.RenderableVertex;this.v2=new c.RenderableVertex;this.v3=new c.RenderableVertex;this.v4=new c.RenderableVertex;this.centroidWorld=new c.Vector3;this.centroidScreen=new c.Vector3;this.normalWorld=new c.Vector3;this.vertexNormalsWorld=[new c.Vector3,new c.Vector3,new c.Vector3,new c.Vector3];this.faceMaterial=this.material=null;this.uvs=[[]];this.z=null};c.RenderableObject=function(){this.z=this.object=null};c.RenderableParticle=function(){this.rotation=this.z=this.y=this.x=null;this.scale=new c.Vector2;this.material=null};c.RenderableLine=function(){this.z=null;this.v1=new c.RenderableVertex;this.v2=new c.RenderableVertex;this.material=null};c.ColorUtils={adjustHSV:function(b,g,i,j){var a=c.ColorUtils.__hsv;c.ColorUtils.rgbToHsv(b,a);a.h=c.Math.clamp(a.h+g,0,1);a.s=c.Math.clamp(a.s+i,0,1);a.v=c.Math.clamp(a.v+j,0,1);b.setHSV(a.h,a.s,a.v)},rgbToHsv:function(a,g){var e=a.r,b=a.g,p=a.b,h=Math.max(Math.max(e,b),p),f=Math.min(Math.min(e,b),p);if(f===h){f=e=0}else{var o=h-f,f=o/h,e=e===h?(b-p)/o:b===h?2+(p-e)/o:4+(e-b)/o;e/=6;e<0&&(e+=1);e>1&&(e-=1)}g===void 0&&(g={h:0,s:0,v:0});g.h=e;g.s=f;g.v=h;return g}};c.ColorUtils.__hsv={h:0,s:0,v:0};c.GeometryUtils={merge:function(a,f){for(var b,i,r=a.vertices.length,o=f instanceof c.Mesh?f.geometry:f,l=a.vertices,u=o.vertices,e=a.faces,m=o.faces,g=a.faceVertexUvs[0],M=o.faceVertexUvs[0],k={},p=0;p<a.materials.length;p++){k[a.materials[p].id]=p}if(f instanceof c.Mesh){f.matrixAutoUpdate&&f.updateMatrix(),b=f.matrix,i=new c.Matrix4,i.extractRotation(b,f.scale)}for(var p=0,q=u.length;p<q;p++){var w=new c.Vertex(u[p].position.clone());b&&b.multiplyVector3(w.position);l.push(w)}p=0;for(q=m.length;p<q;p++){var l=m[p],n,t,N=l.vertexNormals,h=l.vertexColors;l instanceof c.Face3?n=new c.Face3(l.a+r,l.b+r,l.c+r):l instanceof c.Face4&&(n=new c.Face4(l.a+r,l.b+r,l.c+r,l.d+r));n.normal.copy(l.normal);i&&i.multiplyVector3(n.normal);u=0;for(w=N.length;u<w;u++){t=N[u].clone(),i&&i.multiplyVector3(t),n.vertexNormals.push(t)}n.color.copy(l.color);u=0;for(w=h.length;u<w;u++){t=h[u],n.vertexColors.push(t.clone())}if(l.materialIndex!==void 0){u=o.materials[l.materialIndex];w=k[u.id];if(w===void 0){w=a.materials.length,a.materials.push(u)}n.materialIndex=w}n.centroid.copy(l.centroid);b&&b.multiplyVector3(n.centroid);e.push(n)}p=0;for(q=M.length;p<q;p++){b=M[p];i=[];u=0;for(w=b.length;u<w;u++){i.push(new c.UV(b[u].u,b[u].v))}g.push(i)}},clone:function(g){var i=new c.Geometry,h,k=g.vertices,l=g.faces,x=g.faceVertexUvs[0];if(g.materials){i.materials=g.materials.slice()}g=0;for(h=k.length;g<h;g++){var w=new c.Vertex(k[g].position.clone());i.vertices.push(w)}g=0;for(h=l.length;g<h;g++){var o=l[g],a,e,b=o.vertexNormals,f=o.vertexColors;o instanceof c.Face3?a=new c.Face3(o.a,o.b,o.c):o instanceof c.Face4&&(a=new c.Face4(o.a,o.b,o.c,o.d));a.normal.copy(o.normal);k=0;for(w=b.length;k<w;k++){e=b[k],a.vertexNormals.push(e.clone())}a.color.copy(o.color);k=0;for(w=f.length;k<w;k++){e=f[k],a.vertexColors.push(e.clone())}a.materialIndex=o.materialIndex;a.centroid.copy(o.centroid);i.faces.push(a)}g=0;for(h=x.length;g<h;g++){l=x[g];a=[];k=0;for(w=l.length;k<w;k++){a.push(new c.UV(l[k].u,l[k].v))}i.faceVertexUvs[0].push(a)}return i},randomPointInTriangle:function(a,g,e){var b,p,h,f=new c.Vector3,o=c.GeometryUtils.__v1;b=c.GeometryUtils.random();p=c.GeometryUtils.random();b+p>1&&(b=1-b,p=1-p);h=1-b-p;f.copy(a);f.multiplyScalar(b);o.copy(g);o.multiplyScalar(p);f.addSelf(o);o.copy(e);o.multiplyScalar(h);f.addSelf(o);return f},randomPointInFace:function(g,b,a){var m,f,e;if(g instanceof c.Face3){return m=b.vertices[g.a].position,f=b.vertices[g.b].position,e=b.vertices[g.c].position,c.GeometryUtils.randomPointInTriangle(m,f,e)}else{if(g instanceof c.Face4){m=b.vertices[g.a].position;f=b.vertices[g.b].position;e=b.vertices[g.c].position;var b=b.vertices[g.d].position,n;a?g._area1&&g._area2?(a=g._area1,n=g._area2):(a=c.GeometryUtils.triangleArea(m,f,b),n=c.GeometryUtils.triangleArea(f,e,b),g._area1=a,g._area2=n):(a=c.GeometryUtils.triangleArea(m,f,b),n=c.GeometryUtils.triangleArea(f,e,b));return c.GeometryUtils.random()*(a+n)<a?c.GeometryUtils.randomPointInTriangle(m,f,b):c.GeometryUtils.randomPointInTriangle(f,e,b)}}},randomPointsInGeometry:function(l,A){function m(n){function j(q,r){if(r<q){return q}var s=q+Math.floor((r-q)/2);return i[s]>n?j(q,s-1):i[s]<n?j(s+1,r):s}return j(0,i.length-1)}var B,e,b=l.faces,a=l.vertices,f=b.length,g=0,i=[],h,o,p,k;for(e=0;e<f;e++){B=b[e];if(B instanceof c.Face3){h=a[B.a].position,o=a[B.b].position,p=a[B.c].position,B._area=c.GeometryUtils.triangleArea(h,o,p)}else{if(B instanceof c.Face4){h=a[B.a].position,o=a[B.b].position,p=a[B.c].position,k=a[B.d].position,B._area1=c.GeometryUtils.triangleArea(h,o,k),B._area2=c.GeometryUtils.triangleArea(o,p,k),B._area=B._area1+B._area2}}g+=B._area;i[e]=g}B=[];a={};for(e=0;e<A;e++){f=c.GeometryUtils.random()*g,f=m(f),B[e]=c.GeometryUtils.randomPointInFace(b[f],l,!0),a[f]?a[f]+=1:a[f]=1}return B},triangleArea:function(b,g,i){var j,a=c.GeometryUtils.__v1;a.sub(b,g);j=a.length();a.sub(b,i);b=a.length();a.sub(g,i);i=a.length();g=0.5*(j+b+i);return Math.sqrt(g*(g-j)*(g-b)*(g-i))},center:function(b){b.computeBoundingBox();var a=new c.Matrix4;a.setTranslation(-0.5*(b.boundingBox.x[1]+b.boundingBox.x[0]),-0.5*(b.boundingBox.y[1]+b.boundingBox.y[0]),-0.5*(b.boundingBox.z[1]+b.boundingBox.z[0]));b.applyMatrix(a);b.computeBoundingBox()}};c.GeometryUtils.random=c.Math.random16;c.GeometryUtils.__v1=new c.Vector3;c.ImageUtils={loadTexture:function(b,g,i){var j=new Image,a=new c.Texture(j,g);j.onload=function(){a.needsUpdate=!0;i&&i(this)};j.crossOrigin="";j.src=b;return a},loadTextureCube:function(k,g,a){var l,f=[],b=new c.Texture(f,g),g=f.loadCount=0;for(l=k.length;g<l;++g){f[g]=new Image,f[g].onload=function(){f.loadCount+=1;if(f.loadCount===6){b.needsUpdate=!0}a&&a(this)},f[g].crossOrigin="",f[g].src=k[g]}return b},getNormalMap:function(b,k){var f=function(s){var j=Math.sqrt(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]);return[s[0]/j,s[1]/j,s[2]/j]};k|=1;var n=b.width,a=b.height,r=document.createElement("canvas");r.width=n;r.height=a;var q=r.getContext("2d");q.drawImage(b,0,0);for(var g=q.getImageData(0,0,n,a).data,m=q.createImageData(n,a),w=m.data,o=0;o<n;o++){for(var l=1;l<a;l++){var p=l-1<0?a-1:l-1,K=(l+1)%a,e=o-1<0?n-1:o-1,h=(o+1)%n,t=[],i=[0,0,g[(l*n+o)*4]/255*k];t.push([-1,0,g[(l*n+e)*4]/255*k]);t.push([-1,-1,g[(p*n+e)*4]/255*k]);t.push([0,-1,g[(p*n+o)*4]/255*k]);t.push([1,-1,g[(p*n+h)*4]/255*k]);t.push([1,0,g[(l*n+h)*4]/255*k]);t.push([1,1,g[(K*n+h)*4]/255*k]);t.push([0,1,g[(K*n+o)*4]/255*k]);t.push([-1,1,g[(K*n+e)*4]/255*k]);p=[];e=t.length;for(K=0;K<e;K++){var h=t[K],L=t[(K+1)%e],h=[h[0]-i[0],h[1]-i[1],h[2]-i[2]],L=[L[0]-i[0],L[1]-i[1],L[2]-i[2]];p.push(f([h[1]*L[2]-h[2]*L[1],h[2]*L[0]-h[0]*L[2],h[0]*L[1]-h[1]*L[0]]))}t=[0,0,0];for(K=0;K<p.length;K++){t[0]+=p[K][0],t[1]+=p[K][1],t[2]+=p[K][2]}t[0]/=p.length;t[1]/=p.length;t[2]/=p.length;i=(l*n+o)*4;w[i]=(t[0]+1)/2*255|0;w[i+1]=(t[1]+0.5)*255|0;w[i+2]=t[2]*255|0;w[i+3]=255}}q.putImageData(m,0,0);return r}};c.SceneUtils={showHierarchy:function(b,a){c.SceneUtils.traverseHierarchy(b,function(e){e.visible=a})},traverseHierarchy:function(b,g){var i,j,a=b.children.length;for(j=0;j<a;j++){i=b.children[j],g(i),c.SceneUtils.traverseHierarchy(i,g)}},createMultiMaterialObject:function(k,g){var a,l=g.length,f=new c.Object3D;for(a=0;a<l;a++){var b=new c.Mesh(k,g[a]);f.add(b)}return f},cloneObject:function(a){var g;a instanceof c.MorphAnimMesh?(g=new c.MorphAnimMesh(a.geometry,a.material),g.duration=a.duration,g.mirroredLoop=a.mirroredLoop,g.time=a.time,g.lastKeyframe=a.lastKeyframe,g.currentKeyframe=a.currentKeyframe,g.direction=a.direction,g.directionBackwards=a.directionBackwards):a instanceof c.SkinnedMesh?g=new c.SkinnedMesh(a.geometry,a.material):a instanceof c.Mesh?g=new c.Mesh(a.geometry,a.material):a instanceof c.Line?g=new c.Line(a.geometry,a.material,a.type):a instanceof c.Ribbon?g=new c.Ribbon(a.geometry,a.material):a instanceof c.ParticleSystem?(g=new c.ParticleSystem(a.geometry,a.material),g.sortParticles=a.sortParticles):a instanceof c.Particle?g=new c.Particle(a.material):a instanceof c.Sprite?(g=new c.Sprite({}),g.color.copy(a.color),g.map=a.map,g.blending=a.blending,g.useScreenCoordinates=a.useScreenCoordinates,g.mergeWith3D=a.mergeWith3D,g.affectedByDistance=a.affectedByDistance,g.scaleByViewport=a.scaleByViewport,g.alignment=a.alignment,g.rotation3d.copy(a.rotation3d),g.rotation=a.rotation,g.opacity=a.opacity,g.uvOffset.copy(a.uvOffset),g.uvScale.copy(a.uvScale)):a instanceof c.LOD?g=new c.LOD:a instanceof c.MarchingCubes?(g=new c.MarchingCubes(a.resolution,a.material),g.field.set(a.field),g.isolation=a.isolation):a instanceof c.Object3D&&(g=new c.Object3D);g.parent=a.parent;g.up.copy(a.up);g.position.copy(a.position);g.rotation instanceof c.Vector3&&g.rotation.copy(a.rotation);g.eulerOrder=a.eulerOrder;g.scale.copy(a.scale);g.dynamic=a.dynamic;g.doubleSided=a.doubleSided;g.flipSided=a.flipSided;g.renderDepth=a.renderDepth;g.rotationAutoUpdate=a.rotationAutoUpdate;g.matrix.copy(a.matrix);g.matrixWorld.copy(a.matrixWorld);g.matrixRotationWorld.copy(a.matrixRotationWorld);g.matrixAutoUpdate=a.matrixAutoUpdate;g.matrixWorldNeedsUpdate=a.matrixWorldNeedsUpdate;g.quaternion.copy(a.quaternion);g.useQuaternion=a.useQuaternion;g.boundRadius=a.boundRadius;g.boundRadiusScale=a.boundRadiusScale;g.visible=a.visible;g.castShadow=a.castShadow;g.receiveShadow=a.receiveShadow;g.frustumCulled=a.frustumCulled;for(var b=0;b<a.children.length;b++){var h=c.SceneUtils.cloneObject(a.children[b]);g.children[b]=h;h.parent=g}if(a instanceof c.LOD){for(b=0;b<a.LODs.length;b++){g.LODs[b]={visibleAtDistance:a.LODs[b].visibleAtDistance,object3D:g.children[b]}}}return g}};if(c.WebGLRenderer){c.ShaderUtils={lib:{fresnel:{uniforms:{mRefractionRatio:{type:"f",value:1.02},mFresnelBias:{type:"f",value:0.1},mFresnelPower:{type:"f",value:2},mFresnelScale:{type:"f",value:1},tCube:{type:"t",value:1,texture:null}},fragmentShader:"uniform samplerCube tCube;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\nvec4 refractedColor = vec4( 1.0, 1.0, 1.0, 1.0 );\nrefractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;\nrefractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;\nrefractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;\nrefractedColor.a = 1.0;\ngl_FragColor = mix( refractedColor, reflectedColor, clamp( vReflectionFactor, 0.0, 1.0 ) );\n}",vertexShader:"uniform float mRefractionRatio;\nuniform float mFresnelBias;\nuniform float mFresnelScale;\nuniform float mFresnelPower;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = normalize ( mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal );\nvec3 I = mPosition.xyz - cameraPosition;\nvReflect = reflect( I, nWorld );\nvRefract[0] = refract( normalize( I ), nWorld, mRefractionRatio );\nvRefract[1] = refract( normalize( I ), nWorld, mRefractionRatio * 0.99 );\nvRefract[2] = refract( normalize( I ), nWorld, mRefractionRatio * 0.98 );\nvReflectionFactor = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( I ), nWorld ), mFresnelPower );\ngl_Position = projectionMatrix * mvPosition;\n}"},normal:{uniforms:c.UniformsUtils.merge([c.UniformsLib.fog,c.UniformsLib.lights,c.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},tDiffuse:{type:"t",value:0,texture:null},tCube:{type:"t",value:1,texture:null},tNormal:{type:"t",value:2,texture:null},tSpecular:{type:"t",value:3,texture:null},tAO:{type:"t",value:4,texture:null},tDisplacement:{type:"t",value:5,texture:null},uNormalScale:{type:"f",value:1},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new c.Color(15658734)},uSpecularColor:{type:"c",value:new c.Color(1118481)},uAmbientColor:{type:"c",value:new c.Color(328965)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1},uReflectivity:{type:"f",value:0.5},uOffset:{type:"v2",value:new c.Vector2(0,0)},uRepeat:{type:"v2",value:new c.Vector2(1,1)}}]),fragmentShader:["uniform vec3 uAmbientColor;\nuniform vec3 uDiffuseColor;\nuniform vec3 uSpecularColor;\nuniform float uShininess;\nuniform float uOpacity;\nuniform bool enableDiffuse;\nuniform bool enableSpecular;\nuniform bool enableAO;\nuniform bool enableReflection;\nuniform sampler2D tDiffuse;\nuniform sampler2D tNormal;\nuniform sampler2D tSpecular;\nuniform sampler2D tAO;\nuniform samplerCube tCube;\nuniform float uNormalScale;\nuniform float uReflectivity;\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\nvarying vec3 vViewPosition;",c.ShaderChunk.shadowmap_pars_fragment,c.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3( 1.0 ), uOpacity );\nvec3 specularTex = vec3( 1.0 );\nvec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;\nnormalTex.xy *= uNormalScale;\nnormalTex = normalize( normalTex );\nif( enableDiffuse )\ngl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );\nif( enableAO )\ngl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;\nif( enableSpecular )\nspecularTex = texture2D( tSpecular, vUv ).xyz;\nmat3 tsb = mat3( vTangent, vBinormal, vNormal );\nvec3 finalNormal = tsb * normalTex;\nvec3 normal = normalize( finalNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec3 pointVector = normalize( vPointLight[ i ].xyz );\nvec3 pointHalfVector = normalize( vPointLight[ i ].xyz + viewPosition );\nfloat pointDistance = vPointLight[ i ].w;\nfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\nfloat pointSpecularWeight = specularTex.r * pow( pointDotNormalHalf, uShininess );\npointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;\npointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nvec3 dirHalfVector = normalize( lDirection.xyz + viewPosition );\nfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\nfloat dirSpecularWeight = specularTex.r * pow( dirDotNormalHalf, uShininess );\ndirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;\ndirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;\n}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\ngl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor) + totalSpecular;\nif ( enableReflection ) {\nvec3 wPos = cameraPosition - vViewPosition;\nvec3 vReflect = reflect( normalize( wPos ), normal );\nvec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\ngl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, uReflectivity );\n}",c.ShaderChunk.shadowmap_fragment,c.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;\nuniform vec2 uOffset;\nuniform vec2 uRepeat;\n#ifdef VERTEX_TEXTURES\nuniform sampler2D tDisplacement;\nuniform float uDisplacementScale;\nuniform float uDisplacementBias;\n#endif\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\nvarying vec3 vViewPosition;",c.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvViewPosition = -mvPosition.xyz;\nvNormal = normalize( normalMatrix * normal );\nvTangent = normalize( normalMatrix * tangent.xyz );\nvBinormal = cross( vNormal, vTangent ) * tangent.w;\nvBinormal = normalize( vBinormal );\nvUv = uv * uRepeat + uOffset;\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nvPointLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#ifdef VERTEX_TEXTURES\nvec3 dv = texture2D( tDisplacement, uv ).xyz;\nfloat df = uDisplacementScale * dv.x + uDisplacementBias;\nvec4 displacedPosition = vec4( vNormal.xyz * df, 0.0 ) + mvPosition;\ngl_Position = projectionMatrix * displacedPosition;\n#else\ngl_Position = projectionMatrix * mvPosition;\n#endif",c.ShaderChunk.shadowmap_vertex,"}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:1,texture:null},tFlip:{type:"f",value:-1}},vertexShader:"varying vec3 vViewPosition;\nvoid main() {\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvViewPosition = cameraPosition - mPosition.xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform samplerCube tCube;\nuniform float tFlip;\nvarying vec3 vViewPosition;\nvoid main() {\nvec3 wPos = cameraPosition - vViewPosition;\ngl_FragColor = textureCube( tCube, vec3( tFlip * wPos.x, wPos.yz ) );\n}"}}}}c.Curve=function(){};c.Curve.prototype.getPoint=function(){console.log("Warning, getPoint() not implemented!");return null};c.Curve.prototype.getPointAt=function(a){return this.getPoint(this.getUtoTmapping(a))};c.Curve.prototype.getPoints=function(f){f||(f=5);var b,a=[];for(b=0;b<=f;b++){a.push(this.getPoint(b/f))}return a};c.Curve.prototype.getSpacedPoints=function(f){f||(f=5);var b,a=[];for(b=0;b<=f;b++){a.push(this.getPointAt(b/f))}return a};c.Curve.prototype.getLength=function(){var a=this.getLengths();return a[a.length-1]};c.Curve.prototype.getLengths=function(k){k||(k=200);if(this.cacheArcLengths&&this.cacheArcLengths.length==k+1){return this.cacheArcLengths}var g=[],a,l=this.getPoint(0),f,b=0;g.push(0);for(f=1;f<=k;f++){a=this.getPoint(f/k),b+=a.distanceTo(l),g.push(b),l=a}return this.cacheArcLengths=g};c.Curve.prototype.getUtoTmapping=function(e,g){var f=this.getLengths(),h=0,r=f.length,q;q=g?g:e*f[r-1];for(var i=0,a=r-1,b;i<=a;){if(h=Math.floor(i+(a-i)/2),b=f[h]-q,b<0){i=h+1}else{if(b>0){a=h-1}else{a=h;break}}}h=a;if(f[h]==q){return h/(r-1)}i=f[h];return f=(h+(q-i)/(f[h+1]-i))/(r-1)};c.Curve.prototype.getNormalVector=function(a){a=this.getTangent(a);return new c.Vector2(-a.y,a.x)};c.Curve.prototype.getTangent=function(b){var a=b-0.0001;b+=0.0001;a<0&&(a=0);b>1&&(b=1);a=this.getPoint(a);b=this.getPoint(b);return a.clone().subSelf(b).normalize()};c.Curve.prototype.getTangentAt=function(a){return this.getTangent(this.getUtoTmapping(a))};c.LineCurve=function(b,a){b instanceof c.Vector2?(this.v1=b,this.v2=a):c.LineCurve.oldConstructor.apply(this,arguments)};c.LineCurve.oldConstructor=function(a,g,b,h){this.constructor(new c.Vector2(a,g),new c.Vector2(b,h))};c.LineCurve.prototype=new c.Curve;c.LineCurve.prototype.constructor=c.LineCurve;c.LineCurve.prototype.getPoint=function(b){var a=new c.Vector2;a.sub(this.v2,this.v1);a.multiplyScalar(b).addSelf(this.v1);return a};c.LineCurve.prototype.getPointAt=function(a){return this.getPoint(a)};c.LineCurve.prototype.getTangent=function(){var a=new c.Vector2;a.sub(this.v2,this.v1);a.normalize();return a};c.QuadraticBezierCurve=function(a,g,b){if(!(g instanceof c.Vector2)){var h=Array.prototype.slice.call(arguments),a=new c.Vector2(h[0],h[1]),g=new c.Vector2(h[2],h[3]),b=new c.Vector2(h[4],h[5])}this.v0=a;this.v1=g;this.v2=b};c.QuadraticBezierCurve.prototype=new c.Curve;c.QuadraticBezierCurve.prototype.constructor=c.QuadraticBezierCurve;c.QuadraticBezierCurve.prototype.getPoint=function(b){var a;a=c.Shape.Utils.b2(b,this.v0.x,this.v1.x,this.v2.x);b=c.Shape.Utils.b2(b,this.v0.y,this.v1.y,this.v2.y);return new c.Vector2(a,b)};c.QuadraticBezierCurve.prototype.getTangent=function(b){var a;a=c.Curve.Utils.tangentQuadraticBezier(b,this.v0.x,this.v1.x,this.v2.x);b=c.Curve.Utils.tangentQuadraticBezier(b,this.v0.y,this.v1.y,this.v2.y);a=new c.Vector2(a,b);a.normalize();return a};c.CubicBezierCurve=function(b,g,i,j){if(!(g instanceof c.Vector2)){var a=Array.prototype.slice.call(arguments),b=new c.Vector2(a[0],a[1]),g=new c.Vector2(a[2],a[3]),i=new c.Vector2(a[4],a[5]),j=new c.Vector2(a[6],a[7])}this.v0=b;this.v1=g;this.v2=i;this.v3=j};c.CubicBezierCurve.prototype=new c.Curve;c.CubicBezierCurve.prototype.constructor=c.CubicBezierCurve;c.CubicBezierCurve.prototype.getPoint=function(b){var a;a=c.Shape.Utils.b3(b,this.v0.x,this.v1.x,this.v2.x,this.v3.x);b=c.Shape.Utils.b3(b,this.v0.y,this.v1.y,this.v2.y,this.v3.y);return new c.Vector2(a,b)};c.CubicBezierCurve.prototype.getTangent=function(b){var a;a=c.Curve.Utils.tangentCubicBezier(b,this.v0.x,this.v1.x,this.v2.x,this.v3.x);b=c.Curve.Utils.tangentCubicBezier(b,this.v0.y,this.v1.y,this.v2.y,this.v3.y);a=new c.Vector2(a,b);a.normalize();return a};c.SplineCurve=function(a){this.points=a==void 0?[]:a};c.SplineCurve.prototype=new c.Curve;c.SplineCurve.prototype.constructor=c.SplineCurve;c.SplineCurve.prototype.getPoint=function(b){var g=new c.Vector2,i=[],j=this.points,a;a=(j.length-1)*b;b=Math.floor(a);a-=b;i[0]=b==0?b:b-1;i[1]=b;i[2]=b>j.length-2?b:b+1;i[3]=b>j.length-3?b:b+2;g.x=c.Curve.Utils.interpolate(j[i[0]].x,j[i[1]].x,j[i[2]].x,j[i[3]].x,a);g.y=c.Curve.Utils.interpolate(j[i[0]].y,j[i[1]].y,j[i[2]].y,j[i[3]].y,a);return g};c.ArcCurve=function(k,g,a,l,f,b){this.aX=k;this.aY=g;this.aRadius=a;this.aStartAngle=l;this.aEndAngle=f;this.aClockwise=b};c.ArcCurve.prototype=new c.Curve;c.ArcCurve.prototype.constructor=c.ArcCurve;c.ArcCurve.prototype.getPoint=function(b){var a=this.aEndAngle-this.aStartAngle;this.aClockwise||(b=1-b);b=this.aStartAngle+b*a;return new c.Vector2(this.aX+this.aRadius*Math.cos(b),this.aY+this.aRadius*Math.sin(b))};c.Curve.Utils={tangentQuadraticBezier:function(a,g,b,h){return 2*(1-a)*(b-g)+2*a*(h-b)},tangentCubicBezier:function(b,g,i,j,a){return -3*g*(1-b)*(1-b)+3*i*(1-b)*(1-b)-6*b*i*(1-b)+6*b*j*(1-b)-3*b*b*j+3*b*b*a},tangentSpline:function(a){return 6*a*a-6*a+(3*a*a-4*a+1)+(-6*a*a+6*a)+(3*a*a-2*a)},interpolate:function(k,g,a,l,f){var k=(a-k)*0.5,l=(l-g)*0.5,b=f*f;return(2*g-2*a+k+l)*f*b+(-3*g+3*a-2*k-l)*b+k*f+g}};c.Curve.create=function(b,a){b.prototype=new c.Curve;b.prototype.constructor=b;b.prototype.getPoint=a;return b};c.LineCurve3=c.Curve.create(function(b,a){this.v1=b;this.v2=a},function(b){var a=new c.Vector3;a.sub(this.v2,this.v1);a.multiplyScalar(b);a.addSelf(this.v1);return a});c.QuadraticBezierCurve3=c.Curve.create(function(f,b,a){this.v0=f;this.v1=b;this.v2=a},function(f){var b,a;b=c.Shape.Utils.b2(f,this.v0.x,this.v1.x,this.v2.x);a=c.Shape.Utils.b2(f,this.v0.y,this.v1.y,this.v2.y);f=c.Shape.Utils.b2(f,this.v0.z,this.v1.z,this.v2.z);return new c.Vector3(b,a,f)});c.CubicBezierCurve3=c.Curve.create(function(a,g,b,h){this.v0=a;this.v1=g;this.v2=b;this.v3=h},function(f){var b,a;b=c.Shape.Utils.b3(f,this.v0.x,this.v1.x,this.v2.x,this.v3.x);a=c.Shape.Utils.b3(f,this.v0.y,this.v1.y,this.v2.y,this.v3.y);f=c.Shape.Utils.b3(f,this.v0.z,this.v1.z,this.v2.z,this.v3.z);return new c.Vector3(b,a,f)});c.SplineCurve3=c.Curve.create(function(a){this.points=a==void 0?[]:a},function(b){var g=new c.Vector3,i=[],j=this.points,a;a=(j.length-1)*b;b=Math.floor(a);a-=b;i[0]=b==0?b:b-1;i[1]=b;i[2]=b>j.length-2?b:b+1;i[3]=b>j.length-3?b:b+2;g.x=c.Curve.Utils.interpolate(j[i[0]].x,j[i[1]].x,j[i[2]].x,j[i[3]].x,a);g.y=c.Curve.Utils.interpolate(j[i[0]].y,j[i[1]].y,j[i[2]].y,j[i[3]].y,a);g.z=c.Curve.Utils.interpolate(j[i[0]].z,j[i[1]].z,j[i[2]].z,j[i[3]].z,a);return g});c.CurvePath=function(){this.curves=[];this.bends=[]};c.CurvePath.prototype=new c.Curve;c.CurvePath.prototype.constructor=c.CurvePath;c.CurvePath.prototype.add=function(a){this.curves.push(a)};c.CurvePath.prototype.checkConnection=function(){};c.CurvePath.prototype.closePath=function(){};c.CurvePath.prototype.getPoint=function(f){for(var b=f*this.getLength(),a=this.getCurveLengths(),f=0;f<a.length;){if(a[f]>=b){return b=a[f]-b,f=this.curves[f],b=1-b/f.getLength(),f.getPointAt(b)}f++}return null};c.CurvePath.prototype.getLength=function(){var a=this.getCurveLengths();return a[a.length-1]};c.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length){return this.cacheLengths}var a=[],g=0,b,h=this.curves.length;for(b=0;b<h;b++){g+=this.curves[b].getLength(),a.push(g)}return this.cacheLengths=a};c.CurvePath.prototype.getBoundingBox=function(){var e=this.getPoints(),g,f,h,r;g=f=Number.NEGATIVE_INFINITY;h=r=Number.POSITIVE_INFINITY;var q,i,a,b;b=new c.Vector2;i=0;for(a=e.length;i<a;i++){q=e[i];if(q.x>g){g=q.x}else{if(q.x<h){h=q.x}}if(q.y>f){f=q.y}else{if(q.y<f){r=q.y}}b.addSelf(q.x,q.y)}return{minX:h,minY:r,maxX:g,maxY:f,centroid:b.divideScalar(a)}};c.CurvePath.prototype.createPointsGeometry=function(a){return this.createGeometry(this.getPoints(a,!0))};c.CurvePath.prototype.createSpacedPointsGeometry=function(a){return this.createGeometry(this.getSpacedPoints(a,!0))};c.CurvePath.prototype.createGeometry=function(f){for(var b=new c.Geometry,a=0;a<f.length;a++){b.vertices.push(new c.Vertex(new c.Vector3(f[a].x,f[a].y,0)))}return b};c.CurvePath.prototype.addWrapPath=function(a){this.bends.push(a)};c.CurvePath.prototype.getTransformedPoints=function(b,g){var i=this.getPoints(b),j,a;if(!g){g=this.bends}j=0;for(a=g.length;j<a;j++){i=this.getWrapPoints(i,g[j])}return i};c.CurvePath.prototype.getTransformedSpacedPoints=function(b,g){var i=this.getSpacedPoints(b),j,a;if(!g){g=this.bends}j=0;for(a=g.length;j<a;j++){i=this.getWrapPoints(i,g[j])}return i};c.CurvePath.prototype.getWrapPoints=function(e,g){var f=this.getBoundingBox(),h,r,q,i,a,b;h=0;for(r=e.length;h<r;h++){q=e[h],i=q.x,a=q.y,b=i/f.maxX,b=g.getUtoTmapping(b,i),i=g.getPoint(b),a=g.getNormalVector(b).multiplyScalar(a),q.x=i.x+a.x,q.y=i.y+a.y}return e};c.Path=function(a){c.CurvePath.call(this);this.actions=[];a&&this.fromPoints(a)};c.Path.prototype=new c.CurvePath;c.Path.prototype.constructor=c.Path;c.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc"};c.Path.prototype.fromPoints=function(f){this.moveTo(f[0].x,f[0].y);var b,a=f.length;for(b=1;b<a;b++){this.lineTo(f[b].x,f[b].y)}};c.Path.prototype.moveTo=function(){var a=Array.prototype.slice.call(arguments);this.actions.push({action:c.PathActions.MOVE_TO,args:a})};c.Path.prototype.lineTo=function(a,g){var b=Array.prototype.slice.call(arguments),h=this.actions[this.actions.length-1].args;this.curves.push(new c.LineCurve(new c.Vector2(h[h.length-2],h[h.length-1]),new c.Vector2(a,g)));this.actions.push({action:c.PathActions.LINE_TO,args:b})};c.Path.prototype.quadraticCurveTo=function(k,g,a,l){var f=Array.prototype.slice.call(arguments),b=this.actions[this.actions.length-1].args;this.curves.push(new c.QuadraticBezierCurve(new c.Vector2(b[b.length-2],b[b.length-1]),new c.Vector2(k,g),new c.Vector2(a,l)));this.actions.push({action:c.PathActions.QUADRATIC_CURVE_TO,args:f})};c.Path.prototype.bezierCurveTo=function(a,g,e,b,p,h){var f=Array.prototype.slice.call(arguments),o=this.actions[this.actions.length-1].args;this.curves.push(new c.CubicBezierCurve(new c.Vector2(o[o.length-2],o[o.length-1]),new c.Vector2(a,g),new c.Vector2(e,b),new c.Vector2(p,h)));this.actions.push({action:c.PathActions.BEZIER_CURVE_TO,args:f})};c.Path.prototype.splineThru=function(f){var b=Array.prototype.slice.call(arguments),a=this.actions[this.actions.length-1].args,a=[new c.Vector2(a[a.length-2],a[a.length-1])];Array.prototype.push.apply(a,f);this.curves.push(new c.SplineCurve(a));this.actions.push({action:c.PathActions.CSPLINE_THRU,args:b})};c.Path.prototype.arc=function(g,b,a,m,f,e){var n=Array.prototype.slice.call(arguments);this.curves.push(new c.ArcCurve(g,b,a,m,f,e));this.actions.push({action:c.PathActions.ARC,args:n})};c.Path.prototype.getSpacedPoints=function(f){f||(f=40);for(var b=[],a=0;a<f;a++){b.push(this.getPoint(a/f))}return b};c.Path.prototype.getPoints=function(r,k){var r=r||12,g=[],a,e,b,H,f,l,n,m,G,h,o,i,p;a=0;for(e=this.actions.length;a<e;a++){switch(b=this.actions[a],H=b.action,b=b.args,H){case c.PathActions.LINE_TO:g.push(new c.Vector2(b[0],b[1]));break;case c.PathActions.QUADRATIC_CURVE_TO:f=b[2];l=b[3];G=b[0];h=b[1];g.length>0?(H=g[g.length-1],o=H.x,i=H.y):(H=this.actions[a-1].args,o=H[H.length-2],i=H[H.length-1]);for(H=1;H<=r;H++){p=H/r,b=c.Shape.Utils.b2(p,o,G,f),p=c.Shape.Utils.b2(p,i,h,l),g.push(new c.Vector2(b,p))}break;case c.PathActions.BEZIER_CURVE_TO:f=b[4];l=b[5];G=b[0];h=b[1];n=b[2];m=b[3];g.length>0?(H=g[g.length-1],o=H.x,i=H.y):(H=this.actions[a-1].args,o=H[H.length-2],i=H[H.length-1]);for(H=1;H<=r;H++){p=H/r,b=c.Shape.Utils.b3(p,o,G,n,f),p=c.Shape.Utils.b3(p,i,h,m,l),g.push(new c.Vector2(b,p))}break;case c.PathActions.CSPLINE_THRU:H=this.actions[a-1].args;H=[new c.Vector2(H[H.length-2],H[H.length-1])];p=r*b[0].length;H=H.concat(b[0]);b=new c.SplineCurve(H);for(H=1;H<=p;H++){g.push(b.getPointAt(H/p))}break;case c.PathActions.ARC:H=this.actions[a-1].args;f=b[0];l=b[1];n=b[2];G=b[3];p=b[4];h=!!b[5];m=H[H.length-2];o=H[H.length-1];H.length==0&&(m=o=0);i=p-G;var q=r*2;for(H=1;H<=q;H++){p=H/q,h||(p=1-p),p=G+p*i,b=m+f+n*Math.cos(p),p=o+l+n*Math.sin(p),g.push(new c.Vector2(b,p))}}}k&&g.push(g[0]);return g};c.Path.prototype.transform=function(b,a){this.getBoundingBox();return this.getWrapPoints(this.getPoints(a),b)};c.Path.prototype.nltransform=function(g,i,h,k,l,x){var w=this.getPoints(),o,a,e,b,f;o=0;for(a=w.length;o<a;o++){e=w[o],b=e.x,f=e.y,e.x=g*b+i*f+h,e.y=k*f+l*b+x}return w};c.Path.prototype.debug=function(b){var g=this.getBoundingBox();b||(b=document.createElement("canvas"),b.setAttribute("width",g.maxX+100),b.setAttribute("height",g.maxY+100),document.body.appendChild(b));g=b.getContext("2d");g.fillStyle="white";g.fillRect(0,0,b.width,b.height);g.strokeStyle="black";g.beginPath();var i,j,a,b=0;for(i=this.actions.length;b<i;b++){j=this.actions[b],a=j.args,j=j.action,j!=c.PathActions.CSPLINE_THRU&&g[j].apply(g,a)}g.stroke();g.closePath();g.strokeStyle="red";j=this.getPoints();b=0;for(i=j.length;b<i;b++){a=j[b],g.beginPath(),g.arc(a.x,a.y,1.5,0,Math.PI*2,!1),g.stroke(),g.closePath()}};c.Path.prototype.toShapes=function(){var g,b,a,m,f=[],e=new c.Path;g=0;for(b=this.actions.length;g<b;g++){a=this.actions[g],m=a.args,a=a.action,a==c.PathActions.MOVE_TO&&e.actions.length!=0&&(f.push(e),e=new c.Path),e[a].apply(e,m)}e.actions.length!=0&&f.push(e);if(f.length==0){return[]}var n,e=[];if(c.Shape.Utils.isClockWise(f[0].getPoints())){g=0;for(b=f.length;g<b;g++){m=f[g],c.Shape.Utils.isClockWise(m.getPoints())?(n&&e.push(n),n=new c.Shape,n.actions=m.actions,n.curves=m.curves):n.holes.push(m)}e.push(n)}else{n=new c.Shape;g=0;for(b=f.length;g<b;g++){m=f[g],c.Shape.Utils.isClockWise(m.getPoints())?(n.actions=m.actions,n.curves=m.curves,e.push(n),n=new c.Shape):n.holes.push(m)}}return e};c.Shape=function(){c.Path.apply(this,arguments);this.holes=[]};c.Shape.prototype=new c.Path;c.Shape.prototype.constructor=c.Path;c.Shape.prototype.extrude=function(a){return new c.ExtrudeGeometry(this,a)};c.Shape.prototype.getPointsHoles=function(a){var g,b=this.holes.length,h=[];for(g=0;g<b;g++){h[g]=this.holes[g].getTransformedPoints(a,this.bends)}return h};c.Shape.prototype.getSpacedPointsHoles=function(a){var g,b=this.holes.length,h=[];for(g=0;g<b;g++){h[g]=this.holes[g].getTransformedSpacedPoints(a,this.bends)}return h};c.Shape.prototype.extractAllPoints=function(a){return{shape:this.getTransformedPoints(a),holes:this.getPointsHoles(a)}};c.Shape.prototype.extractAllSpacedPoints=function(a){return{shape:this.getTransformedSpacedPoints(a),holes:this.getSpacedPointsHoles(a)}};c.Shape.Utils={removeHoles:function(r,k){var g=r.concat(),a=g.concat(),e,b,H,f,l,n,m,G,h,o,i=[];for(l=0;l<k.length;l++){n=k[l];Array.prototype.push.apply(a,n);b=Number.POSITIVE_INFINITY;for(e=0;e<n.length;e++){h=n[e];o=[];for(G=0;G<g.length;G++){m=g[G],m=h.distanceToSquared(m),o.push(m),m<b&&(b=m,H=e,f=G)}}e=f-1>=0?f-1:g.length-1;b=H-1>=0?H-1:n.length-1;var p=[n[H],g[f],g[e]];G=c.FontUtils.Triangulate.area(p);var q=[n[H],n[b],g[f]];h=c.FontUtils.Triangulate.area(q);o=f;m=H;f+=1;H+=-1;f<0&&(f+=g.length);f%=g.length;H<0&&(H+=n.length);H%=n.length;e=f-1>=0?f-1:g.length-1;b=H-1>=0?H-1:n.length-1;p=[n[H],g[f],g[e]];p=c.FontUtils.Triangulate.area(p);q=[n[H],n[b],g[f]];q=c.FontUtils.Triangulate.area(q);G+h>p+q&&(f=o,H=m,f<0&&(f+=g.length),f%=g.length,H<0&&(H+=n.length),H%=n.length,e=f-1>=0?f-1:g.length-1,b=H-1>=0?H-1:n.length-1);G=g.slice(0,f);h=g.slice(f);o=n.slice(H);m=n.slice(0,H);b=[n[H],n[b],g[f]];i.push([n[H],g[f],g[e]]);i.push(b);g=G.concat(o).concat(m).concat(h)}return{shape:g,isolatedPts:i,allpoints:a}},triangulateShape:function(a,e){var b=c.Shape.Utils.removeHoles(a,e),f=b.allpoints,i=b.isolatedPts,b=c.FontUtils.Triangulate(b.shape,!1),h,g,l,s,t={};h=0;for(g=f.length;h<g;h++){s=f[h].x+":"+f[h].y,t[s]!==void 0&&console.log("Duplicate point",s),t[s]=h}h=0;for(g=b.length;h<g;h++){l=b[h];for(f=0;f<3;f++){s=l[f].x+":"+l[f].y,s=t[s],s!==void 0&&(l[f]=s)}}h=0;for(g=i.length;h<g;h++){l=i[h];for(f=0;f<3;f++){s=l[f].x+":"+l[f].y,s=t[s],s!==void 0&&(l[f]=s)}}return b.concat(i)},isClockWise:function(a){return c.FontUtils.Triangulate.area(a)<0},b2p0:function(f,b){var a=1-f;return a*a*b},b2p1:function(b,a){return 2*(1-b)*b*a},b2p2:function(b,a){return b*b*a},b2:function(a,g,b,h){return this.b2p0(a,g)+this.b2p1(a,b)+this.b2p2(a,h)},b3p0:function(f,b){var a=1-f;return a*a*a*b},b3p1:function(f,b){var a=1-f;return 3*a*a*f*b},b3p2:function(b,a){return 3*(1-b)*b*b*a},b3p3:function(b,a){return b*b*b*a},b3:function(b,g,i,j,a){return this.b3p0(b,g)+this.b3p1(b,i)+this.b3p2(b,j)+this.b3p3(b,a)}};c.TextPath=function(b,a){c.Path.call(this);this.parameters=a||{};this.set(b)};c.TextPath.prototype.set=function(k,g){this.text=k;var g=g||this.parameters,a=g.curveSegments!==void 0?g.curveSegments:4,l=g.font!==void 0?g.font:"helvetiker",f=g.weight!==void 0?g.weight:"normal",b=g.style!==void 0?g.style:"normal";c.FontUtils.size=g.size!==void 0?g.size:100;c.FontUtils.divisions=a;c.FontUtils.face=l;c.FontUtils.weight=f;c.FontUtils.style=b};c.TextPath.prototype.toShapes=function(){for(var a=c.FontUtils.drawText(this.text).paths,g=[],b=0,h=a.length;b<h;b++){Array.prototype.push.apply(g,a[b].toShapes())}return g};c.AnimationHandler=function(){var a=[],g={},b={update:function(f){for(var e=0;e<a.length;e++){a[e].update(f)}},addToUpdate:function(e){a.indexOf(e)===-1&&a.push(e)},removeFromUpdate:function(e){e=a.indexOf(e);e!==-1&&a.splice(e,1)},add:function(l){g[l.name]!==void 0&&console.log("THREE.AnimationHandler.add: Warning! "+l.name+" already exists in library. Overwriting.");g[l.name]=l;if(l.initialized!==!0){for(var s=0;s<l.hierarchy.length;s++){for(var t=0;t<l.hierarchy[s].keys.length;t++){if(l.hierarchy[s].keys[t].time<0){l.hierarchy[s].keys[t].time=0}if(l.hierarchy[s].keys[t].rot!==void 0&&!(l.hierarchy[s].keys[t].rot instanceof c.Quaternion)){var e=l.hierarchy[s].keys[t].rot;l.hierarchy[s].keys[t].rot=new c.Quaternion(e[0],e[1],e[2],e[3])}}if(l.hierarchy[s].keys[0].morphTargets!==void 0){e={};for(t=0;t<l.hierarchy[s].keys.length;t++){for(var f=0;f<l.hierarchy[s].keys[t].morphTargets.length;f++){var r=l.hierarchy[s].keys[t].morphTargets[f];e[r]=-1}}l.hierarchy[s].usedMorphTargets=e;for(t=0;t<l.hierarchy[s].keys.length;t++){var k={};for(r in e){for(f=0;f<l.hierarchy[s].keys[t].morphTargets.length;f++){if(l.hierarchy[s].keys[t].morphTargets[f]===r){k[r]=l.hierarchy[s].keys[t].morphTargetsInfluences[f];break}}f===l.hierarchy[s].keys[t].morphTargets.length&&(k[r]=0)}l.hierarchy[s].keys[t].morphTargetsInfluences=k}}for(t=1;t<l.hierarchy[s].keys.length;t++){l.hierarchy[s].keys[t].time===l.hierarchy[s].keys[t-1].time&&(l.hierarchy[s].keys.splice(t,1),t--)}for(t=1;t<l.hierarchy[s].keys.length;t++){l.hierarchy[s].keys[t].index=t}}t=parseInt(l.length*l.fps,10);l.JIT={};l.JIT.hierarchy=[];for(s=0;s<l.hierarchy.length;s++){l.JIT.hierarchy.push(Array(t))}l.initialized=!0}},get:function(e){if(typeof e==="string"){return g[e]?g[e]:(console.log("THREE.AnimationHandler.get: Couldn't find animation "+e),null)}},parse:function(f){var k=[];if(f instanceof c.SkinnedMesh){for(var e=0;e<f.bones.length;e++){k.push(f.bones[e])}}else{h(f,k)}return k}},h=function(f,k){k.push(f);for(var e=0;e<f.children.length;e++){h(f.children[e],k)}};b.LINEAR=0;b.CATMULLROM=1;b.CATMULLROM_FORWARD=2;return b}();c.Animation=function(a,g,b,h){this.root=a;this.data=c.AnimationHandler.get(g);this.hierarchy=c.AnimationHandler.parse(a);this.currentTime=0;this.timeScale=1;this.isPlaying=!1;this.loop=this.isPaused=!0;this.interpolationType=b!==void 0?b:c.AnimationHandler.LINEAR;this.JITCompile=h!==void 0?h:!0;this.points=[];this.target=new c.Vector3};c.Animation.prototype.play=function(k,g){if(!this.isPlaying){this.isPlaying=!0;this.loop=k!==void 0?k:!0;this.currentTime=g!==void 0?g:0;var a,l=this.hierarchy.length,f;for(a=0;a<l;a++){f=this.hierarchy[a];if(this.interpolationType!==c.AnimationHandler.CATMULLROM_FORWARD){f.useQuaternion=!0}f.matrixAutoUpdate=!0;if(f.animationCache===void 0){f.animationCache={},f.animationCache.prevKey={pos:0,rot:0,scl:0},f.animationCache.nextKey={pos:0,rot:0,scl:0},f.animationCache.originalMatrix=f instanceof c.Bone?f.skinMatrix:f.matrix}var b=f.animationCache.prevKey;f=f.animationCache.nextKey;b.pos=this.data.hierarchy[a].keys[0];b.rot=this.data.hierarchy[a].keys[0];b.scl=this.data.hierarchy[a].keys[0];f.pos=this.getNextKeyWith("pos",a,1);f.rot=this.getNextKeyWith("rot",a,1);f.scl=this.getNextKeyWith("scl",a,1)}this.update(0)}this.isPaused=!1;c.AnimationHandler.addToUpdate(this)};c.Animation.prototype.pause=function(){this.isPaused?c.AnimationHandler.addToUpdate(this):c.AnimationHandler.removeFromUpdate(this);this.isPaused=!this.isPaused};c.Animation.prototype.stop=function(){this.isPaused=this.isPlaying=!1;c.AnimationHandler.removeFromUpdate(this);for(var a=0;a<this.hierarchy.length;a++){if(this.hierarchy[a].animationCache!==void 0){this.hierarchy[a] instanceof c.Bone?this.hierarchy[a].skinMatrix=this.hierarchy[a].animationCache.originalMatrix:this.hierarchy[a].matrix=this.hierarchy[a].animationCache.originalMatrix,delete this.hierarchy[a].animationCache}}};c.Animation.prototype.update=function(k){if(this.isPlaying){var f=["pos","rot","scl"],e,l,p,n,m,r,E,b,F=this.data.JIT.hierarchy,a,g;this.currentTime+=k*this.timeScale;g=this.currentTime;a=this.currentTime%=this.data.length;b=parseInt(Math.min(a*this.data.fps,this.data.length*this.data.fps),10);for(var h=0,o=this.hierarchy.length;h<o;h++){if(k=this.hierarchy[h],E=k.animationCache,this.JITCompile&&F[h][b]!==void 0){k instanceof c.Bone?(k.skinMatrix=F[h][b],k.matrixAutoUpdate=!1,k.matrixWorldNeedsUpdate=!1):(k.matrix=F[h][b],k.matrixAutoUpdate=!1,k.matrixWorldNeedsUpdate=!0)}else{if(this.JITCompile){k instanceof c.Bone?k.skinMatrix=k.animationCache.originalMatrix:k.matrix=k.animationCache.originalMatrix}for(var i=0;i<3;i++){e=f[i];m=E.prevKey[e];r=E.nextKey[e];if(r.time<=g){if(a<g){if(this.loop){m=this.data.hierarchy[h].keys[0];for(r=this.getNextKeyWith(e,h,1);r.time<a;){m=r,r=this.getNextKeyWith(e,h,r.index+1)}}else{this.stop();return}}else{do{m=r,r=this.getNextKeyWith(e,h,r.index+1)}while(r.time<a)}E.prevKey[e]=m;E.nextKey[e]=r}k.matrixAutoUpdate=!0;k.matrixWorldNeedsUpdate=!0;l=(a-m.time)/(r.time-m.time);p=m[e];n=r[e];if(l<0||l>1){console.log("THREE.Animation.update: Warning! Scale out of bounds:"+l+" on bone "+h),l=l<0?0:1}if(e==="pos"){if(e=k.position,this.interpolationType===c.AnimationHandler.LINEAR){e.x=p[0]+(n[0]-p[0])*l,e.y=p[1]+(n[1]-p[1])*l,e.z=p[2]+(n[2]-p[2])*l}else{if(this.interpolationType===c.AnimationHandler.CATMULLROM||this.interpolationType===c.AnimationHandler.CATMULLROM_FORWARD){if(this.points[0]=this.getPrevKeyWith("pos",h,m.index-1).pos,this.points[1]=p,this.points[2]=n,this.points[3]=this.getNextKeyWith("pos",h,r.index+1).pos,l=l*0.33+0.33,p=this.interpolateCatmullRom(this.points,l),e.x=p[0],e.y=p[1],e.z=p[2],this.interpolationType===c.AnimationHandler.CATMULLROM_FORWARD){l=this.interpolateCatmullRom(this.points,l*1.01),this.target.set(l[0],l[1],l[2]),this.target.subSelf(e),this.target.y=0,this.target.normalize(),l=Math.atan2(this.target.x,this.target.z),k.rotation.set(0,l,0)}}}}else{if(e==="rot"){c.Quaternion.slerp(p,n,k.quaternion,l)}else{if(e==="scl"){e=k.scale,e.x=p[0]+(n[0]-p[0])*l,e.y=p[1]+(n[1]-p[1])*l,e.z=p[2]+(n[2]-p[2])*l}}}}}}if(this.JITCompile&&F[0][b]===void 0){this.hierarchy[0].update(null,!0);for(h=0;h<this.hierarchy.length;h++){F[h][b]=this.hierarchy[h] instanceof c.Bone?this.hierarchy[h].skinMatrix.clone():this.hierarchy[h].matrix.clone()}}}};c.Animation.prototype.interpolateCatmullRom=function(a,e){var b=[],f=[],i,h,g,l,s,t;i=(a.length-1)*e;h=Math.floor(i);i-=h;b[0]=h===0?h:h-1;b[1]=h;b[2]=h>a.length-2?h:h+1;b[3]=h>a.length-3?h:h+2;h=a[b[0]];l=a[b[1]];s=a[b[2]];t=a[b[3]];b=i*i;g=i*b;f[0]=this.interpolate(h[0],l[0],s[0],t[0],i,b,g);f[1]=this.interpolate(h[1],l[1],s[1],t[1],i,b,g);f[2]=this.interpolate(h[2],l[2],s[2],t[2],i,b,g);return f};c.Animation.prototype.interpolate=function(g,b,a,m,f,e,n){g=(a-g)*0.5;m=(m-b)*0.5;return(2*(b-a)+g+m)*n+(-3*(b-a)-2*g-m)*e+g*f+b};c.Animation.prototype.getNextKeyWith=function(a,g,b){var h=this.data.hierarchy[g].keys;for(this.interpolationType===c.AnimationHandler.CATMULLROM||this.interpolationType===c.AnimationHandler.CATMULLROM_FORWARD?b=b<h.length-1?b:h.length-1:b%=h.length;b<h.length;b++){if(h[b][a]!==void 0){return h[b]}}return this.data.hierarchy[g].keys[0]};c.Animation.prototype.getPrevKeyWith=function(a,g,b){for(var h=this.data.hierarchy[g].keys,b=this.interpolationType===c.AnimationHandler.CATMULLROM||this.interpolationType===c.AnimationHandler.CATMULLROM_FORWARD?b>0?b:0:b>=0?b:b+h.length;b>=0;b--){if(h[b][a]!==void 0){return h[b]}}return this.data.hierarchy[g].keys[h.length-1]};c.CubeCamera=function(a,g,b,h){this.heightOffset=b;this.position=new c.Vector3(0,b,0);this.cameraPX=new c.PerspectiveCamera(90,1,a,g);this.cameraNX=new c.PerspectiveCamera(90,1,a,g);this.cameraPY=new c.PerspectiveCamera(90,1,a,g);this.cameraNY=new c.PerspectiveCamera(90,1,a,g);this.cameraPZ=new c.PerspectiveCamera(90,1,a,g);this.cameraNZ=new c.PerspectiveCamera(90,1,a,g);this.cameraPX.position=this.position;this.cameraNX.position=this.position;this.cameraPY.position=this.position;this.cameraNY.position=this.position;this.cameraPZ.position=this.position;this.cameraNZ.position=this.position;this.cameraPX.up.set(0,-1,0);this.cameraNX.up.set(0,-1,0);this.cameraPY.up.set(0,0,1);this.cameraNY.up.set(0,0,-1);this.cameraPZ.up.set(0,-1,0);this.cameraNZ.up.set(0,-1,0);this.targetPX=new c.Vector3(0,0,0);this.targetNX=new c.Vector3(0,0,0);this.targetPY=new c.Vector3(0,0,0);this.targetNY=new c.Vector3(0,0,0);this.targetPZ=new c.Vector3(0,0,0);this.targetNZ=new c.Vector3(0,0,0);this.renderTarget=new c.WebGLRenderTargetCube(h,h,{format:c.RGBFormat,magFilter:c.LinearFilter,minFilter:c.LinearFilter});this.updatePosition=function(e){this.position.copy(e);this.position.y+=this.heightOffset;this.targetPX.copy(this.position);this.targetNX.copy(this.position);this.targetPY.copy(this.position);this.targetNY.copy(this.position);this.targetPZ.copy(this.position);this.targetNZ.copy(this.position);this.targetPX.x+=1;this.targetNX.x-=1;this.targetPY.y+=1;this.targetNY.y-=1;this.targetPZ.z+=1;this.targetNZ.z-=1;this.cameraPX.lookAt(this.targetPX);this.cameraNX.lookAt(this.targetNX);this.cameraPY.lookAt(this.targetPY);this.cameraNY.lookAt(this.targetNY);this.cameraPZ.lookAt(this.targetPZ);this.cameraNZ.lookAt(this.targetNZ)};this.updateCubeMap=function(f,k){var e=this.renderTarget;e.activeCubeFace=0;f.render(k,this.cameraPX,e);e.activeCubeFace=1;f.render(k,this.cameraNX,e);e.activeCubeFace=2;f.render(k,this.cameraPY,e);e.activeCubeFace=3;f.render(k,this.cameraNY,e);e.activeCubeFace=4;f.render(k,this.cameraPZ,e);e.activeCubeFace=5;f.render(k,this.cameraNZ,e)}};c.FirstPersonCamera=function(){console.warn("DEPRECATED: FirstPersonCamera() is FirstPersonControls().")};c.PathCamera=function(){console.warn("DEPRECATED: PathCamera() is PathControls().")};c.FlyCamera=function(){console.warn("DEPRECATED: FlyCamera() is FlyControls().")};c.RollCamera=function(){console.warn("DEPRECATED: RollCamera() is RollControls().")};c.TrackballCamera=function(){console.warn("DEPRECATED: TrackballCamera() is TrackballControls().")};c.CombinedCamera=function(g,b,a,m,f,e,n){c.Camera.call(this);this.fov=a;this.left=-g/2;this.right=g/2;this.top=b/2;this.bottom=-b/2;this.cameraO=new c.OrthographicCamera(g/-2,g/2,b/2,b/-2,e,n);this.cameraP=new c.PerspectiveCamera(a,g/b,m,f);this.zoom=1;this.toPerspective()};c.CombinedCamera.prototype=new c.Camera;c.CombinedCamera.prototype.constructor=c.CoolCamera;c.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near;this.far=this.cameraP.far;this.cameraP.fov=this.fov/this.zoom;this.cameraP.updateProjectionMatrix();this.projectionMatrix=this.cameraP.projectionMatrix;this.inPersepectiveMode=!0;this.inOrthographicMode=!1};c.CombinedCamera.prototype.toOrthographic=function(){var b=Math.tan(this.fov/2)*((this.cameraP.near+this.cameraP.far)/2),a=2*b*this.cameraP.aspect/2;b/=this.zoom;a/=this.zoom;this.cameraO.left=-a;this.cameraO.right=a;this.cameraO.top=b;this.cameraO.bottom=-b;this.cameraO.updateProjectionMatrix();this.near=this.cameraO.near;this.far=this.cameraO.far;this.projectionMatrix=this.cameraO.projectionMatrix;this.inPersepectiveMode=!1;this.inOrthographicMode=!0};c.CombinedCamera.prototype.setFov=function(a){this.fov=a;this.inPersepectiveMode?this.toPerspective():this.toOrthographic()};c.CombinedCamera.prototype.setLens=function(f,b){b||(b=43.25);var a=2*Math.atan(b/(f*2));a*=180/Math.PI;this.setFov(a);return a};c.CombinedCamera.prototype.setZoom=function(a){this.zoom=a;this.inPersepectiveMode?this.toPerspective():this.toOrthographic()};c.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=!1};c.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0;this.rotation.y=Math.PI;this.rotation.z=0;this.rotationAutoUpdate=!1};c.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0;this.rotation.y=-Math.PI/2;this.rotation.z=0;this.rotationAutoUpdate=!1};c.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0;this.rotation.y=Math.PI/2;this.rotation.z=0;this.rotationAutoUpdate=!1};c.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=!1};c.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=!1};c.FirstPersonControls=function(f,b){function a(e,i){return function(){i.apply(e,arguments)}}this.object=f;this.target=new c.Vector3(0,0,0);this.domElement=b!==void 0?b:document;this.movementSpeed=1;this.lookSpeed=0.005;this.noFly=!1;this.lookVertical=!0;this.autoForward=!1;this.activeLook=!0;this.heightSpeed=!1;this.heightCoef=1;this.heightMin=0;this.constrainVertical=!1;this.verticalMin=0;this.verticalMax=Math.PI;this.theta=this.phi=this.lon=this.lat=this.mouseY=this.mouseX=this.autoSpeedFactor=0;this.mouseDragOn=this.freeze=this.moveRight=this.moveLeft=this.moveBackward=this.moveForward=!1;this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2,this.domElement.setAttribute("tabindex",-1));this.onMouseDown=function(e){this.domElement!==document&&this.domElement.focus();e.preventDefault();e.stopPropagation();if(this.activeLook){switch(e.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}}this.mouseDragOn=!0};this.onMouseUp=function(e){e.preventDefault();e.stopPropagation();if(this.activeLook){switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}}this.mouseDragOn=!1};this.onMouseMove=function(e){this.domElement===document?(this.mouseX=e.pageX-this.viewHalfX,this.mouseY=e.pageY-this.viewHalfY):(this.mouseX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=e.pageY-this.domElement.offsetTop-this.viewHalfY)};this.onKeyDown=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 82:this.moveUp=!0;break;case 70:this.moveDown=!0;break;case 81:this.freeze=!this.freeze}};this.onKeyUp=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1;break;case 82:this.moveUp=!1;break;case 70:this.moveDown=!1}};this.update=function(j){var k=0;if(!this.freeze){if(this.heightSpeed){var e=c.Math.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=j*e*this.heightCoef}else{this.autoSpeedFactor=0}k=j*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(k+this.autoSpeedFactor));this.moveBackward&&this.object.translateZ(k);this.moveLeft&&this.object.translateX(-k);this.moveRight&&this.object.translateX(k);this.moveUp&&this.object.translateY(k);this.moveDown&&this.object.translateY(-k);e=j*this.lookSpeed;this.activeLook||(e=0);this.lon+=this.mouseX*e;this.lookVertical&&(this.lat-=this.mouseY*e);this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=(90-this.lat)*Math.PI/180;this.theta=this.lon*Math.PI/180;j=this.target;k=this.object.position;j.x=k.x+100*Math.sin(this.phi)*Math.cos(this.theta);j.y=k.y+100*Math.cos(this.phi);j.z=k.z+100*Math.sin(this.phi)*Math.sin(this.theta)}j=1;this.constrainVertical&&(j=Math.PI/(this.verticalMax-this.verticalMin));this.lon+=this.mouseX*e;this.lookVertical&&(this.lat-=this.mouseY*e*j);this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=(90-this.lat)*Math.PI/180;this.theta=this.lon*Math.PI/180;if(this.constrainVertical){this.phi=c.Math.mapLinear(this.phi,0,Math.PI,this.verticalMin,this.verticalMax)}j=this.target;k=this.object.position;j.x=k.x+100*Math.sin(this.phi)*Math.cos(this.theta);j.y=k.y+100*Math.cos(this.phi);j.z=k.z+100*Math.sin(this.phi)*Math.sin(this.theta);this.object.lookAt(j)};this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1);this.domElement.addEventListener("mousemove",a(this,this.onMouseMove),!1);this.domElement.addEventListener("mousedown",a(this,this.onMouseDown),!1);this.domElement.addEventListener("mouseup",a(this,this.onMouseUp),!1);this.domElement.addEventListener("keydown",a(this,this.onKeyDown),!1);this.domElement.addEventListener("keyup",a(this,this.onKeyUp),!1)};c.PathControls=function(a,g){function e(i){if((i*=2)<1){return 0.5*i*i}return -0.5*(--i*(i-2)-1)}function b(i,j){return function(){j.apply(i,arguments)}}function p(z,i,j,k){var l={name:j,fps:0.6,length:k,hierarchy:[]},m,t=i.getControlPointsArray(),n=i.getLength(),x=t.length,y=0;m=x-1;i={parent:-1,keys:[]};i.keys[0]={time:0,pos:t[0],rot:[0,0,0,1],scl:[1,1,1]};i.keys[m]={time:k,pos:t[m],rot:[0,0,0,1],scl:[1,1,1]};for(m=1;m<x-1;m++){y=k*n.chunks[m]/n.total,i.keys[m]={time:y,pos:t[m]}}l.hierarchy[0]=i;c.AnimationHandler.add(l);return new c.Animation(z,j,c.AnimationHandler.CATMULLROM_FORWARD,!1)}function h(j,l){var i,k,m=new c.Geometry;for(i=0;i<j.points.length*l;i++){k=i/(j.points.length*l),k=j.getPoint(k),m.vertices[i]=new c.Vertex(new c.Vector3(k.x,k.y,k.z))}return m}this.object=a;this.domElement=g!==void 0?g:document;this.id="PathControls"+c.PathControlsIdCounter++;this.duration=10000;this.waypoints=[];this.useConstantSpeed=!0;this.resamplingCoef=50;this.debugPath=new c.Object3D;this.debugDummy=new c.Object3D;this.animationParent=new c.Object3D;this.lookSpeed=0.005;this.lookHorizontal=this.lookVertical=!0;this.verticalAngleMap={srcRange:[0,2*Math.PI],dstRange:[0,2*Math.PI]};this.horizontalAngleMap={srcRange:[0,2*Math.PI],dstRange:[0,2*Math.PI]};this.target=new c.Object3D;this.theta=this.phi=this.lon=this.lat=this.mouseY=this.mouseX=0;this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2,this.domElement.setAttribute("tabindex",-1));var f=Math.PI*2,o=Math.PI/180;this.update=function(k){var i;this.lookHorizontal&&(this.lon+=this.mouseX*this.lookSpeed*k);this.lookVertical&&(this.lat-=this.mouseY*this.lookSpeed*k);this.lon=Math.max(0,Math.min(360,this.lon));this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=(90-this.lat)*o;this.theta=this.lon*o;k=this.phi%f;this.phi=k>=0?k:k+f;i=this.verticalAngleMap.srcRange;k=this.verticalAngleMap.dstRange;i=c.Math.mapLinear(this.phi,i[0],i[1],k[0],k[1]);var j=k[1]-k[0];this.phi=e((i-k[0])/j)*j+k[0];i=this.horizontalAngleMap.srcRange;k=this.horizontalAngleMap.dstRange;i=c.Math.mapLinear(this.theta,i[0],i[1],k[0],k[1]);j=k[1]-k[0];this.theta=e((i-k[0])/j)*j+k[0];k=this.target.position;k.x=100*Math.sin(this.phi)*Math.cos(this.theta);k.y=100*Math.cos(this.phi);k.z=100*Math.sin(this.phi)*Math.sin(this.theta);this.object.lookAt(this.target.position)};this.onMouseMove=function(i){this.domElement===document?(this.mouseX=i.pageX-this.viewHalfX,this.mouseY=i.pageY-this.viewHalfY):(this.mouseX=i.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=i.pageY-this.domElement.offsetTop-this.viewHalfY)};this.init=function(){this.spline=new c.Spline;this.spline.initFromArray(this.waypoints);this.useConstantSpeed&&this.spline.reparametrizeByArcLength(this.resamplingCoef);if(this.createDebugDummy){var j=new c.MeshLambertMaterial({color:30719}),m=new c.MeshLambertMaterial({color:65280}),n=new c.CubeGeometry(10,10,20),i=new c.CubeGeometry(2,2,10);this.animationParent=new c.Mesh(n,j);j=new c.Mesh(i,m);j.position.set(0,10,0);this.animation=p(this.animationParent,this.spline,this.id,this.duration);this.animationParent.add(this.object);this.animationParent.add(this.target);this.animationParent.add(j)}else{this.animation=p(this.animationParent,this.spline,this.id,this.duration),this.animationParent.add(this.target),this.animationParent.add(this.object)}if(this.createDebugPath){var j=this.debugPath,m=this.spline,i=h(m,10),n=h(m,10),k=new c.LineBasicMaterial({color:16711680,linewidth:3}),i=new c.Line(i,k),n=new c.ParticleSystem(n,new c.ParticleBasicMaterial({color:16755200,size:3}));i.scale.set(1,1,1);j.add(i);n.scale.set(1,1,1);j.add(n);for(var i=new c.SphereGeometry(1,16,8),k=new c.MeshBasicMaterial({color:65280}),l=0;l<m.points.length;l++){n=new c.Mesh(i,k),n.position.copy(m.points[l]),j.add(n)}}this.domElement.addEventListener("mousemove",b(this,this.onMouseMove),!1)}};c.PathControlsIdCounter=0;c.FlyControls=function(f,b){function a(e,i){return function(){i.apply(e,arguments)}}this.object=f;this.domElement=b!==void 0?b:document;b&&this.domElement.setAttribute("tabindex",-1);this.movementSpeed=1;this.rollSpeed=0.005;this.autoForward=this.dragToLook=!1;this.object.useQuaternion=!0;this.tmpQuaternion=new c.Quaternion;this.mouseStatus=0;this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0};this.moveVector=new c.Vector3(0,0,0);this.rotationVector=new c.Vector3(0,0,0);this.handleEvent=function(e){if(typeof this[e.type]=="function"){this[e.type](e)}};this.keydown=function(e){if(!e.altKey){switch(e.keyCode){case 16:this.movementSpeedMultiplier=0.1;break;case 87:this.moveState.forward=1;break;case 83:this.moveState.back=1;break;case 65:this.moveState.left=1;break;case 68:this.moveState.right=1;break;case 82:this.moveState.up=1;break;case 70:this.moveState.down=1;break;case 38:this.moveState.pitchUp=1;break;case 40:this.moveState.pitchDown=1;break;case 37:this.moveState.yawLeft=1;break;case 39:this.moveState.yawRight=1;break;case 81:this.moveState.rollLeft=1;break;case 69:this.moveState.rollRight=1}this.updateMovementVector();this.updateRotationVector()}};this.keyup=function(e){switch(e.keyCode){case 16:this.movementSpeedMultiplier=1;break;case 87:this.moveState.forward=0;break;case 83:this.moveState.back=0;break;case 65:this.moveState.left=0;break;case 68:this.moveState.right=0;break;case 82:this.moveState.up=0;break;case 70:this.moveState.down=0;break;case 38:this.moveState.pitchUp=0;break;case 40:this.moveState.pitchDown=0;break;case 37:this.moveState.yawLeft=0;break;case 39:this.moveState.yawRight=0;break;case 81:this.moveState.rollLeft=0;break;case 69:this.moveState.rollRight=0}this.updateMovementVector();this.updateRotationVector()};this.mousedown=function(e){this.domElement!==document&&this.domElement.focus();e.preventDefault();e.stopPropagation();if(this.dragToLook){this.mouseStatus++}else{switch(e.button){case 0:this.object.moveForward=!0;break;case 2:this.object.moveBackward=!0}}};this.mousemove=function(l){if(!this.dragToLook||this.mouseStatus>0){var m=this.getContainerDimensions(),e=m.size[0]/2,k=m.size[1]/2;this.moveState.yawLeft=-(l.pageX-m.offset[0]-e)/e;this.moveState.pitchDown=(l.pageY-m.offset[1]-k)/k;this.updateRotationVector()}};this.mouseup=function(e){e.preventDefault();e.stopPropagation();if(this.dragToLook){this.mouseStatus--,this.moveState.yawLeft=this.moveState.pitchDown=0}else{switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}}this.updateRotationVector()};this.update=function(e){var i=e*this.movementSpeed;e*=this.rollSpeed;this.object.translateX(this.moveVector.x*i);this.object.translateY(this.moveVector.y*i);this.object.translateZ(this.moveVector.z*i);this.tmpQuaternion.set(this.rotationVector.x*e,this.rotationVector.y*e,this.rotationVector.z*e,1).normalize();this.object.quaternion.multiplySelf(this.tmpQuaternion);this.object.matrix.setPosition(this.object.position);this.object.matrix.setRotationFromQuaternion(this.object.quaternion);this.object.matrixWorldNeedsUpdate=!0};this.updateMovementVector=function(){var e=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right;this.moveVector.y=-this.moveState.down+this.moveState.up;this.moveVector.z=-e+this.moveState.back};this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp;this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft;this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft};this.getContainerDimensions=function(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}};this.domElement.addEventListener("mousemove",a(this,this.mousemove),!1);this.domElement.addEventListener("mousedown",a(this,this.mousedown),!1);this.domElement.addEventListener("mouseup",a(this,this.mouseup),!1);this.domElement.addEventListener("keydown",a(this,this.keydown),!1);this.domElement.addEventListener("keyup",a(this,this.keyup),!1);this.updateMovementVector();this.updateRotationVector()};c.RollControls=function(k,o){this.object=k;this.domElement=o!==void 0?o:document;this.mouseLook=!0;this.autoForward=!1;this.rollSpeed=this.movementSpeed=this.lookSpeed=1;this.constrainVertical=[-0.9,0.9];this.object.matrixAutoUpdate=!1;this.forward=new c.Vector3(0,0,1);this.roll=0;var m=new c.Vector3,p=new c.Vector3,f=new c.Vector3,a=new c.Matrix4,D=!1,g=1,h=0,b=0,i=0,l=0,r=0,e=window.innerWidth/2,C=window.innerHeight/2;this.update=function(j){if(this.mouseLook){var n=j*this.lookSpeed;this.rotateHorizontally(n*l);this.rotateVertically(n*r)}n=j*this.movementSpeed;this.object.translateZ(-n*(h>0||this.autoForward&&!(h<0)?1:h));this.object.translateX(n*b);this.object.translateY(n*i);D&&(this.roll+=this.rollSpeed*j*g);if(this.forward.y>this.constrainVertical[1]){this.forward.y=this.constrainVertical[1],this.forward.normalize()}else{if(this.forward.y<this.constrainVertical[0]){this.forward.y=this.constrainVertical[0],this.forward.normalize()}}f.copy(this.forward);p.set(0,1,0);m.cross(p,f).normalize();p.cross(f,m).normalize();this.object.matrix.n11=m.x;this.object.matrix.n12=p.x;this.object.matrix.n13=f.x;this.object.matrix.n21=m.y;this.object.matrix.n22=p.y;this.object.matrix.n23=f.y;this.object.matrix.n31=m.z;this.object.matrix.n32=p.z;this.object.matrix.n33=f.z;a.identity();a.n11=Math.cos(this.roll);a.n12=-Math.sin(this.roll);a.n21=Math.sin(this.roll);a.n22=Math.cos(this.roll);this.object.matrix.multiplySelf(a);this.object.matrixWorldNeedsUpdate=!0;this.object.matrix.n14=this.object.position.x;this.object.matrix.n24=this.object.position.y;this.object.matrix.n34=this.object.position.z};this.translateX=function(j){this.object.position.x+=this.object.matrix.n11*j;this.object.position.y+=this.object.matrix.n21*j;this.object.position.z+=this.object.matrix.n31*j};this.translateY=function(j){this.object.position.x+=this.object.matrix.n12*j;this.object.position.y+=this.object.matrix.n22*j;this.object.position.z+=this.object.matrix.n32*j};this.translateZ=function(j){this.object.position.x-=this.object.matrix.n13*j;this.object.position.y-=this.object.matrix.n23*j;this.object.position.z-=this.object.matrix.n33*j};this.rotateHorizontally=function(j){m.set(this.object.matrix.n11,this.object.matrix.n21,this.object.matrix.n31);m.multiplyScalar(j);this.forward.subSelf(m);this.forward.normalize()};this.rotateVertically=function(j){p.set(this.object.matrix.n12,this.object.matrix.n22,this.object.matrix.n32);p.multiplyScalar(j);this.forward.addSelf(p);this.forward.normalize()};this.domElement.addEventListener("contextmenu",function(j){j.preventDefault()},!1);this.domElement.addEventListener("mousemove",function(j){l=(j.clientX-e)/window.innerWidth;r=(j.clientY-C)/window.innerHeight},!1);this.domElement.addEventListener("mousedown",function(j){j.preventDefault();j.stopPropagation();switch(j.button){case 0:h=1;break;case 2:h=-1}},!1);this.domElement.addEventListener("mouseup",function(j){j.preventDefault();j.stopPropagation();switch(j.button){case 0:h=0;break;case 2:h=0}},!1);this.domElement.addEventListener("keydown",function(j){switch(j.keyCode){case 38:case 87:h=1;break;case 37:case 65:b=-1;break;case 40:case 83:h=-1;break;case 39:case 68:b=1;break;case 81:D=!0;g=1;break;case 69:D=!0;g=-1;break;case 82:i=1;break;case 70:i=-1}},!1);this.domElement.addEventListener("keyup",function(j){switch(j.keyCode){case 38:case 87:h=0;break;case 37:case 65:b=0;break;case 40:case 83:h=0;break;case 39:case 68:b=0;break;case 81:D=!1;break;case 69:D=!1;break;case 82:i=0;break;case 70:i=0}},!1)};c.TrackballControls=function(z,b){var a=this,e={NONE:-1,ROTATE:0,ZOOM:1,PAN:2};this.object=z;this.domElement=b!==void 0?b:document;this.enabled=!0;this.screen={width:window.innerWidth,height:window.innerHeight,offsetLeft:0,offsetTop:0};this.radius=(this.screen.width+this.screen.height)/4;this.rotateSpeed=1;this.zoomSpeed=1.2;this.panSpeed=0.3;this.staticMoving=this.noPan=this.noZoom=this.noRotate=!1;this.dynamicDampingFactor=0.2;this.minDistance=0;this.maxDistance=Infinity;this.keys=[65,83,68];this.target=new c.Vector3(0,0,0);var f=!1,h=e.NONE,g=new c.Vector3,i=new c.Vector3,k=new c.Vector3,o=new c.Vector2,l=new c.Vector2,p=new c.Vector2,y=new c.Vector2;this.handleEvent=function(j){if(typeof this[j.type]=="function"){this[j.type](j)}};this.getMouseOnScreen=function(m,j){return new c.Vector2((m-a.screen.offsetLeft)/a.radius*0.5,(j-a.screen.offsetTop)/a.radius*0.5)};this.getMouseProjectionOnBall=function(m,n){var q=new c.Vector3((m-a.screen.width*0.5-a.screen.offsetLeft)/a.radius,(a.screen.height*0.5+a.screen.offsetTop-n)/a.radius,0),j=q.length();j>1?q.normalize():q.z=Math.sqrt(1-j*j);g.copy(a.object.position).subSelf(a.target);j=a.object.up.clone().setLength(q.y);j.addSelf(a.object.up.clone().crossSelf(g).setLength(q.x));j.addSelf(g.setLength(q.z));return j};this.rotateCamera=function(){var j=Math.acos(i.dot(k)/i.length()/k.length());if(j){var m=(new c.Vector3).cross(i,k).normalize(),n=new c.Quaternion;j*=a.rotateSpeed;n.setFromAxisAngle(m,-j);n.multiplyVector3(g);n.multiplyVector3(a.object.up);n.multiplyVector3(k);a.staticMoving?i=k:(n.setFromAxisAngle(m,j*(a.dynamicDampingFactor-1)),n.multiplyVector3(i))}};this.zoomCamera=function(){var j=1+(l.y-o.y)*a.zoomSpeed;j!==1&&j>0&&(g.multiplyScalar(j),a.staticMoving?o=l:o.y+=(l.y-o.y)*this.dynamicDampingFactor)};this.panCamera=function(){var m=y.clone().subSelf(p);if(m.lengthSq()){m.multiplyScalar(g.length()*a.panSpeed);var j=g.clone().crossSelf(a.object.up).setLength(m.x);j.addSelf(a.object.up.clone().setLength(m.y));a.object.position.addSelf(j);a.target.addSelf(j);a.staticMoving?p=y:p.addSelf(m.sub(y,p).multiplyScalar(a.dynamicDampingFactor))}};this.checkDistances=function(){if(!a.noZoom||!a.noPan){a.object.position.lengthSq()>a.maxDistance*a.maxDistance&&a.object.position.setLength(a.maxDistance),g.lengthSq()<a.minDistance*a.minDistance&&a.object.position.add(a.target,g.setLength(a.minDistance))}};this.update=function(){g.copy(a.object.position).subSelf(this.target);a.noRotate||a.rotateCamera();a.noZoom||a.zoomCamera();a.noPan||a.panCamera();a.object.position.add(a.target,g);a.checkDistances();a.object.lookAt(a.target)};this.domElement.addEventListener("contextmenu",function(j){j.preventDefault()},!1);this.domElement.addEventListener("mousemove",function(j){a.enabled&&(f&&(i=k=a.getMouseProjectionOnBall(j.clientX,j.clientY),o=l=a.getMouseOnScreen(j.clientX,j.clientY),p=y=a.getMouseOnScreen(j.clientX,j.clientY),f=!1),h!==e.NONE&&(h===e.ROTATE&&!a.noRotate?k=a.getMouseProjectionOnBall(j.clientX,j.clientY):h===e.ZOOM&&!a.noZoom?l=a.getMouseOnScreen(j.clientX,j.clientY):h===e.PAN&&!a.noPan&&(y=a.getMouseOnScreen(j.clientX,j.clientY))))},!1);this.domElement.addEventListener("mousedown",function(j){if(a.enabled&&(j.preventDefault(),j.stopPropagation(),h===e.NONE)){h=j.button,h===e.ROTATE&&!a.noRotate?i=k=a.getMouseProjectionOnBall(j.clientX,j.clientY):h===e.ZOOM&&!a.noZoom?o=l=a.getMouseOnScreen(j.clientX,j.clientY):this.noPan||(p=y=a.getMouseOnScreen(j.clientX,j.clientY))}},!1);this.domElement.addEventListener("mouseup",function(j){if(a.enabled){j.preventDefault(),j.stopPropagation(),h=e.NONE}},!1);window.addEventListener("keydown",function(j){if(a.enabled&&h===e.NONE){if(j.keyCode===a.keys[e.ROTATE]&&!a.noRotate){h=e.ROTATE}else{if(j.keyCode===a.keys[e.ZOOM]&&!a.noZoom){h=e.ZOOM}else{if(j.keyCode===a.keys[e.PAN]&&!a.noPan){h=e.PAN}}}h!==e.NONE&&(f=!0)}},!1);window.addEventListener("keyup",function(){if(a.enabled&&h!==e.NONE){h=e.NONE}},!1)};c.CubeGeometry=function(a,f,b,i,r,o,l,u){function e(I,K,L,S,T,j,z,C){var F,H=i||1,J=r||1,s=T/2,v=j/2,x=m.vertices.length;if(I==="x"&&K==="y"||I==="y"&&K==="x"){F="z"}else{if(I==="x"&&K==="z"||I==="z"&&K==="x"){F="y",J=o||1}else{if(I==="z"&&K==="y"||I==="y"&&K==="z"){F="x",H=o||1}}}var y=H+1,B=J+1,A=T/H,D=j/J,E=new c.Vector3;E[F]=z>0?1:-1;for(T=0;T<B;T++){for(j=0;j<y;j++){var G=new c.Vector3;G[I]=(j*A-s)*L;G[K]=(T*D-v)*S;G[F]=z;m.vertices.push(new c.Vertex(G))}}for(T=0;T<J;T++){for(j=0;j<H;j++){I=new c.Face4(j+y*T+x,j+y*(T+1)+x,j+1+y*(T+1)+x,j+1+y*T+x),I.normal.copy(E),I.vertexNormals.push(E.clone(),E.clone(),E.clone(),E.clone()),I.materialIndex=C,m.faces.push(I),m.faceVertexUvs[0].push([new c.UV(j/H,T/J),new c.UV(j/H,(T+1)/J),new c.UV((j+1)/H,(T+1)/J),new c.UV((j+1)/H,T/J)])}}}c.Geometry.call(this);var m=this,g=a/2,M=f/2,k=b/2,p,q,w,n,t,N;if(l!==void 0){if(l instanceof Array){this.materials=l}else{this.materials=[];for(p=0;p<6;p++){this.materials.push(l)}}p=0;n=1;q=2;t=3;w=4;N=5}else{this.materials=[]}this.sides={px:!0,nx:!0,py:!0,ny:!0,pz:!0,nz:!0};if(u!=void 0){for(var h in u){this.sides[h]!=void 0&&(this.sides[h]=u[h])}}this.sides.px&&e("z","y",-1,-1,b,f,g,p);this.sides.nx&&e("z","y",1,-1,b,f,-g,n);this.sides.py&&e("x","z",1,1,a,b,M,q);this.sides.ny&&e("x","z",1,-1,a,b,-M,t);this.sides.pz&&e("x","y",1,-1,a,f,k,w);this.sides.nz&&e("x","y",-1,-1,a,f,-k,N);this.computeCentroids();this.mergeVertices()};c.CubeGeometry.prototype=new c.Geometry;c.CubeGeometry.prototype.constructor=c.CubeGeometry;c.CylinderGeometry=function(a,e,b,f,l,h){c.Geometry.call(this);var a=a!=null?a:20,e=e!=null?e:20,b=b||100,g=b/2,f=f||8,l=l||1,o,p,B=[],w=[];for(p=0;p<=l;p++){var i=[],u=[],n=p/l,r=n*(e-a)+a;for(o=0;o<=f;o++){var q=o/f;this.vertices.push(new c.Vertex(new c.Vector3(r*Math.sin(q*Math.PI*2),-n*b+g,r*Math.cos(q*Math.PI*2))));i.push(this.vertices.length-1);u.push(new c.UV(q,n))}B.push(i);w.push(u)}for(p=0;p<l;p++){for(o=0;o<f;o++){var b=B[p][o],i=B[p+1][o],u=B[p+1][o+1],n=B[p][o+1],r=this.vertices[b].position.clone().setY(0).normalize(),q=this.vertices[i].position.clone().setY(0).normalize(),Q=this.vertices[u].position.clone().setY(0).normalize(),t=this.vertices[n].position.clone().setY(0).normalize(),R=w[p][o].clone(),k=w[p+1][o].clone(),m=w[p+1][o+1].clone(),F=w[p][o+1].clone();this.faces.push(new c.Face4(b,i,u,n,[r,q,Q,t]));this.faceVertexUvs[0].push([R,k,m,F])}}if(!h&&a>0){this.vertices.push(new c.Vertex(new c.Vector3(0,g,0)));for(o=0;o<f;o++){b=B[0][o],i=B[0][o+1],u=this.vertices.length-1,r=new c.Vector3(0,1,0),q=new c.Vector3(0,1,0),Q=new c.Vector3(0,1,0),R=w[0][o].clone(),k=w[0][o+1].clone(),m=new c.UV(k.u,0),this.faces.push(new c.Face3(b,i,u,[r,q,Q])),this.faceVertexUvs[0].push([R,k,m])}}if(!h&&e>0){this.vertices.push(new c.Vertex(new c.Vector3(0,-g,0)));for(o=0;o<f;o++){b=B[p][o+1],i=B[p][o],u=this.vertices.length-1,r=new c.Vector3(0,-1,0),q=new c.Vector3(0,-1,0),Q=new c.Vector3(0,-1,0),R=w[p][o+1].clone(),k=w[p][o].clone(),m=new c.UV(k.u,1),this.faces.push(new c.Face3(b,i,u,[r,q,Q])),this.faceVertexUvs[0].push([R,k,m])}}this.computeCentroids();this.computeFaceNormals()};c.CylinderGeometry.prototype=new c.Geometry;c.CylinderGeometry.prototype.constructor=c.CylinderGeometry;c.ExtrudeGeometry=function(b,g){if(typeof b!=="undefined"){c.Geometry.call(this);var b=b instanceof Array?b:[b],i,j=b.length,a;this.shapebb=b[j-1].getBoundingBox();for(i=0;i<j;i++){a=b[i],this.addShape(a,g)}this.computeCentroids();this.computeFaceNormals()}};c.ExtrudeGeometry.prototype=new c.Geometry;c.ExtrudeGeometry.prototype.constructor=c.ExtrudeGeometry;c.ExtrudeGeometry.prototype.addShape=function(ab,ad){function ac(j,z,C){z||console.log("die");return z.clone().multiplyScalar(C).addSelf(j)}function B(Q,L,z){var T=c.ExtrudeGeometry.__v1,V=c.ExtrudeGeometry.__v2,j=c.ExtrudeGeometry.__v3,C=c.ExtrudeGeometry.__v4,D=c.ExtrudeGeometry.__v5,N=c.ExtrudeGeometry.__v6;T.set(Q.x-L.x,Q.y-L.y);V.set(Q.x-z.x,Q.y-z.y);T=T.normalize();V=V.normalize();j.set(-T.y,T.x);C.set(V.y,-V.x);D.copy(Q).addSelf(j);N.copy(Q).addSelf(C);if(D.equals(N)){return C.clone()}D.copy(L).addSelf(j);N.copy(z).addSelf(C);j=T.dot(C);C=N.subSelf(D).dot(C);j===0&&(console.log("Either infinite or no solutions!"),C===0?console.log("Its finite solutions."):console.log("Too bad, no solutions."));C/=j;if(C<0){return L=Math.atan2(L.y-Q.y,L.x-Q.x),Q=Math.atan2(z.y-Q.y,z.x-Q.x),L>Q&&(Q+=Math.PI*2),Q=(L+Q)/2,new c.Vector2(-Math.cos(Q),-Math.sin(Q))}return T.multiplyScalar(C).addSelf(D).subSelf(Q).clone()}function S(Q){for(w=Q.length;--w>=0;){t=w;aa=w-1;aa<0&&(aa=Q.length-1);for(var L=0,z=l+f*2,L=0;L<z;L++){var T=u*L,V=u*(L+1),j=I+t+T,C=I+t+V,D=j,T=I+aa+T,V=I+aa+V,N=C;D+=b;T+=b;V+=b;N+=b;G.faces.push(new c.Face4(D,T,V,N,null,null,x));x&&(D=L/z,T=(L+1)/z,V=U+W*2,j=(G.vertices[j].position.z+W)/V,C=(G.vertices[C].position.z+W)/V,G.faceVertexUvs[0].push([new c.UV(j,D),new c.UV(C,D),new c.UV(C,T),new c.UV(j,T)]))}}}function P(j,z,C){G.vertices.push(new c.Vertex(new c.Vector3(j,z,C)))}function F(D,Q,j){D+=b;Q+=b;j+=b;G.faces.push(new c.Face3(D,Q,j,null,null,E));if(E){var L=K.maxY,N=K.maxX,z=G.vertices[Q].position.x,Q=G.vertices[Q].position.y,C=G.vertices[j].position.x,j=G.vertices[j].position.y;G.faceVertexUvs[0].push([new c.UV(G.vertices[D].position.x/N,G.vertices[D].position.y/L),new c.UV(z/N,Q/L),new c.UV(C/N,j/L)])}}var U=ad.amount!==void 0?ad.amount:100,W=ad.bevelThickness!==void 0?ad.bevelThickness:6,h=ad.bevelSize!==void 0?ad.bevelSize:W-2,f=ad.bevelSegments!==void 0?ad.bevelSegments:3,p=ad.bevelEnabled!==void 0?ad.bevelEnabled:!0,r=ad.curveSegments!==void 0?ad.curveSegments:12,l=ad.steps!==void 0?ad.steps:1,v=ad.bendPath,o=ad.extrudePath,s,A=!1,a=ad.useSpacedPoints!==void 0?ad.useSpacedPoints:!1,E=ad.material,x=ad.extrudeMaterial,K=this.shapebb;if(o){s=o.getPoints(r),l=s.length,A=!0,p=!1}p||(h=W=f=0);var n,e,g,G=this,b=this.vertices.length;v&&ab.addWrapPath(v);r=a?ab.extractAllSpacedPoints(r):ab.extractAllPoints(r);v=r.shape;r=r.holes;if(o=!c.Shape.Utils.isClockWise(v)){v=v.reverse();e=0;for(g=r.length;e<g;e++){n=r[e],c.Shape.Utils.isClockWise(n)&&(r[e]=n.reverse())}o=!1}o=c.Shape.Utils.triangulateShape(v,r);a=v;e=0;for(g=r.length;e<g;e++){n=r[e],v=v.concat(n)}var w,J,q,H,i,y,u=v.length,k=o.length,O=[];w=0;J=a.length;t=J-1;for(aa=w+1;w<J;w++,t++,aa++){t===J&&(t=0),aa===J&&(aa=0),O[w]=B(a[w],a[t],a[aa])}var M=[],R,m=O.concat();e=0;for(g=r.length;e<g;e++){n=r[e];R=[];w=0;J=n.length;t=J-1;for(aa=w+1;w<J;w++,t++,aa++){t===J&&(t=0),aa===J&&(aa=0),R[w]=B(n[w],n[t],n[aa])}M.push(R);m=m.concat(R)}for(q=0;q<f;q++){H=q/f;i=W*(1-H);H=h*Math.sin(H*Math.PI/2);w=0;for(J=a.length;w<J;w++){y=ac(a[w],O[w],H),P(y.x,y.y,-i)}e=0;for(g=r.length;e<g;e++){n=r[e];R=M[e];w=0;for(J=n.length;w<J;w++){y=ac(n[w],R[w],H),P(y.x,y.y,-i)}}}H=h;for(w=0;w<u;w++){y=p?ac(v[w],m[w],H):v[w],A?P(y.x,y.y+s[0].y,s[0].x):P(y.x,y.y,0)}for(q=1;q<=l;q++){for(w=0;w<u;w++){y=p?ac(v[w],m[w],H):v[w],A?P(y.x,y.y+s[q-1].y,s[q-1].x):P(y.x,y.y,U/l*q)}}for(q=f-1;q>=0;q--){H=q/f;i=W*(1-H);H=h*Math.sin(H*Math.PI/2);w=0;for(J=a.length;w<J;w++){y=ac(a[w],O[w],H),P(y.x,y.y,U+i)}e=0;for(g=r.length;e<g;e++){n=r[e];R=M[e];w=0;for(J=n.length;w<J;w++){y=ac(n[w],R[w],H),A?P(y.x,y.y+s[l-1].y,s[l-1].x+i):P(y.x,y.y,U+i)}}}if(p){p=u*0;for(w=0;w<k;w++){h=o[w],F(h[2]+p,h[1]+p,h[0]+p)}p=u*(l+f*2);for(w=0;w<k;w++){h=o[w],F(h[0]+p,h[1]+p,h[2]+p)}}else{for(w=0;w<k;w++){h=o[w],F(h[2],h[1],h[0])}for(w=0;w<k;w++){h=o[w],F(h[0]+u*l,h[1]+u*l,h[2]+u*l)}}var t,aa,I=0;S(a);I+=a.length;e=0;for(g=r.length;e<g;e++){n=r[e],S(n),I+=n.length}};c.ExtrudeGeometry.__v1=new c.Vector2;c.ExtrudeGeometry.__v2=new c.Vector2;c.ExtrudeGeometry.__v3=new c.Vector2;c.ExtrudeGeometry.__v4=new c.Vector2;c.ExtrudeGeometry.__v5=new c.Vector2;c.ExtrudeGeometry.__v6=new c.Vector2;c.IcosahedronGeometry=function(k){function u(j,m,n){var o=Math.sqrt(j*j+m*m+n*n);return e.vertices.push(new c.Vertex(new c.Vector3(j/o,m/o,n/o)))-1}function l(n,o,p,q){var j=e.vertices[n].position,r=e.vertices[o].position,m=e.vertices[p].position,n=new c.Face3(n,o,p);n.vertexNormals.push(j.clone().normalize(),r.clone().normalize(),m.clone().normalize());q.faces.push(n);q.faceVertexUvs[0].push([new c.UV(1-(Math.atan2(j.z,j.x)+Math.PI)%Math.PI/Math.PI*0.5,0.5-j.y/2),new c.UV(1-(Math.atan2(r.z,r.x)+Math.PI)%Math.PI/Math.PI*0.5,0.5-r.y/2),new c.UV(1-(Math.atan2(m.z,m.x)+Math.PI)%Math.PI/Math.PI*0.5,0.5-m.y/2)])}function v(j,m){var n=e.vertices[j].position,o=e.vertices[m].position;return u((n.x+o.x)/2,(n.y+o.y)/2,(n.z+o.z)/2)}var e=this,b=new c.Geometry;this.subdivisions=k||0;c.Geometry.call(this);k=(1+Math.sqrt(5))/2;u(-1,k,0);u(1,k,0);u(-1,-k,0);u(1,-k,0);u(0,-1,k);u(0,1,k);u(0,-1,-k);u(0,1,-k);u(k,0,-1);u(k,0,1);u(-k,0,-1);u(-k,0,1);l(0,11,5,b);l(0,5,1,b);l(0,1,7,b);l(0,7,10,b);l(0,10,11,b);l(1,5,9,b);l(5,11,4,b);l(11,10,2,b);l(10,7,6,b);l(7,1,8,b);l(3,9,4,b);l(3,4,2,b);l(3,2,6,b);l(3,6,8,b);l(3,8,9,b);l(4,9,5,b);l(2,4,11,b);l(6,2,10,b);l(8,6,7,b);l(9,8,1,b);for(var a=0;a<this.subdivisions;a++){var k=new c.Geometry,f;for(f in b.faces){var g=v(b.faces[f].a,b.faces[f].b),i=v(b.faces[f].b,b.faces[f].c),h=v(b.faces[f].c,b.faces[f].a);l(b.faces[f].a,g,h,k);l(b.faces[f].b,i,g,k);l(b.faces[f].c,h,i,k);l(g,i,h,k)}b.faces=k.faces;b.faceVertexUvs[0]=k.faceVertexUvs[0]}e.faces=b.faces;e.faceVertexUvs[0]=b.faceVertexUvs[0];this.computeCentroids();this.computeFaceNormals()};c.IcosahedronGeometry.prototype=new c.Geometry;c.IcosahedronGeometry.prototype.constructor=c.IcosahedronGeometry;c.LatheGeometry=function(e,g,f){c.Geometry.call(this);this.steps=g||12;this.angle=f||2*Math.PI;for(var g=this.angle/this.steps,f=[],h=[],r=[],q=[],i=(new c.Matrix4).setRotationZ(g),a=0;a<e.length;a++){this.vertices.push(new c.Vertex(e[a])),f[a]=e[a].clone(),h[a]=this.vertices.length-1}for(var b=0;b<=this.angle+0.001;b+=g){for(a=0;a<f.length;a++){b<this.angle?(f[a]=i.multiplyVector3(f[a].clone()),this.vertices.push(new c.Vertex(f[a])),r[a]=this.vertices.length-1):r=q}b==0&&(q=h);for(a=0;a<h.length-1;a++){this.faces.push(new c.Face4(r[a],r[a+1],h[a+1],h[a])),this.faceVertexUvs[0].push([new c.UV(1-b/this.angle,a/e.length),new c.UV(1-b/this.angle,(a+1)/e.length),new c.UV(1-(b-g)/this.angle,(a+1)/e.length),new c.UV(1-(b-g)/this.angle,a/e.length)])}h=r;r=[]}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};c.LatheGeometry.prototype=new c.Geometry;c.LatheGeometry.prototype.constructor=c.LatheGeometry;c.OctahedronGeometry=function(e,g){function f(k){var j=k.clone().normalize(),j=new c.Vertex(j.clone().multiplyScalar(e));j.index=i.vertices.push(j)-1;j.uv=new c.UV(Math.atan2(k.z,-k.x)/2/Math.PI+0.5,Math.atan2(-k.y,Math.sqrt(k.x*k.x+k.z*k.z))/Math.PI+0.5);return j}function h(l,m,j,k){k<1?(k=new c.Face3(l.index,m.index,j.index,[l.position,m.position,j.position]),k.centroid.addSelf(l.position).addSelf(m.position).addSelf(j.position).divideScalar(3),k.normal=k.centroid.clone().normalize(),i.faces.push(k),k=Math.atan2(k.centroid.z,-k.centroid.x),i.faceVertexUvs[0].push([q(l.uv,l.position,k),q(m.uv,m.position,k),q(j.uv,j.position,k)])):(k-=1,h(l,r(l,m),r(l,j),k),h(r(l,m),m,r(m,j),k),h(r(l,j),r(m,j),j,k),h(r(l,m),r(m,j),r(l,j),k))}function r(l,j){a[l.index]||(a[l.index]=[]);a[j.index]||(a[j.index]=[]);var k=a[l.index][j.index];k===void 0&&(a[l.index][j.index]=a[j.index][l.index]=k=f((new c.Vector3).add(l.position,j.position).divideScalar(2)));return k}function q(k,l,j){j<0&&k.u===1&&(k=new c.UV(k.u-1,k.v));l.x===0&&l.z===0&&(k=new c.UV(j/2/Math.PI+0.5,k.v));return k}c.Geometry.call(this);var g=g||0,i=this;f(new c.Vector3(1,0,0));f(new c.Vector3(-1,0,0));f(new c.Vector3(0,1,0));f(new c.Vector3(0,-1,0));f(new c.Vector3(0,0,1));f(new c.Vector3(0,0,-1));var a=[],b=this.vertices;h(b[0],b[2],b[4],g);h(b[0],b[4],b[3],g);h(b[0],b[3],b[5],g);h(b[0],b[5],b[2],g);h(b[1],b[2],b[5],g);h(b[1],b[5],b[3],g);h(b[1],b[3],b[4],g);h(b[1],b[4],b[2],g);this.boundingSphere={radius:e}};c.OctahedronGeometry.prototype=new c.Geometry;c.OctahedronGeometry.prototype.constructor=c.OctahedronGeometry;c.PlaneGeometry=function(k,u,l,v){c.Geometry.call(this);for(var e=k/2,b=u/2,l=l||1,v=v||1,a=l+1,f=v+1,g=k/l,i=u/v,h=new c.Vector3(0,0,1),k=0;k<f;k++){for(u=0;u<a;u++){this.vertices.push(new c.Vertex(new c.Vector3(u*g-e,-(k*i-b),0)))}}for(k=0;k<v;k++){for(u=0;u<l;u++){e=new c.Face4(u+a*k,u+a*(k+1),u+1+a*(k+1),u+1+a*k),e.normal.copy(h),e.vertexNormals.push(h.clone(),h.clone(),h.clone(),h.clone()),this.faces.push(e),this.faceVertexUvs[0].push([new c.UV(u/l,k/v),new c.UV(u/l,(k+1)/v),new c.UV((u+1)/l,(k+1)/v),new c.UV((u+1)/l,k/v)])}}this.computeCentroids()};c.PlaneGeometry.prototype=new c.Geometry;c.PlaneGeometry.prototype.constructor=c.PlaneGeometry;c.SphereGeometry=function(b,k,f,n,a,r,q){c.Geometry.call(this);var b=b||50,k=Math.max(3,Math.floor(k)||8),f=Math.max(2,Math.floor(f)||6),n=n!=void 0?n:0,a=a!=void 0?a:Math.PI*2,r=r!=void 0?r:0,q=q!=void 0?q:Math.PI,g,m,w=[],o=[];for(m=0;m<=f;m++){var l=[],p=[];for(g=0;g<=k;g++){var K=g/k,e=m/f;this.vertices.push(new c.Vertex(new c.Vector3(-b*Math.cos(n+K*a)*Math.sin(r+e*q),b*Math.cos(r+e*q),b*Math.sin(n+K*a)*Math.sin(r+e*q))));l.push(this.vertices.length-1);p.push(new c.UV(K,e))}w.push(l);o.push(p)}for(m=0;m<f;m++){for(g=0;g<k;g++){var n=w[m][g+1],a=w[m][g],r=w[m+1][g],q=w[m+1][g+1],l=this.vertices[n].position.clone().normalize(),p=this.vertices[a].position.clone().normalize(),K=this.vertices[r].position.clone().normalize(),e=this.vertices[q].position.clone().normalize(),h=o[m][g+1].clone(),t=o[m][g].clone(),i=o[m+1][g].clone(),L=o[m+1][g+1].clone();Math.abs(this.vertices[n].position.y)==b?(this.faces.push(new c.Face3(n,r,q,[l,K,e])),this.faceVertexUvs[0].push([h,i,L])):Math.abs(this.vertices[r].position.y)==b?(this.faces.push(new c.Face3(n,a,r,[l,p,K])),this.faceVertexUvs[0].push([h,t,i])):(this.faces.push(new c.Face4(n,a,r,q,[l,p,K,e])),this.faceVertexUvs[0].push([h,t,i,L]))}}this.computeCentroids();this.computeFaceNormals();this.boundingSphere={radius:b}};c.SphereGeometry.prototype=new c.Geometry;c.SphereGeometry.prototype.constructor=c.SphereGeometry;c.TextGeometry=function(a,g){var b=(new c.TextPath(a,g)).toShapes();g.amount=g.height!==void 0?g.height:50;if(g.bevelThickness===void 0){g.bevelThickness=10}if(g.bevelSize===void 0){g.bevelSize=8}if(g.bevelEnabled===void 0){g.bevelEnabled=!1}if(g.bend){var h=b[b.length-1].getBoundingBox().maxX;g.bendPath=new c.QuadraticBezierCurve(new c.Vector2(0,0),new c.Vector2(h/2,120),new c.Vector2(h,0))}c.ExtrudeGeometry.call(this,b,g)};c.TextGeometry.prototype=new c.ExtrudeGeometry;c.TextGeometry.prototype.constructor=c.TextGeometry;c.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(b){var a=b.familyName.toLowerCase();this.faces[a]=this.faces[a]||{};this.faces[a][b.cssFontWeight]=this.faces[a][b.cssFontWeight]||{};this.faces[a][b.cssFontWeight][b.cssFontStyle]=b;return this.faces[a][b.cssFontWeight][b.cssFontStyle]=b},drawText:function(a){for(var g=this.getFace(),e=this.size/g.resolution,b=0,p=String(a).split(""),h=p.length,f=[],a=0;a<h;a++){var o=new c.Path,o=this.extractGlyphPoints(p[a],g,e,b,o);b+=o.offset;f.push(o.path)}return{paths:f,offset:b/2}},extractGlyphPoints:function(a,f,b,i,r){var o=[],l,u,e,m,g,M,k,p,q,w,n,t=f.glyphs[a]||f.glyphs["?"];if(t){if(t.o){f=t._cachedOutline||(t._cachedOutline=t.o.split(" "));m=f.length;for(a=0;a<m;){switch(e=f[a++],e){case"m":e=f[a++]*b+i;g=f[a++]*b;o.push(new c.Vector2(e,g));r.moveTo(e,g);break;case"l":e=f[a++]*b+i;g=f[a++]*b;o.push(new c.Vector2(e,g));r.lineTo(e,g);break;case"q":e=f[a++]*b+i;g=f[a++]*b;p=f[a++]*b+i;q=f[a++]*b;r.quadraticCurveTo(p,q,e,g);if(l=o[o.length-1]){M=l.x;k=l.y;l=1;for(u=this.divisions;l<=u;l++){var N=l/u,h=c.Shape.Utils.b2(N,M,p,e),N=c.Shape.Utils.b2(N,k,q,g);o.push(new c.Vector2(h,N))}}break;case"b":if(e=f[a++]*b+i,g=f[a++]*b,p=f[a++]*b+i,q=f[a++]*-b,w=f[a++]*b+i,n=f[a++]*-b,r.bezierCurveTo(e,g,p,q,w,n),l=o[o.length-1]){M=l.x;k=l.y;l=1;for(u=this.divisions;l<=u;l++){N=l/u,h=c.Shape.Utils.b3(N,M,p,w,e),N=c.Shape.Utils.b3(N,k,q,n,g),o.push(new c.Vector2(h,N))}}}}}return{offset:t.ha*b,points:o,path:r}}}};(function(b){var a=function(e){for(var f=e.length,n=0,m=f-1,g=0;g<f;m=g++){n+=e[m].x*e[g].y-e[g].x*e[m].y}return n*0.5};b.Triangulate=function(o,r){var B=o.length;if(B<3){return null}var w=[],u=[],F=[],G,J,H;if(a(o)>0){for(J=0;J<B;J++){u[J]=J}}else{for(J=0;J<B;J++){u[J]=B-1-J}}var e=2*B;for(J=B-1;B>2;){if(e--<=0){console.log("Warning, unable to triangulate polygon!");if(r){return F}return w}G=J;B<=G&&(G=0);J=G+1;B<=J&&(J=0);H=J+1;B<=H&&(H=0);var i;o:{i=o;var K=G,n=J,R=H,l=B,s=u,U=void 0,y=void 0,k=void 0,p=void 0,h=void 0,ab=void 0,ad=void 0,E=void 0,I=void 0,y=i[s[K]].x,k=i[s[K]].y,p=i[s[n]].x,h=i[s[n]].y,ab=i[s[R]].x,ad=i[s[R]].y;if(1e-10>(p-y)*(ad-k)-(h-k)*(ab-y)){i=!1}else{for(U=0;U<l;U++){if(!(U==K||U==n||U==R)){var E=i[s[U]].x,I=i[s[U]].y,q=void 0,m=void 0,aa=void 0,g=void 0,M=void 0,O=void 0,P=void 0,f=void 0,x=void 0,v=void 0,A=void 0,t=void 0,q=aa=M=void 0,q=ab-p,m=ad-h,aa=y-ab,g=k-ad,M=p-y,O=h-k,P=E-y,f=I-k,x=E-p,v=I-h,A=E-ab,t=I-ad,q=q*v-m*x,M=M*f-O*P,aa=aa*t-g*A;if(q>=0&&aa>=0&&M>=0){i=!1;break o}}}i=!0}}if(i){w.push([o[u[G]],o[u[J]],o[u[H]]]);F.push([u[G],u[J],u[H]]);G=J;for(H=J+1;H<B;G++,H++){u[G]=u[H]}B--;e=2*B}}if(r){return F}return w};b.Triangulate.area=a;return b})(c.FontUtils);d._typeface_js={faces:c.FontUtils.faces,loadFace:c.FontUtils.loadFace};c.TorusGeometry=function(e,g,f,h,r){c.Geometry.call(this);this.radius=e||100;this.tube=g||40;this.segmentsR=f||8;this.segmentsT=h||6;this.arc=r||Math.PI*2;r=new c.Vector3;e=[];g=[];for(f=0;f<=this.segmentsR;f++){for(h=0;h<=this.segmentsT;h++){var q=h/this.segmentsT*this.arc,i=f/this.segmentsR*Math.PI*2;r.x=this.radius*Math.cos(q);r.y=this.radius*Math.sin(q);var a=new c.Vector3;a.x=(this.radius+this.tube*Math.cos(i))*Math.cos(q);a.y=(this.radius+this.tube*Math.cos(i))*Math.sin(q);a.z=this.tube*Math.sin(i);this.vertices.push(new c.Vertex(a));e.push(new c.UV(h/this.segmentsT,1-f/this.segmentsR));g.push(a.clone().subSelf(r).normalize())}}for(f=1;f<=this.segmentsR;f++){for(h=1;h<=this.segmentsT;h++){var r=(this.segmentsT+1)*f+h-1,q=(this.segmentsT+1)*(f-1)+h-1,i=(this.segmentsT+1)*(f-1)+h,a=(this.segmentsT+1)*f+h,b=new c.Face4(r,q,i,a,[g[r],g[q],g[i],g[a]]);b.normal.addSelf(g[r]);b.normal.addSelf(g[q]);b.normal.addSelf(g[i]);b.normal.addSelf(g[a]);b.normal.normalize();this.faces.push(b);this.faceVertexUvs[0].push([e[r].clone(),e[q].clone(),e[i].clone(),e[a].clone()])}}this.computeCentroids()};c.TorusGeometry.prototype=new c.Geometry;c.TorusGeometry.prototype.constructor=c.TorusGeometry;c.TorusKnotGeometry=function(k,u,l,v,e,b,a){function f(n,o,q,p,j,m){o=q/p*n;q=Math.cos(o);return new c.Vector3(j*(2+q)*0.5*Math.cos(n),j*(2+q)*Math.sin(n)*0.5,m*j*Math.sin(o)*0.5)}c.Geometry.call(this);this.radius=k||200;this.tube=u||40;this.segmentsR=l||64;this.segmentsT=v||8;this.p=e||2;this.q=b||3;this.heightScale=a||1;this.grid=Array(this.segmentsR);l=new c.Vector3;v=new c.Vector3;b=new c.Vector3;for(k=0;k<this.segmentsR;++k){this.grid[k]=Array(this.segmentsT);for(u=0;u<this.segmentsT;++u){var g=k/this.segmentsR*2*this.p*Math.PI,a=u/this.segmentsT*2*Math.PI,e=f(g,a,this.q,this.p,this.radius,this.heightScale),g=f(g+0.01,a,this.q,this.p,this.radius,this.heightScale);l.x=g.x-e.x;l.y=g.y-e.y;l.z=g.z-e.z;v.x=g.x+e.x;v.y=g.y+e.y;v.z=g.z+e.z;b.cross(l,v);v.cross(b,l);b.normalize();v.normalize();g=-this.tube*Math.cos(a);a=this.tube*Math.sin(a);e.x+=g*v.x+a*b.x;e.y+=g*v.y+a*b.y;e.z+=g*v.z+a*b.z;this.grid[k][u]=this.vertices.push(new c.Vertex(new c.Vector3(e.x,e.y,e.z)))-1}}for(k=0;k<this.segmentsR;++k){for(u=0;u<this.segmentsT;++u){var v=(k+1)%this.segmentsR,b=(u+1)%this.segmentsT,e=this.grid[k][u],l=this.grid[v][u],v=this.grid[v][b],b=this.grid[k][b],a=new c.UV(k/this.segmentsR,u/this.segmentsT),g=new c.UV((k+1)/this.segmentsR,u/this.segmentsT),i=new c.UV((k+1)/this.segmentsR,(u+1)/this.segmentsT),h=new c.UV(k/this.segmentsR,(u+1)/this.segmentsT);this.faces.push(new c.Face4(e,l,v,b));this.faceVertexUvs[0].push([a,g,i,h])}}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};c.TorusKnotGeometry.prototype=new c.Geometry;c.TorusKnotGeometry.prototype.constructor=c.TorusKnotGeometry;c.SubdivisionModifier=function(a){this.subdivisions=a===void 0?1:a;this.useOldVertexColors=!1;this.supportUVs=!0};c.SubdivisionModifier.prototype.constructor=c.SubdivisionModifier;c.SubdivisionModifier.prototype.modify=function(b){for(var a=this.subdivisions;a-->0;){this.smooth(b)}};c.SubdivisionModifier.prototype.smooth=function(t){function g(C,D,H,I,L,M){var G=new c.Face4(C,D,H,I,null,L.color,L.material);if(n.useOldVertexColors){G.vertexColors=[];for(var O,P,j,N=0;N<4;N++){j=M[N];O=new c.Color;O.setRGB(0,0,0);for(var z=0;z<j.length;z++){P=L.vertexColors[j[z]-1],O.r+=P.r,O.g+=P.g,O.b+=P.b}O.r/=j.length;O.g/=j.length;O.b/=j.length;G.vertexColors[N]=O}}q.push(G);(!n.supportUVs||E.length!=0)&&p.push([E[C],E[D],E[H],E[I]])}function v(z,j){return Math.min(z,j)+"_"+Math.max(z,j)}var i=[],q=[],p=[],n=this,y=t.vertices,i=t.faces,R=y.concat(),A=[],U={},x={},E=[],B,ac,w,J,a,l=t.faceVertexUvs[0];B=0;for(ac=l.length;B<ac;B++){w=0;for(J=l[B].length;w<J;w++){a=i[B]["abcd".charAt(w)],E[a]||(E[a]=l[B][w])}}var e;B=0;for(ac=i.length;B<ac;B++){if(a=i[B],A.push(a.centroid),R.push(new c.Vertex(a.centroid)),n.supportUVs&&E.length!=0){e=new c.UV;if(a instanceof c.Face3){e.u=E[a.a].u+E[a.b].u+E[a.c].u,e.v=E[a.a].v+E[a.b].v+E[a.c].v,e.u/=3,e.v/=3}else{if(a instanceof c.Face4){e.u=E[a.a].u+E[a.b].u+E[a.c].u+E[a.d].u,e.v=E[a.a].v+E[a.b].v+E[a.c].v+E[a.d].v,e.u/=4,e.v/=4}}E.push(e)}}ac=function(C){function D(M,N,L){M[N]===void 0&&(M[N]=[]);M[N].push(L)}var G,H,I,j,z={};G=0;for(H=C.faces.length;G<H;G++){I=C.faces[G],I instanceof c.Face3?(j=v(I.a,I.b),D(z,j,G),j=v(I.b,I.c),D(z,j,G),j=v(I.c,I.a),D(z,j,G)):I instanceof c.Face4&&(j=v(I.a,I.b),D(z,j,G),j=v(I.b,I.c),D(z,j,G),j=v(I.c,I.d),D(z,j,G),j=v(I.d,I.a),D(z,j,G))}return z}(t);var K=0,l=y.length,f,F,m={},o={},h=function(z,j){m[z]===void 0&&(m[z]=[]);m[z].push(j)},r=function(z,j){o[z]===void 0&&(o[z]={});o[z][j]=null};for(B in ac){e=ac[B];f=B.split("_");F=f[0];f=f[1];h(F,[F,f]);h(f,[F,f]);w=0;for(J=e.length;w<J;w++){a=e[w],r(F,a,B),r(f,a,B)}e.length<2&&(x[B]=!0)}for(B in ac){if(e=ac[B],a=e[0],e=e[1],f=B.split("_"),F=f[0],f=f[1],J=new c.Vector3,x[B]?(J.addSelf(y[F].position),J.addSelf(y[f].position),J.multiplyScalar(0.5)):(J.addSelf(A[a]),J.addSelf(A[e]),J.addSelf(y[F].position),J.addSelf(y[f].position),J.multiplyScalar(0.25)),U[B]=l+i.length+K,R.push(new c.Vertex(J)),K++,n.supportUVs&&E.length!=0){e=new c.UV,e.u=E[F].u+E[f].u,e.v=E[F].v+E[f].v,e.u/=2,e.v/=2,E.push(e)}}var ad,b;f=["123","12","2","23"];J=["123","23","3","31"];var h=["123","31","1","12"],r=["1234","12","2","23"],k=["1234","23","3","34"],u=["1234","34","4","41"],s=["1234","41","1","12"];B=0;for(ac=A.length;B<ac;B++){a=i[B],e=l+B,a instanceof c.Face3?(K=v(a.a,a.b),F=v(a.b,a.c),ad=v(a.c,a.a),g(e,U[K],a.b,U[F],a,f),g(e,U[F],a.c,U[ad],a,J),g(e,U[ad],a.a,U[K],a,h)):a instanceof c.Face4?(K=v(a.a,a.b),F=v(a.b,a.c),ad=v(a.c,a.d),b=v(a.d,a.a),g(e,U[K],a.b,U[F],a,r),g(e,U[F],a.c,U[ad],a,k),g(e,U[ad],a.d,U[b],a,u),g(e,U[b],a.a,U[K],a,s)):console.log("face should be a face!",a)}i=R;R=new c.Vector3;U=new c.Vector3;B=0;for(ac=y.length;B<ac;B++){if(m[B]!==void 0){R.set(0,0,0);U.set(0,0,0);a=new c.Vector3(0,0,0);e=0;for(w in o[B]){R.addSelf(A[w]),e++}K=0;l=m[B].length;for(w=0;w<l;w++){x[v(m[B][w][0],m[B][w][1])]&&K++}if(K!=2){R.divideScalar(e);for(w=0;w<l;w++){e=m[B][w],e=y[e[0]].position.clone().addSelf(y[e[1]].position).divideScalar(2),U.addSelf(e)}U.divideScalar(l);a.addSelf(y[B].position);a.multiplyScalar(l-3);a.addSelf(R);a.addSelf(U.multiplyScalar(2));a.divideScalar(l);i[B].position=a}}}t.vertices=i;t.faces=q;t.faceVertexUvs[0]=p;delete t.__tmpVertices;t.computeCentroids();t.computeFaceNormals();t.computeVertexNormals()};c.Loader=function(a){this.statusDomElement=(this.showStatus=a)?c.Loader.prototype.addStatusElement():null;this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}};c.Loader.prototype={constructor:c.Loader,addStatusElement:function(){var a=document.createElement("div");a.style.position="absolute";a.style.right="0px";a.style.top="0px";a.style.fontSize="0.8em";a.style.textAlign="left";a.style.background="rgba(0,0,0,0.25)";a.style.color="#fff";a.style.width="120px";a.style.padding="0.5em 0.5em 0.5em 0.5em";a.style.zIndex=1000;a.innerHTML="Loading ...";return a},updateProgress:function(b){var a="Loaded ";a+=b.total?(100*b.loaded/b.total).toFixed(0)+"%":(b.loaded/1000).toFixed(2)+" KB";this.statusDomElement.innerHTML=a},extractUrlbase:function(a){a=a.split("/");a.pop();return a.length<1?"":a.join("/")+"/"},initMaterials:function(a,g,b){a.materials=[];for(var h=0;h<g.length;++h){a.materials[h]=c.Loader.prototype.createMaterial(g[h],b)}},hasNormals:function(a){var g,b,h=a.materials.length;for(b=0;b<h;b++){if(g=a.materials[b],g instanceof c.ShaderMaterial){return !0}}return !1},createMaterial:function(z,b){function a(j){j=Math.log(j)/Math.LN2;return Math.floor(j)==j}function e(j,m){var n=new Image;n.onload=function(){if(!a(this.width)||!a(this.height)){var q=Math.pow(2,Math.round(Math.log(this.width)/Math.LN2)),r=Math.pow(2,Math.round(Math.log(this.height)/Math.LN2));j.image.width=q;j.image.height=r;j.image.getContext("2d").drawImage(this,0,0,q,r)}else{j.image=this}j.needsUpdate=!0};n.src=m}function f(q,r,s,m,n,t){var j=document.createElement("canvas");q[r]=new c.Texture(j);q[r].sourceFile=s;if(m){q[r].repeat.set(m[0],m[1]);if(m[0]!=1){q[r].wrapS=c.RepeatWrapping}if(m[1]!=1){q[r].wrapT=c.RepeatWrapping}}n&&q[r].offset.set(n[0],n[1]);if(t){m={repeat:c.RepeatWrapping,mirror:c.MirroredRepeatWrapping};if(m[t[0]]!==void 0){q[r].wrapS=m[t[0]]}if(m[t[1]]!==void 0){q[r].wrapT=m[t[1]]}}e(q[r],b+"/"+s)}function h(j){return(j[0]*255<<16)+(j[1]*255<<8)+j[2]*255}var g,i,k;i="MeshLambertMaterial";g={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,wireframe:z.wireframe};z.shading&&(z.shading=="Phong"?i="MeshPhongMaterial":z.shading=="Basic"&&(i="MeshBasicMaterial"));if(z.blending){if(z.blending=="Additive"){g.blending=c.AdditiveBlending}else{if(z.blending=="Subtractive"){g.blending=c.SubtractiveBlending}else{if(z.blending=="Multiply"){g.blending=c.MultiplyBlending}}}}if(z.transparent!==void 0||z.opacity<1){g.transparent=z.transparent}if(z.depthTest!==void 0){g.depthTest=z.depthTest}if(z.vertexColors!==void 0){if(z.vertexColors=="face"){g.vertexColors=c.FaceColors}else{if(z.vertexColors){g.vertexColors=c.VertexColors}}}if(z.colorDiffuse){g.color=h(z.colorDiffuse)}else{if(z.DbgColor){g.color=z.DbgColor}}if(z.colorSpecular){g.specular=h(z.colorSpecular)}if(z.colorAmbient){g.ambient=h(z.colorAmbient)}if(z.transparency){g.opacity=z.transparency}if(z.specularCoef){g.shininess=z.specularCoef}z.mapDiffuse&&b&&f(g,"map",z.mapDiffuse,z.mapDiffuseRepeat,z.mapDiffuseOffset,z.mapDiffuseWrap);z.mapLight&&b&&f(g,"lightMap",z.mapLight,z.mapLightRepeat,z.mapLightOffset,z.mapLightWrap);z.mapNormal&&b&&f(g,"normalMap",z.mapNormal,z.mapNormalRepeat,z.mapNormalOffset,z.mapNormalWrap);z.mapSpecular&&b&&f(g,"specularMap",z.mapSpecular,z.mapSpecularRepeat,z.mapSpecularOffset,z.mapSpecularWrap);if(z.mapNormal){var o=c.ShaderUtils.lib.normal,l=c.UniformsUtils.clone(o.uniforms),p=g.color;i=g.specular;k=g.ambient;var y=g.shininess;l.tNormal.texture=g.normalMap;if(z.mapNormalFactor){l.uNormalScale.value=z.mapNormalFactor}if(g.map){l.tDiffuse.texture=g.map,l.enableDiffuse.value=!0}if(g.specularMap){l.tSpecular.texture=g.specularMap,l.enableSpecular.value=!0}if(g.lightMap){l.tAO.texture=g.lightMap,l.enableAO.value=!0}l.uDiffuseColor.value.setHex(p);l.uSpecularColor.value.setHex(i);l.uAmbientColor.value.setHex(k);l.uShininess.value=y;if(g.opacity){l.uOpacity.value=g.opacity}g=new c.ShaderMaterial({fragmentShader:o.fragmentShader,vertexShader:o.vertexShader,uniforms:l,lights:!0,fog:!0})}else{g=new c[i](g)}return g}};c.BinaryLoader=function(a){c.Loader.call(this,a)};c.BinaryLoader.prototype=new c.Loader;c.BinaryLoader.prototype.constructor=c.BinaryLoader;c.BinaryLoader.prototype.supr=c.Loader.prototype;c.BinaryLoader.prototype.load=function(b,g,i,j){if(b instanceof Object){console.warn("DEPRECATED: BinaryLoader( parameters ) is now BinaryLoader( url, callback, texturePath, binaryPath )."),j=b,b=j.model,g=j.callback,i=j.texture_path,j=j.bin_path}var i=i?i:this.extractUrlbase(b),j=j?j:this.extractUrlbase(b),a=this.showProgress?c.Loader.prototype.updateProgress:null;this.onLoadStart();this.loadAjaxJSON(this,b,g,i,j,a)};c.BinaryLoader.prototype.loadAjaxJSON=function(g,b,a,m,f,e){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(n.readyState==4){if(n.status==200||n.status==0){try{var h=JSON.parse(n.responseText);h.metadata===void 0||h.metadata.formatVersion===void 0||h.metadata.formatVersion!==3?console.error("Deprecated file format."):g.loadAjaxBuffers(h,a,f,m,e)}catch(i){console.error(i),console.warn("DEPRECATED: ["+b+"] seems to be using old model format")}}else{console.error("Couldn't load ["+b+"] ["+n.status+"]")}}};n.open("GET",b,!0);n.overrideMimeType("text/plain; charset=x-user-defined");n.setRequestHeader("Content-Type","text/plain");n.send(null)};c.BinaryLoader.prototype.loadAjaxBuffers=function(a,g,e,b,p){var h=new XMLHttpRequest,f=e+"/"+a.buffers,o=0;h.onreadystatechange=function(){h.readyState==4?h.status==200||h.status==0?c.BinaryLoader.prototype.createBinModel(h.response,g,b,a.materials):console.error("Couldn't load ["+f+"] ["+h.status+"]"):h.readyState==3?p&&(o==0&&(o=h.getResponseHeader("Content-Length")),p({total:o,loaded:h.responseText.length})):h.readyState==2&&(o=h.getResponseHeader("Content-Length"))};h.open("GET",f,!0);h.responseType="arraybuffer";h.send(null)};c.BinaryLoader.prototype.createBinModel=function(b,g,i,j){var a=function(e){function f(k){return k%4?4-k%4:0}function h(l,k){return(new Uint8Array(l,k,1))[0]}function m(l,k){return(new Uint32Array(l,k,1))[0]}function o(G,H){var K,k,l,s,z,D,I,C,E=new Uint32Array(b,H,3*G);for(K=0;K<G;K++){k=E[K*3];l=E[K*3+1];s=E[K*3+2];z=U[k*2];k=U[k*2+1];D=U[l*2];I=U[l*2+1];l=U[s*2];C=U[s*2+1];s=q.faceVertexUvs[0];var J=[];J.push(new c.UV(z,k));J.push(new c.UV(D,I));J.push(new c.UV(l,C));s.push(J)}}function n(E,J){var K,D,l,G,L,M,k,s,z,C,H=new Uint32Array(b,J,4*E);for(K=0;K<E;K++){D=H[K*4];l=H[K*4+1];G=H[K*4+2];L=H[K*4+3];M=U[D*2];D=U[D*2+1];k=U[l*2];z=U[l*2+1];s=U[G*2];C=U[G*2+1];G=U[L*2];l=U[L*2+1];L=q.faceVertexUvs[0];var I=[];I.push(new c.UV(M,D));I.push(new c.UV(k,z));I.push(new c.UV(s,C));I.push(new c.UV(G,l));L.push(I)}}function r(z,D,E){for(var G,l,s,k,D=new Uint32Array(b,D,3*z),C=new Uint16Array(b,E,z),E=0;E<z;E++){G=D[E*3],l=D[E*3+1],s=D[E*3+2],k=C[E],q.faces.push(new c.Face3(G,l,s,null,null,k))}}function v(z,C,H){for(var D,E,G,k,l,C=new Uint32Array(b,C,4*z),s=new Uint16Array(b,H,z),H=0;H<z;H++){D=C[H*4],E=C[H*4+1],G=C[H*4+2],k=C[H*4+3],l=s[H],q.faces.push(new c.Face4(D,E,G,k,null,null,l))}}function p(z,O,I,J){for(var L,M,E,H,D,N,k,O=new Uint32Array(b,O,3*z),I=new Uint32Array(b,I,3*z),l=new Uint16Array(b,J,z),J=0;J<z;J++){L=O[J*3];M=O[J*3+1];E=O[J*3+2];D=I[J*3];N=I[J*3+1];k=I[J*3+2];H=l[J];var s=y[N*3],C=y[N*3+1];N=y[N*3+2];var K=y[k*3],G=y[k*3+1];k=y[k*3+2];q.faces.push(new c.Face3(L,M,E,[new c.Vector3(y[D*3],y[D*3+1],y[D*3+2]),new c.Vector3(s,C,N),new c.Vector3(K,G,k)],null,H))}}function A(I,J,L,N){for(var O,P,Q,R,s,D,k,l,H,J=new Uint32Array(b,J,4*I),L=new Uint32Array(b,L,4*I),z=new Uint16Array(b,N,I),N=0;N<I;N++){O=J[N*4];P=J[N*4+1];Q=J[N*4+2];R=J[N*4+3];D=L[N*4];k=L[N*4+1];l=L[N*4+2];H=L[N*4+3];s=z[N];var C=y[k*3],E=y[k*3+1];k=y[k*3+2];var S=y[l*3],K=y[l*3+1];l=y[l*3+2];var M=y[H*3],G=y[H*3+1];H=y[H*3+2];q.faces.push(new c.Face4(O,P,Q,R,[new c.Vector3(y[D*3],y[D*3+1],y[D*3+2]),new c.Vector3(C,E,k),new c.Vector3(S,K,l),new c.Vector3(M,G,H)],null,s))}}var q=this,B=0,T,y=[],U=[],t,w,x,u,V,F;c.Geometry.call(this);c.Loader.prototype.initMaterials(q,j,e);T={signature:function(z,k,l){for(var z=new Uint8Array(z,k,l),s="",C=0;C<l;C++){s+=String.fromCharCode(z[k+C])}return s}(b,B,12),header_bytes:h(b,B+12),vertex_coordinate_bytes:h(b,B+13),normal_coordinate_bytes:h(b,B+14),uv_coordinate_bytes:h(b,B+15),vertex_index_bytes:h(b,B+16),normal_index_bytes:h(b,B+17),uv_index_bytes:h(b,B+18),material_index_bytes:h(b,B+19),nvertices:m(b,B+20),nnormals:m(b,B+20+4),nuvs:m(b,B+20+8),ntri_flat:m(b,B+20+12),ntri_smooth:m(b,B+20+16),ntri_flat_uv:m(b,B+20+20),ntri_smooth_uv:m(b,B+20+24),nquad_flat:m(b,B+20+28),nquad_smooth:m(b,B+20+32),nquad_flat_uv:m(b,B+20+36),nquad_smooth_uv:m(b,B+20+40)};T.signature!=="Three.js 003"&&console.warn("DEPRECATED: binary model seems to be using old format");B+=T.header_bytes;e=T.vertex_index_bytes*3+T.material_index_bytes;F=T.vertex_index_bytes*4+T.material_index_bytes;t=T.ntri_flat*e;w=T.ntri_smooth*(e+T.normal_index_bytes*3);x=T.ntri_flat_uv*(e+T.uv_index_bytes*3);u=T.ntri_smooth_uv*(e+T.normal_index_bytes*3+T.uv_index_bytes*3);V=T.nquad_flat*F;e=T.nquad_smooth*(F+T.normal_index_bytes*4);F=T.nquad_flat_uv*(F+T.uv_index_bytes*4);B+=function(z){var D=T.nvertices,z=new Float32Array(b,z,D*3),k,l,s,C;for(k=0;k<D;k++){l=z[k*3],s=z[k*3+1],C=z[k*3+2],q.vertices.push(new c.Vertex(new c.Vector3(l,s,C)))}return D*3*Float32Array.BYTES_PER_ELEMENT}(B);B+=function(z){var D=T.nnormals;if(D){var z=new Int8Array(b,z,D*3),k,l,s,C;for(k=0;k<D;k++){l=z[k*3],s=z[k*3+1],C=z[k*3+2],y.push(l/127,s/127,C/127)}}return D*3*Int8Array.BYTES_PER_ELEMENT}(B);B+=f(T.nnormals*3);B+=function(k){var l=T.nuvs;if(l){var k=new Float32Array(b,k,l*2),s,z,C;for(s=0;s<l;s++){z=k[s*2],C=k[s*2+1],U.push(z,C)}}return l*2*Float32Array.BYTES_PER_ELEMENT}(B);t=B+t+f(T.ntri_flat*2);w=t+w+f(T.ntri_smooth*2);x=w+x+f(T.ntri_flat_uv*2);u=x+u+f(T.ntri_smooth_uv*2);V=u+V+f(T.nquad_flat*2);e=V+e+f(T.nquad_smooth*2);F=e+F+f(T.nquad_flat_uv*2);(function(k){var l=T.ntri_flat_uv;if(l){var s=k+l*Uint32Array.BYTES_PER_ELEMENT*3;r(l,k,s+l*Uint32Array.BYTES_PER_ELEMENT*3);o(l,s)}})(w);(function(z){var l=T.ntri_smooth_uv;if(l){var s=z+l*Uint32Array.BYTES_PER_ELEMENT*3,k=s+l*Uint32Array.BYTES_PER_ELEMENT*3;p(l,z,s,k+l*Uint32Array.BYTES_PER_ELEMENT*3);o(l,k)}})(x);(function(k){var l=T.nquad_flat_uv;if(l){var s=k+l*Uint32Array.BYTES_PER_ELEMENT*4;v(l,k,s+l*Uint32Array.BYTES_PER_ELEMENT*4);n(l,s)}})(e);(function(z){var l=T.nquad_smooth_uv;if(l){var s=z+l*Uint32Array.BYTES_PER_ELEMENT*4,k=s+l*Uint32Array.BYTES_PER_ELEMENT*4;A(l,z,s,k+l*Uint32Array.BYTES_PER_ELEMENT*4);n(l,k)}})(F);(function(l){var k=T.ntri_flat;k&&r(k,l,l+k*Uint32Array.BYTES_PER_ELEMENT*3)})(B);(function(k){var l=T.ntri_smooth;if(l){var s=k+l*Uint32Array.BYTES_PER_ELEMENT*3;p(l,k,s,s+l*Uint32Array.BYTES_PER_ELEMENT*3)}})(t);(function(l){var k=T.nquad_flat;k&&v(k,l,l+k*Uint32Array.BYTES_PER_ELEMENT*4)})(u);(function(k){var l=T.nquad_smooth;if(l){var s=k+l*Uint32Array.BYTES_PER_ELEMENT*4;A(l,k,s,s+l*Uint32Array.BYTES_PER_ELEMENT*4)}})(V);this.computeCentroids();this.computeFaceNormals();c.Loader.prototype.hasNormals(this)&&this.computeTangents()};a.prototype=new c.Geometry;a.prototype.constructor=a;g(new a(i))};c.ColladaLoader=function(){function e(L,z,C){P=L;z=z||B;C!==void 0&&(L=C.split("/"),L.pop(),o=L.length<1?"":L.join("/")+"/");ao=s("//dae:library_images/dae:image",u,"image");f=s("//dae:library_materials/dae:material",an,"material");aj=s("//dae:library_effects/dae:effect",ah,"effect");A=s("//dae:library_geometries/dae:geometry",b,"geometry");a=s("//dae:library_controllers/dae:controller",aq,"controller");j=s("//dae:library_animations/dae:animation",ac,"animation");x=s(".//dae:library_visual_scenes/dae:visual_scene",R,"visual_scene");m=[];ag=[];(L=P.evaluate(".//dae:scene/dae:instance_visual_scene",P,O,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null).iterateNext())?(L=L.getAttribute("url").replace(/^#/,""),F=x[L]):F=null;q=new c.Object3D;for(L=0;L<F.nodes.length;L++){q.add(ae(F.nodes[L]))}n();for(var D in j){}D={scene:q,morphs:m,skins:ag,dae:{images:ao,materials:f,effects:aj,geometries:A,controllers:a,animations:j,visualScenes:x,scene:F}};z&&z(D);return D}function s(z,N,C){for(var z=P.evaluate(z,P,O,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null),D={},L=z.iterateNext(),Q=0;L;){L=(new N).parse(L);if(L.id.length==0){L.id=C+Q++}D[L.id]=L;L=z.iterateNext()}return D}function n(){var z=1000000,N=-z,Q=0,C;for(C in j){for(var D=j[C],L=0;L<D.sampler.length;L++){var T=D.sampler[L];T.create();z=Math.min(z,T.startTime);N=Math.max(N,T.endTime);Q=Math.max(Q,T.input.length)}}return{start:z,end:N,frames:Q}}function t(N,z,C,D){N.world=N.world||new c.Matrix4;N.world.copy(N.matrix);if(N.channels&&N.channels.length){var L=N.channels[0].sampler.output[C];L instanceof c.Matrix4&&N.world.copy(L)}D&&N.world.multiply(D,N.world);z.push(N);for(D=0;D<N.nodes.length;D++){t(N.nodes[D],z,C,N.world)}}function ap(D,Y,N){var T=a[Y.url];if(!T||!T.skin){console.log("ColladaLoader: Could not find skin controller.")}else{if(!Y.skeleton||!Y.skeleton.length){console.log("ColladaLoader: Could not find the skeleton for the skin. ")}else{var ar=n(),Y=F.getChildById(Y.skeleton[0],!0)||F.getChildBySid(Y.skeleton[0],!0),ax,ay,at,z,C=new c.Vector3,L;for(ax=0;ax<D.vertices.length;ax++){T.skin.bindShapeMatrix.multiplyVector3(D.vertices[ax].position)}for(N=0;N<ar.frames;N++){var au=[],Q=[];for(ax=0;ax<D.vertices.length;ax++){Q.push(new c.Vertex(new c.Vector3))}t(Y,au,N);ax=au;ay=T.skin;for(z=0;z<ax.length;z++){if(at=ax[z],L=-1,at.type=="JOINT"){for(var Z=0;Z<ay.joints.length;Z++){if(at.sid==ay.joints[Z]){L=Z;break}}if(L>=0){Z=ay.invBindMatrices[L];at.invBindMatrix=Z;at.skinningMatrix=new c.Matrix4;at.skinningMatrix.multiply(at.world,Z);at.weights=[];for(Z=0;Z<ay.weights.length;Z++){for(var av=0;av<ay.weights[Z].length;av++){var aw=ay.weights[Z][av];aw.joint==L&&at.weights.push(aw)}}}else{throw"ColladaLoader: Could not find joint '"+at.sid+"'."}}}for(ax=0;ax<au.length;ax++){if(au[ax].type=="JOINT"){for(ay=0;ay<au[ax].weights.length;ay++){at=au[ax].weights[ay],z=at.index,at=at.weight,L=D.vertices[z],z=Q[z],C.x=L.position.x,C.y=L.position.y,C.z=L.position.z,au[ax].skinningMatrix.multiplyVector3(C),z.position.x+=C.x*at,z.position.y+=C.y*at,z.position.z+=C.z*at}}}D.morphTargets.push({name:"target_"+N,vertices:Q})}}}}function ae(N){var Z=new c.Object3D,ar,Q,T,Y;for(T=0;T<N.controllers.length;T++){var z=a[N.controllers[T].url];switch(z.type){case"skin":if(A[z.skin.source]){var at=new X;at.url=z.skin.source;at.instance_material=N.controllers[T].instance_material;N.geometries.push(at);ar=N.controllers[T]}else{if(a[z.skin.source]&&(Q=z=a[z.skin.source],z.morph&&A[z.morph.source])){at=new X,at.url=z.morph.source,at.instance_material=N.controllers[T].instance_material,N.geometries.push(at)}}break;case"morph":if(A[z.morph.source]){at=new X,at.url=z.morph.source,at.instance_material=N.controllers[T].instance_material,N.geometries.push(at),Q=N.controllers[T]}console.log("ColladaLoader: Morph-controller partially supported.")}}for(T=0;T<N.geometries.length;T++){var z=N.geometries[T],at=z.instance_material,z=A[z.url],au={},C=0,D;if(z&&z.mesh&&z.mesh.primitives){if(Z.name.length==0){Z.name=z.id}if(at){for(Y=0;Y<at.length;Y++){D=at[Y];var L=aj[f[D.target].instance_effect.url].shader;L.material.opacity=!L.material.opacity?1:L.material.opacity;D=au[D.symbol]=L.material;C++}}at=D||new c.MeshLambertMaterial({color:14540253,shading:c.FlatShading});z=z.mesh.geometry3js;if(C>1){at=new c.MeshFaceMaterial;for(Y=0;Y<z.faces.length;Y++){C=z.faces[Y],C.materials=[au[C.daeMaterial]]}}if(ar!==void 0){ap(z,ar),at.morphTargets=!0,at=new c.SkinnedMesh(z,at),at.skeleton=ar.skeleton,at.skinController=a[ar.url],at.skinInstanceController=ar,at.name="skin_"+ag.length,ag.push(at)}else{if(Q!==void 0){Y=z;au=Q instanceof V?a[Q.url]:Q;if(!au||!au.morph){console.log("could not find morph controller!")}else{au=au.morph;for(C=0;C<au.targets.length;C++){if(L=A[au.targets[C]],L.mesh&&L.mesh.primitives&&L.mesh.primitives.length){L=L.mesh.primitives[0].geometry,L.vertices.length===Y.vertices.length&&Y.morphTargets.push({name:"target_1",vertices:L.vertices})}}Y.morphTargets.push({name:"target_Z",vertices:Y.vertices})}at.morphTargets=!0;at=new c.Mesh(z,at);at.name="morph_"+m.length;m.push(at)}else{at=new c.Mesh(z,at)}}N.geometries.length>1?Z.add(at):Z=at}}Z.name=N.id||"";N.matrix.decompose(Z.position,Z.rotation,Z.scale);for(T=0;T<N.nodes.length;T++){Z.add(ae(N.nodes[T],N))}return Z}function u(){this.init_from=this.id=""}function aq(){this.type=this.name=this.id="";this.morph=this.skin=null}function M(){this.weights=this.targets=this.source=this.method=null}function U(){this.source="";this.bindShapeMatrix=null;this.invBindMatrices=[];this.joints=[];this.weights=[]}function R(){this.name=this.id="";this.nodes=[];this.scene=new c.Object3D}function aa(){this.sid=this.name=this.id="";this.nodes=[];this.controllers=[];this.transforms=[];this.geometries=[];this.channels=[];this.matrix=new c.Matrix4}function ad(){this.type=this.sid="";this.data=[];this.matrix=new c.Matrix4}function V(){this.url="";this.skeleton=[];this.instance_material=[]}function g(){this.target=this.symbol=""}function X(){this.url="";this.instance_material=[]}function b(){this.id="";this.mesh=null}function p(z){this.geometry=z.id;this.primitives=[];this.geometry3js=this.vertices=null}function ak(){}function k(){this.material="";this.count=0;this.inputs=[];this.vcount=null;this.p=[];this.geometry=new c.Geometry}function H(){this.source="";this.stride=this.count=0;this.params=[]}function J(){this.input={}}function G(){this.semantic="";this.offset=0;this.source="";this.set=0}function al(z){this.id=z;this.type=null}function an(){this.name=this.id="";this.instance_effect=null}function ai(){this.color=new c.Color(0);this.color.setRGB(Math.random(),Math.random(),Math.random());this.color.a=1;this.texcoord=this.texture=null}function W(z,C){this.type=z;this.effect=C;this.material=null}function l(z){this.effect=z;this.format=this.init_from=null}function I(z){this.effect=z;this.mipfilter=this.magfilter=this.minfilter=this.wrap_t=this.wrap_s=this.source=null}function ah(){this.name=this.id="";this.sampler=this.surface=this.shader=null}function w(){this.url=""}function ac(){this.name=this.id="";this.source={};this.sampler=[];this.channel=[]}function af(z){this.animation=z;this.target=this.source="";this.member=this.arrIndices=this.arrSyntax=this.dotSyntax=this.sid=null}function i(z){this.id="";this.animation=z;this.inputs=[];this.endTime=this.startTime=this.interpolation=this.output=this.input=null;this.duration=0}function E(z){var C=z.getAttribute("id");if(y[C]!=void 0){return y[C]}y[C]=(new al(C)).parse(z);return y[C]}function O(z){if(z=="dae"){return"http://www.collada.org/2005/11/COLLADASchema"}return null}function K(z){for(var z=h(z),D=[],C=0;C<z.length;C++){D.push(parseFloat(z[C]))}return D}function S(z){for(var z=h(z),D=[],C=0;C<z.length;C++){D.push(parseInt(z[C],10))}return D}function h(z){return z.replace(/^\s+/,"").replace(/\s+$/,"").split(/\s+/)}function am(z,D,C){return z.hasAttribute(D)?parseInt(z.getAttribute(D),10):C}function r(z,D){if(z===void 0){for(var C="0.";C.length<D+2;){C+="0"}return C}D=D||2;C=z.toString().split(".");for(C[1]=C.length>1?C[1].substr(0,D):"0";C[1].length<D;){C[1]+="0"}return C.join(".")}function ab(z,D){var C="";C+=r(z.x,D)+",";C+=r(z.y,D)+",";C+=r(z.z,D);return C}var P=null,q=null,F,B=null,y={},ao={},j={},a={},A={},f={},aj={},x,o,m,ag,v=c.SmoothShading;u.prototype.parse=function(z){this.id=z.getAttribute("id");for(var D=0;D<z.childNodes.length;D++){var C=z.childNodes[D];if(C.nodeName=="init_from"){this.init_from=C.textContent}}return this};aq.prototype.parse=function(z){this.id=z.getAttribute("id");this.name=z.getAttribute("name");this.type="none";for(var D=0;D<z.childNodes.length;D++){var C=z.childNodes[D];switch(C.nodeName){case"skin":this.skin=(new U).parse(C);this.type=C.nodeName;break;case"morph":this.morph=(new M).parse(C),this.type=C.nodeName}}return this};M.prototype.parse=function(N){var z={},C=[],D;this.method=N.getAttribute("method");this.source=N.getAttribute("source").replace(/^#/,"");for(D=0;D<N.childNodes.length;D++){var L=N.childNodes[D];if(L.nodeType==1){switch(L.nodeName){case"source":L=(new al).parse(L);z[L.id]=L;break;case"targets":C=this.parseInputs(L);break;default:console.log(L.nodeName)}}}for(D=0;D<C.length;D++){switch(N=C[D],L=z[N.source],N.semantic){case"MORPH_TARGET":this.targets=L.read();break;case"MORPH_WEIGHT":this.weights=L.read()}}return this};M.prototype.parseInputs=function(D){for(var L=[],z=0;z<D.childNodes.length;z++){var C=D.childNodes[z];if(C.nodeType==1){switch(C.nodeName){case"input":L.push((new G).parse(C))}}}return L};U.prototype.parse=function(z){var N={},C,D;this.source=z.getAttribute("source").replace(/^#/,"");this.invBindMatrices=[];this.joints=[];this.weights=[];for(var L=0;L<z.childNodes.length;L++){var Q=z.childNodes[L];if(Q.nodeType==1){switch(Q.nodeName){case"bind_shape_matrix":Q=K(Q.textContent);this.bindShapeMatrix=new c.Matrix4;this.bindShapeMatrix.set(Q[0],Q[1],Q[2],Q[3],Q[4],Q[5],Q[6],Q[7],Q[8],Q[9],Q[10],Q[11],Q[12],Q[13],Q[14],Q[15]);break;case"source":Q=(new al).parse(Q);N[Q.id]=Q;break;case"joints":C=Q;break;case"vertex_weights":D=Q;break;default:console.log(Q.nodeName)}}}this.parseJoints(C,N);this.parseWeights(D,N);return this};U.prototype.parseJoints=function(N,z){for(var C=0;C<N.childNodes.length;C++){var D=N.childNodes[C];if(D.nodeType==1){switch(D.nodeName){case"input":var D=(new G).parse(D),L=z[D.source];if(D.semantic=="JOINT"){this.joints=L.read()}else{if(D.semantic=="INV_BIND_MATRIX"){this.invBindMatrices=L.read()}}}}}};U.prototype.parseWeights=function(au,z){for(var L,N,Z=[],at=0;at<au.childNodes.length;at++){var Q=au.childNodes[at];if(Q.nodeType==1){switch(Q.nodeName){case"input":Z.push((new G).parse(Q));break;case"v":L=S(Q.textContent);break;case"vcount":N=S(Q.textContent)}}}for(at=Q=0;at<N.length;at++){for(var T=N[at],Y=[],ar=0;ar<T;ar++){for(var C={},av=0;av<Z.length;av++){var aw=Z[av],D=L[Q+aw.offset];switch(aw.semantic){case"JOINT":C.joint=D;break;case"WEIGHT":C.weight=z[aw.source].data[D]}}Y.push(C);Q+=Z.length}for(ar=0;ar<Y.length;ar++){Y[ar].index=at}this.weights.push(Y)}};R.prototype.getChildById=function(D,L){for(var z=0;z<this.nodes.length;z++){var C=this.nodes[z].getChildById(D,L);if(C){return C}}return null};R.prototype.getChildBySid=function(D,L){for(var z=0;z<this.nodes.length;z++){var C=this.nodes[z].getChildBySid(D,L);if(C){return C}}return null};R.prototype.parse=function(z){this.id=z.getAttribute("id");this.name=z.getAttribute("name");this.nodes=[];for(var D=0;D<z.childNodes.length;D++){var C=z.childNodes[D];if(C.nodeType==1){switch(C.nodeName){case"node":this.nodes.push((new aa).parse(C))}}}return this};aa.prototype.getChannelForTransform=function(Y){for(var z=0;z<this.channels.length;z++){var Q=this.channels[z],T=Q.target.split("/");T.shift();var C=T.shift(),D=C.indexOf(".")>=0,L=C.indexOf("(")>=0,N;if(D){T=C.split("."),C=T.shift(),T.shift()}else{if(L){N=C.split("(");C=N.shift();for(T=0;T<N.length;T++){N[T]=parseInt(N[T].replace(/\)/,""))}}}if(C==Y){return Q.info={sid:C,dotSyntax:D,arrSyntax:L,arrIndices:N},Q}}return null};aa.prototype.getChildById=function(D,L){if(this.id==D){return this}if(L){for(var z=0;z<this.nodes.length;z++){var C=this.nodes[z].getChildById(D,L);if(C){return C}}}return null};aa.prototype.getChildBySid=function(D,L){if(this.sid==D){return this}if(L){for(var z=0;z<this.nodes.length;z++){var C=this.nodes[z].getChildBySid(D,L);if(C){return C}}}return null};aa.prototype.getTransformBySid=function(z){for(var C=0;C<this.transforms.length;C++){if(this.transforms[C].sid==z){return this.transforms[C]}}return null};aa.prototype.parse=function(Y){var Z;this.id=Y.getAttribute("id");this.sid=Y.getAttribute("sid");this.name=Y.getAttribute("name");this.type=Y.getAttribute("type");this.type=this.type=="JOINT"?this.type:"NODE";this.nodes=[];this.transforms=[];this.geometries=[];this.controllers=[];this.matrix=new c.Matrix4;for(var Q=0;Q<Y.childNodes.length;Q++){if(Z=Y.childNodes[Q],Z.nodeType==1){switch(Z.nodeName){case"node":this.nodes.push((new aa).parse(Z));break;case"instance_camera":break;case"instance_controller":this.controllers.push((new V).parse(Z));break;case"instance_geometry":this.geometries.push((new X).parse(Z));break;case"instance_light":break;case"instance_node":Z=Z.getAttribute("url").replace(/^#/,"");(Z=P.evaluate(".//dae:library_nodes//dae:node[@id='"+Z+"']",P,O,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null).iterateNext())&&this.nodes.push((new aa).parse(Z));break;case"rotate":case"translate":case"scale":case"matrix":case"lookat":case"skew":this.transforms.push((new ad).parse(Z));break;case"extra":break;default:console.log(Z.nodeName)}}}Y=[];Q=1000000;Z=-1000000;for(var T in j){for(var C=j[T],ar=0;ar<C.channel.length;ar++){var at=C.channel[ar],z=C.sampler[ar];T=at.target.split("/")[0];if(T==this.id){z.create(),at.sampler=z,Q=Math.min(Q,z.startTime),Z=Math.max(Z,z.endTime),Y.push(at)}}}if(Y.length){this.startTime=Q,this.endTime=Z}if((this.channels=Y)&&this.channels.length){T=10000000;for(Y=0;Y<this.channels.length;Y++){Q=this.channels[Y].sampler;for(Z=0;Z<Q.input.length-1;Z++){T=Math.min(T,Q.input[Z+1]-Q.input[Z])}}Q=[];for(Y=this.startTime;Y<this.endTime;Y+=T){Z=Y;for(var C={},D=ar=void 0,ar=0;ar<this.channels.length;ar++){D=this.channels[ar],C[D.sid]=D}at=new c.Matrix4;for(ar=0;ar<this.transforms.length;ar++){if(z=this.transforms[ar],D=C[z.sid],D!==void 0){for(var L=D.sampler,N,D=0;D<L.input.length-1;D++){if(L.input[D+1]>Z){N=L.output[D];break}}at=N!==void 0?N instanceof c.Matrix4?at.multiply(at,N):at.multiply(at,z.matrix):at.multiply(at,z.matrix)}else{at=at.multiply(at,z.matrix)}}Z=at;Q.push({time:Y,pos:[Z.n14,Z.n24,Z.n34],rotq:[0,0,0,1],scl:[1,1,1]})}this.keys=Q}this.updateMatrix();return this};aa.prototype.updateMatrix=function(){this.matrix.identity();for(var z=0;z<this.transforms.length;z++){this.matrix.multiply(this.matrix,this.transforms[z].matrix)}};ad.prototype.parse=function(z){this.sid=z.getAttribute("sid");this.type=z.nodeName;this.data=K(z.textContent);this.updateMatrix();return this};ad.prototype.updateMatrix=function(){var z=0;this.matrix.identity();switch(this.type){case"matrix":this.matrix.set(this.data[0],this.data[1],this.data[2],this.data[3],this.data[4],this.data[5],this.data[6],this.data[7],this.data[8],this.data[9],this.data[10],this.data[11],this.data[12],this.data[13],this.data[14],this.data[15]);break;case"translate":this.matrix.setTranslation(this.data[0],this.data[1],this.data[2]);break;case"rotate":z=this.data[3]*(Math.PI/180);this.matrix.setRotationAxis(new c.Vector3(this.data[0],this.data[1],this.data[2]),z);break;case"scale":this.matrix.setScale(this.data[0],this.data[1],this.data[2])}return this.matrix};V.prototype.parse=function(D){this.url=D.getAttribute("url").replace(/^#/,"");this.skeleton=[];this.instance_material=[];for(var L=0;L<D.childNodes.length;L++){var z=D.childNodes[L];if(z.nodeType==1){switch(z.nodeName){case"skeleton":this.skeleton.push(z.textContent.replace(/^#/,""));break;case"bind_material":if(z=P.evaluate(".//dae:instance_material",z,O,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null)){for(var C=z.iterateNext();C;){this.instance_material.push((new g).parse(C)),C=z.iterateNext()}}}}}return this};g.prototype.parse=function(z){this.symbol=z.getAttribute("symbol");this.target=z.getAttribute("target").replace(/^#/,"");return this};X.prototype.parse=function(z){this.url=z.getAttribute("url").replace(/^#/,"");this.instance_material=[];for(var D=0;D<z.childNodes.length;D++){var C=z.childNodes[D];if(C.nodeType==1&&C.nodeName=="bind_material"){if(z=P.evaluate(".//dae:instance_material",C,O,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null)){for(D=z.iterateNext();D;){this.instance_material.push((new g).parse(D)),D=z.iterateNext()}}break}}return this};b.prototype.parse=function(z){this.id=z.getAttribute("id");for(var D=0;D<z.childNodes.length;D++){var C=z.childNodes[D];switch(C.nodeName){case"mesh":this.mesh=(new p(this)).parse(C)}}return this};p.prototype.parse=function(z){function N(Y,Z){var T=ab(Y.position);L[T]===void 0&&(L[T]={v:Y,index:Z});return L[T]}this.primitives=[];var C;for(C=0;C<z.childNodes.length;C++){var D=z.childNodes[C];switch(D.nodeName){case"source":E(D);break;case"vertices":this.vertices=(new J).parse(D);break;case"triangles":this.primitives.push((new k).parse(D));break;case"polygons":console.warn("polygon holes not yet supported!");case"polylist":this.primitives.push((new ak).parse(D))}}var L={};this.geometry3js=new c.Geometry;D=y[this.vertices.input.POSITION.source].data;for(z=C=0;C<D.length;C+=3,z++){var Q=new c.Vertex(new c.Vector3(D[C],D[C+1],D[C+2]));N(Q,z);this.geometry3js.vertices.push(Q)}for(C=0;C<this.primitives.length;C++){z=this.primitives[C],z.setVertices(this.vertices),this.handlePrimitive(z,this.geometry3js,L)}this.geometry3js.computeCentroids();this.geometry3js.computeFaceNormals();this.geometry3js.computeVertexNormals();this.geometry3js.computeBoundingBox();return this};p.prototype.handlePrimitive=function(aw,N,Q){var ax=0,ay,az,aA=aw.p,aB=aw.inputs,D,Z,at,av,z=0,C=3,L=[];for(ay=0;ay<aB.length;ay++){switch(D=aB[ay],D.semantic){case"TEXCOORD":L.push(D.set)}}for(;ax<aA.length;){var aC=[],T=[],Y={},au=[];aw.vcount&&(C=aw.vcount[z++]);for(ay=0;ay<C;ay++){for(az=0;az<aB.length;az++){switch(D=aB[az],av=y[D.source],Z=aA[ax+ay*aB.length+D.offset],at=av.accessor.params.length,at*=Z,D.semantic){case"VERTEX":D=ab(N.vertices[Z].position);aC.push(Q[D].index);break;case"NORMAL":T.push(new c.Vector3(av.data[at],av.data[at+1],av.data[at+2]));break;case"TEXCOORD":Y[D.set]===void 0&&(Y[D.set]=[]);Y[D.set].push(new c.UV(av.data[at],av.data[at+1]));break;case"COLOR":au.push((new c.Color).setRGB(av.data[at],av.data[at+1],av.data[at+2]))}}}var ar;C==3?ar=new c.Face3(aC[0],aC[1],aC[2],[T[0],T[1],T[2]],au.length?au:new c.Color):C==4&&(ar=new c.Face4(aC[0],aC[1],aC[2],aC[3],[T[0],T[1],T[2],T[3]],au.length?au:new c.Color));ar.daeMaterial=aw.material;N.faces.push(ar);for(az=0;az<L.length;az++){ay=Y[L[az]],N.faceVertexUvs[az].push([ay[0],ay[1],ay[2]])}ax+=aB.length*C}};ak.prototype=new k;ak.prototype.constructor=ak;k.prototype.setVertices=function(z){for(var C=0;C<this.inputs.length;C++){if(this.inputs[C].source==z.id){this.inputs[C].source=z.input.POSITION.source}}};k.prototype.parse=function(z){this.inputs=[];this.material=z.getAttribute("material");this.count=am(z,"count",0);for(var D=0;D<z.childNodes.length;D++){var C=z.childNodes[D];switch(C.nodeName){case"input":this.inputs.push((new G).parse(z.childNodes[D]));break;case"vcount":this.vcount=S(C.textContent);break;case"p":this.p=S(C.textContent)}}return this};H.prototype.parse=function(D){this.params=[];this.source=D.getAttribute("source");this.count=am(D,"count",0);this.stride=am(D,"stride",0);for(var L=0;L<D.childNodes.length;L++){var z=D.childNodes[L];if(z.nodeName=="param"){var C={};C.name=z.getAttribute("name");C.type=z.getAttribute("type");this.params.push(C)}}return this};J.prototype.parse=function(z){this.id=z.getAttribute("id");for(var D=0;D<z.childNodes.length;D++){if(z.childNodes[D].nodeName=="input"){var C=(new G).parse(z.childNodes[D]);this.input[C.semantic]=C}}return this};G.prototype.parse=function(z){this.semantic=z.getAttribute("semantic");this.source=z.getAttribute("source").replace(/^#/,"");this.set=am(z,"set",-1);this.offset=am(z,"offset",0);if(this.semantic=="TEXCOORD"&&this.set<0){this.set=0}return this};al.prototype.parse=function(z){this.id=z.getAttribute("id");for(var N=0;N<z.childNodes.length;N++){var C=z.childNodes[N];switch(C.nodeName){case"bool_array":for(var D=h(C.textContent),L=[],Q=0;Q<D.length;Q++){L.push(D[Q]=="true"||D[Q]=="1"?!0:!1)}this.data=L;this.type=C.nodeName;break;case"float_array":this.data=K(C.textContent);this.type=C.nodeName;break;case"int_array":this.data=S(C.textContent);this.type=C.nodeName;break;case"IDREF_array":case"Name_array":this.data=h(C.textContent);this.type=C.nodeName;break;case"technique_common":for(D=0;D<C.childNodes.length;D++){if(C.childNodes[D].nodeName=="accessor"){this.accessor=(new H).parse(C.childNodes[D]);break}}}}return this};al.prototype.read=function(){var D=[],L=this.accessor.params[0];switch(L.type){case"IDREF":case"Name":case"name":case"float":return this.data;case"float4x4":for(L=0;L<this.data.length;L+=16){var z=this.data.slice(L,L+16),C=new c.Matrix4;C.set(z[0],z[1],z[2],z[3],z[4],z[5],z[6],z[7],z[8],z[9],z[10],z[11],z[12],z[13],z[14],z[15]);D.push(C)}break;default:console.log("ColladaLoader: Source: Read dont know how to read "+L.type+".")}return D};an.prototype.parse=function(z){this.id=z.getAttribute("id");this.name=z.getAttribute("name");for(var C=0;C<z.childNodes.length;C++){if(z.childNodes[C].nodeName=="instance_effect"){this.instance_effect=(new w).parse(z.childNodes[C]);break}}return this};ai.prototype.isColor=function(){return this.texture==null};ai.prototype.isTexture=function(){return this.texture!=null};ai.prototype.parse=function(z){for(var D=0;D<z.childNodes.length;D++){var C=z.childNodes[D];if(C.nodeType==1){switch(C.nodeName){case"color":C=K(C.textContent);this.color=new c.Color(0);this.color.setRGB(C[0],C[1],C[2]);this.color.a=C[3];break;case"texture":this.texture=C.getAttribute("texture"),this.texcoord=C.getAttribute("texcoord")}}}return this};W.prototype.parse=function(z){for(var N=0;N<z.childNodes.length;N++){var C=z.childNodes[N];if(C.nodeType==1){switch(C.nodeName){case"ambient":case"emission":case"diffuse":case"specular":case"transparent":this[C.nodeName]=(new ai).parse(C);break;case"shininess":case"reflectivity":case"transparency":var D;D=P.evaluate(".//dae:float",C,O,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);for(var L=D.iterateNext(),Q=[];L;){Q.push(L),L=D.iterateNext()}D=Q;D.length>0&&(this[C.nodeName]=parseFloat(D[0].textContent))}}}this.create();return this};W.prototype.create=function(){var D={},L=this.transparency!==void 0&&this.transparency<1,z;for(z in this){switch(z){case"ambient":case"emission":case"diffuse":case"specular":var C=this[z];if(C instanceof ai){if(C.isTexture()){if(this.effect.sampler&&this.effect.surface&&this.effect.sampler.source==this.effect.surface.sid&&(C=ao[this.effect.surface.init_from])){D.map=c.ImageUtils.loadTexture(o+C.init_from),D.map.wrapS=c.RepeatWrapping,D.map.wrapT=c.RepeatWrapping,D.map.repeat.x=1,D.map.repeat.y=-1}}else{z=="diffuse"?D.color=C.color.getHex():L||(D[z]=C.color.getHex())}}break;case"shininess":case"reflectivity":D[z]=this[z];break;case"transparency":if(L){D.transparent=!0,D.opacity=this[z],L=!0}}}D.shading=v;return this.material=new c.MeshLambertMaterial(D)};l.prototype.parse=function(z){for(var D=0;D<z.childNodes.length;D++){var C=z.childNodes[D];if(C.nodeType==1){switch(C.nodeName){case"init_from":this.init_from=C.textContent;break;case"format":this.format=C.textContent;break;default:console.log("unhandled Surface prop: "+C.nodeName)}}}return this};I.prototype.parse=function(z){for(var D=0;D<z.childNodes.length;D++){var C=z.childNodes[D];if(C.nodeType==1){switch(C.nodeName){case"source":this.source=C.textContent;break;case"minfilter":this.minfilter=C.textContent;break;case"magfilter":this.magfilter=C.textContent;break;case"mipfilter":this.mipfilter=C.textContent;break;case"wrap_s":this.wrap_s=C.textContent;break;case"wrap_t":this.wrap_t=C.textContent;break;default:console.log("unhandled Sampler2D prop: "+C.nodeName)}}}return this};ah.prototype.create=function(){if(this.shader==null){return null}};ah.prototype.parse=function(z){this.id=z.getAttribute("id");this.name=z.getAttribute("name");this.shader=null;for(var D=0;D<z.childNodes.length;D++){var C=z.childNodes[D];if(C.nodeType==1){switch(C.nodeName){case"profile_COMMON":this.parseTechnique(this.parseProfileCOMMON(C))}}}return this};ah.prototype.parseNewparam=function(D){for(var L=D.getAttribute("sid"),z=0;z<D.childNodes.length;z++){var C=D.childNodes[z];if(C.nodeType==1){switch(C.nodeName){case"surface":this.surface=(new l(this)).parse(C);this.surface.sid=L;break;case"sampler2D":this.sampler=(new I(this)).parse(C);this.sampler.sid=L;break;case"extra":break;default:console.log(C.nodeName)}}}};ah.prototype.parseProfileCOMMON=function(D){for(var L,z=0;z<D.childNodes.length;z++){var C=D.childNodes[z];if(C.nodeType==1){switch(C.nodeName){case"profile_COMMON":this.parseProfileCOMMON(C);break;case"technique":L=C;break;case"newparam":this.parseNewparam(C);break;case"extra":break;default:console.log(C.nodeName)}}}return L};ah.prototype.parseTechnique=function(z){for(var D=0;D<z.childNodes.length;D++){var C=z.childNodes[D];if(C.nodeType==1){switch(C.nodeName){case"lambert":case"blinn":case"phong":this.shader=(new W(C.nodeName,this)).parse(C)}}}};w.prototype.parse=function(z){this.url=z.getAttribute("url").replace(/^#/,"");return this};ac.prototype.parse=function(z){this.id=z.getAttribute("id");this.name=z.getAttribute("name");this.source={};for(var D=0;D<z.childNodes.length;D++){var C=z.childNodes[D];if(C.nodeType==1){switch(C.nodeName){case"source":C=(new al).parse(C);this.source[C.id]=C;break;case"sampler":this.sampler.push((new i(this)).parse(C));break;case"channel":this.channel.push((new af(this)).parse(C))}}}return this};af.prototype.parse=function(z){this.source=z.getAttribute("source").replace(/^#/,"");this.target=z.getAttribute("target");var N=this.target.split("/");N.shift();var z=N.shift(),C=z.indexOf(".")>=0,D=z.indexOf("(")>=0,L,Q;if(C){N=z.split("."),z=N.shift(),Q=N.shift()}else{if(D){L=z.split("(");z=L.shift();for(N=0;N<L.length;N++){L[N]=parseInt(L[N].replace(/\)/,""))}}}this.sid=z;this.dotSyntax=C;this.arrSyntax=D;this.arrIndices=L;this.member=Q;return this};i.prototype.parse=function(z){this.id=z.getAttribute("id");this.inputs=[];for(var D=0;D<z.childNodes.length;D++){var C=z.childNodes[D];if(C.nodeType==1){switch(C.nodeName){case"input":this.inputs.push((new G).parse(C))}}}return this};i.prototype.create=function(){for(var z=0;z<this.inputs.length;z++){var D=this.inputs[z],C=this.animation.source[D.source];switch(D.semantic){case"INPUT":this.input=C.read();break;case"OUTPUT":this.output=C.read();break;case"INTERPOLATION":this.interpolation=C.read();break;case"IN_TANGENT":break;case"OUT_TANGENT":break;default:console.log(D.semantic)}}this.duration=this.endTime=this.startTime=0;if(this.input.length){this.startTime=100000000;this.endTime=-100000000;for(z=0;z<this.input.length;z++){this.startTime=Math.min(this.startTime,this.input[z]),this.endTime=Math.max(this.endTime,this.input[z])}this.duration=this.endTime-this.startTime}};return{load:function(D,z){if(document.implementation&&document.implementation.createDocument){document.implementation.createDocument("http://www.collada.org/2005/11/COLLADASchema","COLLADA",null);D+="?rnd="+Math.random();var C=new XMLHttpRequest;C.overrideMimeType&&C.overrideMimeType("text/xml");C.onreadystatechange=function(){if(C.readyState==4&&(C.status==0||C.status==200)){B=z,e(C.responseXML,void 0,D)}};C.open("GET",D,!0);C.send(null)}else{alert("Don't know how to parse XML!")}},parse:e,setPreferredShading:function(z){v=z},applySkin:ap,geometries:A}};c.JSONLoader=function(a){c.Loader.call(this,a)};c.JSONLoader.prototype=new c.Loader;c.JSONLoader.prototype.constructor=c.JSONLoader;c.JSONLoader.prototype.supr=c.Loader.prototype;c.JSONLoader.prototype.load=function(f,b,a){if(f instanceof Object){console.warn("DEPRECATED: JSONLoader( parameters ) is now JSONLoader( url, callback, texturePath )."),a=f,f=a.model,b=a.callback,a=a.texture_path}a=a?a:this.extractUrlbase(f);this.onLoadStart();this.loadAjaxJSON(this,f,b,a)};c.JSONLoader.prototype.loadAjaxJSON=function(g,b,a,m,f){var e=new XMLHttpRequest,n=0;e.onreadystatechange=function(){if(e.readyState==4){if(e.status==200||e.status==0){try{var h=JSON.parse(e.responseText);g.createModel(h,a,m);g.onLoadComplete()}catch(i){console.error(i),console.warn("DEPRECATED: ["+b+"] seems to be using old model format")}}else{console.error("Couldn't load ["+b+"] ["+e.status+"]")}}else{e.readyState==3?f&&(n==0&&(n=e.getResponseHeader("Content-Length")),f({total:n,loaded:e.responseText.length})):e.readyState==2&&(n=e.getResponseHeader("Content-Length"))}};e.open("GET",b,!0);e.overrideMimeType("text/plain; charset=x-user-defined");e.setRequestHeader("Content-Type","text/plain");e.send(null)};c.JSONLoader.prototype.createModel=function(b,g,i){var j=new c.Geometry,a=b.scale!==void 0?1/b.scale:1;this.initMaterials(j,b.materials,i);(function(e){if(b.metadata===void 0||b.metadata.formatVersion===void 0||b.metadata.formatVersion!==3){console.error("Deprecated file format.")}else{var f,h,m,p,n,o,q,r,w,u,Q,t,x,B,F=b.faces;o=b.vertices;var P=b.normals,A=b.colors,R=0;for(f=0;f<b.uvs.length;f++){b.uvs[f].length&&R++}for(f=0;f<R;f++){j.faceUvs[f]=[],j.faceVertexUvs[f]=[]}p=0;for(n=o.length;p<n;){q=new c.Vertex,q.position.x=o[p++]*e,q.position.y=o[p++]*e,q.position.z=o[p++]*e,j.vertices.push(q)}p=0;for(n=F.length;p<n;){e=F[p++];o=e&1;m=e&2;f=e&4;h=e&8;r=e&16;q=e&32;u=e&64;e&=128;o?(Q=new c.Face4,Q.a=F[p++],Q.b=F[p++],Q.c=F[p++],Q.d=F[p++],o=4):(Q=new c.Face3,Q.a=F[p++],Q.b=F[p++],Q.c=F[p++],o=3);if(m){m=F[p++],Q.materialIndex=m}m=j.faces.length;if(f){for(f=0;f<R;f++){t=b.uvs[f],w=F[p++],B=t[w*2],w=t[w*2+1],j.faceUvs[f][m]=new c.UV(B,w)}}if(h){for(f=0;f<R;f++){t=b.uvs[f];x=[];for(h=0;h<o;h++){w=F[p++],B=t[w*2],w=t[w*2+1],x[h]=new c.UV(B,w)}j.faceVertexUvs[f][m]=x}}if(r){r=F[p++]*3,h=new c.Vector3,h.x=P[r++],h.y=P[r++],h.z=P[r],Q.normal=h}if(q){for(f=0;f<o;f++){r=F[p++]*3,h=new c.Vector3,h.x=P[r++],h.y=P[r++],h.z=P[r],Q.vertexNormals.push(h)}}if(u){q=F[p++],q=new c.Color(A[q]),Q.color=q}if(e){for(f=0;f<o;f++){q=F[p++],q=new c.Color(A[q]),Q.vertexColors.push(q)}}j.faces.push(Q)}}})(a);(function(){var m,e,f,h;if(b.skinWeights){m=0;for(e=b.skinWeights.length;m<e;m+=2){f=b.skinWeights[m],h=b.skinWeights[m+1],j.skinWeights.push(new c.Vector4(f,h,0,0))}}if(b.skinIndices){m=0;for(e=b.skinIndices.length;m<e;m+=2){f=b.skinIndices[m],h=b.skinIndices[m+1],j.skinIndices.push(new c.Vector4(f,h,0,0))}}j.bones=b.bones;j.animation=b.animation})();(function(z){if(b.morphTargets!==void 0){var e,f,h,o,m,r,x,p,y;e=0;for(f=b.morphTargets.length;e<f;e++){j.morphTargets[e]={};j.morphTargets[e].name=b.morphTargets[e].name;j.morphTargets[e].vertices=[];p=j.morphTargets[e].vertices;y=b.morphTargets[e].vertices;h=0;for(o=y.length;h<o;h+=3){m=y[h]*z,r=y[h+1]*z,x=y[h+2]*z,p.push(new c.Vertex(new c.Vector3(m,r,x)))}}}if(b.morphColors!==void 0){e=0;for(f=b.morphColors.length;e<f;e++){j.morphColors[e]={};j.morphColors[e].name=b.morphColors[e].name;j.morphColors[e].colors=[];o=j.morphColors[e].colors;m=b.morphColors[e].colors;z=0;for(h=m.length;z<h;z+=3){r=new c.Color(16755200),r.setRGB(m[z],m[z+1],m[z+2]),o.push(r)}}}})(a);j.computeCentroids();j.computeFaceNormals();this.hasNormals(j)&&j.computeTangents();g(j)};c.SceneLoader=function(){this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){};this.callbackSync=function(){};this.callbackProgress=function(){}};c.SceneLoader.prototype.constructor=c.SceneLoader;c.SceneLoader.prototype.load=function(a,g){var b=this,h=new XMLHttpRequest;h.onreadystatechange=function(){if(h.readyState==4){if(h.status==200||h.status==0){try{var f=JSON.parse(h.responseText);f.metadata===void 0||f.metadata.formatVersion===void 0||f.metadata.formatVersion!==3?console.error("Deprecated file format."):b.createScene(f,g,a)}catch(e){console.error(e),console.warn("DEPRECATED: ["+a+"] seems to be using old model format")}}else{console.error("Couldn't load ["+a+"] ["+h.status+"]")}}};h.open("GET",a,!0);h.overrideMimeType("text/plain; charset=x-user-defined");h.setRequestHeader("Content-Type","text/plain");h.send(null)};c.SceneLoader.prototype.createScene=function(n,t,q){function v(z,j){return j=="relativeToHTML"?z:R+"/"+z}function F(){var z;for(o in g.objects){if(!B.objects[o]){if(I=g.objects[o],I.geometry!==void 0){if(ab=B.geometries[I.geometry]){z=!1;for(H=0;H<I.materials.length;H++){r=B.materials[I.materials[H]],z=r instanceof c.ShaderMaterial}z&&ab.computeTangents();p=I.position;x=I.rotation;l=I.quaternion;e=I.scale;l=0;r.length==0&&(r=new c.MeshFaceMaterial);r.length>1&&(r=new c.MeshFaceMaterial);z=new c.Mesh(ab,r);z.name=o;z.position.set(p[0],p[1],p[2]);l?(z.quaternion.set(l[0],l[1],l[2],l[3]),z.useQuaternion=!0):z.rotation.set(x[0],x[1],x[2]);z.scale.set(e[0],e[1],e[2]);z.visible=I.visible;B.scene.add(z);B.objects[o]=z;if(I.meshCollider){var j=c.CollisionUtils.MeshColliderWBox(z);B.scene.collisions.colliders.push(j)}if(I.castsShadow){j=new c.ShadowVolume(ab),B.scene.add(j),j.position=z.position,j.rotation=z.rotation,j.scale=z.scale}I.trigger&&I.trigger.toLowerCase()!="none"&&(j={type:I.trigger,object:I},B.triggers[z.name]=j)}}else{p=I.position,x=I.rotation,l=I.quaternion,e=I.scale,l=0,z=new c.Object3D,z.name=o,z.position.set(p[0],p[1],p[2]),l?(z.quaternion.set(l[0],l[1],l[2],l[3]),z.useQuaternion=!0):z.rotation.set(x[0],x[1],x[2]),z.scale.set(e[0],e[1],e[2]),z.visible=I.visible!==void 0?I.visible:!1,B.scene.add(z),B.objects[o]=z,B.empties[o]=z,I.trigger&&I.trigger.toLowerCase()!="none"&&(j={type:I.trigger,object:I},B.triggers[z.name]=j)}}}}function E(j){return function(z){B.geometries[j]=z;F();a-=1;J.onLoadComplete();G()}}function A(j){return function(z){B.geometries[j]=z}}function G(){J.callbackProgress({totalModels:K,totalTextures:i,loadedModels:K-a,loadedTextures:i-aa},B);J.onLoadProgress();a==0&&aa==0&&t(B)}var J=this,R=c.Loader.prototype.extractUrlbase(q),O,m,o,b,u,f,s,I,ac,U,p,x,l,e,h,ab,P,w,r,g,k,a,aa,K,i,B;g=n;q=new c.BinaryLoader;k=new c.JSONLoader;aa=a=0;B={scene:new c.Scene,geometries:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},triggers:{},empties:{}};n=!1;for(o in g.objects){if(I=g.objects[o],I.meshCollider){n=!0;break}}if(n){B.scene.collisions=new c.CollisionSystem}if(g.transform){n=g.transform.position;ac=g.transform.rotation;var y=g.transform.scale;n&&B.scene.position.set(n[0],n[1],n[2]);ac&&B.scene.rotation.set(ac[0],ac[1],ac[2]);y&&B.scene.scale.set(y[0],y[1],y[2]);(n||ac||y)&&B.scene.updateMatrix()}n=function(){aa-=1;G();J.onLoadComplete()};for(u in g.cameras){ac=g.cameras[u],ac.type=="perspective"?P=new c.PerspectiveCamera(ac.fov,ac.aspect,ac.near,ac.far):ac.type=="ortho"&&(P=new c.OrthographicCamera(ac.left,ac.right,ac.top,ac.bottom,ac.near,ac.far)),p=ac.position,ac=ac.target,P.position.set(p[0],p[1],p[2]),P.target=new c.Vector3(ac[0],ac[1],ac[2]),B.cameras[u]=P}for(b in g.lights){ac=g.lights[b],u=ac.color!==void 0?ac.color:16777215,P=ac.intensity!==void 0?ac.intensity:1,ac.type=="directional"?(p=ac.direction,U=new c.DirectionalLight(u,P),U.position.set(p[0],p[1],p[2]),U.position.normalize()):ac.type=="point"?(p=ac.position,U=ac.distance,U=new c.PointLight(u,P,U),U.position.set(p[0],p[1],p[2])):ac.type=="ambient"&&(U=new c.AmbientLight(u)),B.scene.add(U),B.lights[b]=U}for(f in g.fogs){b=g.fogs[f],b.type=="linear"?w=new c.Fog(0,b.near,b.far):b.type=="exp2"&&(w=new c.FogExp2(0,b.density)),ac=b.color,w.color.setRGB(ac[0],ac[1],ac[2]),B.fogs[f]=w}if(B.cameras&&g.defaults.camera){B.currentCamera=B.cameras[g.defaults.camera]}if(B.fogs&&g.defaults.fog){B.scene.fog=B.fogs[g.defaults.fog]}ac=g.defaults.bgcolor;B.bgColor=new c.Color;B.bgColor.setRGB(ac[0],ac[1],ac[2]);B.bgColorAlpha=g.defaults.bgalpha;for(O in g.geometries){if(f=g.geometries[O],f.type=="bin_mesh"||f.type=="ascii_mesh"){a+=1,J.onLoadStart()}}K=a;for(O in g.geometries){f=g.geometries[O],f.type=="cube"?(ab=new c.CubeGeometry(f.width,f.height,f.depth,f.segmentsWidth,f.segmentsHeight,f.segmentsDepth,null,f.flipped,f.sides),B.geometries[O]=ab):f.type=="plane"?(ab=new c.PlaneGeometry(f.width,f.height,f.segmentsWidth,f.segmentsHeight),B.geometries[O]=ab):f.type=="sphere"?(ab=new c.SphereGeometry(f.radius,f.segmentsWidth,f.segmentsHeight),B.geometries[O]=ab):f.type=="cylinder"?(ab=new c.CylinderGeometry(f.topRad,f.botRad,f.height,f.radSegs,f.heightSegs),B.geometries[O]=ab):f.type=="torus"?(ab=new c.TorusGeometry(f.radius,f.tube,f.segmentsR,f.segmentsT),B.geometries[O]=ab):f.type=="icosahedron"?(ab=new c.IcosahedronGeometry(f.subdivisions),B.geometries[O]=ab):f.type=="bin_mesh"?q.load(v(f.url,g.urlBaseType),E(O)):f.type=="ascii_mesh"?k.load(v(f.url,g.urlBaseType),E(O)):f.type=="embedded_mesh"&&(f=g.embeds[f.id])&&k.createModel(f,A(O),"")}for(s in g.textures){if(O=g.textures[s],O.url instanceof Array){aa+=O.url.length;for(f=0;f<O.url.length;f++){J.onLoadStart()}}else{aa+=1,J.onLoadStart()}}i=aa;for(s in g.textures){O=g.textures[s];if(O.mapping!=void 0&&c[O.mapping]!=void 0){O.mapping=new c[O.mapping]}if(O.url instanceof Array){f=[];for(var H=0;H<O.url.length;H++){f[H]=v(O.url[H],g.urlBaseType)}f=c.ImageUtils.loadTextureCube(f,O.mapping,n)}else{f=c.ImageUtils.loadTexture(v(O.url,g.urlBaseType),O.mapping,n);if(c[O.minFilter]!=void 0){f.minFilter=c[O.minFilter]}if(c[O.magFilter]!=void 0){f.magFilter=c[O.magFilter]}if(O.repeat){f.repeat.set(O.repeat[0],O.repeat[1]);if(O.repeat[0]!=1){f.wrapS=c.RepeatWrapping}if(O.repeat[1]!=1){f.wrapT=c.RepeatWrapping}}O.offset&&f.offset.set(O.offset[0],O.offset[1]);if(O.wrap){w={repeat:c.RepeatWrapping,mirror:c.MirroredRepeatWrapping};if(w[O.wrap[0]]!==void 0){f.wrapS=w[O.wrap[0]]}if(w[O.wrap[1]]!==void 0){f.wrapT=w[O.wrap[1]]}}}B.textures[s]=f}for(m in g.materials){s=g.materials[m];for(h in s.parameters){if(h=="envMap"||h=="map"||h=="lightMap"){s.parameters[h]=B.textures[s.parameters[h]]}else{if(h=="shading"){s.parameters[h]=s.parameters[h]=="flat"?c.FlatShading:c.SmoothShading}else{if(h=="blending"){s.parameters[h]=c[s.parameters[h]]?c[s.parameters[h]]:c.NormalBlending}else{if(h=="combine"){s.parameters[h]=s.parameters[h]=="MixOperation"?c.MixOperation:c.MultiplyOperation}else{if(h=="vertexColors"){if(s.parameters[h]=="face"){s.parameters[h]=c.FaceColors}else{if(s.parameters[h]){s.parameters[h]=c.VertexColors}}}}}}}}if(s.parameters.opacity!==void 0&&s.parameters.opacity<1){s.parameters.transparent=!0}if(s.parameters.normalMap){O=c.ShaderUtils.lib.normal;n=c.UniformsUtils.clone(O.uniforms);f=s.parameters.color;w=s.parameters.specular;q=s.parameters.ambient;k=s.parameters.shininess;n.tNormal.texture=B.textures[s.parameters.normalMap];if(s.parameters.normalMapFactor){n.uNormalScale.value=s.parameters.normalMapFactor}if(s.parameters.map){n.tDiffuse.texture=s.parameters.map,n.enableDiffuse.value=!0}if(s.parameters.lightMap){n.tAO.texture=s.parameters.lightMap,n.enableAO.value=!0}if(s.parameters.specularMap){n.tSpecular.texture=B.textures[s.parameters.specularMap],n.enableSpecular.value=!0}n.uDiffuseColor.value.setHex(f);n.uSpecularColor.value.setHex(w);n.uAmbientColor.value.setHex(q);n.uShininess.value=k;if(s.parameters.opacity){n.uOpacity.value=s.parameters.opacity}s=new c.ShaderMaterial({fragmentShader:O.fragmentShader,vertexShader:O.vertexShader,uniforms:n,lights:!0,fog:!0})}else{s=new c[s.type](s.parameters)}B.materials[m]=s}F();J.callbackSync(B);G()};c.UTF8Loader=function(){};c.UTF8Loader.prototype=new c.UTF8Loader;c.UTF8Loader.prototype.constructor=c.UTF8Loader;c.UTF8Loader.prototype.load=function(a,g,e){if(a instanceof Object){console.warn("DEPRECATED: UTF8Loader( parameters ) is now UTF8Loader( url, callback, metaData )."),e=a,a=e.model,g=e.callback,e={scale:e.scale,offsetX:e.offsetX,offsetY:e.offsetY,offsetZ:e.offsetZ}}var b=new XMLHttpRequest,p=e.scale!==void 0?e.scale:1,h=e.offsetX!==void 0?e.offsetX:0,f=e.offsetY!==void 0?e.offsetY:0,o=e.offsetZ!==void 0?e.offsetZ:0;b.onreadystatechange=function(){b.readyState==4?b.status==200||b.status==0?c.UTF8Loader.prototype.createModel(b.responseText,g,p,h,f,o):alert("Couldn't load ["+a+"] ["+b.status+"]"):b.readyState!=3&&b.readyState==2&&b.getResponseHeader("Content-Length")};b.open("GET",a,!0);b.send(null)};c.UTF8Loader.prototype.decompressMesh=function(a){var g=a.charCodeAt(0);g>=57344&&(g-=2048);g++;for(var e=new Float32Array(8*g),b=1,p=0;p<8;p++){for(var h=0,f=0;f<g;++f){var o=a.charCodeAt(f+b);h+=o>>1^-(o&1);e[8*f+p]=h}b+=g}g=a.length-b;h=new Uint16Array(g);for(p=f=0;p<g;p++){o=a.charCodeAt(p+b),h[p]=f-o,o==0&&f++}return[e,h]};c.UTF8Loader.prototype.createModel=function(g,b,a,m,f,e){var n=function(){var k=this;k.materials=[];c.Geometry.call(this);var h=c.UTF8Loader.prototype.decompressMesh(g),j=[],i=[];(function(z,y,l){for(var x,q,A,t=z.length;l<t;l+=y){x=z[l],q=z[l+1],A=z[l+2],x=x/16383*a,q=q/16383*a,A=A/16383*a,x+=m,q+=f,A+=e,k.vertices.push(new c.Vertex(new c.Vector3(x,q,A)))}})(h[0],8,0);(function(v,x,w){for(var y,l,u=v.length;w<u;w+=x){y=v[w],l=v[w+1],y/=1023,l/=1023,i.push(y,1-l)}})(h[0],8,3);(function(l,w,x){for(var z,v,y,A=l.length;x<A;x+=w){z=l[x],v=l[x+1],y=l[x+2],z=(z-512)/511,v=(v-512)/511,y=(y-512)/511,j.push(z,v,y)}})(h[0],8,5);(function(l){var s,u,x,B,F,R,T,J,v,S=l.length;for(s=0;s<S;s+=3){u=l[s];x=l[s+1];B=l[s+2];F=k;J=u;v=x;R=B;T=u;var A=x,U=B,V=F.materials[0],y=j[A*3],W=j[A*3+1],A=j[A*3+2],w=j[U*3],E=j[U*3+1],U=j[U*3+2];T=new c.Vector3(j[T*3],j[T*3+1],j[T*3+2]);A=new c.Vector3(y,W,A);U=new c.Vector3(w,E,U);F.faces.push(new c.Face3(J,v,R,[T,A,U],null,V));F=i[u*2];u=i[u*2+1];R=i[x*2];T=i[x*2+1];J=i[B*2];v=i[B*2+1];B=k.faceVertexUvs[0];x=R;R=T;T=[];T.push(new c.UV(F,u));T.push(new c.UV(x,R));T.push(new c.UV(J,v));B.push(T)}})(h[1]);this.computeCentroids();this.computeFaceNormals()};n.prototype=new c.Geometry;n.prototype.constructor=n;b(new n)};c.Axes=function(){c.Object3D.call(this);var f=new c.Geometry;f.vertices.push(new c.Vertex);f.vertices.push(new c.Vertex(new c.Vector3(0,100,0)));var b=new c.CylinderGeometry(0,5,25,5,1),a=new c.Line(f,new c.LineBasicMaterial({color:16711680}));a.rotation.z=-Math.PI/2;this.add(a);a=new c.Mesh(b,new c.MeshBasicMaterial({color:16711680}));a.position.x=100;a.rotation.z=-Math.PI/2;this.add(a);a=new c.Line(f,new c.LineBasicMaterial({color:65280}));this.add(a);a=new c.Mesh(b,new c.MeshBasicMaterial({color:65280}));a.position.y=100;this.add(a);a=new c.Line(f,new c.LineBasicMaterial({color:255}));a.rotation.x=Math.PI/2;this.add(a);a=new c.Mesh(b,new c.MeshBasicMaterial({color:255}));a.position.z=100;a.rotation.x=Math.PI/2;this.add(a)};c.Axes.prototype=new c.Object3D;c.Axes.prototype.constructor=c.Axes;c.MarchingCubes=function(b,a){c.Object3D.call(this);this.material=a;this.init=function(e){this.resolution=e;this.isolation=80;this.size=e;this.size2=this.size*this.size;this.size3=this.size2*this.size;this.halfsize=this.size/2;this.delta=2/this.size;this.yd=this.size;this.zd=this.size2;this.field=new Float32Array(this.size3);this.normal_cache=new Float32Array(this.size3*3);this.vlist=new Float32Array(36);this.nlist=new Float32Array(36);this.firstDraw=!0;this.maxCount=4096;this.count=0;this.hasNormal=this.hasPos=!1;this.positionArray=new Float32Array(this.maxCount*3);this.normalArray=new Float32Array(this.maxCount*3)};this.lerp=function(j,e,g){return j+(e-j)*g};this.VIntX=function(i,k,w,o,l,x,e,g,f,h){l=(l-f)/(h-f);f=this.normal_cache;k[o]=x+l*this.delta;k[o+1]=e;k[o+2]=g;w[o]=this.lerp(f[i],f[i+3],l);w[o+1]=this.lerp(f[i+1],f[i+4],l);w[o+2]=this.lerp(f[i+2],f[i+5],l)};this.VIntY=function(i,k,w,o,l,x,e,g,f,h){l=(l-f)/(h-f);f=this.normal_cache;k[o]=x;k[o+1]=e+l*this.delta;k[o+2]=g;k=i+this.yd*3;w[o]=this.lerp(f[i],f[k],l);w[o+1]=this.lerp(f[i+1],f[k+1],l);w[o+2]=this.lerp(f[i+2],f[k+2],l)};this.VIntZ=function(i,k,w,o,l,x,e,g,f,h){l=(l-f)/(h-f);f=this.normal_cache;k[o]=x;k[o+1]=e;k[o+2]=g+l*this.delta;k=i+this.zd*3;w[o]=this.lerp(f[i],f[k],l);w[o+1]=this.lerp(f[i+1],f[k+1],l);w[o+2]=this.lerp(f[i+2],f[k+2],l)};this.compNorm=function(h){var e=h*3;this.normal_cache[e]===0&&(this.normal_cache[e]=this.field[h-1]-this.field[h+1],this.normal_cache[e+1]=this.field[h-this.yd]-this.field[h+this.yd],this.normal_cache[e+2]=this.field[h-this.zd]-this.field[h+this.zd])};this.polygonize=function(ac,ad,g,f,e,h){var i=f+1,l=f+this.yd,k=f+this.zd,o=i+this.yd,p=i+this.zd,m=f+this.yd+this.zd,w=i+this.yd+this.zd,n=0,t=this.field[f],B=this.field[i],r=this.field[l],F=this.field[o],v=this.field[k],u=this.field[p],s=this.field[m],x=this.field[w];t<e&&(n|=1);B<e&&(n|=2);r<e&&(n|=8);F<e&&(n|=4);v<e&&(n|=16);u<e&&(n|=32);s<e&&(n|=128);x<e&&(n|=64);var A=c.edgeTable[n];if(A===0){return 0}var q=this.delta,J=ac+q,y=ad+q,q=g+q;A&1&&(this.compNorm(f),this.compNorm(i),this.VIntX(f*3,this.vlist,this.nlist,0,e,ac,ad,g,t,B));A&2&&(this.compNorm(i),this.compNorm(o),this.VIntY(i*3,this.vlist,this.nlist,3,e,J,ad,g,B,F));A&4&&(this.compNorm(l),this.compNorm(o),this.VIntX(l*3,this.vlist,this.nlist,6,e,ac,y,g,r,F));A&8&&(this.compNorm(f),this.compNorm(l),this.VIntY(f*3,this.vlist,this.nlist,9,e,ac,ad,g,t,r));A&16&&(this.compNorm(k),this.compNorm(p),this.VIntX(k*3,this.vlist,this.nlist,12,e,ac,ad,q,v,u));A&32&&(this.compNorm(p),this.compNorm(w),this.VIntY(p*3,this.vlist,this.nlist,15,e,J,ad,q,u,x));A&64&&(this.compNorm(m),this.compNorm(w),this.VIntX(m*3,this.vlist,this.nlist,18,e,ac,y,q,s,x));A&128&&(this.compNorm(k),this.compNorm(m),this.VIntY(k*3,this.vlist,this.nlist,21,e,ac,ad,q,v,s));A&256&&(this.compNorm(f),this.compNorm(k),this.VIntZ(f*3,this.vlist,this.nlist,24,e,ac,ad,g,t,v));A&512&&(this.compNorm(i),this.compNorm(p),this.VIntZ(i*3,this.vlist,this.nlist,27,e,J,ad,g,B,u));A&1024&&(this.compNorm(o),this.compNorm(w),this.VIntZ(o*3,this.vlist,this.nlist,30,e,J,y,g,F,x));A&2048&&(this.compNorm(l),this.compNorm(m),this.VIntZ(l*3,this.vlist,this.nlist,33,e,ac,y,g,r,s));n<<=4;for(e=f=0;c.triTable[n+e]!=-1;){ac=n+e,ad=ac+1,g=ac+2,this.posnormtriv(this.vlist,this.nlist,3*c.triTable[ac],3*c.triTable[ad],3*c.triTable[g],h),e+=3,f++}return f};this.posnormtriv=function(g,h,i,e,q,r){var f=this.count*3;this.positionArray[f]=g[i];this.positionArray[f+1]=g[i+1];this.positionArray[f+2]=g[i+2];this.positionArray[f+3]=g[e];this.positionArray[f+4]=g[e+1];this.positionArray[f+5]=g[e+2];this.positionArray[f+6]=g[q];this.positionArray[f+7]=g[q+1];this.positionArray[f+8]=g[q+2];this.normalArray[f]=h[i];this.normalArray[f+1]=h[i+1];this.normalArray[f+2]=h[i+2];this.normalArray[f+3]=h[e];this.normalArray[f+4]=h[e+1];this.normalArray[f+5]=h[e+2];this.normalArray[f+6]=h[q];this.normalArray[f+7]=h[q+1];this.normalArray[f+8]=h[q+2];this.hasNormal=this.hasPos=!0;this.count+=3;this.count>=this.maxCount-3&&r(this)};this.begin=function(){this.count=0;this.hasNormal=this.hasPos=!1};this.end=function(h){if(this.count!==0){for(var e=this.count*3;e<this.positionArray.length;e++){this.positionArray[e]=0}h(this)}};this.addBall=function(e,g,q,n,k){var t=this.size*Math.sqrt(n/k),w=q*this.size,i=g*this.size,M=e*this.size,r=Math.floor(w-t);r<1&&(r=1);w=Math.floor(w+t);w>this.size-1&&(w=this.size-1);var h=Math.floor(i-t);h<1&&(h=1);i=Math.floor(i+t);i>this.size-1&&(i=this.size-1);var l=Math.floor(M-t);l<1&&(l=1);t=Math.floor(M+t);t>this.size-1&&(t=this.size-1);for(var p,o,m,u,N,f;r<w;r++){M=this.size2*r;o=r/this.size-q;N=o*o;for(o=h;o<i;o++){m=M+this.size*o;p=o/this.size-g;f=p*p;for(p=l;p<t;p++){u=p/this.size-e,u=n/(0.000001+u*u+f+N)-k,u>0&&(this.field[m+p]+=u)}}}};this.addPlaneX=function(o,p){var f,B,A,g,e,i=this.size,h=this.yd,l=this.zd,m=this.field,k=i*Math.sqrt(o/p);k>i&&(k=i);for(f=0;f<k;f++){if(B=f/i,B*=B,g=o/(0.0001+B)-p,g>0){for(B=0;B<i;B++){e=f+B*h;for(A=0;A<i;A++){m[l*A+e]+=g}}}}};this.addPlaneY=function(g,k){var r,p,o,C,D,e,h=this.size,f=this.yd,l=this.zd,i=this.field,m=h*Math.sqrt(g/k);m>h&&(m=h);for(p=0;p<m;p++){if(r=p/h,r*=r,C=g/(0.0001+r)-k,C>0){D=p*f;for(r=0;r<h;r++){e=D+r;for(o=0;o<h;o++){i[l*o+e]+=C}}}}};this.addPlaneZ=function(g,k){var r,p,o,C,D,e,h=this.size,f=this.yd,l=this.zd,i=this.field,m=h*Math.sqrt(g/k);m>h&&(m=h);for(o=0;o<m;o++){if(r=o/h,r*=r,C=g/(0.0001+r)-k,C>0){D=l*o;for(p=0;p<h;p++){e=D+p*f;for(r=0;r<h;r++){i[e+r]+=C}}}}};this.reset=function(){var e;for(e=0;e<this.size3;e++){this.normal_cache[e*3]=0,this.field[e]=0}};this.render=function(f){this.begin();var g,k,i,h,l,o,y,p,z,e=this.size-2;for(h=1;h<e;h++){z=this.size2*h;y=(h-this.halfsize)/this.halfsize;for(i=1;i<e;i++){p=z+this.size*i;o=(i-this.halfsize)/this.halfsize;for(k=1;k<e;k++){l=(k-this.halfsize)/this.halfsize,g=p+k,this.polygonize(l,o,y,g,this.isolation,f)}}}this.end(f)};this.generateGeometry=function(){var j=0,e=new c.Geometry,g=[];this.render(function(m){var l,o,p,f,v,i,k,h;for(l=0;l<m.count;l++){k=l*3,v=k+1,h=k+2,o=m.positionArray[k],p=m.positionArray[v],f=m.positionArray[h],i=new c.Vector3(o,p,f),o=m.normalArray[k],p=m.normalArray[v],f=m.normalArray[h],k=new c.Vector3(o,p,f),k.normalize(),v=new c.Vertex(i),e.vertices.push(v),g.push(k)}i=m.count/3;for(l=0;l<i;l++){k=(j+l)*3,v=k+1,h=k+2,o=g[k],p=g[v],f=g[h],k=new c.Face3(k,v,h,[o,p,f]),e.faces.push(k)}j+=i;m.count=0});return e};this.init(b)};c.MarchingCubes.prototype=new c.Object3D;c.MarchingCubes.prototype.constructor=c.MarchingCubes;c.edgeTable=new Int32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]);c.triTable=new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]);if(c.WebGLRenderer){c.AnaglyphWebGLRenderer=function(k){c.WebGLRenderer.call(this,k);this.autoUpdateScene=!1;var f=this,e=this.setSize,l=this.render,p=new c.PerspectiveCamera,n=new c.PerspectiveCamera,m=new c.Matrix4,r=new c.Matrix4,E,b,F,a;p.matrixAutoUpdate=n.matrixAutoUpdate=!1;var k={minFilter:c.LinearFilter,magFilter:c.NearestFilter,format:c.RGBAFormat},g=new c.WebGLRenderTarget(512,512,k),h=new c.WebGLRenderTarget(512,512,k),o=new c.PerspectiveCamera(53,1,1,10000);o.position.z=2;var k=new c.ShaderMaterial({uniforms:{mapLeft:{type:"t",value:0,texture:g},mapRight:{type:"t",value:1,texture:h}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D mapLeft;\nuniform sampler2D mapRight;\nvarying vec2 vUv;\nvoid main() {\nvec4 colorL, colorR;\nvec2 uv = vUv;\ncolorL = texture2D( mapLeft, uv );\ncolorR = texture2D( mapRight, uv );\ngl_FragColor = vec4( colorL.g * 0.7 + colorL.b * 0.3, colorR.g, colorR.b, colorL.a + colorR.a ) * 1.1;\n}"}),i=new c.Scene;i.add(new c.Mesh(new c.PlaneGeometry(2,2),k));i.add(o);this.setSize=function(j,q){e.call(f,j,q);g.width=j;g.height=q;h.width=j;h.height=q};this.render=function(s,v){s.updateMatrixWorld();if(E!==v.aspect||b!==v.near||F!==v.far||a!==v.fov){E=v.aspect;b=v.near;F=v.far;a=v.fov;var t=v.projectionMatrix.clone(),q=125/30*0.5,u=q*b/125,j=b*Math.tan(a*Math.PI/360),w;m.n14=q;r.n14=-q;q=-j*E+u;w=j*E+u;t.n11=2*b/(w-q);t.n13=(w+q)/(w-q);p.projectionMatrix.copy(t);q=-j*E-u;w=j*E-u;t.n11=2*b/(w-q);t.n13=(w+q)/(w-q);n.projectionMatrix.copy(t)}p.matrixWorld.copy(v.matrixWorld).multiplySelf(r);p.position.copy(v.position);p.near=v.near;p.far=v.far;l.call(f,s,p,g,!0);n.matrixWorld.copy(v.matrixWorld).multiplySelf(m);n.position.copy(v.position);n.near=v.near;n.far=v.far;l.call(f,s,n,h,!0);i.updateMatrixWorld();l.call(f,i,o)}}}if(c.WebGLRenderer){c.CrosseyedWebGLRenderer=function(a){c.WebGLRenderer.call(this,a);this.autoClear=!1;var g=this,e=this.setSize,b=this.render,p,h,f=new c.PerspectiveCamera;f.target=new c.Vector3(0,0,0);var o=new c.PerspectiveCamera;o.target=new c.Vector3(0,0,0);g.separation=10;if(a&&a.separation!==void 0){g.separation=a.separation}this.setSize=function(j,i){e.call(g,j,i);p=j/2;h=i};this.render=function(i,j){this.clear();f.fov=j.fov;f.aspect=0.5*j.aspect;f.near=j.near;f.far=j.far;f.updateProjectionMatrix();f.position.copy(j.position);f.target.copy(j.target);f.translateX(g.separation);f.lookAt(f.target);o.projectionMatrix=f.projectionMatrix;o.position.copy(j.position);o.target.copy(j.target);o.translateX(-g.separation);o.lookAt(o.target);this.setViewport(0,0,p,h);b.call(g,i,f);this.setViewport(p,0,p,h);b.call(g,i,o,!1)}}}return c});